/*! For license information please see 1922.bundle.d88b4261c996ebe32198.js.LICENSE.txt */
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1922],{36205:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var r=n(5193),i=n(31239),o=n(44031),a=n(72076),s=n(82253),l=n(48588),c=n(7187),u=n(68032),d=n(74238),p=n(28719),h=n(18588),f=n(11723),m=n(25281),g=n(41957),v=n(77614),y=n(20037),b=n(96765),C=n(40589),w=n(54526);class E extends v.Z{constructor(e){if(super(e),this.useCPURendering=!1,this.useNativeDataType=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.setRotation=e=>{const t=this.getPan(this.fitToCanvasCamera),n=this.getPan(),r=this.getCamera(),i=a.K4.sub([0,0],t,n);this.setPan(i,!1);const{flipVertical:o}=this.getCamera(),s=o?a.R3.negate([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:s}),this.rotateCamera(e);const l=this.getPan(),u=this.getPan(this.fitToCanvasCamera),d=a.K4.sub([0,0],l,u),p=a.K4.add([0,0],t,d);if(this.setPan(p,!1),this._suppressCameraModifiedEvents)return;const h={previousCamera:r,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:e};(0,f.triggerEvent)(this.element,c.Events.CAMERA_MODIFIED,h),this.viewportProperties.rotation=e},this.getDefaultProperties=e=>{let t;return void 0!==e&&(t=this.perVolumeIdDefaultProperties.get(e)),void 0!==t?t:{...this.globalDefaultProperties}},this.getProperties=e=>{if(!this._getApplicableVolumeActor(e))return;const{colormap:t,VOILUTFunction:n,interpolationType:r,invert:i,slabThickness:o,rotation:a,preset:l}=this.viewportProperties,c=this.getActors().map(e=>{const t=e.actor,n=e.uid;if(!s.ZP.getVolume(n))return null;const r=t.getProperty().getRGBTransferFunction(0),[i,o]="SIGMOID"===this.viewportProperties?.VOILUTFunction?(0,f.getVoiFromSigmoidRGBTransferFunction)(r):r.getRange();return{volumeId:n,voiRange:{lower:i,upper:o}}}).filter(Boolean),u=e?c.find(t=>t.volumeId===e)?.voiRange:c[0]?.voiRange,d=this.getColormap(e);return{colormap:e&&d?d:t,voiRange:u,VOILUTFunction:n,interpolationType:r,invert:i,slabThickness:o,rotation:a,preset:l}},this.getColormap=e=>{const t=this._getApplicableVolumeActor(e);if(!t)return;const{volumeActor:n}=t,r=n.getProperty().getRGBTransferFunction(0),{nodes:i}=r.getState(),o=i.reduce((e,t)=>(e.push(t.x,t.r,t.g,t.b),e),[]);return(0,C.findMatchingColormap)(o,n)},this.getRotation=()=>{const{viewUp:e,viewPlaneNormal:t,flipVertical:n}=this.getCamera(),r=n?a.R3.negate([0,0,0],this.initialViewUp):this.initialViewUp;if(!r)return 0;const i=180*a.R3.angle(r,e)/Math.PI,o=a.R3.cross([0,0,0],r,e);return a.R3.dot(o,t)>=0?i:(360-i)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=e=>{const t=this.getVtkActiveCamera();t.setIsPerformingCoordinateTransformation?.(!0);const n=this.getRenderer(),r=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),i=r.getSize(),o=window.devicePixelRatio||1,a=[e[0]*o,e[1]*o],s=[a[0]+this.sx,a[1]+this.sy];s[1]=i[1]-s[1];const l=r.displayToWorld(s[0],s[1],0,n);return t.setIsPerformingCoordinateTransformation?.(!1),[l[0],l[1],l[2]]},this.worldToCanvas=e=>{const t=this.getVtkActiveCamera();t.setIsPerformingCoordinateTransformation?.(!0);const n=this.getRenderer(),r=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),i=r.getSize(),o=r.worldToDisplay(...e,n);o[1]=i[1]-o[1];const a=[o[0]-this.sx,o[1]-this.sy],s=window.devicePixelRatio||1,l=[a[0]/s,a[1]/s];return t.setIsPerformingCoordinateTransformation?.(!1),l},this.hasImageURI=e=>this.getActors().filter(e=>(0,f.actorIsA)(e,"vtkVolume")).some(({uid:t})=>{const n=s.ZP.getVolume(t);if(!n||!n.imageIds)return!1;return n.imageIds.map(f.imageIdToURI).includes(e)}),this.getImageIds=e=>{const t=this._getApplicableVolumeActor(e);if(!t)throw new Error(`No actor found for the given volumeId: ${e}`);const n=t.volumeId,r=s.ZP.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);return r.imageIds},this.useCPURendering=(0,p.L_)(),this.useNativeDataType=this._shouldUseNativeDataType(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const t=this.getRenderer(),n=y.ZP.newInstance();switch(t.setActiveCamera(n),this.type){case u.Z.ORTHOGRAPHIC:case u.Z.VOLUME_3D:n.setParallelProjection(!0);break;case u.Z.PERSPECTIVE:n.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}applyViewOrientation(e,t=!0){const{viewPlaneNormal:n,viewUp:r}=this._getOrientationVectors(e),i=this.getVtkActiveCamera();i.setDirectionOfProjection(-n[0],-n[1],-n[2]),i.setViewUpFrom(r),this.initialViewUp=r,t&&this.resetCamera()}initializeVolumeNewImageEventDispatcher(){const e=function(e){const{viewportId:t}=e.detail;if(t!==this.id||this.isDisabled)return;if(!this.getImageData())return;(0,g.Z)(e)}.bind(this),t=function(n){const{viewportId:r}=n.detail;if(r!==this.id)return;this.element.removeEventListener(c.Events.CAMERA_MODIFIED,e),d.Z.removeEventListener(c.Events.ELEMENT_DISABLED,t),(0,g.t)(r)}.bind(this);this.element.removeEventListener(c.Events.CAMERA_MODIFIED,e),this.element.addEventListener(c.Events.CAMERA_MODIFIED,e),d.Z.addEventListener(c.Events.ELEMENT_DISABLED,t)}resetVolumeViewportClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-l.RENDERING_DEFAULTS.MAXIMUM_RAY_DISTANCE,l.RENDERING_DEFAULTS.MAXIMUM_RAY_DISTANCE):e.setClippingRange(l.RENDERING_DEFAULTS.MINIMUM_SLAB_THICKNESS,l.RENDERING_DEFAULTS.MAXIMUM_RAY_DISTANCE)}setVOILUTFunction(e,t,n){-1===Object.values(c.VOILUTFunctionType).indexOf(e)&&(e=c.VOILUTFunctionType.LINEAR);const{voiRange:r}=this.getProperties();this.setVOI(r,t,n),this.viewportProperties.VOILUTFunction=e}setColormap(e,t,n){const o=this._getApplicableVolumeActor(t);if(!o)return;const{volumeActor:a}=o,s=r.ZP.newInstance();let l=f.colormap.getColormap(e.name);const{name:u}=e;if(l||(l=i.Z.getPresetByName(u)),!l)throw new Error(`Colormap ${e} not found`);const d=a.getProperty().getRGBTransferFunction(0).getRange();if(s.applyColorMap(l),s.setMappingRange(d[0],d[1]),a.getProperty().setRGBTransferFunction(0,s),this.viewportProperties.colormap=e,!n){const n={viewportId:this.id,colormap:e,volumeId:t};(0,f.triggerEvent)(this.element,c.Events.COLORMAP_MODIFIED,n)}}setOpacity(e,t){const n=this._getApplicableVolumeActor(t);if(!n)return;const{volumeActor:r}=n,i=o.ZP.newInstance();if("number"==typeof e.opacity){const t=r.getProperty().getRGBTransferFunction(0).getRange();i.addPoint(t[0],e.opacity),i.addPoint(t[1],e.opacity)}else e.opacity.forEach(({opacity:e,value:t})=>{i.addPoint(t,e)});r.getProperty().setScalarOpacity(0,i),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity}setInvert(e,t,n){const r=this._getApplicableVolumeActor(t);if(!r)return;const i=r.volumeId,o=this._getOrCreateColorTransferFunction(i);if((0,f.invertRgbTransferFunction)(o),this.viewportProperties.invert=e,!n){const e={...this.getVOIModifiedEventDetail(i),invertStateChanged:!0};(0,f.triggerEvent)(this.element,c.Events.VOI_MODIFIED,e)}}getVOIModifiedEventDetail(e){const t=this._getApplicableVolumeActor(e);if(!t)throw new Error(`No actor found for the given volumeId: ${e}`);const n=t.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),r=this.getColormap(e),{VOILUTFunction:i,invert:o}=this.getProperties(e);return{viewportId:this.id,range:{lower:n[0],upper:n[1]},volumeId:t.volumeId,VOILUTFunction:i,colormap:r,invert:o}}_getOrCreateColorTransferFunction(e){const t=this._getApplicableVolumeActor(e);if(!t)return null;const{volumeActor:n}=t,i=n.getProperty().getRGBTransferFunction(0);if(i)return i;const o=r.ZP.newInstance();return n.getProperty().setRGBTransferFunction(0,o),o}setInterpolationType(e,t){const n=this._getApplicableVolumeActor(t);if(!n)return;const{volumeActor:r}=n;r.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,t,n=!1){const r=this._getApplicableVolumeActor(t);if(!r)return;const{volumeActor:i}=r,o=r.volumeId;let a=e;if(void 0===a){const e=i.getMapper().getInputData().getPointData().getScalars().getRange();a={lower:e[0],upper:e[1]}}const{VOILUTFunction:s}=this.getProperties(o);if(s===c.VOILUTFunctionType.SAMPLED_SIGMOID){const e=(0,f.createSigmoidRGBTransferFunction)(a);i.getProperty().setRGBTransferFunction(0,e)}else{const{lower:e,upper:t}=a;i.getProperty().getRGBTransferFunction(0).setRange(e,t)}if(!n){const e={...this.getVOIModifiedEventDetail(o)};(0,f.triggerEvent)(this.element,c.Events.VOI_MODIFIED,e)}this.viewportProperties.voiRange=a}rotateCamera(e){const t=e-this.getRotation();this.getVtkActiveCamera().roll(-t)}setDefaultProperties(e,t){null==t?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(t,e)}clearDefaultProperties(e){null==e?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const t=super.getViewReference(e),n=this.getVolumeId(e);if(!1!==e?.forFrameOfReference&&(t.volumeId=n),"number"!=typeof e?.sliceIndex)return t;const{viewPlaneNormal:r}=t,i=e.sliceIndex-this.getSliceIndex(),{sliceRangeInfo:o}=(0,f.getVolumeViewportScrollInfo)(this,n,!0),{sliceRange:a,spacingInNormalDirection:s,camera:l}=o,{focalPoint:c,position:u}=l,{newFocalPoint:d}=(0,f.snapFocalPointToSlice)(c,u,a,r,s,i);return t.cameraFocalPoint=d,t}isReferenceViewable(e,t){if(!e.FrameOfReferenceUID)return!1;if(!super.isReferenceViewable(e,t))return!1;if(t?.withNavigation)return!0;const n=this.getSliceIndex(),{sliceIndex:r}=e;return Array.isArray(r)?r[0]<=n&&n<=r[1]:void 0===r||r===n}scroll(e=1){const t=this.getVolumeId(),{sliceRangeInfo:n}=(0,f.getVolumeViewportScrollInfo)(this,t,!0);if(!n)return;const{sliceRange:r,spacingInNormalDirection:i,camera:o}=n,{focalPoint:a,viewPlaneNormal:s,position:l}=o,{newFocalPoint:c,newPosition:u}=(0,f.snapFocalPointToSlice)(a,l,r,s,i,e);this.setCamera({focalPoint:c,position:u})}setViewReference(e){if(!e)return;const t=this.getVolumeId(),{viewPlaneNormal:n,FrameOfReferenceUID:r,cameraFocalPoint:i,viewUp:o}=e;let{sliceIndex:s}=e;const{focalPoint:l,viewPlaneNormal:c,position:u}=this.getCamera(),d=(0,f.isEqualNegative)(c,n),p=(0,f.isEqual)(c,n);if("number"==typeof s&&e.volumeId===t&&(d||p)){const{currentStepIndex:e,sliceRangeInfo:n,numScrollSteps:r}=(0,f.getVolumeViewportScrollInfo)(this,t,!0),{sliceRange:i,spacingInNormalDirection:o}=n;d&&(s=r-s-1);const a=s-e,{newFocalPoint:p,newPosition:h}=(0,f.snapFocalPointToSlice)(l,u,i,c,o,a);this.setCamera({focalPoint:p,position:h})}else{if(r!==this.getFrameOfReferenceUID())throw new Error(`Incompatible view refs: ${r}!==${this.getFrameOfReferenceUID()}`);if(n&&!d&&!p)return this.setOrientation({viewPlaneNormal:n,viewUp:o}),this.setViewReference(e);if(i){const e=a.R3.subtract([0,0,0],i,l),t=n??c,r=a.R3.dot(e,t);(0,f.isEqual)(r,0)||a.R3.scale(e,t,r);const o=a.R3.add([0,0,0],l,e),s=a.R3.add([0,0,0],u,e);this.setCamera({focalPoint:o,position:s})}}}setProperties({voiRange:e,VOILUTFunction:t,invert:n,colormap:r,preset:i,interpolationType:o,slabThickness:a,rotation:s}={},l,c=!1){null==this.globalDefaultProperties&&this.setDefaultProperties({voiRange:e,VOILUTFunction:t,invert:n,colormap:r,preset:i,slabThickness:a,rotation:s}),r?.name&&this.setColormap(r,l,c),null!=r?.opacity&&this.setOpacity(r,l),void 0!==e&&this.setVOI(e,l,c),void 0!==o&&this.setInterpolationType(o),void 0!==t&&this.setVOILUTFunction(t,l,c),void 0!==n&&this.viewportProperties.invert!==n&&this.setInvert(n,l,c),void 0!==i&&this.setPreset(i,l,c),void 0!==a&&(this.setSlabThickness(a),this.viewportProperties.slabThickness=a),void 0!==s&&this.setRotation(s)}resetToDefaultProperties(e){const t=this.globalDefaultProperties;t.colormap?.name&&this.setColormap(t.colormap,e),null!=t.colormap?.opacity&&this.setOpacity(t.colormap,e),void 0!==t.voiRange&&this.setVOI(t.voiRange,e),void 0!==t.VOILUTFunction&&this.setVOILUTFunction(t.VOILUTFunction,e),void 0!==t.invert&&this.setInvert(t.invert,e),void 0!==t.slabThickness&&(this.setSlabThickness(t.slabThickness),this.viewportProperties.slabThickness=t.slabThickness),void 0!==t.rotation&&this.setRotation(t.rotation),this.render()}setPreset(e,t,n){const r=this._getApplicableVolumeActor(t);if(!r)return;const{volumeActor:i}=r;let o=e;"string"==typeof o&&(o=l.VIEWPORT_PRESETS.find(t=>t.name===e)),o&&((0,f.applyPreset)(i,o),this.viewportProperties.preset=o,this.render(),n||(0,f.triggerEvent)(this.element,c.Events.PRESET_MODIFIED,{viewportId:this.id,volumeId:r.volumeId,actor:i,presetName:o.name}))}async setVolumes(e,t=!1,n=!1){const r=s.ZP.getVolume(e[0].volumeId);if(!r)throw new Error(`imageVolume with id: ${r.volumeId} does not exist`);const i=r.metadata.FrameOfReferenceUID;await this._isValidVolumeInputArray(e,i),this._FrameOfReferenceUID=i;const o=[];for(let t=0;t<e.length;t++){const{volumeId:r,actorUID:i,slabThickness:a}=e[t],s=await(0,m.TS)(e[t],this.element,this.id,n,this.useNativeDataType),l=i||r;o.push({uid:l,actor:s,slabThickness:a,referenceId:r})}this._setVolumeActors(o),this.viewportStatus=c.ViewportStatus.PRE_RENDER,this.initializeColorTransferFunction(e),(0,f.triggerEvent)(this.element,c.Events.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:o}),t&&this.render()}async addVolumes(e,t=!1,n=!1){const r=s.ZP.getVolume(e[0].volumeId);if(!r)throw new Error(`imageVolume with id: ${r.volumeId} does not exist`);const i=[];await this._isValidVolumeInputArray(e,this._FrameOfReferenceUID);for(let t=0;t<e.length;t++){const{volumeId:r,visibility:o,actorUID:a,slabThickness:s}=e[t],l=await(0,m.TS)(e[t],this.element,this.id,n,this.useNativeDataType);!1===o&&l.setVisibility(!1);const c=a||r;i.push({uid:c,actor:l,slabThickness:s,referenceId:r})}this.addActors(i),this.initializeColorTransferFunction(e),t&&this.render()}removeVolumeActors(e,t=!1){this.removeActors(e),t&&this.render()}setOrientation(e,t=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const t=e[0].volumeId,n=this._getOrCreateColorTransferFunction(t);this.initialTransferFunctionNodes||(this.initialTransferFunctionNodes=(0,w.getTransferFunctionNodes)(n))}_getApplicableVolumeActor(e){if(void 0!==e&&!this.getActor(e))return;const t=this.getActors();if(!t.length)return;let n;return e&&(n=this.getActor(e)?.actor),n||(n=t[0].actor,e=t[0].uid),{volumeActor:n,volumeId:e}}async _isValidVolumeInputArray(e,t){const n=e.length;for(let r=1;r<n;r++){const n=e[r],i=await(0,h.loadVolume)(n.volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);if(t!==i.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.getActors().some(t=>t.uid===e)}getImageData(e){const t=this.getDefaultActor();if(!t)return;const{uid:n}=t;e=e??n;const r=this.getActor(e);if(!(0,f.actorIsA)(r,"vtkVolume"))return;const i=r.actor,o=s.ZP.getVolume(e),a=i.getMapper().getInputData();return{dimensions:a.getDimensions(),spacing:a.getSpacing(),origin:a.getOrigin(),direction:a.getDirection(),scalarData:a.getPointData().getScalars().isDeleted()?null:a.getPointData().getScalars().getData(),imageData:i.getMapper().getInputData(),metadata:{Modality:o?.metadata?.Modality},scaling:o?.scaling,hasPixelSpacing:!0}}_setVolumeActors(e){for(let t=0;t<e.length;t++)this.viewportProperties.invert=!1;this.setActors(e)}_getOrientationVectors(e){if("object"==typeof e){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}if("string"==typeof e&&l.MPR_CAMERA_VALUES[e])return this.viewportProperties.orientation=e,l.MPR_CAMERA_VALUES[e];throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(l.MPR_CAMERA_VALUES).join(", ")}`)}getSlabThickness(){const e=this.getActors();let t=l.RENDERING_DEFAULTS.MINIMUM_SLAB_THICKNESS;return e.forEach(e=>{e.slabThickness>t&&(t=e.slabThickness)}),t}getIntensityFromWorld(e){const t=this.getDefaultActor();if(!(0,f.actorIsA)(t,"vtkVolume"))return;const{actor:n,uid:r}=t,i=n.getMapper().getInputData(),o=s.ZP.getVolume(r),{dimensions:a}=o,l=(0,b.Z)(i,e),c=l[2]*a[0]*a[1]+l[1]*a[0]+l[0];return o.getScalarData()[c]}getVolumeId(e){const t=this.getActors();if(t)return e?.volumeId?t.find(t=>"vtkVolume"===t.actor.getClassName()&&t.uid===e.volumeId)?.uid:t.find(e=>"vtkVolume"===e.actor.getClassName())?.uid}getReferenceId(e={}){let{volumeId:t,sliceIndex:n}=e;if(!t){const e=this.getActors();if(!e)return;t=e.find(e=>"vtkVolume"===e.actor.getClassName())?.uid}const r=this.getSliceIndex();n??=r;const{viewPlaneNormal:i,focalPoint:o}=this.getCamera(),a=t.indexOf("?")>-1?"&":"?";return`volumeId:${t}${a}sliceIndex=${n}&viewPlaneNormal=${i.join(",")}&focalPoint=${o.join(",")}`}}const T=E},40046:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});class r{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,t){this.transferFunction[e]=t}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const t=this.transferFunction[0];return[t.getRedValue(e),t.getGreenValue(e),t.getBlueValue(e),this.opacity]}}class i{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class o{constructor(e,t){this.canvasProperties=new r(this),this.visibility=!1,this.mapper=new i(this),this.className="CanvasActor",this.derivedImage=t,this.viewport=e}renderRLE(e,t,n){const{width:r,height:i}=this.image;let{canvas:o}=this;o&&o.width===r&&o.height===i||(this.canvas=o=new window.OffscreenCanvas(r,i));const a=o.getContext("2d"),s=a.createImageData(r,i),{data:l}=s;l.fill(0);const{map:c}=n;let u=1/0,d=1/0,p=-1/0,h=-1/0;for(let e=0;e<i;e++){const t=c.getRun(e,0);if(!t)continue;d=Math.min(d,e),h=Math.max(h,e);const n=e*r<<2;let i;for(const e of t){const{start:r,end:o,value:a}=e;if(0===a){i||=[],i.push(t.indexOf(e));continue}u=Math.min(u,r),p=Math.max(p,o);const s=this.canvasProperties.getColor(a).map(e=>255*e);let c=n+(r<<2);for(let e=r;e<o;e++)l[c++]=s[0],l[c++]=s[1],l[c++]=s[2],l[c++]=s[3]}}if(u>r)return;const f=p-u,m=h-d;a.putImageData(s,0,0,u-1,d-1,f+2,m+2),t.drawImage(o,u,d,f,m,u,d,f,m)}render(e,t){if(!this.visibility)return;const n=this.image||this.getImage(),{width:r,height:i}=n,o=n.getScalarData();if(!o)return;const{voxelManager:a}=n;if(a&&a.map.getRun)return this.renderRLE(e,t,a);let{canvas:s}=this;s&&s.width===r&&s.height===i||(this.canvas=s=new window.OffscreenCanvas(r,i));const l=s.getContext("2d"),c=l.createImageData(r,i),{data:u}=c;let d=0,p=0,h=1/0,f=1/0,m=-1/0,g=-1/0;for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=o[d++];if(n){h=Math.min(t,h),f=Math.min(e,f),m=Math.max(t,m),g=Math.max(e,g);const r=this.canvasProperties.getColor(n);u[p]=255*r[0],u[p+1]=255*r[1],u[p+2]=255*r[2],u[p+3]=127}p+=4}if(h>r)return;const v=m-h+1,y=g-f+1;l.putImageData(c,0,0,h,f,v,y),t.drawImage(s,h,f,v,y,h,f,v,y)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:t=>e.imageData.worldToIndex(t),indexToWorld:(t,n)=>e.imageData.indexToWorld(t,n),getDimensions:()=>e.dimensions,getScalarData:()=>this.derivedImage?.getPixelData(),getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:e=>{this.derivedImage=e,this.image=null},modified:()=>null}),this.image}}},98715:(e,t,n)=>{"use strict";n.d(t,{Z:()=>F});var r=n(54131),i=n(8455),o=n(34535),a=n(5193),s=n(31239),l=n(78639),c=n(7965),u=n(72076),d=n(74238),p=n(30023),h=n(11677),f=n.n(h),m=n(11723),g=n(77614),v=n(43877),y=n(14569),b=n(7187),C=n(62990),w=n(96506),E=n(77327),T=n(62705),x=n(94222),_=n(48467),S=n(34343),I=n(82253),D=n(28719),A=n(27654),P=n(16159),O=n(54526),R=n(14419),M=n(22982),N=n(30742),L=n(40589);class k extends g.Z{constructor(e){super(e),this.imagesLoader=this,this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.useNativeDataType=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&(0,S.Z)(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=e=>this.getImagePlaneReferenceData(e)?.FrameOfReferenceUID,this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=e=>{const t=l.ZP.newInstance();t.setInputData(e);const n=c.ZP.newInstance();n.setMapper(t);const{preferSizeOverAccuracy:r}=(0,D.P_)().rendering;return r&&t.setPreferSizeOverAccuracy(!0),e.getPointData().getNumberOfComponents()>1&&n.getProperty().setIndependentComponents(!1),n},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=e=>{let t;return void 0!==e&&(t=this.perImageIdDefaultProperties.get(e)),void 0!==t?t:{...this.globalDefaultProperties,rotation:this.getRotation()}},this.getProperties=()=>{const{colormap:e,voiRange:t,VOILUTFunction:n,interpolationType:r,invert:i,voiUpdatedWithSetProperties:o}=this;return{colormap:e,voiRange:t,VOILUTFunction:n,interpolationType:r,invert:i,rotation:this.getRotation(),isComputedVOI:!o}},this.getRotationCPU=()=>{const{viewport:e}=this._cpuFallbackEnabledElement;return e.rotation},this.getRotationGPU=()=>{const{viewUp:e,viewPlaneNormal:t,flipVertical:n}=this.getCamera(),r=n?u.R3.negate(u.R3.create(),this.initialViewUp):this.initialViewUp,i=180*u.R3.angle(r,e)/Math.PI,o=u.R3.cross(u.R3.create(),r,e);return u.R3.dot(o,t)>=0?i:(360-i)%360},this.setRotation=e=>{const t=this.getCamera();if(this.useCPURendering?this.setRotationCPU(e):this.setRotationGPU(e),this._suppressCameraModifiedEvents)return;const n={previousCamera:t,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:e};(0,m.triggerEvent)(this.element,b.Events.CAMERA_MODIFIED,n)},this.renderImageObject=e=>{this._setCSImage(e);(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,e)},this._setCSImage=e=>{e.isPreScaled=e.preScale?.scaled,this.csImage=e},this.canvasToWorldCPU=(e,t=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[n,r]=(0,T.Z)(this._cpuFallbackEnabledElement,e),{origin:i,spacing:o,direction:a}=this.getImageData(),s=a.slice(0,3),l=a.slice(3,6);return u.R3.scaleAndAdd(t,i,s,n*o[0]),u.R3.scaleAndAdd(t,t,l,r*o[1]),t},this.worldToCanvasCPU=e=>{const{spacing:t,direction:n,origin:r}=this.getImageData(),i=n.slice(0,3),o=n.slice(3,6),a=u.R3.subtract(u.R3.create(),e,r),s=[u.R3.dot(a,i)/t[0],u.R3.dot(a,o)/t[1]];return(0,_.Z)(this._cpuFallbackEnabledElement,s)},this.canvasToWorldGPU=e=>{const t=this.getRenderer(),n=this.getVtkActiveCamera(),r=n.getClippingRange(),i=n.getDistance();n.setClippingRange(i,i+.1);const o=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),a=o.getSize(),s=window.devicePixelRatio||1,l=[e[0]*s,e[1]*s],c=[l[0]+this.sx,l[1]+this.sy];c[1]=a[1]-c[1];const u=o.displayToWorld(c[0],c[1],0,t);return n.setClippingRange(r[0],r[1]),[u[0],u[1],u[2]]},this.worldToCanvasGPU=e=>{const t=this.getRenderer(),n=this.getVtkActiveCamera(),r=n.getClippingRange(),i=n.getDistance();n.setClippingRange(i,i+.1);const o=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),a=o.getSize(),s=o.worldToDisplay(...e,t);s[1]=a[1]-s[1];const l=[s[0]-this.sx,s[1]-this.sy];n.setClippingRange(r[0],r[1]);const c=window.devicePixelRatio||1;return[l[0]/c,l[1]/c]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=()=>this.imageIds[this.currentImageIdIndex],this.hasImageId=e=>this.imageIds.includes(e),this.hasImageURI=e=>{const t=this.imageIds;for(let n=0;n<t.length;n++)if((0,m.imageIdToURI)(t[n])===e)return!0;return!1},this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?((0,y.Z)(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(e=!0,t=!0)=>(this.resetCameraCPU(e,t),!0),gpu:(e=!0,t=!0)=>(this.resetCameraGPU(e,t),!0)},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:this.canvasToWorldGPU},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:this.worldToCanvasGPU},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:super.getRenderer},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=(0,D.L_)(),this.useNativeDataType=this._shouldUseNativeDataType(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.imageIds=[],this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.cameraFocalPointOnRender=[0,0,0],this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return(0,D.L_)()}_configureRenderingPipeline(e){this.useNativeDataType=this._shouldUseNativeDataType(),this.useCPURendering=e??(0,D.L_)();for(const[e,t]of Object.entries(this.renderingPipelineFunctions))this[e]=this.useCPURendering?t.cpu:t.gpu;this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new N.w,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),t=o.ZP.newInstance();e.setActiveCamera(t);const n=[0,0,-1];this.initialViewUp=[0,-1,0],t.setDirectionOfProjection(-n[0],-n[1],-n[2]),t.setViewUp(...this.initialViewUp),t.setParallelProjection(!0),t.setThicknessFromFocalPoint(.1),t.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){d.Z.addEventListener(b.Events.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),d.Z.removeEventListener(b.Events.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e)return;if(!(0,m.isImageActor)(e))return;const{actor:t}=e,n=t.getMapper().getInputData();return{dimensions:n.getDimensions(),spacing:n.getSpacing(),origin:n.getOrigin(),direction:n.getDirection(),scalarData:n.getPointData().getScalars().getData(),imageData:t.getMapper().getInputData(),metadata:{Modality:this.modality},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...this.csImage.calibration,...this.calibration},preScale:{...this.csImage.preScale}}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement,t=e.spacing;return{dimensions:e.dimensions,spacing:t,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>t,worldToIndex:e=>{const t=this.worldToCanvasCPU(e),n=(0,T.Z)(this._cpuFallbackEnabledElement,t);return[n[0],n[1],0]},indexToWorld:(e,t)=>{const n=(0,_.Z)(this._cpuFallbackEnabledElement,[e[0],e[1]]);return this.canvasToWorldCPU(n,t)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...this.csImage.calibration,...this.calibration},preScale:{...this.csImage.preScale}}}buildMetadata(e){const t=e.imageId,{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:o,photometricInterpretation:a,samplesPerPixel:s}=p.get("imagePixelModule",t),{windowWidth:l,windowCenter:c,voiLUTFunction:u}=e,{modality:d}=p.get("generalSeriesModule",t),h=p.get("scalingModule",t),f=p.get(b.MetadataModules.CALIBRATION,t);"PT"===d&&h&&this._addScalingToViewport(h),this.modality=d;const m=this._getValidVOILUTFunction(u);this.VOILUTFunction=m,this.calibration=f;let g=this._getImagePlaneModule(t);return this.useCPURendering||(g=this.calibrateIfNecessary(t,g)),{imagePlaneModule:g,imagePixelModule:{bitsAllocated:r,bitsStored:i,samplesPerPixel:s,highBit:o,photometricInterpretation:a,pixelRepresentation:n,windowWidth:l,windowCenter:c,modality:d,voiLUTFunction:m}}}calibrateIfNecessary(e,t){const n=p.get("calibratedPixelSpacing",e),r=this.calibration!==n,{scale:i}=n||{};return this.hasPixelSpacing=i>0||t.rowPixelSpacing>0,t.calibration=n,r?(this.calibration=n,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:i,calibration:n},t):t}setDefaultProperties(e,t){null==t?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(t,e),this.getCurrentImageId()===t&&this.setProperties(e))}clearDefaultProperties(e){null==e?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:t,VOILUTFunction:n,invert:r,interpolationType:i,rotation:o}={},a=!1){if(this.viewportStatus=this.csImage?b.ViewportStatus.PRE_RENDER:b.ViewportStatus.LOADING,null==this.globalDefaultProperties&&this.setDefaultProperties({colormap:e,voiRange:t,VOILUTFunction:n,invert:r,interpolationType:i,rotation:o}),void 0!==e&&this.setColormap(e),void 0!==t){const e=!0;this.setVOI(t,{suppressEvents:a,voiUpdatedWithSetProperties:e})}void 0!==n&&this.setVOILUTFunction(n,a),void 0!==r&&this.setInvertColor(r),void 0!==i&&this.setInterpolationType(i),void 0!==o&&this.getRotation()!==o&&this.setRotation(o)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=b.ViewportStatus.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;e=this._isCurrentImagePTPrescaled()?this._getDefaultPTPrescaledVOIRange():this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(b.InterpolationType.LINEAR),0!==this.getRotation()&&this.setRotation(0);const t=this.getTransferFunction();(0,O.setTransferFunctionNodes)(t,this.initialTransferFunctionNodes);const n=(0,O.getTransferFunctionNodes)(t).reduce((e,t)=>(e.push(t[0],t[1],t[2],t[3]),e),[]),r=this.getDefaultActor(),i=(0,L.findMatchingColormap)(n,r.actor);this.setColormap(i)}resetToDefaultProperties(){this.cpuRenderingInvalidated=!0,this.viewportStatus=b.ViewportStatus.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),t=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;let n;t.colormap?.name&&this.setColormap(t.colormap),n=null==t.voiRange?this._getVOIRangeForCurrentImage():t.voiRange,this.setVOI(n),0!==this.getRotation()&&this.setRotation(0),this.setInterpolationType(b.InterpolationType.LINEAR),this.setInvertColor(!1),this.render()}_setPropertiesFromCache(){const{interpolationType:e,invert:t}=this;let n;n=this.voiUpdatedWithSetProperties?this.voiRange:this._isCurrentImagePTPrescaled()?this._getDefaultPTPrescaledVOIRange():this._getVOIRangeForCurrentImage()??this.voiRange,this.setVOI(n),this.setInterpolationType(e),this.setInvertColor(t)}getCameraCPU(){const{metadata:e,viewport:t}=this._cpuFallbackEnabledElement,{direction:n}=e,r=n.slice(6,9).map(e=>-e);let i=n.slice(3,6).map(e=>-e);if(t.rotation){const e=u._E.fromRotation(u._E.create(),t.rotation*Math.PI/180,r);i=u.R3.transformMat4(u.R3.create(),i,e)}const o=[this.element.clientWidth/2,this.element.clientHeight/2],a=this.canvasToWorld(o),s=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]);return{parallelProjection:!0,focalPoint:a,position:[0,0,0],parallelScale:u.R3.distance(s,l)/2,scale:t.scale,viewPlaneNormal:[r[0],r[1],r[2]],viewUp:[i[0],i[1],i[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:t,image:n}=this._cpuFallbackEnabledElement,r=this.getCameraCPU(),{focalPoint:i,parallelScale:o,scale:a,flipHorizontal:s,flipVertical:l}=e,{clientHeight:c}=this.element;if(i){const e=this.worldToCanvasCPU(i),n=(0,T.Z)(this._cpuFallbackEnabledElement,e),o=this.worldToCanvasCPU(r.focalPoint),a=(0,T.Z)(this._cpuFallbackEnabledElement,o),s=u.K4.create();u.K4.subtract(s,u.K4.fromValues(n[0],n[1]),u.K4.fromValues(a[0],a[1]));const l=(0,R.Z)({x:s[0],y:s[1]},t);t.translation.x-=l.x,t.translation.y-=l.y}if(o){const{rowPixelSpacing:e}=n,r=c*e*.5/o;t.scale=r,t.parallelScale=o}if(a){const{rowPixelSpacing:e}=n;t.scale=a,t.parallelScale=c*e*.5/a}void 0===s&&void 0===l||this.setFlipCPU({flipHorizontal:s,flipVertical:l}),this._cpuFallbackEnabledElement.transform=(0,E.Z)(this._cpuFallbackEnabledElement);const d={previousCamera:r,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:this.getRotation()};(0,m.triggerEvent)(this.element,b.Events.CAMERA_MODIFIED,d)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const t=this.getCameraCPU();this.setCameraCPU({...t,focalPoint:[...e.map(e=>-e),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const t=this.getCameraCPU();this.setCameraCPU({...t,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:t}){const{viewport:n}=this._cpuFallbackEnabledElement;void 0!==e&&(n.hflip=e,this.flipHorizontal=n.hflip),void 0!==t&&(n.vflip=t,this.flipVertical=n.vflip)}setVOILUTFunction(e,t){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const n=this._getValidVOILUTFunction(e);let r=!1;this.VOILUTFunction!==n&&(r=!0),this.VOILUTFunction=n;const{voiRange:i}=this.getProperties();this.setVOI(i,{suppressEvents:t,forceRecreateLUTFunction:r})}setRotationCPU(e){const{viewport:t}=this._cpuFallbackEnabledElement;t.rotation=e}setRotationGPU(e){const t=this.getPan(this.fitToCanvasCamera),n=this.getPan(),r=u.K4.sub([0,0],t,n);this.setPan(r,!1);const{flipVertical:i}=this.getCamera(),o=i?u.R3.negate(u.R3.create(),this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:o}),this.getVtkActiveCamera().roll(-e);const a=this.getPan(),s=this.getPan(this.fitToCanvasCamera),l=u.K4.sub([0,0],a,s),c=u.K4.add([0,0],t,l);this.setPan(c,!1)}setInterpolationTypeGPU(e){const t=this.getDefaultActor();if(!t)return;if(!(0,m.isImageActor)(t))return;const{actor:n}=t;n.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:t}=this._cpuFallbackEnabledElement;t.pixelReplication=e!==b.InterpolationType.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:t}=this._cpuFallbackEnabledElement;t&&(t.invert=e,this.invert=e)}setInvertColorGPU(e){const t=this.getDefaultActor();if(t&&(0,m.isImageActor)(t))if((0,m.actorIsA)(t,"vtkVolume")){const n=t.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&(0,m.invertRgbTransferFunction)(n),this.invert=e}else if((0,m.actorIsA)(t,"vtkImageSlice")){const n=t.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&(0,m.invertRgbTransferFunction)(n),this.invert=e}}setVOICPU(e,t={}){const{suppressEvents:n=!1}=t,{viewport:r,image:i}=this._cpuFallbackEnabledElement;if(!r||!i)return;if(void 0===e){const{windowWidth:t,windowCenter:n}=i,o=Array.isArray(t)?t[0]:t,a=Array.isArray(n)?n[0]:n;r.voi={windowWidth:o,windowCenter:a};const{lower:s,upper:l}=m.windowLevel.toLowHighRange(o,a);e={lower:s,upper:l}}else{const{lower:t,upper:n}=e,{windowCenter:i,windowWidth:o}=m.windowLevel.toWindowLevel(t,n);r.voi||(r.voi={windowWidth:0,windowCenter:0}),r.voi.windowWidth=o,r.voi.windowCenter=i}this.voiRange=e;const o={viewportId:this.id,range:e};n||(0,m.triggerEvent)(this.element,b.Events.VOI_MODIFIED,o)}getTransferFunction(){const e=this.getDefaultActor();if(!e)return;if(!(0,m.isImageActor)(e))return;return e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,t={}){const{suppressEvents:n=!1,forceRecreateLUTFunction:r=!1,voiUpdatedWithSetProperties:i=!1}=t;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!r&&!this.stackInvalidated)return;const o=this.getDefaultActor();if(!o)return;if(!(0,m.isImageActor)(o))return;const a=o.actor;let s=e;if(void 0===s){const e=a.getMapper().getInputData().getPointData().getScalars().getRange();s={lower:e[0],upper:e[1]}}a.getProperty().setUseLookupTableScalarRange(!0);let l=a.getProperty().getRGBTransferFunction(0);const c=this.VOILUTFunction===b.VOILUTFunctionType.SAMPLED_SIGMOID;if(c||!l||r){l=(c?m.createSigmoidRGBTransferFunction:P.Z)(s),this.invert&&(0,m.invertRgbTransferFunction)(l),a.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=(0,O.getTransferFunctionNodes)(l)}if(c||l.setRange(s.lower,s.upper),this.voiRange=s,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=i),n)return;const u={viewportId:this.id,range:s,VOILUTFunction:this.VOILUTFunction};(0,m.triggerEvent)(this.element,b.Events.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:t,suvlbm:n,suvbsa:r}=e,i={};n&&(i.suvbwToSuvlbm=n/t),r&&(i.suvbwToSuvbsa=r/t),this.scaling.PT=i}_getNumCompsFromPhotometricInterpretation(e){let t=1;return"RGB"!==e&&-1===e.indexOf("YBR")&&"PALETTE COLOR"!==e||(t=3),t}getImageDataMetadata(e){const{imagePlaneModule:t,imagePixelModule:n}=this.buildMetadata(e);let r,i;r=t.rowCosines,i=t.columnCosines,null!=r&&null!=i||(r=[1,0,0],i=[0,1,0]);const o=u.R3.fromValues(r[0],r[1],r[2]),a=u.R3.fromValues(i[0],i[1],i[2]),s=u.R3.create();u.R3.cross(s,o,a);let l=t.imagePositionPatient;null==l&&(l=[0,0,0]);const c=t.columnPixelSpacing||e.columnPixelSpacing,d=t.rowPixelSpacing||e.rowPixelSpacing,p=e.columns,h=e.rows,f=e.numComps||this._getNumCompsFromPhotometricInterpretation(n.photometricInterpretation);return{bitsAllocated:n.bitsAllocated,numComps:f,origin:l,direction:[...o,...a,...s],dimensions:[p,h,1],spacing:[c,d,1],numVoxels:p*h*1,imagePlaneModule:t,imagePixelModule:n}}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const t=this.imageIds[e];if(!t)return;const n=p.get(b.MetadataModules.IMAGE_PLANE,t);if(!n)return;const{imagePositionPatient:r,frameOfReferenceUID:i}=n;let{rowCosines:o,columnCosines:a}=n;o||=[1,0,0],a||=[0,1,0];return{FrameOfReferenceUID:i,viewPlaneNormal:u.R3.cross([0,0,0],a,o),cameraFocalPoint:r,referencedImageId:t,sliceIndex:e}}_getCameraOrientation(e){const t=e.slice(6,9).map(e=>-e),n=e.slice(3,6).map(e=>-e);return{viewPlaneNormal:[t[0],t[1],t[2]],viewUp:[n[0],n[1],n[2]]}}createVTKImageData({origin:e,direction:t,dimensions:n,spacing:o,numComps:a,pixelArray:s}){const l=new s.constructor(s.length),c=r.default.newInstance({name:"Pixels",numberOfComponents:a,values:l}),u=i.ZP.newInstance();return u.setDimensions(n),u.setSpacing(o),u.setDirection(t),u.setOrigin(e),u.getPointData().setScalars(c),u}_createVTKImageData({origin:e,direction:t,dimensions:n,spacing:r,numComps:i,pixelArray:o}){this._imageData=this.createVTKImageData({origin:e,direction:t,dimensions:n,spacing:r,numComps:i,pixelArray:o})}async setStack(e,t=0){this._throwIfDestroyed(),this.imageIds=e,this.currentImageIdIndex=t,this.targetImageIdIndex=t;const n=p.get(m.imageRetrieveMetadataProvider.IMAGE_RETRIEVE_CONFIGURATION,e[t],"stack");this.imagesLoader=n?(n.create||A.RJ)(n):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=b.InterpolationType.LINEAR,this.invert=!1,this.viewportStatus=b.ViewportStatus.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const r=await this._setImageIdIndex(t),i={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:t};return(0,m.triggerEvent)(d.Z,b.Events.STACK_VIEWPORT_NEW_STACK,i),r}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,t){if(!t)return!1;const[n,r]=t.getSpacing(),[i,o]=t.getDimensions(),a=this._getImagePlaneModule(e.imageId),s=t.getDirection(),l=s.slice(0,3),c=s.slice(3,6),u=t.getPointData().getScalars().getDataType(),d=(0,m.isEqual)(n,e.columnPixelSpacing),p=(0,m.isEqual)(r,e.rowPixelSpacing);return(d||null===e.columnPixelSpacing&&1===n)&&(p||null===e.rowPixelSpacing&&1===r)&&i===e.columns&&o===e.rows&&(0,m.isEqual)(a.rowCosines,l)&&(0,m.isEqual)(a.columnCosines,c)&&(!this.useNativeDataType||u===e.getPixelData().constructor.name)}_updateVTKImageDataFromCornerstoneImage(e){let t=this._getImagePlaneModule(e.imageId).imagePositionPatient;null==t&&(t=[0,0,0]),this._imageData.setOrigin(t),(0,m.updateVTKImageDataWithCornerstoneImage)(this._imageData,e)}_loadAndDisplayImage(e,t){return this.useCPURendering?this._loadAndDisplayImageCPU(e,t):this._loadAndDisplayImageGPU(e,t)}_loadAndDisplayImageCPU(e,t){return new Promise((n,r)=>{function i(e,t,r){if(this.currentImageIdIndex!==t)return;const i=e.getPixelData(),o=e.preScale,a=o?.scalingParameters;if(i instanceof Float32Array&&(o?.scaled&&a?.rescaleIntercept%1!=0||a?.rescaleSlope%1!=0)){const t={min:e.maxPixelValue,max:e.minPixelValue},n=Math.abs(t.max-t.min)/65535,r=t.min,o=i.length,a=new Uint16Array(o);let s=65535,l=0;for(let e=0;e<o;e++){const t=Math.floor((i[e]-r)/n);a[e]=t,s=Math.min(s,t),l=Math.max(l,t)}e.minPixelValue=s,e.maxPixelValue=l,e.slope=n,e.intercept=r,e.getPixelData=()=>a,e.preScale={...e.preScale,scaled:!1}}this._setCSImage(e),this.viewportStatus=b.ViewportStatus.PRE_RENDER;const s={image:e,imageId:r,imageIdIndex:t,viewportId:this.id,renderingEngineId:this.renderingEngineId};(0,m.triggerEvent)(this.element,b.Events.STACK_NEW_IMAGE,s),this._updateToDisplayImageCPU(e),this.render(),this.currentImageIdIndex=t,n(r)}function o(e,t,n){const i={error:e,imageIdIndex:t,imageId:n};this.suppressEvents||(0,m.triggerEvent)(d.Z,b.Events.IMAGE_LOAD_ERROR,i),r(e)}const a=b.RequestType.Interaction,s={imageId:e,imageIdIndex:t},l={preScale:{enabled:!0},useRGBA:!0,requestType:a},c={imageId:e,imageIdIndex:t,viewportId:this.id,renderingEngineId:this.renderingEngineId};(0,m.triggerEvent)(this.element,b.Events.PRE_STACK_NEW_IMAGE,c),w.Z.addRequest(function(e,t,n){return(0,C.loadAndCacheImage)(e,n).then(n=>{i.call(this,n,t,e)},n=>{o.call(this,n,t,e)})}.bind(this,e,t,l),a,s,-5)})}successCallback(e,t){const n=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==n)return;const r=this.csImage?.imageFrame,i=t?.imageFrame;(r?.photometricInterpretation||this.csImage?.photometricInterpretation)!==(i?.photometricInterpretation||t?.photometricInterpretation)&&(this.stackInvalidated=!0),this._setCSImage(t);const o={image:t,imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(t),(0,m.triggerEvent)(this.element,b.Events.STACK_NEW_IMAGE,o),this.render(),this.currentImageIdIndex=n}errorCallback(e,t,n){if(!t)return;const r={error:n,imageIdIndex:this.imageIds.indexOf(e),imageId:e};(0,m.triggerEvent)(d.Z,b.Events.IMAGE_LOAD_ERROR,r)}getLoaderImageOptions(e){const t=this.imageIds.indexOf(e),{transferSyntaxUID:n}=p.get("transferSyntax",e)||{},r={imageId:e,imageIdIndex:t};return{targetBuffer:{type:this.useNativeDataType?void 0:"Float32Array"},preScale:{enabled:!0},useRGBA:!1,transferSyntaxUID:n,useNativeDataType:this.useNativeDataType,priority:5,requestType:b.RequestType.Interaction,additionalDetails:r}}async loadImages(e,t){const n=await Promise.allSettled(e.map(e=>{const n=this.getLoaderImageOptions(e);return(0,C.loadAndCacheImage)(e,n).then(n=>(t.successCallback(e,n),e),n=>(t.errorCallback(e,!0,n),e))})),r=n.filter(e=>"rejected"===e.status);if(r&&r.length){const e=new CustomEvent(b.Events.IMAGE_LOAD_ERROR,{detail:r,cancelable:!0});d.Z.dispatchEvent(e)}return n}_loadAndDisplayImageGPU(e,t){const n={imageId:e,imageIdIndex:t,viewportId:this.id,renderingEngineId:this.renderingEngineId};return(0,m.triggerEvent)(this.element,b.Events.PRE_STACK_NEW_IMAGE,n),this.imagesLoader.loadImages([e],this).then(t=>e)}_updateToDisplayImageCPU(e){const t=this.getImageDataMetadata(e),n=(0,x.Z)(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:r,windowWidth:i}=n.voi;this.voiRange=m.windowLevel.toLowHighRange(i,r),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...t},this.cpuImagePixelData=e.getPixelData();const o=Object.assign({},n,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?n:o,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=(0,E.Z)(this._cpuFallbackEnabledElement)}addImages(e){const t=this.getActors();e.forEach(e=>{const n=I.ZP.getImage(e.imageId),{origin:r,dimensions:i,direction:o,spacing:a,numComps:s}=this.getImageDataMetadata(n),l=this.createVTKImageData({origin:r,dimensions:i,direction:o,spacing:a,numComps:s,pixelArray:n.getPixelData()}),c=this.createActorMapper(l);c&&(t.push({uid:e.actorUID,actor:c}),e.callback&&e.callback({imageActor:c,imageId:e.imageId}))}),this.setActors(t)}_updateActorToDisplayImageId(e){const t=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),n=this.getRenderer().getActiveCamera(),r=f()(this.getCamera());if(t&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e);const t=this.getCamera(),i=u.R3.subtract(u.R3.create(),this.cameraFocalPointOnRender,t.focalPoint);this.resetCameraNoEvent(),this.setCameraNoEvent({flipHorizontal:r.flipHorizontal,flipVertical:r.flipVertical,viewUp:r.viewUp});const{focalPoint:o}=this.getCamera();return this.cameraFocalPointOnRender=o,n.setFreezeFocalPoint(!0),this._restoreCameraProps(t,r,i),this._setPropertiesFromCache(),void(this.stackActorReInitialized=!1)}const{origin:i,direction:o,dimensions:a,spacing:s,numComps:l,imagePixelModule:c}=this.getImageDataMetadata(e),d=e.getPixelData();this._createVTKImageData({origin:i,direction:o,dimensions:a,spacing:s,numComps:l,pixelArray:d}),this._updateVTKImageDataFromCornerstoneImage(e);const p=this.createActorMapper(this._imageData),h=this.getActors();h.length&&h[0].uid===this.id?h[0].actor=p:h.unshift({uid:this.id,actor:p}),this.setActors(h);const{viewPlaneNormal:m,viewUp:g}=this._getCameraOrientation(o);this.setCameraNoEvent({viewUp:g,viewPlaneNormal:m}),this.initialViewUp=g,this.resetCameraNoEvent(),this.triggerCameraEvent(this.getCamera(),r),n.setFreezeFocalPoint(!0);const v="MONOCHROME1"===c.photometricInterpretation;this.stackInvalidated=!0,this.setVOI(this._getInitialVOIRange(e),{forceRecreateLUTFunction:!!v}),this.initialInvert=!!v,this.setInvertColor(this.invert||this.initialInvert),this.cameraFocalPointOnRender=this.getCamera().focalPoint,this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.globalDefaultProperties.voiRange;const{windowCenter:t,windowWidth:n}=e;let r=this._getVOIRangeFromWindowLevel(n,t);return r=this._getPTPreScaledRange()||r,r}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){return!("PT"!==this.modality||!this.csImage.isPreScaled)&&!!this.csImage.preScale?.scalingParameters?.suvbw}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,t){let n,r;if("number"==typeof t&&"number"==typeof e?(n=t,r=e):Array.isArray(t)&&Array.isArray(e)&&(n=t[0],r=e[0]),void 0!==n&&void 0!==r)return m.windowLevel.toLowHighRange(r,n)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=b.ViewportStatus.PRE_RENDER;const t=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const e=this.perImageIdDefaultProperties.get(t);void 0!==e?this.setProperties(e):void 0!==this.globalDefaultProperties&&this.setProperties(this.globalDefaultProperties)}return t}resetCameraCPU(e,t){const{image:n}=this._cpuFallbackEnabledElement;if(!n)return;(0,M.Z)(this._cpuFallbackEnabledElement,e,t);const{scale:r}=this._cpuFallbackEnabledElement.viewport,{clientWidth:i,clientHeight:o}=this.element,a=[i/2,o/2],s=this.canvasToWorldCPU(a);this.setCameraCPU({focalPoint:s,scale:r})}resetCameraGPU(e,t){this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp});return super.resetCamera(e,t,!0)}scroll(e,t=!0,n=!1){const r=this.imageIds,i=this.targetImageIdIndex,o=r.length;let a=i+e;a=Math.max(0,a),n?a%=o:a=Math.min(o-1,a),this.targetImageIdIndex=a;const s=r[a];I.ZP.isLoaded(s)||!t?this.setImageIdIndex(a):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(a)},40));const l={newImageIdIndex:a,imageId:s,direction:e};a!==i&&(0,m.triggerEvent)(this.element,b.Events.STACK_VIEWPORT_SCROLL,l)}setImageIdIndex(e){if(this._throwIfDestroyed(),this.currentImageIdIndex===e)return Promise.resolve(this.getCurrentImageId());return this._setImageIdIndex(e)}calibrateSpacing(e){const t=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,t)}_restoreCameraProps({parallelScale:e},t,n){const r=this.getRenderer(),{position:i,focalPoint:o}=this.getCamera(),a=u.R3.subtract(u.R3.create(),i,n),s=u.R3.subtract(u.R3.create(),o,n);this.setCameraNoEvent({parallelScale:e,position:a,focalPoint:s});const l=this.getCamera();this.triggerCameraEvent(l,t);const c={type:"ResetCameraEvent",renderer:r};r.invokeEvent(c)}triggerCameraEvent(e,t){const n={previousCamera:t,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||(0,m.triggerEvent)(this.element,b.Events.CAMERA_MODIFIED,n)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),t={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||(0,m.triggerEvent)(this.element,b.Events.IMAGE_SPACING_CALIBRATED,t),this._publishCalibratedEvent=!1}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:t}=this.csImage;return this._getVOIRangeFromWindowLevel(t,e)}_getValidVOILUTFunction(e){return-1===Object.values(b.VOILUTFunctionType).indexOf(e)&&(e=b.VOILUTFunctionType.LINEAR),e}isReferenceViewable(e,t={}){if(!super.isReferenceViewable(e,t))return!1;let{imageURI:n}=t;const{referencedImageId:r,sliceIndex:i}=e;if(e.volumeId&&!r)return!0===t.asVolume;let o=this.getCurrentImageIdIndex();t.withNavigation&&"number"==typeof i&&(o=i);const a=this.imageIds[o];if(!a)return!1;if(!n){const e=a.indexOf(":");n=a.substring(e+1)}return r?.endsWith(n)}getViewReference(e={}){const{sliceIndex:t=this.getCurrentImageIdIndex()}=e,n=super.getViewReference(e),r=this.imageIds[t];if(r){if(n.referencedImageId=r,this.getCurrentImageIdIndex()!==t){const e=this.getImagePlaneReferenceData(t);if(!e)return;Object.assign(n,e)}return n}}setViewReference(e){if(!e)return;const{referencedImageId:t,sliceIndex:n,volumeId:r}=e;if("number"==typeof n&&t&&t===this.imageIds[n])this.setImageIdIndex(n);else{const e=this.imageIds.indexOf(t);if(-1===e)throw new Error("Unsupported - referenced image id not found");this.setImageIdIndex(e)}}getReferenceId(e={}){const{sliceIndex:t=this.currentImageIdIndex}=e;if(Array.isArray(t))throw new Error("Use of slice ranges for stacks not supported");return`imageId:${this.imageIds[t]}`}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const t=(0,v.yP)(e.name,e);this._cpuFallbackEnabledElement.viewport.colormap=t,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const n={viewportId:this.id,colormap:e};(0,m.triggerEvent)(this.element,b.Events.COLORMAP_MODIFIED,n)}setColormapGPU(e){const t=this.getDefaultActor().actor.getProperty(),n=t.getRGBTransferFunction(),r=m.colormap.getColormap(e.name)||s.Z.getPresetByName(e.name);if(n)n.applyColorMap(r),n.setMappingRange(this.voiRange.lower,this.voiRange.upper),t.setRGBTransferFunction(0,n);else{const e=a.ZP.newInstance();e.applyColorMap(r),e.setMappingRange(this.voiRange.lower,this.voiRange.upper),t.setRGBTransferFunction(0,e)}this.colormap=e,this.render();const i={viewportId:this.id,colormap:e};(0,m.triggerEvent)(this.element,b.Events.COLORMAP_MODIFIED,i)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){const t=p.get(b.MetadataModules.IMAGE_PLANE,e);this.calibration||=t.calibration;const n={...t};return n.columnPixelSpacing||(n.columnPixelSpacing=1,this.hasPixelSpacing=this.calibration?.scale>0),n.rowPixelSpacing||(n.rowPixelSpacing=1,this.hasPixelSpacing=this.calibration?.scale>0),n.columnCosines||(n.columnCosines=[0,1,0]),n.rowCosines||(n.rowCosines=[1,0,0]),n.imagePositionPatient||(n.imagePositionPatient=[0,0,0]),n.imageOrientationPatient||(n.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),n}}const F=k},77614:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(45802),i=n(32899),o=n(3969),a=n(72076),s=n(11677),l=n.n(s),c=n(19546),u=n(84659),d=n(68032),p=n(90872),h=n(11723),f=n(1483),m=n(48588),g=n(28719),v=n(7187);class y{static{this.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0}}static{this.TransferViewPresentation={windowLevel:!0,paletteLut:!0}}constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=u.Z.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=e=>{},this.viewportWidgets=new Map,this.addWidget=(e,t)=>{this.viewportWidgets.set(e,t)},this.getWidget=e=>this.viewportWidgets.get(e),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(e=>{if(e.getEnabled()&&e.setEnabled(!1),e.getActor&&e.getRenderer){const t=e.getActor(),n=e.getRenderer();n&&t&&n.removeActor(t)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=l()(e.defaultOptions),this.suppressEvents=!!e.defaultOptions.suppressEvents&&e.defaultOptions.suppressEvents,this.options=l()(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus!==u.Z.NO_DATA&&this.viewportStatus!==u.Z.LOADING&&(this.viewportStatus=u.Z.RENDERED)}getRenderingEngine(){return p.Z.get(this.renderingEngineId)}getRenderer(){const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return e.offscreenMultiRenderWindow.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,t=!1){this.options=l()(e),this.options?.displayArea&&this.setDisplayArea(this.options?.displayArea),t&&this.render()}reset(e=!1){this.options=l()(this.defaultOptions),e&&this.render()}flip({flipHorizontal:e,flipVertical:t}){const n=this.getDefaultImageData();if(!n)return;const r=this.getCamera(),{viewPlaneNormal:i,viewUp:o,focalPoint:s,position:l}=r,c=a.R3.cross(a.R3.create(),i,o);let u=a.R3.copy(a.R3.create(),o);const d=a.R3.negate(a.R3.create(),i),p=a.R3.distance(l,s),h=n.getDimensions().map(e=>Math.floor(e/2)),f=[h[0],h[1],h[2]],m=n.indexToWorld(f,a.R3.create()),g=this._getFocalPointForResetCamera(m,r,{resetPan:!0,resetToCenter:!1}),v=a.R3.subtract(a.R3.create(),s,g),y=a.R3.length(v),b=e=>{const t=a.R3.scale(a.R3.create(),e,2*a.R3.dot(v,e));return a.R3.subtract(t,t,v),a.R3.normalize(t,t),t};if(e){const e=b(u),t=a.R3.scaleAndAdd(a.R3.create(),g,e,y),n=a.R3.scaleAndAdd(a.R3.create(),t,d,p);this.setCamera({viewPlaneNormal:d,position:n,focalPoint:t}),this.flipHorizontal=!this.flipHorizontal}if(t){u=a.R3.negate(u,o);const e=b(c),t=a.R3.scaleAndAdd(a.R3.create(),g,e,y),n=a.R3.scaleAndAdd(a.R3.create(),t,d,p);this.setCamera({focalPoint:t,viewPlaneNormal:d,viewUp:u,position:n}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&(0,h.isImageActor)(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getActorUIDByIndex(e){const t=this.getActors()[e];if(t)return t.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors();this.addActors(e,!0)}_removeActor(e){const t=this.getActor(e);if(!t)return void console.warn(`Actor ${e} does not exist for this viewport`);this.getRenderer().removeViewProp(t.actor),this._actors.delete(e)}removeActors(e){e.forEach(e=>{this._removeActor(e)})}addActors(e,t=!1){const n=this.getRenderingEngine();n&&!n.hasBeenDestroyed?(e.forEach(e=>this.addActor(e)),this.resetCamera(t,t)):console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed")}addActor(e){const{uid:t,actor:n}=e,r=this.getRenderingEngine();if(!r||r.hasBeenDestroyed)return void console.warn(`Cannot add actor UID of ${t} Rendering Engine has been destroyed`);if(!t||!n)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(t))return void console.warn(`Actor ${t} already exists for this viewport`);const i=this.getRenderer();i?.addActor(n),this._actors.set(t,Object.assign({},e)),this.updateCameraClippingPlanesAndRange()}removeAllActors(){this.getRenderer()?.removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,t,n){const r=n[0],i=n[1],o=n[2],a=r*t[0]+i*t[1]+o*t[2],s=e.getBounds(),l=this._getEdges(s),c=[];for(const e of l){const[[t,n,l],[u,d,p]]=e;if(r*(u-t)+i*(d-n)+o*(p-l)===0)continue;const f=h.planar.linePlaneIntersection([t,n,l],[u,d,p],[r,i,o,a]);this._isInBounds(f,s)&&c.push(f)}return c}setInterpolationType(e,t){}setDisplayArea(e,t=!1){if(!e)return;const{storeAsInitialCamera:n,type:r}=e;n&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:i}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),"SCALE"===r?this.setDisplayAreaScale(e):(this.setInterpolationType(this.getProperties()?.interpolationType||v.InterpolationType.LINEAR),this.setDisplayAreaFit(e)),n&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=i,!t&&!i){const t={viewportId:this.id,displayArea:e,storeAsInitialCamera:n};(0,h.triggerEvent)(this.element,c.Z.DISPLAY_AREA_MODIFIED,t),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:t=1}=e,n=this.canvas,r=n.height,i=n.width;if(r<8||i<8)return;const o=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(v.InterpolationType.NEAREST),this.setCamera({parallelScale:r*o/(2*t)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:s,position:l,viewUp:c,viewPlaneNormal:u}=this.getCamera(),d=a.R3.create();if(n.height%2&&a.R3.scaleAndAdd(d,d,c,.5*t*o),n.width%2){const e=a.R3.cross(a.R3.create(),c,u);a.R3.scaleAndAdd(d,d,e,.5*t*o)}(d[0]||d[1]||d[2])&&this.setCamera({focalPoint:a.R3.add(a.R3.create(),s,d),position:a.R3.add(a.R3.create(),l,d)})}setDisplayAreaFit(e){const{imageArea:t,imageCanvasPoint:n}=e,r=window?.devicePixelRatio||1,i=this.getDefaultImageData();if(!i)return;const o=this.sWidth/r,s=this.sHeight/r,l=i.getDimensions(),c=this.worldToCanvas(i.indexToWorld([0,0,0])),u=this.worldToCanvas(i.indexToWorld([l[0]-1,l[1]-1,l[2]])),d=[Math.abs(u[0]-c[0]),Math.abs(u[1]-c[1])],[p,h]=d;if(t){const[e,n]=t,r=Math.abs(e*p/o),i=Math.abs(n*h/s),a=this.getZoom(),l=this.getZoom(this.fitToCanvasCamera),c=Math.min(1/r,1/i)*a/l;this.setZoom(c,!1)}if(n){const{imagePoint:e,canvasPoint:t=e||[.5,.5]}=n,[r,i]=t,l=o*(r-.5),c=s*(i-.5),[u,d]=e||t,f=1,m=[f*p*(.5-u)+l,f*h*(.5-d)+c];a.K4.add(m,m,this.getPan()),this.setPan(m,!1)}}getDisplayArea(){return this.options?.displayArea}resetCamera(e=!0,t=!0,n=!0,r=!0){const o=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const a=l()(this.getCamera()),s=o.computeVisiblePropBounds(),c=[0,0,0],u=this.getDefaultImageData();if(u){const e=u.getSpacing();s[0]=s[0]+e[0]/2,s[1]=s[1]-e[0]/2,s[2]=s[2]+e[1]/2,s[3]=s[3]-e[1]/2,s[4]=s[4]+e[2]/2,s[5]=s[5]-e[2]/2}const p=this.getVtkActiveCamera(),h=p.getViewPlaneNormal(),f=p.getViewUp();if(c[0]=(s[0]+s[1])/2,c[1]=(s[2]+s[3])/2,c[2]=(s[4]+s[5])/2,u){const e=u.getDimensions().map(e=>Math.floor((e-1)/2)),t=[e[0],e[1],e[2]];u.indexToWorld(t,c)}const{widthWorld:g,heightWorld:v}=this._getWorldDistanceViewUpAndViewRight(s,f,h),b=[this.sWidth,this.sHeight],C=g/v/(b[0]/b[1]),w=C<1?this.insetImageMultiplier*v/2:this.insetImageMultiplier*v*C/2,E=y.boundsRadius(s)*(this.type===d.Z.VOLUME_3D?10:1),T=this.insetImageMultiplier*E,x=Math.abs(i.ZP.dot(f,h))>.999?[-f[2],f[0],f[1]]:f,_=this._getFocalPointForResetCamera(c,a,{resetPan:e,resetToCenter:n}),S=[_[0]+T*h[0],_[1]+T*h[1],_[2]+T*h[2]];o.resetCameraClippingRange(s);const I=[-m.RENDERING_DEFAULTS.MAXIMUM_RAY_DISTANCE,m.RENDERING_DEFAULTS.MAXIMUM_RAY_DISTANCE];p.setPhysicalScale(E),p.setPhysicalTranslation(-_[0],-_[1],-_[2]),this.setCamera({parallelScale:t?w:a.parallelScale,focalPoint:_,position:S,viewAngle:90,viewUp:x,clippingRange:I});const D=l()(this.getCamera());this.setFitToCanvasCamera(l()(this.getCamera())),r&&this.setInitialCamera(D),t&&this.setZoom(1,r);const A={type:"ResetCameraEvent",renderer:o};return o.invokeEvent(A),this.triggerCameraModifiedEventIfNecessary(a,D),u&&this.options?.displayArea&&t&&e&&n&&this.setDisplayArea(this.options?.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){const t=this.getVtkActiveCamera().getFocalPoint(),n=this.canvasToWorld([0,0]),r=this.worldToCanvas(a.R3.subtract([0,0,0],e.focalPoint,n)),i=this.worldToCanvas(a.R3.subtract([0,0,0],t,n));return a.K4.subtract([0,0],r,i)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getReferenceId(e){return null}setPan(e,t=!1){const n=this.getCamera(),{focalPoint:r,position:i}=n,o=this.canvasToWorld([0,0]),s=a.K4.subtract([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!t)return;const l=a.R3.subtract(a.R3.create(),this.canvasToWorld(s),o),c=a.R3.subtract(a.R3.create(),r,l),u=a.R3.subtract(a.R3.create(),i,l);this.setCamera({...n,focalPoint:c,position:u},t)}getZoom(e=this.initialCamera){if(!e)return 1;const t=this.getVtkActiveCamera(),{parallelScale:n}=e;return n/t.getParallelScale()}setZoom(e,t=!1){const n=this.getCamera(),{parallelScale:r}=this.initialCamera,i=r/e;(n.parallelScale!==i||t)&&this.setCamera({...n,parallelScale:i},t)}_getFocalPointForViewPlaneReset(e){const{focalPoint:t,viewPlaneNormal:n}=this.getCamera(),r=this._getViewImageDataIntersections(e,t,n);let i=0,o=0,a=0;r.forEach(([e,t,n])=>{i+=e,o+=t,a+=n});return[i/r.length,o/r.length,a/r.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){return this.getRenderer().getActiveCamera()}getCamera(){const e=this.getVtkActiveCamera();return{viewUp:e.getViewUp(),viewPlaneNormal:e.getViewPlaneNormal(),position:e.getPosition(),focalPoint:e.getFocalPoint(),parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCamera(e,t=!1){const n=this.getVtkActiveCamera(),r=l()(this.getCamera()),o=Object.assign({},r,e),{viewUp:a,viewPlaneNormal:s,position:c,focalPoint:u,parallelScale:p,viewAngle:f,flipHorizontal:m,flipVertical:g,clippingRange:v}=e;if(void 0!==m){const e=m&&!this.flipHorizontal||!m&&this.flipHorizontal;e&&this.flip({flipHorizontal:e})}if(void 0!==g){const e=g&&!this.flipVertical||!g&&this.flipVertical;e&&this.flip({flipVertical:e})}void 0!==a&&n.setViewUp(a),void 0!==s&&n.setDirectionOfProjection(-s[0],-s[1],-s[2]),void 0!==c&&n.setPosition(...c),void 0!==u&&n.setFocalPoint(...u),void 0!==p&&n.setParallelScale(p),void 0!==f&&n.setViewAngle(f),void 0!==v&&n.setClippingRange(v);const y=r.focalPoint,b=r.viewUp;if(y&&u||b&&a){const e=n.getViewPlaneNormal(),t=n.getViewUp();let r=!1,s=!1;if(u){const t=[u[0]-y[0],u[1]-y[1],u[2]-y[2]];r=Math.abs(i.ZP.dot(t,e))>0}if(a&&(s=!(0,h.isEqual)(t,b)),r||s){const e=this.getDefaultActor();if(!e?.actor)return;if((0,h.actorIsA)(e,"vtkActor")||this.updateClippingPlanesForActors(o),(0,h.actorIsA)(e,"vtkImageSlice")||this.type===d.Z.VOLUME_3D){this.getRenderer().resetCameraClippingRange()}}}t&&this.setInitialCamera(o),this.triggerCameraModifiedEventIfNecessary(r,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,t){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const n={previousCamera:e,camera:t,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,rotation:this.getRotation()};(0,h.triggerEvent)(this.element,c.Z.CAMERA_MODIFIED,n)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(t=>{if(!t.actor)return;const n=t.actor.getMapper();let r=t?.clippingFilter?t.clippingFilter.getClippingPlanes():n.getClippingPlanes();0===r.length&&t?.clippingFilter&&(r=[o.ZP.newInstance(),o.ZP.newInstance()]);let i=m.RENDERING_DEFAULTS.MINIMUM_SLAB_THICKNESS;t.slabThickness&&(i=t.slabThickness);const{viewPlaneNormal:a,focalPoint:s}=e;this.setOrientationOfClippingPlanes(r,i,a,s),(0,h.triggerEvent)(this.element,c.Z.CLIPPING_PLANES_UPDATED,{actorEntry:t,focalPoint:s,vtkPlanes:r,viewport:this})})}setOrientationOfClippingPlanes(e,t,n,r){if(e.length<2)return;const o=[n[0],n[1],n[2]];i.ZP.multiplyScalar(o,t),e[0].setNormal(n);const a=[0,0,0];i.ZP.subtract(r,o,a),e[0].setOrigin(a),e[1].setNormal(-n[0],-n[1],-n[2]);const s=[0,0,0];i.ZP.add(r,o,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const t=e.actor.getMapper();let n=e?.clippingFilter?e.clippingFilter.getClippingPlanes():t.getClippingPlanes();return 0===n.length&&e?.clippingFilter&&(n=[o.ZP.newInstance(),o.ZP.newInstance()]),n}_getWorldDistanceViewUpAndViewRight(e,t,n){const i=this._getCorners(e),o=this._getCorners(e),s=a.R3.cross(a.R3.create(),t,n);let l=r.Z.buildFromDegree().identity().rotateFromDirections(t,[1,0,0]);i.forEach(e=>l.apply(e));let c=1/0,u=-1/0;for(let e=0;e<8;e++){const t=i[e][0];t>u&&(u=t),t<c&&(c=t)}l=r.Z.buildFromDegree().identity().rotateFromDirections([s[0],s[1],s[2]],[1,0,0]),o.forEach(e=>l.apply(e));let d=1/0,p=-1/0;for(let e=0;e<8;e++){const t=o[e][0];t>p&&(p=t),t<d&&(d=t)}return{widthWorld:p-d,heightWorld:u-c}}getViewReference(e={}){const{focalPoint:t,viewPlaneNormal:n,viewUp:r}=this.getCamera();return{FrameOfReferenceUID:this.getFrameOfReferenceUID(),cameraFocalPoint:t,viewPlaneNormal:n,viewUp:r,sliceIndex:e.sliceIndex??this.getSliceIndex()}}isReferenceViewable(e,t){if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:n}=e,r=this.getCamera();return!(n&&!(0,h.isEqual)(n,r.viewPlaneNormal)&&!(0,h.isEqual)(a.R3.negate(r.viewPlaneNormal,r.viewPlaneNormal),n))||!0===t?.withOrientation}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0}){const t={},{rotation:n,displayArea:r,zoom:i,pan:o}=e;n&&(t.rotation=this.getRotation()),r&&(t.displayArea=this.getDisplayArea());const s=this.getZoom();return i&&(t.zoom=s),o&&(t.pan=this.getPan(),a.K4.scale(t.pan,t.pan,1/s)),t}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:t,zoom:n=this.getZoom(),pan:r,rotation:i}=e;t!==this.getDisplayArea()&&this.setDisplayArea(t),this.setZoom(n),r&&this.setPan(a.K4.scale([0,0],r,n)),i>=0&&this.setRotation(i)}_shouldUseNativeDataType(){const{useNorm16Texture:e,preferSizeOverAccuracy:t}=(0,g.P_)().rendering;return e||t}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,t,{resetPan:n=!0,resetToCenter:r=!0}){if(r&&n)return e;if(r&&!n)return(0,f.Z)(t.focalPoint)?e:t.focalPoint;if(!r&&n){const n=t,r=n.focalPoint,i=n.viewPlaneNormal,o=a.R3.subtract(a.R3.create(),e,r),s=a.R3.dot(o,i),l=a.R3.scaleAndAdd(a.R3.create(),e,i,-1*s);return[l[0],l[1],l[2]]}return n||r?void 0:(0,f.Z)(t.focalPoint)?e:t.focalPoint}_isInBounds(e,t){const[n,r,i,o,a,s]=t,[l,c,u]=e;return!(l<n||l>r||c<i||c>o||u<a||u>s)}_getEdges(e){const[t,n,r,i,o,a,s,l]=this._getCorners(e);return[[t,n],[t,o],[t,r],[n,i],[n,a],[r,i],[r,s],[i,l],[o,s],[o,a],[a,l],[s,l]]}static boundsRadius(e){const t=(e[1]-e[0])**2,n=(e[3]-e[2])**2,r=(e[5]-e[4])**2;return.5*Math.sqrt(t+n+r||1)}setDataIds(e,t){throw new Error("Unsupported operatoin setDataIds")}}const b=y},32932:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r=n(3969),i=n(82253),o=n(48588),a=n(7187),s=n(11723),l=n(36205),c=n(98230),u=n(54526),d=n(47326),p=n(72076);class h extends l.Z{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:e}=(0,d.Z)(this);return e},this.getCurrentImageIdIndex=e=>{const{viewPlaneNormal:t,focalPoint:n}=this.getCamera(),r=this.getImageData(e);if(!r)return;const{origin:i,direction:o,spacing:a}=r,l=(0,s.getSpacingInNormalDirection)({direction:o,spacing:a},t),c=p.R3.create();p.R3.sub(c,n,i);const u=p.R3.dot(c,t);return Math.round(Math.abs(u)/l)},this.getSliceIndex=()=>{const{imageIndex:e}=(0,d.Z)(this);return e},this.getCurrentImageId=()=>{const e=this.getDefaultActor();if(!e||!(0,s.actorIsA)(e,"vtkVolume"))return;const{uid:t}=e,n=i.ZP.getVolume(t);if(!n)return;const{viewPlaneNormal:r,focalPoint:o}=this.getCamera();return(0,s.getClosestImageId)(n,o,r)},this.getSlicePlaneCoordinates=()=>{const e=this.getDefaultActor();if(!e?.actor)return console.warn("No image data found for calculating vtkPlanes."),[];const t=e.uid,n=i.ZP.getVolume(t),r=this.getCamera(),{focalPoint:o,position:a,viewPlaneNormal:l}=r,c=(0,s.getSpacingInNormalDirection)(n,l),u=(0,s.getSliceRange)(e.actor,l,o),d=Math.round((u.current-u.min)/c),p=Math.round((u.max-u.current)/c),h=this.getSliceIndex(),f=[];for(let e=-d;e<=p;e++){const{newFocalPoint:t}=(0,s.snapFocalPointToSlice)(o,a,u,l,c,e);f.push({sliceIndex:h+e,point:t})}return f};const{orientation:t}=this.options;t&&t!==a.OrientationAxis.ACQUISITION?this.applyViewOrientation(t):this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,t=!1,n=!1){const r=i.ZP.getVolume(e[0].volumeId);if(!r)throw new Error(`imageVolume with id: ${r.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(r),this._useAcquisitionPlaneForViewPlane=!1),super.setVolumes(e,t,n)}async addVolumes(e,t=!1,n=!1){const r=i.ZP.getVolume(e[0].volumeId);if(!r)throw new Error(`imageVolume with id: ${r.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(r),this._useAcquisitionPlaneForViewPlane=!1),super.addVolumes(e,t,n)}setOrientation(e,t=!0){let n,r;if("string"==typeof e){if(o.MPR_CAMERA_VALUES[e])({viewPlaneNormal:n,viewUp:r}=o.MPR_CAMERA_VALUES[e]);else{if("acquisition"!==e)throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation())}this.setCamera({viewPlaneNormal:n,viewUp:r}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:n,viewUp:r}=e),this.applyViewOrientation(e);t&&this.render()}_getAcquisitionPlaneOrientation(){const e=this.getDefaultActor();if(!e)return;const t=e.uid,n=i.ZP.getVolume(t);if(!n)throw new Error(`imageVolume with id: ${t} does not exist in cache`);const{direction:r}=n;return{viewPlaneNormal:r.slice(6,9).map(e=>-e),viewUp:r.slice(3,6).map(e=>-e)}}_setViewPlaneToAcquisitionPlane(e){let t,n;if(e){const{direction:r}=e;t=r.slice(6,9).map(e=>-e),n=r.slice(3,6).map(e=>-e)}else({viewPlaneNormal:t,viewUp:n}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:t,viewUp:n}),this.initialViewUp=n,this.resetCamera()}setBlendMode(e,t=[],n=!1){let r=this.getActors();t&&t.length>0&&(r=r.filter(e=>t.includes(e.uid))),r.forEach(t=>{const{actor:n}=t,r=n.getMapper();r.setBlendMode?.(e)}),n&&this.render()}resetCamera(e=!0,t=!0,n=!0,i=!1,l=!1){const{orientation:c}=this.viewportProperties;c&&this.applyViewOrientation(c,!1),super.resetCamera(e,t,n),this.resetVolumeViewportClippingRange();const u=this.getVtkActiveCamera(),d=u.getViewPlaneNormal(),p=u.getFocalPoint();if(this.getActors().forEach(e=>{if(!e.actor)return;const t=e.actor.getMapper();if(0===t.getClippingPlanes().length&&!e?.clippingFilter){const n=r.ZP.newInstance(),i=r.ZP.newInstance(),a=[n,i];let s=o.RENDERING_DEFAULTS.MINIMUM_SLAB_THICKNESS;e.slabThickness&&(s=e.slabThickness),this.setOrientationOfClippingPlanes(a,s,d,p),t.addClippingPlane(n),t.addClippingPlane(i)}}),i&&void 0!==o.MPR_CAMERA_VALUES[this.viewportProperties.orientation]){const e=o.MPR_CAMERA_VALUES[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:e.viewUp,viewPlaneNormal:e.viewPlaneNormal})}if(!l){const e={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};(0,s.triggerEvent)(this.element,a.Events.CAMERA_RESET,e)}return!0}setSlabThickness(e,t=[]){e<.1&&(e=.1);let n=this.getActors();t&&t.length>0&&(n=n.filter(e=>t.includes(e.uid))),n.forEach(t=>{(0,s.actorIsA)(t,"vtkVolume")&&(t.slabThickness=e)});const r=this.getCamera();this.updateClippingPlanesForActors(r),this.triggerCameraModifiedEventIfNecessary(r,r),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(e=>{(0,s.actorIsA)(e,"vtkVolume")&&(e.slabThickness=o.RENDERING_DEFAULTS.MINIMUM_SLAB_THICKNESS)});const e=this.getCamera();this.updateClippingPlanesForActors(e),this.triggerCameraModifiedEventIfNecessary(e,e),this.viewportProperties.slabThickness=void 0}getViewReference(e={}){const t=super.getViewReference(e);if(!t?.volumeId)return;const n=i.ZP.getVolume(t.volumeId);return t.referencedImageId=(0,s.getClosestImageId)(n,t.cameraFocalPoint,t.viewPlaneNormal),t}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const t=e?this.getActor(e):this.getDefaultActor();if(!t)throw new Error(`No actor found for the given volumeId: ${e}`);t.slabThickness&&(t.slabThickness=o.RENDERING_DEFAULTS.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera()));const n=i.ZP.getVolume(t.uid);if(!n)throw new Error(`imageVolume with id: ${t.uid} does not exist in cache`);if((0,c.Z)(t.actor,n,!1),(0,s.isImageActor)(t)){const e=t.actor.getProperty().getRGBTransferFunction(0);(0,u.setTransferFunctionNodes)(e,this.initialTransferFunctionNodes)}const r={...super.getVOIModifiedEventDetail(e)};this.resetCamera(!0,!0,!0,!0),(0,s.triggerEvent)(this.element,a.Events.VOI_MODIFIED,r)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:t}=this.getCamera(),n=o.RENDERING_DEFAULTS.MINIMUM_SLAB_THICKNESS;return e.map(({point:e,sliceIndex:i})=>{const o=[r.ZP.newInstance(),r.ZP.newInstance()];return this.setOrientationOfClippingPlanes(o,n,t,e),{sliceIndex:i,planes:o.map(e=>({normal:e.getNormal(),origin:e.getOrigin()}))}})}}const f=h},46190:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(7187),i=n(36205);class o extends i.Z{constructor(e){super(e),this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>{},this.getCurrentImageId=()=>null;const{parallelProjection:t,orientation:n}=this.options,i=this.getVtkActiveCamera();null!=t&&i.setParallelProjection(t),n&&n!==r.OrientationAxis.ACQUISITION&&this.applyViewOrientation(n)}resetCamera(e=!0,t=!0,n=!0){super.resetCamera(e,t,n),this.resetVolumeViewportClippingRange()}setSlabThickness(e,t){return null}setBlendMode(e,t,n){return null}resetProperties(e){return null}resetSlabThickness(){return null}}const a=o},86057:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(72076),i=n(7187),o=n(30023),a=n(30742),s=n(77614),l=n(25281),c=n(48588),u=n(11723);const d=Symbol.for("map");class p extends s.Z{constructor(e){super({...e,canvas:e.canvas||(0,l.uy)(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const e=this.canvas,{clientWidth:t,clientHeight:n}=e;e.width===t&&e.height===n||(e.width=t,e.height=n),this.refreshRenderValues()},this.canvasToWorld=e=>{if(!this.metadata)return;const[t,n]=this.canvasToIndex(e),{origin:i,spacing:o,direction:a}=this.getImageData(),s=r.R3.fromValues(0,0,0),l=a.slice(0,3),c=a.slice(3,6);return r.R3.scaleAndAdd(s,i,l,t*o[0]),r.R3.scaleAndAdd(s,s,c,n*o[1]),[s[0],s[1],s[2]]},this.worldToCanvas=e=>{if(!this.metadata)return;const{spacing:t,direction:n,origin:i}=this.metadata,o=n.slice(0,3),a=n.slice(3,6),s=r.R3.subtract([0,0,0],e,i),l=[r.R3.dot(s,o)/t[0],r.R3.dot(s,a)/t[1]];return this.indexToCanvas(l)},this.postrender=()=>{this.refreshRenderValues(),(0,u.triggerEvent)(this.element,i.Events.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=e=>{const t=this.getTransform();return t.invert(),t.transformPoint(e)},this.indexToCanvas=e=>this.getTransform().transformPoint(e),this.customRenderViewportToCanvas=()=>{},this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.id=crypto.randomUUID(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const t=this.element.firstElementChild;t.insertBefore(this.microscopyElement,t.childNodes[1]),this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners()}getImageDataMetadata(e=0){const t=this.metadataDicomweb.reduce((e,t)=>e?.NumberOfFrames<t.NumberOfFrames?t:e),{TotalPixelMatrixColumns:n,TotalPixelMatrixRows:a,ImageOrientationSlide:s,ImagedVolumeWidth:l,ImagedVolumeHeight:c,ImagedVolumeDepth:u}=t,d=o.get(i.MetadataModules.IMAGE_PLANE,this.imageIds[e]);let p=s.slice(0,3),h=s.slice(3,6);null!=p&&null!=h||(p=[1,0,0],h=[0,1,0]);const f=r.R3.fromValues(p[0],p[1],p[2]),m=r.R3.fromValues(h[0],h[1],h[2]),g=r.R3.create();r.R3.cross(g,f,m);const{XOffsetInSlideCoordinateSystem:v=0,YOffsetInSlideCoordinateSystem:y=0,ZOffsetInSlideCoordinateSystem:b=0}=t.TotalPixelMatrixOriginSequence?.[0]||{},C=[v,y,b],w=l/n,E=c/a,T=n,x=a,_=u;return this.hasPixelSpacing=!(!l||!c),{bitsAllocated:8,numComps:3,origin:C,direction:[...f,...m,...g],dimensions:[T,x,1],spacing:[w,E,_],hasPixelSpacing:this.hasPixelSpacing,numVoxels:T*x*1,imagePlaneModule:d}}async setFrameNumber(e){}setProperties(e){}resetProperties(){this.setProperties({})}getScalarData(){return null}getImageData(){const{metadata:e}=this,t=e.spacing;return{dimensions:e.dimensions,spacing:t,numComps:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},getScalarData:()=>this.getScalarData(),imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:e=>{const t=this.worldToCanvas(e),n=this.canvasToIndex(t);return[n[0],n[1],0]},indexToWorld:e=>{const t=this.indexToCanvas([e[0],e[1]]);return this.canvasToWorld(t)}},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}}}hasImageURI(e){return!0}setCamera(e){const t=this.getCamera(),{parallelScale:n,focalPoint:r}=e,i=this.getView(),{xSpacing:o}=this.internalCamera;if(n){const e=1/o/(this.element.clientHeight/n);i.setResolution(e)}if(r){const e=this.worldToCanvas(r),t=this.canvasToIndex(e);i.setCenter(t)}const a=this.getCamera();this.triggerCameraModifiedEventIfNecessary(t,a)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:t}=this.internalCamera,n=e*t,r=[this.element.clientWidth/2,this.element.clientHeight/2],i=this.canvasToWorld(r);return{parallelProjection:!0,focalPoint:i,position:i,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*n,viewPlaneNormal:[0,0,1]}}getImportPath(){return"/dicom-microscopy-viewer/dicomMicroscopyViewer.min.js"}setDataIds(e){const t=o.get(i.MetadataModules.WEB_CLIENT,e[0]);if(!t)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);this.setWSI(e,t)}async setWSI(e,t){this.microscopyElement.style.background="red",this.microscopyElement.innerText="Loading",this.imageIds=e,await n(30684)(this.getImportPath());const r=window.dicomMicroscopyViewer;this.frameOfReferenceUID=null;const i=this.imageIds.map(e=>{const n=t.getDICOMwebMetadata(e);Object.defineProperty(n,"isMultiframe",{value:n.isMultiframe,enumerable:!1}),Object.defineProperty(n,"frameNumber",{value:void 0,enumerable:!1});const r=n["00080008"]?.Value;1===r?.length&&(n["00080008"].Value=r[0].split("\\"));const i=n["00200052"]?.Value?.[0];return this.frameOfReferenceUID?i!==this.frameOfReferenceUID&&(n["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=i,n}),o=[];i.forEach(e=>{const t=new r.metadata.VLWholeSlideMicroscopyImage({metadata:e}),n=t.ImageType[2];"VOLUME"!==n&&"THUMBNAIL"!==n||o.push(t)}),this.metadataDicomweb=o;const a=new r.viewer.VolumeImageViewer({client:t,metadata:o,controls:[],bindings:{}});a.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),a.deactivateDragPanInteraction(),this.viewer=a,this.map=a[d],this.map.on("postrender",this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const t=this.getCamera();this.setCamera({parallelScale:t.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[d],t=window;return t.map=e,t.viewer=this.viewer,t.view=e?.getView(),t.wsi=this,e?.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const t=e.getResolution();if(!t||t<c.EPSILON)return;const n=e.getCenter(),r=e.getProjection().getExtent(),i=e.getRotation(),o=e.getZoom(),{metadata:{spacing:[a,s]}}=this,l=1/t/a;Object.assign(this.internalCamera,{extent:r,centerIndex:n,worldToCanvasRatio:l,xSpacing:a,ySpacing:s,resolution:t,rotation:i,zoom:o})}getZoom(){return this.getView()?.getZoom()}setZoom(e){this.getView()?.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:t,rotation:n}=this.internalCamera,r=[this.canvas.width/2,this.canvas.height/2],i=new a.w;return i.translate(r[0],r[1]),i.rotate(n),i.scale(1/t,-1/t),i.translate(-e[0],-e[1]),i}getReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}}const h=p},9138:(e,t,n)=>{"use strict";n.d(t,{Pr:()=>i,Uu:()=>o,ZP:()=>a});var r=n(90872);function i(e){return r.Z.get(e)}function o(){return r.Z.getAll()}const a=i},51945:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});function r(e,t,n){if(e>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(0===t)return r[0]=n,r[1]=n,r[2]=n,r;const i=Math.floor(6*e),o=6*e-i,a=n*(1-t),s=n*(1-t*o),l=n*(1-t*(1-o));switch(i){case 0:case 6:r[0]=n,r[1]=l,r[2]=a;break;case 1:r[0]=s,r[1]=n,r[2]=a;break;case 2:r[0]=a,r[1]=n,r[2]=l;break;case 3:r[0]=a,r[1]=s,r[2]=n;break;case 4:r[0]=l,r[1]=a,r[2]=n;break;case 5:r[0]=n,r[1]=a,r[2]=s}return r}const i=class{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,t){this.TableRange[0]=e,this.TableRange[1]=t}setHueRange(e,t){this.HueRange[0]=e,this.HueRange[1]=t}setSaturationRange(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}setValueRange(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}setRange(e,t){this.InputRange[0]=e,this.InputRange[1]=t}setAlphaRange(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const t=this.NumberOfColors-1;let n,i,o,a;t?(n=(this.HueRange[1]-this.HueRange[0])/t,i=(this.SaturationRange[1]-this.SaturationRange[0])/t,o=(this.ValueRange[1]-this.ValueRange[0])/t,a=(this.AlphaRange[1]-this.AlphaRange[0])/t):n=i=o=a=0;for(let e=0;e<=t;e++){const t=this.HueRange[0]+e*n,s=this.SaturationRange[0]+e*i,l=this.ValueRange[0]+e*o,c=this.AlphaRange[0]+e*a,u=r(t,s,l),d=[0,0,0,0];switch(this.Ramp){case"scurve":d[0]=Math.floor(127.5*(1+Math.cos((1-u[0])*Math.PI))),d[1]=Math.floor(127.5*(1+Math.cos((1-u[1])*Math.PI))),d[2]=Math.floor(127.5*(1+Math.cos((1-u[2])*Math.PI))),d[3]=Math.floor(255*c);break;case"linear":d[0]=Math.floor(255*u[0]+.5),d[1]=Math.floor(255*u[1]+.5),d[2]=Math.floor(255*u[2]+.5),d[3]=Math.floor(255*c+.5);break;case"sqrt":d[0]=Math.floor(255*Math.sqrt(u[0])+.5),d[1]=Math.floor(255*Math.sqrt(u[1])+.5),d[2]=Math.floor(255*Math.sqrt(u[2])+.5),d[3]=Math.floor(255*Math.sqrt(c)+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(d)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,t=e+0,n=e+1,r=e+2;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[r]=this.NaNColor}mapValue(e){const t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}getIndex(e){const t={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e))return-1;let n=function(e,t){let n;return n=e<t.Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale,Math.floor(n)}(e,t);return n===this.NumberOfColors+0?n=0:n===this.NumberOfColors+1&&(n=this.NumberOfColors-1),n}setTableValue(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error(`Can't set the table value for negative index (${e})`);e>=this.NumberOfColors&&new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}},64647:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const r={viewport:{}};function i(){const e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}};return Object.assign({},e,r.viewport)}},75452:(e,t,n)=>{"use strict";function r(e,t){const n=e.renderingTools.lastRenderedImageId,r=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!r||r.windowCenter!==e.viewport.voi.windowCenter||r.windowWidth!==e.viewport.voi.windowWidth||r.invert!==e.viewport.invert||r.rotation!==e.viewport.rotation||r.hflip!==e.viewport.hflip||r.vflip!==e.viewport.vflip||r.modalityLUT!==e.viewport.modalityLUT||r.voiLUT!==e.viewport.voiLUT||r.colormap!==e.viewport.colormap}n.d(t,{Z:()=>r})},87908:(e,t,n)=>{"use strict";function r(e,t){if(function(e){const t=e.voiLUT&&e.voiLUT.lut&&e.voiLUT.lut.length>0;return t||void 0!==e.voi.windowWidth&&void 0!==e.voi.windowCenter}(e))return;const n=t.maxPixelValue*t.slope+t.intercept,r=t.minPixelValue*t.slope+t.intercept,i=n-r,o=(n+r)/2;void 0===e.voi?e.voi={windowWidth:i,windowCenter:o}:(e.voi.windowWidth=i,e.voi.windowCenter=o)}function i(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}n.d(t,{Z:()=>a});var o=n(96434);function a(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&i(e.cachedLut.modalityLUT,t.modalityLUT)&&i(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(r(t,e),function(e,t,n,r,i,a){const s=e.maxPixelValue,l=e.minPixelValue,c=Math.min(l,0);if(void 0===e.cachedLut){const t=s-c+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(t)}const u=e.cachedLut.lutArray,d=function(e,t,n){return n?function(e){const t=e.lut[0],n=e.lut[e.lut.length-1],r=e.firstValueMapped+e.lut.length;return i=>i<e.firstValueMapped?t:i>=r?n:e.lut[i]}(n):function(e,t){return n=>n*e+t}(e,t)}(e.slope,e.intercept,i),p=(0,o.Z)(t,n,a);if(e.isPreScaled)if(!0===r)for(let e=l;e<=s;e++)u[e+-c]=255-p(e);else for(let e=l;e<=s;e++)u[e+-c]=p(e);else if(!0===r)for(let e=l;e<=s;e++)u[e+-c]=255-p(d(e));else for(let e=l;e<=s;e++)u[e+-c]=p(d(e))}(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray}},96434:(e,t,n)=>{"use strict";function r(e,t,n){return n?function(e){const t=Math.max(...e.lut).toString(2).length-8,n=e.lut[0]>>t,r=e.lut[e.lut.length-1]>>t,i=e.firstValueMapped+e.lut.length-1;return function(o){return o<e.firstValueMapped?n:o>=i?r:e.lut[o-e.firstValueMapped]>>t}}(n):function(e,t){return function(n){const r=255*((n-(t-.5))/(e-1)+.5);return Math.min(Math.max(r,0),255)}}(e,t)}n.d(t,{Z:()=>r})},77819:(e,t,n)=>{"use strict";function r(e,t){const n=e.renderingTools.renderCanvas;n.width=t.width,n.height=t.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const i=r.getImageData(0,0,t.width,t.height);e.renderingTools.renderCanvasContext=r,e.renderingTools.renderCanvasData=i}n.d(t,{Z:()=>r})},10065:(e,t,n)=>{"use strict";function r(){return window.performance?performance.now():Date.now()}n.d(t,{Z:()=>r})},64924:(e,t,n)=>{"use strict";n.d(t,{C:()=>d});var r=n(10065),i=n(96434);var o=n(17253),a=n(75452),s=n(77819),l=n(86650);function c(e,t){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&e.cachedLut.invert===t.invert||(function(e,t,n,r,o){const a=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0);if(void 0===e.cachedLut){const t=a-l+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(t)}const c=e.cachedLut.lutArray,u=(0,i.Z)(Array.isArray(t)?t[0]:t,Array.isArray(n)?n[0]:n,o);if(!0===r)for(let e=s;e<=a;e++)c[e+-l]=255-u(e);else for(let e=s;e<=a;e++)c[e+-l]=u(e)}(e,t.voi.windowWidth,t.voi.windowCenter,t.invert),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert),e.cachedLut.lutArray}function u(e,t,n){const i=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&i||(e.renderingTools.renderCanvas=document.createElement("canvas"));const o=e.renderingTools.renderCanvas,{windowWidth:l,windowCenter:u}=e.viewport.voi;if((256===l||255===l)&&(128===u||127===u)&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===(0,a.Z)(e,t)&&!0!==n)return o;o.width===t.width&&o.height===t.height||(0,s.Z)(e,t);let d=(0,r.Z)();const p=c(t,e.viewport);t.stats=t.stats||{},t.stats.lastLutGenerateTime=(0,r.Z)()-d;const h=e.renderingTools.renderCanvasData,f=e.renderingTools.renderCanvasContext;return t.rgba?function(e,t,n){let i=(0,r.Z)();const o=e.getPixelData();e.stats.lastGetPixelDataTime=(0,r.Z)()-i;const a=e.minPixelValue;let s=0,l=0;const c=o.length;if(i=(0,r.Z)(),a<0)for(;l<c;)n[s++]=t[o[l++]+-a],n[s++]=t[o[l++]+-a],n[s++]=t[o[l++]+-a],n[s++]=o[l++];else for(;l<c;)n[s++]=t[o[l++]],n[s++]=t[o[l++]],n[s++]=t[o[l++]],n[s++]=o[l++];e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,r.Z)()-i}(t,p,h.data):function(e,t,n){let i=(0,r.Z)();const o=e.getPixelData();e.stats.lastGetPixelDataTime=(0,r.Z)()-i;const a=e.minPixelValue;let s=0,l=0;const c=o.length;if(i=(0,r.Z)(),a<0)for(;l<c;)n[s++]=t[o[l++]+-a],n[s++]=t[o[l++]+-a],n[s]=t[o[l]+-a],l+=2,s+=2;else for(;l<c;)n[s++]=t[o[l++]],n[s++]=t[o[l++]],n[s]=t[o[l]],l+=2,s+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,r.Z)()-i}(t,p,h.data),d=(0,r.Z)(),f.putImageData(h,0,0),t.stats.lastPutImageDataTime=(0,r.Z)()-d,o}function d(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=e.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,(0,o.Z)(e,r);const i=u(e,n,t),a=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,c=e.viewport.displayedArea.brhc.x-a,d=e.viewport.displayedArea.brhc.y-s;r.drawImage(i,a,s,c,d,0,0,c,d),e.renderingTools=(0,l.Z)(e)}},401:(e,t,n)=>{"use strict";n.d(t,{L:()=>u});var r=n(10065);var i=n(17253),o=n(87908),a=n(75452),s=n(77819),l=n(86650);function c(e,t,n,i=!0){const l=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&!l||(e.renderingTools.renderCanvas=document.createElement("canvas"),(0,s.Z)(e,t));const c=e.renderingTools.renderCanvas;if(!1===(0,a.Z)(e,t)&&!0!==n)return c;c.width===t.width&&c.height===t.height||(0,s.Z)(e,t),t.stats=t.stats||{};const u=e.renderingTools.renderCanvasData,d=e.renderingTools.renderCanvasContext;let p=(0,r.Z)();t.stats.lastLutGenerateTime=(0,r.Z)()-p;const{viewport:h}=e;if("PT"===h.modality&&t.isPreScaled){const{windowWidth:e,windowCenter:n}=h.voi,i=n-e/2,o=255/(n+e/2-i);let a;a=h.invert?e=>255-(e-i)*o:e=>(e-i)*o,function(e,t,n){let i=(0,r.Z)();const o=e.getPixelData();e.stats.lastGetPixelDataTime=(0,r.Z)()-i;const a=o.length;let s=3,l=0;for(i=(0,r.Z)();l<a;)n[s]=t(o[l++]),s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,r.Z)()-i}(t,a,u.data)}else{const e=(0,o.Z)(t,h,n);i?function(e,t,n){let i=(0,r.Z)();const o=e.getPixelData();e.stats.lastGetPixelDataTime=(0,r.Z)()-i;const a=o.length,s=e.minPixelValue;let l=3,c=0;if(i=(0,r.Z)(),o instanceof Int16Array)if(s<0)for(;c<a;)n[l]=t[o[c++]+-s],l+=4;else for(;c<a;)n[l]=t[o[c++]],l+=4;else if(o instanceof Uint16Array)for(;c<a;)n[l]=t[o[c++]],l+=4;else if(s<0)for(;c<a;)n[l]=t[o[c++]+-s],l+=4;else for(;c<a;)n[l]=t[o[c++]],l+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,r.Z)()-i}(t,e,u.data):function(e,t,n){let i=(0,r.Z)();const o=e.getPixelData();e.stats.lastGetPixelDataTime=(0,r.Z)()-i;const a=o.length,s=e.minPixelValue;let l,c=0,u=0;if(i=(0,r.Z)(),o instanceof Int16Array)if(s<0)for(;u<a;)l=t[o[u++]+-s],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else for(;u<a;)l=t[o[u++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else if(o instanceof Uint16Array)for(;u<a;)l=t[o[u++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else if(s<0)for(;u<a;)l=t[o[u++]+-s],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;else for(;u<a;)l=t[o[u++]],n[c++]=l,n[c++]=l,n[c++]=l,n[c++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,r.Z)()-i}(t,e,u.data)}return p=(0,r.Z)(),d.putImageData(u,0,0),t.stats.lastPutImageDataTime=(0,r.Z)()-p,c}function u(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");const r=e.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,(0,i.Z)(e,r);const o=c(e,n,t),a=e.viewport.displayedArea.tlhc.x-1,s=e.viewport.displayedArea.tlhc.y-1,u=e.viewport.displayedArea.brhc.x-a,d=e.viewport.displayedArea.brhc.y-s;r.drawImage(o,a,s,u,d,0,0,u,d),e.renderingTools=(0,l.Z)(e)}},46673:(e,t,n)=>{"use strict";n.d(t,{J:()=>h});var r=n(17253),i=n(10065),o=n(77819),a=n(87908),s=n(86650),l=n(75452),c=n(43877);const u=function(e,t,n,r){let o=(0,i.Z)();const a=e.getPixelData();e.stats.lastGetPixelDataTime=(0,i.Z)()-o;const s=a.length,l=e.minPixelValue;let u,d,p,h=0,f=0;if(o=(0,i.Z)(),p=n instanceof c.Wl?n.Table:n,l<0)for(;f<s;)u=t[a[f++]+-l],d=p[u],r[h++]=d[0],r[h++]=d[1],r[h++]=d[2],r[h++]=d[3];else for(;f<s;)u=t[a[f++]],d=p[u],r[h++]=d[0],r[h++]=d[1],r[h++]=d[2],r[h++]=d[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,i.Z)()-o};const d=function(e,t,n,r){let o=(0,i.Z)();const a=e.getPixelData();e.stats.lastGetPixelDataTime=(0,i.Z)()-o;const s=a.length,l=e.minPixelValue;let u,d,p,h=0,f=0;if(o=(0,i.Z)(),p=n instanceof c.Wl?n.Table:n,l<0)for(;f<s;)u=t(a[f++]+-l),d=p[u],r[h++]=d[0],r[h++]=d[1],r[h++]=d[2],r[h++]=d[3];else for(;f<s;)u=t(a[f++]),d=p[u],r[h++]=d[0],r[h++]=d[1],r[h++]=d[2],r[h++]=d[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,i.Z)()-o};var p=n(11723);function h(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");const h=e.canvas.getContext("2d");h.setTransform(1,0,0,1,0,0),h.fillStyle="black",h.fillRect(0,0,e.canvas.width,e.canvas.height),h.imageSmoothingEnabled=!e.viewport.pixelReplication,(0,r.Z)(e,h);const f=function(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));const r=e.renderingTools.renderCanvas;let s=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),s&&"string"==typeof s&&(s=c.yP(s)),!s)throw new Error("renderPseudoColorImage: colormap not found.");const h=s.getId();if(!1===(0,l.Z)(e,t)&&!0!==n&&e.renderingTools.colormapId===h)return r;r.width===t.width&&r.height===t.height||(0,o.Z)(e,t);let f=(0,i.Z)();e.renderingTools.colorLUT&&!n&&e.renderingTools.colormapId===h||(s.setNumberOfColors(256),e.renderingTools.colorLUT=s.createLookupTable(),e.renderingTools.colormapId=h);const m=e.renderingTools.renderCanvasData,g=e.renderingTools.renderCanvasContext,{viewport:v}=e,y=e.renderingTools.colorLUT;if("PT"===v.modality){const{windowWidth:e,windowCenter:n}=v.voi,r=n-e/2,i=255/(n+e/2-r);let o;o=v.invert?e=>(0,p.clamp)(Math.floor(255-(e-r)*i),0,255):e=>(0,p.clamp)(Math.floor((e-r)*i),0,255),d(t,o,y,m.data)}else{const r=(0,a.Z)(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=(0,i.Z)()-f,u(t,r,y,m.data)}return f=(0,i.Z)(),g.putImageData(m,0,0),t.stats.lastPutImageDataTime=(0,i.Z)()-f,r}(e,n,t),m=e.viewport.displayedArea.tlhc.x-1,g=e.viewport.displayedArea.tlhc.y-1,v=e.viewport.displayedArea.brhc.x-m,y=e.viewport.displayedArea.brhc.y-g;h.drawImage(f,m,g,v,y,0,0,v,y),e.renderingTools=(0,s.Z)(e)}},86650:(e,t,n)=>{"use strict";function r(e){const t=e.image.imageId,n=e.viewport,r=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=r,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools}n.d(t,{Z:()=>r})},17253:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(77327);function i(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=(0,r.Z)(e,n).getMatrix();t.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}},30742:(e,t,n)=>{"use strict";n.d(t,{w:()=>r});class r{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new r;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const t=this.m[0]*e[0]+this.m[2]*e[1],n=this.m[1]*e[0]+this.m[3]*e[1],r=this.m[0]*e[2]+this.m[2]*e[3],i=this.m[1]*e[2]+this.m[3]*e[3],o=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],a=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=a}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=a}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,o=this.m[0]*-n+this.m[2]*t,a=this.m[1]*-n+this.m[3]*t;this.m[0]=r,this.m[1]=i,this.m[2]=o,this.m[3]=a}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}transformPoint(e){const t=e[0],n=e[1];return[t*this.m[0]+n*this.m[2]+this.m[4],t*this.m[1]+n*this.m[3]+this.m[5]]}}},6737:(e,t,n)=>{"use strict";function r(e,t){if(null==e)throw new Error(t)}n.d(t,{T:()=>r})},49046:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(63466),i=n(28719);function o(e,t){const n=r.Iy.newInstance();(0,i.P_)().rendering.preferSizeOverAccuracy&&n.setPreferSizeOverAccuracy(!0),n.setInputData(e);const o=e.getSpacing(),a=(o[0]+o[1]+o[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(a),n.setScalarTexture(t),n}},21804:(e,t,n)=>{"use strict";n.d(t,{Ib:()=>o,ZP:()=>a});const r="viewport-element",i="cornerstone-canvas",o=1e-4;function a(e){const t=`canvas.${i}`,n=`div.${r}`,a=e.querySelector(n)||function(e){const t=document.createElement("div");return t.style.position="relative",t.style.width="100%",t.style.height="100%",t.style.overflow="hidden",t.classList.add(r),e.appendChild(t),t}(e),s=a.querySelector(t)||function(e){const t=document.createElement("canvas");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.imageRendering="pixelated",t.classList.add(i),e.appendChild(t),t}(a),l=a.getBoundingClientRect(),c=window.devicePixelRatio||1,u=Math.ceil(l.width*c),d=Math.ceil(l.height*c);return s.width=u,s.height=d,s.style.width=(u+o)/c+"px",s.style.height=(d+o)/c+"px",s}},25281:(e,t,n)=>{"use strict";n.d(t,{PN:()=>l.Z,gc:()=>s.Z,TS:()=>r.Z,uy:()=>i.ZP,tX:()=>a});var r=n(28925),i=(n(49046),n(21804)),o=n(36205);const a=async function(e,t,n,r=!1,i=!1){n.forEach(t=>{const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!(n instanceof o.Z))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const a=n.map(async n=>{const o=e.getViewport(n);await o.setVolumes(t,r,i)});await Promise.all(a)};var s=n(87301),l=(n(41957),n(68467))},41957:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c,t:()=>l});var r=n(11723),i=n(7187),o=n(9138),a=n(36205);const s={};function l(e){void 0!==s[e]&&delete s[e]}const c=function(e){const{renderingEngineId:t,viewportId:n}=e.detail,l=(0,o.Pr)(t).getViewport(n);if(!(l instanceof a.Z))throw new Error("volumeNewImageEventDispatcher: viewport is not a BaseVolumeViewport");void 0===s[l.id]&&(s[l.id]=0);const c=(0,r.getImageSliceDataForVolumeViewport)(l);if(!c)return void console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${l.id}`);const{numberOfSlices:u,imageIndex:d}=c;if(s[l.id]===d)return;s[l.id]=d;const p={imageIndex:d,viewportId:n,renderingEngineId:t,numberOfSlices:u};(0,r.triggerEvent)(l.element,i.Events.VOLUME_NEW_IMAGE,p)}},69552:(e,t,n)=>{"use strict";n.d(t,{kA:()=>c.Z,ZP:()=>E,Pr:()=>w.ZP});var r=n(19546),i=n(90872),o=n(74238),a=n(11723),s=n(63466),l=n(68032),c=n(32932),u=n(36205),d=n(98715),p=n(46190),h=n(49001),f=n(86057);const m={[l.Z.ORTHOGRAPHIC]:c.Z,[l.Z.PERSPECTIVE]:c.Z,[l.Z.STACK]:d.Z,[l.Z.VOLUME_3D]:p.Z,[l.Z.VIDEO]:h.Z,[l.Z.WholeSlide]:f.Z};function g(e){return m[e].useCustomRenderingPipeline}var v=n(21804),y=n(28719),b=n(7187);const C=class{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=e=>{const t=this._getViewportsAsArray().map(t=>{if(t.getFrameOfReferenceUID()===e)return t.id});return this.renderViewports(t)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const e=this._getViewportsAsArray(),t=[];for(let n=0;n<e.length;n++){const r=e[n];if(this._needsRender.has(r.id)){const e=this.renderViewportUsingCustomOrVtkPipeline(r);if(t.push(e),r.setRendered(),this._needsRender.delete(r.id),0===this._needsRender.size)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,t.forEach(e=>{e?.element&&(0,a.triggerEvent)(e.element,r.Z.IMAGE_RENDERED,e)})},this.id=e||(0,a.uuidv4)(),this.useCPURendering=(0,y.L_)(),i.Z.set(this),!(0,y.uF)())throw new Error("@cornerstonejs/core is not initialized, run init() first");this.useCPURendering||(this.offscreenMultiRenderWindow=s.Ak.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer)),this._viewports=new Map,this.hasBeenDestroyed=!1}enableElement(e){const t=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:n,viewportId:r}=t;if(!n)throw new Error("No element provided");this.getViewport(r)&&this.disableElement(r);const{type:i}=t,o=g(i);this.useCPURendering||o?this.addCustomViewport(t):this.enableVTKjsDrivenViewport(t);const a=(0,v.ZP)(n),{background:s}=t.defaultOptions;this.fillCanvasWithBackgroundColor(a,s)}disableElement(e){this._throwIfDestroyed();const t=this.getViewport(e);if(!t)return void console.warn(`viewport ${e} does not exist`);this._resetViewport(t),g(t.type)||this.useCPURendering||this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),t.isDisabled=!0,this._needsRender.delete(e);this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const t=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const n=[],r=[];t.forEach(e=>{this.useCPURendering||g(e.type)?r.push(e):n.push(e)}),this.setVtkjsDrivenViewports(n),this.setCustomViewports(r),t.forEach(e=>{const t=(0,v.ZP)(e.element),{background:n}=e.defaultOptions;this.fillCanvasWithBackgroundColor(t,n)})}resize(e=!0,t=!0){this._throwIfDestroyed();const n=this._getViewportsAsArray(),r=[],i=[];n.forEach(e=>{g(e.type)?i.push(e):r.push(e)}),r.length&&this._resizeVTKViewports(r,t,e),i.length&&this._resizeUsingCustomResizeHandler(i,t,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewports(){this._throwIfDestroyed();return this.getViewports().filter(e=>e instanceof d.Z)}getVolumeViewports(){this._throwIfDestroyed();return this.getViewports().filter(e=>e instanceof u.Z)}render(){const e=this.getViewports().map(e=>e.id);this._setViewportsToBeRenderedNextFrame(e)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){if(!this.hasBeenDestroyed){if(!this.useCPURendering){this._getViewportsAsArray().forEach(e=>{this.offscreenMultiRenderWindow.removeRenderer(e.id)}),this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow}this._reset(),i.Z.delete(this.id),this.hasBeenDestroyed=!0}}fillCanvasWithBackgroundColor(e,t){const n=e.getContext("2d");let r;if(t){const e=t.map(e=>Math.floor(255*e));r=`rgb(${e[0]}, ${e[1]}, ${e[2]})`}else r="black";n.fillStyle=r,n.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:t,defaultOptions:n}=e;let r=n;return r&&0!==Object.keys(r).length||(r={background:[0,0,0],orientation:null,displayArea:null},t===l.Z.ORTHOGRAPHIC&&(r={...r,orientation:b.OrientationAxis.AXIAL})),{...e,defaultOptions:r}}_normalizeViewportInputEntries(e){const t=[];return e.forEach(e=>{t.push(this._normalizeViewportInputEntry(e))}),t}_resizeUsingCustomResizeHandler(e,t=!0,n=!0){e.forEach(e=>{"function"==typeof e.resize&&e.resize()}),e.forEach(e=>{const n=e.getCamera();e.resetCamera(),t&&e.setCamera(n)}),!0===n&&this.render()}_resizeVTKViewports(e,t=!0,n=!0){e.forEach(e=>{(0,v.ZP)(e.element)});const r=e.map(e=>e.canvas);if(r.length){const{offScreenCanvasWidth:t,offScreenCanvasHeight:n}=this._resizeOffScreenCanvas(r);this._resize(e,t,n)}e.forEach(e=>{const n=e.getCamera(),r=e.getRotation(),{flipHorizontal:i}=n;e.resetCamera(!0,!0,!0,!1,!0);const o=e.getDisplayArea();t&&(o?(i&&e.setCamera({flipHorizontal:i}),r&&e.setProperties({rotation:r})):e.setCamera(n))}),!0===n&&this.render()}enableVTKjsDrivenViewport(e){const t=this._getViewportsAsArray().filter(e=>!1===g(e.type)),n=t.map(e=>e.canvas),r=(0,v.ZP)(e.element);n.push(r);const{offScreenCanvasWidth:i,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(n),a=this._resize(t,i,o),s={...e,canvas:r};this.addVtkjsDrivenViewport(s,{offScreenCanvasWidth:i,offScreenCanvasHeight:o,xOffset:a})}_removeViewport(e){this.getViewport(e)?this._viewports.delete(e):console.warn(`viewport ${e} does not exist`)}addVtkjsDrivenViewport(e,t){const{element:n,canvas:i,viewportId:s,type:u,defaultOptions:h}=e;n.tabIndex=-1;const{offScreenCanvasWidth:f,offScreenCanvasHeight:m,xOffset:g}=t,{sxStartDisplayCoords:v,syStartDisplayCoords:y,sxEndDisplayCoords:b,syEndDisplayCoords:C,sx:w,sy:E,sWidth:T,sHeight:x}=this._getViewportCoordsOnOffScreenCanvas(e,f,m,g);this.offscreenMultiRenderWindow.addRenderer({viewport:[v,y,b,C],id:s,background:h.background?h.background:[0,0,0]});const _={id:s,element:n,renderingEngineId:this.id,type:u,canvas:i,sx:w,sy:E,sWidth:T,sHeight:x,defaultOptions:h||{}};let S;if(u===l.Z.STACK)S=new d.Z(_);else if(u===l.Z.ORTHOGRAPHIC||u===l.Z.PERSPECTIVE)S=new c.Z(_);else{if(u!==l.Z.VOLUME_3D)throw new Error(`Viewport Type ${u} is not supported`);S=new p.Z(_)}this._viewports.set(s,S);const I={element:n,viewportId:s,renderingEngineId:this.id};S.suppressEvents||(0,a.triggerEvent)(o.Z,r.Z.ELEMENT_ENABLED,I)}addCustomViewport(e){const{element:t,viewportId:n,type:i,defaultOptions:s}=e;t.tabIndex=-1;const l=(0,v.ZP)(t),{clientWidth:c,clientHeight:u}=l;l.width===c&&l.height===u||(l.width=c,l.height=u);const d={id:n,renderingEngineId:this.id,element:t,type:i,canvas:l,sx:0,sy:0,sWidth:c,sHeight:u,defaultOptions:s||{}},p=new(0,m[i])(d);this._viewports.set(n,p);const h={element:t,viewportId:n,renderingEngineId:this.id};(0,a.triggerEvent)(o.Z,r.Z.ELEMENT_ENABLED,h)}setCustomViewports(e){e.forEach(e=>this.addCustomViewport(e))}setVtkjsDrivenViewports(e){if(e.length){const t=e.map(e=>(0,v.ZP)(e.element));t.forEach(e=>{const t=window.devicePixelRatio||1,n=e.getBoundingClientRect();e.width=n.width*t,e.height=n.height*t});const{offScreenCanvasWidth:n,offScreenCanvasHeight:r}=this._resizeOffScreenCanvas(t);let i=0;for(let o=0;o<e.length;o++){const a=e[o],s=t[o],l={...a,canvas:s};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:n,offScreenCanvasHeight:r,xOffset:i}),i+=s.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:t,offscreenMultiRenderWindow:n}=this,r=Math.max(...e.map(e=>e.height));let i=0;return e.forEach(e=>{i+=e.width}),t.width=i,t.height=r,n.resize(),{offScreenCanvasWidth:i,offScreenCanvasHeight:r}}_resize(e,t,n){let r=0;for(let i=0;i<e.length;i++){const o=e[i],{sxStartDisplayCoords:a,syStartDisplayCoords:s,sxEndDisplayCoords:l,syEndDisplayCoords:c,sx:u,sy:d,sWidth:p,sHeight:h}=this._getViewportCoordsOnOffScreenCanvas(o,t,n,r);r+=o.canvas.width,o.sx=u,o.sy=d,o.sWidth=p,o.sHeight=h;this.offscreenMultiRenderWindow.getRenderer(o.id).setViewport([a,s,l,c])}return r}_getViewportCoordsOnOffScreenCanvas(e,t,n,r){const{canvas:i}=e,{width:o,height:a}=i,s=r/t,l=0+(n-a)/n;return{sxStartDisplayCoords:s,syStartDisplayCoords:l,sxEndDisplayCoords:s+o/t,syEndDisplayCoords:l+a/n,sx:r,sy:0,sWidth:o,sHeight:a}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(e=>{this._needsRender.add(e)}),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,t=e.getRenderWindow(),n=e.getRenderers();if(n.length){for(let e=0;e<n.length;e++){const{renderer:t,id:r}=n[e];this._needsRender.has(r)?t.setDraw(!0):t.setDraw(!1)}t.render();for(let e=0;e<n.length;e++)n[e].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let t;if(!(e.sWidth<2||e.sHeight<2)){if(!0===g(e.type))t=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:n}=this,r=n.getOpenGLRenderWindow().get3DContext().canvas;t=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,r)}return t}console.warn("Viewport is too small",e.sWidth,e.sHeight)}_renderViewportFromVtkCanvasToOnscreenCanvas(e,t){const{element:n,canvas:r,sx:i,sy:o,sWidth:a,sHeight:s,id:l,renderingEngineId:c,suppressEvents:u}=e,{width:d,height:p}=r;return r.getContext("2d").drawImage(t,i,o,a,s,0,0,d,p),{element:n,suppressEvents:u,viewportId:l,renderingEngineId:c,viewportStatus:e.viewportStatus}}_resetViewport(e){const t=this.id,{element:n,canvas:i,id:s}=e,l={element:n,viewportId:s,renderingEngineId:t};e.removeWidgets(),(0,a.triggerEvent)(o.Z,r.Z.ELEMENT_DISABLED,l),n.removeAttribute("data-viewport-uid"),n.removeAttribute("data-rendering-engine-uid");i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(e=>{this._resetViewport(e)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){!function(e){const t=document.createElement("a");t.download="viewport.png",t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}(this._debugRender())}_debugRender(){const{offscreenMultiRenderWindow:e}=this,t=e.getRenderWindow(),n=e.getRenderers();for(let e=0;e<n.length;e++)n[e].renderer.setDraw(!0);t.render();const r=e.getOpenGLRenderWindow().get3DContext().canvas,i=r.toDataURL();return this._getViewportsAsArray().forEach(e=>{const{sx:t,sy:n,sWidth:i,sHeight:o}=e,a=e.canvas,{width:s,height:l}=a;a.getContext("2d").drawImage(r,t,n,i,o,0,0,s,l)}),i}};var w=n(9138);n(25281);const E=C},90872:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const r={},i={get:e=>r[e],set:e=>{const t=e.id;r[t]=e},delete:e=>delete r[e],getAll:()=>{const e=Object.keys(r).map(e=>r[e]);return e.sort((e,t)=>"_"===e.id[0]&&"_"!==t.id[0]?1:"_"!==e.id[0]&&"_"===t.id[0]?-1:0),e}}},63466:(e,t,n)=>{"use strict";n.d(t,{Ak:()=>jt,Iy:()=>Zt.ZP,aB:()=>Yt});var r=n(6685),i=n(89262),o=n(68470);const a=Object.create(null);function s(e,t){a[e]=t}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a[e]&&a[e](t)}const c={defaultViewAPI:"WebGL",renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),o.m.obj(e,t),o.m.setGet(e,t,["interactor","numberOfLayers","_views","defaultViewAPI"]),o.m.get(e,t,["neverRendered"]),o.m.getArray(e,t,["renderers","childRenderWindows"]),o.m.moveToProtected(e,t,["views"]),o.m.event(e,t,"completion"),function(e,t){t.classHierarchy.push("vtkRenderWindow"),e.addRenderer=n=>{e.hasRenderer(n)||(n.setRenderWindow(e),t.renderers.push(n),e.modified())},e.removeRenderer=n=>{t.renderers=t.renderers.filter(e=>e!==n),e.modified()},e.hasRenderer=e=>-1!==t.renderers.indexOf(e),e.newAPISpecificView=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l(e||t.defaultViewAPI,n)},e.addView=n=>{e.hasView(n)||(n.setRenderable(e),t._views.push(n),e.modified())},e.removeView=n=>{t._views=t._views.filter(e=>e!==n),e.modified()},e.hasView=e=>-1!==t._views.indexOf(e),e.preRender=()=>{t.renderers.forEach(e=>{e.isActiveCameraCreated()||e.resetCamera()})},e.render=()=>{e.preRender(),t.interactor?t.interactor.render():t._views.forEach(e=>e.traverseAllPasses())},e.getStatistics=()=>{const e={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return t._views.forEach(t=>{t.getGraphicsMemoryInfo&&(e.gpuMemoryMB+=t.getGraphicsMemoryInfo()/1e6)}),t.renderers.forEach(n=>{const r=n.getViewProps(),i=t._views[0].getViewNodeFor(n);r.forEach(t=>{if(t.getVisibility()){e.propCount+=1;const n=t.getMapper&&t.getMapper();if(n&&n.getPrimitiveCount){const t=i.getViewNodeFor(n);if(t){t.getAllocatedGPUMemoryInBytes&&(e.gpuMemoryMB+=t.getAllocatedGPUMemoryInBytes()/1e6);const r=n.getPrimitiveCount();Object.keys(r).forEach(t=>{e[t]||(e[t]=0),e[t]+=r[t]})}}}else e.invisiblePropCount+=1})}),e.str=Object.keys(e).map(t=>`${t}: ${e[t]}`).join("\n"),e},e.captureImages=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.m.setImmediate(e.render),t._views.map(e=>e.captureNextImage?e.captureNextImage(n,r):void 0).filter(e=>!!e)},e.addRenderWindow=n=>!t.childRenderWindows.includes(n)&&(t.childRenderWindows.push(n),e.modified(),!0)}(e,t)}var d={newInstance:o.m.newInstance(u,"vtkRenderWindow"),extend:u,registerViewConstructor:s,listViewAPIs:function(){return Object.keys(a)},newAPISpecificView:l},p=n(93245);const h={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,h,n),o.m.obj(e,t),o.m.get(e,t,["currentOperation"]),o.m.setGet(e,t,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),o.m.moveToProtected(e,t,["currentParent"]),function(e,t){t.classHierarchy.push("vtkRenderPass"),e.getOperation=()=>t.currentOperation,e.setCurrentOperation=e=>{t.currentOperation=e,t.currentTraverseOperation=`traverse${o.m.capitalize(t.currentOperation)}`},e.getTraverseOperation=()=>t.currentTraverseOperation,e.traverse=function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t.deleted||(t._currentParent=r,t.preDelegateOperations.forEach(t=>{e.setCurrentOperation(t),n.traverse(e)}),t.delegates.forEach(t=>{t.traverse(n,e)}),t.postDelegateOperations.forEach(t=>{e.setCurrentOperation(t),n.traverse(e)}))}}(e,t)}var m={newInstance:o.m.newInstance(f,"vtkRenderPass"),extend:f},g=n(41247),v=n(54131),y=n(59269),b=n(98589),C=n(53118),w=n(62739);const{Representation:E}=b.default,{vtkErrorMacro:T}=o.m;function x(e){const t=C.Z.substitute(e.Fragment,"//VTK::RenderPassFragmentShader::Impl","\n      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);\n      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);\n      gl_FragData[1].r = weight;\n    ",!1);e.Fragment=t.result}const _={framebuffer:null,copyShader:null,tris:null};function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,_,n),m.extend(e,t,n),t.VBOBuildTime={},o.m.obj(t.VBOBuildTime,{mtime:0}),t.tris=y.default.newInstance(),o.m.get(e,t,["framebuffer"]),function(e,t){t.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),e.createVertexBuffer=()=>{const e=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),r=new Uint16Array([4,0,1,3,2]),i=v.default.newInstance({numberOfComponents:3,values:e});i.setName("points");const o=v.default.newInstance({numberOfComponents:2,values:n});o.setName("tcoords");const a=v.default.newInstance({numberOfComponents:1,values:r});t.tris.getCABO().createVBO(a,"polys",E.SURFACE,{points:i,tcoords:o,cellOffset:0}),t.VBOBuildTime.modified()},e.createFramebuffer=e=>{const n=e.getSize(),r=e.getContext();t.framebuffer=p.ZP.newInstance(),t.framebuffer.setOpenGLRenderWindow(e),t.framebuffer.create(...n),t.framebuffer.saveCurrentBindingsAndBuffers(),t.framebuffer.bind(),t.translucentRGBATexture=g.default.newInstance(),t.translucentRGBATexture.setInternalFormat(r.RGBA16F),t.translucentRGBATexture.setFormat(r.RGBA),t.translucentRGBATexture.setOpenGLDataType(r.HALF_FLOAT),t.translucentRGBATexture.setOpenGLRenderWindow(e),t.translucentRGBATexture.create2DFromRaw(n[0],n[1],4,"Float32Array",null),t.translucentRTexture=g.default.newInstance(),t.translucentRTexture.setInternalFormat(r.R16F),t.translucentRTexture.setFormat(r.RED),t.translucentRTexture.setOpenGLDataType(r.HALF_FLOAT),t.translucentRTexture.setOpenGLRenderWindow(e),t.translucentRTexture.create2DFromRaw(n[0],n[1],1,"Float32Array",null),t.translucentZTexture=g.default.newInstance(),t.translucentZTexture.setOpenGLRenderWindow(e),t.translucentZTexture.createDepthFromRaw(n[0],n[1],"Float32Array",null),t.framebuffer.setColorBuffer(t.translucentRGBATexture,0),t.framebuffer.setColorBuffer(t.translucentRTexture,1),t.framebuffer.setDepthBuffer(t.translucentZTexture)},e.createCopyShader=e=>{t.copyShader=e.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join("\n"),"//VTK::System::Dec\n\nin vec2 tcoord;\n\nuniform sampler2D translucentRTexture;\nuniform sampler2D translucentRGBATexture;\n\n// the output of this shader\n//VTK::Output::Dec\n\nvoid main()\n{\n  vec4 t1Color = texture(translucentRGBATexture, tcoord);\n  float t2Color = texture(translucentRTexture, tcoord).r;\n  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);\n}\n","")},e.createVBO=n=>{const r=n.getContext();t.tris.setOpenGLRenderWindow(n),e.createVertexBuffer();const i=t.copyShader;t.tris.getCABO().bind(),t.copyVAO.addAttributeArray(i,t.tris.getCABO(),"vertexDC",t.tris.getCABO().getVertexOffset(),t.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||T("Error setting vertexDC in copy shader VAO."),t.copyVAO.addAttributeArray(i,t.tris.getCABO(),"tcoordTC",t.tris.getCABO().getTCoordOffset(),t.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||T("Error setting vertexDC in copy shader VAO.")},e.traverse=(n,r,i)=>{if(t.deleted)return;const o=n.getSize(),a=n.getContext();if(t._supported=!1,r.getSelector()||!a||!n.getWebgl2()||!a.getExtension("EXT_color_buffer_half_float")&&!a.getExtension("EXT_color_buffer_float"))return e.setCurrentOperation("translucentPass"),void r.traverse(e);if(t._supported=!0,null===t.framebuffer)e.createFramebuffer(n);else{const r=t.framebuffer.getSize();null===r||r[0]!==o[0]||r[1]!==o[1]?(t.framebuffer.releaseGraphicsResources(),t.translucentRGBATexture.releaseGraphicsResources(n),t.translucentRTexture.releaseGraphicsResources(n),t.translucentZTexture.releaseGraphicsResources(n),e.createFramebuffer(n)):(t.framebuffer.saveCurrentBindingsAndBuffers(),t.framebuffer.bind())}a.drawBuffers([a.COLOR_ATTACHMENT0]),a.clearBufferfv(a.COLOR,0,[0,0,0,0]),a.clearBufferfv(a.DEPTH,0,[1]),a.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),r.traverse(i)),a.colorMask(!0,!0,!0,!0),a.drawBuffers([a.COLOR_ATTACHMENT0,a.COLOR_ATTACHMENT1]),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),a.clearBufferfv(a.COLOR,0,[0,0,0,1]),a.clearBufferfv(a.COLOR,1,[0,0,0,0]),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFuncSeparate(a.ONE,a.ONE,a.ZERO,a.ONE_MINUS_SRC_ALPHA),e.setCurrentOperation("translucentPass"),r.traverse(e),a.drawBuffers([a.NONE]),t.framebuffer.restorePreviousBindingsAndBuffers(),null===t.copyShader?e.createCopyShader(n):n.getShaderCache().readyShaderProgram(t.copyShader),t.copyVAO||(t.copyVAO=w.ZP.newInstance(),t.copyVAO.setOpenGLRenderWindow(n)),t.copyVAO.bind(),t.VBOBuildTime.getMTime()<e.getMTime()&&e.createVBO(n),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),a.depthMask(!1),a.depthFunc(a.ALWAYS),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),t.translucentRGBATexture.activate(),t.copyShader.setUniformi("translucentRGBATexture",t.translucentRGBATexture.getTextureUnit()),t.translucentRTexture.activate(),t.copyShader.setUniformi("translucentRTexture",t.translucentRTexture.getTextureUnit()),a.drawArrays(a.TRIANGLES,0,t.tris.getCABO().getElementCount()),a.depthMask(!0),a.depthFunc(a.LEQUAL),t.translucentRGBATexture.deactivate(),t.translucentRTexture.deactivate();const s=r.getTiledSizeAndOrigin();a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},e.getShaderReplacement=()=>t._supported?x:null,e.releaseGraphicsResources=n=>{t.framebuffer&&(t.framebuffer.releaseGraphicsResources(n),t.framebuffer=null),t.translucentRGBATexture&&(t.translucentRGBATexture.releaseGraphicsResources(n),t.translucentRGBATexture=null),t.translucentRTexture&&(t.translucentRTexture.releaseGraphicsResources(n),t.translucentRTexture=null),t.translucentZTexture&&(t.translucentZTexture.releaseGraphicsResources(n),t.translucentZTexture=null),t.copyVAO&&(t.copyVAO.releaseGraphicsResources(n),t.copyVAO=null),t.copyShader&&(t.copyShader.releaseGraphicsResources(n),t.copyShader=null),t.tris&&(t.tris.releaseGraphicsResources(n),t.tris=null),e.modified()}}(e,t)}var I={newInstance:o.m.newInstance(S,"vtkOpenGLOrderIndependentTranslucentPass"),extend:S};const D={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function A(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,D,n),m.extend(e,t,n),o.m.get(e,t,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),function(e,t){t.classHierarchy.push("vtkForwardPass"),e.traverse=function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t.deleted)return;t._currentParent=r,e.setCurrentOperation("buildPass"),n.traverse(e);const i=n.getRenderable().getNumberOfLayers(),o=n.getRenderable().getRenderersByReference();for(let r=0;r<i;r++)for(let i=0;i<o.length;i++){const a=o[i],s=n.getViewNodeFor(a);if(a.getDraw()&&a.getLayer()===r){if(t.opaqueActorCount=0,t.translucentActorCount=0,t.volumeCount=0,t.overlayActorCount=0,e.setCurrentOperation("queryPass"),s.traverse(e),(t.opaqueActorCount>0||t.translucentActorCount>0)&&t.volumeCount>0||t.depthRequested){const r=n.getFramebufferSize();null===t.framebuffer&&(t.framebuffer=p.ZP.newInstance()),t.framebuffer.setOpenGLRenderWindow(n),t.framebuffer.saveCurrentBindingsAndBuffers();const i=t.framebuffer.getSize();null!==i&&i[0]===r[0]&&i[1]===r[1]||(t.framebuffer.create(r[0],r[1]),t.framebuffer.populateFramebuffer()),t.framebuffer.bind(),e.setCurrentOperation("zBufferPass"),s.traverse(e),t.framebuffer.restorePreviousBindingsAndBuffers(),t.depthRequested=!1}e.setCurrentOperation("cameraPass"),s.traverse(e),t.opaqueActorCount>0&&(e.setCurrentOperation("opaquePass"),s.traverse(e)),t.translucentActorCount>0&&(t.translucentPass||(t.translucentPass=I.newInstance()),t.translucentPass.traverse(n,s,e)),t.volumeCount>0&&(e.setCurrentOperation("volumePass"),s.traverse(e)),t.overlayActorCount>0&&(e.setCurrentOperation("overlayPass"),s.traverse(e))}}},e.getZBufferTexture=()=>t.framebuffer?t.framebuffer.getColorTexture():null,e.requestDepth=()=>{t.depthRequested=!0},e.incrementOpaqueActorCount=()=>t.opaqueActorCount++,e.incrementTranslucentActorCount=()=>t.translucentActorCount++,e.incrementVolumeCount=()=>t.volumeCount++,e.incrementOverlayActorCount=()=>t.overlayActorCount++}(e,t)}var P={newInstance:o.m.newInstance(A,"vtkForwardPass"),extend:A},O=n(18603),R=n(14418);const{FieldAssociations:M}=R.default;const N={fieldAssociation:M.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function L(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,N,n),o.m.obj(e,t),o.m.setGet(e,t,["fieldAssociation","captureZValues"]),function(e,t){t.classHierarchy.push("vtkHardwareSelector"),e.getSourceDataAsync=async(e,t,n,r,i)=>{},e.selectAsync=async(t,n,r,i,o)=>{const a=await e.getSourceDataAsync(t,n,r,i,o);return a?a.generateSelection(n,r,i,o):[]}}(e,t)}var k={newInstance:o.m.newInstance(L,"vtkHardwareSelector"),extend:L};var F={SelectionContent:{GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},SelectionField:{CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5}};const V={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function U(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,V,n),o.m.obj(e,t),t.properties={},o.m.setGet(e,t,["contentType","fieldType","properties","selectionList"]),function(e,t){t.classHierarchy.push("vtkSelectionNode"),e.getBounds=()=>t.points.getBounds()}(e,t)}var B={newInstance:o.m.newInstance(U,"vtkSelectionNode"),extend:U,...F};const{PassTypes:G}=O.default,{SelectionContent:W,SelectionField:z}=B,{FieldAssociations:H}=R.default,{vtkErrorMacro:j}=o.m;function Z(e){return`${e.propID} ${e.compositeID}`}function K(e,t,n,r){if(!n)return 0;return n[4*(t*(r[2]-r[0]+1)+e)+3]}function $(e,t,n,r){if(!n)return 0;const i=4*(t*(r[2]-r[0]+1)+e),o=n[i],a=n[i+1];return 256*(256*n[i+2]+a)+o}function q(e,t){let n=t;return n<<=24,n|=e,n}function X(e,t,n,r){const i=n<0?0:n;if(0===i){if(r[0]=t[0],r[1]=t[1],t[0]<e.area[0]||t[0]>e.area[2]||t[1]<e.area[1]||t[1]>e.area[3])return null;const n=[t[0]-e.area[0],t[1]-e.area[1]],i=$(n[0],n[1],e.pixBuffer[G.ACTOR_PASS],e.area);if(i<=0||i-1>=e.props.length)return null;const o={valid:!0};o.propID=i-1,o.prop=e.props[o.propID];let a=$(n[0],n[1],e.pixBuffer[G.COMPOSITE_INDEX_PASS],e.area);if((a<0||a>16777215)&&(a=0),o.compositeID=a-1,e.captureZValues){const r=4*(n[1]*(e.area[2]-e.area[0]+1)+n[0]);o.zValue=(256*e.zBuffer[r]+e.zBuffer[r+1])/65535,o.displayPosition=t}if(e.pixBuffer[G.ID_LOW24]&&0===K(n[0],n[1],e.pixBuffer[G.ID_LOW24],e.area))return o;const s=$(n[0],n[1],e.pixBuffer[G.ID_LOW24],e.area),l=$(n[0],n[1],e.pixBuffer[G.ID_HIGH24],e.area);return o.attributeID=q(s,l),o}const o=[t[0],t[1]],a=[0,0];let s=X(e,t,0,r);if(s&&s.valid)return s;for(let t=1;t<i;++t){for(let n=o[1]>t?o[1]-t:0;n<=o[1]+t;++n){if(a[1]=n,o[0]>=t&&(a[0]=o[0]-t,s=X(e,a,0,r),s&&s.valid))return s;if(a[0]=o[0]+t,s=X(e,a,0,r),s&&s.valid)return s}for(let n=o[0]>=t?o[0]-(t-1):0;n<=o[0]+(t-1);++n){if(a[0]=n,o[1]>=t&&(a[1]=o[1]-t,s=X(e,a,0,r),s&&s.valid))return s;if(a[1]=o[1]+t,s=X(e,a,0,r),s&&s.valid)return s}}return r[0]=t[0],r[1]=t[1],null}function Y(e,t,n,r,i){const o=[];let a=0;return t.forEach((t,s)=>{const l=B.newInstance();switch(l.setContentType(W.INDICES),e){case H.FIELD_ASSOCIATION_CELLS:l.setFieldType(z.CELL);break;case H.FIELD_ASSOCIATION_POINTS:l.setFieldType(z.POINT);break;default:j("Unknown field association")}l.getProperties().propID=t.info.propID,l.getProperties().prop=t.info.prop,l.getProperties().compositeID=t.info.compositeID,l.getProperties().attributeID=t.info.attributeID,l.getProperties().pixelCount=t.pixelCount,n&&(l.getProperties().displayPosition=[t.info.displayPosition[0],t.info.displayPosition[1],t.info.zValue],l.getProperties().worldPosition=i.displayToWorld(t.info.displayPosition[0],t.info.displayPosition[1],t.info.zValue,r)),l.setSelectionList(t.attributeIDs),o[a]=l,a++}),o}function J(e,t){t.classHierarchy.push("vtkOpenGLHardwareSelector"),e.releasePixBuffers=()=>{t.rawPixBuffer=[],t.pixBuffer=[],t.zBuffer=null},e.beginSelection=()=>{t._openGLRenderer=t._openGLRenderWindow.getViewNodeFor(t._renderer),t.maxAttributeId=0;const n=t._openGLRenderWindow.getSize();if(t.framebuffer){t.framebuffer.setOpenGLRenderWindow(t._openGLRenderWindow),t.framebuffer.saveCurrentBindingsAndBuffers();const e=t.framebuffer.getSize();e&&e[0]===n[0]&&e[1]===n[1]?t.framebuffer.bind():(t.framebuffer.create(n[0],n[1]),t.framebuffer.populateFramebuffer())}else t.framebuffer=p.ZP.newInstance(),t.framebuffer.setOpenGLRenderWindow(t._openGLRenderWindow),t.framebuffer.saveCurrentBindingsAndBuffers(),t.framebuffer.create(n[0],n[1]),t.framebuffer.populateFramebuffer();if(t._openGLRenderer.clear(),t._openGLRenderer.setSelector(e),t.hitProps={},t.propPixels={},t.props=[],e.releasePixBuffers(),t.fieldAssociation===H.FIELD_ASSOCIATION_POINTS){const e=t._openGLRenderWindow.getContext(),n=e.isEnabled(e.BLEND);e.disable(e.BLEND),t._openGLRenderWindow.traverseAllPasses(),n&&e.enable(e.BLEND)}},e.endSelection=()=>{t.hitProps={},t._openGLRenderer.setSelector(null),t.framebuffer.restorePreviousBindingsAndBuffers()},e.preCapturePass=()=>{const e=t._openGLRenderWindow.getContext();t.originalBlending=e.isEnabled(e.BLEND),e.disable(e.BLEND)},e.postCapturePass=()=>{const e=t._openGLRenderWindow.getContext();t.originalBlending&&e.enable(e.BLEND)},e.select=()=>{let n=null;return e.captureBuffers()&&(n=e.generateSelection(t.area[0],t.area[1],t.area[2],t.area[3]),e.releasePixBuffers()),n},e.getSourceDataAsync=async(n,r,i,o,a)=>{if(t._renderer=n,void 0===r){const n=t._openGLRenderWindow.getSize();e.setArea(0,0,n[0]-1,n[1]-1)}else e.setArea(r,i,o,a);if(!e.captureBuffers())return!1;const s={area:[...t.area],pixBuffer:[...t.pixBuffer],captureZValues:t.captureZValues,zBuffer:t.zBuffer,props:[...t.props],fieldAssociation:t.fieldAssociation,renderer:n,openGLRenderWindow:t._openGLRenderWindow};return s.generateSelection=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,t,n,r,i){const o=Math.floor(t),a=Math.floor(n),s=Math.floor(r),l=Math.floor(i),c=new Map,u=[0,0];for(let t=a;t<=l;t++)for(let n=o;n<=s;n++){const r=X(e,[n,t],0,u);if(r&&r.valid){const t=Z(r);if(c.has(t)){const n=c.get(t);n.pixelCount++,e.captureZValues&&r.zValue<n.info.zValue&&(n.info=r),-1===n.attributeIDs.indexOf(r.attributeID)&&n.attributeIDs.push(r.attributeID)}else c.set(t,{info:r,pixelCount:1,attributeIDs:[r.attributeID]})}}return Y(e.fieldAssociation,c,e.captureZValues,e.renderer,e.openGLRenderWindow)}(s,...t)},s},e.captureBuffers=()=>{if(!t._renderer||!t._openGLRenderWindow)return j("Renderer and view must be set before calling Select."),!1;t._openGLRenderer=t._openGLRenderWindow.getViewNodeFor(t._renderer),t._openGLRenderWindow.getRenderable().preRender(),e.invokeEvent({type:"StartEvent"}),t.originalBackground=t._renderer.getBackgroundByReference(),t._renderer.setBackground(0,0,0,0);const n=t._openGLRenderWindow.getRenderPasses();for(e.beginSelection(),t.currentPass=G.MIN_KNOWN_PASS;t.currentPass<=G.MAX_KNOWN_PASS;t.currentPass++)e.passRequired(t.currentPass)&&(e.preCapturePass(t.currentPass),t.captureZValues&&t.currentPass===G.ACTOR_PASS&&"function"==typeof n[0].requestDepth&&"function"==typeof n[0].getFramebuffer?(n[0].requestDepth(),t._openGLRenderWindow.traverseAllPasses()):t._openGLRenderWindow.traverseAllPasses(),e.postCapturePass(t.currentPass),e.savePixelBuffer(t.currentPass),e.processPixelBuffers());return e.endSelection(),t._renderer.setBackground(t.originalBackground),e.invokeEvent({type:"EndEvent"}),!0},e.processPixelBuffers=()=>{t.props.forEach((n,r)=>{e.isPropHit(r)&&n.processSelectorPixelBuffers(e,t.propPixels[r])})},e.passRequired=e=>{if(e===G.ID_HIGH24){if(t.fieldAssociation===H.FIELD_ASSOCIATION_POINTS)return t.maximumPointId>16777215;if(t.fieldAssociation===H.FIELD_ASSOCIATION_CELLS)return t.maximumCellId>16777215}return!0},e.savePixelBuffer=n=>{if(t.pixBuffer[n]=t._openGLRenderWindow.getPixelData(t.area[0],t.area[1],t.area[2],t.area[3]),!t.rawPixBuffer[n]){const e=(t.area[2]-t.area[0]+1)*(t.area[3]-t.area[1]+1)*4;t.rawPixBuffer[n]=new Uint8Array(e),t.rawPixBuffer[n].set(t.pixBuffer[n])}if(n===G.ACTOR_PASS){if(t.captureZValues){const e=t._openGLRenderWindow.getRenderPasses();if("function"==typeof e[0].requestDepth&&"function"==typeof e[0].getFramebuffer){const n=e[0].getFramebuffer();n.saveCurrentBindingsAndBuffers(),n.bind(),t.zBuffer=t._openGLRenderWindow.getPixelData(t.area[0],t.area[1],t.area[2],t.area[3]),n.restorePreviousBindingsAndBuffers()}}e.buildPropHitList(t.rawPixBuffer[n])}},e.buildPropHitList=e=>{let n=0;for(let r=0;r<=t.area[3]-t.area[1];r++)for(let i=0;i<=t.area[2]-t.area[0];i++){let o=$(i,r,e,t.area);o>0&&(o--,o in t.hitProps||(t.hitProps[o]=!0,t.propPixels[o]=[]),t.propPixels[o].push(4*n)),++n}},e.renderProp=n=>{t.currentPass===G.ACTOR_PASS&&(e.setPropColorValueFromInt(t.props.length+1),t.props.push(n))},e.renderCompositeIndex=n=>{t.currentPass===G.COMPOSITE_INDEX_PASS&&e.setPropColorValueFromInt(n+1)},e.renderAttributeId=e=>{e<0||(t.maxAttributeId=e>t.maxAttributeId?e:t.maxAttributeId)},e.passTypeToString=e=>o.m.enumToString(G,e),e.isPropHit=e=>Boolean(t.hitProps[e]),e.setPropColorValueFromInt=e=>{t.propColorValue[0]=e%256/255,t.propColorValue[1]=Math.floor(e/256)%256/255,t.propColorValue[2]=Math.floor(e/65536)%256/255},e.getPixelInformation=(n,r,i)=>{const o=r<0?0:r;if(0===o){if(i[0]=n[0],i[1]=n[1],n[0]<t.area[0]||n[0]>t.area[2]||n[1]<t.area[1]||n[1]>t.area[3])return null;const e=[n[0]-t.area[0],n[1]-t.area[1]],r=$(e[0],e[1],t.pixBuffer[G.ACTOR_PASS],t.area);if(r<=0||r-1>=t.props.length)return null;const o={valid:!0};o.propID=r-1,o.prop=t.props[o.propID];let a=$(e[0],e[1],t.pixBuffer[G.COMPOSITE_INDEX_PASS],t.area);if((a<0||a>16777215)&&(a=0),o.compositeID=a-1,t.captureZValues){const r=4*(e[1]*(t.area[2]-t.area[0]+1)+e[0]);o.zValue=(256*t.zBuffer[r]+t.zBuffer[r+1])/65535,o.displayPosition=n}if(t.pixBuffer[G.ID_LOW24]&&0===K(e[0],e[1],t.pixBuffer[G.ID_LOW24],t.area))return o;const s=$(e[0],e[1],t.pixBuffer[G.ID_LOW24],t.area),l=$(e[0],e[1],t.pixBuffer[G.ID_HIGH24],t.area);return o.attributeID=q(s,l),o}const a=[n[0],n[1]],s=[0,0];let l=e.getPixelInformation(n,0,i);if(l&&l.valid)return l;for(let t=1;t<o;++t){for(let n=a[1]>t?a[1]-t:0;n<=a[1]+t;++n){if(s[1]=n,a[0]>=t&&(s[0]=a[0]-t,l=e.getPixelInformation(s,0,i),l&&l.valid))return l;if(s[0]=a[0]+t,l=e.getPixelInformation(s,0,i),l&&l.valid)return l}for(let n=a[0]>=t?a[0]-(t-1):0;n<=a[0]+(t-1);++n){if(s[0]=n,a[1]>=t&&(s[1]=a[1]-t,l=e.getPixelInformation(s,0,i),l&&l.valid))return l;if(s[1]=a[1]+t,l=e.getPixelInformation(s,0,i),l&&l.valid)return l}}return i[0]=n[0],i[1]=n[1],null},e.generateSelection=(n,r,i,o)=>{const a=Math.floor(n),s=Math.floor(r),l=Math.floor(i),c=Math.floor(o),u=new Map,d=[0,0];for(let n=s;n<=c;n++)for(let r=a;r<=l;r++){const i=[r,n],o=e.getPixelInformation(i,0,d);if(o&&o.valid){const e=Z(o);if(u.has(e)){const n=u.get(e);n.pixelCount++,t.captureZValues&&o.zValue<n.info.zValue&&(n.info=o),-1===n.attributeIDs.indexOf(o.attributeID)&&n.attributeIDs.push(o.attributeID)}else u.set(e,{info:o,pixelCount:1,attributeIDs:[o.attributeID]})}}return Y(t.fieldAssociation,u,t.captureZValues,t._renderer,t._openGLRenderWindow)},e.getRawPixelBuffer=e=>t.rawPixBuffer[e],e.getPixelBuffer=e=>t.pixBuffer[e],e.attach=(e,n)=>{t._openGLRenderWindow=e,t._renderer=n};const n=e.setArea;e.setArea=function(){return!!n(...arguments)&&(t.area[0]=Math.floor(t.area[0]),t.area[1]=Math.floor(t.area[1]),t.area[2]=Math.floor(t.area[2]),t.area[3]=Math.floor(t.area[3]),!0)}}const Q={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function ee(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Q,n),k.extend(e,t,n),t.propColorValue=[0,0,0],t.props=[],t.area||(t.area=[0,0,0,0]),o.m.setGetArray(e,t,["area"],4),o.m.setGet(e,t,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),o.m.setGetArray(e,t,["propColorValue"],3),o.m.moveToProtected(e,t,["renderer","openGLRenderWindow"]),o.m.event(e,t,"event"),J(e,t)}var te={newInstance:o.m.newInstance(ee,"vtkOpenGLHardwareSelector"),extend:ee,...O.default},ne=n(20840),re=n.n(ne);const ie=["lastShaderProgramBound","context","_openGLRenderWindow"];const oe={lastShaderProgramBound:null,shaderPrograms:null,context:null};function ae(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,oe,n),t.shaderPrograms={},o.m.obj(e,t),o.m.setGet(e,t,ie),o.m.moveToProtected(e,t,["openGLRenderWindow"]),function(e,t){t.classHierarchy.push("vtkShaderCache"),e.replaceShaderValues=(e,n,r)=>{let i=n;r.length>0&&(i=C.Z.substitute(i,"VSOut","GSOut").result);const o=t._openGLRenderWindow.getWebgl2();let a="\n",s="#version 100\n";o?s="#version 300 es\n#define attribute in\n#define textureCube texture\n#define texture2D texture\n#define textureCubeLod textureLod\n#define texture2DLod textureLod\n":(t.context.getExtension("OES_standard_derivatives"),t.context.getExtension("EXT_frag_depth")&&(a="#extension GL_EXT_frag_depth : enable\n"),t.context.getExtension("EXT_shader_texture_lod")&&(a+="#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod textureCubeLodEXT\n#define texture2DLod texture2DLodEXT")),i=C.Z.substitute(i,"//VTK::System::Dec",[`${s}\n`,o?"":"#extension GL_OES_standard_derivatives : enable\n",a,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=C.Z.substitute(e,"//VTK::System::Dec",[`${s}\n`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){l=C.Z.substitute(l,"varying","out").result,i=C.Z.substitute(i,"varying","in").result;let e="",t=0;for(;i.includes(`gl_FragData[${t}]`);)i=C.Z.substitute(i,`gl_FragData\\[${t}\\]`,`fragOutput${t}`).result,e+=`layout(location = ${t}) out vec4 fragOutput${t};\n`,t++;i=C.Z.substitute(i,"//VTK::Output::Dec",e).result}return{VSSource:l,FSSource:i,GSSource:C.Z.substitute(r,"//VTK::System::Dec",s).result}},e.readyShaderProgramArray=(t,n,r)=>{const i=e.replaceShaderValues(t,n,r),o=e.getShaderProgram(i.VSSource,i.FSSource,i.GSSource);return e.readyShaderProgram(o)},e.readyShaderProgram=t=>t&&(t.getCompiled()||t.compileShader())&&e.bindShaderProgram(t)?t:null,e.getShaderProgram=(e,n,r)=>{const i=`${e}${n}${r}`,o=re().hash(i);if(!(o in t.shaderPrograms)){const i=C.Z.newInstance();return i.setContext(t.context),i.getVertexShader().setSource(e),i.getFragmentShader().setSource(n),r&&i.getGeometryShader().setSource(r),i.setMd5Hash(o),t.shaderPrograms[o]=i,i}return t.shaderPrograms[o]},e.releaseGraphicsResources=n=>{e.releaseCurrentShaderProgram(),Object.keys(t.shaderPrograms).map(e=>t.shaderPrograms[e]).forEach(e=>e.cleanup()),t.shaderPrograms={}},e.releaseCurrentShaderProgram=()=>{t.lastShaderProgramBound&&(t.lastShaderProgramBound.cleanup(),t.lastShaderProgramBound=null)},e.bindShaderProgram=e=>(t.lastShaderProgramBound===e||(t.lastShaderProgramBound&&t.lastShaderProgramBound.release(),e.bind(),t.lastShaderProgramBound=e),1)}(e,t)}var se={newInstance:o.m.newInstance(ae,"vtkShaderCache"),extend:ae};const{vtkErrorMacro:le}=o.m;const ce={context:null,numberOfTextureUnits:0,textureUnits:0};function ue(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ce,n),o.m.obj(e,t),t.textureUnits=[],o.m.get(e,t,["numberOfTextureUnits"]),o.m.setGet(e,t,["context"]),function(e,t){t.classHierarchy.push("vtkOpenGLTextureUnitManager"),e.deleteTable=()=>{for(let e=0;e<t.numberOfTextureUnits;++e)!0===t.textureUnits[e]&&le("some texture units  were not properly released");t.textureUnits=[],t.numberOfTextureUnits=0},e.setContext=n=>{if(t.context!==n){if(0!==t.context&&e.deleteTable(),t.context=n,t.context){t.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let e=0;e<t.numberOfTextureUnits;++e)t.textureUnits[e]=!1}e.modified()}},e.allocate=()=>{for(let n=0;n<t.numberOfTextureUnits;n++)if(!e.isAllocated(n))return t.textureUnits[n]=!0,n;return-1},e.allocateUnit=n=>e.isAllocated(n)?-1:(t.textureUnits[n]=!0,n),e.isAllocated=e=>t.textureUnits[e],e.free=e=>{t.textureUnits[e]=!1},e.freeAll=()=>{for(let e=0;e<t.numberOfTextureUnits;++e)t.textureUnits[e]=!1}}(e,t)}var de={newInstance:o.m.newInstance(ue,"vtkOpenGLTextureUnitManager"),extend:ue},pe=n(11145),he=n(6814);const fe={size:void 0,selector:void 0};function me(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,fe,n),t.size||(t.size=[300,300]),o.m.getArray(e,t,["size"],2),o.m.get(e,t,["selector"]),he.Z.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkRenderWindowViewNode"),e.getViewNodeFactory=()=>null,e.getAspectRatio=()=>t.size[0]/t.size[1],e.getAspectRatioForRenderer=e=>{const n=e.getViewportByReference();return t.size[0]*(n[2]-n[0])/((n[3]-n[1])*t.size[1])},e.isInViewport=(t,n,r)=>{const i=r.getViewportByReference(),o=e.getFramebufferSize();return i[0]*o[0]<=t&&i[2]*o[0]>=t&&i[1]*o[1]<=n&&i[3]*o[1]>=n},e.getViewportSize=t=>{const n=t.getViewportByReference(),r=e.getFramebufferSize();return[(n[2]-n[0])*r[0],(n[3]-n[1])*r[1]]},e.getViewportCenter=t=>{const n=e.getViewportSize(t);return[.5*n[0],.5*n[1]]},e.displayToNormalizedDisplay=(t,n,r)=>{const i=e.getFramebufferSize();return[t/i[0],n/i[1],r]},e.normalizedDisplayToDisplay=(t,n,r)=>{const i=e.getFramebufferSize();return[t*i[0],n*i[1],r]},e.worldToView=(e,t,n,r)=>r.worldToView(e,t,n),e.viewToWorld=(e,t,n,r)=>r.viewToWorld(e,t,n),e.worldToDisplay=(t,n,r,i)=>{const o=i.worldToView(t,n,r),a=e.getViewportSize(i),s=i.viewToProjection(o[0],o[1],o[2],a[0]/a[1]),l=i.projectionToNormalizedDisplay(s[0],s[1],s[2]);return e.normalizedDisplayToDisplay(l[0],l[1],l[2])},e.displayToWorld=(t,n,r,i)=>{const o=e.displayToNormalizedDisplay(t,n,r),a=i.normalizedDisplayToProjection(o[0],o[1],o[2]),s=e.getViewportSize(i),l=i.projectionToView(a[0],a[1],a[2],s[0]/s[1]);return i.viewToWorld(l[0],l[1],l[2])},e.normalizedDisplayToViewport=(t,n,r,i)=>{let o=i.getViewportByReference();o=e.normalizedDisplayToDisplay(o[0],o[1],0);const a=e.normalizedDisplayToDisplay(t,n,r);return[a[0]-o[0]-.5,a[1]-o[1]-.5,r]},e.viewportToNormalizedViewport=(t,n,r,i)=>{const o=e.getViewportSize(i);return o&&0!==o[0]&&0!==o[1]?[t/(o[0]-1),n/(o[1]-1),r]:[t,n,r]},e.normalizedViewportToViewport=(t,n,r,i)=>{const o=e.getViewportSize(i);return[t*(o[0]-1),n*(o[1]-1),r]},e.displayToLocalDisplay=(t,n,r)=>[t,e.getFramebufferSize()[1]-n-1,r],e.viewportToNormalizedDisplay=(t,n,r,i)=>{let o=i.getViewportByReference();o=e.normalizedDisplayToDisplay(o[0],o[1],0);const a=t+o[0]+.5,s=n+o[1]+.5;return e.displayToNormalizedDisplay(a,s,r)},e.getComputedDevicePixelRatio=()=>t.size[0]/e.getContainerSize()[0],e.getContainerSize=()=>{o.m.vtkErrorMacro("not implemented")},e.getPixelData=(e,t,n,r)=>{o.m.vtkErrorMacro("not implemented")},e.createSelector=()=>{o.m.vtkErrorMacro("not implemented")}}(e,t)}var ge={newInstance:o.m.newInstance(me,"vtkRenderWindowViewNode"),extend:me};function ve(){const e=new Map,t={apply:(t,n,r)=>e.has(r[0])?e.get(r[0]):t.apply(n,r)};const n=Object.create(null);return n.getParameter=(e,n,r,i)=>new Proxy(i.bind(e),t),n.depthMask=(t,n,r,i)=>{return new Proxy(i.bind(t),(o=t.DEPTH_WRITEMASK,{apply:(t,n,r)=>(e.set(o,r[0]),t.apply(n,r))}));var o},{get(e,t,r){if("__getUnderlyingContext"===t)return()=>e;let i=Reflect.get(e,t,e);i instanceof Function&&(i=i.bind(e));const o=n[t];return o?o(e,t,r,i):i}}}const{vtkDebugMacro:ye,vtkErrorMacro:be}=o.m,Ce={position:"absolute",top:0,left:0,width:"100%",height:"100%"},we=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","releaseGraphicsResourcesForObject","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Ee(e,t,n){const r=e.createFramebuffer(),i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,t,2,2,0,t,n,null),e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER);return e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),o===e.FRAMEBUFFER_COMPLETE}let Te=0;const xe=[];function _e(e){e.preventDefault()}function Se(e,t){let n;t.classHierarchy.push("vtkOpenGLRenderWindow"),e.getViewNodeFactory=()=>t.myFactory,t.canvas.addEventListener("webglcontextlost",_e,!1),t.canvas.addEventListener("webglcontextrestored",e.restoreContext,!1);const r=[0,0];let a;e.onModified(function(){t.renderable&&(t.size[0]===r[0]&&t.size[1]===r[1]||(r[0]=t.size[0],r[1]=t.size[1],t.canvas.setAttribute("width",t.size[0]),t.canvas.setAttribute("height",t.size[1]))),t.viewStream&&t.viewStream.setSize(t.size[0],t.size[1]),t.canvas.style.display=t.useOffScreen?"none":"block",t.el&&(t.el.style.cursor=t.cursorVisibility?t.cursor:"none"),t.containerSize=null}),e.buildPass=n=>{if(n){if(!t.renderable)return;e.prepareNodes(),e.addMissingNodes(t.renderable.getRenderersByReference()),e.addMissingNodes(t.renderable.getChildRenderWindowsByReference()),e.removeUnusedNodes(),e.initialize(),t.children.forEach(t=>{t.setOpenGLRenderWindow?.(e)})}},e.initialize=()=>{if(!t.initialized){if(t.rootOpenGLRenderWindow=e.getLastAncestorOfType("vtkOpenGLRenderWindow"),t.rootOpenGLRenderWindow)t.context2D=e.get2DContext();else{t.context=e.get3DContext(),e.resizeFromChildRenderWindows(),t.context&&(Te++,xe.forEach(e=>e(Te))),t.textureUnitManager=de.newInstance(),t.textureUnitManager.setContext(t.context),t.shaderCache.setContext(t.context);const n=t.context;n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL),n.enable(n.BLEND)}t.initialized=!0}},e.makeCurrent=()=>{t.context.makeCurrent()},e.setContainer=n=>{t.el&&t.el!==n&&(t.canvas.parentNode!==t.el&&be("Error: canvas parent node does not match container"),t.el.removeChild(t.canvas),t.el.contains(t.bgImage)&&t.el.removeChild(t.bgImage)),t.el!==n&&(t.el=n,t.el&&(t.el.appendChild(t.canvas),t.useBackgroundImage&&t.el.appendChild(t.bgImage)),e.modified())},e.getContainer=()=>t.el,e.getContainerSize=()=>{if(!t.containerSize&&t.el){const{width:e,height:n}=t.el.getBoundingClientRect();t.containerSize=[e,n]}return t.containerSize||t.size},e.getFramebufferSize=()=>{const e=t.activeFramebuffer?.getSize();return e||t.size},e.getPixelData=(e,n,r,i)=>{const o=new Uint8Array((r-e+1)*(i-n+1)*4);return t.context.readPixels(e,n,r-e+1,i-n+1,t.context.RGBA,t.context.UNSIGNED_BYTE,o),o},e.get3DContext=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},r=null;const i="undefined"!=typeof WebGL2RenderingContext;return t.webgl2=!1,t.defaultToWebgl2&&i&&(r=t.canvas.getContext("webgl2",e),r&&(t.webgl2=!0,ye("using webgl2"))),r||(ye("using webgl1"),r=t.canvas.getContext("webgl",e)||t.canvas.getContext("experimental-webgl",e)),new Proxy(r,(n||(n=ve()),n))},e.get2DContext=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.canvas.getContext("2d",e)},e.restoreContext=()=>{const t=m.newInstance();t.setCurrentOperation("Release"),t.traverse(e,null)},e.activateTexture=n=>{const r=t._textureResourceIds.get(n);if(void 0!==r)return void t.context.activeTexture(t.context.TEXTURE0+r);const i=e.getTextureUnitManager().allocate();i<0?be("Hardware does not support the number of textures defined."):(t._textureResourceIds.set(n,i),t.context.activeTexture(t.context.TEXTURE0+i))},e.deactivateTexture=n=>{const r=t._textureResourceIds.get(n);void 0!==r&&(e.getTextureUnitManager().free(r),t._textureResourceIds.delete(n))},e.getTextureUnitForTexture=e=>{const n=t._textureResourceIds.get(e);return void 0!==n?n:-1},e.getDefaultTextureByteSize=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.webgl2)switch(e){case i.Tu.CHAR:case i.Tu.SIGNED_CHAR:case i.Tu.UNSIGNED_CHAR:return 1;case n:case r:case i.Tu.UNSIGNED_SHORT:case i.Tu.SHORT:case i.Tu.VOID:return 2;default:return 4}return 1},e.getDefaultTextureInternalFormat=function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t.webgl2)switch(e){case i.Tu.UNSIGNED_CHAR:switch(n){case 1:return t.context.R8;case 2:return t.context.RG8;case 3:return t.context.RGB8;default:return t.context.RGBA8}case r&&!o&&i.Tu.UNSIGNED_SHORT:switch(n){case 1:return r.R16_EXT;case 2:return r.RG16_EXT;case 3:return r.RGB16_EXT;default:return r.RGBA16_EXT}case r&&!o&&i.Tu.SHORT:switch(n){case 1:return r.R16_SNORM_EXT;case 2:return r.RG16_SNORM_EXT;case 3:return r.RGB16_SNORM_EXT;default:return r.RGBA16_SNORM_EXT}case i.Tu.UNSIGNED_SHORT:case i.Tu.SHORT:case i.Tu.FLOAT:default:switch(n){case 1:return o?t.context.R16F:t.context.R32F;case 2:return o?t.context.RG16F:t.context.RG32F;case 3:return o?t.context.RGB16F:t.context.RGB32F;default:return o?t.context.RGBA16F:t.context.RGBA32F}}switch(n){case 1:return t.context.LUMINANCE;case 2:return t.context.LUMINANCE_ALPHA;case 3:return t.context.RGB;default:return t.context.RGBA}},e.setBackgroundImage=e=>{t.bgImage.src=e.src},e.setUseBackgroundImage=e=>{t.useBackgroundImage=e,t.useBackgroundImage&&!t.el.contains(t.bgImage)?t.el.appendChild(t.bgImage):!t.useBackgroundImage&&t.el.contains(t.bgImage)&&t.el.removeChild(t.bgImage)},e.captureNextImage=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",{resetCamera:r=!1,size:i=null,scale:o=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.deleted)return null;t.imageFormat=n;const a=t.notifyStartCaptureImage;return t.notifyStartCaptureImage=!0,t._screenshot={size:i||1!==o?i||t.size.map(e=>e*o):null},new Promise((n,i)=>{const o=e.onImageReady(i=>{if(null===t._screenshot.size)t.notifyStartCaptureImage=a,o.unsubscribe(),t._screenshot.placeHolder&&(t.size=t._screenshot.originalSize,e.modified(),t._screenshot.cameras&&t._screenshot.cameras.forEach(e=>{let{restoreParamsFn:t,arg:n}=e;return t(n)}),e.traverseAllPasses(),t.el.removeChild(t._screenshot.placeHolder),t._screenshot.placeHolder.remove(),t._screenshot=null),n(i);else{const n=document.createElement("img");if(n.style=Ce,n.src=i,t._screenshot.placeHolder=t.el.appendChild(n),t.canvas.style.display="none",t._screenshot.originalSize=t.size,t.size=t._screenshot.size,t._screenshot.size=null,e.modified(),r){const e=!0!==r;t._screenshot.cameras=t.renderable.getRenderers().map(t=>{const n=t.getActiveCamera(),i=n.get("focalPoint","position","parallelScale");return{resetCameraArgs:e?{renderer:t}:void 0,resetCameraFn:e?r:t.resetCamera,restoreParamsFn:n.set,arg:JSON.parse(JSON.stringify(i))}}),t._screenshot.cameras.forEach(e=>{let{resetCameraFn:t,resetCameraArgs:n}=e;return t(n)})}e.traverseAllPasses()}})})},e.getHardwareMaximumLineWidth=()=>{if(null!=a)return a;const t=e.get3DContext(),n=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE);return a=n[1],n[1]},e.getGLInformations=()=>{if(t._glInformation)return t._glInformation;const n=e.get3DContext(),r=n.getExtension("OES_texture_float"),i=n.getExtension("OES_texture_half_float"),o=n.getExtension("WEBGL_debug_renderer_info"),a=n.getExtension("WEBGL_draw_buffers"),s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),l=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",n.getParameter(n.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",n.getParameter(n.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",n.getParameter(n.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",s&&n.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",n.getParameter(n.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",n.getParameter(n.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",n.getParameter(n.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",n.getParameter(n.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",n.getParameter(n.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",n.getParameter(n.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",n.getParameter(n.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",n.getParameter(n.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",n.getParameter(n.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",n.getParameter(n.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",n.getParameter(n.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",n.getParameter(n.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",n.getParameter(n.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[r&&Ee(n,n.RGBA,n.UNSIGNED_BYTE)?"RGBA":"",r&&Ee(n,n.RGB,n.UNSIGNED_BYTE)?"RGB":"",r&&Ee(n,n.LUMINANCE,n.UNSIGNED_BYTE)?"LUMINANCE":"",r&&Ee(n,n.ALPHA,n.UNSIGNED_BYTE)?"ALPHA":"",r&&Ee(n,n.LUMINANCE_ALPHA,n.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[i&&Ee(n,n.RGBA,i.HALF_FLOAT_OES)?"RGBA":"",i&&Ee(n,n.RGB,i.HALF_FLOAT_OES)?"RGB":"",i&&Ee(n,n.LUMINANCE,i.HALF_FLOAT_OES)?"LUMINANCE":"",i&&Ee(n,n.ALPHA,i.HALF_FLOAT_OES)?"ALPHA":"",i&&Ee(n,n.LUMINANCE_ALPHA,i.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[r&&Ee(n,n.RGBA,n.FLOAT)?"RGBA":"",r&&Ee(n,n.RGB,n.FLOAT)?"RGB":"",r&&Ee(n,n.LUMINANCE,n.FLOAT)?"LUMINANCE":"",r&&Ee(n,n.ALPHA,n.FLOAT)?"ALPHA":"",r&&Ee(n,n.LUMINANCE_ALPHA,n.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",a?n.getParameter(a.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_FLOAT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_FLOAT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_INT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_INT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_INT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_INT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_INT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_INT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_INT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_INT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_INT).precision," (-2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_INT).rangeMin,"</sup> - 2<sup>",n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",n.getSupportedExtensions().join("<br/>\t\t\t\t\t    ")],["WebGL Renderer","RENDERER",n.getParameter(n.RENDERER)],["WebGL Vendor","VENDOR",n.getParameter(n.VENDOR)],["WebGL Version","VERSION",n.getParameter(n.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",n.getParameter(n.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",o&&n.getParameter(o.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",o&&n.getParameter(o.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",t.webgl2?2:1]],c={};for(;l.length;){const[e,t,n]=l.pop();t&&(c[t]={label:e,value:n})}return t._glInformation=c,c},e.traverseAllPasses=()=>{if(t.renderPasses)for(let n=0;n<t.renderPasses.length;++n)t.renderPasses[n].traverse(e,null);t.notifyStartCaptureImage&&function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.imageFormat;const r=document.createElement("canvas"),i=r.getContext("2d");r.width=t.canvas.width,r.height=t.canvas.height,i.drawImage(t.canvas,0,0);const o=t.canvas.getBoundingClientRect();t.renderable.getRenderers().forEach(e=>{e.getViewProps().forEach(e=>{if(e.getContainer){const t=e.getContainer().getElementsByTagName("canvas");for(let e=0;e<t.length;e++){const n=t[e],r=n.getBoundingClientRect(),a=r.x-o.x,s=r.y-o.y;i.drawImage(n,a,s)}}})});const a=r.toDataURL(n);r.remove(),e.invokeImageReady(a)}(),e.copyParentContent();const n=t.renderable.getChildRenderWindowsByReference();for(let t=0;t<n.length;++t)e.getViewNodeFor(n[t])?.traverseAllPasses()},e.copyParentContent=()=>{const e=t.rootOpenGLRenderWindow;if(!e||!t.context2D)return;const n=e.getCanvas(),r=t.canvas;t.context2D.drawImage(n,0,n.height-r.height,r.width,r.height,0,0,r.width,r.height)},e.resizeFromChildRenderWindows=()=>{const n=t.renderable.getChildRenderWindowsByReference();if(n.length>0){const t=[0,0];for(let r=0;r<n.length;++r){const i=e.getViewNodeFor(n[r])?.getSize();i&&(t[0]=i[0]>t[0]?i[0]:t[0],t[1]=i[1]>t[1]?i[1]:t[1])}e.setSize(...t)}},e.disableCullFace=()=>{t.cullFaceEnabled&&(t.context.disable(t.context.CULL_FACE),t.cullFaceEnabled=!1)},e.enableCullFace=()=>{t.cullFaceEnabled||(t.context.enable(t.context.CULL_FACE),t.cullFaceEnabled=!0)},e.setViewStream=n=>{if(t.viewStream===n)return!1;if(t.subscription&&(t.subscription.unsubscribe(),t.subscription=null),t.viewStream=n,t.viewStream){t.renderable.getRenderers()[0].getBackgroundByReference()[3]=0,e.setUseBackgroundImage(!0),t.subscription=t.viewStream.onImageReady(t=>e.setBackgroundImage(t.image)),t.viewStream.setSize(t.size[0],t.size[1]),t.viewStream.invalidateCache(),t.viewStream.render(),e.modified()}return!0},e.createSelector=()=>{const t=te.newInstance();return t.setOpenGLRenderWindow(e),t},e.delete=o.m.chain(()=>{t.context&&(Te--,xe.forEach(e=>e(Te)))},function(){t.canvas.removeEventListener("webglcontextlost",_e),t.canvas.removeEventListener("webglcontextrestored",e.restoreContext)},e.delete,e.setViewStream),e.setActiveFramebuffer=e=>{t.activeFramebuffer=e};const s=e.setSize;e.setSize=(t,n)=>{const r=s(t,n);return r&&e.invokeWindowResizeEvent({width:t,height:n}),r},e.getGraphicsResourceForObject=e=>{if(!e)return null;return{vtkObj:t._graphicsResources.get(e),hash:t._graphicsResourceHash.get(e)}},e.setGraphicsResourceForObject=(e,n,r)=>{e&&(t._graphicsResources.set(e,n),t._graphicsResourceHash.set(e,r))},e.getGraphicsMemoryInfo=()=>{let e=0;return t._graphicsResources.forEach((t,n)=>{e+=t.getAllocatedGPUMemoryInBytes()}),e},e.releaseGraphicsResourcesForObject=n=>!!n&&(t._graphicsResources.get(n)?.releaseGraphicsResources(e),t._graphicsResources.delete(n)&&t._graphicsResourceHash.delete(n)),e.releaseGraphicsResources=()=>{null!==t.shaderCache&&t.shaderCache.releaseGraphicsResources(e),t._graphicsResources.forEach((t,n)=>{t.releaseGraphicsResources(e)}),t._graphicsResources.clear(),t._graphicsResourceHash.clear(),null!==t.textureUnitManager&&t.textureUnitManager.freeAll(),t.renderable.getRenderersByReference().forEach(t=>{const n=e.getViewNodeFor(t);n?.releaseGraphicsResources()})};const l={...e};we.forEach(n=>{e[n]=function(){return t.rootOpenGLRenderWindow?t.rootOpenGLRenderWindow[n](...arguments):l[n](...arguments)}})}const Ie={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function De(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ie,n),ge.extend(e,t,n),t.canvas||(t.canvas=document.createElement("canvas"),t.canvas.style.width="100%"),t.selector||(t.selector=te.newInstance(),t.selector.setOpenGLRenderWindow(e)),t.bgImage=new Image,t.bgImage.style.position="absolute",t.bgImage.style.left="0",t.bgImage.style.top="0",t.bgImage.style.width="100%",t.bgImage.style.height="100%",t.bgImage.style.zIndex="-1",t._textureResourceIds=new Map,t._graphicsResources=new Map,t._graphicsResourceHash=new Map,t._glInformation=null,t.myFactory=pe.ZP.newInstance(),t.shaderCache=se.newInstance(),t.shaderCache.setOpenGLRenderWindow(e),t.renderPasses[0]=P.newInstance(),o.m.get(e,t,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),o.m.setGet(e,t,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),o.m.setGetArray(e,t,["size"],2),o.m.event(e,t,"imageReady"),o.m.event(e,t,"windowResizeEvent"),Se(e,t)}const Ae=o.m.newInstance(De,"vtkOpenGLRenderWindow");s("WebGL",Ae);var Pe={newInstance:Ae,extend:De,pushMonitorGLContextCount:function(e){xe.push(e)},popMonitorGLContextCount:function(e){return xe.pop()}};(0,pe.vw)("vtkRenderWindow",Ae);var Oe=n(67739),Re=n(40704),Me=n(34349),Ne=n(72076),Le=n(88681),ke=n(73399);const{vtkErrorMacro:Fe}=o.c,{Representation:Ve}=b.default,{ObjectType:Ue}=Le.default,{PassTypes:Be}=te,Ge={type:"StartEvent"},We={type:"EndEvent"};const ze={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function He(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ze,n),ke.ZP.extend(e,t,n),t.tmpMat3=Ne.wO.identity(new Float64Array(9)),t.normalMatrix=Ne.wO.identity(new Float64Array(9)),t.mcpcMatrix=Ne._E.identity(new Float64Array(16)),t.mcvcMatrix=Ne._E.identity(new Float64Array(16)),t.tmpColor=[],t.glyphBOBuildTime={},(0,o.o)(t.glyphBOBuildTime,{mtime:0}),function(e,t){t.classHierarchy.push("vtkOpenGLGlyph3DMapper");const n={...e};e.renderPiece=(n,r)=>{if(e.invokeEvent(Ge),t.renderable.getStatic()||t.renderable.update(),t.currentInput=t.renderable.getInputData(1),e.invokeEvent(We),!t.currentInput)return void Fe("No input!");if(!t.currentInput.getPoints||!t.currentInput.getPoints().getNumberOfValues())return;const i=t.context;t._openGLRenderWindow.getWebgl2()?(t.hardwareSupport=!0,t.extension=null):t.extension||(t.extension=t.context.getExtension("ANGLE_instanced_arrays"),t.hardwareSupport=!!t.extension);const o=r.getProperty().getBackfaceCulling(),a=r.getProperty().getFrontfaceCulling();o||a?a?(t._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(t._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)):t._openGLRenderWindow.disableCullFace(),e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r)},e.multiply4x4WithOffset=(e,t,n,r)=>{const i=t[0],o=t[1],a=t[2],s=t[3],l=t[4],c=t[5],u=t[6],d=t[7],p=t[8],h=t[9],f=t[10],m=t[11],g=t[12],v=t[13],y=t[14],b=t[15];let C=n[r],w=n[r+1],E=n[r+2],T=n[r+3];e[0]=C*i+w*l+E*p+T*g,e[1]=C*o+w*c+E*h+T*v,e[2]=C*a+w*u+E*f+T*y,e[3]=C*s+w*d+E*m+T*b,C=n[r+4],w=n[r+5],E=n[r+6],T=n[r+7],e[4]=C*i+w*l+E*p+T*g,e[5]=C*o+w*c+E*h+T*v,e[6]=C*a+w*u+E*f+T*y,e[7]=C*s+w*d+E*m+T*b,C=n[r+8],w=n[r+9],E=n[r+10],T=n[r+11],e[8]=C*i+w*l+E*p+T*g,e[9]=C*o+w*c+E*h+T*v,e[10]=C*a+w*u+E*f+T*y,e[11]=C*s+w*d+E*m+T*b,C=n[r+12],w=n[r+13],E=n[r+14],T=n[r+15],e[12]=C*i+w*l+E*p+T*g,e[13]=C*o+w*c+E*h+T*v,e[14]=C*a+w*u+E*f+T*y,e[15]=C*s+w*d+E*m+T*b},e.replaceShaderNormal=(e,r,i)=>{if(t.hardwareSupport&&t.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let n=e.Vertex;t.lastBoundBO.getCABO().getNormalOffset()&&(n=C.Z.substitute(n,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,n=C.Z.substitute(n,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),e.Vertex=n}n.replaceShaderNormal(e,r,i)},e.replaceShaderColor=(e,r,i)=>{if(t.hardwareSupport&&t.renderable.getColorArray()){let n=e.Vertex,r=e.Geometry,i=e.Fragment;const o=t.lastBoundBO.getReferenceByName("lastLightComplexity");let a=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];o&&(a=a.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let s=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];o&&(s=s.concat(["  vec3 specularColor;","  float specularPower;"])),s=s.concat(["  opacity = opacityUniform;"]),o&&(s=s.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),t.drawingEdges||(a=a.concat(["varying vec4 vertexColorVSOutput;"]),n=C.Z.substitute(n,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,n=C.Z.substitute(n,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,r=C.Z.substitute(r,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,r=C.Z.substitute(r,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,s=s.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),i=C.Z.substitute(i,"//VTK::Color::Impl",s).result,i=C.Z.substitute(i,"//VTK::Color::Dec",a).result,e.Vertex=n,e.Geometry=r,e.Fragment=i}n.replaceShaderColor(e,r,i)},e.replaceShaderPositionVC=(e,r,i)=>{if(t.hardwareSupport){let n=e.Vertex;t.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(n=C.Z.substitute(n,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,n=C.Z.substitute(n,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(n=C.Z.substitute(n,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,n=C.Z.substitute(n,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),e.Vertex=n}n.replaceShaderPositionVC(e,r,i)},e.replaceShaderPicking=(e,r,i)=>{if(t.hardwareSupport){let t=e.Fragment,n=e.Vertex;n=C.Z.substitute(n,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,n=C.Z.substitute(n,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,e.Vertex=n,t=C.Z.substitute(t,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,t=C.Z.substitute(t,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,e.Fragment=t}else n.replaceShaderPicking(e,r,i)},e.updateGlyphShaderParameters=(n,r,i,o,a,s,l,c)=>{const u=i.getProgram();if(n){const e=t.normalMatrix,n=s,r=9*l,i=t.tmpMat3,o=e[0],a=e[1],c=e[2],d=e[3],p=e[4],h=e[5],f=e[6],m=e[7],g=e[8],v=n[r],y=n[r+1],b=n[r+2],C=n[r+3],w=n[r+4],E=n[r+5],T=n[r+6],x=n[r+7],_=n[r+8];i[0]=v*o+y*d+b*f,i[1]=v*a+y*p+b*m,i[2]=v*c+y*h+b*g,i[3]=C*o+w*d+E*f,i[4]=C*a+w*p+E*m,i[5]=C*c+w*h+E*g,i[6]=T*o+x*d+_*f,i[7]=T*a+x*p+_*m,i[8]=T*c+x*h+_*g,u.setUniformMatrix3x3("normalMatrix",t.tmpMat3)}if(e.multiply4x4WithOffset(t.tmpMat4,t.mcpcMatrix,a,16*l),u.setUniformMatrix("MCPCMatrix",t.tmpMat4),r&&(e.multiply4x4WithOffset(t.tmpMat4,t.mcvcMatrix,a,16*l),u.setUniformMatrix("MCVCMatrix",t.tmpMat4)),o){const e=o.getData();t.tmpColor[0]=e[4*l]/255,t.tmpColor[1]=e[4*l+1]/255,t.tmpColor[2]=e[4*l+2]/255,u.setUniform3fArray("ambientColorUniform",t.tmpColor),u.setUniform3fArray("diffuseColorUniform",t.tmpColor)}c&&u.setUniform3fArray("mapperIndex",c.getPropColorValue())},e.renderPieceDraw=(n,r)=>{const i=r.getProperty().getRepresentation(),o=t.context,a=r.getProperty().getEdgeVisibility()&&i===Ve.SURFACE,s=t.openGLCamera.getKeyMatrices(n),l=t.openGLActor.getKeyMatrices();Ne.wO.multiply(t.normalMatrix,s.normalMatrix,l.normalMatrix),Ne._E.multiply(t.mcpcMatrix,s.wcpc,l.mcwc),Ne._E.multiply(t.mcvcMatrix,s.wcvc,l.mcwc);const c=t.renderable.getMatrixArray(),u=t.renderable.getNormalArray(),d=t.renderable.getColorArray(),p=c.length/16;let h=!1;t._openGLRenderer.getSelector()&&t._openGLRenderer.getSelector().getCurrentPass()===Be.COMPOSITE_INDEX_PASS&&(h=!0);for(let s=t.primTypes.Start;s<t.primTypes.End;s++){const l=t.primitives[s].getCABO();if(l.getElementCount()){t.drawingEdges=a&&(s===t.primTypes.TrisEdges||s===t.primTypes.TriStripsEdges),t.lastBoundBO=t.primitives[s],t.primitives[s].updateShaders(n,r,e);const f=t.primitives[s].getProgram(),m=t.primitives[s].getOpenGLMode(i),g=f.isUniformUsed("normalMatrix"),v=f.isUniformUsed("MCVCMatrix");if(t.hardwareSupport)t.extension?t.extension.drawArraysInstancedANGLE(m,0,l.getElementCount(),p):o.drawArraysInstanced(m,0,l.getElementCount(),p);else for(let n=0;n<p;++n)h&&t._openGLRenderer.getSelector().renderCompositeIndex(n),e.updateGlyphShaderParameters(g,v,t.primitives[s],d,c,u,n,h?t._openGLRenderer.getSelector():null),o.drawArrays(m,0,l.getElementCount())}}},e.setMapperShaderParameters=(e,r,i)=>{if(e.getCABO().getElementCount()&&(t.glyphBOBuildTime.getMTime()>e.getAttributeUpdateTime().getMTime()||e.getShaderSourceTime().getMTime()>e.getAttributeUpdateTime().getMTime()))return e.getProgram().isAttributeUsed("gMatrix")?e.getVAO().addAttributeMatrixWithDivisor(e.getProgram(),t.matrixBuffer,"gMatrix",0,64,t.context.FLOAT,4,!1,1)||Fe("Error setting gMatrix in shader VAO."):e.getVAO().removeAttributeArray("gMatrix"),e.getProgram().isAttributeUsed("gNormal")?e.getVAO().addAttributeMatrixWithDivisor(e.getProgram(),t.normalBuffer,"gNormal",0,36,t.context.FLOAT,3,!1,1)||Fe("Error setting gNormal in shader VAO."):e.getVAO().removeAttributeArray("gNormal"),e.getProgram().isAttributeUsed("gColor")?e.getVAO().addAttributeArrayWithDivisor(e.getProgram(),t.colorBuffer,"gColor",0,4,t.context.UNSIGNED_BYTE,4,!0,1,!1)||Fe("Error setting gColor in shader VAO."):e.getVAO().removeAttributeArray("gColor"),e.getProgram().isAttributeUsed("mapperIndexVS")?e.getVAO().addAttributeArrayWithDivisor(e.getProgram(),t.pickBuffer,"mapperIndexVS",0,4,t.context.UNSIGNED_BYTE,4,!0,1,!1)||Fe("Error setting mapperIndexVS in shader VAO."):e.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(e,r,i),void e.getAttributeUpdateTime().modified();n.setMapperShaderParameters(e,r,i)},e.getNeedToRebuildBufferObjects=(e,r)=>(t.renderable.buildArrays(),t.VBOBuildTime.getMTime()<t.renderable.getBuildTime().getMTime()||n.getNeedToRebuildBufferObjects(e,r)),e.getNeedToRebuildShaders=(e,r,i)=>!!(n.getNeedToRebuildShaders(e,r,i)||e.getShaderSourceTime().getMTime()<t.renderable.getMTime()||e.getShaderSourceTime().getMTime()<t.currentInput.getMTime()),e.buildBufferObjects=(e,r)=>{if(t.hardwareSupport){const e=t.renderable.getMatrixArray(),n=t.renderable.getNormalArray(),r=t.renderable.getColorArray();if(t.matrixBuffer||(t.matrixBuffer=Le.default.newInstance(),t.matrixBuffer.setOpenGLRenderWindow(t._openGLRenderWindow),t.normalBuffer=Le.default.newInstance(),t.normalBuffer.setOpenGLRenderWindow(t._openGLRenderWindow),t.colorBuffer=Le.default.newInstance(),t.colorBuffer.setOpenGLRenderWindow(t._openGLRenderWindow),t.pickBuffer=Le.default.newInstance(),t.pickBuffer.setOpenGLRenderWindow(t._openGLRenderWindow)),t.renderable.getBuildTime().getMTime()>t.glyphBOBuildTime.getMTime()){t.matrixBuffer.upload(e,Ue.ARRAY_BUFFER),t.normalBuffer.upload(n,Ue.ARRAY_BUFFER),r?t.colorBuffer.upload(r.getData(),Ue.ARRAY_BUFFER):t.colorBuffer.releaseGraphicsResources();const i=e.length/16,o=new Uint8Array(4*i);for(let e=0;e<i;++e){let t=e+1;const n=4*e;o[n]=t%256,t-=o[n],t/=256,o[n+1]=t%256,t-=o[n+1],t/=256,o[n+2]=t%256,o[n+3]=255}t.pickBuffer.upload(o,Ue.ARRAY_BUFFER),t.glyphBOBuildTime.modified()}}return n.buildBufferObjects(e,r)}}(e,t)}const je=(0,o.n)(He,"vtkOpenGLGlyph3DMapper");var Ze={newInstance:je,extend:He};(0,pe.vw)("vtkGlyph3DMapper",je);var Ke=n(80129),$e=n(43634),qe=n(1385),Xe=n(6872),Ye=n(41983),Je=n(37148),Qe=n(59474),et=n(25460);const{vtkErrorMacro:tt}=o.c;const nt={};function rt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,nt,n),ke.ZP.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkOpenGLSphereMapper");const n={...e};e.getShaderTemplate=(e,t,n)=>{e.Vertex="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkSphereMapperVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n// this shader implements imposters in OpenGL for Spheres\n\nattribute vec4 vertexMC;\nattribute vec2 offsetMC;\n\n// optional normal declaration\n//VTK::Normal::Dec\n\n//VTK::Picking::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\nuniform mat3 normalMatrix; // transform model coordinate directions to view coordinates\n\n// material property values\n//VTK::Color::Dec\n\n// clipping plane vars\n//VTK::Clip::Dec\n\n// camera and actor matrix values\n//VTK::Camera::Dec\n\nvarying vec4 vertexVCVSOutput;\nvarying float radiusVCVSOutput;\nvarying vec3 centerVCVSOutput;\n\nuniform int cameraParallel;\nuniform float scaleFactor;\n\nvoid main()\n{\n  //VTK::Picking::Impl\n\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Clip::Impl\n\n  // compute the projected vertex position\n  vec2 scaledOffsetMC = scaleFactor * offsetMC;\n  vertexVCVSOutput = MCVCMatrix * vertexMC;\n  centerVCVSOutput = vertexVCVSOutput.xyz;\n  radiusVCVSOutput = length(scaledOffsetMC)*0.5;\n\n  // make the triangle face the camera\n  if (cameraParallel == 0)\n    {\n    vec3 dir = normalize(-vertexVCVSOutput.xyz);\n    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));\n    vec3 base1 = cross(base2,dir);\n    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;\n    }\n  else\n    {\n    // add in the offset\n    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;\n    }\n\n  gl_Position = VCPCMatrix * vertexVCVSOutput;\n}\n",e.Fragment=et.v,e.Geometry=""},e.replaceShaderValues=(e,r,i)=>{let o=e.Vertex,a=e.Fragment;o=C.Z.substitute(o,"//VTK::Camera::Dec",["uniform mat4 VCPCMatrix;\n","uniform mat4 MCVCMatrix;"]).result,a=C.Z.substitute(a,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,a=C.Z.substitute(a,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;\n"]).result,a=C.Z.substitute(a,"//VTK::Normal::Dec",["uniform float invertedDepth;\n","uniform int cameraParallel;\n","varying float radiusVCVSOutput;\n","varying vec3 centerVCVSOutput;\n","uniform mat4 VCPCMatrix;\n"]).result;let s="";t.context.getExtension("EXT_frag_depth")&&(s="gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;\n"),t._openGLRenderWindow.getWebgl2()&&(s="gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;\n"),a=C.Z.substitute(a,"//VTK::Depth::Impl",["  vec3 EyePos;\n","  vec3 EyeDir;\n","  if (cameraParallel != 0) {\n","    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);\n","    EyeDir = vec3(0.0,0.0,-1.0); }\n","  else {\n","    EyeDir = vertexVC.xyz;\n","    EyePos = vec3(0.0,0.0,0.0);\n","    float lengthED = length(EyeDir);\n","    EyeDir = normalize(EyeDir);\n","    if (lengthED > radiusVCVSOutput*3.0) {\n","      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }\n","    }\n","  EyePos = EyePos - centerVCVSOutput;\n","  EyePos = EyePos/radiusVCVSOutput;\n","  float b = 2.0*dot(EyePos,EyeDir);\n","  float c = dot(EyePos,EyePos) - 1.0;\n","  float d = b*b - 4.0*c;\n","  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);\n","  if (d < 0.0) { discard; }\n","  else {\n","    float t = (-b - invertedDepth*sqrt(d))*0.5;\n","    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);\n","    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;\n","    }\n","  vec4 pos = VCPCMatrix * vertexVC;\n",s]).result,a=C.Z.substitute(a,"//VTK::Normal::Impl","").result,t.haveSeenDepthRequest&&(a=C.Z.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),e.Vertex=o,e.Fragment=a,n.replaceShaderValues(e,r,i)},e.setMapperShaderParameters=(e,r,i)=>{if(e.getCABO().getElementCount()&&(t.VBOBuildTime>e.getAttributeUpdateTime().getMTime()||e.getShaderSourceTime().getMTime()>e.getAttributeUpdateTime().getMTime())&&e.getProgram().isAttributeUsed("offsetMC")&&(e.getVAO().addAttributeArray(e.getProgram(),e.getCABO(),"offsetMC",12,e.getCABO().getStride(),t.context.FLOAT,2,!1)||tt("Error setting 'offsetMC' in shader VAO.")),e.getProgram().isUniformUsed("invertedDepth")&&e.getProgram().setUniformf("invertedDepth",t.invert?-1:1),e.getProgram().isUniformUsed("scaleFactor")){const n=t.currentInput.getPointData();null!=t.renderable.getScaleArray()&&n.hasArray(t.renderable.getScaleArray())?e.getProgram().setUniformf("scaleFactor",t.renderable.getScaleFactor()):e.getProgram().setUniformf("scaleFactor",1)}n.setMapperShaderParameters(e,r,i)},e.setCameraShaderParameters=(e,n,r)=>{const i=e.getProgram(),o=n.getActiveCamera(),a=t.openGLCamera.getKeyMatrices(n);if(i.isUniformUsed("VCPCMatrix")&&i.setUniformMatrix("VCPCMatrix",a.vcpc),i.isUniformUsed("MCVCMatrix"))if(r.getIsIdentity())i.setUniformMatrix("MCVCMatrix",a.wcvc);else{const e=t.openGLActor.getKeyMatrices(),n=new Float64Array(16);Ne._E.multiply(n,a.wcvc,e.mcwc),i.setUniformMatrix("MCVCMatrix",n)}i.isUniformUsed("cameraParallel")&&e.getProgram().setUniformi("cameraParallel",o.getParallelProjection())},e.getOpenGLMode=(e,n)=>t.context.TRIANGLES,e.buildBufferObjects=(e,n)=>{const r=t.currentInput;if(null===r)return;t.renderable.mapScalars(r,1);const i=t.renderable.getColorMapColors(),o=t.primitives[t.primTypes.Tris].getCABO(),a=r.getPointData(),s=r.getPoints(),l=s.getNumberOfPoints(),c=s.getData();let u=null;null!=t.renderable.getScaleArray()&&a.hasArray(t.renderable.getScaleArray())&&(u=a.getArray(t.renderable.getScaleArray()).getData());let d=null,p=0,h=null;i?(p=i.getNumberOfComponents(),o.setColorOffset(0),o.setColorBOStride(4),d=i.getData(),h=new Uint8Array(3*l*4),o.getColorBO()||o.setColorBO(Le.default.newInstance()),o.getColorBO().setOpenGLRenderWindow(t._openGLRenderWindow)):o.getColorBO()&&o.setColorBO(null),o.setColorComponents(p);const f=new Float32Array(5*l*3);o.setStride(20);const m=Math.cos((0,Qe.r)(30));let g=0,v=0,y=0,b=0;for(let e=0;e<l;++e){let n=t.renderable.getRadius();u&&(n=u[e]),g=3*e,f[y++]=c[g++],f[y++]=c[g++],f[y++]=c[g++],f[y++]=-2*n*m,f[y++]=-n,d&&(v=e*p,h[b++]=d[v],h[b++]=d[v+1],h[b++]=d[v+2],h[b++]=d[v+3]),g=3*e,f[y++]=c[g++],f[y++]=c[g++],f[y++]=c[g++],f[y++]=2*n*m,f[y++]=-n,d&&(h[b++]=d[v],h[b++]=d[v+1],h[b++]=d[v+2],h[b++]=d[v+3]),g=3*e,f[y++]=c[g++],f[y++]=c[g++],f[y++]=c[g++],f[y++]=0,f[y++]=2*n,d&&(h[b++]=d[v],h[b++]=d[v+1],h[b++]=d[v+2],h[b++]=d[v+3])}o.setElementCount(y/5),o.upload(f,Je.L.ARRAY_BUFFER),i&&o.getColorBO().upload(h,Je.L.ARRAY_BUFFER),t.VBOBuildTime.modified()}}(e,t)}const it=(0,o.n)(rt,"vtkOpenGLSphereMapper");var ot={newInstance:it,extend:rt};(0,pe.vw)("vtkSphereMapper",it);const{vtkErrorMacro:at}=o.c;const st={};function lt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,st,n),ke.ZP.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkOpenGLStickMapper");const n={...e};e.getShaderTemplate=(e,t,n)=>{e.Vertex="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkStickMapperVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n// this shader implements imposters in OpenGL for Sticks\n\nattribute vec4 vertexMC;\nattribute vec3 orientMC;\nattribute vec4 offsetMC;\nattribute float radiusMC;\n\n// optional normal declaration\n//VTK::Normal::Dec\n\n//VTK::Picking::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\nuniform mat3 normalMatrix; // transform model coordinate directions to view coordinates\n\n// material property values\n//VTK::Color::Dec\n\n// clipping plane vars\n//VTK::Clip::Dec\n\n// camera and actor matrix values\n//VTK::Camera::Dec\n\nvarying vec4 vertexVCVSOutput;\nvarying float radiusVCVSOutput;\nvarying float lengthVCVSOutput;\nvarying vec3 centerVCVSOutput;\nvarying vec3 orientVCVSOutput;\n\nuniform int cameraParallel;\n\nvoid main()\n{\n  //VTK::Picking::Impl\n\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Clip::Impl\n\n  vertexVCVSOutput = MCVCMatrix * vertexMC;\n  centerVCVSOutput = vertexVCVSOutput.xyz;\n  radiusVCVSOutput = radiusMC;\n  lengthVCVSOutput = length(orientMC);\n  orientVCVSOutput = normalMatrix * normalize(orientMC);\n\n  // make sure it is pointing out of the screen\n  if (orientVCVSOutput.z < 0.0)\n    {\n    orientVCVSOutput = -orientVCVSOutput;\n    }\n\n  // make the basis\n  vec3 xbase;\n  vec3 ybase;\n  vec3 dir = vec3(0.0,0.0,1.0);\n  if (cameraParallel == 0)\n    {\n    dir = normalize(-vertexVCVSOutput.xyz);\n    }\n  if (abs(dot(dir,orientVCVSOutput)) == 1.0)\n    {\n    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));\n    ybase = cross(xbase,orientVCVSOutput);\n    }\n  else\n    {\n    xbase = normalize(cross(orientVCVSOutput,dir));\n    ybase = cross(orientVCVSOutput,xbase);\n    }\n\n  vec3 offsets = offsetMC.xyz*2.0-1.0;\n  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +\n    radiusVCVSOutput*offsets.x*xbase +\n    radiusVCVSOutput*offsets.y*ybase +\n    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;\n\n  gl_Position = VCPCMatrix * vertexVCVSOutput;\n}\n",e.Fragment=et.v,e.Geometry=""},e.replaceShaderValues=(e,r,i)=>{let o=e.Vertex,a=e.Fragment;o=C.Z.substitute(o,"//VTK::Camera::Dec",["uniform mat4 VCPCMatrix;\n","uniform mat4 MCVCMatrix;"]).result,a=C.Z.substitute(a,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,a=C.Z.substitute(a,"//VTK::PositionVC::Impl","  vec4 vertexVC = vertexVCVSOutput;\n").result,a=C.Z.substitute(a,"//VTK::Normal::Dec",["uniform int cameraParallel;\n","varying float radiusVCVSOutput;\n","varying vec3 orientVCVSOutput;\n","varying float lengthVCVSOutput;\n","varying vec3 centerVCVSOutput;\n","uniform mat4 VCPCMatrix;\n"]).result;let s="";t.context.getExtension("EXT_frag_depth")&&(s="  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;\n"),t._openGLRenderWindow.getWebgl2()&&(s="gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;\n"),a=C.Z.substitute(a,"//VTK::Depth::Impl",["  vec3 EyePos;\n","  vec3 EyeDir;\n","  if (cameraParallel != 0) {\n","    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);\n","    EyeDir = vec3(0.0,0.0,-1.0); }\n","  else {\n","    EyeDir = vertexVC.xyz;\n","    EyePos = vec3(0.0,0.0,0.0);\n","    float lengthED = length(EyeDir);\n","    EyeDir = normalize(EyeDir);\n","    if (lengthED > radiusVCVSOutput*3.0) {\n","      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }\n","    }\n","  EyePos = EyePos - centerVCVSOutput;\n","  vec3 base1;\n","  if (abs(orientVCVSOutput.z) < 0.99) {\n","    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }\n","  else {\n","    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }\n","  vec3 base2 = cross(orientVCVSOutput,base1);\n","  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));\n","  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));\n","  EyePos = EyePos/radiusVCVSOutput;\n","  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;\n","  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);\n","  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;\n","  float d = b*b - 4.0*a*c;\n","  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);\n","  if (d < 0.0) { discard; }\n","  else {\n","    float t =  (-b - sqrt(d))/(2.0*a);\n","    float tz = EyePos.z + t*EyeDir.z;\n","    vec3 iPoint = EyePos + t*EyeDir;\n","    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {\n","      float t2 = (-b + sqrt(d))/(2.0*a);\n","      float tz2 = EyePos.z + t2*EyeDir.z;\n","      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }\n","      else {\n","        normalVCVSOutput = orientVCVSOutput;\n","        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;\n","        iPoint = EyePos + t3*EyeDir;\n","        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;\n","        }\n","      }\n","    else {\n","      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;\n","      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;\n","      }\n","    }\n","  vec4 pos = VCPCMatrix * vertexVC;\n",s]).result,a=C.Z.substitute(a,"//VTK::Normal::Impl","").result,t.haveSeenDepthRequest&&(a=C.Z.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),e.Vertex=o,e.Fragment=a,n.replaceShaderValues(e,r,i)},e.setMapperShaderParameters=(e,r,i)=>{e.getCABO().getElementCount()&&(t.VBOBuildTime>e.getAttributeUpdateTime().getMTime()||e.getShaderSourceTime().getMTime()>e.getAttributeUpdateTime().getMTime())&&(e.getProgram().isAttributeUsed("orientMC")&&(e.getVAO().addAttributeArray(e.getProgram(),e.getCABO(),"orientMC",12,e.getCABO().getStride(),t.context.FLOAT,3,!1)||at("Error setting 'orientMC' in shader VAO.")),e.getProgram().isAttributeUsed("offsetMC")&&(e.getVAO().addAttributeArray(e.getProgram(),e.getCABO().getColorBO(),"offsetMC",0,e.getCABO().getColorBOStride(),t.context.UNSIGNED_BYTE,3,!0)||at("Error setting 'offsetMC' in shader VAO.")),e.getProgram().isAttributeUsed("radiusMC")&&(e.getVAO().addAttributeArray(e.getProgram(),e.getCABO(),"radiusMC",24,e.getCABO().getStride(),t.context.FLOAT,1,!1)||at("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(e,r,i)},e.setCameraShaderParameters=(e,n,r)=>{const i=e.getProgram(),o=n.getActiveCamera(),a=t.openGLCamera.getKeyMatrices(n);if(i.isUniformUsed("VCPCMatrix")&&i.setUniformMatrix("VCPCMatrix",a.vcpc),r.getIsIdentity())i.isUniformUsed("MCVCMatrix")&&i.setUniformMatrix("MCVCMatrix",a.wcvc),i.isUniformUsed("normalMatrix")&&i.setUniformMatrix3x3("normalMatrix",a.normalMatrix);else{const e=t.openGLActor.getKeyMatrices();if(i.isUniformUsed("MCVCMatrix")){const t=new Float64Array(16);Ne._E.multiply(t,a.wcvc,e.mcwc),i.setUniformMatrix("MCVCMatrix",t)}if(i.isUniformUsed("normalMatrix")){const t=new Float64Array(9);Ne.wO.multiply(t,a.normalMatrix,e.normalMatrix),i.setUniformMatrix3x3("normalMatrix",t)}}i.isUniformUsed("cameraParallel")&&e.getProgram().setUniformi("cameraParallel",o.getParallelProjection())},e.getOpenGLMode=(e,n)=>t.context.TRIANGLES,e.buildBufferObjects=(e,n)=>{const r=t.currentInput;if(null===r)return;t.renderable.mapScalars(r,1);const i=t.renderable.getColorMapColors(),o=t.primitives[t.primTypes.Tris].getCABO(),a=r.getPointData(),s=r.getPoints(),l=s.getNumberOfPoints(),c=s.getData();let u=3;u+=4;let d=null,p=0;o.setColorBOStride(4),o.getColorBO()||o.setColorBO(Le.default.newInstance()),o.getColorBO().setOpenGLRenderWindow(t._openGLRenderWindow),i&&(p=i.getNumberOfComponents(),o.setColorOffset(4),d=i.getData(),o.setColorBOStride(8)),o.setColorComponents(p),o.setStride(28);const h=new Float32Array(7*l*12),f=new Uint8Array(12*l*(d?8:4));let m=null,g=null;null!=t.renderable.getScaleArray()&&a.hasArray(t.renderable.getScaleArray())&&(m=a.getArray(t.renderable.getScaleArray()).getData()),null!=t.renderable.getOrientationArray()&&a.hasArray(t.renderable.getOrientationArray())?g=a.getArray(t.renderable.getOrientationArray()).getData():at(["Error setting orientationArray.\n","You have to specify the stick orientation"]);const v=[0,1,3,0,3,2,2,3,5,2,5,4];let y=0,b=0,C=0,w=0;for(let e=0;e<l;++e){let n=t.renderable.getLength(),r=t.renderable.getRadius();m&&(n=m[2*e],r=m[2*e+1]);for(let t=0;t<v.length;++t)y=3*e,h[C++]=c[y++],h[C++]=c[y++],h[C++]=c[y++],y=3*e,h[C++]=g[y++]*n,h[C++]=g[y++]*n,h[C++]=g[y++]*n,h[C++]=r,f[w++]=v[t]%2*255,f[w++]=v[t]>=4?255:0,f[w++]=v[t]>=2?255:0,f[w++]=255,b=e*p,d&&(f[w++]=d[b],f[w++]=d[b+1],f[w++]=d[b+2],f[w++]=d[b+3])}o.setElementCount(C/7),o.upload(h,Je.L.ARRAY_BUFFER),o.getColorBO().upload(f,Je.L.ARRAY_BUFFER),t.VBOBuildTime.modified()}}(e,t)}const ct=(0,o.n)(lt,"vtkOpenGLStickMapper");var ut={newInstance:ct,extend:lt};(0,pe.vw)("vtkStickMapper",ct);var dt=n(10905),pt=n(9170),ht=n(79410),ft=n(87730),mt=n(42695);const gt={};function vt(e,t,n={}){Object.assign(t,gt,n),pt.ZP.extend(e,t,n),t.scalarTexture=n.scalarTexture,t.previousState={},function(e,t){t.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),e.buildBufferObjects=(n,r)=>{const o=t.currentInput;if(!o)return;const a=o.getPointData()&&o.getPointData().getScalars();if(!a)return;const s=r.getProperty();if(!t.jitterTexture.getHandle()){const e=new Uint8Array(1024);for(let t=0;t<1024;++t)e[t]=255*Math.random();t.jitterTexture.setMinificationFilter(ft.w.LINEAR),t.jitterTexture.setMagnificationFilter(ft.w.LINEAR),t.jitterTexture.create2DFromRaw(32,32,1,i.Tu.UNSIGNED_CHAR,e)}const l=a.getNumberOfComponents(),c=s.getIndependentComponents()?l:1;let u=`${s.getMTime()}`;if(t.opacityTextureString!==u){const e=1024,n=2*e*c,r=new Float32Array(n),o=new Float32Array(e);for(let n=0;n<c;++n){const i=s.getScalarOpacity(n),a=t.renderable.getSampleDistance()/s.getScalarOpacityUnitDistance(n),l=i.getRange();i.getTable(l[0],l[1],e,o,1);for(let t=0;t<e;++t)r[n*e*2+t]=1-(1-o[t])**a,r[n*e*2+t+e]=r[n*e*2+t]}if(t.opacityTexture.releaseGraphicsResources(t._openGLRenderWindow),t.opacityTexture.setMinificationFilter(ft.w.LINEAR),t.opacityTexture.setMagnificationFilter(ft.w.LINEAR),t._openGLRenderWindow.getWebgl2()||t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear"))t.opacityTexture.create2DFromRaw(e,2*c,1,i.Tu.FLOAT,r);else{const o=new Uint8Array(n);for(let e=0;e<n;++e)o[e]=255*r[e];t.opacityTexture.create2DFromRaw(e,2*c,1,i.Tu.UNSIGNED_CHAR,o)}t.opacityTextureString=u}if(u=`${s.getMTime()}`,t.colorTextureString!==u){const e=1024,n=new Uint8Array(2*e*c*3),r=new Float32Array(3*e);for(let t=0;t<c;++t){const i=s.getRGBTransferFunction(t),o=i.getRange();i.getTable(o[0],o[1],e,r,1);for(let i=0;i<3*e;++i)n[t*e*6+i]=255*r[i],n[t*e*6+i+3*e]=255*r[i]}t.colorTexture.releaseGraphicsResources(t._openGLRenderWindow),t.colorTexture.setMinificationFilter(ft.w.LINEAR),t.colorTexture.setMagnificationFilter(ft.w.LINEAR),t.colorTexture.create2DFromRaw(e,2*c,3,i.Tu.UNSIGNED_CHAR,n),t.colorTextureString=u}if(e.updateLabelOutlineThicknessTexture(r),u=`${o.getMTime()}`,t.scalarTextureString!==u){const e=o.getDimensions(),n=t.scalarTexture.getTextureParameters(),r=o.getPointData().getScalars().getDataType(),i=o.getPointData().getScalars().getData();let s=!0;if(n.dataType&&n.dataType===r){const e=n.width*n.height*n.depth*n.numComps;i.length===e&&(s=!1)}s?(t.scalarTexture.setOglNorm16Ext(t.context.getExtension("EXT_texture_norm16")),t.scalarTexture.releaseGraphicsResources(t._openGLRenderWindow),t.scalarTexture.resetFormatAndType(),t.scalarTexture.create3DFilterableFromRaw(e[0],e[1],e[2],l,a.getDataType(),a.getData(),t.renderable.getPreferSizeOverAccuracy())):(t.scalarTexture.deactivate(),t.scalarTexture.update3DFromRaw(i)),t.scalarTextureString=u}if(!t.tris.getCABO().getElementCount()){const e=new Float32Array(12);for(let t=0;t<4;t++)e[3*t]=t%2*2-1,e[3*t+1]=t>1?1:-1,e[3*t+2]=-1;const n=new Uint16Array(8);n[0]=3,n[1]=0,n[2]=1,n[3]=3,n[4]=3,n[5]=0,n[6]=3,n[7]=2;const r=v.default.newInstance({numberOfComponents:3,values:e});r.setName("points");const i=v.default.newInstance({numberOfComponents:1,values:n});t.tris.getCABO().createVBO(i,"polys",mt.hX.SURFACE,{points:r,cellOffset:0})}t.VBOBuildTime.modified()},e.getRenderTargetSize=()=>{if(t._useSmallViewport)return[t._smallViewportWidth,t._smallViewportHeight];const{usize:e,vsize:n}=t._openGLRenderer.getTiledSizeAndOrigin();return[e,n]},e.getRenderTargetOffset=()=>{const{lowerLeftU:e,lowerLeftV:n}=t._openGLRenderer.getTiledSizeAndOrigin();return[e,n]}}(e,t)}const yt={newInstance:r.ZP.newInstance(vt,"vtkStreamingOpenGLVolumeMapper"),extend:vt},bt=Object.create(null);function Ct(e,t){bt[e]=t}const wt={};function Et(e,t,n={}){Object.assign(t,wt,n),ht.ZP.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),e.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),o=!1;const a=Object.keys(t.overrides);for(;i&&!o;)-1!==a.indexOf(i)?o=!0:i=n.getClassName(r++);if(!o)return null;const s=t.getModelInitialValues(n),l=t.overrides[i](s);return l.setMyFactory(e),l},t.overrides=bt,t.getModelInitialValues=e=>{const t={};return"vtkSharedVolumeMapper"===e.getClassName()&&(t.scalarTexture=e.getScalarTexture()),t}}(e,t),Ct("vtkActor",Oe.ZP.newInstance),Ct("vtkActor2D",Re.ZP.newInstance),Ct("vtkCamera",Me.ZP.newInstance),Ct("vtkGlyph3DMapper",Ze.newInstance),Ct("vtkImageMapper",Ke.ZP.newInstance),Ct("vtkImageSlice",$e.ZP.newInstance),Ct("vtkMapper",ke.ZP.newInstance),Ct("vtkPixelSpaceCallbackMapper",qe.ZP.newInstance),Ct("vtkRenderer",Xe.ZP.newInstance),Ct("vtkSkybox",Ye.ZP.newInstance),Ct("vtkSphereMapper",ot.newInstance),Ct("vtkStickMapper",ut.newInstance),Ct("vtkTexture",g.default.newInstance),Ct("vtkVolume",dt.ZP.newInstance),Ct("vtkVolumeMapper",pt.ZP.newInstance),Ct("vtkSharedVolumeMapper",yt.newInstance)}const Tt={newInstance:r.ZP.newInstance(Et,"vtkStreamingOpenGLViewNodeFactory"),extend:Et};function xt(e,t,n={}){Object.assign(t,n),Pe.extend(e,t,n),t.myFactory=Tt.newInstance(),Ct("vtkRenderWindow",_t),function(e,t){t.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}(0,t)}const _t=r.ZP.newInstance(xt,"vtkStreamingOpenGLRenderWindow"),St={newInstance:_t,extend:xt};var It=n(32198);var Dt={Device:{Unknown:0,LeftController:1,RightController:2},Input:{Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},Axis:{Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4}};const{Device:At,Input:Pt}=Dt,{vtkWarningMacro:Ot,vtkErrorMacro:Rt,normalizeWheel:Mt,vtkOnceErrorMacro:Nt}=o.m,Lt={ctrlKey:!1,altKey:!1,shiftKey:!1},kt={"xr-standard":[Pt.Trigger,Pt.Grip,Pt.TrackPad,Pt.Thumbstick,Pt.A,Pt.B]},Ft=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function Vt(e){e.cancelable&&e.preventDefault()}function Ut(e){const t=Object.create(null);return e.forEach(e=>{let{pointerId:n,position:r}=e;t[n]=r}),t}const Bt={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function Gt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Bt,n),o.m.obj(e,t),t._animationExtendedEnd=0,o.m.event(e,t,"RenderEvent"),Ft.forEach(n=>o.m.event(e,t,n)),o.m.get(e,t,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),o.m.setGet(e,t,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),o.m.moveToProtected(e,t,["view"]),function(e,t){t.classHierarchy.push("vtkRenderWindowInteractor");const n={...e},r=new Set,i=new Map;let o=1;function a(n,r){t._forcedRenderer||(t.currentRenderer=e.findPokedRenderer(n,r))}e.start=()=>{(t.initialized||(e.initialize(),t.initialized))&&e.startEventLoop()},e.setRenderWindow=e=>{Rt("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},e.setInteractorStyle=n=>{t.interactorStyle!==n&&(null!=t.interactorStyle&&t.interactorStyle.setInteractor(null),t.interactorStyle=n,null!=t.interactorStyle&&t.interactorStyle.getInteractor()!==e&&t.interactorStyle.setInteractor(e))},e.initialize=()=>{t.initialized=!0,e.enable(),e.render()},e.enable=()=>e.setEnabled(!0),e.disable=()=>e.setEnabled(!1),e.startEventLoop=()=>Ot("empty event loop"),e.getCurrentRenderer=()=>(t.currentRenderer||a(0,0),t.currentRenderer);const s=t._getScreenEventPositionFor||function(e){const n=t._view.getCanvas(),r=n.getBoundingClientRect(),o=n.width/r.width,s=n.height/r.height,l={x:o*(e.clientX-r.left),y:s*(r.height-e.clientY+r.top),z:0};return(i.size<=1||!t.currentRenderer)&&a(l.x,l.y),l};function l(e){return{controlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey}}function c(e){const t=l(e);return{key:e.key,keyCode:e.charCode,...t}}function u(e){return e.pointerType||""}const d=()=>{if(null===t.container)return;const{container:n}=t;n.addEventListener("contextmenu",Vt),n.addEventListener("wheel",e.handleWheel),n.addEventListener("DOMMouseScroll",e.handleWheel),n.addEventListener("pointerenter",e.handlePointerEnter),n.addEventListener("pointerleave",e.handlePointerLeave),n.addEventListener("pointermove",e.handlePointerMove,{passive:!1}),n.addEventListener("pointerdown",e.handlePointerDown,{passive:!1}),n.addEventListener("pointerup",e.handlePointerUp),n.addEventListener("pointercancel",e.handlePointerCancel),document.addEventListener("keypress",e.handleKeyPress),document.addEventListener("keydown",e.handleKeyDown),document.addEventListener("keyup",e.handleKeyUp),document.addEventListener("pointerlockchange",e.handlePointerLockChange),n.style.touchAction="none",n.style.userSelect="none",n.style.webkitTapHighlightColor="rgba(0,0,0,0)"};e.bindEvents=e=>{null!==e&&n.setContainer(e)&&d()};const p=()=>{clearTimeout(t.moveTimeoutID),clearTimeout(t.wheelTimeoutID),t.moveTimeoutID=0,t.wheelTimeoutID=0,o=1;const{container:n}=t;n&&(n.removeEventListener("contextmenu",Vt),n.removeEventListener("wheel",e.handleWheel),n.removeEventListener("DOMMouseScroll",e.handleWheel),n.removeEventListener("pointerenter",e.handlePointerEnter),n.removeEventListener("pointerleave",e.handlePointerLeave),n.removeEventListener("pointermove",e.handlePointerMove,{passive:!1}),n.removeEventListener("pointerdown",e.handlePointerDown,{passive:!1}),n.removeEventListener("pointerup",e.handlePointerUp),n.removeEventListener("pointercancel",e.handlePointerCancel)),document.removeEventListener("keypress",e.handleKeyPress),document.removeEventListener("keydown",e.handleKeyDown),document.removeEventListener("keyup",e.handleKeyUp),document.removeEventListener("pointerlockchange",e.handlePointerLockChange),i.clear()};function h(){t._view&&t.enabled&&t.enableRender&&(t.inRender=!0,t._view.traverseAllPasses(),t.inRender=!1),e.invokeRenderEvent()}e.unbindEvents=()=>{p(),n.setContainer(null)},e.handleKeyPress=t=>{const n=c(t);e.keyPressEvent(n)},e.handleKeyDown=t=>{const n=c(t);e.keyDownEvent(n)},e.handleKeyUp=t=>{const n=c(t);e.keyUpEvent(n)},e.handlePointerEnter=t=>{const n={...l(t),position:s(t),deviceType:u(t)};e.pointerEnterEvent(n),"mouse"===n.deviceType&&e.mouseEnterEvent(n)},e.handlePointerLeave=t=>{const n={...l(t),position:s(t),deviceType:u(t)};e.pointerLeaveEvent(n),"mouse"===n.deviceType&&e.mouseLeaveEvent(n)},e.handlePointerDown=n=>{if(!(n.button>2||e.isPointerLocked()))switch(t.preventDefaultOnPointerDown&&Vt(n),n.target.hasPointerCapture(n.pointerId)&&n.target.releasePointerCapture(n.pointerId),t.container.setPointerCapture(n.pointerId),i.has(n.pointerId)&&Ot("[RenderWindowInteractor] duplicate pointerId detected"),i.set(n.pointerId,{pointerId:n.pointerId,position:s(n)}),n.pointerType){case"pen":case"touch":e.handleTouchStart(n);break;default:e.handleMouseDown(n)}},e.handlePointerUp=n=>{if(i.has(n.pointerId))switch(t.preventDefaultOnPointerUp&&Vt(n),i.delete(n.pointerId),t.container.releasePointerCapture(n.pointerId),n.pointerType){case"pen":case"touch":e.handleTouchEnd(n);break;default:e.handleMouseUp(n)}},e.handlePointerCancel=t=>{if(i.has(t.pointerId))switch(i.delete(t.pointerId),t.pointerType){case"pen":case"touch":e.handleTouchEnd(t);break;default:e.handleMouseUp(t)}},e.handlePointerMove=t=>{switch(i.has(t.pointerId)&&(i.get(t.pointerId).position=s(t)),t.pointerType){case"pen":case"touch":e.handleTouchMove(t);break;default:e.handleMouseMove(t)}},e.handleMouseDown=t=>{const n={...l(t),position:s(t),deviceType:u(t)};switch(t.button){case 0:e.leftButtonPressEvent(n);break;case 1:e.middleButtonPressEvent(n);break;case 2:e.rightButtonPressEvent(n);break;default:Rt(`Unknown mouse button pressed: ${t.button}`)}},e.requestPointerLock=()=>{t.container&&t.container.requestPointerLock()},e.exitPointerLock=()=>document.exitPointerLock?.(),e.isPointerLocked=()=>!!t.container&&document.pointerLockElement===t.container,e.handlePointerLockChange=()=>{e.isPointerLocked()?e.startPointerLockEvent():e.endPointerLockEvent()},e.requestAnimation=n=>{void 0!==n?r.has(n)?Ot("requester is already registered for animating"):(r.add(n),t.animationRequest||1!==r.size||t.xrAnimation||(t._animationStartTime=Date.now(),t._animationFrameCount=0,t.animationRequest=requestAnimationFrame(e.handleAnimation),e.startAnimationEvent())):Rt("undefined requester, can not start animating")},e.extendAnimation=n=>{const i=Date.now()+n;t._animationExtendedEnd=Math.max(t._animationExtendedEnd,i),t.animationRequest||0!==r.size||t.xrAnimation||(t._animationStartTime=Date.now(),t._animationFrameCount=0,t.animationRequest=requestAnimationFrame(e.handleAnimation),e.startAnimationEvent())},e.isAnimating=()=>t.xrAnimation||null!==t.animationRequest,e.cancelAnimation=function(n){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r.has(n))r.delete(n),t.animationRequest&&0===r.size&&Date.now()>t._animationExtendedEnd&&(cancelAnimationFrame(t.animationRequest),t.animationRequest=null,e.endAnimationEvent(),e.render());else if(!i){const e=n&&n.getClassName?n.getClassName():n;Ot(`${e} did not request an animation`)}},e.switchToXRAnimation=()=>{t.animationRequest&&(cancelAnimationFrame(t.animationRequest),t.animationRequest=null),t.xrAnimation=!0},e.returnFromXRAnimation=()=>{t.xrAnimation=!1,0!==r.size&&(t.recentAnimationFrameRate=10,t.animationRequest=requestAnimationFrame(e.handleAnimation))},e.updateXRGamepads=(n,r,i)=>{n.inputSources.forEach(n=>{const o=null==n.gripSpace?null:r.getPose(n.gripSpace,i),a=null==n.gripSpace?null:r.getPose(n.targetRaySpace,i),s=n.gamepad,l=n.handedness;if(s){s.index in t.lastGamepadValues||(t.lastGamepadValues[s.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let r=0;r<s.buttons.length;++r)r in t.lastGamepadValues[s.index][l].buttons||(t.lastGamepadValues[s.index][l].buttons[r]=!1),t.lastGamepadValues[s.index][l].buttons[r]!==s.buttons[r].pressed&&null!=o&&(e.button3DEvent({gamepad:s,position:o.transform.position,orientation:o.transform.orientation,targetPosition:a.transform.position,targetOrientation:a.transform.orientation,pressed:s.buttons[r].pressed,device:"left"===n.handedness?At.LeftController:At.RightController,input:kt[s.mapping]&&kt[s.mapping][r]?kt[s.mapping][r]:Pt.Trigger}),t.lastGamepadValues[s.index][l].buttons[r]=s.buttons[r].pressed),t.lastGamepadValues[s.index][l].buttons[r]&&null!=o&&e.move3DEvent({gamepad:s,position:o.transform.position,orientation:o.transform.orientation,targetPosition:a.transform.position,targetOrientation:a.transform.orientation,device:"left"===n.handedness?At.LeftController:At.RightController})}})},e.handleMouseMove=n=>{const r={...l(n),position:s(n),deviceType:u(n)};0===t.moveTimeoutID?e.startMouseMoveEvent(r):(e.mouseMoveEvent(r),clearTimeout(t.moveTimeoutID)),t.moveTimeoutID=setTimeout(()=>{e.endMouseMoveEvent(),t.moveTimeoutID=0},200)},e.handleAnimation=()=>{const n=Date.now();t._animationFrameCount++,n-t._animationStartTime>1e3&&t._animationFrameCount>1&&(t.recentAnimationFrameRate=1e3*(t._animationFrameCount-1)/(n-t._animationStartTime),t.lastFrameTime=1/t.recentAnimationFrameRate,e.animationFrameRateUpdateEvent(),t._animationStartTime=n,t._animationFrameCount=1),e.animationEvent(),h(),r.size>0||Date.now()<t._animationExtendedEnd?t.animationRequest=requestAnimationFrame(e.handleAnimation):(cancelAnimationFrame(t.animationRequest),t.animationRequest=null,e.endAnimationEvent(),e.render())},e.handleWheel=n=>{Vt(n);const r={...Mt(n),...l(n),position:s(n),deviceType:u(n)};0===t.wheelTimeoutID&&(o=Math.abs(r.spinY)>=.3?Math.abs(r.spinY):1),r.spinY/=o,0===t.wheelTimeoutID?(e.startMouseWheelEvent(r),e.mouseWheelEvent(r)):(e.mouseWheelEvent(r),clearTimeout(t.wheelTimeoutID)),t.mouseScrollDebounceByPass?(e.extendAnimation(600),e.endMouseWheelEvent(),t.wheelTimeoutID=0):t.wheelTimeoutID=setTimeout(()=>{e.extendAnimation(600),e.endMouseWheelEvent(),t.wheelTimeoutID=0},200)},e.handleMouseUp=t=>{const n={...l(t),position:s(t),deviceType:u(t)};switch(t.button){case 0:e.leftButtonReleaseEvent(n);break;case 1:e.middleButtonReleaseEvent(n);break;case 2:e.rightButtonReleaseEvent(n);break;default:Rt(`Unknown mouse button released: ${t.button}`)}},e.handleTouchStart=n=>{const r=[...i.values()];if(t.recognizeGestures&&r.length>1){const t=Ut(i);if(2===r.length){const t={...l(Lt),position:r[0].position,deviceType:u(n)};e.leftButtonReleaseEvent(t)}e.recognizeGesture("TouchStart",t)}else if(1===r.length){const t={...l(Lt),position:s(n),deviceType:u(n)};e.leftButtonPressEvent(t)}},e.handleTouchMove=n=>{const r=[...i.values()];if(t.recognizeGestures&&r.length>1){const t=Ut(i);e.recognizeGesture("TouchMove",t)}else if(1===r.length){const t={...l(Lt),position:r[0].position,deviceType:u(n)};e.mouseMoveEvent(t)}},e.handleTouchEnd=n=>{const r=[...i.values()];if(t.recognizeGestures)if(0===r.length){const t={...l(Lt),position:s(n),deviceType:u(n)};e.leftButtonReleaseEvent(t)}else if(1===r.length){const t=Ut(i);e.recognizeGesture("TouchEnd",t);const o={...l(Lt),position:r[0].position,deviceType:u(n)};e.leftButtonPressEvent(o)}else{const t=Ut(i);e.recognizeGesture("TouchMove",t)}else if(1===r.length){const t={...l(Lt),position:r[0].position,deviceType:u(n)};e.leftButtonReleaseEvent(t)}},e.setView=n=>{t._view!==n&&(t._view=n,t._view.getRenderable().setInteractor(e),e.modified())},e.getFirstRenderer=()=>t._view?.getRenderable()?.getRenderersByReference()?.[0],e.findPokedRenderer=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t._view)return null;const r=t._view?.getRenderable()?.getRenderers();if(!r||0===r.length)return null;r.sort((e,t)=>e.getLayer()-t.getLayer());let i=null,o=null,a=null,s=r.length;for(;s--;){const l=r[s];if(t._view.isInViewport(e,n,l)&&l.getInteractive()){a=l;break}null===i&&l.getInteractive()&&(i=l),null===o&&t._view.isInViewport(e,n,l)&&(o=l)}return null===a&&(a=i),null===a&&(a=o),null==a&&(a=r[0]),a},e.render=()=>{e.isAnimating()||t.inRender||h()},Ft.forEach(n=>{const r=n.charAt(0).toLowerCase()+n.slice(1);e[`${r}Event`]=r=>{if(!t.enabled)return;if(!e.getCurrentRenderer())return void Nt("\n          Can not forward events without a current renderer on the interactor.\n        ");const i={type:n,pokedRenderer:t.currentRenderer,firstRenderer:e.getFirstRenderer(),...r};e[`invoke${n}`](i)}}),e.recognizeGesture=(n,r)=>{if(Object.keys(r).length>2)return;if(t.startingEventPositions||(t.startingEventPositions={}),"TouchStart"===n)return Object.keys(r).forEach(e=>{t.startingEventPositions[e]=r[e]}),void(t.currentGesture="Start");if("TouchEnd"===n)return"Pinch"===t.currentGesture&&(e.render(),e.endPinchEvent()),"Rotate"===t.currentGesture&&(e.render(),e.endRotateEvent()),"Pan"===t.currentGesture&&(e.render(),e.endPanEvent()),t.currentGesture="Start",void(t.startingEventPositions={});let i=0;const o=[],a=[];Object.keys(r).forEach(e=>{o[i]=r[e],a[i]=t.startingEventPositions[e],i++});const s=Math.sqrt((a[0].x-a[1].x)*(a[0].x-a[1].x)+(a[0].y-a[1].y)*(a[0].y-a[1].y)),l=Math.sqrt((o[0].x-o[1].x)*(o[0].x-o[1].x)+(o[0].y-o[1].y)*(o[0].y-o[1].y));let c=(0,Qe.A)(Math.atan2(a[1].y-a[0].y,a[1].x-a[0].x)),u=(0,Qe.A)(Math.atan2(o[1].y-o[0].y,o[1].x-o[0].x)),d=u-c;u=u+180>=360?u-180:u+180,c=c+180>=360?c-180:c+180,Math.abs(u-c)<Math.abs(d)&&(d=u-c);const p=[];if(p[0]=(o[0].x-a[0].x+o[1].x-a[1].x)/2,p[1]=(o[0].y-a[0].y+o[1].y-a[1].y)/2,"TouchMove"===n)if("Start"===t.currentGesture){let n=.01*Math.sqrt(t.container.clientWidth*t.container.clientWidth+t.container.clientHeight*t.container.clientHeight);n<15&&(n=15);const i=Math.abs(l-s),o=3.1415926*l*Math.abs(d)/360,a=Math.sqrt(p[0]*p[0]+p[1]*p[1]);if(i>n&&i>o&&i>a){t.currentGesture="Pinch";const n={scale:1,touches:r};e.startPinchEvent(n)}else if(o>n&&o>a){t.currentGesture="Rotate";const n={rotation:0,touches:r};e.startRotateEvent(n)}else if(a>n){t.currentGesture="Pan";const n={translation:[0,0],touches:r};e.startPanEvent(n)}}else{if("Rotate"===t.currentGesture){const t={rotation:d,touches:r};e.rotateEvent(t)}if("Pinch"===t.currentGesture){const t={scale:l/s,touches:r};e.pinchEvent(t)}if("Pan"===t.currentGesture){const t={translation:p,touches:r};e.panEvent(t)}}},e.handleVisibilityChange=()=>{t._animationStartTime=Date.now(),t._animationFrameCount=0},e.setCurrentRenderer=e=>{t._forcedRenderer=!!e,t.currentRenderer=e},e.setContainer=e=>{p();const t=n.setContainer(e??null);return t&&d(),t},e.delete=()=>{for(;r.size;)e.cancelAnimation(r.values().next().value);void 0!==document.hidden&&document.removeEventListener("visibilitychange",e.handleVisibilityChange),t.container&&e.setContainer(null),n.delete()},void 0!==document.hidden&&document.addEventListener("visibilitychange",e.handleVisibilityChange,!1)}(e,t)}var Wt={newInstance:o.m.newInstance(Gt,"vtkRenderWindowInteractor"),extend:Gt,handledEvents:Ft,...Dt};n(23834),n(46576),n(16623),n(93702);const zt={background:[0,0,0],container:null};function Ht(e,t,n={}){Object.assign(t,zt,n),r.ZP.obj(e,t),r.ZP.get(e,t,["renderWindow","openGLRenderWindow","interactor","container"]),r.ZP.event(e,t,"resize"),function(e,t){const n=e.invokeResize;delete e.invokeResize,t.renderWindow=d.newInstance(),t.rendererMap={},t.openGLRenderWindow=St.newInstance(),t.renderWindow.addView(t.openGLRenderWindow),t.interactor=Wt.newInstance(),t.interactor.setView(t.openGLRenderWindow),t.interactor.initialize(),e.addRenderer=({viewport:e,id:n,background:r})=>{const i=It.ZP.newInstance({viewport:e,background:r||t.background});t.renderWindow.addRenderer(i),t.rendererMap[n]=i},e.destroy=()=>{t.renderWindow.getInteractor().delete()},e.removeRenderer=n=>{const r=e.getRenderer(n);t.renderWindow.removeRenderer(r),r.delete(),delete t.rendererMap[n]},e.getRenderer=e=>t.rendererMap[e],e.getRenderers=()=>{const{rendererMap:e}=t;return Object.keys(e).map(t=>({id:t,renderer:e[t]}))},e.resize=()=>{if(t.container){const{width:e,height:r}=t.container;t.openGLRenderWindow.setSize(Math.floor(e),Math.floor(r)),n(),t.renderWindow.render()}},e.setContainer=e=>{t.container=e,t.openGLRenderWindow.setContainer(t.container)},e.delete=r.ZP.chain(e.setContainer,e.destroy,t.openGLRenderWindow.delete,e.delete),e.resize()}(e,t)}const jt={newInstance:r.ZP.newInstance(Ht),extend:Ht};var Zt=n(51480),Kt=n(32069),$t=n(28719);const qt={updatedFrames:[]};function Xt(e,t,n={}){Object.assign(t,qt,n),g.default.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkStreamingOpenGLTexture");const n=e.create3DFilterableFromRaw;e.create3DFilterableFromRaw=(e,r,i,o,a,s,l)=>{t.inputDataType=a,t.inputNumComps=o,n(e,r,i,o,a,s,l)},e.update3DFromRaw=n=>{const{updatedFrames:r}=t;if(!r.length)return;let i,o;if(t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),n instanceof Uint8Array)i=1,o=Uint8Array;else if(n instanceof Int16Array)i=2,o=Int16Array;else if(n instanceof Uint16Array)i=2,o=Uint16Array;else{if(!(n instanceof Float32Array))throw new Error("No support for given TypedArray.");i=4,o=Float32Array}for(let e=0;e<r.length;e++)r[e]&&t.fillSubImage3D(n,e,i,o);return t.updatedFrames=[],t.generateMipmap&&t.context.generateMipmap(t.target),e.deactivate(),!0},t.fillSubImage3D=(e,n,r,i)=>{const o=e.buffer,a=n*(t.width*t.height*t.components*r),s=t.width*t.components,l=t.context,c=l.getParameter(l.MAX_TEXTURE_SIZE);let u=Math.floor(r*c/t.width);u=Math.min(u,t.height);const{useNorm16Texture:d,preferSizeOverAccuracy:p}=(0,$t.P_)().rendering;d&&!p&&(u=1);const h=s*u,f=h*r,m=Math.floor(t.height/u),g=t.height%u,v=s*g;for(let e=0;e<m;e++){const r=e*u;let s=new i(o,a+e*f,h);if(t.useHalfFloat&&(i===Uint16Array||i===Int16Array)){for(let e=0;e<s.length;e++)s[e]=Kt.default.toHalf(s[e]);i===Int16Array&&(s=new Uint16Array(s))}l.texSubImage3D(t.target,0,0,r,n,t.width,u,1,t.format,t.openGLDataType,s)}if(0!==g){const e=m*u,r=new i(o,a+m*f,v);l.texSubImage3D(t.target,0,0,e,n,t.width,g,1,t.format,t.openGLDataType,r)}},e.getTextureParameters=()=>({width:t.width,height:t.height,depth:t.depth,numComps:t.inputNumComps,dataType:t.inputDataType}),e.setUpdatedFrame=e=>{t.updatedFrames[e]=!0}}(e,t)}const Yt={newInstance:r.ZP.newInstance(Xt,"vtkStreamingOpenGLTexture"),extend:Xt};n(20037)},20037:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var r=n(6685),i=n(34535),o=n(32899),a=n(72076);const s={isPerformingCoordinateTransformation:!1};function l(e,t,n={}){Object.assign(t,s,n),i.ZP.extend(e,t,n),r.ZP.setGet(e,t,["isPerformingCoordinateTransformation"]),function(e,t){t.classHierarchy.push("vtkSlabCamera");const n=a._E.identity(new Float64Array(16)),r=new Float64Array(3);e.getProjectionMatrix=(e,i,s)=>{const l=a._E.create();if(t.projectionMatrix){const e=1/t.physicalScale;return a.R3.set(r,e,e,e),a._E.copy(l,t.projectionMatrix),a._E.scale(l,l,r),a._E.transpose(l,l),l}a._E.identity(n);let c=t.clippingRange[0],u=t.clippingRange[1];t.isPerformingCoordinateTransformation&&(c=t.distance,u=t.distance+.1);const d=u-c,p=[c+(i+1)*d/2,c+(s+1)*d/2];if(t.parallelProjection){const r=t.parallelScale*e,i=t.parallelScale,o=(t.windowCenter[0]-1)*r,s=(t.windowCenter[0]+1)*r,l=(t.windowCenter[1]-1)*i,c=(t.windowCenter[1]+1)*i;a._E.ortho(n,o,s,l,c,p[0],p[1]),a._E.transpose(n,n)}else{if(t.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const r=Math.tan(o.ZP.radiansFromDegrees(t.viewAngle)/2);let i,a;!0===t.useHorizontalViewAngle?(i=c*r,a=c*r/e):(i=c*r*e,a=c*r);const s=(t.windowCenter[0]-1)*i,l=(t.windowCenter[0]+1)*i,u=(t.windowCenter[1]-1)*a,d=(t.windowCenter[1]+1)*a,h=p[0],f=p[1];n[0]=2*h/(l-s),n[5]=2*h/(d-u),n[2]=(s+l)/(l-s),n[6]=(u+d)/(d-u),n[10]=-(h+f)/(f-h),n[14]=-1,n[11]=-2*h*f/(f-h),n[15]=0}}return a._E.copy(l,n),l}}(e,t)}const c={newInstance:r.ZP.newInstance(l,"vtkSlabCamera"),extend:l}},84326:(e,t,n)=>{"use strict";n.d(t,{J:()=>c,Z:()=>u});var r=n(8455),i=n(54131);var o=n(11723),a=n(63466),s=n(5287),l=n(30023);class c{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.imageCacheOffsetMap=new Map,this.isPreScaled=!1;const{imageIds:t,scalarData:n,scaling:o,dimensions:s,spacing:l,origin:c,direction:u,volumeId:d,referencedVolumeId:p,sizeInBytes:h,imageData:f,metadata:m,referencedImageIds:g,additionalDetails:v}=e;if(this.imageIds=t,this.volumeId=d,this.metadata=m,this.dimensions=s,this.spacing=l,this.origin=c,this.direction=u,this.scalarData=n,this.sizeInBytes=h,this.vtkOpenGLTexture=a.aB.newInstance(),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],f)this.imageData=f;else{const e=r.ZP.newInstance(),t=i.default.newInstance({name:"Pixels",numberOfComponents:1,values:n});e.setDimensions(s),e.setSpacing(l),e.setDirection(u),e.setOrigin(c),e.getPointData().setScalars(t),this.imageData=e}this.numFrames=this._getNumFrames(),this._reprocessImageIds(),this._createCornerstoneImageMetaData(),o&&(this.scaling=o),p&&(this.referencedVolumeId=p),g&&(this.referencedImageIds=g),v&&(this.additionalDetails=v)}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,t)=>{const n=(0,o.imageIdToURI)(e);this._imageIdsIndexMap.set(e,t),this._imageURIsIndexMap.set(n,t)})}isDynamicVolume(){return!1}getScalarData(){if((e=this.scalarData)instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)return this.scalarData;var e;throw new Error("Unknown scalar data type")}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}destroy(){this.imageData.delete(),this.imageData=null,this.scalarData=null,this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}getScalarDataArrays(){return this.isDynamicVolume()?this.scalarData:[this.scalarData]}modified(){if(this.imageData.modified(),this.isDynamicVolume())throw new Error("Not implemented");this.scalarData=this.imageData.getPointData().getScalars().getData(),this.numFrames=this._getNumFrames()}decache(e=!1){e?this.removeFromCache():this.convertToImageSlicesAndCache()}removeFromCache(){s.Z.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){const{scalarData:e}=this;return this.isDynamicVolume()?e[0].length:e.length}_getNumFrames(){const{imageIds:e,scalarData:t}=this,n=this.isDynamicVolume()?t.length:1;return e.length/n}_getScalarDataLength(){const{scalarData:e}=this;return this.isDynamicVolume()?e[0].length:e.length}_createCornerstoneImageMetaData(){const{numFrames:e}=this;if(0===e)return;const t=this.sizeInBytes/e,n=this._getScalarDataLength()/this.numVoxels,r=this.dimensions[0]*this.dimensions[1]*n,{PhotometricInterpretation:i,voiLut:o,VOILUTFunction:a}=this.metadata;let s=[],l=[];o&&o.length&&(s=o.map(e=>e.windowCenter),l=o.map(e=>e.windowWidth));const c=n>1;this.cornerstoneImageMetaData={bytesPerImage:t,numComponents:n,pixelsPerImage:r,windowCenter:s,windowWidth:l,color:c,rgba:!1,spacing:this.spacing,dimensions:this.dimensions,photometricInterpretation:i,voiLUTFunction:a,invert:"MONOCHROME1"===i}}getScalarDataByImageIdIndex(e){if(e<0||e>=this.imageIds.length)throw new Error("imageIdIndex out of range");return this.getScalarDataArrays()[Math.floor(e/this.numFrames)]}getCornerstoneImage(e,t){const{imageIds:n}=this,r=this.imageIdIndexToFrameIndex(t),{bytesPerImage:i,pixelsPerImage:a,windowCenter:s,windowWidth:c,numComponents:u,color:d,dimensions:p,spacing:h,invert:f,voiLUTFunction:m,photometricInterpretation:g}=this.cornerstoneImageMetaData,v=this.getScalarDataByImageIdIndex(t),y=v.buffer,b=v.constructor,C=i/a;let w=i*r;v.BYTES_PER_ELEMENT!==C&&(w*=v.BYTES_PER_ELEMENT/C);const E=new b(a),T=new b(y,w,a);E.set(T);const x=n[t],_=l.get("modalityLutModule",x)||{},S=(0,o.getMinMax)(E);return{imageId:e,intercept:_.rescaleIntercept?_.rescaleIntercept:0,windowCenter:s,windowWidth:c,voiLUTFunction:m,color:d,rgba:!1,numComps:u,rows:p[1],columns:p[0],sizeInBytes:E.byteLength,getPixelData:()=>E,minPixelValue:S.min,maxPixelValue:S.max,slope:_.rescaleSlope?_.rescaleSlope:1,getCanvas:void 0,height:p[0],width:p[1],columnPixelSpacing:h[0],rowPixelSpacing:h[1],invert:f,photometricInterpretation:g}}imageIdIndexToFrameIndex(e){return e%this.numFrames}convertToCornerstoneImage(e,t){return this.getCornerstoneImageLoadObject(e,t)}getCornerstoneImageLoadObject(e,t){const n=this.getCornerstoneImage(e,t);return{promise:Promise.resolve(n)}}getCornerstoneImages(){const{imageIds:e}=this;return e.map((e,t)=>this.getCornerstoneImage(e,t))}convertToImageSlicesAndCache(){const e=this.sizeInBytes;if(!this.imageIds?.length){const e=this.referencedVolumeId;let t=this.dimensions[2];if(e){const n=s.Z.getVolume(e);t=n?.imageIds?.length??t}this.imageIds=Array.from({length:t},(e,t)=>`generated:${this.volumeId}:${t}`),this._reprocessImageIds(),this.numFrames=this._getNumFrames(),this._createCornerstoneImageMetaData()}const t=this.imageIds.length,{bytesPerImage:n}=this.cornerstoneImageMetaData;let r=s.Z.decacheIfNecessaryUntilBytesAvailable(e,this.imageIds);for(let e=0;e<t;e++){const t=this.imageIds[e];r-=n;const i=this.getCornerstoneImage(t,e),a={promise:Promise.resolve(i)};if(s.Z.getImageLoadObject(t)||s.Z.putImageLoadObject(t,a).catch(e=>{console.error(e)}),r<=n)break;const l=[this.direction[0],this.direction[1],this.direction[2],this.direction[3],this.direction[4],this.direction[5]],c=6,u=[parseFloat((this.origin[0]+e*this.direction[6]*this.spacing[0]).toFixed(c)),parseFloat((this.origin[1]+e*this.direction[7]*this.spacing[1]).toFixed(c)),parseFloat((this.origin[2]+e*this.direction[8]*this.spacing[2]).toFixed(c))],d={imagePixelModule:{bitsAllocated:8*i.getPixelData().BYTES_PER_ELEMENT,photometricInterpretation:i.photometricInterpretation,windowWidth:i.windowWidth,windowCenter:i.windowCenter,voiLUTFunction:i.voiLUTFunction},imagePlaneModule:{rowCosines:[this.direction[0],this.direction[1],this.direction[2]],columnCosines:[this.direction[3],this.direction[4],this.direction[5]],pixelSpacing:[this.spacing[0],this.spacing[1]],imageOrientationPatient:l,imagePositionPatient:u,columnPixelSpacing:i.columnPixelSpacing,rowPixelSpacing:i.rowPixelSpacing,columns:i.columns,rows:i.rows},generalSeriesModule:{}};["imagePixelModule","imagePlaneModule","generalSeriesModule"].forEach(e=>{o.genericMetadataProvider.add(t,{type:e,metadata:d[e]})})}const i=s.Z.filterVolumesByReferenceId(this.volumeId);return i.length&&i.forEach(e=>{e.referencedImageIds=this.imageIds}),this.removeFromCache(),this.imageIds}}const u=c},35421:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});class r{constructor(e){this.color=[200,0,0],this.id=e.id,this.points=e.data.points,this.polys=e.data.polys,this.color=e.color??this.color,this.frameOfReferenceUID=e.frameOfReferenceUID,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){return 4*this.points.length+4*this.polys.length}getColor(){return this.color}getPoints(){return this.points}getPolys(){return this.polys}setColor(e){this.color=e}setPoints(e){this.points=e}setPolys(e){this.polys=e}getSizeInBytes(){return this.sizeInBytes}}},82253:(e,t,n)=>{"use strict";n.d(t,{JI:()=>i.Z,ZP:()=>o});var r=n(5287),i=n(84326);n(35421);const o=r.Z},52813:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}}},48588:(e,t,n)=>{"use strict";n.d(t,{EPSILON:()=>i.Z,MPR_CAMERA_VALUES:()=>a,RENDERING_DEFAULTS:()=>r.Z,VIEWPORT_PRESETS:()=>s});n(52813);var r=n(87525),i=n(34061);const o=function e(t){const n=Object.getOwnPropertyNames(t);for(const r of n){const n=t[r];n&&"object"==typeof n&&e(n)}return Object.freeze(t)},a=o({axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1]}}),s=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}]},2689:()=>{"use strict";var e;!function(e){e.CLOSED_PLANAR="CLOSED_PLANAR",e.OPEN_PLANAR="OPEN_PLANAR"}(e||(e={}))},19546:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.ERROR_EVENT="CORNERSTONE_ERROR",e.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",e.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",e.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",e.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",e.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",e.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",e.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",e.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",e.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",e.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",e.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",e.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",e.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",e.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",e.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",e.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",e.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",e.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",e.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",e.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",e.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",e.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",e.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",e.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",e.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",e.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",e.STACK_VIEWPORT_NEW_STACK="CORNERSTONE_STACK_VIEWPORT_NEW_STACK",e.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",e.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",e.VOLUME_SCROLL_OUT_OF_BOUNDS="VOLUME_SCROLL_OUT_OF_BOUNDS",e.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",e.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",e.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",e.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED"}(r||(r={}));const i=r},83521:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e[e.FAR_REPLICATE=1]="FAR_REPLICATE",e[e.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",e[e.SUBRESOLUTION=6]="SUBRESOLUTION",e[e.LOSSY=7]="LOSSY",e[e.FULL_RESOLUTION=8]="FULL_RESOLUTION"}(r||(r={}));const i=r},75677:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e[e.FAST_LINEAR=2]="FAST_LINEAR"}(r||(r={}));const i=r},636:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.CALIBRATION="calibrationModule",e.CINE="cineModule",e.GENERAL_IMAGE="generalImageModule",e.GENERAL_SERIES="generalSeriesModule",e.GENERAL_STUDY="generalStudyModule",e.IMAGE_PIXEL="imagePixelModule",e.IMAGE_PLANE="imagePlaneModule",e.IMAGE_URL="imageUrlModule",e.MODALITY_LUT="modalityLutModule",e.MULTIFRAME="multiframeModule",e.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",e.OVERLAY_PLANE="overlayPlaneModule",e.PATIENT="patientModule",e.PATIENT_STUDY="patientStudyModule",e.PET_IMAGE="petImageModule",e.PET_ISOTOPE="petIsotopeModule",e.PET_SERIES="petSeriesModule",e.SOP_COMMON="sopCommonModule",e.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",e.VOI_LUT="voiLutModule",e.WEB_CLIENT="webClient"}(r||(r={}));const i=r},96426:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.AXIAL="axial",e.CORONAL="coronal",e.SAGITTAL="sagittal",e.ACQUISITION="acquisition"}(r||(r={}));const i=r},91799:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.TRUE="true",e.FALSE="false",e.AUTO="auto"}(r||(r={}));const i=r},67751:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.LINEAR="LINEAR",e.SAMPLED_SIGMOID="SIGMOID"}(r||(r={}));const i=r},40373:(e,t,n)=>{"use strict";var r;n.d(t,{SpeedUnit:()=>r}),function(e){e.FRAME="f",e.SECOND="s"}(r||(r={}))},68032:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.STACK="stack",e.ORTHOGRAPHIC="orthographic",e.PERSPECTIVE="perspective",e.VOLUME_3D="volume3d",e.VIDEO="video",e.WholeSlide="wholeSlide"}(r||(r={}));const i=r},74238:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=new class{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,t){const n=r=>{this.removeEventListener(e,n),t.call(this,r)};this.addEventListener(e,n)}addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)}addEventListenerDebounced(e,t,n){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const r=this.debouncedListeners[e];if(!r[t]){const i=e=>{r[t]&&clearTimeout(r[t].timeoutId),r[t].timeoutId=setTimeout(()=>{t.call(this,e)},n)};r[t]={original:t,handle:i,timeoutId:null},this.addEventListener(e,i)}}removeEventListenerDebounced(e,t){if(this.debouncedListeners[e]&&this.debouncedListeners[e][t]){const n=this.debouncedListeners[e][t];this.removeEventListener(e,n.handle),clearTimeout(n.timeoutId),delete this.debouncedListeners[e][t]}}removeEventListener(e,t){if(!this.listeners[e])return;const n=this.listeners[e],r=n.length;for(let e=0;e<r;e++)if(n[e]===t)return void n.splice(e,1)}dispatchEvent(e){if(!this.listeners[e.type])return;const t=this.listeners[e.type].slice(),n=t.length;for(let r=0;r<n;r++)try{t[r].call(this,e)}catch(t){console.error(`error in event listener of type:  ${e.type}`,t)}return!e.defaultPrevented}}},62709:(e,t,n)=>{"use strict";n.d(t,{BaseVolumeViewport:()=>l.Z,CONSTANTS:()=>o,EVENTS:()=>i.Events,Enums:()=>i,Settings:()=>w.Z,StackViewport:()=>c.Z,VideoViewport:()=>u.Z,VolumeViewport:()=>a.Z,VolumeViewport3D:()=>s.Z,addImageSlicesToViewports:()=>Wt.PN,addVolumesToViewports:()=>Wt.gc,cache:()=>h.ZP,eventTarget:()=>d.Z,geometryLoader:()=>r,getConfiguration:()=>C.P_,getEnabledElement:()=>y.ZP,getEnabledElementByIds:()=>y.O,getEnabledElementByViewportId:()=>y.Yz,getEnabledElements:()=>y.wN,getRenderingEngine:()=>p.Pr,getRenderingEngines:()=>p.Uu,getWebWorkerManager:()=>C.Pt,imageLoadPoolManager:()=>v.Z,imageLoader:()=>T,metaData:()=>b,triggerEvent:()=>Gt.Z,utilities:()=>Bt,volumeLoader:()=>E});var r={};n.r(r),n.d(r,{createAndCacheGeometry:()=>Ut});var i=n(7187),o=n(48588),a=(n(69552),n(32932)),s=n(46190),l=n(36205),c=n(98715),u=n(49001),d=(n(86057),n(77614),n(74238)),p=n(9138),h=n(82253),f=n(42961),m=n(49334);const g=new f.P("imageRetrievalPool");g.setMaxSimultaneousRequests(m.Z.Interaction,200),g.setMaxSimultaneousRequests(m.Z.Thumbnail,200),g.setMaxSimultaneousRequests(m.Z.Prefetch,200),g.grabDelay=0;var v=n(96506),y=n(65279),b=n(30023),C=n(28719),w=n(90261),E=n(18588),T=n(62990),x=(n(34349),n(6872),n(67739),n(40704),n(68470)),_=n(72076),S=n(81628),I=n(59474),D=n(16623),A=n(91382),P=n(54131),O=n(93702),R=n(46576),M=n(64725);const N=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],L=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],k=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],F=[0,1,0,1,0,1,0,1,2,2,2,2],V=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],U=new Float64Array(3),B=new Float64Array(3),G=new Float64Array(3),W=new Float64Array(3),z=new Float64Array(3),H=new Float64Array(3),j=new Float64Array(16);function Z(e,t){e.strokeStyle=t.strokeColor,e.lineWidth=t.strokeSize,e.fillStyle=t.fontColor,e.font=`${t.fontStyle} ${t.fontSize}px ${t.fontFamily}`}function K(e){const t=[],n=[];for(let r=0;r<3;r++){const i=S.BY().domain([e[2*r],e[2*r+1]]);t[r]=i.ticks(5);const o=i.tickFormat(5);n[r]=t[r].map(o)}return{ticks:t,tickStrings:n}}const $=x.m.newInstance(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{renderable:null};Object.assign(t,{},n),x.m.obj(e,t),t.tmPolyData=R.ZP.newInstance(),t.tmMapper=O.default.newInstance(),t.tmMapper.setInputData(t.tmPolyData),t.tmActor=D.ZP.newInstance({parentProp:e}),t.tmActor.setMapper(t.tmMapper),x.m.setGet(e,t,["renderable"]),x.m.get(e,t,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),t.forceUpdate=!1,t.lastRedrawTime={},x.m.obj(t.lastRedrawTime,{mtime:0}),t.lastRebuildTime={},x.m.obj(t.lastRebuildTime,{mtime:0}),t.lastSize=[-1,-1],t.lastTickBounds=[],function(e,t){t.classHierarchy.push("vtkCubeAxesActorHelper"),e.setRenderable=n=>{t.renderable!==n&&(t.renderable=n,t.tmActor.addTexture(t.renderable.getTmTexture()),t.tmActor.setProperty(n.getProperty()),t.tmActor.setParentProp(n),e.modified())},e.createPolyDataForOneLabel=(e,n,r,i,o,a,s)=>{const l=t.renderable.get_tmAtlas().get(e);if(!l)return;const c=t.renderable.getTextPolyData().getPoints().getData(),u=t.lastSize;U[0]=c[3*n],U[1]=c[3*n+1],U[2]=c[3*n+2],_.R3.transformMat4(G,U,r),G[0]+=.1,_.R3.transformMat4(B,G,i),_.R3.subtract(z,B,U),G[0]-=.1,G[1]+=.1,_.R3.transformMat4(B,G,i),_.R3.subtract(H,B,U);for(let e=0;e<3;e++)z[e]/=.05*u[0],H[e]/=.05*u[1];let d=s.ptIdx,p=s.cellIdx;U[0]=c[3*n],U[1]=c[3*n+1],U[2]=c[3*n+2],o[0]<-.5?_.R3.scale(G,z,o[0]*a-l.width):o[0]>.5?_.R3.scale(G,z,o[0]*a):_.R3.scale(G,z,o[0]*a-l.width/2),_.R3.add(U,U,G),_.R3.scale(G,H,o[1]*a-l.height/2),_.R3.add(U,U,G),s.points[3*d]=U[0],s.points[3*d+1]=U[1],s.points[3*d+2]=U[2],s.tcoords[2*d]=l.tcoords[0],s.tcoords[2*d+1]=l.tcoords[1],d++,_.R3.scale(G,z,l.width),_.R3.add(U,U,G),s.points[3*d]=U[0],s.points[3*d+1]=U[1],s.points[3*d+2]=U[2],s.tcoords[2*d]=l.tcoords[2],s.tcoords[2*d+1]=l.tcoords[3],d++,_.R3.scale(G,H,l.height),_.R3.add(U,U,G),s.points[3*d]=U[0],s.points[3*d+1]=U[1],s.points[3*d+2]=U[2],s.tcoords[2*d]=l.tcoords[4],s.tcoords[2*d+1]=l.tcoords[5],d++,_.R3.scale(G,z,l.width),_.R3.subtract(U,U,G),s.points[3*d]=U[0],s.points[3*d+1]=U[1],s.points[3*d+2]=U[2],s.tcoords[2*d]=l.tcoords[6],s.tcoords[2*d+1]=l.tcoords[7],d++,s.polys[4*p]=3,s.polys[4*p+1]=d-4,s.polys[4*p+2]=d-3,s.polys[4*p+3]=d-2,p++,s.polys[4*p]=3,s.polys[4*p+1]=d-4,s.polys[4*p+2]=d-2,s.polys[4*p+3]=d-1,s.ptIdx+=4,s.cellIdx+=2},e.updateTexturePolyData=()=>{const n=t.camera.getCompositeProjectionMatrix(t.lastAspectRatio,-1,1);_._E.transpose(n,n);const r=t.renderable.getTextValues().length,i=4*r,o=2*r,a=new Float64Array(3*i),s=new Uint16Array(4*o),l=new Float32Array(2*i);_._E.invert(j,n);const c={ptIdx:0,cellIdx:0,polys:s,points:a,tcoords:l};let u=0,d=0,p=0;const h=t.renderable.getTextPolyData().getPoints().getData(),f=t.renderable.getTextValues();for(;u<h.length/3;){U[0]=h[3*u],U[1]=h[3*u+1],U[2]=h[3*u+2],_.R3.transformMat4(G,U,n),U[0]=h[3*u+3],U[1]=h[3*u+4],U[2]=h[3*u+5],_.R3.transformMat4(W,U,n),_.R3.subtract(G,G,W);const r=[G[0],G[1]];(0,I.P)(r),e.createPolyDataForOneLabel(f[d],u,n,j,r,t.renderable.getAxisTitlePixelOffset(),c),u+=2,d++;for(let i=0;i<t.renderable.getTickCounts()[p];i++)e.createPolyDataForOneLabel(f[d],u,n,j,r,t.renderable.getTickLabelPixelOffset(),c),u++,d++;p++}const m=P.default.newInstance({numberOfComponents:2,values:l,name:"TextureCoordinates"});t.tmPolyData.getPointData().setTCoords(m),t.tmPolyData.getPoints().setData(a,3),t.tmPolyData.getPoints().modified(),t.tmPolyData.getPolys().setData(s,1),t.tmPolyData.getPolys().modified(),t.tmPolyData.modified()},e.updateAPISpecificData=(n,r,i)=>{t.lastSize[0]===n[0]&&t.lastSize[1]===n[1]||(t.lastSize[0]=n[0],t.lastSize[1]=n[1],t.lastAspectRatio=n[0]/n[1],t.forceUpdate=!0),t.camera=r,e.updateTexturePolyData()}}(e,t)},"vtkCubeAxesActorHelper");function q(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};D.ZP.extend(e,t,function(e,t,n){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...A.ZP.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:K,...n,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...n?.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...n?.tickTextStyle}}}(0,0,n)),t.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],t.axisLabels=["X-Axis","Y-Axis","Z-Axis"],t.tickCounts=[],t.textValues=[],t.lastTickBounds=[],t.tmCanvas=document.createElement("canvas"),t.tmContext=t.tmCanvas.getContext("2d"),t._tmAtlas=new Map,t.tmTexture=M.ZP.newInstance({resizable:!0}),t.tmTexture.setInterpolate(!1),e.getProperty().setDiffuse(0),e.getProperty().setAmbient(1),t.gridMapper=O.default.newInstance(),t.polyData=R.ZP.newInstance(),t.gridMapper.setInputData(t.polyData),t.gridActor=D.ZP.newInstance(),t.gridActor.setMapper(t.gridMapper),t.gridActor.setProperty(e.getProperty()),t.gridActor.setParentProp(e),t.textPolyData=R.ZP.newInstance(),x.m.setGet(e,t,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),x.m.setGetArray(e,t,["dataBounds"],6),x.m.setGetArray(e,t,["axisLabels"],3),x.m.get(e,t,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),function(e,t){t.classHierarchy.push("vtkCubeAxesActor"),e.setCamera=n=>{t.camera!==n&&(t.cameraModifiedSub&&(t.cameraModifiedSub.unsubscribe(),t.cameraModifiedSub=null),t.camera=n,n&&(t.cameraModifiedSub=n.onModified(e.update)),e.update(),e.modified())},e.computeFacesToDraw=()=>{const e=t.camera.getViewMatrix();_._E.transpose(e,e);let n=!1;const r=A.ZP.getDiagonalLength(t.dataBounds),i=Math.sin(t.faceVisibilityAngle*Math.PI/180);for(let o=0;o<6;o++){let a=!1;const s=Math.floor(o/2),l=(s+1)%3,c=(s+2)%3;t.dataBounds[2*l]!==t.dataBounds[2*l+1]&&t.dataBounds[2*c]!==t.dataBounds[2*c+1]&&(U[s]=t.dataBounds[o]-.1*r*N[o][s],U[l]=.5*(t.dataBounds[2*l]+t.dataBounds[2*l+1]),U[c]=.5*(t.dataBounds[2*c]+t.dataBounds[2*c+1]),_.R3.transformMat4(G,U,e),U[s]=t.dataBounds[o],_.R3.transformMat4(W,U,e),_.R3.subtract(G,W,G),_.R3.normalize(G,G),a=G[2]>i,t.camera.getParallelProjection()||(_.R3.normalize(W,W),a=_.R3.dot(W,G)>i)),a!==t.lastFacesToDraw[o]&&(t.lastFacesToDraw[o]=a,n=!0)}return n},e.updatePolyData=(e,n,r)=>{let i=0,o=0;i+=8;let a=0;for(let e=0;e<12;e++)n[e]>0&&a++;if(o+=a,t.gridLines)for(let t=0;t<6;t++)e[t]&&(i+=2*r[V[t][0]].length+2*r[V[t][1]].length,o+=r[V[t][0]].length+r[V[t][1]].length);const s=new Float64Array(3*i),l=new Uint32Array(3*o);let c=0,u=0;for(let e=0;e<2;e++)for(let n=0;n<2;n++)for(let r=0;r<2;r++)s[3*c]=t.dataBounds[r],s[3*c+1]=t.dataBounds[2+n],s[3*c+2]=t.dataBounds[4+e],c++;for(let e=0;e<12;e++)n[e]>0&&(l[3*u]=2,l[3*u+1]=k[e][0],l[3*u+2]=k[e][1],u++);if(t.gridLines)for(let n=0;n<6;n++)if(e[n]){const e=Math.floor(n/2);let i=r[V[n][0]];for(let r=0;r<i.length;r++)s[3*c+e]=t.dataBounds[n],s[3*c+V[n][0]]=i[r],s[3*c+V[n][1]]=t.dataBounds[2*V[n][1]],c++,s[3*c+e]=t.dataBounds[n],s[3*c+V[n][0]]=i[r],s[3*c+V[n][1]]=t.dataBounds[2*V[n][1]+1],c++,l[3*u]=2,l[3*u+1]=c-2,l[3*u+2]=c-1,u++;i=r[V[n][1]];for(let r=0;r<i.length;r++)s[3*c+e]=t.dataBounds[n],s[3*c+V[n][1]]=i[r],s[3*c+V[n][0]]=t.dataBounds[2*V[n][0]],c++,s[3*c+e]=t.dataBounds[n],s[3*c+V[n][1]]=i[r],s[3*c+V[n][0]]=t.dataBounds[2*V[n][0]+1],c++,l[3*u]=2,l[3*u+1]=c-2,l[3*u+2]=c-1,u++}t.polyData.getPoints().setData(s,3),t.polyData.getPoints().modified(),t.polyData.getLines().setData(l,1),t.polyData.getLines().modified(),t.polyData.modified()},e.updateTextData=(e,n,r,i)=>{let o=0;for(let e=0;e<12;e++)1===n[e]&&(o+=2,o+=r[F[e]].length);const a=t.polyData.getPoints().getData(),s=new Float64Array(3*o);let l=0,c=0,u=0;for(let o=0;o<6;o++)if(e[o])for(let e=0;e<4;e++){const d=L[o][e];if(1===n[d]){const e=F[d],n=3*k[d][0],p=3*k[d][1];s[3*l]=.5*(a[n]+a[p]),s[3*l+1]=.5*(a[n+1]+a[p+1]),s[3*l+2]=.5*(a[n+2]+a[p+2]),l++,s[3*l+Math.floor(o/2)]=t.dataBounds[o],s[3*l+V[o][0]]=.5*(t.dataBounds[2*V[o][0]]+t.dataBounds[2*V[o][0]+1]),s[3*l+V[o][1]]=.5*(t.dataBounds[2*V[o][1]]+t.dataBounds[2*V[o][1]+1]),l++,t.textValues[c]=t.axisLabels[e],c++;const h=(e+1)%3,f=(e+2)%3,m=r[e],g=i[e];t.tickCounts[u]=m.length;for(let r=0;r<m.length;r++)s[3*l+e]=m[r],s[3*l+h]=a[n+h],s[3*l+f]=a[n+f],l++,t.textValues[c]=g[r],c++;u++}}t.textPolyData.getPoints().setData(s,3),t.textPolyData.modified()},e.update=()=>{if(!t.camera)return;const n=e.computeFacesToDraw(),r=t.lastFacesToDraw;let i=!1;for(let e=0;e<6;e++)t.dataBounds[e]!==t.lastTickBounds[e]&&(i=!0,t.lastTickBounds[e]=t.dataBounds[e]);if(n||i||t.forceUpdate){const n=new Array(12).fill(0);for(let e=0;e<6;e++)if(r[e])for(let t=0;t<4;t++)n[L[e][t]]++;const o=t.generateTicks(t.dataBounds);e.updatePolyData(r,n,o.ticks),e.updateTextData(r,n,o.ticks,o.tickStrings),(i||t.forceUpdate)&&e.updateTextureAtlas(o.tickStrings)}t.forceUpdate=!1},e.updateTextureAtlas=e=>{t.tmContext.textBaseline="bottom",t.tmContext.textAlign="left",t._tmAtlas.clear();let n=0,r=1;for(let i=0;i<3;i++){if(!t._tmAtlas.has(t.axisLabels[i])){Z(t.tmContext,t.axisTextStyle);const e=t.tmContext.measureText(t.axisLabels[i]),o={height:e.actualBoundingBoxAscent+2,startingHeight:r,width:e.width+2,textStyle:t.axisTextStyle};t._tmAtlas.set(t.axisLabels[i],o),r+=o.height,n<o.width&&(n=o.width)}Z(t.tmContext,t.tickTextStyle);for(let o=0;o<e[i].length;o++)if(!t._tmAtlas.has(e[i][o])){const a=t.tmContext.measureText(e[i][o]),s={height:a.actualBoundingBoxAscent+2,startingHeight:r,width:a.width+2,textStyle:t.tickTextStyle};t._tmAtlas.set(e[i][o],s),r+=s.height,n<s.width&&(n=s.width)}}n=(0,I.Q)(n),r=(0,I.Q)(r),t._tmAtlas.forEach(e=>{e.tcoords=[0,(r-e.startingHeight-e.height)/r,e.width/n,(r-e.startingHeight-e.height)/r,e.width/n,(r-e.startingHeight)/r,0,(r-e.startingHeight)/r]}),t.tmCanvas.width=n,t.tmCanvas.height=r,t.tmContext.textBaseline="bottom",t.tmContext.textAlign="left",t.tmContext.clearRect(0,0,n,r),t._tmAtlas.forEach((e,n)=>{Z(t.tmContext,e.textStyle),t.tmContext.fillText(n,1,e.startingHeight+e.height-1)}),t.tmTexture.setCanvas(t.tmCanvas),t.tmTexture.modified()},e.onModified(()=>{t.forceUpdate=!0,e.update()}),e.setTickTextStyle=n=>{t.tickTextStyle={...t.tickTextStyle,...n},e.modified()},e.setAxisTextStyle=n=>{t.axisTextStyle={...t.axisTextStyle,...n},e.modified()},e.get_tmAtlas=()=>t._tmAtlas,e.getBounds=()=>(e.update(),A.ZP.setBounds(t.bounds,t.gridActor.getBounds()),A.ZP.scaleAboutCenter(t.bounds,t.boundsScaleFactor,t.boundsScaleFactor,t.boundsScaleFactor),t.bounds);const n=x.m.chain(e.setProperty,t.gridActor.setProperty);e.setProperty=e=>n(e)[0]}(e,t)}var X={newInstance:x.m.newInstance(q,"vtkCubeAxesActor"),extend:q,newCubeAxesActorHelper:$,defaultGenerateTicks:K},Y=n(6814),J=n(11145);const Q={};function ee(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Q,n),Y.Z.extend(e,t,n),t.CubeAxesActorHelper=X.newCubeAxesActorHelper(),function(e,t){t.classHierarchy.push("vtkOpenGLCubeAxesActor"),e.buildPass=n=>{n&&(t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.CubeAxesActorHelper.getRenderable()||t.CubeAxesActorHelper.setRenderable(t.renderable),e.prepareNodes(),e.addMissingNode(t.CubeAxesActorHelper.getTmActor()),e.addMissingNode(t.renderable.getGridActor()),e.removeUnusedNodes())},e.opaquePass=(e,n)=>{if(e){const e=t._openGLRenderer?t._openGLRenderer.getRenderable().getActiveCamera():null,n=t._openGLRenderer.getTiledSizeAndOrigin();t.CubeAxesActorHelper.updateAPISpecificData([n.usize,n.vsize],e,t._openGLRenderWindow.getRenderable())}}}(e,t)}const te=(0,x.n)(ee,"vtkOpenGLCubeAxesActor");(0,J.vw)("vtkCubeAxesActor",te);n(73399);var ne=n(59269),re=n(16595),ie=n(1600),oe=n(85687);const{ColorMode:ae,ScalarMode:se,GetArray:le}=oe.default;const ce={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function ue(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ce,n),re.Z.extend(e,t,n),x.m.get(e,t,["colorMapColors"]),x.m.setGet(e,t,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),x.m.setGetArray(e,t,["scalarRange"],2),t.viewSpecificProperties||(t.viewSpecificProperties={}),function(e,t){t.classHierarchy.push("vtkMapper2D"),e.createDefaultLookupTable=()=>{t.lookupTable=ie.ZP.newInstance()},e.getColorModeAsString=()=>x.m.enumToString(ae,t.colorMode),e.setColorModeToDefault=()=>e.setColorMode(0),e.setColorModeToMapScalars=()=>e.setColorMode(1),e.setColorModeToDirectScalars=()=>e.setColorMode(2),e.getScalarModeAsString=()=>x.m.enumToString(se,t.scalarMode),e.setScalarModeToDefault=()=>e.setScalarMode(0),e.setScalarModeToUsePointData=()=>e.setScalarMode(1),e.setScalarModeToUseCellData=()=>e.setScalarMode(2),e.setScalarModeToUsePointFieldData=()=>e.setScalarMode(3),e.setScalarModeToUseCellFieldData=()=>e.setScalarMode(4),e.setScalarModeToUseFieldData=()=>e.setScalarMode(5),e.getAbstractScalars=(e,n,r,i,o)=>{if(!e||!t.scalarVisibility)return{scalars:null,cellFLag:!1};let a=null,s=!1;if(n===se.DEFAULT)a=e.getPointData().getScalars(),a||(a=e.getCellData().getScalars(),s=!0);else if(n===se.USE_POINT_DATA)a=e.getPointData().getScalars();else if(n===se.USE_CELL_DATA)a=e.getCellData().getScalars(),s=!0;else if(n===se.USE_POINT_FIELD_DATA){const t=e.getPointData();a=r===le.BY_ID?t.getArrayByIndex(i):t.getArrayByName(o)}else if(n===se.USE_CELL_FIELD_DATA){const t=e.getCellData();s=!0,a=r===le.BY_ID?t.getArrayByIndex(i):t.getArrayByName(o)}else if(n===se.USE_FIELD_DATA){const t=e.getFieldData();a=r===le.BY_ID?t.getArrayByIndex(i):t.getArrayByName(o)}return{scalars:a,cellFlag:s}},e.getLookupTable=()=>(t.lookupTable||e.createDefaultLookupTable(),t.lookupTable),e.getMTime=()=>{let e=t.mtime;if(null!==t.lookupTable){const n=t.lookupTable.getMTime();e=n>e?n:e}return e},e.mapScalars=(n,r)=>{const i=e.getAbstractScalars(n,t.scalarMode,t.arrayAccessMode,t.arrayId,t.colorByArrayName).scalars;if(!i)return void(t.colorMapColors=null);const o=`${e.getMTime()}${i.getMTime()}${r}`;if(t.colorBuildString===o)return;t.useLookupTableScalarRange||e.getLookupTable().setRange(t.scalarRange[0],t.scalarRange[1]);const a=e.getLookupTable();a&&(a.build(),t.colorMapColors=a.mapScalars(i,t.colorMode,t.fieldDataTupleId)),t.colorBuildString=`${e.getMTime()}${i.getMTime()}${r}`},e.getPrimitiveCount=()=>{const t=e.getInputData();return{points:t.getPoints().getNumberOfValues()/3,verts:t.getVerts().getNumberOfValues()-t.getVerts().getNumberOfCells(),lines:t.getLines().getNumberOfValues()-2*t.getLines().getNumberOfCells(),triangles:t.getPolys().getNumberOfValues()-3*t.getPolys().getNumberOfCells()}}}(e,t)}var de={newInstance:x.m.newInstance(ue,"vtkMapper2D"),extend:ue},pe=n(23834),he=n(51815),fe=n(53118);const me={BACKGROUND:0,FOREGROUND:1};var ge={DisplayLocation:me};const{primTypes:ve}=ne.default,{ScalarMode:ye}=de,{vtkErrorMacro:be}=x.c,Ce={type:"StartEvent"},we={type:"EndEvent"};const Ee={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function Te(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ee,n),Y.Z.extend(e,t,n),he.Z.implementReplaceShaderCoincidentOffset(e,t,n),he.Z.implementBuildShadersWithReplacements(e,t,n),t.primitives=[],t.primTypes=ve,t.tmpMat4=_._E.identity(new Float64Array(16));for(let e=ve.Start;e<ve.End;e++)t.primitives[e]=ne.default.newInstance(),t.primitives[e].setPrimitiveType(e),t.primitives[e].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);(0,x.e)(e,t,["context"]),t.VBOBuildTime={},(0,x.o)(t.VBOBuildTime,{mtime:0}),function(e,t){t.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),e.buildPass=n=>{n&&(t.openGLActor2D=e.getFirstAncestorOfType("vtkOpenGLActor2D"),t._openGLRenderer=t.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.openGLCamera=t._openGLRenderer.getViewNodeFor(t._openGLRenderer.getRenderable().getActiveCamera()))},e.overlayPass=t=>{t&&e.render()},e.getShaderTemplate=(e,t,n)=>{e.Vertex="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyData2DVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n\n// all variables that represent positions or directions have a suffix\n// indicating the coordinate system they are in. The possible values are\n// MC - Model Coordinates\n// WC - WC world coordinates\n// VC - View Coordinates\n// DC - Display Coordinates\n\nin vec4 vertexWC;\n\n// frag position in VC\n//VTK::PositionVC::Dec\n\n// material property values\n//VTK::Color::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// Apple Bug\n//VTK::PrimID::Dec\n\nuniform mat4 WCVCMatrix;  // World to view matrix\n\nvoid main()\n{\n  // Apple Bug\n  //VTK::PrimID::Impl\n\n  gl_Position = WCVCMatrix*vertexWC;\n\n  //VTK::TCoord::Impl\n\n  //VTK::Color::Impl\n\n  //VTK::PositionVC::Impl\n}\n",e.Fragment="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyData2DFS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n\nuniform int PrimitiveIDOffset;\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// Scalar coloring\n//VTK::Color::Dec\n\n// Depth Peeling\n//VTK::DepthPeeling::Dec\n\n// picking support\n//VTK::Picking::Dec\n\n// the output of this shader\n//VTK::Output::Dec\n\n// Apple Bug\n//VTK::PrimID::Dec\n\nvoid main()\n{\n  // Apple Bug\n  //VTK::PrimID::Impl\n\n  //VTK::Color::Impl\n  //VTK::TCoord::Impl\n\n  //VTK::DepthPeeling::Impl\n  //VTK::Picking::Impl\n\n  if (gl_FragData[0].a <= 0.0)\n    {\n    discard;\n    }\n}\n",e.Geometry=""},e.render=()=>{const n=t._openGLRenderWindow.getContext();if(t.context!==n){t.context=n;for(let e=ve.Start;e<ve.End;e++)t.primitives[e].setOpenGLRenderWindow(t._openGLRenderWindow)}const r=t.openGLActor2D.getRenderable(),i=t._openGLRenderer.getRenderable();e.renderPiece(i,r)},e.renderPiece=(n,r)=>{e.invokeEvent(Ce),t.renderable.getStatic()||t.renderable.update(),t.currentInput=t.renderable.getInputData(),e.invokeEvent(we),t.currentInput?t.currentInput.getPoints&&t.currentInput.getPoints().getNumberOfValues()&&(e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r)):be("No input!")},e.renderPieceStart=(n,r)=>{t.primitiveIDOffset=0,t._openGLRenderer.getSelector()&&(t._openGLRenderer.getSelector().getCurrentPass(),t._openGLRenderer.getSelector().renderProp(r)),e.updateBufferObjects(n,r),t.lastBoundBO=null},e.getNeedToRebuildShaders=(e,n,r)=>e.getShaderSourceTime().getMTime()<t.renderable.getMTime()||e.getShaderSourceTime().getMTime()<t.currentInput.getMTime(),e.updateBufferObjects=(t,n)=>{e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=(n,r)=>{const i=t.VBOBuildTime.getMTime();return!!(i<e.getMTime()||i<t._openGLRenderWindow.getMTime()||i<t.renderable.getMTime()||i<r.getMTime()||i<t.currentInput.getMTime()||t.renderable.getTransformCoordinate()&&i<n.getMTime())},e.buildBufferObjects=(e,n)=>{const r=t.currentInput;if(null===r)return;t.renderable.mapScalars(r,n.getProperty().getOpacity());const i=t.renderable.getColorMapColors();t.haveCellScalars=!1;const o=t.renderable.getScalarMode();t.renderable.getScalarVisibility()&&(o!==ye.USE_CELL_DATA&&o!==ye.USE_CELL_FIELD_DATA&&o!==ye.USE_FIELD_DATA&&r.getPointData().getScalars()||o===ye.USE_POINT_FIELD_DATA||!i||(t.haveCellScalars=!0));const a=n.getProperty().getRepresentation();let s=r.getPointData().getTCoords();t.openGLActor2D.getActiveTextures()||(s=null);const l=t.renderable.getTransformCoordinate(),c=e.getRenderWindow().getViews()[0].getViewportSize(e),u=`${r.getMTime()}A${a}B${r.getMTime()}C${i?i.getMTime():1}D${s?s.getMTime():1}E${l?e.getMTime():1}F${c}`;if(t.VBOBuildString!==u){let n=r.getPoints();if(l){const t=pe.ZP.newInstance(),r=n.getNumberOfPoints();t.setNumberOfPoints(r);const i=[];for(let o=0;o<r;++o){n.getPoint(o,i),l.setValue(i);const r=l.getComputedDoubleViewportValue(e);t.setPoint(o,r[0],r[1],0)}n=t}const o={points:n,tcoords:s,colors:i,cellOffset:0,haveCellScalars:t.haveCellSCalars,customAttributes:t.renderable.getCustomShaderAttributes().map(e=>r.getPointData().getArrayByName(e))};o.cellOffset+=t.primitives[ve.Points].getCABO().createVBO(r.getVerts(),"verts",a,o),o.cellOffset+=t.primitives[ve.Lines].getCABO().createVBO(r.getLines(),"lines",a,o),o.cellOffset+=t.primitives[ve.Tris].getCABO().createVBO(r.getPolys(),"polys",a,o),o.cellOffset+=t.primitives[ve.TriStrips].getCABO().createVBO(r.getStrips(),"strips",a,o),t.VBOBuildTime.modified(),t.VBOBuildString=u}},e.renderPieceDraw=(n,r)=>{const i=r.getProperty().getRepresentation();t.context.depthMask(!0);for(let o=ve.Start;o<ve.End;o++)t.primitives[o].getCABO().getElementCount()&&(t.lastBoundBO=t.primitives[o],t.primitiveIDOffset+=t.primitives[o].drawArrays(n,r,i,e))},e.renderPieceFinish=(e,n)=>{t.lastBoundBO&&t.lastBoundBO.getVAO().release()},e.replaceShaderValues=(t,n,r)=>{e.replaceShaderColor(t,n,r),e.replaceShaderTCoord(t,n,r),e.replaceShaderPicking(t,n,r),e.replaceShaderPositionVC(t,n,r)},e.replaceShaderColor=(e,n,r)=>{let i=e.Vertex,o=e.Geometry,a=e.Fragment;t.haveCellScalars&&(a=fe.Z.substitute(a,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,a=fe.Z.substitute(a,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),0!==t.lastBoundBO.getCABO().getColorComponents()?(i=fe.Z.substitute(i,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,i=fe.Z.substitute(i,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,o=fe.Z.substitute(o,"//VTK::Color::Dec",["in vec4 fcolorVSOutput[];\n","out vec4 fcolorGSOutput;"]).result,o=fe.Z.substitute(o,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,a=fe.Z.substitute(a,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,a=fe.Z.substitute(a,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(a=fe.Z.substitute(a,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,a=fe.Z.substitute(a,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),e.Vertex=i,e.Geometry=o,e.Fragment=a},e.replaceShaderTCoord=(e,n,r)=>{if(t.lastBoundBO.getCABO().getTCoordOffset()){let n=e.Vertex,r=e.Geometry,i=e.Fragment;const o=t.lastBoundBO.getCABO().getTCoordComponents();1===o?(n=fe.Z.substitute(n,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,n=fe.Z.substitute(n,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,r=fe.Z.substitute(r,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput[];\n","out float tcoordVCGSOutput;"]).result,r=fe.Z.substitute(r,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,i=fe.Z.substitute(i,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,i=fe.Z.substitute(i,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):2===o&&(n=fe.Z.substitute(n,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,n=fe.Z.substitute(n,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,r=fe.Z.substitute(r,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];\n","out vec2 tcoordVCGSOutput;"]).result,r=fe.Z.substitute(r,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,i=fe.Z.substitute(i,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,i=fe.Z.substitute(i,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),t.haveCellScalars&&(r=fe.Z.substitute(r,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),e.Vertex=n,e.Geometry=r,e.Fragment=i}},e.replaceShaderPicking=(e,t,n)=>{let r=e.Fragment;r=fe.Z.substitute(r,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,r=fe.Z.substitute(r,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,e.Fragment=r},e.replaceShaderPositionVC=(e,n,r)=>{t.lastBoundBO.replaceShaderPositionVC(e,n,r)},e.invokeShaderCallbacks=(e,n,r)=>{const i=t.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(t=>{t.callback(t.userData,e,n,r)})},e.setMapperShaderParameters=(e,n,r)=>{if(e.getProgram().isUniformUsed("PrimitiveIDOffset")&&e.getProgram().setUniformi("PrimitiveIDOffset",t.primitiveIDOffset),e.getProgram().isAttributeUsed("vertexWC")&&(e.getVAO().addAttributeArray(e.getProgram(),e.getCABO(),"vertexWC",e.getCABO().getVertexOffset(),e.getCABO().getStride(),t.context.FLOAT,3,!1)||be("Error setting vertexWC in shader VAO.")),e.getCABO().getElementCount()&&(t.VBOBuildTime.getMTime()>e.getAttributeUpdateTime().getMTime()||e.getShaderSourceTime().getMTime()>e.getAttributeUpdateTime().getMTime())){t.renderable.getCustomShaderAttributes().forEach((n,r)=>{e.getProgram().isAttributeUsed(`${n}MC`)&&(e.getVAO().addAttributeArray(e.getProgram(),e.getCABO(),`${n}MC`,e.getCABO().getCustomData()[r].offset,e.getCABO().getStride(),t.context.FLOAT,e.getCABO().getCustomData()[r].components,!1)||be(`Error setting ${n}MC in shader VAO.`))}),e.getProgram().isAttributeUsed("tcoordMC")&&e.getCABO().getTCoordOffset()?e.getVAO().addAttributeArray(e.getProgram(),e.getCABO(),"tcoordMC",e.getCABO().getTCoordOffset(),e.getCABO().getStride(),t.context.FLOAT,e.getCABO().getTCoordComponents(),!1)||be("Error setting tcoordMC in shader VAO."):e.getVAO().removeAttributeArray("tcoordMC"),t.internalColorTexture&&e.getProgram().isUniformUsed("texture1")&&e.getProgram().setUniformi("texture1",t.internalColorTexture.getTextureUnit());const i=t.openGLActor2D.getActiveTextures();if(i)for(let t=0;t<i.length;++t){const n=i[t].getTextureUnit(),r=`texture${n+1}`;e.getProgram().isUniformUsed(r)&&e.getProgram().setUniformi(r,n)}e.setMapperShaderParameters(n,r,t._openGLRenderer.getTiledSizeAndOrigin());const o=t._openGLRenderer.getSelector();e.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),e.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)}},e.setPropertyShaderParameters=(e,n,r)=>{const i=t.renderable.getColorMapColors();if(!i||0===i.getNumberOfComponents()){const t=e.getProgram(),n=r.getProperty(),i=n.getOpacity(),o=n.getColor(),a=[o[0],o[1],o[2],i];t.setUniform4f("diffuseColor",a)}},e.setLightingShaderParameters=(e,t,n)=>{},e.setCameraShaderParameters=(e,n,r)=>{const i=e.getProgram(),o=e.getCABO().getCoordShiftAndScaleEnabled()?e.getCABO().getInverseShiftAndScaleMatrix():null,a=n.getRenderWindow().getViews()[0].getViewportSize(n),s=n.getViewport(),l=r.getActualPositionCoordinate().getComputedDoubleViewportValue(n),c=[0,0,1,1],u=[0,0,1,1];if(u[0]=s[0]>=c[0]?s[0]:c[0],u[1]=s[1]>=c[1]?s[1]:c[1],u[2]=s[2]<=c[2]?s[2]:c[2],u[3]=s[3]<=c[3]?s[3]:c[3],u[0]>=u[2])return;if(u[1]>=u[3])return;a[0]=(0,I.O)(a[0]*(u[2]-u[0])/(s[2]-s[0])),a[1]=(0,I.O)(a[1]*(u[3]-u[1])/(s[3]-s[1]));const d=t._openGLRenderer.getParent().getSize(),p=(0,I.O)(l[0]-(u[0]-s[0])*d[0]),h=(0,I.O)(l[1]-(u[1]-s[1])*d[1]),f=-p;let m=-p+a[0];const g=-h;let v=-h+a[1];f===m&&(m=f+1),g===v&&(v=g+1);const y=_._E.identity(new Float64Array(16));var b,C,w;y[0]=2/(m-f),y[5]=2/(v-g),y[3]=-1*(m+f)/(m-f),y[7]=-1*(v+g)/(v-g),y[10]=0,y[11]=r.getProperty().getDisplayLocation()===me.FOREGROUND?-1:1,y[15]=1,_._E.transpose(y,y),i.setUniformMatrix("WCVCMatrix",(b=[y,o],C=_._E,w=t.tmpMat4,C.identity(w),b.reduce((e,t,n)=>0===n?t?C.copy(e,t):C.identity(e):t?C.multiply(e,e,t):e,w)))},e.getAllocatedGPUMemoryInBytes=()=>{let e=0;return t.primitives.forEach(t=>{e+=t.getAllocatedGPUMemoryInBytes()}),e}}(e,t)}const xe=(0,x.n)(Te,"vtkOpenGLPolyDataMapper2D");(0,J.vw)("vtkMapper2D",xe);var _e=n(4666);const{VectorMode:Se}=_e.default;function Ie(e,t){e.strokeStyle=t.strokeColor,e.lineWidth=t.strokeSize,e.fillStyle=t.fontColor,e.font=`${t.fontStyle} ${t.fontSize}px ${t.fontFamily}`}function De(e,t){return e=>{const n=e.getLastSize(),r=(n[0]/700)**.8,i=(n[1]/700)**.8,o=Math.min(r,i),a=e.getAxisTextStyle(),s=e.getTickTextStyle();Object.assign(a,t.axisTextStyle),Object.assign(s,t.tickTextStyle),a.fontSize=Math.max(24*o,12),e.getLastAspectRatio()>1?s.fontSize=Math.max(20*o,10):s.fontSize=Math.max(16*o,10);const l=e.updateTextureAtlas();e.setTopTitle(!1);const c=e.getBoxSizeByReference();if(e.getLastAspectRatio()>1)e.setTickLabelPixelOffset(.3*s.fontSize),l.titleWidth<=l.tickWidth+e.getTickLabelPixelOffset()+.8*s.fontSize?(e.setTopTitle(!0),e.setAxisTitlePixelOffset(.2*s.fontSize),c[0]=2*(l.tickWidth+e.getTickLabelPixelOffset()+.8*s.fontSize)/n[0],e.setBoxPosition([.98-c[0],-.92])):(e.setAxisTitlePixelOffset(.2*s.fontSize),c[0]=2*(l.titleHeight+e.getAxisTitlePixelOffset()+l.tickWidth+e.getTickLabelPixelOffset()+.8*s.fontSize)/n[0],e.setBoxPosition([.99-c[0],-.92])),c[1]=Math.max(1.2,Math.min(1.84/i,1.84));else{e.setAxisTitlePixelOffset(1.2*s.fontSize),e.setTickLabelPixelOffset(.1*s.fontSize);const t=2*(.8*s.fontSize+l.titleHeight+e.getAxisTitlePixelOffset())/n[1],r=2*l.tickWidth/n[0];c[0]=Math.min(1.9,Math.max(1.4,1.4*r*(e.getTicks().length+3))),c[1]=t,e.setBoxPosition([-.5*c[0],-.97])}e.recomputeBarSegments(l)}}function Ae(e,t){return e=>{const t=e.getLastTickBounds(),n=S.BY().domain([t[0],t[1]]),r=n.ticks(5),i=n.tickFormat(5);e.setTicks(r),e.setTickStrings(r.map(i))}}const Pe=x.m.newInstance(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{renderable:null};Object.assign(t,{},n),x.m.obj(e,t),x.m.setGet(e,t,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings"]),x.m.get(e,t,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),x.m.getArray(e,t,["boxPosition","boxSize"]),x.m.setArray(e,t,["boxPosition","boxSize"],2),t.forceUpdate=!1,t.lastRebuildTime={},x.m.obj(t.lastRebuildTime,{mtime:0}),t.lastSize=[-1,-1],t.tmCanvas=document.createElement("canvas"),t.tmContext=t.tmCanvas.getContext("2d"),t._tmAtlas=new Map,t.barMapper=O.default.newInstance(),t.barMapper.setInterpolateScalarsBeforeMapping(!0),t.barMapper.setUseLookupTableScalarRange(!0),t.polyData=R.ZP.newInstance(),t.barMapper.setInputData(t.polyData),t.barActor=D.ZP.newInstance(),t.barActor.setMapper(t.barMapper),t.tmPolyData=R.ZP.newInstance(),t.tmMapper=O.default.newInstance(),t.tmMapper.setInputData(t.tmPolyData),t.tmTexture=M.ZP.newInstance({resizable:!0}),t.tmTexture.setInterpolate(!1),t.tmActor=D.ZP.newInstance({parentProp:e}),t.tmActor.setMapper(t.tmMapper),t.tmActor.addTexture(t.tmTexture),t.barPosition=[0,0],t.barSize=[0,0],t.boxPosition=[.88,-.92],t.boxSize=[.1,1.1],t.lastTickBounds=[],function(e,t){t.classHierarchy.push("vtkScalarBarActorHelper"),e.setRenderable=n=>{t.renderable!==n&&(t.renderable=n,t.barActor.setProperty(n.getProperty()),t.barActor.setParentProp(n),t.barActor.setCoordinateSystemToDisplay(),t.tmActor.setProperty(n.getProperty()),t.tmActor.setParentProp(n),t.tmActor.setCoordinateSystemToDisplay(),t.generateTicks=n.generateTicks,t.axisTextStyle={...n.getAxisTextStyle()},t.tickTextStyle={...n.getTickTextStyle()},e.modified())},e.updateAPISpecificData=(n,r,i)=>{t.lastSize[0]===n[0]&&t.lastSize[1]===n[1]||(t.lastSize[0]=n[0],t.lastSize[1]=n[1],t.lastAspectRatio=n[0]/n[1],t.forceUpdate=!0);const o=t.renderable.getScalarsToColors();if(o&&t.renderable.getVisibility()&&(t.barMapper.setLookupTable(o),t.camera=r,t.renderWindow=i,t.forceUpdate||Math.max(o.getMTime(),e.getMTime(),t.renderable.getMTime())>t.lastRebuildTime.getMTime())){const n=o.getMappingRange();if(t.lastTickBounds=[...n],t.renderable.getGenerateTicks()(e),t.renderable.getAutomated())t.renderable.getAutoLayout()(e);else{t.axisTextStyle={...t.renderable.getAxisTextStyle()},t.tickTextStyle={...t.renderable.getTickTextStyle()},t.barPosition=[...t.renderable.getBarPosition()],t.barSize=[...t.renderable.getBarSize()],t.boxPosition=[...t.renderable.getBoxPosition()],t.boxSize=[...t.renderable.getBoxSize()],t.axisTitlePixelOffset=t.renderable.getAxisTitlePixelOffset(),t.tickLabelPixelOffset=t.renderable.getTickLabelPixelOffset();const n=e.updateTextureAtlas();e.recomputeBarSegments(n)}e.updatePolyDataForLabels(),e.updatePolyDataForBarSegments(),t.lastRebuildTime.modified(),t.forceUpdate=!1}},e.updateTextureAtlas=()=>{t.tmContext.textBaseline="bottom",t.tmContext.textAlign="left";const n={},r=new Map;let i=0,o=1;Ie(t.tmContext,t.axisTextStyle);let a=t.tmContext.measureText(t.renderable.getAxisLabel()),s={height:a.actualBoundingBoxAscent+2,startingHeight:o,width:a.width+2,textStyle:t.axisTextStyle};r.set(t.renderable.getAxisLabel(),s),o+=s.height,i=s.width,n.titleWidth=s.width,n.titleHeight=s.height,n.tickWidth=0,n.tickHeight=0,Ie(t.tmContext,t.tickTextStyle);const l=[...e.getTickStrings(),"NaN","Below","Above"];for(let e=0;e<l.length;e++)r.has(l[e])||(a=t.tmContext.measureText(l[e]),s={height:a.actualBoundingBoxAscent+2,startingHeight:o,width:a.width+2,textStyle:t.tickTextStyle},r.set(l[e],s),o+=s.height,i<s.width&&(i=s.width),n.tickWidth<s.width&&(n.tickWidth=s.width),n.tickHeight<s.height&&(n.tickHeight=s.height));return i=(0,I.Q)(i),o=(0,I.Q)(o),r.forEach(e=>{e.tcoords=[0,(o-e.startingHeight-e.height)/o,e.width/i,(o-e.startingHeight-e.height)/o,e.width/i,(o-e.startingHeight)/o,0,(o-e.startingHeight)/o]}),t.tmCanvas.width=i,t.tmCanvas.height=o,t.tmContext.textBaseline="bottom",t.tmContext.textAlign="left",t.tmContext.clearRect(0,0,i,o),r.forEach((e,n)=>{Ie(t.tmContext,e.textStyle),t.tmContext.fillText(n,1,e.startingHeight+e.height-1)}),t.tmTexture.setCanvas(t.tmCanvas),t.tmTexture.modified(),t._tmAtlas=r,n},e.computeBarSize=e=>{t.vertical=t.boxSize[1]>t.boxSize[0];const n=2*e.tickHeight/t.lastSize[1],r=[1,1];if(t.vertical){const i=2*(e.tickWidth+t.tickLabelPixelOffset)/t.lastSize[0];if(t.topTitle){const n=2*(e.titleHeight+t.axisTitlePixelOffset)/t.lastSize[1];t.barSize[0]=t.boxSize[0]-i,t.barSize[1]=t.boxSize[1]-n}else{const n=2*(e.titleHeight+t.axisTitlePixelOffset)/t.lastSize[0];t.barSize[0]=t.boxSize[0]-n-i,t.barSize[1]=t.boxSize[1]}t.barPosition[0]=t.boxPosition[0]+i,t.barPosition[1]=t.boxPosition[1],r[1]=n}else{const n=(2*e.tickWidth-8)/t.lastSize[0],i=2*(e.titleHeight+t.axisTitlePixelOffset)/t.lastSize[1];t.barSize[0]=t.boxSize[0],t.barPosition[0]=t.boxPosition[0],t.barSize[1]=t.boxSize[1]-i,t.barPosition[1]=t.boxPosition[1],r[0]=n}return r},e.recomputeBarSegments=n=>{const r=e.computeBarSize(n);t.barSegments=[];const i=[0,0],o=t.vertical?1:0,a=t.vertical?.01:.02;function s(e,n){t.barSegments.push({corners:[[...i],[i[0]+r[0],i[1]],[i[0]+r[0],i[1]+r[1]],[i[0],i[1]+r[1]]],scalars:n,title:e}),i[o]+=r[o]+a}t.renderable.getDrawNanAnnotation()&&t.renderable.getScalarsToColors().getNanColor()&&s("NaN",[NaN,NaN,NaN,NaN]),t.renderable.getDrawBelowRangeSwatch()&&t.renderable.getScalarsToColors().getUseBelowRangeColor?.()&&s("Below",[-.1,-.1,-.1,-.1]);const l=t.renderable.getScalarsToColors().getUseAboveRangeColor?.();i[o]+=a;const c=r[o];r[o]=l?1-2*a-r[o]-i[o]:1-a-i[o],s("ticks",t.vertical?[0,0,.995,.995]:[0,.995,.995,0]),t.renderable.getDrawAboveRangeSwatch()&&l&&(r[o]=c,i[o]+=a,s("Above",[1.1,1.1,1.1,1.1]))};const n=new Float64Array(3);e.createPolyDataForOneLabel=(e,r,i,o,a,s)=>{const l=t._tmAtlas.get(e);if(!l)return;let c=s.ptIdx,u=s.cellIdx;n[0]=(.5*r[0]+.5)*t.lastSize[0],n[1]=(.5*r[1]+.5)*t.lastSize[1],n[2]=r[2],n[0]+=a[0],n[1]+=a[1];const d=[],p="vertical"===o?[1,0]:[0,1];"vertical"===o?(d[0]=l.width,d[1]=-l.height,"middle"===i[0]?n[1]-=l.width/2:"right"===i[0]&&(n[1]-=l.width),"middle"===i[1]?n[0]+=l.height/2:"top"===i[1]&&(n[0]+=l.height)):(d[0]=l.width,d[1]=l.height,"middle"===i[0]?n[0]-=l.width/2:"right"===i[0]&&(n[0]-=l.width),"middle"===i[1]?n[1]-=l.height/2:"top"===i[1]&&(n[1]-=l.height)),s.points[3*c]=n[0],s.points[3*c+1]=n[1],s.points[3*c+2]=n[2],s.tcoords[2*c]=l.tcoords[0],s.tcoords[2*c+1]=l.tcoords[1],c++,n[p[0]]+=d[0],s.points[3*c]=n[0],s.points[3*c+1]=n[1],s.points[3*c+2]=n[2],s.tcoords[2*c]=l.tcoords[2],s.tcoords[2*c+1]=l.tcoords[3],c++,n[p[1]]+=d[1],s.points[3*c]=n[0],s.points[3*c+1]=n[1],s.points[3*c+2]=n[2],s.tcoords[2*c]=l.tcoords[4],s.tcoords[2*c+1]=l.tcoords[5],c++,n[p[0]]-=d[0],s.points[3*c]=n[0],s.points[3*c+1]=n[1],s.points[3*c+2]=n[2],s.tcoords[2*c]=l.tcoords[6],s.tcoords[2*c+1]=l.tcoords[7],c++,s.polys[4*u]=3,s.polys[4*u+1]=c-4,s.polys[4*u+2]=c-3,s.polys[4*u+3]=c-2,u++,s.polys[4*u]=3,s.polys[4*u+1]=c-4,s.polys[4*u+2]=c-2,s.polys[4*u+3]=c-1,s.ptIdx+=4,s.cellIdx+=2};const r=new Float64Array(3);e.updatePolyDataForLabels=()=>{const n=e.getTickStrings().length+t.barSegments.length,i=4*n,o=2*n,a=new Float64Array(3*i),s=new Uint16Array(4*o),l=new Float32Array(2*i),c={ptIdx:0,cellIdx:0,polys:s,points:a,tcoords:l},u=t.vertical?0:1,d=t.vertical?1:0;r[2]=-.99;const p=t.vertical?["right","middle"]:["middle","bottom"];let h=[0,1];const f=[0,0];t.vertical?(f[0]=-t.tickLabelPixelOffset,t.topTitle?(r[0]=t.boxPosition[0]+.5*t.boxSize[0],r[1]=t.barPosition[1]+t.barSize[1],e.createPolyDataForOneLabel(t.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,t.axisTitlePixelOffset],c)):(r[0]=t.barPosition[0]+t.barSize[0],r[1]=t.barPosition[1]+.5*t.barSize[1],e.createPolyDataForOneLabel(t.renderable.getAxisLabel(),r,["middle","top"],"vertical",[t.axisTitlePixelOffset,0],c)),h=[-1,0]):(f[1]=t.tickLabelPixelOffset,r[0]=t.barPosition[0]+.5*t.barSize[0],r[1]=t.barPosition[1]+t.barSize[1],e.createPolyDataForOneLabel(t.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,t.axisTitlePixelOffset],c)),r[u]=t.barPosition[u]+(.5*h[u]+.5)*t.barSize[u],r[d]=t.barPosition[d]+.5*t.barSize[d];let m=null;for(let n=0;n<t.barSegments.length;n++){const i=t.barSegments[n];"ticks"===i.title?m=i:(r[d]=t.barPosition[d]+.5*t.barSize[d]*(i.corners[2][d]+i.corners[0][d]),e.createPolyDataForOneLabel(i.title,r,p,"horizontal",f,c))}const g=t.barPosition[d]+t.barSize[d]*m.corners[0][d],v=t.barSize[d]*(m.corners[2][d]-m.corners[0][d]),y=e.getTicks(),b=e.getTickStrings();for(let n=0;n<y.length;n++){const i=(y[n]-t.lastTickBounds[0])/(t.lastTickBounds[1]-t.lastTickBounds[0]);r[d]=g+v*i,e.createPolyDataForOneLabel(b[n],r,p,"horizontal",f,c)}const C=P.default.newInstance({numberOfComponents:2,values:l,name:"TextureCoordinates"});t.tmPolyData.getPointData().setTCoords(C),t.tmPolyData.getPoints().setData(a,3),t.tmPolyData.getPoints().modified(),t.tmPolyData.getPolys().setData(s,1),t.tmPolyData.getPolys().modified(),t.tmPolyData.modified()},e.updatePolyDataForBarSegments=()=>{const e=t.renderable.getScalarsToColors();let n=0;t.renderable.getDrawNanAnnotation()&&e.getNanColor()&&(n+=1),t.renderable.getDrawBelowRangeSwatch()&&e.getUseBelowRangeColor?.()&&(n+=1),t.renderable.getDrawAboveRangeSwatch()&&e.getUseAboveRangeColor?.()&&(n+=1);const i=4*(1+n),o=i;let a=1;e.getVectorMode()===Se.COMPONENT&&(a=e.getVectorComponent()+1);const s=new Float64Array(3*i),l=new Uint16Array(5*o),c=new Float32Array(i*a);let u=0,d=0;for(let e=0;e<t.barSegments.length;e++){const n=t.barSegments[e];for(let e=0;e<4;e++){r[0]=t.barPosition[0]+n.corners[e][0]*t.barSize[0],r[1]=t.barPosition[1]+n.corners[e][1]*t.barSize[1],s[3*u]=(.5*r[0]+.5)*t.lastSize[0],s[3*u+1]=(.5*r[1]+.5)*t.lastSize[1],s[3*u+2]=r[2];for(let r=0;r<a;r++)c[u*a+r]=t.lastTickBounds[0]+n.scalars[e]*(t.lastTickBounds[1]-t.lastTickBounds[0]);u++}l[5*d]=4,l[5*d+1]=u-4,l[5*d+2]=u-3,l[5*d+3]=u-2,l[5*d+4]=u-1,d++}const p=P.default.newInstance({numberOfComponents:a,values:c,name:"Scalars"});t.polyData.getPointData().setScalars(p),t.polyData.getPoints().setData(s,3),t.polyData.getPoints().modified(),t.polyData.getPolys().setData(l,1),t.polyData.getPolys().modified(),t.polyData.modified()}}(e,t)},"vtkScalarBarActorHelper");function Oe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,function(e){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...e}}(n)),t.autoLayout||(t.autoLayout=De(0,t)),t.generateTicks||(t.generateTicks=Ae()),D.ZP.extend(e,t,n),e.getProperty().setDiffuse(0),e.getProperty().setAmbient(1),x.m.setGet(e,t,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),x.m.get(e,t,["axisTextStyle","tickTextStyle"]),x.m.getArray(e,t,["barPosition","barSize","boxPosition","boxSize"]),x.m.setArray(e,t,["barPosition","barSize","boxPosition","boxSize"],2),function(e,t){t.classHierarchy.push("vtkScalarBarActor"),e.setTickTextStyle=n=>{t.tickTextStyle={...t.tickTextStyle,...n},e.modified()},e.setAxisTextStyle=n=>{t.axisTextStyle={...t.axisTextStyle,...n},e.modified()},e.resetAutoLayoutToDefault=()=>{e.setAutoLayout(De(0,t))},e.resetGenerateTicksToDefault=()=>{e.setGenerateTicks(Ae())}}(e,t)}var Re={newInstance:x.m.newInstance(Oe,"vtkScalarBarActor"),extend:Oe,newScalarBarActorHelper:Pe};const Me={};function Ne(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Me,n),Y.Z.extend(e,t,n),t.scalarBarActorHelper=Re.newScalarBarActorHelper(),function(e,t){t.classHierarchy.push("vtkOpenGLScalarBarActor"),e.buildPass=n=>{n&&(t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.scalarBarActorHelper.getRenderable()||t.scalarBarActorHelper.setRenderable(t.renderable),e.prepareNodes(),e.addMissingNode(t.scalarBarActorHelper.getBarActor()),e.addMissingNode(t.scalarBarActorHelper.getTmActor()),e.removeUnusedNodes())},e.opaquePass=(e,n)=>{if(e){const e=t._openGLRenderer?t._openGLRenderer.getRenderable().getActiveCamera():null,n=t._openGLRenderer.getTiledSizeAndOrigin();t.scalarBarActorHelper.updateAPISpecificData([n.usize,n.vsize],e,t._openGLRenderWindow.getRenderable())}}}(e,t)}const Le=(0,x.n)(Ne,"vtkOpenGLScalarBarActor");(0,J.vw)("vtkScalarBarActor",Le);n(41983),n(41247),n(1385),n(97521),n(66672);var ke=n(54873),Fe=n(32639);const{CoordinateSystem:Ve}=ke.default;const Ue={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function Be(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ue,n),Y.Z.extend(e,t,n),t.keyMatricesTime={},x.m.obj(t.keyMatricesTime,{mtime:0}),t.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},x.m.get(e,t,["propID","keyMatricesTime"]),t.bufferShift=[0,0,0,0],function(e,t){t.classHierarchy.push("vtkWebGPUActor"),e.buildPass=n=>{n&&(t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),void 0===t.propID&&(t.propID=t.WebGPURenderWindow.getUniquePropID()),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes())},e.traverseOpaquePass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t.WebGPURenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children[0]&&t.children[0].traverse(n),e.apply(n,!1))},e.traverseTranslucentPass=n=>{!t.renderable||!t.renderable.getNestedVisibility()||t.renderable.getIsOpaque()||t.WebGPURenderer.getSelector()&&!t.renderable.getNestedPickable()||(e.apply(n,!0),t.children[0]&&t.children[0].traverse(n),e.apply(n,!1))},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;t.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},e.getBufferShift=n=>(e.getKeyMatrices(n),t.bufferShift),e.getKeyMatrices=e=>{if(Math.max(t.renderable.getMTime(),e.getStabilizedTime())>t.keyMatricesTime.getMTime()){t.renderable.computeMatrix();const n=t.renderable.getMatrix();t.bufferShift[0]=n[3],t.bufferShift[1]=n[7],t.bufferShift[2]=n[11];const r=e.getStabilizedCenterByReference();t.renderable.getCoordinateSystem()===Ve.WORLD&&(t.bufferShift[0]-=r[0],t.bufferShift[1]-=r[1],t.bufferShift[2]-=r[2]),_._E.transpose(t.keyMatrices.bcwc,n),t.renderable.getIsIdentity()?_._E.identity(t.keyMatrices.normalMatrix):(_._E.copy(t.keyMatrices.normalMatrix,t.keyMatrices.bcwc),t.keyMatrices.normalMatrix[3]=0,t.keyMatrices.normalMatrix[7]=0,t.keyMatrices.normalMatrix[11]=0,_._E.invert(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),_._E.transpose(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix)),_._E.translate(t.keyMatrices.bcwc,t.keyMatrices.bcwc,[-t.bufferShift[0],-t.bufferShift[1],-t.bufferShift[2]]),t.renderable.getCoordinateSystem()===Ve.WORLD?_._E.translate(t.keyMatrices.bcsc,t.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]):_._E.copy(t.keyMatrices.bcsc,t.keyMatrices.bcwc),t.keyMatricesTime.modified()}return t.keyMatrices}}(e,t)}const Ge=x.m.newInstance(Be);(0,Fe.vw)("vtkActor",Ge);const{CoordinateSystem:We}=ke.default;const ze={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function He(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ze,n),Y.Z.extend(e,t,n),t.keyMatricesTime={},x.m.obj(t.keyMatricesTime,{mtime:0}),t.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},x.m.get(e,t,["propID","keyMatricesTime"]),t.bufferShift=[0,0,0,0],function(e,t){t.classHierarchy.push("vtkWebGPUActor2D"),e.buildPass=n=>{n&&(t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),void 0===t.propID&&(t.propID=t.WebGPURenderWindow.getUniquePropID()),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes())},e.traverseOpaquePass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t.WebGPURenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children[0]&&t.children[0].traverse(n),e.apply(n,!1))},e.traverseTranslucentPass=n=>{!t.renderable||!t.renderable.getNestedVisibility()||t.renderable.getIsOpaque()||t.WebGPURenderer.getSelector()&&!t.renderable.getNestedPickable()||(e.apply(n,!0),t.children[0]&&t.children[0].traverse(n),e.apply(n,!1))},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;t.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},e.getBufferShift=n=>(e.getKeyMatrices(n),t.bufferShift),e.getKeyMatrices=e=>{if(Math.max(t.renderable.getMTime(),e.getStabilizedTime())>t.keyMatricesTime.getMTime()){t.bufferShift[0]=0,t.bufferShift[1]=0,t.bufferShift[2]=0;const n=e.getStabilizedCenterByReference();t.renderable.getCoordinateSystem()===We.WORLD&&(t.bufferShift[0]-=n[0],t.bufferShift[1]-=n[1],t.bufferShift[2]-=n[2]),_._E.identity(t.keyMatrices.bcwc),_._E.identity(t.keyMatrices.normalMatrix),_._E.translate(t.keyMatrices.bcwc,t.keyMatrices.bcwc,[-t.bufferShift[0],-t.bufferShift[1],-t.bufferShift[2]]),t.renderable.getCoordinateSystem()===We.WORLD?_._E.translate(t.keyMatrices.bcsc,t.keyMatrices.bcwc,[-n[0],-n[1],-n[2]]):_._E.copy(t.keyMatrices.bcsc,t.keyMatrices.bcwc),t.keyMatricesTime.modified()}return t.keyMatrices}}(e,t)}const je=x.m.newInstance(He);(0,Fe.vw)("vtkActor2D",je);const Ze={};function Ke(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ze,n),Y.Z.extend(e,t,n),t.CubeAxesActorHelper=X.newCubeAxesActorHelper(),function(e,t){t.classHierarchy.push("vtkWebGPUCubeAxesActor"),e.buildPass=n=>{n&&(t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getParent(),t.CubeAxesActorHelper.getRenderable()||t.CubeAxesActorHelper.setRenderable(t.renderable),e.prepareNodes(),e.addMissingNode(t.CubeAxesActorHelper.getTmActor()),e.addMissingNode(t.renderable.getGridActor()),e.removeUnusedNodes())},e.opaquePass=(e,n)=>{if(e){const e=t.WebGPURenderer?t.WebGPURenderer.getRenderable().getActiveCamera():null,n=t.WebGPURenderer.getTiledSizeAndOrigin();t.CubeAxesActorHelper.updateAPISpecificData([n.usize,n.vsize],e,t.WebGPURenderWindow.getRenderable())}}}(e,t)}const $e=(0,x.n)(Ke,"vtkWebGPUCubeAxesActor");(0,Fe.vw)("vtkCubeAxesActor",$e);var qe=n(7220),Xe=n(98589),Ye=n(42695);const{DisplayLocation:Je}=ge;const Qe={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Ye.hX.SURFACE,displayLocation:Je.FOREGROUND};function et(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Qe,n),x.m.obj(e,t),x.m.setGet(e,t,["opacity","lineWidth","pointSize","displayLocation","representation"]),x.m.setGetArray(e,t,["color"],3),function(e,t){t.classHierarchy.push("vtkProperty2D"),e.setDisplayLocationToBackground=()=>e.setDisplayLocation(Je.BACKGROUND),e.setDisplayLocationToForeground=()=>e.setDisplayLocation(Je.FOREGROUND),e.setRepresentationToWireframe=()=>e.setRepresentation(Ye.hX.WIREFRAME),e.setRepresentationToSurface=()=>e.setRepresentation(Ye.hX.SURFACE),e.setRepresentationToPoints=()=>e.setRepresentation(Ye.hX.POINTS),e.getRepresentationAsString=()=>x.m.enumToString(Ye.hX,t.representation)}(e,t)}var tt={newInstance:x.m.newInstance(et,"vtkProperty2D"),extend:et,...ge},nt=n(19974),rt=n(85232),it=n(84770),ot=n(35498);const{BufferUsage:at,PrimitiveTypes:st}=qe.default,{Representation:lt}=Xe.default,{ScalarMode:ct}=O.default,{CoordinateSystem:ut}=ke.default,{DisplayLocation:dt}=tt;function pt(e){return e.indexOf("edge")>=0}const ht={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function ft(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ht,n),it.ZP.extend(e,t,n),t.fragmentShaderTemplate='\nstruct PBRData {\n  diffuse: vec3<f32>,\n  specular: vec3<f32>,\n}\n\n// Dot product with the max already in it\nfn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {\n  return max(0.0, dot(a, b));\n}\n// Dot product with a max in it that does not allow for negative values\n// Physically based rendering is accurate as long as normals are accurate,\n// however this is pretty often not the case. In order to prevent negative\n// values from ruining light calculations and creating zones of zero light,\n// this remapping is used, which smoothly clamps the dot product between\n// zero and one while still maintaining a good amount of accuracy.\nfn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {\n  var d: f32 = max(0.0, dot(a, b));\n  d = pow((d + 1.0) / 2.0, 2.6);\n  return d;\n}\n\n// Lambertian diffuse model\nfn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {\n  var pi: f32 = 3.14159265359; \n  var NdotL: f32 = mdot(N, L);\n  NdotL = pow(NdotL, 1.5);\n  return (base/pi)*NdotL;\n}\n\n// Yasuhiro Fujii improvement on the Oren-Nayar model\n// https://mimosa-pudica.net/improved-oren-nayar.html\n// p is surface color, o is roughness\nfn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {\n  var invpi: f32 = 0.31830988618; // 1/pi\n\n  var o2 = o*o;\n  var NdotL: f32 = mdot(N, L);\n  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better\n\n  var NdotV: f32 = mdot(N, V);\n  var LdotV: f32 = mdot(L, V);\n\n  var s: f32 = LdotV - NdotL*NdotV;\n  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement\n  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));\n  A = invpi*(1 - A);\n  var B: f32 = 0.45*(o2 / (o2 + 0.09));\n  B = invpi*B;\n\n  return p*NdotL*(A + B*(s/t));\n}\n\n// Fresnel portion of BRDF (IOR only, simplified)\nfn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {\n  var NdotV: f32 = mdot(V, N);\n  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not\n  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);\n}\n\n// Fresnel portion of BRDF (Color ior, better)\nfn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {\n  var NdotV: f32 = mdot(V, N);\n  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);\n}\n\n// Normal portion of BRDF\n// https://learnopengl.com/PBR/Theory\n// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2\nfn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {\n  var pi: f32 = 3.14159265359; \n\n  var a2: f32 = a*a;\n  var NdotH = mdot(N, H);\n  var NdotH2 = NdotH*NdotH;\n  \n  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;\n\n  return a2 / max((pi*denom*denom), 0.000001);\n}\n\n// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent\nfn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {\n  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;\n\n  var ggx1: f32 = trGGX(N + Op*s, H, a);\n  var ggx2: f32 = trGGX(N - Op*s, H, a);\n  return (0.5 * ggx1 + 0.5 * ggx2);\n}\n\n// Geometry portion of BRDF\nfn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {\n  var NdotX = cdot(N, X);\n  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));\n}\n\nfn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {\n  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));\n  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));\n  return ggx1*ggx2;\n}\n\n// BRDF Combination\nfn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {\n  var num: f32 = D*F*G;\n  var denom: f32 = 4*cdot(V, N)*cdot(L, N);\n\n  return num / max(denom, 0.000001);\n}\n\n// Different lighting calculations for different light sources\nfn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  \n  var L: vec3<f32> = normalize(direction); // Light Vector\n  var H: vec3<f32> = normalize(L + V); // Halfway Vector\n\n  var alpha = roughness*roughness;\n  var k: f32 = alpha*alpha / 2;\n\n  var D: f32 = trGGX(N, H, alpha); // Distribution\n  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel\n  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry\n\n  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later\n  var incoming: vec3<f32> = color;\n  var angle: f32 = mdot(L, N);\n  angle = pow(angle, 1.5);\n\n  var specular: vec3<f32> = brdf*incoming*angle;\n  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate\n  // control property for the diffuse vs specular roughness\n  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); \n  // Stores the specular and diffuse separately to allow for finer post processing\n  var out = PBRData(diffuse, specular);\n  \n  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)\n}\n\n// TODO: find some way to reduce the number of arguments going in here\nfn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {\n  var L: vec3<f32> = normalize(position - fragPos); // Light Vector\n  var H: vec3<f32> = normalize(L + V); // Halfway Vector\n  var dist = distance(position, fragPos);\n\n  var alpha = roughness*roughness;\n  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8\n\n  var D: f32 = trGGX(N, H, alpha); // Distribution\n  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel\n  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry\n\n  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);\n  var incoming: vec3<f32> = color * (1.0 / (dist*dist));\n  var angle: f32 = mdot(L, N);\n  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources\n\n  var specular: vec3<f32> = brdf*incoming*angle;\n  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);\n\n  // Stores the specular and diffuse separately to allow for finer post processing\n  // Could also be done (propably more properly) with a struct\n  var out = PBRData(diffuse, specular);\n  \n  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)\n}\n\n// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights\nfn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {\n  var L: vec3<f32> = normalize(position - fragPos);\n  var H: vec3<f32> = normalize(L + V); // Halfway Vector\n  var dist = distance(position, fragPos);\n\n  var alpha = roughness*roughness;\n  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8\n\n  var D: f32 = trGGX(N, H, alpha); // Distribution\n  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel\n  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry\n\n  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);\n  \n  // Cones.x is the inner phi and cones.y is the outer phi\n  var theta: f32 = mdot(normalize(direction), L);\n  var epsilon: f32 = cones.x - cones.y;\n  var intensity: f32 = (theta - cones.y) / epsilon;\n  intensity = clamp(intensity, 0.0, 1.0);\n  intensity /= dist*dist;\n\n  var incoming: vec3<f32> = color * intensity;\n\n  var angle: f32 = mdot(L, N);\n  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources\n\n  var specular: vec3<f32> = brdf*incoming*angle;\n  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);\n\n  // Stores the specular and diffuse separately to allow for finer post processing\n  // Could also be done (propably more properly) with a struct\n  var out = PBRData(diffuse, specular);\n  \n  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)\n}\n\n// Environment mapping stuff\n// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point\nfn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {\n  var tau: f32 = 6.28318530718;\n  var pi: f32 = 3.14159265359;\n  var out: vec2<f32> = vec2<f32>(0.0);\n\n  out.x = atan2(dir.z, dir.x) / tau;\n  out.x += 0.5;\n\n  var phix: f32 = length(vec2(dir.x, dir.z));\n  out.y = atan2(dir.y, phix) / pi + 0.5;\n\n  return out;\n}\n\n//VTK::Renderer::Dec\n\n//VTK::Color::Dec\n\n//VTK::TCoord::Dec\n\n// optional surface normal declaration\n//VTK::Normal::Dec\n\n//VTK::Select::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output : fragmentOutput;\n\n  // Temporary ambient, diffuse, and opacity\n  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;\n  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;\n  var opacity: f32 = mapperUBO.Opacity;\n\n  // This should be declared somewhere else\n  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);\n  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);\n  var _metallicMap: vec4<f32> = vec4<f32>(1.0);\n  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment\n  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);\n  var _emissionMap: vec4<f32> = vec4<f32>(0.);\n\n  //VTK::Color::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Normal::Impl\n\n  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);\n\n  //VTK::Light::Impl\n\n  //VTK::Select::Impl\n\n  if (computedColor.a == 0.0) { discard; };\n\n  //VTK::Position::Impl\n\n  //VTK::RenderEncoder::Impl\n\n  return output;\n}\n',t.vertexShaderTemplate="\n//VTK::Renderer::Dec\n\n//VTK::Color::Dec\n\n//VTK::Normal::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::Select::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::IOStructs::Dec\n\n@vertex\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output : vertexOutput;\n\n  var vertex: vec4<f32> = vertexBC;\n\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Select::Impl\n\n  //VTK::Position::Impl\n\n  return output;\n}\n",t._tmpMat3=_.wO.identity(new Float64Array(9)),t._tmpMat4=_._E.identity(new Float64Array(16)),t.UBO=rt.ZP.newInstance({label:"mapperUBO"}),t.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),t.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),t.UBO.addEntry("MCWCNormals","mat4x4<f32>"),t.UBO.addEntry("AmbientColor","vec4<f32>"),t.UBO.addEntry("DiffuseColor","vec4<f32>"),t.UBO.addEntry("EdgeColor","vec4<f32>"),t.UBO.addEntry("SpecularColor","vec4<f32>"),t.UBO.addEntry("AmbientIntensity","f32"),t.UBO.addEntry("DiffuseIntensity","f32"),t.UBO.addEntry("Roughness","f32"),t.UBO.addEntry("Metallic","f32"),t.UBO.addEntry("Ambient","f32"),t.UBO.addEntry("Normal","f32"),t.UBO.addEntry("Emission","f32"),t.UBO.addEntry("NormalStrength","f32"),t.UBO.addEntry("BaseIOR","f32"),t.UBO.addEntry("SpecularIntensity","f32"),t.UBO.addEntry("LineWidth","f32"),t.UBO.addEntry("Opacity","f32"),t.UBO.addEntry("ZValue","f32"),t.UBO.addEntry("PropID","u32"),t.UBO.addEntry("ClipNear","f32"),t.UBO.addEntry("ClipFar","f32"),t.UBO.addEntry("Time","u32"),(0,x.e)(e,t,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),t.textures=[],function(e,t){t.classHierarchy.push("vtkWebGPUCellArrayMapper"),e.buildPass=n=>{n&&(t.is2D?(t.WebGPUActor=e.getFirstAncestorOfType("vtkWebGPUActor2D"),t.forceZValue=!0):(t.WebGPUActor=e.getFirstAncestorOfType("vtkWebGPUActor"),t.forceZValue=!1),t.coordinateSystem=t.WebGPUActor.getRenderable().getCoordinateSystem(),t.useRendererMatrix=t.coordinateSystem!==ut.DISPLAY,t.WebGPURenderer=t.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getParent(),t.device=t.WebGPURenderWindow.getDevice())},e.translucentPass=n=>{n&&(e.prepareToDraw(t.WebGPURenderer.getRenderEncoder()),t.renderEncoder.registerDrawCallback(t.pipeline,e.draw))},e.opaquePass=n=>{n&&(e.prepareToDraw(t.WebGPURenderer.getRenderEncoder()),t.renderEncoder.registerDrawCallback(t.pipeline,e.draw))},e.updateUBO=()=>{const n=t.WebGPUActor.getRenderable().getProperty(),r=t.UBO.getSendTime();if(e.getMTime()>r||n.getMTime()>r||t.renderable.getMTime()>r){const e=t.WebGPUActor.getKeyMatrices(t.WebGPURenderer);if(t.UBO.setArray("BCWCMatrix",e.bcwc),t.UBO.setArray("BCSCMatrix",e.bcsc),t.UBO.setArray("MCWCNormals",e.normalMatrix),t.is2D){t.UBO.setValue("ZValue",t.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===dt.FOREGROUND?1:0);const e=n.getColorByReference();t.UBO.setValue("AmbientIntensity",1),t.UBO.setArray("DiffuseColor",[e[0],e[1],e[2],1]),t.UBO.setValue("DiffuseIntensity",0),t.UBO.setValue("SpecularIntensity",0)}else{let e=n.getAmbientColorByReference();t.UBO.setValue("AmbientIntensity",n.getAmbient()),t.UBO.setArray("AmbientColor",[e[0],e[1],e[2],1]),t.UBO.setValue("DiffuseIntensity",n.getDiffuse()),e=n.getDiffuseColorByReference(),t.UBO.setArray("DiffuseColor",[e[0],e[1],e[2],1]),t.UBO.setValue("Roughness",n.getRoughness()),t.UBO.setValue("BaseIOR",n.getBaseIOR()),t.UBO.setValue("Metallic",n.getMetallic()),t.UBO.setValue("NormalStrength",n.getNormalStrength()),t.UBO.setValue("Emission",n.getEmission()),t.UBO.setValue("SpecularIntensity",n.getSpecular()),e=n.getSpecularColorByReference(),t.UBO.setArray("SpecularColor",[e[0],e[1],e[2],1])}const r=n.getEdgeColorByReference?.();r&&t.UBO.setArray("EdgeColor",[r[0],r[1],r[2],1]),t.UBO.setValue("LineWidth",n.getLineWidth()),t.UBO.setValue("Opacity",n.getOpacity()),t.UBO.setValue("PropID",t.WebGPUActor.getPropID());const i=t.WebGPURenderWindow.getDevice();t.UBO.sendIfNeeded(i)}},e.haveWideLines=()=>{const e=t.WebGPUActor.getRenderable(),n=e.getProperty().getRepresentation();return!(e.getProperty().getLineWidth()<=1)&&t.primitiveType!==st.Verts&&(t.primitiveType!==st.Triangles&&t.primitiveType!==st.TriangleStrips||n===lt.WIREFRAME)},e.replaceShaderPosition=(n,r,i)=>{const o=r.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),o.hasOutput("vertexVC")||o.addOutput("vec4<f32>","vertexVC");let a=o.getCode();t.useRendererMatrix?(a=nt.ZP.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,t.forceZValue&&(a=nt.ZP.substitute(a,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(a=nt.ZP.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,t.forceZValue&&(a=nt.ZP.substitute(a,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),e.haveWideLines()&&(o.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),a=nt.ZP.substitute(a,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),a=nt.ZP.substitute(a,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,o.setCode(a)},t.shaderReplacements.set("replaceShaderPosition",e.replaceShaderPosition),e.replaceShaderNormal=(e,n,r)=>{const i=r.getBuffer("normalMC"),o=t.WebGPUActor.getRenderable();if(i){const e=n.getShaderDescription("vertex");e.hasOutput("normalVC")||e.addOutput("vec3<f32>","normalVC",i.getArrayInformation()[0].interpolation),e.hasOutput("tangentVC")||e.addOutput("vec3<f32>","tangentVC",i.getArrayInformation()[0].interpolation),e.hasOutput("bitangentVC")||e.addOutput("vec3<f32>","bitangentVC",i.getArrayInformation()[0].interpolation);let t=e.getCode();t=nt.ZP.substitute(t,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,e.setCode(t);const r=n.getShaderDescription("fragment");t=r.getCode(),t=o.getProperty().getNormalTexture()?nt.ZP.substitute(t,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:nt.ZP.substitute(t,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,r.setCode(t)}},t.shaderReplacements.set("replaceShaderNormal",e.replaceShaderNormal),e.replaceShaderLight=(e,n,r)=>{if(e.includes("sel"))return;const i=n.getShaderDescription("vertex");i.hasOutput("vertexVC")||i.addOutput("vec4<f32>","vertexVC");const o=t.WebGPURenderer.getRenderable(),a=n.getShaderDescription("fragment");let s=a.getCode();if(!s.includes("var normal:")||!t.useRendererMatrix||pt(e)||t.is2D||e.includes("sel"))s=nt.ZP.substitute(s,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,a.setCode(s);else{const e=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];o.getEnvironmentTexture()?.getImageLoaded()&&e.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),s=nt.ZP.substitute(s,"//VTK::Light::Impl",e).result,a.setCode(s)}},t.shaderReplacements.set("replaceShaderLight",e.replaceShaderLight),e.replaceShaderColor=(e,t,n)=>{if(pt(e)){const e=t.getShaderDescription("fragment");let n=e.getCode();return n=nt.ZP.substitute(n,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,void e.setCode(n)}const r=n.getBuffer("colorVI");if(!r)return;const i=t.getShaderDescription("vertex");i.addOutput("vec4<f32>","color",r.getArrayInformation()[0].interpolation);let o=i.getCode();o=nt.ZP.substitute(o,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,i.setCode(o);const a=t.getShaderDescription("fragment");o=a.getCode(),o=nt.ZP.substitute(o,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,a.setCode(o)},t.shaderReplacements.set("replaceShaderColor",e.replaceShaderColor),e.replaceShaderTCoord=(e,n,r)=>{if(!r.hasAttribute("tcoord"))return;const i=n.getShaderDescription("vertex"),o=r.getBuffer("tcoord"),a=ot.Z.getNumberOfComponentsFromBufferFormat(o.getArrayInformation()[0].format);let s=i.getCode();i.addOutput(`vec${a}<f32>`,"tcoordVS"),s=nt.ZP.substitute(s,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,i.setCode(s);const l=n.getShaderDescription("fragment");s=l.getCode();const c=t.WebGPUActor.getRenderable(),u=e=>!!e&&e.getDimensionality()===a,d=[];(c.getProperty().getDiffuseTexture?.()?.getImageLoaded()||c.getTextures()[0]||t.colorTexture)&&(u(c.getProperty().getDiffuseTexture?.())||u(c.getTextures()[0])||u(t.colorTexture))&&d.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);"),c.getProperty().getRoughnessTexture?.()?.getImageLoaded()&&u(c.getProperty().getRoughnessTexture())&&d.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),c.getProperty().getMetallicTexture?.()?.getImageLoaded()&&u(c.getProperty().getMetallicTexture())&&d.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),c.getProperty().getNormalTexture?.()?.getImageLoaded()&&u(c.getProperty().getNormalTexture())&&d.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),c.getProperty().getAmbientOcclusionTexture?.()?.getImageLoaded()&&u(c.getProperty().getAmbientOcclusionTexture())&&d.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);"),c.getProperty().getEmissionTexture?.()?.getImageLoaded()&&u(c.getProperty().getEmissionTexture())&&d.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),s=nt.ZP.substitute(s,"//VTK::TCoord::Impl",d).result,l.setCode(s)},t.shaderReplacements.set("replaceShaderTCoord",e.replaceShaderTCoord),e.replaceShaderSelect=(e,t,n)=>{if(e.includes("sel")){const e=t.getShaderDescription("fragment");let n=e.getCode();n=nt.ZP.substitute(n,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,e.setCode(n)}},t.shaderReplacements.set("replaceShaderSelect",e.replaceShaderSelect),e.getUsage=(e,t)=>e===lt.POINTS||t===st.Points?at.Verts:t===st.Lines?at.Lines:e===lt.WIREFRAME?t===st.Triangles?at.LinesFromTriangles:at.LinesFromStrips:t===st.Triangles?at.Triangles:t===st.TriangleStrips?at.Strips:t===st.TriangleEdges?at.LinesFromTriangles:at.LinesFromStrips,e.getHashFromUsage=e=>`pt${e}`,e.getTopologyFromUsage=e=>{switch(e){case at.Triangles:return"triangle-list";case at.Verts:return"point-list";case at.Lines:default:return"line-list"}},e.buildVertexInput=()=>{const n=t.currentInput,r=t.cellArray,i=t.primitiveType;let o=t.WebGPUActor.getRenderable().getProperty().getRepresentation();const a=t.WebGPURenderWindow.getDevice();let s=!1;i===st.TriangleEdges&&(s=!0,o=lt.WIREFRAME);const l=t.vertexInput,c=n.getPoints();let u;if(r){const e={hash:`R${o}P${i}${r.getMTime()}`,usage:at.Index,cells:r,numberOfPoints:c.getNumberOfPoints(),primitiveType:i,representation:o};u=a.getBufferManager().getBuffer(e),l.setIndexBuffer(u)}else l.setIndexBuffer(null);if(c){const e=t.WebGPUActor.getBufferShift(t.WebGPURenderer),n={hash:`${c.getMTime()}I${u.getMTime()}${e.join()}float32x4`,usage:at.PointArray,format:"float32x4",dataArray:c,indexBuffer:u,shift:e,packExtra:!0},r=a.getBufferManager().getBuffer(n);l.addBuffer(r,["vertexBC"])}else l.removeBufferIfPresent("vertexBC");const d=e.getUsage(o,i);if(t._usesCellNormals=!1,t.is2D||d!==at.Triangles&&d!==at.Strips)l.removeBufferIfPresent("normalMC");else{const e=n.getPointData().getNormals(),o={format:"snorm8x4",indexBuffer:u,packExtra:!0,shift:0,scale:127};if(e){o.hash=`${e.getMTime()}I${u.getMTime()}snorm8x4`,o.dataArray=e,o.usage=at.PointArray;const t=a.getBufferManager().getBuffer(o);l.addBuffer(t,["normalMC"])}else if(i===st.Triangles){t._usesCellNormals=!0,o.hash=`PFN${c.getMTime()}I${u.getMTime()}snorm8x4`,o.dataArray=c,o.cells=r,o.usage=at.NormalsFromPoints;const e=a.getBufferManager().getBuffer(o);l.addBuffer(e,["normalMC"])}else l.removeBufferIfPresent("normalMC")}let p=!1;if(t.renderable.getScalarVisibility()){const e=t.renderable.getColorMapColors();if(e&&!s){const r=t.renderable.getScalarMode();let i=!1;r!==ct.USE_CELL_DATA&&r!==ct.USE_CELL_FIELD_DATA&&r!==ct.USE_FIELD_DATA&&n.getPointData().getScalars()||r===ct.USE_POINT_FIELD_DATA||!e||(i=!0);const o={usage:at.PointArray,format:"unorm8x4",hash:`${i}${e.getMTime()}I${u.getMTime()}unorm8x4`,dataArray:e,indexBuffer:u,cellData:i,cellOffset:0},s=a.getBufferManager().getBuffer(o);l.addBuffer(s,["colorVI"]),p=!0}}p||l.removeBufferIfPresent("colorVI");let h=null;if(h=t.renderable.getInterpolateScalarsBeforeMapping?.()&&t.renderable.getColorCoordinates()?t.renderable.getColorCoordinates():n.getPointData().getTCoords(),h&&!s){const e=a.getBufferManager().getBufferForPointArray(h,l.getIndexBuffer());l.addBuffer(e,["tcoord"])}else l.removeBufferIfPresent("tcoord")},e.updateTextures=()=>{const e=[],n=[],r=t.renderable.getColorTextureMap?.();r&&(t.colorTexture||(t.colorTexture=M.ZP.newInstance({label:"polyDataColor"})),t.colorTexture.setInputData(r),n.push(["Diffuse",t.colorTexture]));const i=t.WebGPUActor.getRenderable(),o=t.WebGPURenderer.getRenderable(),a=[];if(i.getProperty().getDiffuseTexture?.()){const e=["Diffuse",i.getProperty().getDiffuseTexture()];a.push(e)}if(i.getTextures()[0]){const e=["Diffuse",i.getTextures()[0]];a.push(e)}if(t.colorTexture){const e=["Diffuse",t.colorTexture];a.push(e)}if(i.getProperty().getRoughnessTexture?.()){const e=["Roughness",i.getProperty().getRoughnessTexture()];a.push(e)}if(i.getProperty().getMetallicTexture?.()){const e=["Metallic",i.getProperty().getMetallicTexture()];a.push(e)}if(i.getProperty().getNormalTexture?.()){const e=["Normal",i.getProperty().getNormalTexture()];a.push(e)}if(i.getProperty().getAmbientOcclusionTexture?.()){const e=["AmbientOcclusion",i.getProperty().getAmbientOcclusionTexture()];a.push(e)}if(i.getProperty().getEmissionTexture?.()){const e=["Emission",i.getProperty().getEmissionTexture()];a.push(e)}if(o.getEnvironmentTexture?.()){const e=["Environment",o.getEnvironmentTexture()];a.push(e)}for(let e=0;e<a.length;e++)(a[e][1].getInputData()||a[e][1].getJsImageData()||a[e][1].getCanvas())&&n.push(a[e]),a[e][1].getImage()&&a[e][1].getImageLoaded()&&n.push(a[e]);for(let r=0;r<n.length;r++){const i=n[r][1],o=n[r][0],a=t.device.getTextureManager().getTextureForVTKTexture(i);if(a.getReady()){let n=!1;for(let r=0;r<t.textures.length;r++)t.textures[r]===a&&(n=!0,e[r]=!0);if(!n){e[t.textures.length]=!0;const n=a.createView(`${o}Texture`);t.textures.push(a),t.textureViews.push(n);const r=i.getInterpolate()?"linear":"nearest";let s=null;!s&&i.getEdgeClamp()&&i.getRepeat()&&(s="mirror-repeat"),!s&&i.getEdgeClamp()&&(s="clamp-to-edge"),!s&&i.getRepeat()&&(s="repeat"),"Environment"!==o?n.addSampler(t.device,{addressModeU:s,addressModeV:s,addressModeW:s,minFilter:r,magFilter:r}):n.addSampler(t.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:r,magFilter:r,mipmapFilter:"linear"})}}}for(let n=t.textures.length-1;n>=0;n--)e[n]||(t.textures.splice(n,1),t.textureViews.splice(n,1))},e.computePipelineHash=()=>{let n=`pd${t.useRendererMatrix?"r":""}${t.forceZValue?"z":""}`;if(t.primitiveType===st.TriangleEdges||t.primitiveType===st.TriangleStripEdges)n+="edge";else{if(t.vertexInput.hasAttribute("normalMC")&&(n+="n"),t.vertexInput.hasAttribute("colorVI")&&(n+="c"),t.vertexInput.hasAttribute("tcoord")){const e=t.vertexInput.getBuffer("tcoord");n+=`t${ot.Z.getNumberOfComponentsFromBufferFormat(e.getArrayInformation()[0].format)}`}t.textures.length&&(n+=`tx${t.textures.length}`)}t._usesCellNormals&&(n+="cn"),t.SSBO&&(n+="ssbo"),n+=e.getHashFromUsage(t.usage),n+=t.renderEncoder.getPipelineHash(),t.pipelineHash=n},e.updateBuffers=()=>{t.primitiveType!==st.TriangleEdges&&t.primitiveType!==st.TriangleStripEdges&&e.updateTextures();const n=t.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();t.usage=e.getUsage(r,t.primitiveType),e.buildVertexInput();const i=t.vertexInput.getBuffer("vertexBC");if(e.setNumberOfVertices(i.getSizeInBytes()/i.getStrideInBytes()),e.setTopology(e.getTopologyFromUsage(t.usage)),e.updateUBO(),e.haveWideLines()){const t=n.getProperty();e.setNumberOfInstances(Math.ceil(2*t.getLineWidth()))}else e.setNumberOfInstances(1)}}(e,t)}var mt={newInstance:(0,x.n)(ft,"vtkWebGPUCellArrayMapper"),extend:ft};const{PrimitiveTypes:gt}=qe.default;const vt={primitives:null};function yt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,vt,n),Y.Z.extend(e,t,n),t.primitives=[],function(e,t){t.classHierarchy.push("vtkWebGPUPolyDataMapper"),e.createCellArrayMapper=()=>mt.newInstance(),e.buildPass=n=>{if(n){t.WebGPUActor=e.getFirstAncestorOfType("vtkWebGPUActor"),t.renderable.getStatic()||t.renderable.update();const n=t.renderable.getInputData();t.renderable.mapScalars(n,1),e.updateCellArrayMappers(n)}},e.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let o=0;for(let a=gt.Points;a<=gt.Triangles;a++)if(r[a].getNumberOfValues()>0){t.primitives[a]||(t.primitives[a]=e.createCellArrayMapper());const s=t.primitives[a];s.setCellArray(r[a]),s.setCurrentInput(n),s.setCellOffset(o),s.setPrimitiveType(a),s.setRenderable(t.renderable),o+=r[a].getNumberOfCells(),i.push(s)}else t.primitives[a]=null;if(t.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let o=gt.TriangleEdges;o<=gt.TriangleStripEdges;o++)if(r[o-2].getNumberOfValues()>0){t.primitives[o]||(t.primitives[o]=e.createCellArrayMapper());const a=t.primitives[o];a.setCellArray(r[o-2]),a.setCurrentInput(n),a.setCellOffset(t.primitives[o-2].getCellOffset()),a.setPrimitiveType(o),a.setRenderable(t.renderable),i.push(a)}else t.primitives[o]=null;e.prepareNodes(),e.addMissingChildren(i),e.removeUnusedNodes()}}(e,t)}const bt=(0,x.n)(yt,"vtkWebGPUPolyDataMapper");(0,Fe.vw)("vtkMapper",bt);const{PrimitiveTypes:Ct}=qe.default;function wt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,function(e){return{primitives:[],...e}}(n)),Y.Z.extend(e,t,n),t.primitives=[],function(e,t){t.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),e.createCellArrayMapper=()=>mt.newInstance(),e.buildPass=n=>{if(n){t.WebGPUActor=e.getFirstAncestorOfType("vtkWebGPUActor2D"),t.renderable.getStatic()||t.renderable.update();const n=t.renderable.getInputData();t.renderable.mapScalars(n,1),e.updateCellArrayMappers(n)}},e.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let o=0;for(let a=Ct.Points;a<=Ct.Triangles;a++)if(r[a].getNumberOfValues()>0){t.primitives[a]||(t.primitives[a]=e.createCellArrayMapper());const s=t.primitives[a];s.setCellArray(r[a]),s.setCurrentInput(n),s.setCellOffset(o),s.setPrimitiveType(a),s.setRenderable(t.renderable),s.setIs2D(!0),o+=r[a].getNumberOfCells(),i.push(s)}else t.primitives[a]=null;e.prepareNodes(),e.addMissingChildren(i),e.removeUnusedNodes()}}(e,t)}const Et=(0,x.n)(wt,"vtkWebGPUPolyDataMapper2D");(0,Fe.vw)("vtkMapper2D",Et);const Tt={};function xt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Tt,n),Y.Z.extend(e,t,n),t.scalarBarActorHelper=Re.newScalarBarActorHelper(),function(e,t){t.classHierarchy.push("vtkWebGPUScalarBarActor"),e.buildPass=n=>{n&&(t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getParent(),t.scalarBarActorHelper.getRenderable()||t.scalarBarActorHelper.setRenderable(t.renderable),e.prepareNodes(),e.addMissingNode(t.scalarBarActorHelper.getBarActor()),e.addMissingNode(t.scalarBarActorHelper.getTmActor()),e.removeUnusedNodes())},e.opaquePass=(e,n)=>{if(e){const e=t.WebGPURenderer?t.WebGPURenderer.getRenderable().getActiveCamera():null,n=t.WebGPURenderer.getTiledSizeAndOrigin();t.scalarBarActorHelper.updateAPISpecificData([n.usize,n.vsize],e,t.WebGPURenderWindow.getRenderable())}}}(e,t)}const _t=(0,x.n)(xt,"vtkWebGPUScalarBarActor");(0,Fe.vw)("vtkScalarBarActor",_t);var St=n(32069),It=n(2144);const Dt={texture:null,handle:null,sampler:null,label:null};function At(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Dt,n),x.m.obj(e,t),t.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},t.bindGroupTime={},x.m.obj(t.bindGroupTime,{mtime:0}),x.m.get(e,t,["bindGroupTime","texture"]),x.m.setGet(e,t,["bindGroupLayoutEntry","label","sampler"]),function(e,t){t.classHierarchy.push("vtkWebGPUTextureView"),e.create=(e,n)=>{t.texture=e,t.options=n,t.options.dimension=t.options.dimension||"2d",t.options.label=t.label,t.textureHandle=e.getHandle(),t.handle=t.textureHandle.createView(t.options),t.bindGroupLayoutEntry.texture.viewDimension=t.options.dimension;const r=ot.Z.getDetailsFromTextureFormat(t.texture.getFormat());t.bindGroupLayoutEntry.texture.sampleType=r.sampleType},e.createFromTextureHandle=(e,n)=>{t.texture=null,t.options=n,t.options.dimension=t.options.dimension||"2d",t.options.label=t.label,t.textureHandle=e,t.handle=t.textureHandle.createView(t.options),t.bindGroupLayoutEntry.texture.viewDimension=t.options.dimension;const r=ot.Z.getDetailsFromTextureFormat(n.format);t.bindGroupLayoutEntry.texture.sampleType=r.sampleType,t.bindGroupTime.modified()},e.getBindGroupEntry=()=>({resource:e.getHandle()}),e.getShaderCode=(e,n)=>{let r="f32";"sint"===t.bindGroupLayoutEntry.texture.sampleType?r="i32":"uint"===t.bindGroupLayoutEntry.texture.sampleType&&(r="u32");let i=`@binding(${e}) @group(${n}) var ${t.label}: texture_${t.options.dimension}<${r}>;`;return"depth"===t.bindGroupLayoutEntry.texture.sampleType&&(i=`@binding(${e}) @group(${n}) var ${t.label}: texture_depth_${t.options.dimension};`),i},e.addSampler=(n,r)=>{const i=It.ZP.newInstance({label:`${t.label}Sampler`});i.create(n,r),e.setSampler(i)},e.getBindGroupTime=()=>(t.texture&&t.texture.getHandle()!==t.textureHandle&&(t.textureHandle=t.texture.getHandle(),t.handle=t.textureHandle.createView(t.options),t.bindGroupTime.modified()),t.bindGroupTime),e.getHandle=()=>(t.texture&&t.texture.getHandle()!==t.textureHandle&&(t.textureHandle=t.texture.getHandle(),t.handle=t.textureHandle.createView(t.options),t.bindGroupTime.modified()),t.handle)}(e,t)}var Pt={newInstance:x.m.newInstance(At),extend:At};const{BufferUsage:Ot}=qe.default;const Rt={device:null,handle:null,buffer:null,ready:!1,label:null};function Mt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Rt,n),x.m.obj(e,t),x.m.get(e,t,["handle","ready","width","height","depth","format","usage"]),x.m.setGet(e,t,["device","label"]),function(e,t){t.classHierarchy.push("vtkWebGPUTexture"),e.create=(e,n)=>{t.device=e,t.width=n.width,t.height=n.height,t.depth=n.depth?n.depth:1;const r=1===t.depth?"2d":"3d";t.format=n.format?n.format:"rgba8unorm",t.mipLevel=n.mipLevel?n.mipLevel:0,t.usage=n.usage?n.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,t.handle=t.device.getHandle().createTexture({size:[t.width,t.height,t.depth],format:t.format,usage:t.usage,label:t.label,dimension:r,mipLevelCount:t.mipLevel+1})},e.assignFromHandle=(e,n,r)=>{t.device=e,t.handle=n,t.width=r.width,t.height=r.height,t.depth=r.depth?r.depth:1,t.format=r.format?r.format:"rgba8unorm",t.usage=r.usage?r.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},e.writeImageData=n=>{let r=[];if(n.canvas)return t.device.getHandle().queue.copyExternalImageToTexture({source:n.canvas,flipY:n.flip},{texture:t.handle,premultipliedAlpha:!0},[t.width,t.height,t.depth]),void(t.ready=!0);n.jsImageData&&!n.nativeArray&&(n.width=n.jsImageData.width,n.height=n.jsImageData.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,n.nativeArray=n.jsImageData.data);const i=ot.Z.getDetailsFromTextureFormat(t.format);let o=t.width*i.stride;const a=(e,t,n)=>{const r=e.length/(t*n)*e.BYTES_PER_ELEMENT,o=2===i.elementSize&&"float"===i.sampleType;if(o||r%256){const a=e,s=r/a.BYTES_PER_ELEMENT,l=i.elementSize,c=256*Math.floor((s*l+255)/256),u=c/l,d=x.m.newTypedArray(o?"Uint16Array":a.constructor.name,u*t*n);for(let e=0;e<t*n;e++)if(o)for(let t=0;t<s;t++)d[e*u+t]=St.default.toHalf(a[e*s+t]);else d.set(a.subarray(e*s,(e+1)*s),e*u);return[d,c]}return[e,r]};if(n.nativeArray&&(r=n.nativeArray),n.image){const e=document.createElement("canvas");e.width=n.image.width,e.height=n.image.height;const t=e.getContext("2d");t.translate(0,e.height),t.scale(1,-1),t.drawImage(n.image,0,0,n.image.width,n.image.height,0,0,e.width,e.height),r=t.getImageData(0,0,n.image.width,n.image.height).data}const s=t.device.createCommandEncoder();if(3!==e.getDimensionality()){const e=M.ZP.generateMipmaps(r,t.width,t.height,t.mipLevel);let i=t.width,l=t.height;for(let r=0;r<=t.mipLevel;r++){const c=a(e[r],l,1);o=c[1];const u={dataArray:n.dataArray?n.dataArray:null,nativeArray:c[0],usage:Ot.Texture},d=t.device.getBufferManager().getBuffer(u);s.copyBufferToTexture({buffer:d.getHandle(),offset:0,bytesPerRow:o,rowsPerImage:l},{texture:t.handle,mipLevel:r},[i,l,1]),i/=2,l/=2}t.device.submitCommandEncoder(s),t.ready=!0}else{const e=a(r,t.height,t.depth);o=e[1];const i={dataArray:n.dataArray?n.dataArray:null,usage:Ot.Texture};i.nativeArray=e[0];const l=t.device.getBufferManager().getBuffer(i);s.copyBufferToTexture({buffer:l.getHandle(),offset:0,bytesPerRow:o,rowsPerImage:t.height},{texture:t.handle},[t.width,t.height,t.depth]),t.device.submitCommandEncoder(s),t.ready=!0}},e.getScale=()=>{const e=ot.Z.getDetailsFromTextureFormat(t.format);return 2===e.elementSize&&"float"===e.sampleType?1:255},e.getNumberOfComponents=()=>ot.Z.getDetailsFromTextureFormat(t.format).numComponents,e.getDimensionality=()=>{let e=0;return t.width>1&&e++,t.height>1&&e++,t.depth>1&&e++,e},e.resizeToMatch=e=>{e.getWidth()===t.width&&e.getHeight()===t.height&&e.getDepth()===t.depth||(t.width=e.getWidth(),t.height=e.getHeight(),t.depth=e.getDepth(),t.handle=t.device.getHandle().createTexture({size:[t.width,t.height,t.depth],format:t.format,usage:t.usage,label:t.label}))},e.resize=function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e===t.width&&n===t.height&&r===t.depth||(t.width=e,t.height=n,t.depth=r,t.handle=t.device.getHandle().createTexture({size:[t.width,t.height,t.depth],format:t.format,usage:t.usage,label:t.label}))},e.createView=function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.dimension||(r.dimension=1===t.depth?"2d":"3d");const i=Pt.newInstance({label:n});return i.create(e,r),i}}(e,t)}x.m.newInstance(Mt),n(28378);const Nt=class{constructor(e){const{points:t,type:n}=e.data;this.id=e.id,this.points=t,this.type=n,this.color=e.color,this.segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){let e=0;return e+=3*this.points.length,e}getPoints(){return this.points}getFlatPointsArray(){return this.points.map(e=>[...e]).flat()}getColor(){return this.color}getType(){return this.type}};class Lt{constructor(e){this.color=[200,0,0],this.id=e.id,this.contours=[],this.color=e.color??this.color,this.frameOfReferenceUID=e.frameOfReferenceUID,this.segmentIndex=e.segmentIndex,this._createEachContour(e.data),this.sizeInBytes=this._getSizeInBytes()}_createEachContour(e){e.forEach(e=>{const{points:t,type:n,color:r}=e,i=new Nt({id:`${this.id}-segment-${this.segmentIndex}`,data:{points:t,type:n,segmentIndex:this.segmentIndex,color:r??this.color},segmentIndex:this.segmentIndex,color:r??this.color});this.contours.push(i)}),this._updateContourSetCentroid()}_updateContourSetCentroid(){const e=this.getTotalNumberOfPoints(),t=this.getFlatPointsArray(),n=t.reduce((e,t)=>[e[0]+t[0],e[1]+t[1],e[2]+t[2]],[0,0,0]),r=[n[0]/e,n[1]/e,n[2]/e],i=t.reduce((e,t)=>this._getDistance(r,t)<this._getDistance(r,e)?t:e,t[0]);this.centroid=i}_getSizeInBytes(){return this.contours.reduce((e,t)=>e+t.sizeInBytes,0)}getCentroid(){return this.centroid}getSegmentIndex(){return this.segmentIndex}getColor(){return this.color}getContours(){return this.contours}getSizeInBytes(){return this.sizeInBytes}getFlatPointsArray(){return this.contours.map(e=>e.getPoints()).flat()}getNumberOfContours(){return this.contours.length}getTotalNumberOfPoints(){return this.contours.reduce((e,t)=>e+t.getPoints().length,0)}getNumberOfPointsArray(){return this.contours.reduce((e,t,n)=>(e[n]=this.getNumberOfPointsInAContour(n),e),[])}getPointsInContour(e){return this.contours[e].getPoints()}getNumberOfPointsInAContour(e){return this.getPointsInContour(e).length}_getDistance(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}}function kt(e,t){!function(e){if(!e||0===e.data.length)throw new Error("Invalid contour set data, see publicContourSetData type for more info");if(!e.id)throw new Error("Invalid contour set data, each contour set must have an id");if(!e.data||!Array.isArray(e.data))throw new Error("Invalid contour set data, each contour set must have an array of contours");e.data.forEach(e=>{if(!e.points||!Array.isArray(e.points))throw new Error("Invalid contour set data, each contour must have an array of points");e.points.forEach(e=>{if(!e||!Array.isArray(e)||3!==e.length)throw new Error("Invalid contour set data, each point must be an array of length 3")})})}(t);const n=new Lt({id:t.id,data:t.data,color:t.color,frameOfReferenceUID:t.frameOfReferenceUID,segmentIndex:t.segmentIndex??1});return{id:e,type:i.GeometryType.CONTOUR,data:n,sizeInBytes:n.getSizeInBytes()}}var Ft=n(35421);function Vt(e,t){!function(e){const{data:t}=e;if(!t.points||!t.polys)throw new Error("Invalid surface data")}(t);const n=new Ft.T({id:t.id,color:t.color,frameOfReferenceUID:t.frameOfReferenceUID,data:{points:t.data.points,polys:t.data.polys}});return{id:e,type:i.GeometryType.SURFACE,data:n,sizeInBytes:n.getSizeInBytes()}}async function Ut(e,t){let n=h.ZP.getGeometry(e);if(n)return n;if(t.type===i.GeometryType.CONTOUR)n=kt(e,t.geometryData);else{if(t.type!==i.GeometryType.SURFACE)throw new Error("Unknown geometry type, Only CONTOUR is supported");n=Vt(e,t.geometryData)}const r={promise:Promise.resolve(n)};return await h.ZP.putGeometryLoadObject(e,r),n}n(27654);var Bt=n(11723),Gt=n(85041),Wt=n(25281)},28719:(e,t,n)=>{"use strict";n.d(t,{uz:()=>d,P_:()=>m,L_:()=>p,hG:()=>h,Pt:()=>g,uF:()=>f}),"function"==typeof SuppressedError&&SuppressedError;const r="undefined"==typeof window;(()=>{if(r)return;const{userAgent:e,platform:t,maxTouchPoints:n}=window.navigator,i=/(iphone|ipod|ipad)/i.test(e),o="iPad"===t||"MacIntel"===t&&n>0&&!window.MSStream;/android/i.test(e),/Version\/12.+Safari/.test(e),/Firefox/.test(e)})();var i=n(7187),o=(n(9138),n(11723),n(15291));let a=!1,s=!0;i.SharedArrayBufferModes.TRUE;let l={gpuTier:void 0,detectGPUConfig:{},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useNorm16Texture:!1,strictZSpacingForVolumeViewport:!0},enableCacheOptimization:!0},c=null;function u(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function d(){return!u()}function p(){return l.rendering.useCPURendering}function h(){return s}function f(){return a}function m(){return l}function g(){return c||(c=new o.Z),c}},27654:(e,t,n)=>{"use strict";n.d(t,{RJ:()=>m});const r=[{id:"initialImages",retrieveType:"single"},{id:"errorRetrieve"}],i=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}];var o=n(7187);const a=[{offset:-1,imageQualityStatus:o.ImageQualityStatus.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:o.ImageQualityStatus.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:o.ImageQualityStatus.FAR_REPLICATE}],s=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:o.RequestType.Thumbnail,priority:5,nearbyFrames:a},{id:"quarterThumb",decimate:4,offset:3,requestType:o.RequestType.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:a},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:o.RequestType.Thumbnail,retrieveType:"multipleFast",nearbyFrames:a},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:o.RequestType.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:o.RequestType.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:o.RequestType.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:o.RequestType.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];var l=n(62990),c=n(11723),u=n(96506),d=n(82253),p=n(74238);class h{static{this.createProgressive=m}static{this.interleavedRetrieveStages={stages:s}}static{this.singleRetrieveStages={stages:r}}static{this.sequentialRetrieveStages={stages:i}}constructor(e){this.stages=e.stages||r,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,t){return new f(this,e,t).loadImages()}}class f{constructor(e,t,n){this.outstandingRequests=0,this.stageStatusMap=new Map,this.imageQualityStatusMap=new Map,this.displayedIterator=new c.ProgressiveIterator("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=t,this.listener=n}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const t of e)this.addRequest(t);return 0===this.outstandingRequests?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,t){const{imageId:n,next:r}=e,i=(t.loader||l.loadAndCacheImage)(n,t),a=c.ProgressiveIterator.as(i);let s=!1;a.forEach(async(r,i)=>{const a=this.imageQualityStatusMap.get(n);if(!r)return void console.warn("No image retrieved",n);const{imageQualityStatus:l}=r;s||=l===o.ImageQualityStatus.FULL_RESOLUTION,void 0!==a&&a>l?this.updateStageStatus(e.stage,null,!0):(this.listener.successCallback(n,r),this.imageQualityStatusMap.set(n,l),this.displayedIterator.add(r),i&&this.updateStageStatus(e.stage),function(e,t,n,r,i){if(!n?.nearbyRequests?.length)return;const{arrayBuffer:o,offset:a,type:s,length:l}=i.targetBuffer;if(!o||void 0===a||!s)return;const c=new Float32Array(o),u=c.byteLength/c.length,d=i.targetBuffer.offset/u,p=c.slice(d,d+l);for(const i of n.nearbyRequests)try{const{itemId:n,imageQualityStatus:o}=i,a=t.get(n);if(void 0!==a&&a>=o)continue;const s=e.getLoaderImageOptions(n),{offset:l}=s.targetBuffer;c.set(p,l/u);const d={...r,imageQualityStatus:o};e.successCallback(n,d),t.set(n,o)}catch(e){console.log("Couldn't fill nearby item ",i.itemId,e)}}(this.listener,this.imageQualityStatusMap,e,r,t))},(t,i)=>{this.listener.errorCallback(n,s||!r,t),i&&this.updateStageStatus(e.stage,t)}).finally(()=>{if(!s&&r)d.ZP.getImageLoadObject(n)&&d.ZP.removeImageLoadObject(n),this.addRequest(r,t.streamingData);else{s||this.listener.errorCallback(n,!0,"Couldn't decode"),this.outstandingRequests--;for(let e=r;e;e=e.next)this.updateStageStatus(e.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()});return a.getDonePromise().catch(e=>null)}addRequest(e,t={}){const{imageId:n,stage:r}=e,i=this.listener.getLoaderImageOptions(n);if(!i)return;const{retrieveType:a="default"}=r,{retrieveOptions:s}=this,l=s[a]||s.default,c={...i,retrieveType:a,retrieveOptions:l,streamingData:t},d=r.priority??-5,p=r.requestType||o.RequestType.Interaction,h={imageId:n};u.Z.addRequest(this.sendRequest.bind(this,e,c),p,h,d)}updateStageStatus(e,t,n=!1){const{id:r}=e,i=this.stageStatusMap.get(r);if(i&&(i.imageLoadPendingCount--,t?i.imageLoadFailedCount++:n||i.totalImageCount++,n||i.stageStartTime||(i.stageStartTime=Date.now()),!i.imageLoadPendingCount)){const{imageLoadFailedCount:e,totalImageCount:t,stageStartTime:n=Date.now(),startTime:a}=i,s={stageId:r,numberOfFailures:e,numberOfImages:t,stageDurationInMS:n?Date.now()-n:null,startDurationInMS:Date.now()-a};(0,c.triggerEvent)(p.Z,o.Events.IMAGE_RETRIEVAL_STAGE,s),this.stageStatusMap.delete(r)}}createStageRequests(){const e=new Array,t=new Map,n=(n,r)=>{const i=r<0?this.imageIds.length+r:r<1?Math.floor((this.imageIds.length-1)*r):r,o=this.imageIds[i];if(!o)throw new Error(`No value found to add to requests at ${r}`);const a={imageId:o,stage:n,nearbyRequests:this.findNearbyRequests(i,n)};this.addStageStatus(n);const s=t.get(o);s?s.next=a:e.push(a),t.set(o,a)};for(const e of this.stages){(e.positions||(0,c.decimate)(this.imageIds,e.decimate||1,e.offset??0)).forEach(t=>n(e,t))}return e}findNearbyRequests(e,t){const n=new Array;if(!t.nearbyFrames)return n;for(const r of t.nearbyFrames){const t=e+r.offset;t<0||t>=this.imageIds.length||n.push({itemId:this.imageIds[t],imageQualityStatus:r.imageQualityStatus})}return n}addStageStatus(e){const{id:t}=e,n=this.stageStatusMap.get(t)||{stageId:t,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return n.imageLoadPendingCount++,this.stageStatusMap.set(t,n),n}}function m(e){return new h(e)}},30023:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addProvider:()=>i,get:()=>s,removeAllProviders:()=>a,removeProvider:()=>o});const r=[];function i(e,t=0){let n;for(console.log("ADD PROVIDER",e),n=0;n<r.length&&!(r[n].priority<=t);n++);r.splice(n,0,{priority:t,provider:e})}function o(e){for(let t=0;t<r.length;t++)if(r[t].provider===e){r.splice(t,1);break}}function a(){for(;r.length>0;)r.pop()}function s(e,...t){for(let n=0;n<r.length;n++){const i=r[n].provider(e,...t);if(void 0!==i)return i}}},1790:(e,t,n)=>{"use strict";function r(e){return i(e,"vtkVolume")||i(e,"vtkImageSlice")}function i(e,t){return!!("isA"in e?e:e.actor).isA(t)}n.d(t,{M:()=>r,m:()=>i})},91225:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var r=n(66872);class i{constructor(){this._targetsEventListeners=new Map}addEventListener(e,t,n,i){let o=this._targetsEventListeners.get(e);o||(o=new r.Z(e),this._targetsEventListeners.set(e,o)),o.addEventListener(t,n,i)}removeEventListener(e,t,n,r){const i=this._targetsEventListeners.get(e);i&&(i.removeEventListener(t,n,r),i.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,t])=>{t.reset(),this._targetsEventListeners.delete(e)})}}},66872:(e,t,n)=>{"use strict";var r;n.d(t,{X:()=>i,Z:()=>i}),function(e){e[e.None=0]="None",e[e.Capture=1]="Capture",e[e.Bubble=2]="Bubble"}(r||(r={}));class i{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return 0===this._eventListeners.size&&0===this._children.size}addEventListener(e,t,n){const r=e.indexOf(".");if(-1!==r){const o=e.substring(0,r);let a=this._children.get(o);a||(a=new i(this._target),this._children.set(o,a)),e=e.substring(r+1),a.addEventListener(e,t,n)}else this._addEventListener(e,t,n)}removeEventListener(e,t,n){const r=e.indexOf(".");if(-1!==r){const i=e.substring(0,r),o=this._children.get(i);if(!o)return;e=e.substring(r+1),o.removeEventListener(e,t,n),o.isEmpty&&this._children.delete(i)}else this._removeEventListener(e,t,n)}reset(){Array.from(this._children.entries()).forEach(([e,t])=>{if(t.reset(),!t.isEmpty)throw new Error("Child is not empty and cannot be removed");this._children.delete(e)}),this._unregisterAllEvents()}_addEventListener(e,t,n){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=n?.capture??!1?r.Capture:r.Bubble,a=i.get(t)??r.None;a&o?console.warn("A listener is already registered for this phase"):(i.set(t,a|o),this._target.addEventListener(e,t,n))}_removeEventListener(e,t,n){const i=n?.capture??!1?r.Capture:r.Bubble,o=this._eventListeners.get(e);if(!o)return;(t?[t]:Array.from(o.keys())).forEach(t=>{const a=o.get(t)??r.None;if(!!!(a&i))return;this._target.removeEventListener(e,t,n);const s=a^i;s===r.None?o.delete(t):o.set(t,s)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,t){Array.from(t.entries()).forEach(([t,n])=>{for(let i=r.Capture;n;i<<=1){if(!(n&i))continue;const o=i===r.Capture;this.removeEventListener(e,t,{capture:o}),n^=i}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,t])=>this._unregisterAllListeners(e,t))}}},64936:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(45802),i=n(210),o=n(48588);const a=o.EPSILON*o.EPSILON,s=e=>Math.abs(Math.abs(e)-1)<a,l=(e,t)=>s(e[t])||s(e[t+1])||s(e[t+2]),c=e=>l(e,0)&&l(e,3)&&l(e,6);function u(e,t,n){const o=e.getMapper().getInputData();let a;const s=o.getDirection();if(c(s))a=(0,i.Z)(e);else{const[e,t,n]=o.getDimensions();a=[[0,0,0],[e-1,0,0],[0,t-1,0],[e-1,t-1,0],[0,0,n-1],[e-1,0,n-1],[0,t-1,n-1],[e-1,t-1,n-1]].map(e=>o.indexToWorld(e))}const l=r.Z.buildFromDegree().identity().rotateFromDirections(t,[1,0,0]);a.forEach(e=>l.apply(e));const u=[...n];l.apply(u);const d=u[0];let p=1/0,h=-1/0;for(let e=0;e<8;e++){const t=a[e][0];t>h&&(h=t),t<p&&(p=t)}return{min:p,max:h,current:d,actor:e,viewPlaneNormal:t,focalPoint:n}}},49018:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(72076);function i(e,t){const{direction:n,spacing:i}=e,o=n.slice(0,3),a=n.slice(3,6),s=n.slice(6,9),l=[r.R3.dot(o,t),r.R3.dot(a,t),r.R3.dot(s,t)],c=r.R3.create();r.R3.set(c,l[0]*i[0],l[1]*i[1],l[2]*i[2]);return r.R3.length(c)}},61054:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(5287),i=n(48588),o=n(49018),a=n(18588),s=n(77059);const l=1+i.EPSILON,c=e=>!!(0,a.getVolumeLoaderSchemes)().find(t=>{return n=e.volumeId,(r=t)===n.substring(0,Math.min(n.length,r.length));var n,r});function u(e,t,n,i=!1){const{viewPlaneNormal:o}=t,a=e.getActors();if(!a||!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const u=a.map(e=>{const t=e.referenceId??e.uid;return r.Z.getVolume(t)}).filter(e=>!!e);if(n){const t=(0,s.r)(n),r=u.findIndex(e=>t.includes(e.volumeId)),l=u[r],{uid:c}=a[r];return{imageVolume:l,spacingInNormalDirection:d(l,o,e,i),actorUID:c}}if(!u.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const p={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},h=u.find(c);for(let t=0;t<u.length;t++){const n=u[t];if(h&&!c(n))continue;const r=d(n,o,e);r*l<p.spacingInNormalDirection&&(p.spacingInNormalDirection=r,p.imageVolume=n,p.actorUID=a[t].uid)}return p}function d(e,t,n,r=!1){const{slabThickness:i}=n.getProperties();let a=i;return i&&!1!==r||(a=(0,o.Z)(e,t)),a}},210:(e,t,n)=>{"use strict";function r(e){const t=e.getMapper().getInputData(),n=t.extentToBounds(t.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}n.d(t,{Z:()=>r})},77059:(e,t,n)=>{"use strict";n.d(t,{r:()=>r});const r=e=>{const t="volumeId:",n=e.includes(t)?e.substring(9):e,r=n.indexOf("?");return-1===r?n:n.substring(0,r)}},1483:(e,t,n)=>{"use strict";function r(e){return Array.isArray(e)?e.some(e=>Number.isNaN(e)):Number.isNaN(e)}n.d(t,{Z:()=>r})},11723:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PointsManager:()=>Oe,ProgressiveIterator:()=>$e,RLEVoxelMap:()=>ct,VoxelManager:()=>ut,actorIsA:()=>ve.m,applyPreset:()=>Pe,cacheUtils:()=>xt,calculateViewportsSpatialRegistration:()=>_e,calibratedPixelSpacingMetadataProvider:()=>S,clamp:()=>I,color:()=>o,colormap:()=>Et,convertStackToVolumeViewport:()=>st,convertToGrayscale:()=>ht,convertVolumeToStackViewport:()=>lt,createFloat32SharedArray:()=>M,createInt16SharedArray:()=>L,createLinearRGBTransferFunction:()=>f.Z,createSigmoidRGBTransferFunction:()=>p,createUint16SharedArray:()=>N,createUint8SharedArray:()=>O,decimate:()=>qe,deepMerge:()=>ke,eventListener:()=>a,generateVolumePropsFromImageIds:()=>it,genericMetadataProvider:()=>je,getBufferConfiguration:()=>nt,getClosestImageId:()=>W,getClosestStackImageIndexForPoint:()=>be,getCurrentVolumeViewportSlice:()=>we,getImageLegacy:()=>Be,getImageSliceDataForVolumeViewport:()=>ge.Z,getMinMax:()=>y,getRandomSampleFromArray:()=>mt,getRuntimeId:()=>T,getScalarDataType:()=>Ve,getScalingParameters:()=>Fe,getSliceRange:()=>pe.Z,getSpacingInNormalDirection:()=>B.Z,getTargetVolumeAndSpacingInNormalDir:()=>z.Z,getViewportImageCornersInWorld:()=>Se,getViewportImageIds:()=>ft,getViewportModality:()=>F,getViewportsWithImageURI:()=>ye,getViewportsWithVolumeId:()=>$,getVoiFromSigmoidRGBTransferFunction:()=>h,getVolumeActorCorners:()=>H.Z,getVolumeId:()=>vt.r,getVolumeSliceRangeInfo:()=>he,getVolumeViewportScrollInfo:()=>fe,getVolumeViewportsContainingSameVolumes:()=>K,hasFloatScalingParameters:()=>rt,hasNaNValues:()=>De.Z,imageIdToURI:()=>x,imageRetrieveMetadataProvider:()=>Qe,imageToWorldCoords:()=>de,indexWithinDimensions:()=>j,invertRgbTransferFunction:()=>s,isEqual:()=>D.Xy,isEqualAbs:()=>D.QG,isEqualNegative:()=>D.aw,isImageActor:()=>ve.M,isOpposite:()=>A,isPTPrescaledWithSUV:()=>ne,isValidVolume:()=>Ze,isVideoTransferSyntax:()=>tt,loadImageToCanvas:()=>le,makeVolumeMetadata:()=>We,planar:()=>i,renderToCanvasCPU:()=>se,renderToCanvasGPU:()=>re,roundNumber:()=>pt,roundToPrecision:()=>dt,scaleRgbTransferFunction:()=>m,snapFocalPointToSlice:()=>me,sortImageIdsAndGetSpacing:()=>Ge,spatialRegistrationMetadataProvider:()=>xe,transferFunctionUtils:()=>Tt,transformIndexToWorld:()=>X,transformWorldToIndex:()=>q.Z,triggerEvent:()=>g.Z,updateVTKImageDataWithCornerstoneImage:()=>Ke,uuidv4:()=>v,windowLevel:()=>r,worldToImageCoords:()=>ue});var r={};n.r(r),n.d(r,{toLowHighRange:()=>d,toWindowLevel:()=>u});var i={};n.r(i),n.d(i,{linePlaneIntersection:()=>yt,planeDistanceToPoint:()=>wt,planeEquation:()=>bt,threePlaneIntersection:()=>Ct});var o={};n.r(o),n.d(o,{hexToRgb:()=>It,rgbToHex:()=>St});var a=n(94791);function s(e){if(!e)return;const t=e.getSize();for(let n=0;n<t;n++){const t=[];e.getNodeValue(n,t),t[1]=1-t[1],t[2]=1-t[2],t[3]=1-t[3],e.setNodeValue(n,t)}}var l=n(5193),c=n(54131);function u(e,t){return{windowWidth:Math.abs(t-e)+1,windowCenter:(e+t+1)/2}}function d(e,t){return{lower:t-.5-(e-1)/2,upper:t-.5+(e-1)/2}}function p(e,t=1024){const{windowWidth:n,windowCenter:r}=u(e.lower,e.upper),i=[...Array(t+2).keys()].map(e=>e/(t+2)).slice(1,-1).reduce((e,t)=>{const i=((e,t,n)=>t-n/4*Math.log((1-e)/e))(t,r,n);return e.concat(i,t,t,t,.5,0)},[]),o=l.ZP.newInstance();return o.buildFunctionFromArray(c.default.newInstance({values:i,numberOfComponents:6})),o}function h(e){let t=[];const[n,r]=e.getRange();e.getTable(n,r,1024,t),t=t.filter((e,t)=>t%3==0);const i=[...Array(1024).keys()].map((e,t)=>n+(r-n)/1023*t),o=t[256],a=Math.log((1-o)/o),s=i[256],l=t[768],c=Math.log((1-l)/l),u=i[768],d=Math.round(4*(u-s)/(a-c)),p=Math.round(s+d*a/4);return[Math.round(p-d/2),Math.round(p+d/2)]}var f=n(16159);function m(e,t){const n=e.getSize();for(let r=0;r<n;r++){const n=[];e.getNodeValue(r,n),n[1]=n[1]*t,n[2]=n[2]*t,n[3]=n[3]*t,e.setNodeValue(r,n)}}var g=n(85041);function v(){return crypto.randomUUID()}function y(e){let t,n=e[0],r=e[0];const i=e.length;for(let o=1;o<i;o++)t=e[o],n=Math.min(n,t),r=Math.max(r,t);return{min:n,max:r}}const b=Symbol("LastRuntimeId"),C={},w=4294967295,E="-";function T(e,t,n){return function(e,t,n){let r=e[t];r instanceof Array||(r=[0],Object.defineProperty(e,t,{value:r}));for(let e=!0,t=0;e&&t<r.length;++t){let i=0|r[t];i<n?(e=!1,i+=1):(i=0,t+1===r.length&&r.push(0)),r[t]=i}return r}(null!==e&&"object"==typeof e?e:C,b,("number"==typeof n&&n>0?n:w)>>>0).join("string"==typeof t?t:E)}function x(e){const t=e.indexOf(":");return e.substring(t+1)}const _={},S={add:(e,t)=>{const n=x(e);_[n]=t},get:(e,t)=>{if("calibratedPixelSpacing"===e){const e=x(t);return _[e]}}};function I(e,t,n){return Math.max(t,Math.min(n,e))}var D=n(78001);function A(e,t,n=1e-5){return Math.abs(e[0]+t[0])<n&&Math.abs(e[1]+t[1])<n&&Math.abs(e[2]+t[2])<n}var P=n(28719);const O=function(e){if(!(0,P.hG)())throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(void 0===window.SharedArrayBuffer)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const t=new SharedArrayBuffer(e);return new Uint8Array(t)},R=2147483646;const M=function(e){if(!(0,P.hG)())throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(void 0===window.SharedArrayBuffer)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const t=4*e;if(t<R){const e=new SharedArrayBuffer(t);return new Float32Array(e)}if(t<4294967292){const n=Math.ceil(t/65536),r=new WebAssembly.Memory({initial:n,maximum:n,shared:!0});return new Float32Array(r.buffer,0,e)}};const N=function(e){if(!window.crossOriginIsolated)throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(void 0===window.SharedArrayBuffer)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const t=new SharedArrayBuffer(2*e);return new Uint16Array(t)};const L=function(e){if(!window.crossOriginIsolated)throw new Error("Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated");if(void 0===window.SharedArrayBuffer)throw new Error("SharedArrayBuffer is NOT supported in your browser see https://developer.chrome.com/blog/enabling-shared-array-buffer/");const t=new SharedArrayBuffer(2*e);return new Int16Array(t)};var k=n(82253);function F(e,t){if(e.modality)return e.modality;if(e.setVolumes){if(!(t=t??e.getDefaultActor()?.uid))return;return k.ZP.getVolume(t)?.metadata.Modality}throw new Error("Invalid viewport type")}var V=n(72076),U=n(30023),B=n(49018),G=n(48588);function W(e,t,n){if(!e)return;const{direction:r,imageIds:i}=e;if(!i||!i.length)return;const o=r.slice(6,9),a=V.R3.dot(o,n);if(Math.abs(a)<1-G.EPSILON)return;const s=(0,B.Z)(e,n)/2;let l;for(let e=0;e<i.length;e++){const r=i[e],{imagePositionPatient:o}=U.get("imagePlaneModule",r),a=V.R3.create();V.R3.sub(a,t,o);const c=V.R3.dot(a,n);Math.abs(c)<s&&(l=r)}return l}var z=n(61054),H=n(210);function j(e,t){return!(e[0]<0||e[0]>=t[0]||e[1]<0||e[1]>=t[1]||e[2]<0||e[2]>=t[2])}var Z=n(9138);const K=function(e,t){let n;n=t?[(0,Z.Pr)(t)]:(0,Z.Uu)();const r=[];return n.forEach(t=>{const n=e.getActors(),i=t.getVolumeViewports();for(const e of i){const t=e.getActors();if(t.length!==n.length)continue;n.every(({uid:e})=>t.find(t=>e===t.uid))&&r.push(e)}}),r};const $=function(e,t){let n;n=t?[(0,Z.Pr)(t)]:(0,Z.Uu)();const r=[];return n.forEach(t=>{const n=t.getVolumeViewports().filter(t=>t.hasVolumeId(e));r.push(...n)}),r};var q=n(96765);function X(e,t){return e.indexToWorld(t)}var Y=n(62990),J=n(7187),Q=n(96506),ee=n(21804),te=n(69552);const ne=e=>e.preScale?.scaled&&e.preScale.scalingParameters?.suvbw;function re(e,t,n=void 0,r="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!(e&&e instanceof HTMLCanvasElement))throw new Error("canvas element is required");const o=!t.imageId,a=!o&&t,s=o&&t,l=`renderGPUViewport-${a?.imageId||s?.volumeId}`,c=document.createElement("div"),u=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const d=e.width,p=e.height;c.style.width=`${d/u+ee.Ib}px`,c.style.height=`${p/u+ee.Ib}px`,c.style.visibility="hidden",c.style.position="absolute",document.body.appendChild(c);const h=l.split(":").join("-");c.setAttribute("viewport-id-for-remove",h);const f=(0,ee.ZP)(c),m=(0,Z.Pr)(r)||new te.ZP(r);let g=m.getViewport(l);if(!g){const e={viewportId:l,type:o?J.ViewportType.ORTHOGRAPHIC:J.ViewportType.STACK,element:c,defaultOptions:{...i,suppressEvents:!0}};m.enableElement(e),g=m.getViewport(l)}return new Promise(r=>{let d=!1,{viewReference:p}=i;const v=t=>{if(d)return;if(p){const e=p;return p=null,g.setViewReference(e),void g.render()}e.getContext("2d").drawImage(f,0,0,f.width,f.height,0,0,e.width,e.height);const n=g.canvasToWorld([0,0]),i=g.canvasToWorld([f.width/u,0]),o=g.canvasToWorld([0,f.height/u]);d=!0,c.removeEventListener(J.Events.IMAGE_RENDERED,v),setTimeout(()=>{m.disableElement(l);document.querySelectorAll(`[viewport-id-for-remove="${h}"]`).forEach(e=>{e.remove()})},0),r({origin:n,bottomLeft:o,topRight:i,thicknessMm:1})};c.addEventListener(J.Events.IMAGE_RENDERED,v),o?g.setVolumes([s],!1,!0):g.renderImageObject(t),g.resetCamera(),"PT"!==n||ne(a)||g.setProperties({voiRange:{lower:a.minPixelValue,upper:a.maxPixelValue}}),g.render()})}var ie=n(94222),oe=n(77327),ae=n(14569);function se(e,t,n,r,i){if(t.volumeId)throw new Error("Unsupported volume rendering for CPU");const o=t,a={canvas:e,viewport:(0,ie.Z)(e,o,n),image:o,renderingTools:{}};a.transform=(0,oe.Z)(a);return new Promise((e,t)=>{(0,ae.Z)(a,true),e(null)})}function le(e){const{canvas:t,imageId:n,viewReference:r,requestType:i=J.RequestType.Thumbnail,priority:o=-5,renderingEngineId:a="_thumbnails",useCPURendering:s=!1,thumbnail:l=!1,imageAspect:c=!1,viewportOptions:u}=e,d=r?.volumeId,p=d&&!n,h=r&&u?{...u,viewReference:r}:u,f=s?se:re;return new Promise((e,r)=>{function u(n,i){const{modality:o}=U.get("generalSeriesModule",i)||{},u=!p&&n,d=p&&n;u&&(u.isPreScaled=u.isPreScaled||u.preScale?.scaled),l&&(t.height=256,t.width=256),c&&u&&(t.width=u&&t.height*u.width/u.height),t.style.width=t.width/devicePixelRatio+"px",t.style.height=t.height/devicePixelRatio+"px",d&&s&&r(new Error("CPU rendering of volume not supported")),f(t,n,o,a,h).then(e)}function m(e,t){console.error(e,t),r(e)}const{useNorm16Texture:g}=(0,P.P_)().rendering,v={targetBuffer:{type:g?void 0:"Float32Array"},preScale:{enabled:!0},useRGBA:!!s,requestType:i};if(d){const e=k.ZP.getVolume(d);e||r(new Error(`Volume id ${d} not found in cache`));u(e,e.imageIds[0])}else Q.Z.addRequest(function(e,t,n){return(0,Y.loadAndCacheImage)(e,n).then(t=>{u.call(this,t,e)},t=>{m.call(this,t,e)})}.bind(null,n,null,v),i,{imageId:n},o)})}var ce=n(62709);const ue=function(e,t){const n=ce.metaData.get("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:o}=n;let{columnPixelSpacing:a,rowPixelSpacing:s}=n;a||=1,s||=1;const l=V.R3.create();V.R3.scaleAndAdd(l,o,r,-a/2),V.R3.scaleAndAdd(l,l,i,-s/2);const c=V.R3.create();return V.R3.sub(c,t,l),[V.R3.dot(c,i)/s,V.R3.dot(c,r)/a]};function de(e,t){const n=ce.metaData.get("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:o}=n;let{columnPixelSpacing:a,rowPixelSpacing:s}=n;a||=1,s||=1;const l=V.R3.create();return V.R3.scaleAndAdd(l,o,i,s*(t[0]-.5)),V.R3.scaleAndAdd(l,l,r,a*(t[1]-.5)),Array.from(l)}var pe=n(64936);const he=function(e,t,n=!1){const r=e.getCamera(),{focalPoint:i,viewPlaneNormal:o}=r,{spacingInNormalDirection:a,actorUID:s}=(0,z.Z)(e,r,t,n);if(!s)throw new Error(`Could not find image volume with id ${t} in the viewport`);const l=e.getActor(s);if(!l)return console.warn("No actor found for with actorUID of",s),null;const c=l.actor;return{sliceRange:(0,pe.Z)(c,o,i),spacingInNormalDirection:a,camera:r}};const fe=function(e,t,n=!1){const{sliceRange:r,spacingInNormalDirection:i,camera:o}=he(e,t,n),{min:a,max:s,current:l}=r,c=Math.round((s-a)/i),u=(l-a)/(s-a)*c;return{numScrollSteps:c,currentStepIndex:Math.round(u),sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:i,camera:o}}};function me(e,t,n,r,i,o){const{min:a,max:s,current:l}=n,c=V.R3.create();V.R3.sub(c,t,e);const u=Math.round((s-a)/i),d=(l-a)/(s-a)*u;let p=Math.round(d),h=[e[0]-r[0]*d*i,e[1]-r[1]*d*i,e[2]-r[2]*d*i];p+=o,p>u?p=u:p<0&&(p=0);const f=p*i;h=[h[0]+r[0]*f,h[1]+r[1]*f,h[2]+r[2]*f];return{newFocalPoint:h,newPosition:[h[0]+c[0],h[1]+c[1],h[2]+c[2]]}}var ge=n(47326),ve=n(1790);function ye(e,t){let n;n=t?[(0,te.Pr)(t)]:(0,Z.Uu)();const r=[];return n.forEach(t=>{t.getViewports().forEach(t=>{t.hasImageURI(e)&&r.push(t)})}),r}function be(e,t){const n=function(e,t){const n=t.getImageIds(),r=t.getCurrentImageIdIndex();if(0===n.length)return null;const i=t=>{const n=function(e){const t=ce.metaData.get("imagePlaneModule",e);if(!(t&&t.rowCosines instanceof Array&&3===t.rowCosines.length&&t.columnCosines instanceof Array&&3===t.columnCosines.length&&t.imagePositionPatient instanceof Array&&3===t.imagePositionPatient.length))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:i}=t,o=V.R3.set(V.R3.create(),...n),a=V.R3.set(V.R3.create(),...r),s=V.R3.cross(V.R3.create(),o,a);return{rowCosines:n,columnCosines:r,imagePositionPatient:i,planeNormal:s}}(t);if(!n)return null;return wt(bt(n.planeNormal,n.imagePositionPatient),e)},o={distance:i(n[r])??1/0,index:r},a=n.slice(r+1);for(let e=0;e<a.length;e++){const t=i(a[e]);if(null!==t){if(!(t<=o.distance))break;o.distance=t,o.index=e+r+1}}const s=n.slice(0,r);for(let e=s.length-1;e>=0;e--){const t=i(s[e]);if(null!==t&&t!==o.distance){if(!(t<o.distance))break;o.distance=t,o.index=e}}return o.distance===1/0?null:o}(e,t);return n?n.index:null}function Ce(e,t){const{imageData:n}=e.getImageData(),r=e.canvasToWorld(t);return(0,q.Z)(n,r)}function we(e){const{dimensions:t,scalarData:n}=e.getImageData(),{width:r,height:i}=e.getCanvas(),o=Ce(e,[0,0]),a=Ce(e,[r-1,0]),s=Ce(e,[0,i-1]),l=V.R3.sub(V.R3.create(),a,o),c=V.R3.sub(V.R3.create(),s,o),u=V.R3.cross(V.R3.create(),l,c);V.R3.normalize(l,l),V.R3.normalize(c,c),V.R3.normalize(u,u);const d=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2])),p=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2]));if(!V.DV.equals(1,d)||!V.DV.equals(1,p))throw new Error("Livewire is not available for rotate/oblique viewports");const[h,f,m]=t,g=[[0,0,0],[h-1,0,0],[0,f-1,0],[h-1,f-1,0],[0,0,m-1],[h-1,0,m-1],[0,f-1,m-1],[h-1,f-1,m-1]].map(t=>function(e,t){const{imageData:n}=e.getImageData(),r=X(n,t);return e.worldToCanvas(r)}(e,t)),v=g.reduce((e,t)=>(e.minX=Math.min(e.minX,t[0]),e.minY=Math.min(e.minY,t[1]),e.maxX=Math.max(e.maxX,t[0]),e.maxY=Math.max(e.maxY,t[1]),e),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),y=Ce(e,[v.minX,v.minY]),b=Ce(e,[v.maxX,v.maxY]),C=V.R3.sub(V.R3.create(),b,y),w=V._E.fromValues(l[0],l[1],l[2],0,c[0],c[1],c[2],0,u[0],u[1],u[2],0,y[0],y[1],y[2],1),E=V._E.invert(V._E.create(),w),T=V.R3.dot(l,C)+1,x=V.R3.dot(c,C)+1,_=new(0,n.constructor)(T*x),S=t[0]*t[1],I=V.R3.clone(y),D=V.R3.create();let A=0;for(let e=0;e<x;e++){V.R3.copy(D,I);for(let e=0;e<T;e++){const e=D[2]*S+D[1]*t[0]+D[0];e<n.length&&(_[A]=n[e]),A++,V.R3.add(D,D,l)}V.R3.add(I,I,c)}return{width:T,height:x,scalarData:_,sliceToIndexMatrix:w,indexToSliceMatrix:E}}const Ee={},Te={add:(e,t)=>{const[n,r]=e,i=`${n}_${r}`;Ee[i]||(Ee[i]={}),Ee[i]=t},get:(e,t,n)=>{if("spatialRegistrationModule"!==e)return;const r=`${t}_${n}`;if(Ee[r])return Ee[r];const i=`${n}_${t}`;return Ee[i]?V._E.invert(V._E.create(),Ee[i]):void 0}};(0,U.addProvider)(Te.get.bind(Te));const xe=Te;const _e=function(e,t){const n=e.getCurrentImageId(),r=t.getCurrentImageId(),i=ce.metaData.get("imagePlaneModule",n),o=ce.metaData.get("imagePlaneModule",r);if(!i||!o)return void console.log("Viewport spatial registration requires image plane module");const{imageOrientationPatient:a}=o;if(!i.imageOrientationPatient.every((e,t)=>Math.abs(e-a[t])<.05))return void console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i?.imageOrientationPatient,o?.imageOrientationPatient);const s=i.imagePositionPatient,l=o.imagePositionPatient,c=V.R3.subtract(V.R3.create(),s,l),u=V._E.fromTranslation(V._E.create(),c);xe.add([e.id,t.id],u)};function Se(e){const{imageData:t,dimensions:n}=e.getImageData(),{canvas:r}=e,i=window.devicePixelRatio,o=[r.width/i,0],a=[r.width/i,r.height/i],s=[0,r.height/i],l=e.canvasToWorld([0,0]),c=e.canvasToWorld(o),u=e.canvasToWorld(a),d=e.canvasToWorld(s),p=t.worldToIndex(l),h=t.worldToIndex(c),f=t.worldToIndex(u),m=t.worldToIndex(d);return function({dimensions:e,imageData:t,topLeftImage:n,topRightImage:r,bottomRightImage:i,bottomLeftImage:o,topLeftWorld:a,topRightWorld:s,bottomRightWorld:l,bottomLeftWorld:c}){const u=Ie(n,e)?a:t.indexToWorld([0,0,0]),d=Ie(r,e)?s:t.indexToWorld([e[0]-1,0,0]),p=Ie(i,e)?l:t.indexToWorld([e[0]-1,e[1]-1,0]),h=Ie(o,e)?c:t.indexToWorld([0,e[1]-1,0]);return[u,d,h,p]}({dimensions:n,imageData:t,topLeftImage:p,topRightImage:h,bottomRightImage:f,bottomLeftImage:m,topLeftWorld:l,topRightWorld:c,bottomRightWorld:u,bottomLeftWorld:d})}function Ie(e,t){return e[0]>0||e[0]<t[0]-1||e[1]>0||e[1]<t[1]-1||e[2]>0||e[2]<t[2]-1}var De=n(1483),Ae=n(44031);function Pe(e,t){const n=t.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=function(e){let t=1/0,n=-1/0;for(let r=0;r<e.length;r+=4)t=Math.min(t,e[r]),n=Math.max(n,e[r]);const r=(n-t)/2;return{shiftRange:[-r,r],min:t,max:n}}(n),i=r[0],o=r[1]-r[0],a=l.ZP.newInstance(),s=[];for(let e=0;e<n.length;e+=4){let t=n[e];const r=n[e+1],a=n[e+2],l=n[e+3];t=(t-i)/o,s.push([t,r,a,l])}!function(e,t,n){const r=t[1]-t[0],i=e.map(([e,n,i,o])=>[e*r+t[0],n,i,o]);n.removeAllPoints(),i.forEach(([e,t,r,i])=>n.addRGBPoint(e,t,r,i))}(s,r,a),e.getProperty().setRGBTransferFunction(0,a);const c=t.scalarOpacity.split(" ").splice(1).map(parseFloat),u=Ae.ZP.newInstance(),d=[];for(let e=0;e<c.length;e+=2){let t=c[e];const n=c[e+1];t=(t-i)/o,d.push([t,n])}!function(e,t,n){const r=t[1]-t[0],i=e.map(([e,n])=>[e*r+t[0],n]);n.removeAllPoints(),i.forEach(([e,t])=>n.addPoint(e,t))}(d,r,u);const p=e.getProperty();p.setScalarOpacity(0,u);const[h,f,m,g]=t.gradientOpacity.split(" ").splice(1).map(parseFloat);p.setUseGradientOpacity(0,!0),p.setGradientOpacityMinimumValue(0,h),p.setGradientOpacityMinimumOpacity(0,f),p.setGradientOpacityMaximumValue(0,m),p.setGradientOpacityMaximumOpacity(0,g),"1"===t.interpolation&&p.setInterpolationTypeToFastLinear(),p.setShade("1"===t.shade);const v=parseFloat(t.ambient),y=parseFloat(t.diffuse),b=parseFloat(t.specular),C=parseFloat(t.specularPower);p.setAmbient(v),p.setDiffuse(y),p.setSpecular(b),p.setSpecularPower(C)}class Oe{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:t=1024,dimensions:n=3,growSize:r=128}=e,i=t*n;this.growSize=r,this.array=new ArrayBuffer(i*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=n}forEach(e){for(let t=0;t<this._length;t++)e(this.getPoint(t),t)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const t=this._dimensions*e;return this.data.subarray(t,t+this._dimensions)}getPointArray(e){const t=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;for(let e=0;e<this._dimensions;e++)t.push(this.data[e+n]);return t}grow(e=1,t=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const n=this.data.length+t,r=new ArrayBuffer(n*this._dimensions*this._byteSize),i=new Float32Array(r);i.set(this.data),this.data=i,this.array=r}reverse(){const e=Math.floor(this._length/2);for(let t=0;t<e;t++){const e=t*this._dimensions,n=(this._length-1-t)*this._dimensions;for(let t=0;t<this._dimensions;t++){const r=this.data[e+t];this.data[e+t]=this.data[n+t],this.data[n+t]=r}}}push(e){this.grow(1);const t=this.length*this._dimensions;for(let n=0;n<this._dimensions;n++)this.data[n+t]=e[n];this._length++}map(e){const t=[];for(let n=0;n<this._length;n++)t.push(e(this.getPoint(n),n));return t}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:t,y:n,z:r}=e;return this.forEach(e=>{t.push(e[0]),n.push(e[1]),r&&r.push(e[2])}),e}static fromXYZ({x:e,y:t,z:n}){const r=Oe.create3(e.length);let i=0;for(let o=0;o<e.length;o++)r.data[i++]=e[o],r.data[i++]=t[o],r.data[i++]=n?n[o]:0;return r._length=e.length,r}subselect(e=10,t=0){const n=new Oe({initialSize:e,dimensions:this._dimensions});for(let r=0;r<e;r++){const i=(t+Math.floor(this.length*r/e))%this.length;n.push(this.getPoint(i))}return n}static create3(e=128){return new Oe({initialSize:e,dimensions:3})}static create2(e=128){return new Oe({initialSize:e,dimensions:2})}}const Re=e=>e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e),Me=(e,t)=>{return t&&!0===t.clone&&Re(e)?Le((n=e,Array.isArray(n)?[]:{}),e,t):e;var n},Ne=(e,t,n)=>{const r=e.slice();return t.forEach(function(t,i){void 0===r[i]?r[i]=Me(t,n):Re(t)?r[i]=Le(e[i],t,n):-1===e.indexOf(t)&&(r[i]=Me(t,n))}),r},Le=(e={},t={},n=void 0)=>{const r=Array.isArray(t),i=(n||{arrayMerge:Ne}).arrayMerge||Ne;return r?Array.isArray(e)?i(e,t,n):Me(t,n):((e,t,n)=>{const r={};return Re(e)&&Object.keys(e).forEach(function(t){r[t]=Me(e[t],n)}),Object.keys(t).forEach(function(i){Re(t[i])&&e[i]?r[i]=Le(e[i],t[i],n):r[i]=Me(t[i],n)}),r})(e,t,n)},ke=Le;function Fe(e){const t=(0,U.get)("modalityLutModule",e)||{},n=(0,U.get)("generalSeriesModule",e)||{},{modality:r}=n,i={rescaleSlope:t.rescaleSlope||1,rescaleIntercept:t.rescaleIntercept??0,modality:r},o=(0,U.get)("scalingModule",e)||{};return{...i,..."PT"===r&&{suvbw:o.suvbw,suvbsa:o.suvbsa,suvlbm:o.suvlbm}}}function Ve(e,t){let n;if(t&&t instanceof Uint8Array)n="Uint8Array";else if(t instanceof Float32Array)n="Float32Array";else if(t instanceof Int16Array)n="Int16Array";else{if(!(t instanceof Uint16Array))throw new Error("Unsupported array type");n="Uint16Array"}return n}var Ue=n(65279);const Be=function(e){const t=(0,Ue.ZP)(e);if(!t)return;const{viewport:n}=t;if(!(n instanceof ce.StackViewport))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()};function Ge(e,t){const{imagePositionPatient:n,imageOrientationPatient:r}=ce.metaData.get("imagePlaneModule",e[0]);if(!t){const e=V.R3.fromValues(r[0],r[1],r[2]),n=V.R3.fromValues(r[3],r[4],r[5]);t=V.R3.create(),V.R3.cross(t,e,n)}const i=V.R3.create(),o="wadouri"===e[0].split(":")[0];let a,s;function l(e){const{imagePositionPatient:r}=ce.metaData.get("imagePlaneModule",e),i=V.R3.create();return V.R3.sub(i,n,r),V.R3.dot(i,t)}if(V.R3.set(i,n[0],n[1],n[2]),o){const r=[e[0],e[Math.floor(e.length/2)]];a=e;l(r[0])-l(r[1])<0&&a.reverse();const i=ce.metaData.get("imagePlaneModule",r[1]);if(!i)throw new Error("Incomplete metadata required for volume construction.");const o=V.R3.create();V.R3.sub(o,n,i.imagePositionPatient);const c=V.R3.dot(o,t);s=Math.abs(c)/Math.floor(e.length/2)}else{const t=e.map(e=>({distance:l(e),imageId:e}));t.sort((e,t)=>t.distance-e.distance),a=t.map(e=>e.imageId);const n=t.length;s=Math.abs(t[n-1].distance-t[0].distance)/(n-1)}const{imagePositionPatient:c,sliceThickness:u,spacingBetweenSlices:d}=ce.metaData.get("imagePlaneModule",a[0]),{strictZSpacingForVolumeViewport:p}=(0,ce.getConfiguration)().rendering;0!==s||p||(u&&d?(console.log("Could not calculate zSpacing. Using spacingBetweenSlices"),s=d):u?(console.log("Could not calculate zSpacing and no spacingBetweenSlices. Using sliceThickness"),s=u):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),s=1));return{zSpacing:s,origin:c,sortedImageIds:a}}function We(e){const t=e[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:o,photometricInterpretation:a,samplesPerPixel:s}=ce.metaData.get("imagePixelModule",t),l=[],c=ce.metaData.get("voiLutModule",t);let u;if(c){const{windowWidth:e,windowCenter:t}=c;if(u=c?.voiLUTFunction,Array.isArray(e))for(let n=0;n<e.length;n++)l.push({windowWidth:e[n],windowCenter:t[n]});else l.push({windowWidth:e,windowCenter:t})}else l.push({windowWidth:void 0,windowCenter:void 0});const{modality:d,seriesInstanceUID:p}=ce.metaData.get("generalSeriesModule",t),{imageOrientationPatient:h,pixelSpacing:f,frameOfReferenceUID:m,columns:g,rows:v}=ce.metaData.get("imagePlaneModule",t);return{BitsAllocated:r,BitsStored:i,SamplesPerPixel:s,HighBit:o,PhotometricInterpretation:a,PixelRepresentation:n,Modality:d,ImageOrientationPatient:h,PixelSpacing:f,FrameOfReferenceUID:m,Columns:g,Rows:v,voiLut:l,VOILUTFunction:u,SeriesInstanceUID:p}}let ze={};const He={add:(e,t)=>{const n=t.type;ze[e]||(ze[e]={}),ze[e][n]=t.rawMetadata??structuredClone(t.metadata)},get:(e,t)=>ze[t]?.[e],clear:()=>{ze={}}};(0,U.addProvider)(He.get);const je=He;function Ze(e){const t=e[0],{modality:n,seriesInstanceUID:r}=ce.metaData.get("generalSeriesModule",t),{imageOrientationPatient:i,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:l}=ce.metaData.get("imagePlaneModule",t),c={modality:n,imageOrientationPatient:i,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:l,seriesInstanceUID:r},u=e.every(e=>{const{modality:t,seriesInstanceUID:n}=ce.metaData.get("generalSeriesModule",e),{imageOrientationPatient:r,pixelSpacing:i,columns:o,rows:a}=ce.metaData.get("imagePlaneModule",e);return n===c.seriesInstanceUID&&t===c.modality&&o===c.columns&&a===c.rows&&(0,D.ZP)(r,c.imageOrientationPatient)&&(0,D.ZP)(i,c.pixelSpacing)});return u}function Ke(e,t){const n=t.getPixelData();if(!e.getPointData)return;const r=e.getPointData().getScalars().getData();if(t.color&&t.rgba){const e=new Uint8Array(t.columns*t.rows*3);for(let r=0;r<t.columns*t.rows;r++)e[3*r]=n[4*r],e[3*r+1]=n[4*r+1],e[3*r+2]=n[4*r+2];t.rgba=!1,t.getPixelData=()=>e,r.set(e)}else r.set(n);e.modified()}class $e{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const t=new $e("as iterator");return e.then(e=>{try{t.add(e,!0)}catch(e){t.reject(e)}},e=>t.reject(e)),t}add(e,t=!1){this.nextValue=e,this.done||=t,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(void 0!==this.nextValue&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,t)=>{this.waiting.resolve=e,this.waiting.reject=t})),await this.waiting.promise}yield this.nextValue}async forEach(e,t){let n=0;try{for await(const r of this){const{done:i}=this;try{await e(r,i,n),n++}catch(e){if(!i){console.warn("Caught exception in intermediate value",e);continue}if(!t)throw e;t(e,i)}}}catch(e){if(!t)throw e;t(e,!0)}}generate(e,t){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},e=>{this.reject(e),t?t(e):console.warn("Couldn't process because",e)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}}function qe(e,t,n=0){const r=[];for(let i=n;i<e.length;i+=t)r.push(i);return r}const Xe=new Map,Ye="imageRetrieveConfiguration",Je={IMAGE_RETRIEVE_CONFIGURATION:Ye,clear:()=>{Xe.clear()},add:(e,t)=>{Xe.set(e,t)},get:(e,...t)=>{if(e===Ye)return t.map(e=>Xe.get(e)).find(e=>void 0!==e)}};(0,U.addProvider)(Je.get.bind(Je));const Qe=Je,et=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function tt(e){if(!e)return!1;return(Array.isArray(e)?e:[e]).find(e=>et.has(e))}function nt(e,t,n={}){const{use16BitTexture:r=!1,isVolumeBuffer:i=!1}=n;switch(e){case"Float32Array":return{numBytes:4*t,TypedArrayConstructor:Float32Array};case"Uint8Array":return{numBytes:t,TypedArrayConstructor:Uint8Array};case"Uint16Array":return i?r?{numBytes:2*t,TypedArrayConstructor:Uint16Array}:(console.warn("Uint16Array is not supported for volume rendering, switching back to Float32Array"),{numBytes:4*t,TypedArrayConstructor:Float32Array}):{numBytes:2*t,TypedArrayConstructor:Uint16Array};case"Int16Array":return i?r?{numBytes:2*t,TypedArrayConstructor:Int16Array}:(console.warn("Int16Array is not supported for volume rendering, switching back to Float32Array"),{numBytes:4*t,TypedArrayConstructor:Float32Array}):{numBytes:2*t,TypedArrayConstructor:Int16Array};default:if(e)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, or Int16Array");return{numBytes:4*t,TypedArrayConstructor:Float32Array}}}const rt=e=>Object.values(e).some(e=>"number"==typeof e&&!Number.isInteger(e));function it(e,t){const{useNorm16Texture:n,preferSizeOverAccuracy:r}=(0,P.P_)().rendering,i=n||r,o=We(e),a=Fe(e[Math.floor(e.length/2)]),s=a.rescaleIntercept<0||a.rescaleSlope<0,l=rt(a),c=(0,P.uz)(),{BitsAllocated:u,PixelRepresentation:d,PhotometricInterpretation:p,ImageOrientationPatient:h,PixelSpacing:f,Columns:m,Rows:g}=o,v=V.R3.fromValues(h[0],h[1],h[2]),y=V.R3.fromValues(h[3],h[4],h[5]),b=V.R3.create();V.R3.cross(b,v,y);const{zSpacing:C,origin:w,sortedImageIds:E}=Ge(e,b),T=e.length,x=[f[1],f[0],C],_=[m,g,T],S=[...v,...y,...b],I=1===d,D="RGB"===p?3:1,A=(0,P.hG)(),R=_[0]*_[1]*_[2],F=e=>{if(!k.ZP.isCacheable(e))throw new Error(J.Events.CACHE_SIZE_EXCEEDED);k.ZP.decacheIfNecessaryUntilBytesAvailable(e)};let U,B;switch(u){case 8:if(I)throw new Error("8 Bit signed images are not yet supported by this plugin.");B=R*D,F(B),U=A?O(R*D):new Uint8Array(R*D);break;case 16:if(!i||c&&l){B=4*R,U=A?M(R):new Float32Array(R);break}if(B=2*R,I||s){F(B),U=A?L(R):new Int16Array(R);break}if(!I&&!s){F(B),U=A?N(R):new Uint16Array(R);break}B=4*R,F(B),U=A?M(R):new Float32Array(R);break;case 24:B=R*D,F(B),U=A?O(R*D):new Uint8Array(R*D);break;case 32:B=4*R,F(B),U=A?M(R):new Float32Array(R);break;default:throw new Error(`Bits allocated of ${u} is not defined to generate scalarData for the volume.`)}return{dimensions:_,spacing:x,origin:w,direction:S,scalarData:U,sizeInBytes:B,metadata:o,imageIds:E,volumeId:t}}var ot=n(25281),at=n(18588);async function st({viewport:e,options:t}){const n=e.getRenderingEngine();let{volumeId:r}=t;if(1===r.split(":").length){r=`${(0,at.getUnknownVolumeLoaderSchema)()}:${r}`}const{id:i,element:o}=e,a=t.viewportId||i,s=e.getImageIds(),l=e.getCamera();n.enableElement({viewportId:a,type:J.ViewportType.ORTHOGRAPHIC,element:o,defaultOptions:{background:t.background,orientation:t.orientation}});(await(0,at.createAndCacheVolume)(r,{imageIds:s})).load();const c=n.getViewport(a);(0,ot.tX)(n,[{volumeId:r}],[a]);const u=()=>{t.orientation||c.setCamera({...l}),c.render(),o.removeEventListener(J.Events.VOLUME_VIEWPORT_NEW_VOLUME,u)};return o.addEventListener(J.Events.VOLUME_VIEWPORT_NEW_VOLUME,u),c.render(),c}async function lt({viewport:e,options:t}){const n=e,{id:r,element:i}=n,o=e.getRenderingEngine(),a=e.getCurrentImageIdIndex(),{background:s}=t,l=t.viewportId||r,c=n.getDefaultActor(),{uid:u}=c,d=k.ZP.getVolume(u);if(!(d instanceof k.JI))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const p={viewportId:l,type:J.ViewportType.STACK,element:i,defaultOptions:{background:s}};o.enableElement(p);const h=o.getViewport(l);let f=!1;d.imageCacheOffsetMap.size>0&&(f=d.imageIds.every(e=>k.ZP.getImage(e)));const m=o.getVolumeViewports().find(e=>e.hasVolumeId(u));d.decache(!m&&f);const g=[...d.imageIds].reverse();let v=Math.max(d.imageIds.length-a-1,0);if(!k.ZP.getImage(g[v])){let e=1/0,t=null;g.forEach((n,r)=>{if(k.ZP.getImage(n)){const n=Math.abs(v-r);n<e&&(e=n,t=r)}}),v=t}return await h.setStack(g,v??0),h.render(),h}class ct{constructor(e,t,n=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.defaultValue=0,this.pixelDataConstructor=Uint8Array,this.get=e=>{const t=e%this.jMultiple,n=(e-t)/this.jMultiple,r=this.getRLE(t,n);return r?.value||this.defaultValue},this.getRun=(e,t)=>{const n=e+t*this.height;return this.rows.get(n)},this.set=(e,t)=>{if(void 0===t)throw new Error("Can't set undefined at "+e%this.width);const n=e%this.width,r=(e-n)/this.width,i=this.rows.get(r);if(!i)return void this.rows.set(r,[{start:n,end:n+1,value:t}]);const o=this.findIndex(i,n),a=i[o],s=i[o-1];if(!a)return s&&s.value===t&&s.end===n?void s.end++:void(i[o]={start:n,end:n+1,value:t});const{start:l,end:c,value:u}=a;if(t===u&&n>=l)return;const d={start:n,end:n+1,value:t},p=n>l,h=p?o+1:o,f=p?a:s;let m=p?i[o+1]:a;if(f?.value===t&&f?.end===n)return f.end++,void(m?.value===t&&m.start===n+1?(f.end=m.end,i.splice(o,1)):m?.start===n&&(m.start++,m.start===m.end&&(i.splice(o,1),m=i[o],m?.start===n+1&&m.value===t&&(f.end=m.end,i.splice(o,1)))));if(m?.value===t&&m.start===n+1)return m.start--,void(f?.end>n&&(f.end=n,f.end===f.start&&i.splice(o,1)));if(m?.start===n&&m.end===n+1){m.value=t;const e=i[o+1];return void(e?.start==n+1&&e.value===t&&(i.splice(o+1,1),m.end=e.end))}n===m?.start&&m.start++,p&&c>n+1?i.splice(h,0,d,{start:n+1,end:f.end,value:f.value}):i.splice(h,0,d),f?.end>n&&(f.end=n)},this.width=e,this.height=t,this.depth=n,this.jMultiple=e,this.kMultiple=this.jMultiple*t}getRLE(e,t,n=0){const r=this.rows.get(t+n*this.height);if(!r)return;const i=r[this.findIndex(r,e)];return e>=i?.start?i:void 0}findIndex(e,t){for(let n=0;n<e.length;n++){const{end:r}=e[n];if(t<r)return n}return e.length}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,t){t?t.fill(0):t=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:n,height:r,numComps:i}=this;for(let o=0;o<r;o++){const r=this.getRun(o,e);if(r)if(1===i)for(const e of r){const r=o*n,{start:i,end:a,value:s}=e;for(let e=i;e<a;e++)t[r+e]=s}else for(const e of r){const r=o*n*i,{start:a,end:s,value:l}=e;for(let e=a;e<s;e+=i)for(let n=0;n<i;n++)t[r+e+n]=l[n]}}return t}}class ut{constructor(e,t,n){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.numComps=1,this.getAtIJK=(e,t,n)=>{const r=e+t*this.width+n*this.frameSize;return this._get(r)},this.setAtIJK=(e,t,n,r)=>{const i=e+t*this.width+n*this.frameSize;!1!==this._set(i,r)&&(this.modifiedSlices.add(n),ut.addBounds(this.boundsIJK,[e,t,n]))},this.getAtIJKPoint=([e,t,n])=>this.getAtIJK(e,t,n),this.setAtIJKPoint=([e,t,n],r)=>this.setAtIJK(e,t,n,r),this.getAtIndex=e=>this._get(e),this.setAtIndex=(e,t)=>{if(!1!==this._set(e,t)){const t=this.toIJK(e);this.modifiedSlices.add(t[2]),ut.addBounds(this.boundsIJK,t)}},this.forEach=(e,t)=>{const n=t?.boundsIJK||this.getBoundsIJK(),{isWithinObject:r}=t||{};if(this.map)for(const t of this.map.keys()){const n=this.toIJK(t),i={value:this._get(t),index:t,pointIJK:n};!1!==r?.(i)&&e(i)}else for(let t=n[2][0];t<=n[2][1];t++){const i=t*this.frameSize;for(let o=n[1][0];o<=n[1][1];o++){const a=i+o*this.width;for(let i=n[0][0],s=a+i;i<=n[0][1];i++,s++){const n={value:this.getAtIndex(s),index:s,pointIJK:[i,o,t]};!1!==r?.(n)&&e(n)}}}},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=t,this._set=n}addPoint(e){const t=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(t)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}getPointIndices(){return this.points?[...this.points]:[]}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.dimensions.map(e=>[0,e-1])}clear(){this.map&&this.map.clear(),this.boundsIJK.map(e=>{e[0]=1/0,e[1]=-1/0}),this.modifiedSlices.clear(),this.points?.clear()}getArrayOfSlices(){return Array.from(this.modifiedSlices)}static addBounds(e,t){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(t[0],e[0][0]),e[0][1]=Math.max(t[0],e[0][1]),e[1][0]=Math.min(t[1],e[1][0]),e[1][1]=Math.max(t[1],e[1][1]),e[2][0]=Math.min(t[2],e[2][0]),e[2][1]=Math.max(t[2],e[2][1])}static createRGBVolumeVoxelManager(e,t,n){const r=new ut(e,e=>(e*=n,[t[e++],t[e++],t[e++]]),(e,n)=>{e*=3;const r=!(0,D.ZP)(t[e],n);return t[e++]=n[0],t[e++]=n[1],t[e++]=n[2],r});return r.numComps=n,r.scalarData=t,r}static createVolumeVoxelManager(e,t,n=0){if(3!==e.length)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!n&&((n=t.length/e[0]/e[1]/e[2])>4||n<1||2===n))throw new Error(`Number of components ${n} must be 1, 3 or 4`);return n>1?ut.createRGBVolumeVoxelManager(e,t,n):ut.createNumberVolumeVoxelManager(e,t)}static createNumberVolumeVoxelManager(e,t){const n=new ut(e,e=>t[e],(e,n)=>{const r=t[e]!==n;return t[e]=n,r});return n.scalarData=t,n}static createMapVoxelManager(e){const t=new Map,n=new ut(e,t.get.bind(t),(e,n)=>t.set(e,n)&&!0);return n.map=t,n}static createHistoryVoxelManager(e){const t=new Map,{dimensions:n}=e,r=new ut(n,e=>t.get(e),function(e,n){if(t.has(e))n===t.get(e)&&t.delete(e);else{const r=this.sourceVoxelManager.getAtIndex(e);if(r===n)return!1;t.set(e,r)}this.sourceVoxelManager.setAtIndex(e,n)});return r.map=t,r.scalarData=e.scalarData,r.sourceVoxelManager=e,r}static createLazyVoxelManager(e,t){const n=new Map,[r,i,o]=e,a=r*i,s=new ut(e,e=>n.get(Math.floor(e/a))?.[e%a],(e,o)=>{const s=Math.floor(e/a);let l=n.get(s);l||(l=t(r,i),n.set(s,l)),l[e%a]=o});return s.map=n,s}static createRLEVoxelManager(e){const[t,n,r]=e,i=new ct(t,n,r),o=new ut(e,e=>i.get(e),(e,t)=>i.set(e,t));return o.map=i,o.getPixelData=i.getPixelData.bind(i),o}static addInstanceToImage(e){const{width:t,height:n}=e,r=e.getPixelData();r?.length>=t*n?e.voxelManager=ut.createVolumeVoxelManager([t,n,1],r):(e.voxelManager=ut.createRLEVoxelManager([t,n,1]),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=5120)}}function dt(e){return Math.round(e/G.EPSILON)*G.EPSILON}const pt=function e(t,n=2){if(Array.isArray(t))return t.map(t=>e(t,n)).join(", ");if(null==t||""===t)return"NaN";t=Number(t);const r=Math.abs(t);if(r<1e-4)return`${t}`;const i=r>=100?n-2:r>=10?n-1:r>=1?n:r>=.1?n+1:r>=.01?n+2:r>=.001?n+3:n+4;return t.toFixed(i)};function ht(e,t,n){const r=e.length===t*n*4,i=e.length===t*n*3;if(r||i){const i=new Float32Array(t*n);let o=0,a=0;const s=r?4:3;for(let r=0;r<t;r++)for(let t=0;t<n;t++){const t=e[o],n=e[o+1],r=e[o+2];i[a]=(t+n+r)/3,o+=s,a++}return i}return e}const ft=function(e){if(e instanceof te.kA){const t=e.getDefaultActor().uid;return k.ZP.getVolume(t).imageIds}if(e.getImageIds)return e.getImageIds()};function mt(e,t){const n=[...e];return t>=n.length?(gt(n),n):(gt(n),n.slice(0,t))}function gt(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}var vt=n(77059);function yt(e,t,n){const[r,i,o]=e,[a,s,l]=t,[c,u,d,p]=n,h=a-r,f=s-i,m=l-o,g=-1*(c*r+u*i+d*o-p)/(c*h+u*f+d*m);return[h*g+r,f*g+i,m*g+o]}function bt(e,t,n=!1){const[r,i,o]=e,a=r*t[0]+i*t[1]+o*t[2];if(n){const e=Math.sqrt(r*r+i*i+o*o);return[r/e,i/e,o/e,a/e]}return[r,i,o,a]}function Ct(e,t,n){const[r,i,o,a]=e,[s,l,c,u]=t,[d,p,h,f]=n,m=V.wO.fromValues(r,s,d,i,l,p,o,c,h),g=V.wO.fromValues(a,u,f,i,l,p,o,c,h),v=V.wO.fromValues(r,s,d,a,u,f,o,c,h),y=V.wO.fromValues(r,s,d,i,l,p,a,u,f);return[V.wO.determinant(g)/V.wO.determinant(m),V.wO.determinant(v)/V.wO.determinant(m),V.wO.determinant(y)/V.wO.determinant(m)]}function wt(e,t,n=!1){const[r,i,o,a]=e,[s,l,c]=t,u=r*s+i*l+o*c-a,d=Math.abs(u)/Math.sqrt(r*r+i*i+o*o);return(n?Math.sign(u):1)*d}var Et=n(40589),Tt=n(54526),xt=n(85654);function _t(e){const t=e.toString(16);return 1==t.length?"0"+t:t}function St(e,t,n){return"#"+_t(e)+_t(t)+_t(n)}function It(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},78001:(e,t,n)=>{"use strict";function r(e,t,n){return Math.abs(e-t)<=n}function i(e){return"number"==typeof e}function o(e){return"length"in e&&"number"==typeof e[0]}function a(e,t,n=1e-5){return typeof e==typeof t&&null!==e&&null!==t&&(i(e)&&i(t)?r(e,t,n):!(!o(e)||!o(t))&&function(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!r(e[i],t[i],n))return!1;return!0}(e,t,n))}n.d(t,{QG:()=>u,Xy:()=>a,ZP:()=>a,aw:()=>c});const s=e=>"number"==typeof e?-e:e?.map?e.map(s):!e,l=e=>"number"==typeof e?Math.abs(e):e?.map?e.map(l):e,c=(e,t,n=void 0)=>a(e,s(t),n),u=(e,t,n=void 0)=>a(l(e),l(t),n)},19383:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]]},69562:(e,t,n)=>{"use strict";n(19383)},23118:(e,t,n)=>{"use strict";n.d(t,{hideElementCursor:()=>l,initElementCursor:()=>o,resetElementCursor:()=>s});var r=n(60020);const i=Symbol("ElementCursorsMap");function o(e,t){c(e)[0]=t,a(e,t)}function a(e,t){const n=c(e);n[1]=n[0],n[0]=t,e.style.cursor=(t instanceof r.MouseCursor?t:r.MouseCursor.getDefinedCursor("auto")).getStyleProperty()}function s(e){a(e,c(e)[1])}function l(e){a(e,r.MouseCursor.getDefinedCursor("none"))}function c(e){let t=c[i];t instanceof WeakMap||(t=new WeakMap,Object.defineProperty(c,i,{value:t}));let n=t.get(e);return n||(n=[null,null],t.set(e,n)),n}},60020:(e,t,n)=>{"use strict";n.d(t,{MouseCursor:()=>o,SVGMouseCursor:()=>m});const r=Symbol("DefinedCursors"),i=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class o{constructor(e,t){this.name=e+"",this.fallback=t}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:t}=this;return t instanceof o?`${e}, ${t.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const t=a(o,r);let n=t.get(e);return n instanceof o?n:i.has(e)?(n=new o(e),t.set(e,n),n):void 0}static setDefinedCursor(e,t){if(t instanceof o){return a(o,r).set(e,t),!0}return!1}}function a(e,t){let n=e[t];return n instanceof Map||(n=new Map,Object.defineProperty(e,t,{value:n})),n}const s=i.values();var l=n(62709);class c extends o{constructor(e,t,n,r,i){super(r||c.getUniqueInstanceName("image-cursor"),i),this.url=e,this.x=Number(t)||0,this.y=Number(n)||0}getStyleProperty(){const{url:e,x:t,y:n}=this;let r=`url('${e}')`;return t>=0&&n>=0&&(t>0||n>0)&&(r+=` ${t} ${n}`),this.addFallbackStyleProperty(r)}static getUniqueInstanceName(e){return`${e}-${l.utilities.getRuntimeId(c)}`}}var u=n(68096),d=n(77267),p=n(58429);const h=u.AnnotationStyleStates.Highlighted,f=u.ToolModes.Active;class m extends c{constructor(e,t,n,r,i){super(e,t,n,r,i)}static getDefinedCursor(e,t=!1,n){n||(n=(0,p.$)("color",{},h,f));const r=function(e,t,n){const r=t?"pointer":"cursor";return`${r}:${e}/${n}`}(e,t,n);let i=super.getDefinedCursor(r);if(!i){const o=(0,d.zu)(e);o&&(i=function(e,t,n,r,i){const{x:o,y:a}=e.mousePoint;return new m(function(e,t,n){return URL.createObjectURL(function(e,t,n){const r=(t?y:v)(e,n);return new Blob([r],{type:"image/svg+xml"})}(e,t,n))}(e,n,{color:r}),o,a,t,i)}(o,r,t,n,super.getDefinedCursor("default")),super.setDefinedCursor(r,i))}return i}}function g(e,t){const n=Object(t),r=Object.prototype.hasOwnProperty.bind(n);return(e+"").replace(/\{\{(\w+)\}\}/g,(e,t)=>r(t)?n[t]+"":"")}function v(e,t){const{iconContent:n,iconSize:r,viewBox:i}=e;return g(`\n    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n      width="${r}" height="${r}" viewBox="0 0\n      ${i.x} ${i.y}">\n      ${n}\n    </svg>`,t)}function y(e,t){const{iconContent:n,iconSize:r,viewBox:i,mousePointerGroupString:o}=e,a=16+r;return g(`\n    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n      width="${a}" height="${a}" viewBox="0 0 ${a} ${a}">\n      <g>${o}</g>\n      <g transform="translate(16, 16) scale(${r/Math.max(i.x,i.y,1)})">${n}</g>\n    </svg>`,t)}n(23118);d.Sz},86785:(e,t,n)=>{"use strict";n.d(t,{draw:()=>r.Z,drawArrow:()=>E,drawCircle:()=>s,drawEllipseByCoordinates:()=>l,drawHandle:()=>c,drawHandles:()=>u,drawLine:()=>d,drawLinkedTextBox:()=>b,drawPath:()=>h,drawPolyline:()=>p,drawRect:()=>w,drawRectByCoordinates:()=>C,drawRedactionRect:()=>T,drawTextBox:()=>g});var r=n(10424);const i=function(e,t,n){return`${e}::${t}::${n}`};const o=function(e,t){Object.keys(e).forEach(n=>{const r=t.getAttribute(n),i=e[n];void 0===i||""===i?t.removeAttribute(n):r!==i&&t.setAttribute(n,i)})};const a=function(e,t){Object.keys(e).forEach(n=>{const r=e[n];void 0!==r&&""!==r&&t.setAttribute(n,r)})};const s=function(e,t,n,r,s,l={},c=""){const{color:u,fill:d,width:p,lineWidth:h,lineDash:f,fillOpacity:m,strokeOpacity:g}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},l),v=h||p,y=i(t,"circle",n),b=e.getSvgNode(y),C={cx:`${r[0]}`,cy:`${r[1]}`,r:`${s}`,stroke:u,fill:d,"stroke-width":v,"stroke-dasharray":f,"fill-opacity":m,"stroke-opacity":g};if(b)o(C,b),e.setNodeTouched(y);else{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");""!==c&&t.setAttribute("data-id",c),a(C,t),e.appendNode(t,y)}};const l=function(e,t,n,r,s={},l=""){const{color:c,width:u,lineWidth:d,lineDash:p}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},s),h=d||u,f=i(t,"ellipse",n),m=e.getSvgNode(f),[g,v,y,b]=r,C=Math.hypot(y[0]-b[0],y[1]-b[1]),w=Math.hypot(v[0]-g[0],v[1]-g[1]),E=180*Math.atan2(y[1]-b[1],y[0]-b[0])/Math.PI,T=[(y[0]+b[0])/2,(v[1]+g[1])/2],x={cx:`${T[0]}`,cy:`${T[1]}`,rx:`${C/2}`,ry:`${w/2}`,stroke:c,fill:"transparent",transform:`rotate(${E} ${T[0]} ${T[1]})`,"stroke-width":h,"stroke-dasharray":p};if(m)o(x,m),e.setNodeTouched(f);else{const t=document.createElementNS("http://www.w3.org/2000/svg","ellipse");""!==l&&t.setAttribute("data-id",l),a(x,t),e.appendNode(t,f)}};const c=function(e,t,n,r,s={},l){const{color:c,handleRadius:u,width:d,lineWidth:p,fill:h,type:f,opacity:m}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},s),g=p||d,v=i(t,"handle",`hg-${n}-index-${l}`);let y;if("circle"===f)y={cx:`${r[0]}`,cy:`${r[1]}`,r:u,stroke:c,fill:h,"stroke-width":g,opacity:m};else{if("rect"!==f)throw new Error(`Unsupported handle type: ${f}`);{const e=1.5*parseFloat(u);y={x:`${r[0]-.5*e}`,y:`${r[1]-.5*e}`,width:`${e}`,height:`${e}`,stroke:c,fill:h,"stroke-width":g,rx:""+.1*e,opacity:m}}}const b=e.getSvgNode(v);if(b)o(y,b),e.setNodeTouched(v);else{const t=document.createElementNS("http://www.w3.org/2000/svg",f);a(y,t),e.appendNode(t,v)}};const u=function(e,t,n,r,i={}){r.forEach((r,o)=>{c(e,t,n,r,i,o)})};function d(e,t,n,r,s,l={},c=""){if(isNaN(r[0])||isNaN(r[1])||isNaN(s[0])||isNaN(s[1]))return;const{color:u,width:d,lineWidth:p,lineDash:h,shadow:f}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0,shadow:void 0},l),m=p||d,g=i(t,"line",n),v=e.getSvgNode(g),y=f?`filter:url(#shadow-${e.svgLayerElement.id});`:"",b={x1:`${r[0]}`,y1:`${r[1]}`,x2:`${s[0]}`,y2:`${s[1]}`,stroke:u,style:y,"stroke-width":m,"stroke-dasharray":h};if(v)o(b,v),e.setNodeTouched(g);else{const t=document.createElementNS("http://www.w3.org/2000/svg","line");""!==c&&t.setAttribute("data-id",c),a(b,t),e.appendNode(t,g)}}function p(e,t,n,r,s){if(r.length<2)return;const{color:l="rgb(0, 255, 0)",width:c=10,fillColor:u="none",fillOpacity:d=0,lineWidth:p,lineDash:h,closePath:f=!1}=s,m=p||c,g=i(t,"polyline",n),v=e.getSvgNode(g);let y="";for(const e of r)y+=`${e[0].toFixed(1)}, ${e[1].toFixed(1)} `;if(f){const e=r[0];y+=`${e[0]}, ${e[1]}`}const b={points:y,stroke:l,fill:u,"fill-opacity":d,"stroke-width":m,"stroke-dasharray":h};if(v)o(b,v),e.setNodeTouched(g);else{const t=document.createElementNS("http://www.w3.org/2000/svg","polyline");a(b,t),e.appendNode(t,g)}}function h(e,t,n,r,s){const l=r.length&&r[0].length&&Array.isArray(r[0][0])?r:[r],{color:c="rgb(0, 255, 0)",width:u=10,fillColor:d="none",fillOpacity:p=0,lineWidth:h,lineDash:f,closePath:m=!1}=s,g=h||u,v=i(t,"path",n),y=e.getSvgNode(v);let b="";for(let e=0,t=l.length;e<t;e++){const t=l[e],n=t.length;if(!(n<2)){for(let e=0;e<n;e++){const n=t[e];b+=`${e?"L":"M"} ${n[0].toFixed(1)}, ${n[1].toFixed(1)} `}m&&(b+="Z ")}}if(!b)return;const C={d:b,stroke:c,fill:d,"fill-opacity":p,"stroke-width":g,"stroke-dasharray":f};if(y)o(C,y),e.setNodeTouched(v);else{const t=document.createElementNS("http://www.w3.org/2000/svg","path");a(C,t),e.appendNode(t,v)}}function f(e){const t=document.createElementNS("http://www.w3.org/2000/svg","tspan");return t.setAttribute("x","0"),t.setAttribute("dy","1.2em"),t.textContent=e,t}function m(e,t){let n=e.querySelector("rect.background");if(!t)return n&&e.removeChild(n),e.getBBox();n||(n=document.createElementNS("http://www.w3.org/2000/svg","rect"),n.setAttribute("class","background"),e.insertBefore(n,e.firstChild));const r=e.getBBox(),i={x:`${r.x}`,y:`${r.y}`,width:`${r.width}`,height:`${r.height}`,fill:t};return o(i,n),r}const g=function(e,t,n,r,a,s={}){return function(e,t,n,r=[""],a,s){const{padding:l,color:c,fontFamily:u,fontSize:d,background:p}=s;let h;const[g,v]=[a[0]+l,a[1]+l],y="http://www.w3.org/2000/svg",b=i(t,"text",n),C=e.getSvgNode(b);if(C){const t=C.querySelector("text"),n=Array.from(t.children);for(let e=0;e<n.length;e++){const t=n[e],i=r[e]||"";t.textContent=i}if(r.length>n.length){for(let e=0;e<r.length-n.length;e++){const i=f(r[e+n.length]);t.appendChild(i)}C.appendChild(t),e.appendNode(C,b)}const i={transform:`translate(${g} ${v})`};o({fill:c,"font-size":d,"font-family":u},t),o(i,C),h=m(C,p),e.setNodeTouched(b)}else{const t=document.createElementNS(y,"g");t.setAttribute("transform",`translate(${g} ${v})`);const n=function(e,t){const{color:n,fontFamily:r,fontSize:i}=t,o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",l=`filter:url(#shadow-${e.svgLayerElement.id});`,c=`${s}${l}`;return a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("fill",n),a.setAttribute("font-family",r),a.setAttribute("font-size",i),a.setAttribute("style",c),a}(e,s);for(let e=0;e<r.length;e++){const t=f(r[e]);n.appendChild(t)}t.appendChild(n),e.appendNode(t,b),h=m(t,p)}return Object.assign({},h,{x:g,y:v,height:h.height+l,width:h.width+l})}(e,t,n,r,a,Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},s))};var v=n(78924);const y=function(e,t,n,r,i,o,a={}){const s=r.length>0?(0,v.Z)(r,i):i,l=function(e){const{x:t,y:n,height:r,width:i}=e,o=i/2,a=r/2;return[[t+o,n],[t,n+a],[t+o,n+r],[t+i,n+a]]}(o);d(e,t,`link-${n}`,s,(0,v.Z)(l,s),Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},a))};const b=function(e,t,n,r,i,o,a,s={}){const l=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),c=g(e,t,n,r,i,l);return y(e,t,n,o,i,c,l),c};function C(e,t,n,r,s={},l=""){const{color:c,width:u,lineWidth:d,lineDash:p}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},s),h=d||u,f=i(t,"rect",n),m=e.getSvgNode(f),[g,v,y,b]=r,C=Math.hypot(g[0]-v[0],g[1]-v[1]),w=Math.hypot(g[0]-y[0],g[1]-y[1]),E=[(b[0]+g[0])/2,(b[1]+g[1])/2],T=[(y[0]+g[0])/2,(y[1]+g[1])/2],x=180*Math.atan2(E[1]-T[1],E[0]-T[0])/Math.PI,_={x:""+(E[0]-C/2),y:""+(E[1]-w/2),width:`${C}`,height:`${w}`,stroke:c,fill:"transparent",transform:`rotate(${x} ${E[0]} ${E[1]})`,"stroke-width":h,"stroke-dasharray":p};if(m)o(_,m),e.setNodeTouched(f);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");""!==l&&t.setAttribute("data-id",l),a(_,t),e.appendNode(t,f)}}function w(e,t,n,r,i,o={},a=""){C(e,t,n,[[r[0],r[1]],[i[0],r[1]],[r[0],i[1]],[i[0],i[1]]],o,a)}function E(e,t,n,r,i,o={}){if(isNaN(r[0])||isNaN(r[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:a,width:s,lineWidth:l,lineDash:c}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o);d(e,t,n,r,i,{color:a,width:s,lineWidth:l,lineDash:c});const u=Math.atan2(i[1]-r[1],i[0]-r[0]),p={start:[i[0]-10*Math.cos(u-Math.PI/7),i[1]-10*Math.sin(u-Math.PI/7)],end:i},h={start:[i[0]-10*Math.cos(u+Math.PI/7),i[1]-10*Math.sin(u+Math.PI/7)],end:i};d(e,t,`${parseInt(n)+1}`,p.start,p.end,{color:a,width:s,lineWidth:l}),d(e,t,`${parseInt(n)+2}`,h.start,h.end,{color:a,width:s,lineWidth:l})}function T(e,t,n,r,s,l={}){const{color:c,width:u,lineWidth:d,lineDash:p}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},l),h=d||u,f=i(t,"rect",n),m=e.getSvgNode(f),g=[Math.min(r[0],s[0]),Math.min(r[1],s[1])],v=Math.abs(r[0]-s[0]),y=Math.abs(r[1]-s[1]),b={x:`${g[0]}`,y:`${g[1]}`,width:`${v}`,height:`${y}`,stroke:c,fill:"black","stroke-width":h,"stroke-dasharray":p};if(m)o(b,m),e.setNodeTouched(f);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");a(b,t),e.appendNode(t,f)}}},98806:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated"}(r||(r={}));const i=r},34539:(e,t,n)=>{"use strict";var r;n.d(t,{default:()=>i}),function(e){e.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",e.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",e.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",e.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",e.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(r||(r={}));const i=r},74297:(e,t,n)=>{"use strict";var r;n.d(t,{default:()=>i}),function(e){e.Labelmap="LABELMAP",e.Contour="CONTOUR",e.Surface="SURFACE"}(r||(r={}));const i=r},39708:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>i}),function(e){e.OnInteractionStart="onInteractionStart",e.OnInteractionEnd="onInteractionEnd",e.Preview="preview",e.RejectPreview="rejectPreview",e.AcceptPreview="acceptPreview",e.Fill="fill",e.StrategyFunction="strategyFunction",e.CreateIsInThreshold="createIsInThreshold",e.CreateIsTargetSegment="createIsTargetSegment",e.Initialize="initialize",e.INTERNAL_setValue="setValue",e.ComputeInnerCircleRadius="computeInnerCircleRadius"}(r||(r={}));const i=r},24041:(e,t,n)=>{"use strict";var r;n.d(t,{o:()=>r}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(r||(r={}))},68096:(e,t,n)=>{"use strict";var r,i;n.d(t,{AnnotationStyleStates:()=>s,ChangeTypes:()=>p.Z,Events:()=>c.default,KeyboardBindings:()=>i,MouseBindings:()=>r,SegmentationRepresentations:()=>u.default,StrategyCallbacks:()=>d.Z,ToolModes:()=>a.default,WorkerTypes:()=>h}),function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button"}(r||(r={})),function(e){e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta",e[e.ShiftCtrl=1617]="ShiftCtrl",e[e.ShiftAlt=1618]="ShiftAlt",e[e.ShiftMeta=1691]="ShiftMeta",e[e.CtrlAlt=1718]="CtrlAlt",e[e.CtrlMeta=1791]="CtrlMeta",e[e.AltMeta=1891]="AltMeta"}(i||(i={}));var o,a=n(22712);!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked",e.AutoGenerated="AutoGenerated"}(o||(o={}));const s=o;var l,c=n(34539),u=n(74297),d=(n(24041),n(39708)),p=n(98806);!function(e){e.POLYSEG_CONTOUR_TO_LABELMAP="polySeg/convertContourToVolumeLabelmap",e.POLYSEG_SURFACE_TO_LABELMAP="polySeg/convertSurfacesToVolumeLabelmap",e.POLYSEG_CONTOUR_TO_SURFACE="polySeg/convertContourToSurface",e.POLYSEG_LABELMAP_TO_SURFACE="polySeg/convertLabelmapToSurface",e.SURFACE_CLIPPING="surfaceClipping"}(l||(l={}));const h=l},57864:(e,t,n)=>{"use strict";n(62709),n(64307);n(34539);var r=n(33232),i=n(22712);const{Active:o}=i.default;function a(e,t,n){if(r.SB.isInteractingWithTool)return!1;const{renderingEngineId:i,viewportId:a}=n.detail,s=r.fT.getToolGroupForViewport(a,i);if(!s)return!1;let l;const c=Object.keys(s.toolOptions);for(let e=0;e<c.length;e++){const n=c[e],r=s.toolOptions[n],i=s.getToolInstance(n);if(r.mode===o&&"function"==typeof i[t]){l=s.getToolInstance(n);break}}l&&l[t](n)}a.bind(null,"Mouse","mouseClickCallback"),a.bind(null,"Mouse","doubleClickCallback");var s=n(68096);n(91398),n(11163),n(41836);n(80769);n(62486),n(19197);const{Active:l}=s.ToolModes;const{Active:c,Passive:u}=s.ToolModes;const{Active:d,Passive:p}=s.ToolModes;const{Active:h,Passive:f}=s.ToolModes;a.bind(null,"Mouse","mouseUpCallback"),a.bind(null,"MouseWheel","mouseWheelCallback");n(82695);const{Active:m}=s.ToolModes;n(40218);const{Active:g,Passive:v,Enabled:y}=s.ToolModes,{Active:b,Passive:C,Enabled:w}=s.ToolModes,{Active:E}=s.ToolModes;const{Active:T,Passive:x}=s.ToolModes;a.bind(null,"Touch","touchEndCallback"),a.bind(null,"Touch","touchTapCallback"),a.bind(null,"Touch","touchPressCallback");n(7966);const{Active:_,Passive:S,Enabled:I}=s.ToolModes},19197:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(68096);const i=e=>e.shiftKey?e.ctrlKey?r.KeyboardBindings.ShiftCtrl:e.altKey?r.KeyboardBindings.ShiftAlt:e.metaKey?r.KeyboardBindings.ShiftMeta:r.KeyboardBindings.Shift:e.ctrlKey?e.altKey?r.KeyboardBindings.CtrlAlt:e.metaKey?r.KeyboardBindings.CtrlMeta:r.KeyboardBindings.Ctrl:e.altKey?e.metaKey&&r.KeyboardBindings.AltMeta||r.KeyboardBindings.Alt:e.metaKey?r.KeyboardBindings.Meta:void 0},72362:(e,t,n)=>{"use strict";n.d(t,{h:()=>d});var r=n(62709),i=(n(22319),n(79454)),o=n(46966),a=n(86614),s=n(11203),l=n(59865);n(33232),n(27446),n(46915),n(36705);const c="PlanarFreehandContourSegmentationTool";function u(e,t){const n=e.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=t.worldToCanvas(e[i]);return r}function d(e,t,n){const{windingDirection:d}=t.data.contour,{windingDirection:p}=n.data.contour;(0,a.addChildAnnotation)(t,n),l.removeContourSegmentationAnnotation(n);const{contour:h}=n.data,f=u(h.polyline,e);s.updateContourPolyline(n,{points:f,closed:h.closed},e);const{element:m}=e,g=(0,r.getEnabledElement)(m),{renderingEngine:v}=g,y=new Set([c,t.metadata.toolName,n.metadata.toolName]);for(const e of y.values()){const t=(0,o.getViewportIdsWithToolToRender)(m,e);(0,i.triggerAnnotationRenderForViewportIds)(v,t)}}},62486:(e,t,n)=>{"use strict";n.d(t,{Dz:()=>T});var r=n(62709),i=n(34539);n(90157);n(82695),n(932);const o=0,a=1;let s,l;function c(e,t){const n=Date.now();if(e!==s){if(n-l<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;s=e}l=n}c.bind(null,o),c.bind(null,a);n(24041);n(25068);r.Settings.getRuntimeSettings();const{TOUCH_START:u,TOUCH_START_ACTIVATE:d,TOUCH_PRESS:p,TOUCH_DRAG:h,TOUCH_END:f,TOUCH_TAP:m,TOUCH_SWIPE:g}=i.default,v={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},y={page:0,client:0,canvas:0,world:0},b={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...v,touch:null}],lastPointsList:[{...v,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:y,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},C={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...v,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};JSON.parse(JSON.stringify(b)),JSON.parse(JSON.stringify(C));var w=n(40218);function E(e){e.removeEventListener("keydown",w.ZP)}const T={enable:function(e){E(e),e.addEventListener("keydown",w.ZP)},disable:E,getModifierKey:w._5};n(31131);n(74297),n(60721),n(27078);n(32140);n(54131),n(8455),n(88439);new Map;n(59865),n(72362);n(79454);n(66878)},40218:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>f,_5:()=>p,bU:()=>h});var r=n(62709),i=n(11677),o=n.n(i),a=n(34539);const s={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let l={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function c(e){l.element=e.currentTarget;const t=(0,r.getEnabledElement)(l.element),{renderingEngineId:n,viewportId:i}=t;l.renderingEngineId=n,l.viewportId=i,l.key=e.key,l.keyCode=e.keyCode,e.preventDefault();const o={renderingEngineId:l.renderingEngineId,viewportId:l.viewportId,element:l.element,key:l.key,keyCode:l.keyCode};(0,r.triggerEvent)(o.element,a.default.KEY_DOWN,o),document.addEventListener("keyup",d),document.addEventListener("visibilitychange",u),l.element.removeEventListener("keydown",c)}function u(){document.removeEventListener("visibilitychange",u),"hidden"===document.visibilityState&&h()}function d(e){const t={renderingEngineId:l.renderingEngineId,viewportId:l.viewportId,element:l.element,key:l.key,keyCode:l.keyCode};document.removeEventListener("keyup",d),document.removeEventListener("visibilitychange",u),l.element.addEventListener("keydown",c),l=o()(s),(0,r.triggerEvent)(t.element,a.default.KEY_UP,t)}function p(){return l.keyCode}function h(){l.keyCode=void 0}const f=c},90157:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(62709);function i(e,t){const n=t||e.currentTarget,{viewport:i}=(0,r.getEnabledElement)(n),o=function(e){return[e.clientX,e.clientY]}(e),a=function(e){return[e.pageX,e.pageY]}(e),s=function(e,t){const n=e.getBoundingClientRect();return[t[0]-n.left-window.pageXOffset,t[1]-n.top-window.pageYOffset]}(n,a);return{page:a,client:o,canvas:s,world:i.canvasToWorld(s)}}},82695:(e,t,n)=>{"use strict";n.d(t,{UO:()=>D,ZP:()=>P,df:()=>A});var r=n(62709),i=n(34539),o=n(932),a=n(90157);const{MOUSE_DOWN:s,MOUSE_DOWN_ACTIVATE:l,MOUSE_CLICK:c,MOUSE_UP:u,MOUSE_DRAG:d}=i.default,p=3,h={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let f={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const m={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function g(e){const t=(0,a.Z)(e,f.element),n=_(f.element,f.lastPoints),i=S(t,n);if(m.doubleClickTimeout){if(!b(i.canvas))return;w()}const o={event:e,eventName:d,mouseButton:f.mouseButton,renderingEngineId:f.renderingEngineId,viewportId:f.viewportId,camera:{},element:f.element,startPoints:x(f.startPoints),lastPoints:x(n),currentPoints:t,deltaPoints:i};!(0,r.triggerEvent)(f.element,d,o)&&(e.stopImmediatePropagation(),e.preventDefault()),f.lastPoints=x(t)}function v(e){if(clearTimeout(f.preventClickTimeout),m.doubleClickTimeout)m.mouseUpEvent?T():(m.mouseUpEvent=e,f.element.addEventListener("mousemove",y));else{const t=f.isClickEvent?c:u,n=(0,a.Z)(e,f.element),i=S(n,f.lastPoints),o={event:e,eventName:t,mouseButton:f.mouseButton,element:f.element,renderingEngineId:f.renderingEngineId,viewportId:f.viewportId,camera:{},startPoints:x(f.startPoints),lastPoints:x(f.lastPoints),currentPoints:n,deltaPoints:i};(0,r.triggerEvent)(o.element,t,o),T()}document.removeEventListener("mousemove",g)}function y(e){b(S((0,a.Z)(e,f.element),_(f.element,f.lastPoints)).canvas)&&(w(),(0,o.Z)(e))}function b(e){return Math.abs(e[0])+Math.abs(e[1])>p}function C(){f.isClickEvent=!1}function w(){m.ignoreDoubleClick=!0;const e=m.mouseDownEvent,t=m.mouseUpEvent;E(),function(e){const t=S(f.startPoints,f.startPoints),n={event:e,eventName:s,element:f.element,mouseButton:f.mouseButton,renderingEngineId:f.renderingEngineId,viewportId:f.viewportId,camera:{},startPoints:f.startPoints,lastPoints:f.startPoints,currentPoints:f.startPoints,deltaPoints:t};f.lastPoints=x(n.lastPoints),(0,r.triggerEvent)(n.element,s,n)&&(0,r.triggerEvent)(n.element,l,n)}(e),t&&v(t)}function E(){m.doubleClickTimeout&&(clearTimeout(m.doubleClickTimeout),m.doubleClickTimeout=null),m.mouseDownEvent=null,m.mouseUpEvent=null}function T(){document.removeEventListener("mouseup",v),f.element?.removeEventListener("mousemove",y),f.element?.addEventListener("mousemove",o.Z),E(),f=JSON.parse(JSON.stringify(h))}function x(e){return JSON.parse(JSON.stringify(e))}function _(e,t){const{viewport:n}=(0,r.getEnabledElement)(e),i=n.canvasToWorld(t.canvas);return{page:t.page,client:t.client,canvas:t.canvas,world:i}}function S(e,t){return{page:I(e.page,t.page),client:I(e.client,t.client),canvas:I(e.canvas,t.canvas),world:(n=e.world,r=t.world,[n[0]-r[0],n[1]-r[1],n[2]-r[2]])};var n,r}function I(e,t){return[e[0]-t[0],e[1]-t[1]]}function D(){return f.mouseButton}function A(e){m.ignoreDoubleClick?(m.ignoreDoubleClick=!1,e.stopImmediatePropagation(),e.preventDefault()):T()}const P=function(e){if(m.doubleClickTimeout){if(e.buttons===m.mouseDownEvent.buttons)return;return m.mouseDownEvent=e,void w()}m.doubleClickTimeout=setTimeout(w,1===e.buttons?400:150),m.mouseDownEvent=e,m.ignoreDoubleClick=!1,f.element=e.currentTarget,f.mouseButton=e.buttons;const t=(0,r.getEnabledElement)(f.element),{renderingEngineId:n,viewportId:i}=t;f.renderingEngineId=n,f.viewportId=i,f.preventClickTimeout=setTimeout(C,f.clickDelay),f.element.removeEventListener("mousemove",o.Z);const s=(0,a.Z)(e,f.element);f.startPoints=x(s),f.lastPoints=x(s),document.addEventListener("mouseup",v),document.addEventListener("mousemove",g)}},932:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(62709),i=n(34539),o=n(90157);const a=i.default.MOUSE_MOVE;const s=function(e){const t=e.currentTarget,n=(0,r.getEnabledElement)(t),{renderingEngineId:i,viewportId:s}=n,l={renderingEngineId:i,viewportId:s,camera:{},element:t,currentPoints:(0,o.Z)(e),eventName:a,event:e};!(0,r.triggerEvent)(t,a,l)&&(e.stopImmediatePropagation(),e.preventDefault())}},49507:(e,t,n)=>{"use strict";n(62709),n(86614),n(60721),n(68096),n(33232),n(90065),n(62486),n(57864),n(27078)},58119:(e,t,n)=>{"use strict";n(62709),n(34539),n(86614)},85056:(e,t,n)=>{"use strict";n.d(t,{o:()=>c});var r=n(11677),i=n.n(r),o=n(62709),a=n(11163),s=n(41836);class l{constructor(e){this.getGroupKey=e=>{if("string"==typeof e)return e;const t=e,n=(0,o.getEnabledElement)(t);if(!n)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return n.FrameOfReferenceUID},this._imageVolumeModifiedHandler=e=>{const t=e.detail,{FrameOfReferenceUID:n}=t,r=this.annotations[n];r&&Object.keys(r).forEach(e=>{r[e].forEach(e=>{void 0!==e.invalidated&&(e.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(e,t)=>{const n=this.annotations;return n[e]?t?n[e][t]?n[e][t]:[]:n[e]:[]},this.getAnnotation=e=>{const t=this.annotations;for(const n in t){const r=t[n];for(const t in r){const n=r[t];for(const t of n)if(e===t.annotationUID)return t}}},this.getNumberOfAnnotations=(e,t)=>{const n=this.getAnnotations(e,t);if(!n.length)return 0;if(t)return n.length;let r=0;for(const e in n)r+=n[e].length;return r},this.addAnnotation=(e,t)=>{const{metadata:n}=e,{FrameOfReferenceUID:r,toolName:i}=n;t=t||r;const o=this.annotations;let l=o[t];l||(o[t]={},l=o[t]);let c=l[i];c||(l[i]=[],c=l[i]),c.push(e),(0,a.checkAndDefineIsLockedProperty)(e),(0,s.checkAndDefineIsVisibleProperty)(e),(e=>{e.data||(e.data={}),e.data.handles||(e.data.handles={}),e.data.handles.textBox||(e.data.handles.textBox={})})(e),(e=>{e.data||(e.data={}),e.data.cachedStats||(e.data.cachedStats={})})(e)},this.removeAnnotation=e=>{const{annotations:t}=this;for(const n in t){const r=t[n];for(const t in r){const n=r[t],i=n.findIndex(t=>t.annotationUID===e);-1!==i&&(n.splice(i,1),0===n.length&&delete r[t])}0===Object.keys(r).length&&delete t[n]}},this.removeAnnotations=(e,t)=>{const n=this.annotations,r=[];if(!n[e])return r;if(t){const i=n[e][t];for(const e of i)this.removeAnnotation(e.annotationUID),r.push(e)}else for(const t in n[e]){const i=n[e][t];for(const e of i)this.removeAnnotation(e.annotationUID),r.push(e)}return r},this.saveAnnotations=(e,t)=>{const n=this.annotations;if(e&&t){const r=n[e];if(!r)return;const o=r[t];return i()(o)}if(e){const t=n[e];return i()(t)}return i()(n)},this.restoreAnnotations=(e,t,n)=>{const r=this.annotations;if(t&&n){let i=r[t];i||(r[t]={},i=r[t]),i[n]=e}else t?r[t]=e:this.annotations=i()(e)},this.getAllAnnotations=()=>Object.values(this.annotations).map(e=>Object.values(e)).flat(2),this.getNumberOfAllAnnotations=()=>{let e=0;const t=this.annotations;for(const n in t){const r=t[n];for(const t in r){e+=r[t].length}}return e},this.removeAllAnnotations=()=>{const e=[];for(const t of this.getAllAnnotations())this.removeAnnotation(t.annotationUID),e.push(t);return e},e||(e=o.utilities.uuidv4()),this.annotations={},this.uid=e,o.eventTarget.addEventListener(o.Enums.Events.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}}const c=new l("DEFAULT")},11163:(e,t,n)=>{"use strict";n.d(t,{checkAndDefineIsLockedProperty:()=>l,isAnnotationLocked:()=>s});var r=n(62709),i=n(68096);const o=new Set;function a(e,t=!0){const n=c();e&&(t?function(e,t,n){t.has(e)||(t.add(e),n.added.push(e))}(e,o,n):u(e,o,n)),d(n,o)}function s(e){return o.has(e)}function l(e){if(e){const t=!!e.isLocked;(function(e){const t=Object.getOwnPropertyDescriptor(e,"isLocked");if(t)return t.configurable&&(t.set!==p||t.get!==h);return Object.isExtensible(e)})(e)&&Object.defineProperty(e,"isLocked",{configurable:!1,enumerable:!0,set:p,get:h}),a(e,t)}}function c(){return Object.freeze({added:[],removed:[],locked:[]})}function u(e,t,n){t.delete(e)&&n.removed.push(e)}function d(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach(t=>{e.locked.push(t)}),(0,r.triggerEvent)(r.eventTarget,i.Events.ANNOTATION_LOCK_CHANGE,e))}function p(e){a(this,e)}function h(){return s(this)}},91398:(e,t,n)=>{"use strict";n.d(t,{deselectAnnotation:()=>s,isAnnotationSelected:()=>l,setAnnotationSelected:()=>a});var r=n(62709),i=n(68096);n(86614);const o=new Set;function a(e,t=!0,n=!1){t?function(e,t=!1){const n=c();t||u(o,n);e&&!o.has(e)&&(o.add(e),n.added.push(e));d(n,o)}(e,n):s(e)}function s(e){const t=c();e?o.delete(e)&&t.removed.push(e):u(o,t),d(t,o)}function l(e){return o.has(e)}function c(){return Object.freeze({added:[],removed:[],selection:[]})}function u(e,t){e.forEach(n=>{e.delete(n)&&t.removed.push(n)})}function d(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach(t=>{e.selection.push(t)}),(0,r.triggerEvent)(r.eventTarget,i.Events.ANNOTATION_SELECTION_CHANGE,e))}},86614:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addAnnotation:()=>g,addChildAnnotation:()=>h,clearParentAnnotation:()=>p,getAllAnnotations:()=>d,getAnnotation:()=>b,getAnnotationManager:()=>s,getAnnotations:()=>u,getChildAnnotations:()=>m,getNumberOfAnnotations:()=>v,getParentAnnotation:()=>f,invalidateAnnotation:()=>E,removeAllAnnotations:()=>C,removeAnnotation:()=>y,removeAnnotations:()=>w,resetAnnotationManager:()=>c,setAnnotationManager:()=>l});var r=n(62709),i=n(85056),o=n(36705);let a=i.o;function s(){return a}function l(e){a=e}function c(){a=i.o}function u(e,t){const n=s(),r=n.getGroupKey(t);return n.getAnnotations(r,e)}function d(){return s().getAllAnnotations()}function p(e){const{annotationUID:t,parentAnnotationUID:n}=e;if(!n)return;const r=b(n),i=r.childAnnotationUIDs.indexOf(t);r.childAnnotationUIDs.splice(i,1),e.parentAnnotationUID=void 0}function h(e,t){const{annotationUID:n}=e,{annotationUID:r}=t;p(t),e.childAnnotationUIDs||(e.childAnnotationUIDs=[]),e.childAnnotationUIDs.includes(r)||(e.childAnnotationUIDs.push(r),t.parentAnnotationUID=n)}function f(e){return e.parentAnnotationUID?b(e.parentAnnotationUID):void 0}function m(e){return e.childAnnotationUIDs?.map(e=>b(e))??[]}function g(e,t){e.annotationUID||(e.annotationUID=r.utilities.uuidv4());const n=s();if(t instanceof HTMLDivElement){const r=n.getGroupKey(t);n.addAnnotation(e,r),(0,o.xJ)(e,t)}else n.addAnnotation(e),(0,o.Qm)(e);return e.annotationUID}function v(e,t){const n=s(),r=n.getGroupKey(t);return n.getNumberOfAnnotations(r,e)}function y(e){if(!e)return;const t=s(),n=t.getAnnotation(e);n&&(n.childAnnotationUIDs?.forEach(e=>y(e)),t.removeAnnotation(e),(0,o.Ak)({annotation:n,annotationManagerUID:t.uid}))}function b(e){return s().getAnnotation(e)}function C(){const e=s(),t=e.removeAllAnnotations();for(const n of t)(0,o.Ak)({annotation:n,annotationManagerUID:e.uid})}function w(e,t){const n=s(),r=n.getGroupKey(t),i=n.removeAnnotations(r,e);for(const e of i)(0,o.Ak)({annotation:e,annotationManagerUID:n.uid})}function E(e){let t=e;for(;t;)t.invalidated=!0,t=t.parentAnnotationUID?b(t.parentAnnotationUID):void 0}},41836:(e,t,n)=>{"use strict";n.d(t,{checkAndDefineIsVisibleProperty:()=>u,isAnnotationVisible:()=>c});var r=n(62709),i=n(86614),o=n(68096),a=n(91398);const s=new Set;function l(e,t=!0){const n=d();e&&(t?p(e,s,n):function(e,t,n){t.has(e)||(t.add(e),(0,a.isAnnotationSelected)(e)&&(0,a.deselectAnnotation)(e),n.lastHidden.push(e))}(e,s,n)),h(n)}function c(e){if((0,i.getAnnotation)(e))return!s.has(e)}function u(e){if(e){const t=e.isVisible??!0;(function(e){const t=Object.getOwnPropertyDescriptor(e,"isVisible");if(t)return t.configurable&&(t.set!==f||t.get!==m);return Object.isExtensible(e)})(e)&&Object.defineProperty(e,"isVisible",{configurable:!1,enumerable:!0,set:f,get:m}),l(e.annotationUID,t)}}function d(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function p(e,t,n){t.delete(e)&&n.lastVisible.push(e)}function h(e){(e.lastHidden.length>0||e.lastVisible.length>0)&&(s.forEach(t=>{e.hidden.push(t)}),(0,r.triggerEvent)(r.eventTarget,o.Events.ANNOTATION_VISIBILITY_CHANGE,e))}function f(e){l(this.annotationUID,e)}function m(){return c(this.annotationUID)}},53122:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=new class{constructor(){this._initializeConfig({color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(255, 255, 0)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0})}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,t){let n=this.config.annotations;n||(this.config={...this.config,annotations:{}},n=this.config.annotations),n[e]=t}setViewportToolStyles(e,t){let n=this.config.viewports;n||(this.config={...this.config,viewports:{}},n=this.config.viewports),n[e]=t}setToolGroupToolStyles(e,t){let n=this.config.toolGroups;n||(this.config={...this.config,toolGroups:{}},n=this.config.toolGroups),n[e]=t}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,t){const{annotationUID:n,viewportId:r,toolGroupId:i,toolName:o}=t;return this._getToolStyle(e,n,r,i,o)}_getToolStyle(e,t,n,r,i){if(t){const n=this.getAnnotationToolStyles(t);if(n&&void 0!==n[e])return n[e]}if(n){const t=this.getViewportToolStyles(n);if(t){if(t[i]&&void 0!==t[i][e])return t[i][e];if(t.global&&void 0!==t.global[e])return t.global[e]}}if(r){const t=this.getToolGroupToolStyles(r);if(t){if(t[i]&&void 0!==t[i][e])return t[i][e];if(t.global&&void 0!==t.global[e])return t.global[e]}}const o=this.getDefaultToolStyles();return o[i]&&void 0!==o[i][e]?o[i][e]:o.global&&void 0!==o.global[e]?o.global[e]:void 0}_initializeConfig(e){const t={};for(const n in e)t[n]=e[n];this.config={default:{global:t}}}}},88048:(e,t,n)=>{"use strict";n(58429)},91744:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(11163),i=n(91398),o=n(68096);const a=function(e){if(e){if(e.data&&e.highlighted)return o.AnnotationStyleStates.Highlighted;if((0,i.isAnnotationSelected)(e.annotationUID))return o.AnnotationStyleStates.Selected;if((0,r.isAnnotationLocked)(e))return o.AnnotationStyleStates.Locked;if(e.data&&e.autoGenerated)return o.AnnotationStyleStates.AutoGenerated}return o.AnnotationStyleStates.Default}},58429:(e,t,n)=>{"use strict";n.d(t,{$:()=>i});var r=n(53122);function i(e,t,n,i){const o=function(e,t,n){const r=[`${e}`];return t&&r.push(`${r[0]}${t}`),n&&r.push(`${r[r.length-1]}${n}`),r}(e,n,i);for(let e=o.length-1;e>=0;--e){const n=r.Z.getStyleProperty(o[e],t);if(void 0!==n)return n}}},36705:(e,t,n)=>{"use strict";n.d(t,{Ak:()=>l,F$:()=>u,Qm:()=>s,hg:()=>c,lf:()=>d,xJ:()=>a});var r=n(62709),i=n(68096),o=n(27078);function a(e,t){const n=(0,r.getEnabledElement)(t),{renderingEngine:o,viewportId:a}=n,s=i.Events.ANNOTATION_ADDED,l={annotation:e,viewportId:a,renderingEngineId:o.id};(0,r.triggerEvent)(r.eventTarget,s,l)}function s(e){const{toolName:t}=e.metadata,n=(0,o.getToolGroupsWithToolName)(t);if(!n.length)return;const a=[];n.forEach(t=>{t.viewportsInfo.forEach(t=>{const{renderingEngineId:n,viewportId:i}=t,{FrameOfReferenceUID:o}=(0,r.getEnabledElementByIds)(i,n);e.metadata.FrameOfReferenceUID===o&&a.push(t)})});const s=i.Events.ANNOTATION_ADDED,l={annotation:e};a.length?a.forEach(({renderingEngineId:e,viewportId:t})=>{l.viewportId=t,l.renderingEngineId=e,(0,r.triggerEvent)(r.eventTarget,s,l)}):(0,r.triggerEvent)(r.eventTarget,s,l)}function l(e){const t=i.Events.ANNOTATION_REMOVED;(0,r.triggerEvent)(r.eventTarget,t,e)}function c(e,t,n=i.ChangeTypes.HandlesUpdated){const o=(0,r.getEnabledElement)(t),{viewportId:a,renderingEngineId:s}=o,l=i.Events.ANNOTATION_MODIFIED,c={annotation:e,viewportId:a,renderingEngineId:s,changeType:n};(0,r.triggerEvent)(r.eventTarget,l,c)}function u(e){p({annotation:e})}function d(e,t=!1){p({annotation:e,contourHoleProcessingEnabled:t})}function p(e){const t=i.Events.ANNOTATION_COMPLETED;(0,r.triggerEvent)(r.eventTarget,t,e)}},50097:(e,t,n)=>{"use strict";n.d(t,{AR:()=>r.getAnnotation,VI:()=>r.getParentAnnotation,X9:()=>r.invalidateAnnotation,_x:()=>r.removeAnnotation,fy:()=>r.getAnnotations,ud:()=>r.addAnnotation});n(85056),n(11163),n(91398);var r=n(86614);n(95482)},46629:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getActiveSegmentation:()=>a,getActiveSegmentationRepresentation:()=>o,setActiveSegmentationRepresentation:()=>s});var r=n(60721),i=n(32140);function o(e){const t=(0,r.getDefaultSegmentationStateManager)().getSegmentationRepresentations(e);if(!t)return;return t.find(e=>e.active)}function a(e){const t=o(e);if(!t)return;return(0,r.getSegmentation)(t.segmentationId)}function s(e,t){(0,r.getDefaultSegmentationStateManager)().setActiveSegmentationRepresentation(e,t),(0,i.triggerSegmentationRepresentationModified)(e,t)}},39949:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getSegmentVisibility:()=>u,getSegmentationVisibility:()=>s,setSegmentVisibility:()=>c,setSegmentationVisibility:()=>a,setSegmentsVisibility:()=>l});var r=n(60721),i=n(68203),o=n(32140);function a(e,t,n){const a=(0,r.getSegmentationRepresentations)(e);if(!a)return;const s=a.find(e=>e.segmentationRepresentationUID===t);if(!s)return;const{segmentsHidden:l,segmentationId:c}=s,u=(0,i.getUniqueSegmentIndices)(c);n?l.clear():u.forEach(e=>{l.add(e)}),(0,o.triggerSegmentationRepresentationModified)(e,s.segmentationRepresentationUID)}function s(e,t){const n=(0,r.getSegmentationRepresentations)(e).find(e=>e.segmentationRepresentationUID===t);if(!n)return;const{segmentsHidden:o,segmentationId:a}=n,s=(0,i.getUniqueSegmentIndices)(a),l=new Set(s);return o.forEach(e=>l.delete(e)),!!l.size}function l(e,t,n,i){const a=r.getSegmentationRepresentationByUID(e,t);a&&(n.forEach(e=>{i?a.segmentsHidden.delete(e):a.segmentsHidden.add(e)}),(0,o.triggerSegmentationRepresentationModified)(e,t))}function c(e,t,n,i){const a=r.getSegmentationRepresentationByUID(e,t);a&&(i?a.segmentsHidden.delete(n):a.segmentsHidden.add(n),(0,o.triggerSegmentationRepresentationModified)(e,t))}function u(e,t,n){const i=r.getSegmentationRepresentationByUID(e,t);return!!i&&!i.segmentsHidden.has(n)}},11510:(e,t,n)=>{"use strict";n.d(t,{ZU:()=>d,rX:()=>p});var r=n(62709),i=n(68096),o=n(79454),a=n(39163);const s=(0,r.getWebWorkerManager)(),l=new Map,c=new Map,u=(e,t)=>{(0,r.triggerEvent)(e,r.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:i.WorkerTypes.SURFACE_CLIPPING})};async function d(e,t,n){(0,a.k)();const i=t.getSlicesClippingPlanes?.();if(!i)return;const d=t.getSliceIndex();i.sort((e,t)=>Math.abs(e.sliceIndex-d)-Math.abs(t.sliceIndex-d)),u(r.eventTarget,0),await async function(e){const t=e.filter(e=>!c.has(e.id));if(!t.length)return;const n=await s.executeTask("polySeg","getSurfacesAABBs",{surfacesInfo:t},{callbacks:[({progress:e})=>{u(r.eventTarget,e)}]});n.forEach((e,t)=>{c.set(t,e)})}(e);const p=new Map;e.forEach(e=>{p.set(e.id,c.get(e.id))});const h=t.getCamera();return await s.executeTask("polySeg","cutSurfacesIntoPlanes",{surfacesInfo:e,planesInfo:i,surfacesAABB:p},{callbacks:[({progress:e})=>{u(r.eventTarget,e)},({sliceIndex:e,polyDataResults:r})=>{r.forEach((r,i)=>{const a=`${n}_${i}`,s=function(e,t,n){return`${e.id}-${(0,o.pointToString)(t)}-${n}`}(t,h.viewPlaneNormal,e);!function(e,t,n){const{points:r,lines:i,numberOfCells:o}=n;let a=l.get(e);a||(a=new Map,l.set(e,a));a.set(t,{points:r,lines:i,numberOfCells:o})}(a,s,r)})}]}).catch(e=>{console.error(e)}),u(r.eventTarget,1),l}function p(e,t){return`${e}_${t}`}},95482:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activeSegmentation:()=>z,addRepresentationData:()=>k,addSegmentationRepresentations:()=>L,addSegmentations:()=>v,config:()=>o,convertStackToVolumeSegmentation:()=>B,convertVolumeToStackSegmentation:()=>W,polySeg:()=>a,removeSegmentationsFromToolGroup:()=>d,segmentIndex:()=>J,segmentLocking:()=>r,state:()=>u,triggerSegmentationEvents:()=>V});var r={};n.r(r),n.d(r,{getLockedSegments:()=>Z,isSegmentIndexLocked:()=>H,setSegmentIndexLocked:()=>j});var i={};n.r(i),n.d(i,{addColorLUT:()=>K,getColorForSegmentIndex:()=>q,setColorForSegmentIndex:()=>X,setColorLUT:()=>$});var o={};n.r(o),n.d(o,{color:()=>i,getGlobalConfig:()=>C,getGlobalRepresentationConfig:()=>E,getSegmentSpecificConfig:()=>D,getSegmentationRepresentationSpecificConfig:()=>S,getToolGroupSpecificConfig:()=>x,setGlobalConfig:()=>w,setGlobalRepresentationConfig:()=>T,setSegmentSpecificConfig:()=>A,setSegmentationRepresentationSpecificConfig:()=>I,setToolGroupSpecificConfig:()=>_,visibility:()=>Y});var a={};n.r(a),n.d(a,{canComputeRequestedRepresentation:()=>Oe,computeAndAddContourRepresentation:()=>Ae,computeAndAddLabelmapRepresentation:()=>Te,computeAndAddSurfaceRepresentation:()=>pe});var s=n(74297),l=n(83456),c=n(44284),u=n(60721);const d=function(e,t,n){const r=(0,u.getSegmentationRepresentations)(e);if(!r||0===r.length)return;const i=r.map(e=>e.segmentationRepresentationUID);let o=t;if(o){const e=t.filter(e=>!i.includes(e));if(e.length>0)throw new Error(`The following segmentationRepresentationUIDs are not part of the toolGroup: ${JSON.stringify(e)}`)}else o=i;o.forEach(t=>{!function(e,t,n){const r=(0,u.getSegmentationRepresentationByUID)(e,t),{type:i}=r;if(i===s.default.Labelmap)l.Pm.removeSegmentationRepresentation(e,t,n);else{if(i!==s.default.Contour)throw new Error(`The representation ${i} is not supported yet`);c.p.removeSegmentationRepresentation(e,t,n)}}(e,t,n)})};var p=n(11677),h=n.n(p),f=n(68096),m=n(88286);const g=function(e){if(!e||0===e.length)throw new Error("The segmentationInputArray is undefined or an empty array");e.forEach(e=>{if(void 0===e.segmentationId)throw new Error("Undefined segmentationInput.segmentationId. Please provide a valid segmentationId");if(void 0===e.representation)throw new Error("Undefined segmentationInput.representation. Please provide a valid representation");e.representation.type===f.SegmentationRepresentations.Labelmap&&(0,m.K)(e)})};const v=function(e){g(e),e.map(e=>{const t=h()(e);(0,u.addSegmentation)(t)})};var y=n(27078),b=n(62709);function C(){return u.getGlobalConfig()}function w(e){u.setGlobalConfig(e)}function E(e){return C().representations[e]}function T(e,t){const n=C();w({...n,representations:{...n.representations,[e]:{...n.representations[e],...t}}})}function x(e){return u.getToolGroupSpecificConfig(e)}function _(e,t){u.setToolGroupSpecificConfig(e,t)}function S(e,t){return u.getSegmentationRepresentationSpecificConfig(e,t)}function I(e,t,n){u.setSegmentationRepresentationSpecificConfig(e,t,n)}function D(e,t,n){return u.getSegmentSpecificRepresentationConfig(e,t,n)}function A(e,t,n){u.setSegmentSpecificRepresentationConfig(e,t,n)}var P=n(60950);function O(e){const{type:t}=e;return t===s.default.Labelmap?(0,P.iq)():{}}var R=n(19383),M=n(79454);async function N(e,t,n){const{segmentationId:r,options:i={}}=t,o=t.options?.segmentationRepresentationUID||b.utilities.uuidv4(),a=new Set,s=function(e={}){const t=e.colorLUTOrIndex;let n;if("number"==typeof t)n=t;else{const e=(0,u.getNextColorLUTIndex)(),r=Array.isArray(t)?t:R.Z;(0,u.addColorLUT)(r,e),n=e}return n}(i),l={segmentationId:r,segmentationRepresentationUID:o,type:t.type,segmentsHidden:a,colorLUTIndex:s,active:!0,segmentationRepresentationSpecificConfig:{},segmentSpecificConfig:{},config:O(t),polySeg:i.polySeg};if(n){const t=x(e),r=b.utilities.deepMerge(t,n);_(e,{renderInactiveSegmentations:r.renderInactiveSegmentations||!0,representations:{...r.representations}})}return(0,u.addSegmentationRepresentation)(e,l),t.type===f.SegmentationRepresentations.Contour&&(0,y.getToolGroup)(e).getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{const n=(0,b.getRenderingEngine)(t);(0,M.triggerAnnotationRenderForViewportIds)(n,[e])}),o}const L=async function(e,t,n){if(!(0,y.getToolGroup)(e))throw new Error(`No tool group found for toolGroupId: ${e}`);const r=t.map(t=>N(e,t,n));return await Promise.all(r)};const k=function({segmentationId:e,type:t,data:n}){const r=(0,u.getSegmentation)(e);switch(r.representationData[t]&&console.warn(`Representation data of type ${t} already exists for segmentation ${e}, overwriting it.`),t){case s.default.Labelmap:case s.default.Contour:case s.default.Surface:n&&(r.representationData[t]=n);break;default:throw new Error(`Invalid representation type ${t}`)}};var F=n(68203),V=n(32140);async function U({imageIdReferenceMap:e,options:t}){const n=Array.from(e.values()),r={imageIdReferenceMap:e},i=t?.volumeId??b.utilities.uuidv4();return await b.volumeLoader.createAndCacheVolumeFromImages(i,n,{additionalDetails:r}),{volumeId:i}}async function B({segmentationId:e,options:t}){const n=(0,u.getSegmentation)(e).representationData.LABELMAP,{volumeId:r}=await U({imageIdReferenceMap:n.imageIdReferenceMap,options:t});await async function({segmentationId:e,toolGroupId:t,volumeId:n,options:r}){const i=(0,u.getSegmentation)(e);if(r?.removeOriginal){const e=i.representationData.LABELMAP.imageIdReferenceMap;Array.from(e.values()).forEach(e=>{b.cache.removeImageLoadObject(e)}),i.representationData.LABELMAP={volumeId:n}}else i.representationData.LABELMAP={...i.representationData.LABELMAP,volumeId:n};await L(t,[{segmentationId:e,type:f.SegmentationRepresentations.Labelmap}]),(0,F.triggerSegmentationRender)(t),b.eventTarget.addEventListenerOnce(f.Events.SEGMENTATION_RENDERED,()=>(0,V.triggerSegmentationDataModified)(e))}({segmentationId:e,toolGroupId:t.toolGroupId,options:t,volumeId:r})}async function G({volumeId:e}){const t=b.cache.getVolume(e);let n=!1;t.imageCacheOffsetMap.size>0&&(n=t.imageIds.every(e=>b.cache.getImage(e)));const r=(0,b.getRenderingEngines)()[0].getVolumeViewports().find(t=>t.hasVolumeId(e));t.decache(!r&&n);const i=function(e){if(e.additionalDetails?.imageIdReferenceMap)return e.additionalDetails.imageIdReferenceMap;if(e.referencedImageIds?.length&&!e.referencedImageIds[0].startsWith("derived")){const t=e.referencedImageIds,n=e.imageIds;return(0,F.createImageIdReferenceMap)(t,[...n].reverse())}{const t=e.referencedVolumeId,n=b.cache.getVolume(t);if(!n)throw new Error("Cannot convert volumetric segmentation without referenced volume to stack segmentation yet");if(!n?.imageIds?.length)throw new Error("Cannot convert volumetric segmentation without imageIds to stack segmentation yet");if(n.imageIds?.[0].startsWith("derived"))throw new Error("Cannot convert volume segmentation that is derived from another segmentation\n         to stack segmentation yet, include the additionalDetails.imageIdReferenceMap\n         in the volume segmentation in case you need it for the conversion");const r=n.imageIds;let i=e.imageIds;return i?.length||(i=e.convertToImageSlicesAndCache()),(0,F.createImageIdReferenceMap)(r,[...i].reverse())}}(t);return{imageIdReferenceMap:i}}async function W({segmentationId:e,options:t}){const n=(0,u.getSegmentation)(e).representationData.LABELMAP,{imageIdReferenceMap:r}=await G({volumeId:n.volumeId});await async function({segmentationId:e,toolGroupId:t,imageIdReferenceMap:n,options:r}){const i=(0,u.getSegmentation)(e);if(r?.removeOriginal){const e=i.representationData.LABELMAP;b.cache.getVolume(e.volumeId)&&b.cache.removeVolumeLoadObject(e.volumeId),i.representationData.LABELMAP={imageIdReferenceMap:n}}else i.representationData.LABELMAP={...i.representationData.LABELMAP,imageIdReferenceMap:n};await L(t,[{segmentationId:e,type:f.SegmentationRepresentations.Labelmap}]),(0,F.triggerSegmentationRender)(t),b.eventTarget.addEventListenerOnce(f.Events.SEGMENTATION_RENDERED,()=>(0,V.triggerSegmentationDataModified)(e))}({segmentationId:e,toolGroupId:t.toolGroupId,imageIdReferenceMap:r,options:t})}var z=n(46629);function H(e,t){const n=(0,u.getSegmentation)(e);if(!n)throw new Error(`No segmentation state found for ${e}`);const{segmentsLocked:r}=n;return r.has(t)}function j(e,t,n=!0){const r=(0,u.getSegmentation)(e);if(!r)throw new Error(`No segmentation state found for ${e}`);const{segmentsLocked:i}=r;n?i.add(t):i.delete(t),(0,V.triggerSegmentationModified)(e)}function Z(e){const t=(0,u.getSegmentation)(e);if(!t)throw new Error(`No segmentation state found for ${e}`);const{segmentsLocked:n}=t;return Array.from(n)}function K(e,t){if(!e)throw new Error("addColorLUT: colorLUT is required");b.utilities.isEqual(e[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),e.unshift([0,0,0,0])),u.addColorLUT(e,t)}function $(e,t,n){const r=u.getSegmentationRepresentationByUID(e,t);if(!r)throw new Error(`setColorLUT: could not find segmentation representation with UID ${t}`);if(!u.getColorLUT(n))throw new Error(`setColorLUT: could not find colorLUT with index ${n}`);r.colorLUTIndex=n,(0,V.triggerSegmentationRepresentationModified)(e,t)}function q(e,t,n){const r=u.getSegmentationRepresentationByUID(e,t);if(!r)throw new Error(`segmentation representation with UID ${t} does not exist for tool group ${e}`);const{colorLUTIndex:i}=r,o=u.getColorLUT(i);let a=o[n];if(!a){if("number"!=typeof n)throw new Error(`Can't create colour for LUT index ${n}`);a=o[n]=[0,0,0,0]}return a}function X(e,t,n,r){const i=q(e,t,n);for(let e=0;e<r.length;e++)i[e]=r[e];(0,V.triggerSegmentationRepresentationModified)(e,t)}var Y=n(39949),J=n(43850),Q=n(39163);const ee=new Map;async function te(e,t,n,r){(0,Q.k)();const i=await n();k({segmentationId:e,type:t,data:i}),ee.has(e)||ee.set(e,[]);const o=ee.get(e);return o.includes(t)||o.push(t),function(e){const t=t=>{ne(t,e)};e._debouncedUpdateFunction=t,b.eventTarget.removeEventListener(f.Events.SEGMENTATION_DATA_MODIFIED,e._debouncedUpdateFunction),b.eventTarget.addEventListener(f.Events.SEGMENTATION_DATA_MODIFIED,e._debouncedUpdateFunction)}(r),(0,V.triggerSegmentationModified)(e),i}const ne=(0,M.debounce)((e,t)=>{const n=e.detail.segmentationId,r=ee.get(n);r&&r.length&&(t(n),r.length&&(0,V.triggerSegmentationModified)(n))},300);var re=n(86614);const ie=(0,b.getWebWorkerManager)(),oe=(e,t)=>{(0,b.triggerEvent)(e,b.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:f.WorkerTypes.POLYSEG_CONTOUR_TO_SURFACE})};async function ae(e,t,n={}){let r,i;n.segmentationRepresentationUID&&({segmentationRepresentation:r,toolGroupId:i}=(0,u.findSegmentationRepresentationByUID)(n.segmentationRepresentationUID));const o=(0,u.getSegmentation)(e),a=new Map,s=Object.keys(t).map(async e=>{const n=t[e],s=n.segmentIndex,l=r;if(q(i,r.segmentationRepresentationUID,s).slice(0,3),!l)throw new Error("No color found for segment index, unable to create surface");const c={id:`segmentation_${o.segmentationId}_surface_${s}`,color:l,frameOfReferenceUID:"test-frameOfReferenceUID",data:{points:n.data.points,polys:n.data.polys}},u=c.id;return a.set(s,u),b.geometryLoader.createAndCacheGeometry(u,{type:b.Enums.GeometryType.SURFACE,geometryData:c})});return await Promise.all(s),{geometryIds:a}}var se=n(88439);const le=(0,b.getWebWorkerManager)(),ce=(e,t)=>{(0,b.triggerEvent)(e,b.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:f.WorkerTypes.POLYSEG_LABELMAP_TO_SURFACE})};async function ue(e,t={}){const n=t.segmentIndices?.length?t.segmentIndices:(0,F.getUniqueSegmentIndices)(e);let r;const i=(0,u.getSegmentation)(e),o=i.representationData;try{o.CONTOUR?r=await async function(e,t={}){const n=(0,u.getSegmentation)(e),r=n.representationData.CONTOUR,i=t.segmentIndices||(0,F.getUniqueSegmentIndices)(e),o=i.map(async e=>{const t=await async function(e,t){const{annotationUIDsMap:n}=e,r=[],i=[],o=n.get(t);for(const e of o){const t=(0,re.getAnnotation)(e),{polyline:n}=t.data.contour;i.push(n.length),n.forEach(e=>r.push(...e))}oe(b.eventTarget,0);const a=await ie.executeTask("polySeg","convertContourToSurface",{polylines:r,numPointsArray:i},{callbacks:[e=>{oe(b.eventTarget,e)}]});return oe(b.eventTarget,1),a}(r,e);return{segmentIndex:e,data:t}});return await Promise.all(o)}(e,{segmentIndices:n,...t}):o.LABELMAP&&(r=await de(i.segmentationId,{segmentIndices:n,...t}))}catch(e){throw console.error(e),e}if(!r)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return await ae(e,r,t)}async function de(e,t={}){const n=(0,u.getSegmentation)(e);if(!n?.representationData?.LABELMAP)return void console.warn("Only support surface update from labelmaps");const r=(0,se.y)(n.representationData.LABELMAP),i=n.representationData.LABELMAP,o=t.segmentIndices||(0,F.getUniqueSegmentIndices)(e),a=o.map(e=>{const t=async function(e,t,n=!0){let r;if(n)r=e.volumeId;else{const{imageIdReferenceMap:t}=e;({volumeId:r}=await U({imageIdReferenceMap:t}))}const i=b.cache.getVolume(r),o=i.getScalarData(),{dimensions:a,spacing:s,origin:l,direction:c}=i;ce(b.eventTarget,0);const u=await le.executeTask("polySeg","convertLabelmapToSurface",{scalarData:o,dimensions:a,spacing:s,origin:l,direction:c,segmentIndex:t},{callbacks:[e=>{ce(b.eventTarget,e)}]});return ce(b.eventTarget,1),u}(i,e,r);return t}),s=await Promise.allSettled(a),l=s.filter(e=>"rejected"===e.status);if(l.length>0)throw console.error(l),new Error("Failed to convert labelmap to surface");return s.map((e,t)=>{if("fulfilled"===e.status)return{segmentIndex:o[t],data:e.value}}).filter(Boolean)}function pe(e,t={}){return te(e,f.SegmentationRepresentations.Surface,()=>ue(e,t),()=>async function(e){const t=await de(e);if(!t)return;const n=(0,u.getSegmentation)(e),r=(0,F.getUniqueSegmentIndices)(e);if(!r.length)return n.representationData.SURFACE.geometryIds.forEach(e=>{const t=b.cache.getGeometry(e).data;t.setPoints([]),t.setPolys([])}),void(0,V.triggerSegmentationModified)(e);const i=t.map(({data:t,segmentIndex:i})=>{const o=`segmentation_${e}_surface_${i}`,a=b.cache.getGeometry(o);if(!a)return(0,u.getToolGroupIdsWithSegmentation)(e).map(r=>(0,u.getSegmentationRepresentations)(r).map(r=>{if(r.type===f.SegmentationRepresentations.Surface)return n.representationData.SURFACE.geometryIds.set(i,o),ae(e,[{segmentIndex:i,data:t}],{segmentationRepresentationUID:r.segmentationRepresentationUID})}));if(r.includes(i)){const e=a.data;e.setPoints(t.points),e.setPolys(t.polys)}else{const e=a.data;e.setPoints([]),e.setPolys([])}});await Promise.all(i),(0,V.triggerSegmentationModified)(e)}(e))}var he=n(72076),fe=n(50097);const me=(0,b.getWebWorkerManager)(),ge=(e,t)=>{(0,b.triggerEvent)(e,b.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:f.WorkerTypes.POLYSEG_CONTOUR_TO_LABELMAP})};async function ve(e,t={}){const{viewport:n}=t,r=b.utilities.getViewportImageIds(n);if(!r)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");const i=b.utilities.uuidv4(),o=b.utilities.generateVolumePropsFromImageIds(r,i),{metadata:a,dimensions:s,origin:l,direction:c,spacing:u,scalarData:d}=o,p=await b.volumeLoader.createLocalSegmentationVolume({dimensions:s,origin:l,direction:c,spacing:u,metadata:a,imageIds:r.map(e=>`generated://${e}`),referencedImageIds:r},i),{segmentIndices:h,annotationUIDsInSegmentMap:f}=be(e,t);ge(b.eventTarget,0);const m=await me.executeTask("polySeg","convertContourToVolumeLabelmap",{segmentIndices:h,dimensions:s,scalarData:d,origin:l,direction:c,spacing:u,annotationUIDsInSegmentMap:f},{callbacks:[e=>{ge(b.eventTarget,e)}]});return ge(b.eventTarget,1),p.imageData.getPointData().getScalars().setData(m),p.imageData.modified(),p.modified(),{volumeId:p.volumeId}}async function ye(e,t={}){if(!t.viewport)throw new Error("No viewport provided, labelmap computation from contour requires viewports");const n=t.viewport.getImageIds();if(!n)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");n.forEach(e=>{if(!b.cache.getImageLoadObject(e))throw new Error("ImageIds must be cached before converting contour to labelmap")});const{imageIds:r}=await b.imageLoader.createAndCacheDerivedSegmentationImages(n),{segmentIndices:i,annotationUIDsInSegmentMap:o}=be(e,t),a=new Map;r.forEach((e,t)=>{const r=b.cache.getImage(e),i=b.metaData.get(b.Enums.MetadataModules.IMAGE_PLANE,e);let{columnCosines:o,rowCosines:s,rowPixelSpacing:l,columnPixelSpacing:c,imagePositionPatient:u}=i;o=o??[0,1,0],s=s??[1,0,0],l=l??1,c=c??1,u=u??[0,0,0];const d=he.R3.fromValues(s[0],s[1],s[2]),p=he.R3.fromValues(o[0],o[1],o[2]),h=he.R3.create();he.R3.cross(h,d,p);const f=[...d,...p,...h],m=[l,c,1],g=u;a.set(n[t],{direction:f,spacing:m,origin:g,scalarData:r.getPixelData(),imageId:e,dimensions:[r.width,r.height,1]})}),ge(b.eventTarget,0);const s=await me.executeTask("polySeg","convertContourToStackLabelmap",{segmentationsInfo:a,annotationUIDsInSegmentMap:o,segmentIndices:i},{callbacks:[e=>{ge(b.eventTarget,e)}]});ge(b.eventTarget,1);const l=new Map;return s.forEach(({scalarData:e},t)=>{const n=a.get(t),{imageId:r}=n,i=b.cache.getImage(r);i.getPixelData().set(e),i.imageFrame?.pixelData?.set(e),l.set(t,r)}),{imageIdReferenceMap:l}}function be(e,t={}){const n=e.annotationUIDsMap,r=t.segmentIndices?.length?t.segmentIndices:Array.from(n.keys()),i=new Map;return r.forEach(e=>{const t=n.get(e);let r=Array.from(t);r=r.filter(e=>!(0,fe.AR)(e).parentAnnotationUID);const o=r.map(e=>{const t=(0,fe.AR)(e),n=t.childAnnotationUIDs?.length;return{polyline:t.data.contour.polyline,referencedImageId:t.metadata.referencedImageId,holesPolyline:n&&t.childAnnotationUIDs.map(e=>(0,fe.AR)(e).data.contour.polyline)}});i.set(e,o)}),{segmentIndices:r,annotationUIDsInSegmentMap:i}}const Ce=(0,b.getWebWorkerManager)(),we=(e,t)=>{(0,b.triggerEvent)(e,b.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:f.WorkerTypes.POLYSEG_SURFACE_TO_LABELMAP})};async function Ee(e,t={}){const n=t.segmentIndices?.length?t.segmentIndices:(0,F.getUniqueSegmentIndices)(e);let r;const i=(0,u.getSegmentation)(e),o=i.representationData;try{o.CONTOUR?r=await async function(e,t={}){const n=t.viewport instanceof b.VolumeViewport??!0;if(n&&!t.viewport)throw new Error("Cannot compute labelmap from contour segmentation without providing the viewport");const r=t.segmentIndices?.length?t.segmentIndices:(0,F.getUniqueSegmentIndices)(e),i=(0,u.getSegmentation)(e),o=i.representationData.CONTOUR,a=n?ve:ye,s=await a(o,{segmentIndices:r,segmentationRepresentationUID:t.segmentationRepresentationUID,viewport:t.viewport});return s}(e,{segmentIndices:n,...t}):o.SURFACE&&(r=await async function(e,t={}){const n=t.viewport instanceof b.VolumeViewport??!0,r=t.segmentIndices?.length?t.segmentIndices:(0,F.getUniqueSegmentIndices)(e),i=(0,u.getSegmentation)(e),o=new Map,a=i.representationData.SURFACE;if(a.geometryIds.forEach((e,t)=>{r.includes(t)&&o.set(t,e)}),n&&!t.viewport)throw new Error("Cannot compute labelmap from surface segmentation without providing the viewport");let s;if(n){const e=t.viewport.getDefaultActor(),{uid:n}=e;s=await b.volumeLoader.createAndCacheDerivedSegmentationVolume(n)}else{const e=t.viewport.getImageIds(),n="generatedSegmentationVolumeId",r=b.utilities.generateVolumePropsFromImageIds(e,n);delete r.imageIds,s=await b.volumeLoader.createLocalSegmentationVolume({...r,scalarData:r.scalarData,referencedImageIds:e},n)}const l=await async function(e,t){const{geometryIds:n}=e;if(!n?.size)throw new Error("No geometry IDs found for surface representation");const r=new Map;n.forEach((e,t)=>{const n=b.cache.getGeometry(e).data,i=n.getPoints(),o=n.getPolys();r.set(t,{points:i,polys:o})});const{dimensions:i,direction:o,origin:a,spacing:s}=t;we(b.eventTarget,0);const l=await Ce.executeTask("polySeg","convertSurfacesToVolumeLabelmap",{segmentsInfo:r,dimensions:i,spacing:s,direction:o,origin:a},{callbacks:[e=>{we(b.eventTarget,e)}]});return we(b.eventTarget,1),t.imageData.getPointData().getScalars().setData(l),t.imageData.modified(),t.modified(),{volumeId:t.volumeId}}({geometryIds:o},s);if(n)return l;return await G({volumeId:s.volumeId})}(i.segmentationId,{segmentIndices:n,...t}))}catch(e){throw console.error(e),e}if(!r)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return r}function Te(e,t={}){return te(e,f.SegmentationRepresentations.Labelmap,()=>Ee(e,t),()=>{})}var xe=n(11510);function _e(e,t){const n=new Map;for(const[r,i]of e){const e=r.split("_")[1];for(const[r,o]of i){if(!o)continue;const r=Number(e)||t?.get(e);r&&(n.has(r)||n.set(r,[]),n.get(r).push(o))}}return n}var Se=n(27446);const Ie=e=>{const{numberOfCells:t,lines:n}=e,r=[],i=[];for(let e=0;e<n.length;){const o=n[e];if(i.push(o),r.push(n.slice(e+1,e+o+1)),e+=o+1,r.length===t)break}return{lineSegments:r,linesNumberOfPoints:i}};async function De(e,t={}){const n=t.segmentIndices?.length?t.segmentIndices:(0,F.getUniqueSegmentIndices)(e);let r;const i=(0,u.getSegmentation)(e).representationData;try{i.SURFACE?r=await async function(e,t={}){if(!t.viewport)throw new Error("Viewport is required to compute contour from surface");const{viewport:n,segmentationRepresentationUID:r}=t,i=t.segmentIndices?.length?t.segmentIndices:(0,F.getUniqueSegmentIndices)(e),o=new Map,a=new Map,s=(0,u.getSegmentation)(e),l=s.representationData.SURFACE,c=[];l.geometryIds.forEach((e,t)=>{if(i.includes(t)){o.set(t,e);const n=b.cache.getGeometry(e)?.data;n&&c.push({id:e,points:n.getPoints(),polys:n.getPolys()})}}),o.forEach((e,t)=>{a.set(e,t)});const d=await(0,xe.ZU)(c,n,r);return _e(d,a)}(e,{segmentIndices:n,...t}):i.LABELMAP&&(r=await async function(e,t={}){if(!t.viewport)throw new Error("Viewport is required to compute contour from labelmap");const n=await de(e,t);if(!n?.length)return void console.error("Failed to convert labelmap to surface or labelmap is empty");const{viewport:r,segmentationRepresentationUID:i}=t,o=n.map(e=>({id:e.segmentIndex.toString(),points:e.data.points,polys:e.data.polys,segmentIndex:e.segmentIndex})),a=await(0,xe.ZU)(o,r,i);return _e(a)}(e,{segmentIndices:n,...t}))}catch(e){throw console.error(e),e}if(!r)throw new Error("Not enough data to convert to contour, currently only support converting volume labelmap to contour if available");const{viewport:o,segmentationRepresentationUID:a}=t,s=function(e,t,n){const r=new Map;for(const[i,o]of e)for(const e of o){const{points:o}=e,{lineSegments:a,linesNumberOfPoints:s}=Ie(e);for(let e=0;e<a.length;e++){const l=a[e],c=[];for(let t=0;t<s[e];t++){const e=l[t];c.push([o[3*e],o[3*e+1],o[3*e+2]])}if(c.length<3)continue;const u={annotationUID:b.utilities.uuidv4(),data:{contour:{closed:!0,polyline:c},segmentation:{segmentationId:n,segmentIndex:i},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:Se.PlanarFreehandContourSegmentationTool.toolName,...t.getViewReference()}};(0,re.addAnnotation)(u,t.element);const d=r.get(i)||new Set;d.add(u.annotationUID),r.set(i,d)}}return r}(r,o,e),l=(0,y.getToolGroupForViewport)(o.id)?.id;return(0,u.setSegmentationRepresentationSpecificConfig)(l,a,{CONTOUR:{fillAlpha:0}}),{annotationUIDsMap:s}}function Ae(e,t={}){return te(e,f.SegmentationRepresentations.Contour,()=>De(e,t),()=>{})}const Pe=new Map([[f.SegmentationRepresentations.Labelmap,new Set([f.SegmentationRepresentations.Surface,f.SegmentationRepresentations.Contour])],[f.SegmentationRepresentations.Contour,new Set([f.SegmentationRepresentations.Labelmap,f.SegmentationRepresentations.Surface])],[f.SegmentationRepresentations.Surface,new Set([f.SegmentationRepresentations.Labelmap])]]);function Oe(e){const t=(0,u.findSegmentationRepresentationByUID)(e);if(!t?.segmentationRepresentation)return!1;const{segmentationRepresentation:n}=t,{type:r,polySeg:i}=n;if(!i||!i.enabled)return!1;const{representationData:o}=(0,u.getSegmentation)(n.segmentationId),a=function(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];let i;if(n===f.SegmentationRepresentations.Labelmap)i=l.$W;if(i)try{i(r),t.push(n)}catch(e){console.warn(`Validation failed for labelmap of type ${n}`)}else t.push(n)}),t}(o);return a.some(e=>async function(e,t){return Pe.get(e)?.has(t)||!1}(e,r))}},39163:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var r=n(62709);let i=!1;function o(){if(i)return;i=!0;(0,r.getWebWorkerManager)().registerWorker("polySeg",()=>new Worker(new URL(n.p+n.u(1985),n.b),{name:"polySeg"}),{maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:2e3}})}},43850:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getActiveSegmentIndex:()=>s,setActiveSegmentIndex:()=>a});var r=n(68203),i=n(60721),o=n(32140);function a(e,t){const n=(0,i.getSegmentation)(e);"string"==typeof t&&(console.warn("segmentIndex is a string, converting to number"),t=Number(t)),n?.activeSegmentIndex!==t&&(n.activeSegmentIndex=t,(0,o.triggerSegmentationModified)(e));(0,i.getToolGroupIdsWithSegmentation)(e).forEach(e=>{(0,r.invalidateBrushCursor)(e)})}function s(e){const t=(0,i.getSegmentation)(e);if(t)return t.activeSegmentIndex}},60721:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addColorLUT:()=>j,addSegmentation:()=>E,addSegmentationRepresentation:()=>L,findSegmentationRepresentationByUID:()=>S,getAllSegmentationRepresentations:()=>x,getColorLUT:()=>z,getDefaultSegmentationStateManager:()=>b,getGlobalConfig:()=>k,getNextColorLUTIndex:()=>H,getSegmentSpecificRepresentationConfig:()=>R,getSegmentation:()=>C,getSegmentationIdRepresentations:()=>_,getSegmentationRepresentationByUID:()=>V,getSegmentationRepresentationSpecificConfig:()=>O,getSegmentationRepresentations:()=>T,getSegmentations:()=>w,getToolGroupIdFromSegmentationRepresentationUID:()=>N,getToolGroupIdsWithSegmentation:()=>I,getToolGroupSpecificConfig:()=>D,removeColorLUT:()=>W,removeSegmentation:()=>U,removeSegmentationRepresentation:()=>B,removeSegmentationRepresentations:()=>G,setGlobalConfig:()=>F,setSegmentSpecificRepresentationConfig:()=>M,setSegmentationRepresentationSpecificConfig:()=>P,setToolGroupSpecificConfig:()=>A});var r=n(11677),i=n.n(r),o=n(62709),a=n(68096);const s={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidthActive:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDashActive:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};const l=function(){return s};var c=n(35904);const u={renderFill:!0,fillAlpha:1};const d=function(){return u},p=(0,c.Z)(),h=l(),f=d(),m={colorLUT:[],segmentations:[],globalConfig:{renderInactiveSegmentations:!0,representations:{[a.SegmentationRepresentations.Labelmap]:p,[a.SegmentationRepresentations.Contour]:h,[a.SegmentationRepresentations.Surface]:f}},toolGroups:{}};const g=new class{constructor(e){e||(e=o.utilities.uuidv4()),this.state=i()(m),this.uid=e}getState(){return this.state}getToolGroups(){return Object.keys(this.state.toolGroups)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this.state=i()(m)}getSegmentation(e){return this.state.segmentations.find(t=>t.segmentationId===e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.state.segmentations.push(e)}getSegmentationRepresentations(e){const t=this.state.toolGroups[e];if(t)return t.segmentationRepresentations}getAllSegmentationRepresentations(){const e={};return Object.entries(this.state.toolGroups).forEach(([t,n])=>{e[t]=n.segmentationRepresentations}),e}addSegmentationRepresentation(e,t){this.state.toolGroups[e]||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{}}),this.state.toolGroups[e].segmentationRepresentations.push(t),this._handleActiveSegmentation(e,t)}getGlobalConfig(){return this.state.globalConfig}setGlobalConfig(e){this.state.globalConfig=e}getSegmentationRepresentationByUID(e,t){const n=this.getSegmentationRepresentations(e),r=n?.find(e=>e.segmentationRepresentationUID===t);return r}removeSegmentation(e){this.state.segmentations=this.state.segmentations.filter(t=>t.segmentationId!==e)}removeSegmentationRepresentation(e,t){const n=this.getSegmentationRepresentations(e);if(!n||!n.length)throw new Error(`No viewport specific segmentation state found for viewport ${e}`);const r=n.findIndex(e=>e.segmentationRepresentationUID===t);-1===r&&console.warn(`No viewport specific segmentation state data found for viewport ${e} and segmentation data UID ${t}`);const i=n[r];n.splice(r,1),this._handleActiveSegmentation(e,i)}setActiveSegmentationRepresentation(e,t){const n=this.getSegmentationRepresentations(e);if(!n||!n.length)throw new Error(`No segmentation data found for toolGroupId: ${e}`);const r=n.find(e=>e.segmentationRepresentationUID===t);if(!r)throw new Error(`No segmentation data found for segmentation data UID ${t}`);r.active=!0,this._handleActiveSegmentation(e,r)}getToolGroupSpecificConfig(e){const t=this.state.toolGroups[e];if(t)return t.config}getSegmentationRepresentationSpecificConfig(e,t){const n=this.getSegmentationRepresentationByUID(e,t);if(n)return n.segmentationRepresentationSpecificConfig}setSegmentationRepresentationSpecificConfig(e,t,n){const r=this.getSegmentationRepresentationByUID(e,t);r&&(r.segmentationRepresentationSpecificConfig=n)}getSegmentSpecificConfig(e,t,n){const r=this.getSegmentationRepresentationByUID(e,t);if(r)return r.segmentSpecificConfig[n]}setSegmentSpecificConfig(e,t,n,r){const i=this.getSegmentationRepresentationByUID(e,t);i&&(i.segmentSpecificConfig&&!r?.clear||(i.segmentSpecificConfig={}),Object.keys(n).forEach(e=>{i.segmentSpecificConfig[e]=n[e]}))}setSegmentationRepresentationConfig(e,t){let n=this.state.toolGroups[e];n||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{renderInactiveSegmentations:!0,representations:{}}},n=this.state.toolGroups[e]),n.config={...n.config,...t}}addColorLUT(e,t){this.state.colorLUT[t]&&console.warn("Color LUT table already exists, overwriting"),this.state.colorLUT[t]=i()(e)}removeColorLUT(e){delete this.state.colorLUT[e]}_handleActiveSegmentation(e,t){const n=this.getSegmentationRepresentations(e);if(0===n.length)return;if(1===n.length)return void(n[0].active=!0);0!==n.filter(e=>e.active).length?t.active&&n.forEach(e=>{e.segmentationRepresentationUID!==t.segmentationRepresentationUID&&(e.active=!1)}):n[0].active=!0}}("DEFAULT");var v=n(32140);const y=function(e){const{segmentationId:t,representation:n}=e,r=n.type===a.SegmentationRepresentations.Contour;let i=n.data?{...n.data}:null;if(i=!i&&r?{}:i,!i)throw new Error("Segmentation representation data may not be undefined");if(r){const e=i;e.geometryIds=e.geometryIds??[],e.annotationUIDsMap=e.annotationUIDsMap??new Map}return{segmentationId:t,cachedStats:{},segmentLabels:{},label:null,segmentsLocked:new Set,type:n.type,activeSegmentIndex:1,representationData:{[n.type]:{...i}}}};function b(){return g}function C(e){return b().getSegmentation(e)}function w(){return b().getState().segmentations}function E(e,t){const n=b(),r=y(e);n.addSegmentation(r),t||(0,v.triggerSegmentationModified)(r.segmentationId)}function T(e){return b().getSegmentationRepresentations(e)}function x(){return b().getAllSegmentationRepresentations()}function _(e){const t=x()||{},n=[];for(const r in t){const i=t[r].find(t=>t.segmentationId===e);i&&n.push(i)}return n}function S(e){const t=x()||[],n=Object.keys(t);for(const t of n){const n=x()[t].find(t=>t.segmentationRepresentationUID===e);if(n)return{segmentationRepresentation:n,toolGroupId:t}}}function I(e){if(!e)throw new Error("getToolGroupIdsWithSegmentation: segmentationId is empty");const t=b(),n=t.getState(),r=Object.keys(n.toolGroups),i=[];return r.forEach(n=>{t.getSegmentationRepresentations(n).forEach(t=>{t.segmentationId===e&&i.push(n)})}),i}function D(e){return b().getToolGroupSpecificConfig(e)}function A(e,t,n){b().setSegmentationRepresentationConfig(e,t),n||(0,v.triggerSegmentationRepresentationModified)(e)}function P(e,t,n,r=!1){b().setSegmentationRepresentationSpecificConfig(e,t,n),r||(0,v.triggerSegmentationRepresentationModified)(e,t)}function O(e,t){return b().getSegmentationRepresentationSpecificConfig(e,t)}function R(e,t,n){return b().getSegmentSpecificConfig(e,t,n)}function M(e,t,n,r=!1){b().setSegmentSpecificConfig(e,t,n),r||(0,v.triggerSegmentationRepresentationModified)(e,t)}function N(e){const t=x()||[],n=Object.keys(t);for(const t of n){if(x()[t].find(t=>t.segmentationRepresentationUID===e))return t}}function L(e,t,n){b().addSegmentationRepresentation(e,t),n||(0,v.triggerSegmentationRepresentationModified)(e,t.segmentationRepresentationUID)}function k(){return b().getGlobalConfig()}function F(e,t){b().setGlobalConfig(e),t||(0,v.triggerSegmentationModified)()}function V(e,t){return b().getSegmentationRepresentationByUID(e,t)}function U(e){b().removeSegmentation(e),(0,v.triggerSegmentationRemoved)(e)}function B(e,t){b().removeSegmentationRepresentation(e,t),(0,v.triggerSegmentationRepresentationRemoved)(e,t)}function G(e){(T(e)||[]).forEach(t=>{B(e,t.segmentationRepresentationUID)})}function W(e){b().removeColorLUT(e)}function z(e){return b().getColorLUT(e)}function H(){return b().getNextColorLUTIndex()}function j(e,t){b().addColorLUT(e,t)}},32140:(e,t,n)=>{"use strict";n.r(t),n.d(t,{triggerSegmentationDataModified:()=>d,triggerSegmentationModified:()=>u,triggerSegmentationRemoved:()=>s,triggerSegmentationRepresentationModified:()=>c,triggerSegmentationRepresentationRemoved:()=>l});var r=n(62709),i=n(68096),o=n(60721),a=n(23267);function s(e){const t={segmentationId:e};(0,r.triggerEvent)(r.eventTarget,i.Events.SEGMENTATION_REMOVED,t)}function l(e,t){const n={toolGroupId:e,segmentationRepresentationUID:t};(0,r.triggerEvent)(r.eventTarget,i.Events.SEGMENTATION_REPRESENTATION_REMOVED,n)}function c(e,t){const n={toolGroupId:e,segmentationRepresentationUID:t};if(t)return void(0,r.triggerEvent)(r.eventTarget,i.Events.SEGMENTATION_REPRESENTATION_MODIFIED,n);((0,o.getSegmentationRepresentations)(e)||[]).forEach(t=>{const{segmentationRepresentationUID:n}=t,o={toolGroupId:e,segmentationRepresentationUID:n};(0,r.triggerEvent)(r.eventTarget,i.Events.SEGMENTATION_REPRESENTATION_MODIFIED,o)})}function u(e){let t;t=e?[e]:(0,o.getSegmentations)().map(({segmentationId:e})=>e),t.forEach(e=>{const t={segmentationId:e};(0,r.triggerEvent)(r.eventTarget,i.Events.SEGMENTATION_MODIFIED,t)})}function d(e,t){const n={segmentationId:e,modifiedSlicesToUse:t};(0,a.gK)(e),(0,r.triggerEvent)(r.eventTarget,i.Events.SEGMENTATION_DATA_MODIFIED,n)}},64331:(e,t,n)=>{"use strict";n(62709)},34262:(e,t,n)=>{"use strict";n(33232)},36779:(e,t,n)=>{"use strict";n(33232),n(64331);n(34262)},26003:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(62709),i=n(33232);const o=function(e,t){t||(t=(0,r.getRenderingEngines)().find(t=>t.getViewports().find(t=>t.id===e))?.id);const n=i.SB.toolGroups.filter(n=>n.viewportsInfo.some(n=>n.renderingEngineId===t&&(!n.viewportId||n.viewportId===e)));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${t} and viewportId: ${e}. You should only\n      have one tool group per viewport in a renderingEngine.`);return n[0]}}},27078:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createToolGroup:()=>r.Z,destroy:()=>o.Z,destroyToolGroup:()=>i.Z,getAllToolGroups:()=>l.Z,getToolGroup:()=>a.Z,getToolGroupForViewport:()=>s.Z,getToolGroupsWithToolName:()=>c.Z});var r=n(36048),i=n(85325),o=n(878),a=n(69160),s=n(26003),l=n(20568),c=n(24321)},80769:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(86614);function i(e,t){const n=[];for(let i=0;i<t.length;i++){const o=t[i];if(!o){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let a=(0,r.getAnnotations)(o.constructor.toolName,e);a?.length&&(a.length>0&&n.push({tool:o,annotations:a}))}return n}},33232:(e,t,n)=>{"use strict";n.d(t,{fT:()=>o,LK:()=>i,SB:()=>r.ZP});var r=n(90065);function i(e){const t=e.toolName,n=void 0!==r.SB.tools[t];if(!t)throw new Error(`No Tool Found for the ToolClass ${e.name}`);if(n)throw new Error(`${t} has already been added globally`);r.SB.tools[t]={toolClass:e}}n(62486),n(57864),n(64307);n(62709),n(80769),n(67298),n(68096),n(50097),n(34262),n(26003);n(64331),n(9345);var o=n(27078);n(36779)},90065:(e,t,n)=>{"use strict";n.d(t,{SB:()=>i,ZP:()=>i});var r=n(9345);n(11677);r.Z;let i={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:r.Z,enabledElements:[],handleRadius:6}},9345:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});let r={};const i=r},93423:(e,t,n)=>{"use strict";n(36779);var r=n(62709);const{CAMERA_MODIFIED:i}=r.Enums.Events;const{CAMERA_MODIFIED:o}=r.Enums.Events;const{CAMERA_MODIFIED:a}=r.Enums.Events;n(72076),n(79454);const{STACK_NEW_IMAGE:s,VOLUME_NEW_IMAGE:l}=r.Enums.Events;const{CAMERA_MODIFIED:c}=r.Enums.Events},34572:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var r=n(93382),i=n(62709),o=n(86614),a=n(11163),s=n(41836),l=n(36705),c=n(86785),u=n(33232),d=n(68096),p=n(46966),h=n(23118),f=n(66878),m=n(57776),g=n(72076),v=n(79454),y=n(93725),b=n(27446),C=n(74474);const w=e=>e.uid!==e.referenceId;class E{constructor({magnifyViewportId:e,sourceEnabledElement:t,radius:n=125,position:r=[0,0],zoomFactor:o,autoPan:a}){this._enabledElement=null,this._sourceToolGroup=null,this._magnifyToolGroup=null,this._isViewportReady=!1,this._radius=0,this._resized=!1,this._canAutoPan=!1,this._viewportId=e??i.utilities.uuidv4(),this._sourceEnabledElement=t,this._autoPan=a,this.radius=n,this.position=r,this.zoomFactor=o,this.visible=!0,this._browserMouseDownCallback=this._browserMouseDownCallback.bind(this),this._browserMouseUpCallback=this._browserMouseUpCallback.bind(this),this._handleToolModeChanged=this._handleToolModeChanged.bind(this),this._mouseDragCallback=this._mouseDragCallback.bind(this),this._resizeViewportAsync=(0,v.debounce)(this._resizeViewport.bind(this),1),this._initialize()}get sourceEnabledElement(){return this._sourceEnabledElement}get viewportId(){return this._viewportId}get radius(){return this._radius}set radius(e){Math.abs(this._radius-e)>1e-5&&(this._radius=e,this._resized=!0)}update(){const{radius:e,position:t,visible:n}=this,{viewport:r}=this._enabledElement,{element:i}=r,o=2*e,[a,s]=t;this._resized&&(this._resizeViewportAsync(),this._resized=!1),Object.assign(i.style,{display:n?"block":"hidden",width:`${o}px`,height:`${o}px`,left:-e+"px",top:-e+"px",transform:`translate(${a}px, ${s}px)`}),this._isViewportReady&&(this._syncViewports(),r.render())}dispose(){const{viewport:e}=this._enabledElement,{element:t}=e,n=e.getRenderingEngine();this._removeEventListeners(t),n.disableElement(e.id),t.parentNode&&t.parentNode.removeChild(t)}_handleToolModeChanged(e){const{_magnifyToolGroup:t}=this,{toolGroupId:n,toolName:r,mode:i,toolBindingsOptions:o}=e.detail;if(this._sourceToolGroup?.id===n)switch(i){case d.ToolModes.Active:t.setToolActive(r,o);break;case d.ToolModes.Passive:t.setToolPassive(r);break;case d.ToolModes.Enabled:t.setToolEnabled(r);break;case d.ToolModes.Disabled:t.setToolDisabled(r);break;default:throw new Error(`Unknow tool mode (${i})`)}}_inheritBorderRadius(e){const t=e.querySelector(".viewport-element"),n=e.querySelector(".cornerstone-canvas");t.style.borderRadius="inherit",n.style.borderRadius="inherit"}_createViewportNode(){const e=document.createElement("div"),{radius:t}=this,n=2*t;return e.classList.add("advancedMagnifyTool"),Object.assign(e.style,{display:"block",width:`${n}px`,height:`${n}px`,position:"absolute",overflow:"hidden",borderRadius:"50%",boxSizing:"border-box",left:-t+"px",top:-t+"px",transform:"translate(-1000px, -1000px)"}),e}_convertZoomFactorToParallelScale(e,t,n){const{parallelScale:r}=e.getCamera();return r*(1/n)*(t.canvas.offsetWidth/e.canvas.offsetWidth)}_isStackViewport(e){return"setStack"in e}_isVolumeViewport(e){return"addVolumes"in e}_cloneToolGroups(e,t){const n=e.getActors(),r=`${t.id}-toolGroup`,i=u.fT.getToolGroupForViewport(e.id,e.renderingEngineId),o=i.clone(r,e=>{const t=i.getToolInstance(e);return t instanceof b.A8&&!(t instanceof b.tv)||e===b.xX.toolName});return o.addViewport(t.id,t.renderingEngineId),n.filter(w).forEach(e=>{y.segmentation.addSegmentationRepresentations(r,[{segmentationId:e.referenceId,type:d.SegmentationRepresentations.Labelmap}])}),{sourceToolGroup:i,magnifyToolGroup:o}}_cloneStack(e,t){const n=e.getImageIds();t.setStack(n).then(()=>{this._isViewportReady=!0,this.update()})}_cloneVolumes(e,t){const n=e.getActors().filter(e=>!w(e)).map(e=>({volumeId:e.uid}));return t.setVolumes(n).then(()=>{this._isViewportReady=!0,this.update()}),t}_cloneViewport(e,t){const{viewportId:n}=this,r=e.getRenderingEngine(),{options:i}=e,o={element:t,viewportId:n,type:e.type,defaultOptions:{...i}};r.enableElement(o);const a=r.getViewport(n);this._isStackViewport(e)?this._cloneStack(e,a):this._isVolumeViewport(e)&&this._cloneVolumes(e,a),this._inheritBorderRadius(t);const s=this._cloneToolGroups(e,a);this._sourceToolGroup=s.sourceToolGroup,this._magnifyToolGroup=s.magnifyToolGroup}_cancelMouseEventCallback(e){e.stopPropagation(),e.preventDefault()}_browserMouseUpCallback(e){const{element:t}=this._enabledElement.viewport;document.removeEventListener("mouseup",this._browserMouseUpCallback),t.addEventListener("mouseup",this._cancelMouseEventCallback),t.addEventListener("mousemove",this._cancelMouseEventCallback)}_browserMouseDownCallback(e){const{element:t}=this._enabledElement.viewport;this._canAutoPan=!!e.target?.closest(".advancedMagnifyTool"),document.addEventListener("mouseup",this._browserMouseUpCallback),t.removeEventListener("mouseup",this._cancelMouseEventCallback),t.removeEventListener("mousemove",this._cancelMouseEventCallback)}_mouseDragCallback(e){if(!u.SB.isInteractingWithTool)return;const{_autoPan:t}=this;if(!t.enabled||!this._canAutoPan)return;const{currentPoints:n}=e.detail,{viewport:r}=this._enabledElement,{canvasToWorld:i}=r,{canvas:o}=n,{radius:a}=this,s=[a,a],l=(0,C.distanceToPoint)(s,o),c=a-t.padding;if(l<=c)return;const d=l-c,p=g.K4.sub(g.K4.create(),o,s);g.K4.normalize(p,p),g.K4.scale(p,p,d);const h=g.K4.add(g.K4.create(),this.position,p),f=i(this.position),m=i(h),v=g.R3.sub(g.R3.create(),m,f),y={points:{currentPosition:{canvas:this.position,world:f},newPosition:{canvas:h,world:m}},delta:{canvas:p,world:v}};t.callback(y)}_addBrowserEventListeners(e){document.addEventListener("mousedown",this._browserMouseDownCallback,!0),e.addEventListener("mousedown",this._cancelMouseEventCallback),e.addEventListener("mouseup",this._cancelMouseEventCallback),e.addEventListener("mousemove",this._cancelMouseEventCallback),e.addEventListener("dblclick",this._cancelMouseEventCallback)}_removeBrowserEventListeners(e){document.removeEventListener("mousedown",this._browserMouseDownCallback,!0),document.removeEventListener("mouseup",this._browserMouseUpCallback),e.removeEventListener("mousedown",this._cancelMouseEventCallback),e.removeEventListener("mouseup",this._cancelMouseEventCallback),e.removeEventListener("mousemove",this._cancelMouseEventCallback),e.removeEventListener("dblclick",this._cancelMouseEventCallback)}_addEventListeners(e){i.eventTarget.addEventListener(d.Events.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(d.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(d.Events.MOUSE_DRAG,this._mouseDragCallback),this._addBrowserEventListeners(e)}_removeEventListeners(e){i.eventTarget.removeEventListener(d.Events.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(d.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(d.Events.MOUSE_DRAG,this._mouseDragCallback),this._removeBrowserEventListeners(e)}_initialize(){const{_sourceEnabledElement:e}=this,{viewport:t}=e,{canvas:n}=t,r=this._createViewportNode();n.parentNode.appendChild(r),this._addEventListeners(r),this._cloneViewport(t,r),this._enabledElement=(0,i.getEnabledElement)(r)}_syncViewportsCameras(e,t){const n=e.canvasToWorld(this.position),r=this._convertZoomFactorToParallelScale(e,t,this.zoomFactor),{focalPoint:i,position:o,viewPlaneNormal:a}=t.getCamera(),s=Math.sqrt(Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2)+Math.pow(i[2]-o[2],2)),l=[n[0],n[1],n[2]],c=[l[0]+s*a[0],l[1]+s*a[1],l[2]+s*a[2]];t.setCamera({parallelScale:r,focalPoint:l,position:c})}_syncStackViewports(e,t){t.setImageIdIndex(e.getCurrentImageIdIndex())}_syncViewports(){const{viewport:e}=this._sourceEnabledElement,{viewport:t}=this._enabledElement,n=e.getProperties();t.getImageData()&&(t.setProperties(n),this._syncViewportsCameras(e,t),this._isStackViewport(e)&&this._syncStackViewports(e,t),this._syncViewportsCameras(e,t),t.render())}_resizeViewport(){const{viewport:e}=this._enabledElement;e.getRenderingEngine().resize()}}const T=1-i.CONSTANTS.EPSILON,{Events:x}=i.Enums;class _{constructor(){this.createViewport=(e,t)=>{const{magnifyViewportId:n,sourceEnabledElement:r,position:i,radius:o,zoomFactor:a,autoPan:s}=t,{viewport:l}=r,{element:c}=l,u=new E({magnifyViewportId:n,sourceEnabledElement:r,radius:o,position:i,zoomFactor:a,autoPan:s});return this._addSourceElementEventListener(c),this._magnifyViewportsMap.set(u.viewportId,{annotation:e,magnifyViewport:u,magnifyViewportInfo:t}),u},this._annotationRemovedCallback=e=>{const{annotation:t}=e.detail;"AdvancedMagnify"===t.metadata.toolName&&this.destroyViewport(t.data.magnifyViewportId)},this._newStackImageCallback=e=>{const{viewportId:t,imageId:n}=e.detail,r=this._getMagnifyViewportsMapEntriesBySourceViewportId(t),{viewport:o}=(0,i.getEnabledElementByViewportId)(t);o.stackActorReInitialized&&this._reset(t),r.forEach(({annotation:e})=>{e.metadata.referencedImageId=n,e.invalidated=!0})},this._newVolumeImageCallback=e=>{const{renderingEngineId:t,viewportId:n}=e.detail,r=(0,i.getRenderingEngine)(t).getViewport(n),{viewPlaneNormal:o}=r.getCamera();this._getMagnifyViewportsMapEntriesBySourceViewportId(n).forEach(({annotation:e})=>{const{viewPlaneNormal:t}=e.metadata;if(!(Math.abs(g.R3.dot(t,o))>T))return;const{handles:n}=e.data,i=r.canvasToWorld([0,0]),a=g.R3.sub(g.R3.create(),i,n.points[0]),s=g.R3.dot(a,o),l=g.R3.scale(g.R3.create(),o,s);for(let e=0,t=n.points.length;e<t;e++){const t=n.points[e];t[0]+=l[0],t[1]+=l[1],t[2]+=l[2]}e.invalidated=!0})},this._magnifyViewportsMap=new Map,this._initialize()}static getInstance(){return _._singleton=_._singleton??new _,_._singleton}getViewport(e){return this._magnifyViewportsMap.get(e)?.magnifyViewport}dispose(){this._removeEventListeners(),this._destroyViewports()}destroyViewport(e){const t=this._magnifyViewportsMap.get(e);if(t){const{magnifyViewport:n}=t,{viewport:r}=n.sourceEnabledElement,{element:i}=r;this._removeSourceElementEventListener(i),n.dispose(),this._magnifyViewportsMap.delete(e)}}_destroyViewports(){Array.from(this._magnifyViewportsMap.keys()).forEach(e=>this.destroyViewport(e))}_getMagnifyViewportsMapEntriesBySourceViewportId(e){return Array.from(this._magnifyViewportsMap.values()).filter(({magnifyViewport:t})=>{const{viewport:n}=t.sourceEnabledElement;return n.id===e})}_reset(e){this._getMagnifyViewportsMapEntriesBySourceViewportId(e).forEach(({magnifyViewport:t,annotation:n,magnifyViewportInfo:r})=>{this.destroyViewport(t.viewportId);const o=(0,i.getEnabledElementByViewportId)(e);this.createViewport(n,{...r,sourceEnabledElement:{...o}})})}_addEventListeners(){i.eventTarget.addEventListener(d.Events.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_removeEventListeners(){i.eventTarget.removeEventListener(d.Events.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_addSourceElementEventListener(e){e.addEventListener(x.STACK_NEW_IMAGE,this._newStackImageCallback);const t=e=>{const{viewportId:t}=e.detail;this._reset(t)};e.addEventListener(x.STACK_VIEWPORT_NEW_STACK,t);const n=e=>{const{viewportId:t}=e.detail;this._reset(t)};e.addEventListener(x.VOLUME_VIEWPORT_NEW_VOLUME,n),e.addEventListener(x.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.newStackHandler=t,e.newVolumeHandler=n}_removeSourceElementEventListener(e){e.removeEventListener(x.STACK_NEW_IMAGE,this._newStackImageCallback),e.removeEventListener(x.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.removeEventListener(x.STACK_VIEWPORT_NEW_STACK,e.newStackHandler),e.removeEventListener(x.VOLUME_VIEWPORT_NEW_VOLUME,e.newVolumeHandler),delete e.newStackHandler,delete e.newVolumeHandler}_initialize(){this._addEventListeners()}}var S;!function(e){e.ShowZoomFactorsList="showZoomFactorsList"}(S||(S={}));class I extends r.A8{static{this.Actions=S}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,magnifyingGlass:{radius:125,zoomFactor:3,zoomFactorList:[1.5,2,2.5,3,3.5,4,4.5,5],autoPan:{enabled:!0,padding:10}},actions:{showZoomFactorsList:{method:"showZoomFactorsList",bindings:[{mouseButton:d.MouseBindings.Secondary,modifierKey:d.KeyboardBindings.Shift}]}}}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,a=(0,i.getEnabledElement)(r),{viewport:s,renderingEngine:l}=a,c=n.world,u=n.canvas,{magnifyingGlass:d}=this.configuration,{radius:h,zoomFactor:m,autoPan:g}=d,v=this._getCanvasHandlePoints(u,h),y=s.getCamera(),{viewPlaneNormal:b,viewUp:C}=y,w=this.getReferencedImageId(s,c,b,C),E=i.utilities.uuidv4(),T=i.utilities.uuidv4(),x=s.getFrameOfReferenceUID(),_={annotationUID:E,highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...b],viewUp:[...C],FrameOfReferenceUID:x,referencedImageId:w},data:{sourceViewportId:s.id,magnifyViewportId:T,zoomFactor:m,isCanvasAnnotation:!0,handles:{points:v,activeHandleIndex:null}}};this.magnifyViewportManager.createViewport(_,{magnifyViewportId:T,sourceEnabledElement:a,position:u,radius:h,zoomFactor:m,autoPan:{enabled:g.enabled,padding:g.padding,callback:e=>{const t=_.data.handles.points,{canvas:n}=e.delta;for(let e=0,r=t.length;e<r;e++){const r=t[e];r[0]+=n[0],r[1]+=n[1],_.invalidated=!0}}}}),(0,o.addAnnotation)(_,r);const S=(0,p.getViewportIdsWithToolToRender)(r,this.getToolName());return e.preventDefault(),(0,f.Z)(l,S),_},this.onSetToolDisabled=()=>{this.magnifyViewportManager.dispose();(0,o.getAllAnnotations)().forEach(e=>{e.metadata.toolName===this.getToolName()&&(0,o.removeAnnotation)(e.annotationUID)})},this.isPointNearTool=(e,t,n,r)=>{const{data:i}=t,{points:o}=i.handles,a=o,s=a[0],l=a[2],c=a[3],u=.5*Math.abs(l[1]-s[1]),d=[c[0]+u,s[1]+u],p=(0,m.t)([d,n]);return Math.abs(p-u)<2*r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,p.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o},(0,h.hideElementCursor)(r),this._activateModify(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,f.Z)(s,o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;const{points:s}=a.handles,l=s.findIndex(e=>e===n),c=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:l},this._activateModify(o),(0,h.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,f.Z)(d,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=r;s.handles.activeHandleIndex=null,this._deactivateModify(n),(0,h.resetElementCursor)(n);const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;this.editData=null,this.isDrawing=!1,(0,f.Z)(u,o),a&&(0,l.F$)(r)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n,deltaPoints:r}=t,o=r?.canvas??[0,0,0],a=(0,i.getEnabledElement)(n),{renderingEngine:s}=a,{annotation:l,viewportIdsToRender:c}=this.editData,{points:u}=l.data.handles;u.forEach(e=>{e[0]+=o[0],e[1]+=o[1]}),l.invalidated=!0,this.editData.hasMoved=!0,(0,f.Z)(s,c)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a}=this.editData,{data:s}=r;if(void 0===a){const{deltaPoints:e}=t,n=e.canvas;s.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1]}),r.invalidated=!0}else this._dragHandle(e),r.invalidated=!0;const l=(0,i.getEnabledElement)(n),{renderingEngine:c}=l;(0,f.Z)(c,o)},this._dragHandle=e=>{const t=e.detail,{annotation:n}=this.editData,{data:r}=n,{points:i}=r.handles,o=i,a=o[0],s=o[2],l=o[3],c=.5*Math.abs(s[1]-a[1]),u=[l[0]+c,a[1]+c],{currentPoints:d}=t,p=d.canvas,h=(0,m.t)([u,p]),f=this._getCanvasHandlePoints(u,h);i[0]=f[0],i[1]=f[1],i[2]=f[2],i[3]=f[3]},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateModify(e),(0,h.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const a=(0,i.getEnabledElement)(e),{renderingEngine:s}=a;return(0,f.Z)(s,n),r&&(0,l.F$)(t),this.editData=null,t.annotationUID},this._activateModify=e=>{u.SB.isInteractingWithTool=!0,e.addEventListener(d.Events.MOUSE_UP,this._endCallback),e.addEventListener(d.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(d.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(d.Events.TOUCH_END,this._endCallback),e.addEventListener(d.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(d.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{u.SB.isInteractingWithTool=!1,e.removeEventListener(d.Events.MOUSE_UP,this._endCallback),e.removeEventListener(d.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(d.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(d.Events.TOUCH_END,this._endCallback),e.removeEventListener(d.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(d.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let l=(0,o.getAnnotations)(this.getToolName(),i);if(!l?.length)return n;l=l?.filter(e=>e.data.sourceViewportId===r.id);const u=this.filterInteractableAnnotationsForElement(i,l);if(!u?.length)return n;const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<u.length;e++){const i=u[e],{annotationUID:o,data:l}=i,{magnifyViewportId:p,zoomFactor:h,handles:f}=l,{points:m,activeHandleIndex:g}=f;d.annotationUID=o;this.getStyle("lineWidth",d,i),this.getStyle("lineDash",d,i);const v=this.getStyle("color",d,i),y=m,b=y[0],C=y[2],w=y[3],E=.5*Math.abs(C[1]-b[1]),T=[w[0]+E,b[1]+E];if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let x;if(!(0,s.isAnnotationVisible)(o))continue;if((0,a.isAnnotationLocked)(i)||this.editData||null===g||(x=[y[g]]),x){const e="0";(0,c.drawHandles)(t,o,e,x,{color:v})}const _=`${o}-advancedMagnify`,S="0";(0,c.drawCircle)(t,o,S,T,E,{color:v,lineWidth:5},_);const I=this.magnifyViewportManager.getViewport(p);I.position=T,I.radius=E,I.zoomFactor=h,I.update(),n=!0}return n},this._getCanvasHandlePoints=(e,t)=>[[e[0],e[1]-t,0],[e[0]+t,e[1],0],[e[0],e[1]+t,0],[e[0]-t,e[1],0]],this.magnifyViewportManager=_.getInstance()}showZoomFactorsList(e,t){const{element:n,currentPoints:r}=e.detail,o=(0,i.getEnabledElement)(n),{viewport:a}=o,{canvas:s}=r,l=n.querySelector(":scope .viewport-element"),c=t.data.zoomFactor,u=this._getZoomFactorsListDropdown(c,e=>{void 0!==e&&(t.data.zoomFactor=Number.parseFloat(e),t.invalidated=!0),u.parentElement.removeChild(u),a.render()});Object.assign(u.style,{left:`${s[0]}px`,top:`${s[1]}px`}),l.appendChild(u),u.focus()}_getZoomFactorsListDropdown(e,t){const{zoomFactorList:n}=this.configuration.magnifyingGlass,r=document.createElement("select");return r.size=5,Object.assign(r.style,{width:"50px",position:"absolute"}),["mousedown","mouseup","mousemove","click"].forEach(e=>{r.addEventListener(e,e=>e.stopPropagation())}),r.addEventListener("change",e=>{e.stopPropagation(),t(r.value)}),r.addEventListener("keydown",e=>{((e.keyCode??27===e.which)||"escape"===e.key?.toLowerCase())&&(e.stopPropagation(),t())}),n.forEach(t=>{const n=document.createElement("option");n.label=t,n.title=`Zoom factor ${t.toFixed(1)}`,n.value=t,n.defaultSelected=t===e,r.add(n)}),r}}I.toolName="AdvancedMagnify"},32839:(e,t,n)=>{"use strict";var r=n(93382),i=n(33232),o=n(86614),a=n(91398);class s extends r.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.preMouseDownCallback=e=>this._deleteNearbyAnnotations(e,"mouse"),this.preTouchStartCallback=e=>this._deleteNearbyAnnotations(e,"touch")}_deleteNearbyAnnotations(e,t){const{renderingEngineId:n,viewportId:r,element:s,currentPoints:l}=e.detail,c=i.fT.getToolGroupForViewport(r,n);if(!c)return!1;const u=c._toolInstances,d=[];for(const e in u){const n=u[e];if("function"!=typeof n.isPointNearTool||"function"!=typeof n.filterInteractableAnnotationsForElement)continue;const r=(0,o.getAnnotations)(e,s);if(!r.length)continue;const i=n.filterInteractableAnnotationsForElement(s,r)||[];for(const e of i)n.isPointNearTool(s,e,l.canvas,10,t)&&d.push(e.annotationUID)}for(const e of d)(0,a.setAnnotationSelected)(e),(0,o.removeAnnotation)(e);return e.preventDefault(),!0}}s.toolName="Eraser"},25856:(e,t,n)=>{"use strict";var r=n(72076),i=n(32899),o=n(45802),a=n(93382),s=n(62709),l=n(27078),c=n(86614),u=n(86785),d=n(33232),p=n(68096),h=n(46966),f=n(23118),m=n(3467),g=n(79922),v=n(11163),y=n(66878);const{RENDERING_DEFAULTS:b}=s.CONSTANTS;function C(){return"rgb(0, 200, 0)"}function w(){return!0}function E(){return!0}function T(){return!0}const x=1,_=2,S=3;class I extends a.A8{constructor(e={},t={supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},autoPan:{enabled:!1,panSize:10},referenceLinesCenterGapRadius:20,filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:s.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND,mobile:{enabled:!1,opacity:.8,handleRadius:9}}}){super(e,t),this.toolCenter=[0,0,0],this.initializeViewport=({renderingEngineId:e,viewportId:t})=>{const n=(0,s.getEnabledElementByIds)(t,e),{FrameOfReferenceUID:r,viewport:i}=n,{element:o}=i,{position:a,focalPoint:l,viewPlaneNormal:u}=i.getCamera();let d=this._getAnnotations(n);d=this.filterInteractableAnnotationsForElement(o,d),d.length&&(0,c.removeAnnotation)(d[0].annotationUID);const p={highlighted:!1,metadata:{cameraPosition:[...a],cameraFocalPoint:[...l],FrameOfReferenceUID:r,toolName:this.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:this.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:t}};return(0,c.addAnnotation)(p,o),{normal:u,point:i.canvasToWorld([i.canvas.clientWidth/2,i.canvas.clientHeight/2])}},this._getViewportsInfo=()=>(0,l.getToolGroup)(this.toolGroupId).viewportsInfo,this.resetCrosshairs=()=>{const e=this._getViewportsInfo();e.forEach(({viewportId:e,renderingEngineId:t})=>{const n=(0,s.getEnabledElementByIds)(e,t),{viewport:r}=n;r.resetCamera(!0,!0,!0,!0,!0),r.resetSlabThickness();const{element:i}=r;let o=this._getAnnotations(n);o=this.filterInteractableAnnotationsForElement(i,o),o.length&&(0,c.removeAnnotation)(o[0].annotationUID),r.render()}),this.computeToolCenter(e)},this.computeToolCenter=e=>{if(!e.length||1===e.length)return void console.warn("For crosshairs to operate, at least two viewports must be given.");const[t,n,i]=e,{normal:o,point:a}=this.initializeViewport(t),{normal:l,point:c}=this.initializeViewport(n);let u=[0,0,0],d=r.R3.create();i?({normal:u,point:d}=this.initializeViewport(i)):(r.R3.add(d,a,c),r.R3.scale(d,d,.5),r.R3.cross(u,o,l));const p=s.utilities.planar.planeEquation(o,a),h=s.utilities.planar.planeEquation(l,c),f=s.utilities.planar.planeEquation(u,d);this.toolCenter=s.utilities.planar.threePlaneIntersection(p,h,f);const{renderingEngine:m}=(0,s.getEnabledElementByIds)(e[0].viewportId,e[0].renderingEngineId);(0,y.Z)(m,e.map(({viewportId:e})=>e))},this.addNewAnnotation=e=>{const t=e.detail,{element:n}=t,{currentPoints:r}=t,i=r.world,o=(0,s.getEnabledElement)(n),{viewport:a}=o;this._jump(o,i);const l=this._getAnnotations(o),c=this.filterInteractableAnnotationsForElement(a.element,l),{data:u}=c[0],{rotationPoints:d}=u.handles,p=[];for(let e=0;e<d.length-1;++e){const t=d[e][1],n=this._getReferenceLineControllable(t.id),r=this._getReferenceLineDraggableRotatable(t.id);n&&r&&(p.push(t.id),e++)}return u.activeViewportIds=[...p],u.handles.activeOperation=x,e.preventDefault(),(0,f.hideElementCursor)(n),this._activateModify(n),c[0]},this.cancel=()=>{console.log("Not implemented yet")},this.handleSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0,this._activateModify(r),(0,f.hideElementCursor)(r),e.preventDefault()},this.isPointNearTool=(e,t,n,r)=>!!this._pointNearTool(e,t,n,6),this.toolSelectedCallback=(e,t,n)=>{const r=e.detail,{element:i}=r;t.highlighted=!0,this._activateModify(i),(0,f.hideElementCursor)(i),e.preventDefault()},this.onCameraModified=e=>{const t=e.detail,{element:n}=t,r=(0,s.getEnabledElement)(n),{renderingEngine:o}=r,a=r.viewport,c=this._getAnnotations(r),u=this.filterInteractableAnnotationsForElement(n,c)[0];if(!u)return;const d=a.getCamera(),p=u.metadata.cameraPosition,f=[0,0,0];i.ZP.subtract(d.position,p,f);const m=u.metadata.cameraFocalPoint,g=[0,0,0];i.ZP.subtract(d.focalPoint,m,g),u.metadata.cameraPosition=[...d.position],u.metadata.cameraFocalPoint=[...d.focalPoint];const v=this._getReferenceLineControllable(a.id),b=this._getReferenceLineDraggableRotatable(a.id);if(!s.utilities.isEqual(d.position,p,.001)&&v&&b){let e=!1;s.utilities.isEqual(f,g,.001)||(e=!0);const t=Math.abs(i.ZP.dot(f,d.viewPlaneNormal))<.01;e||t||(this.toolCenter[0]+=f[0],this.toolCenter[1]+=f[1],this.toolCenter[2]+=f[2])}if(this.configuration.autoPan?.enabled){(0,l.getToolGroupForViewport)(a.id,o.id).getViewportIds().filter(e=>e!==a.id).forEach(e=>{this._autoPanViewportIfNecessary(e,o)})}const C=(0,h.getViewportIdsWithToolToRender)(n,this.getToolName(),!1);(0,y.Z)(o,C)},this.onResetCamera=e=>{this.resetCrosshairs()},this.mouseMoveCallback=(e,t)=>{const{element:n,currentPoints:r}=e.detail,i=r.canvas;let o=!1;for(let e=0;e<t.length;e++){const r=t[e];if((0,v.isAnnotationLocked)(r))continue;const{data:a,highlighted:s}=r;if(!a.handles)continue;const l=a.handles.activeOperation,c=a.activeViewportIds&&a.activeViewportIds.length>0?[...a.activeViewportIds]:[];a.activeViewportIds=[],a.handles.activeOperation=null;let u=!1;u=!!this.getHandleNearImagePoint(n,r,i,6)||this._pointNearTool(n,r,i,6);u&&!s||!u&&s?(r.highlighted=!s,o=!0):a.handles.activeOperation===l&&this._areViewportIdArraysEqual(a.activeViewportIds,c)||(o=!0)}return o},this.filterInteractableAnnotationsForElement=(e,t)=>{if(!t||!t.length)return[];const n=(0,s.getEnabledElement)(e),{viewportId:r}=n;return t.filter(e=>e.data.viewportId===r)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:a,renderingEngine:s}=e,{element:l}=a,c=this._getAnnotations(e),d=a.getCamera(),p=this.filterInteractableAnnotationsForElement(l,c)[0];if(!c?.length||!p?.data)return n;const h=p.annotationUID,{clientWidth:f,clientHeight:g}=a.canvas,v=Math.sqrt(f*f+g*g),y=Math.min(f,g),b=p.data,C=a.worldToCanvas(this.toolCenter),w=this._filterAnnotationsByUniqueViewportOrientations(e,c),E=[],T=[0,0,f,g];w.forEach(e=>{const{data:t}=e;t.handles.toolCenter=this.toolCenter;const n=s.getViewport(t.viewportId),l=n.getCamera(),c=this._getReferenceLineControllable(n.id),u=this._getReferenceLineDraggableRotatable(n.id),p=this._getReferenceLineSlabThicknessControlsOn(n.id),{clientWidth:h,clientHeight:f}=n.canvas,g=Math.sqrt(h*h+f*f),b=[.5*h,.5*f],x=n.canvasToWorld(b),_=[0,0,0];i.ZP.cross(d.viewPlaneNormal,l.viewPlaneNormal,_),i.ZP.normalize(_),i.ZP.multiplyScalar(_,g);const S=[0,0,0];i.ZP.add(x,_,S);const I=[0,0,0];i.ZP.subtract(x,_,I);const D=a.worldToCanvas(S),A=a.worldToCanvas(x),P=r.K4.create();r.K4.subtract(P,D,A),r.K4.normalize(P,P);const O=r.K4.create();r.K4.scale(O,P,100*v);const R=r.K4.create();r.K4.scale(R,P,.4*y);const M=r.K4.create();r.K4.scale(M,P,.2*y);const N=r.K4.create(),L=this.configuration.referenceLinesCenterGapRadius;r.K4.scale(N,P,2===w.length?L:0);const k=r.K4.create(),F=r.K4.create(),V=r.K4.create(),U=r.K4.create();let B=r.K4.clone(C);u&&c||(B=r.K4.clone(A)),r.K4.add(k,B,N),r.K4.add(F,B,O),r.K4.subtract(V,B,N),r.K4.subtract(U,B,O),(0,m.Z)(k,F,T),(0,m.Z)(V,U,T);const G=r.K4.create();r.K4.subtract(G,C,R);const W=r.K4.create();r.K4.add(W,C,R);let z=r.K4.clone(C);!u&&p&&(z=r.K4.clone(A));let H=[...this.toolCenter];!u&&p&&(H=[...x]);const j=[0,0,0];i.ZP.subtract(S,I,j),i.ZP.normalize(j);const{viewPlaneNormal:Z}=d,{matrix:K}=o.Z.buildFromDegree().rotate(90,Z),$=[0,0,0];r.R3.transformMat4($,j,K);const q=n.getSlabThickness(),X=[...$];i.ZP.multiplyScalar(X,q);const Y=[0,0,0];i.ZP.add(H,X,Y);const J=a.worldToCanvas(Y),Q=r.K4.create();r.K4.subtract(Q,z,J);const ee=r.K4.create();r.K4.subtract(ee,z,O),r.K4.add(ee,ee,Q);const te=r.K4.create();r.K4.add(te,z,O),r.K4.add(te,te,Q),(0,m.Z)(ee,te,T);const ne=r.K4.create();r.K4.add(ne,z,O),r.K4.subtract(ne,ne,Q);const re=r.K4.create();r.K4.subtract(re,z,O),r.K4.subtract(re,re,Q),(0,m.Z)(ne,re,T);const ie=r.K4.create(),oe=r.K4.create(),ae=r.K4.create(),se=r.K4.create();r.K4.subtract(ie,z,M),r.K4.add(ie,ie,Q),r.K4.add(oe,z,M),r.K4.add(oe,oe,Q),r.K4.subtract(ae,z,M),r.K4.subtract(ae,ae,Q),r.K4.add(se,z,M),r.K4.subtract(se,se,Q),E.push([n,k,F,V,U,ee,te,ne,re,G,W,ie,oe,ae,se])});const I=[],D=[],A=this._getReferenceLineColor(a.id),P=void 0!==A?A:"rgb(200, 200, 200)";if(E.forEach((e,n)=>{const r=e[0],i=this._getReferenceLineColor(r.id),o=this._getReferenceLineControllable(r.id),s=this._getReferenceLineDraggableRotatable(r.id)||this.configuration.mobile?.enabled,l=this._getReferenceLineSlabThicknessControlsOn(r.id)||this.configuration.mobile?.enabled,c=b.activeViewportIds.find(e=>e===r.id);let d=void 0!==i?i:"rgb(200, 200, 200)",p=1;const f=null!==b.handles.activeOperation&&b.handles.activeOperation===x&&c;f&&(p=2.5);let m=`${n}`;if(o&&s?(m=`${n}One`,(0,u.drawLine)(t,h,m,e[1],e[2],{color:d,lineWidth:p}),m=`${n}Two`,(0,u.drawLine)(t,h,m,e[3],e[4],{color:d,lineWidth:p})):(0,u.drawLine)(t,h,m,e[2],e[4],{color:d,lineWidth:p}),o){d=void 0!==i?i:"rgb(200, 200, 200)";const o=b.handles.activeOperation===_,p=[e[9],e[10]],g=[a.canvasToWorld(e[9]),r,e[1],e[2]],v=[a.canvasToWorld(e[10]),r,e[3],e[4]];I.push(g,v);const y=b.handles.activeOperation===S,C=[e[11],e[12],e[13],e[14]],w=[a.canvasToWorld(e[11]),r,e[5],e[6]],E=[a.canvasToWorld(e[12]),r,e[5],e[6]],T=[a.canvasToWorld(e[13]),r,e[7],e[8]],x=[a.canvasToWorld(e[14]),r,e[7],e[8]];if(D.push(w,E,T,x),(f||this.configuration.mobile?.enabled)&&!o&&!y&&s&&l){let e=`${n}One`;(0,u.drawHandles)(t,h,e,p,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"circle"}),e=`${n}Two`,(0,u.drawHandles)(t,h,e,C,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"rect"})}else if(f&&!o&&!y&&s){const e=`${n}`;(0,u.drawHandles)(t,h,e,p,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"circle"})}else if(c&&!o&&!y&&l){const e=`${n}`;(0,u.drawHandles)(t,h,e,C,{color:d,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"rect"})}else if(o&&s){const e=`${n}`;(0,u.drawHandles)(t,h,e,p,{color:d,handleRadius:2,fill:d,type:"circle"})}else y&&c&&l&&(0,u.drawHandles)(t,h,m,C,{color:d,handleRadius:2,fill:d,type:"rect"});r.getSlabThickness()>.5&&l&&(m=`${n}STOne`,(0,u.drawLine)(t,h,m,e[5],e[6],{color:d,width:1,lineDash:[2,3]}),m=`${n}STTwo`,(0,u.drawLine)(t,h,m,e[7],e[8],{color:d,width:e,lineDash:[2,3]}))}}),n=!0,b.handles.rotationPoints=I,b.handles.slabThicknessPoints=D,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:e}=this.configuration,n=[f*(e?.xOffset||.95),g*(e?.yOffset||.05)],r=e?.circleRadius||.01*v,i="0";(0,u.drawCircle)(t,h,i,n,r,{color:P,fill:P})}return n},this._getAnnotations=e=>{const{viewport:t}=e,n=(0,c.getAnnotations)(this.getToolName(),t.element)||[],r=this._getViewportsInfo().map(({viewportId:e})=>e);return n.filter(e=>{const{data:t}=e;return r.includes(t.viewportId)})},this._onNewVolume=e=>{const t=this._getViewportsInfo();this.computeToolCenter(t)},this._areViewportIdArraysEqual=(e,t)=>e.length===t.length&&(e.forEach(e=>{let n=!1;for(let r=0;r<t.length;++r)if(e===t[r]){n=!0;break}if(!1===n)return!1}),!0),this._getAnnotationsForViewportsWithDifferentCameras=(e,t)=>{const{viewportId:n,renderingEngine:r,viewport:i}=e,o=t.filter(e=>e.data.viewportId!==n);if(!o||!o.length)return[];const a=i.getCamera(),{viewPlaneNormal:l,position:c}=a,u=o.filter(e=>{const{viewportId:t}=e.data,n=r.getViewport(t).getCamera();return!(s.utilities.isEqual(n.viewPlaneNormal,l,.01)&&s.utilities.isEqual(n.position,c,1))});return u},this._filterViewportWithSameOrientation=(e,t,n)=>{const{renderingEngine:r}=e,{data:o}=t,a=r.getViewport(o.viewportId),l=n.filter(e=>{const{data:t}=e,n=r.getViewport(t.viewportId);return!0===this._getReferenceLineControllable(n.id)});if(!l||!l.length)return[];const c=a.getCamera(),u=c.viewPlaneNormal;i.ZP.normalize(u);return l.filter(e=>{const{viewportId:t}=e.data,n=r.getViewport(t).getCamera(),o=n.viewPlaneNormal;return i.ZP.normalize(o),s.utilities.isEqual(u,o,.01)&&s.utilities.isEqual(c.viewUp,n.viewUp,.01)})},this._filterAnnotationsByUniqueViewportOrientations=(e,t)=>{const{renderingEngine:n,viewport:r}=e,o=r.getCamera().viewPlaneNormal;i.ZP.normalize(o);const a=t.filter(e=>{const{data:t}=e,i=n.getViewport(t.viewportId),o=this._getReferenceLineControllable(i.id);return r!==i&&!0===o}),l=[];for(let e=0;e<a.length;++e){const t=a[e],{viewportId:r}=t.data,c=n.getViewport(r).getCamera(),u=c.viewPlaneNormal;if(i.ZP.normalize(u),s.utilities.isEqual(o,u,.01)||s.utilities.isOpposite(o,u,.01))continue;let d=!1;for(let e=0;e<l.length;++e){const t=l[e],{viewportId:r}=t.data,i=n.getViewport(r).getCamera();s.utilities.isEqual(i.viewPlaneNormal,c.viewPlaneNormal,.01)&&s.utilities.isEqual(i.position,c.position,1)&&(d=!0)}d||l.push(t)}const c=t.filter(e=>{const{data:t}=e,i=n.getViewport(t.viewportId),o=this._getReferenceLineControllable(i.id);return r!==i&&!0!==o});for(let e=0;e<c.length;++e){const t=c[e],{viewportId:r}=t.data,a=n.getViewport(r).getCamera(),u=a.viewPlaneNormal;if(i.ZP.normalize(u),s.utilities.isEqual(o,u,.01)||s.utilities.isOpposite(o,u,.01))continue;let d=!1;for(let e=0;e<l.length;++e){const t=l[e],{viewportId:r}=t.data,i=n.getViewport(r).getCamera();s.utilities.isEqual(i.viewPlaneNormal,a.viewPlaneNormal,.01)&&s.utilities.isEqual(i.position,a.position,1)&&(d=!0)}d||l.push(t)}const u=this._getAnnotationsForViewportsWithDifferentCameras(e,t);for(let e=0;e<u.length;++e){const t=u[e];if(l.some(e=>e===t))continue;const{viewportId:r}=t.data,a=n.getViewport(r).getCamera(),c=a.viewPlaneNormal;if(i.ZP.normalize(c),s.utilities.isEqual(o,c,.01)||s.utilities.isOpposite(o,c,.01))continue;let d=!1;for(let e=0;e<l.length;++e){const t=l[e],{viewportId:r}=t.data,i=n.getViewport(r).getCamera();s.utilities.isEqual(i.viewPlaneNormal,a.viewPlaneNormal,.01)&&s.utilities.isEqual(i.position,a.position,1)&&(d=!0)}d||l.push(t)}return l},this._checkIfViewportsRenderingSameScene=(e,t)=>{const n=e.getActors(),r=t.getActors();let i=!0;return n.forEach(e=>{n.length===r.length&&void 0!==r.find(({uid:t})=>t===e.uid)||(i=!1)}),i},this._jump=(e,t)=>{d.SB.isInteractingWithTool=!0;const{viewport:n,renderingEngine:r}=e,o=this._getAnnotations(e),a=[0,0,0];i.ZP.subtract(t,this.toolCenter,a);const s=this._getAnnotationsForViewportsWithDifferentCameras(e,o).filter(e=>{const{data:t}=e,i=r.getViewport(t.viewportId),o=this._checkIfViewportsRenderingSameScene(n,i);return this._getReferenceLineControllable(i.id)&&this._getReferenceLineDraggableRotatable(i.id)&&o});return 0===s.length?(d.SB.isInteractingWithTool=!1,!1):(this._applyDeltaShiftToSelectedViewportCameras(r,s,a),d.SB.isInteractingWithTool=!1,!0)},this._activateModify=e=>{d.SB.isInteractingWithTool=!this.configuration.mobile?.enabled,e.addEventListener(p.Events.MOUSE_UP,this._endCallback),e.addEventListener(p.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(p.Events.TOUCH_END,this._endCallback),e.addEventListener(p.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(p.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{d.SB.isInteractingWithTool=!1,e.removeEventListener(p.Events.MOUSE_UP,this._endCallback),e.removeEventListener(p.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(p.Events.TOUCH_END,this._endCallback),e.removeEventListener(p.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(p.Events.TOUCH_TAP,this._endCallback)},this._endCallback=e=>{const t=e.detail,{element:n}=t;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(n),(0,f.resetElementCursor)(n),this.editData=null;const r=(0,s.getEnabledElement)(n),{renderingEngine:i}=r,o=(0,h.getViewportIdsWithToolToRender)(n,this.getToolName(),!1);(0,y.Z)(i,o)},this._dragCallback=e=>{const t=e.detail,n=t.deltaPoints.world;if(Math.abs(n[0])<.001&&Math.abs(n[1])<.001&&Math.abs(n[2])<.001)return;const{element:a}=t,c=(0,s.getEnabledElement)(a),{renderingEngine:u,viewport:d}=c,p=this._getAnnotations(c),h=this.filterInteractableAnnotationsForElement(a,p)[0];if(!h)return;const{handles:f}=h.data,{currentPoints:m}=e.detail,g=m.canvas;if(f.activeOperation===x){const e=this._getAnnotationsForViewportsWithDifferentCameras(c,p).filter(e=>{const{data:t}=e,n=u.getViewport(t.viewportId),r=this._getReferenceLineControllable(n.id),i=this._getReferenceLineDraggableRotatable(n.id);return!0===r&&!0===i&&h.data.activeViewportIds.find(e=>e===n.id)});this._applyDeltaShiftToSelectedViewportCameras(u,e,n)}else if(f.activeOperation===_){const e=this._getAnnotationsForViewportsWithDifferentCameras(c,p).filter(e=>{const{data:t}=e,n=u.getViewport(t.viewportId),r=this._getReferenceLineControllable(n.id),i=this._getReferenceLineDraggableRotatable(n.id);return!0===r&&!0===i}),n=r.K4.create(),i=r.K4.create(),a=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],s=d.worldToCanvas(a),l=t.currentPoints.canvas,h=r.K4.create();r.K4.sub(h,l,t.deltaPoints.canvas),r.K4.sub(n,h,s),r.K4.sub(i,l,s);let f=r.K4.angle(n,i);this._isClockWise(s,h,l)&&(f*=-1),f=Math.round(100*f)/100;const m=d.getCamera().viewPlaneNormal,{matrix:g}=o.Z.buildFromRadian().translate(a[0],a[1],a[2]).rotate(f,m).translate(-a[0],-a[1],-a[2]),v=[];e.forEach(e=>{const{data:t}=e;t.handles.toolCenter=a;const n=u.getViewport(t.viewportId),i=n.getCamera(),{viewUp:o,position:s,focalPoint:l}=i;o[0]+=s[0],o[1]+=s[1],o[2]+=s[2],r.R3.transformMat4(l,l,g),r.R3.transformMat4(s,s,g),r.R3.transformMat4(o,o,g),o[0]-=s[0],o[1]-=s[1],o[2]-=s[2],n.setCamera({position:s,viewUp:o,focalPoint:l}),v.push(n.id)}),u.renderViewports(v)}else if(f.activeOperation===S){const e=this._getAnnotationsForViewportsWithDifferentCameras(c,p).filter(e=>{const{data:t}=e,n=u.getViewport(t.viewportId),r=this._getReferenceLineControllable(n.id),i=this._getReferenceLineSlabThicknessControlsOn(n.id);return!0===r&&!0===i&&h.data.activeViewportIds.find(e=>e===n.id)});if(0===e.length)return;const o=this._filterViewportWithSameOrientation(c,e[0],p),a=[];a.push(d.id),o.forEach(e=>{const{data:o}=e,c=u.getViewport(o.viewportId),p=c.getCamera().viewPlaneNormal,f=i.ZP.dot(n,p),m=[...p];if(i.ZP.multiplyScalar(m,f),Math.abs(m[0])>.001||Math.abs(m[1])>.001||Math.abs(m[2])>.001){const e=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),n=t.lastPoints.world,o=[0,0,0],f=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]];if(!this._getReferenceLineDraggableRotatable(c.id)){const{rotationPoints:e}=this.editData.annotation.data.handles,t=e.filter(e=>e[1].uid===c.id);if(2===t.length){const e=d.canvasToWorld(t[0][3]),n=d.canvasToWorld(t[1][3]);i.ZP.add(e,n,f),i.ZP.multiplyScalar(f,.5)}}i.ZP.subtract(n,f,o);const v=i.ZP.dot(o,p),y=[...p];i.ZP.multiplyScalar(y,v);const C=[y[0],y[1],y[2]];r.R3.normalize(C,C);const w=[m[0],m[1],m[2]];r.R3.normalize(w,w);let E=c.getSlabThickness();s.utilities.isOpposite(C,w,.001)?E-=e:E+=e,E=Math.abs(E),E=Math.max(b.MINIMUM_SLAB_THICKNESS,E);this._pointNearReferenceLine(h,g,6,c)&&(E=b.MINIMUM_SLAB_THICKNESS);(0,l.getToolGroupForViewport)(c.id,u.id).getToolInstance(this.getToolName()).setSlabThickness(c,E),a.push(c.id)}}),u.renderViewports(a)}},this._pointNearReferenceLine=(e,t,n,r)=>{const{data:i}=e,{rotationPoints:o}=i.handles;for(let e=0;e<o.length-1;++e){const i=o[e][1];if(i.id!==r.id)continue;if(!this._getReferenceLineControllable(i.id))continue;const a={start:{x:o[e][2][0],y:o[e][2][1]},end:{x:o[e][3][0],y:o[e][3][1]}},s=g.distanceToPoint([a.start.x,a.start.y],[a.end.x,a.end.y],[t[0],t[1]]),l={start:{x:o[e+1][2][0],y:o[e+1][2][1]},end:{x:o[e+1][3][0],y:o[e+1][3][1]}},c=g.distanceToPoint([l.start.x,l.start.y],[l.end.x,l.end.y],[t[0],t[1]]);if(s<=n||c<=n)return!0;e++}return!1},this._getReferenceLineColor=e.configuration?.getReferenceLineColor||C,this._getReferenceLineControllable=e.configuration?.getReferenceLineControllable||w,this._getReferenceLineDraggableRotatable=e.configuration?.getReferenceLineDraggableRotatable||E,this._getReferenceLineSlabThicknessControlsOn=e.configuration?.getReferenceLineSlabThicknessControlsOn||T}onSetToolActive(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this.computeToolCenter(e)}onSetToolPassive(){const e=this._getViewportsInfo();this.computeToolCenter(e)}onSetToolEnabled(){const e=this._getViewportsInfo();this.computeToolCenter(e)}onSetToolDisabled(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach(({renderingEngineId:e,viewportId:t})=>{const n=(0,s.getEnabledElementByIds)(t,e);if(!n)return;const r=this._getAnnotations(n);r?.length&&r.forEach(e=>{(0,c.removeAnnotation)(e.annotationUID)})})}getHandleNearImagePoint(e,t,n,r){const i=(0,s.getEnabledElement)(e),{viewport:o}=i;let a=this._getRotationHandleNearImagePoint(o,t,n,r);return null!==a?a:(a=this._getSlabThicknessHandleNearImagePoint(o,t,n,r),null!==a?a:void 0)}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,s.getEnabledElementByIds)(e,t),{element:r}=n;r.removeEventListener(s.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,s.getEnabledElementByIds)(e,t),{element:r}=n;r.addEventListener(s.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_autoPanViewportIfNecessary(e,t){const n=t.getViewport(e),{clientWidth:r,clientHeight:i}=n.canvas,o=n.worldToCanvas(this.toolCenter),a=this.configuration.autoPan.panSize,s=[o[0],o[1]];if(o[0]<0?s[0]=a:o[0]>r&&(s[0]=r-a),o[1]<0?s[1]=a:o[1]>i&&(s[1]=i-a),s[0]===o[0]&&s[1]===o[1])return;const l=n.canvasToWorld(s),c=[l[0]-this.toolCenter[0],l[1]-this.toolCenter[1],l[2]-this.toolCenter[2]],u=n.getCamera(),{focalPoint:d,position:p}=u,h=[p[0]-c[0],p[1]-c[1],p[2]-c[2]],f=[d[0]-c[0],d[1]-c[1],d[2]-c[2]];n.setCamera({focalPoint:f,position:h}),n.render()}setSlabThickness(e,t){let n;const{filterActorUIDsToSetSlabThickness:r}=this.configuration;r&&r.length>0&&(n=r);let i=this.configuration.slabThicknessBlendMode;t===b.MINIMUM_SLAB_THICKNESS&&(i=s.Enums.BlendModes.COMPOSITE);e.setBlendMode(i,n,!1),e.setSlabThickness(t,n)}_isClockWise(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])>0}_applyDeltaShiftToSelectedViewportCameras(e,t,n){t.forEach(t=>{this._applyDeltaShiftToViewportCamera(e,t,n)})}_applyDeltaShiftToViewportCamera(e,t,n){const{data:r}=t,o=e.getViewport(r.viewportId),a=o.getCamera(),s=a.viewPlaneNormal,l=i.ZP.dot(n,s),c=[...s];if(i.ZP.multiplyScalar(c,l),Math.abs(c[0])>.001||Math.abs(c[1])>.001||Math.abs(c[2])>.001){const e=[0,0,0],t=[0,0,0];i.ZP.add(a.focalPoint,c,e),i.ZP.add(a.position,c,t),o.setCamera({focalPoint:e,position:t}),o.render()}}_getRotationHandleNearImagePoint(e,t,n,i){const{data:o}=t,{rotationPoints:a}=o.handles;for(let s=0;s<a.length;s++){const l=a[s][0],c=a[s][1];if(!this._getReferenceLineControllable(c.id))continue;if(!this._getReferenceLineDraggableRotatable(c.id))continue;const u=e.worldToCanvas(l);if(r.K4.distance(n,u)<i)return o.handles.activeOperation=_,this.editData={annotation:t},l}return null}_getSlabThicknessHandleNearImagePoint(e,t,n,i){const{data:o}=t,{slabThicknessPoints:a}=o.handles;for(let s=0;s<a.length;s++){const l=a[s][0],c=a[s][1];if(!this._getReferenceLineControllable(c.id))continue;if(!this._getReferenceLineSlabThicknessControlsOn(c.id))continue;const u=e.worldToCanvas(l);if(r.K4.distance(n,u)<i)return o.handles.activeOperation=S,o.activeViewportIds=[c.id],this.editData={annotation:t},l}return null}_pointNearTool(e,t,n,i){const o=(0,s.getEnabledElement)(e),{viewport:a}=o,{clientWidth:l,clientHeight:c}=a.canvas,u=Math.sqrt(l*l+c*c),{data:d}=t,{rotationPoints:p}=d.handles,{slabThicknessPoints:h}=d.handles,f=[];for(let e=0;e<p.length-1;++e){const t=p[e][1],r=this._getReferenceLineControllable(t.id),o=this._getReferenceLineDraggableRotatable(t.id);if(!r||!o)continue;const a={start:{x:p[e][2][0],y:p[e][2][1]},end:{x:p[e][3][0],y:p[e][3][1]}},s=g.distanceToPoint([a.start.x,a.start.y],[a.end.x,a.end.y],[n[0],n[1]]),l={start:{x:p[e+1][2][0],y:p[e+1][2][1]},end:{x:p[e+1][3][0],y:p[e+1][3][1]}},c=g.distanceToPoint([l.start.x,l.start.y],[l.end.x,l.end.y],[n[0],n[1]]);(s<=i||c<=i)&&(f.push(t.id),d.handles.activeOperation=x),e++}for(let e=0;e<h.length-1;++e){const t=h[e][1];if(f.find(e=>e===t.id))continue;const o=this._getReferenceLineControllable(t.id),a=this._getReferenceLineSlabThicknessControlsOn(t.id);if(!o||!a)continue;const s=h[e][2],l=h[e][3],c=r.K4.create();r.K4.add(c,s,l),r.K4.scale(c,c,.5);const p=r.K4.create();r.K4.subtract(p,s,c),r.K4.normalize(p,p);const m=r.K4.create();r.K4.scale(m,p,.05*u);const v=r.K4.create(),y=r.K4.create();r.K4.add(v,c,m),r.K4.subtract(y,c,m);const b={start:{x:v[0],y:v[1]},end:{x:s[0],y:s[1]}},C=g.distanceToPoint([b.start.x,b.start.y],[b.end.x,b.end.y],[n[0],n[1]]),w={start:{x:y[0],y:y[1]},end:{x:l[0],y:l[1]}},E=g.distanceToPoint([w.start.x,w.start.y],[w.end.x,w.end.y],[n[0],n[1]]);(C<=i||E<=i)&&(f.push(t.id),d.handles.activeOperation=null),e++}return d.activeViewportIds=[...f],this.editData={annotation:t},d.handles.activeOperation===x}}I.toolName="Crosshairs"},9260:(e,t,n)=>{"use strict";var r=n(93382),i=n(62709),o=n(44037),a=n(94451),s=n(27078);class l extends r.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}}){super(e,t)}mouseClickCallback(e){const{element:t,currentPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),{viewport:l,renderingEngine:c}=r,u=this.getTargetId(l);if(!u.startsWith("volumeId"))throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");const d=i.utilities.getVolumeId(u);let p=-1/0;const h=(0,o.getPointInLineOfSightWithCriteria)(l,n.world,d,(e,t)=>{if(e>p)return p=e,t});if(!h||!h.length)return;const{targetViewportIds:f,toolGroupId:m}=this.configuration;c.getViewports().filter(e=>{if(f?.indexOf(e.id)>=0)return!0;const t=(0,s.getToolGroupForViewport)(e.id,c.id);return!(!m||m!==t?.id)}).forEach(e=>{e instanceof i.VolumeViewport?(0,a.Z)(e,h):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")})}}l.toolName="MIPJumpToClickTool"},98386:(e,t,n)=>{"use strict";var r=n(93382),i=n(68096),o=n(62709),a=n(46966),s=n(66878),l=n(33232),c=n(23118);const u="magnify-viewport";class d extends r.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}}){super(e,t),this._hasBeenRemoved=!1,this.preMouseDownCallback=e=>{const t=e.detail,{element:n,currentPoints:r}=t,i=(0,o.getEnabledElement)(n),{viewport:l,renderingEngine:u}=i;if(!(l instanceof o.StackViewport))throw new Error("MagnifyTool only works on StackViewports");const d=this._getReferencedImageId(l);if(!d)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");const p=(0,a.getViewportIdsWithToolToRender)(n,this.getToolName());return this.editData={referencedImageId:d,viewportIdsToRender:p,enabledElement:i,renderingEngine:u,currentPoints:r},this._createMagnificationViewport(),this._activateDraw(n),(0,c.hideElementCursor)(n),e.preventDefault(),(0,s.Z)(u,p),!0},this.preTouchStartCallback=e=>{this.preMouseDownCallback(e)},this._createMagnificationViewport=()=>{const{enabledElement:e,referencedImageId:t,viewportIdsToRender:n,renderingEngine:r,currentPoints:i}=this.editData,{viewport:a}=e,{element:l}=a,c=a.getProperties(),{canvas:d,world:p}=i;let h;if(h=l.querySelector(".magnifyTool"),null===h){const e=document.createElement("div");e.classList.add("magnifyTool"),e.style.display="block",e.style.width=`${this.configuration.magnifyWidth}px`,e.style.height=`${this.configuration.magnifyHeight}px`,e.style.position="absolute",h=e;l.querySelector(".viewport-element").appendChild(e);const t={viewportId:u,type:o.Enums.ViewportType.STACK,element:h};r.enableElement(t)}h.style.top=d[1]-this.configuration.magnifyHeight/2+"px",h.style.left=d[0]-this.configuration.magnifyWidth/2+"px";const f=r.getViewport(u);f.setStack([t]).then(()=>{if(this._hasBeenRemoved)return;f.setProperties(c);const{parallelScale:e}=a.getCamera(),{focalPoint:t,position:n,viewPlaneNormal:r}=f.getCamera(),i=Math.sqrt(Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)+Math.pow(t[2]-n[2],2)),o=[p[0],p[1],p[2]],s=[o[0]+i*r[0],o[1]+i*r[1],o[2]+i*r[2]];f.setCamera({parallelScale:e*(1/this.configuration.magnifySize),focalPoint:o,position:s}),f.render()}),h.style.display="block",(0,s.Z)(r,n)},this._dragCallback=e=>{const t=e.detail,{deltaPoints:n,element:r,currentPoints:i}=t,a=n.world,s=i.canvas,l=(0,o.getEnabledElement)(r),{renderingEngine:c}=l,d=c.getViewport(u),p=r.querySelector(".magnifyTool");if(!p)return;p.style.top=s[1]-this.configuration.magnifyHeight/2+"px",p.style.left=s[0]-this.configuration.magnifyWidth/2+"px";const{focalPoint:h,position:f}=d.getCamera(),m=[f[0]+a[0],f[1]+a[1],f[2]+a[2]],g=[h[0]+a[0],h[1]+a[1],h[2]+a[2]];d.setCamera({focalPoint:g,position:m}),d.render()},this._dragEndCallback=e=>{const{element:t}=e.detail,n=(0,o.getEnabledElement)(t),{renderingEngine:r}=n;r.disableElement(u);const i=t.querySelector(".viewport-element"),a=i.querySelector(".magnifyTool");i.removeChild(a),this._deactivateDraw(t),(0,c.resetElementCursor)(t),this._hasBeenRemoved=!0},this._activateDraw=e=>{l.SB.isInteractingWithTool=!0,this._hasBeenRemoved=!1,e.addEventListener(i.Events.MOUSE_UP,this._dragEndCallback),e.addEventListener(i.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(i.Events.MOUSE_CLICK,this._dragEndCallback),e.addEventListener(i.Events.TOUCH_END,this._dragEndCallback),e.addEventListener(i.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{l.SB.isInteractingWithTool=!1,e.removeEventListener(i.Events.MOUSE_UP,this._dragEndCallback),e.removeEventListener(i.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(i.Events.MOUSE_CLICK,this._dragEndCallback),e.removeEventListener(i.Events.TOUCH_END,this._dragEndCallback),e.removeEventListener(i.Events.TOUCH_DRAG,this._dragCallback)}}_getReferencedImageId(e){const t=this.getTargetId(e);let n;return e instanceof o.StackViewport&&(n=t.split("imageId:")[1]),n}}d.toolName="Magnify"},23332:(e,t,n)=>{"use strict";var r=n(68470),i=n(32198);var o={Corners:{TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"}};const{vtkErrorMacro:a}=r.m,{Corners:s}=o;const l={viewportCorner:o.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null};function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,l,n),r.m.obj(e,t),r.m.get(e,t,["enabled","viewportCorner","viewportSize"]),r.m.setGet(e,t,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),r.m.get(e,t,["actor"]),r.m.moveToProtected(e,t,["interactor"]),function(e,t){t.classHierarchy.push("vtkOrientationMarkerWidget");const n={...e},r=[],o=i.ZP.newInstance(),l=new ResizeObserver(t=>{e.updateViewport()});let c=null,u=null,d=null,p=null,h=null;function f(){t._interactor.isAnimating()||e.updateMarkerOrientation()}t._onParentRendererChanged=()=>e.updateViewport(),e.computeViewport=()=>{const e=t.parentRenderer||t._interactor.getCurrentRenderer(),[n,r,i,o]=e.getViewport(),l=t._interactor.getView(),c=l.getSize(),[u,d]=l.getViewportSize(e),p=Math.min(u,d);let h=t.viewportSize*p;h=Math.max(Math.min(t.minPixelSize,p),Math.min(t.maxPixelSize,h));const f=h/c[0],m=h/c[1];switch(t.viewportCorner){case s.TOP_LEFT:return[n,o-m,n+f,o];case s.TOP_RIGHT:return[i-f,o-m,i,o];case s.BOTTOM_LEFT:return[n,r,n+f,r+m];case s.BOTTOM_RIGHT:return[i-f,r,i,r+m];default:return a("Invalid widget corner"),null}},e.updateViewport=()=>{t.enabled&&(o.setViewport(...e.computeViewport()),t._interactor.render())},e.updateMarkerOrientation=()=>{const e=(t.parentRenderer||t._interactor.getCurrentRenderer()).getActiveCamera();if(!e)return;const n=e.getReferenceByName("position"),i=e.getReferenceByName("focalPoint"),a=e.getReferenceByName("viewUp");if(r[0]!==n[0]||r[1]!==n[1]||r[2]!==n[2]||r[3]!==i[0]||r[4]!==i[1]||r[5]!==i[2]||r[6]!==a[0]||r[7]!==a[1]||r[8]!==a[2]){r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=i[0],r[4]=i[1],r[5]=i[2],r[6]=a[0],r[7]=a[1],r[8]=a[2];const e=o.getActiveCamera();e.setPosition(n[0],n[1],n[2]),e.setFocalPoint(i[0],i[1],i[2]),e.setViewUp(a[0],a[1],a[2]),o.resetCamera()}},e.setEnabled=n=>{if(n){if(t.enabled)return;if(!t.actor)return void a("Must set actor before enabling orientation marker.");if(!t._interactor)return void a("Must set interactor before enabling orientation marker.");const n=t.parentRenderer||t._interactor.getCurrentRenderer(),r=n.getRenderWindow();r.addRenderer(o),r.getNumberOfLayers()<2&&r.setNumberOfLayers(2),o.setLayer(r.getNumberOfLayers()-1),o.setInteractive(!1),o.addViewProp(t.actor),t.actor.setVisibility(!0),c=n.onEvent(e=>{"ActiveCameraEvent"===e.type&&(u&&u.unsubscribe(),u=e.camera.onModified(f))}),u=n.getActiveCamera().onModified(f),d=t._interactor.onAnimation(e.updateMarkerOrientation),p=t._interactor.onEndAnimation(e.updateMarkerOrientation),l.observe(t._interactor.getView().getCanvas()),e.updateViewport(),e.updateMarkerOrientation(),t.enabled=!0}else{if(!t.enabled)return;t.enabled=!1,l.disconnect(),c.unsubscribe(),c=null,u.unsubscribe(),u=null,d.unsubscribe(),d=null,p.unsubscribe(),p=null,t.actor.setVisibility(!1),o.removeViewProp(t.actor);const e=t._interactor?.findPokedRenderer()?.getRenderWindow();e&&e.removeRenderer(o)}e.modified()},e.setViewportCorner=n=>{n!==t.viewportCorner&&(t.viewportCorner=n,e.updateViewport())},e.setViewportSize=n=>{const r=Math.min(1,Math.max(0,n));r!==t.viewportSize&&(t.viewportSize=r,e.updateViewport())},e.setActor=n=>{const r=t.enabled;e.setEnabled(!1),t.actor=n,e.setEnabled(r)},e.getRenderer=()=>o,e.delete=()=>{n.delete(),h&&(h.unsubscribe(),h=null),c&&(c.unsubscribe(),c=null),u&&(u.unsubscribe(),u=null),d&&(d.unsubscribe(),d=null),p&&(p.unsubscribe(),p=null),l.disconnect()},h=e.onModified(e.updateViewport)}(e,t)}var u={newInstance:r.m.newInstance(c,"vtkOrientationMarkerWidget"),extend:c,...o},d=n(16623),p=n(93702),h=n(64725),f=n(97442),m=n(8455),g=n(54131);function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0];const[n,r,i,o]=t,a=e.getContext("2d").getImageData(n,r,i||e.width,o||e.height),s=m.ZP.newInstance({type:"vtkImageData"});s.setOrigin(0,0,0),s.setSpacing(1,1,1),s.setExtent(0,(i||e.width)-1,0,(o||e.height)-1,0,0);const l=g.default.newInstance({numberOfComponents:4,values:new Uint8Array(a.data.buffer)});return l.setName("scalars"),s.getPointData().setScalars(l),s}var y={canvasToImageData:v,imageToImageData:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{flipX:!1,flipY:!1,rotate:0};const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d"),{flipX:i,flipY:o,rotate:a}=t;return r.translate(n.width/2,n.height/2),r.scale(i?-1:1,o?-1:1),r.rotate(a*Math.PI/180),r.drawImage(e,-e.width/2,-e.height/2),v(n)}};const b={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:e=>e/2,faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function C(e,t){t.set(e)}var w={applyDefinitions:C,applyPreset:function(e,t){return C(b[e],t)},registerStylePreset:function(e,t){b[e]=t}};const E={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};const T={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:e=>e/1.8,edgeThickness:.1,edgeColor:"black",resolution:200}};function x(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,T,n),d.ZP.extend(e,t,n),r.m.get(e,t,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),function(e,t){t.classHierarchy.push("vtkAnnotatedCubeActor"),t.xPlusFaceProperty={...t.xPlusFaceProperty},t.xMinusFaceProperty={...t.xMinusFaceProperty},t.yPlusFaceProperty={...t.yPlusFaceProperty},t.yMinusFaceProperty={...t.yMinusFaceProperty},t.zPlusFaceProperty={...t.zPlusFaceProperty},t.zMinusFaceProperty={...t.zMinusFaceProperty};let n=null;const r=document.createElement("canvas"),i=p.default.newInstance(),o=h.ZP.newInstance();function a(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i&&Object.assign(t[`${n}FaceProperty`],i);const a={...t.defaultStyle,...t[`${n}FaceProperty`]};r.width=a.resolution,r.height=a.resolution;const s=r.getContext("2d");s.fillStyle=a.faceColor,s.fillRect(0,0,r.width,r.height),a.edgeThickness>0&&(s.strokeStyle=a.edgeColor,s.lineWidth=a.edgeThickness*r.width,s.strokeRect(0,0,r.width,r.height)),s.save(),s.translate(0,r.height),s.scale(1,-1),s.translate(r.width/2,r.height/2),s.rotate(-Math.PI*(a.faceRotation/180));const l=a.fontSizeScale(a.resolution);s.fillStyle=a.fontColor,s.textAlign="center",s.textBaseline="middle",s.font=`${a.fontStyle} ${l}px "${a.fontFamily}"`,s.fillText(a.text,0,0),s.restore();const c=y.canvasToImageData(r);o.setInputData(c,E[n]),e.modified()}function s(){n=f.ZP.newInstance({generate3DTextureCoordinates:!0}),i.setInputConnection(n.getOutputPort()),a("xPlus"),a("xMinus"),a("yPlus"),a("yMinus"),a("zPlus"),a("zMinus")}o.setInterpolate(!0),e.setDefaultStyle=e=>{t.defaultStyle={...t.defaultStyle,...e},s()},e.setXPlusFaceProperty=e=>a("xPlus",e),e.setXMinusFaceProperty=e=>a("xMinus",e),e.setYPlusFaceProperty=e=>a("yPlus",e),e.setYMinusFaceProperty=e=>a("yMinus",e),e.setZPlusFaceProperty=e=>a("zPlus",e),e.setZMinusFaceProperty=e=>a("zMinus",e),s(),i.setInputConnection(n.getOutputPort()),e.setMapper(i),e.addTexture(o)}(e,t)}var _={newInstance:r.m.newInstance(x,"vtkAnnotatedCubeActor"),extend:x,Presets:w},S=n(45802),I=n(23834),D=n(46576),A=n(21477),P=n(89262);const{vtkErrorMacro:O}=r.m;function R(e,t,n,r){e.set(function(e,t){let n=0;return e.map((e,r)=>r===n?(n+=e+1,e):e+t)}(t,n),r)}const M={outputPointsPrecision:A.XJ.DEFAULT};function N(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,M,n),r.m.setGet(e,t,["outputPointsPrecision"]),r.m.obj(e,t),r.m.algo(e,t,1,1),function(e,t){t.classHierarchy.push("vtkAppendPolyData"),e.requestData=(n,r)=>{const i=e.getNumberOfInputPorts();if(!i)return void O("No input specified.");if(1===i)return void(r[0]=n[0]);const o=D.ZP.newInstance();let a=0,s=0,l=1,c=1,u=0,d=0,p=0,h=0,f=!0,m=!0,v=!0;for(let e=0;e<i;e++){const t=n[e];if(!t)continue;const r=t.getPoints().getNumberOfPoints();a+=r,u+=t.getVerts().getNumberOfValues(),d+=t.getLines().getNumberOfValues(),p+=t.getStrips().getNumberOfValues(),h+=t.getPolys().getNumberOfValues(),r&&(c&&(c=0,s=t.getPoints().getDataType()),l=t.getPoints().getDataType(),s=s>l?s:l);const i=t.getPointData();i?(f=f&&null!==i.getNormals(),m=m&&null!==i.getTCoords(),v=v&&null!==i.getScalars()):(f=!1,m=!1,v=!1)}t.outputPointsPrecision===A.XJ.SINGLE?s=P.Tu.FLOAT:t.outputPointsPrecision===A.XJ.DOUBLE&&(s=P.Tu.DOUBLE);const y=I.ZP.newInstance({dataType:s});y.setNumberOfPoints(a);const b=y.getData(),C=new Uint32Array(u),w=new Uint32Array(d),E=new Uint32Array(p),T=new Uint32Array(h);let x=null,_=null,S=null;const M=n[i-1];if(f){const e=M.getPointData().getNormals();x=g.default.newInstance({numberOfComponents:3,numberOfTuples:a,size:3*a,dataType:e.getDataType(),name:e.getName()})}if(m){const e=M.getPointData().getTCoords();_=g.default.newInstance({numberOfComponents:2,numberOfTuples:a,size:2*a,dataType:e.getDataType(),name:e.getName()})}if(v){const e=M.getPointData().getScalars();S=g.default.newInstance({numberOfComponents:e.getNumberOfComponents(),numberOfTuples:a,size:a*e.getNumberOfComponents(),dataType:e.getDataType(),name:e.getName()})}a=0,u=0,d=0,p=0,h=0;for(let e=0;e<i;e++){const t=n[e];b.set(t.getPoints().getData(),3*a),R(C,t.getVerts().getData(),a,u),u+=t.getVerts().getNumberOfValues(),R(w,t.getLines().getData(),a,d),d+=t.getLines().getNumberOfValues(),R(E,t.getStrips().getData(),a,p),p+=t.getStrips().getNumberOfValues(),R(T,t.getPolys().getData(),a,h),h+=t.getPolys().getNumberOfValues();const r=t.getPointData();if(f){const e=r.getNormals();x.getData().set(e.getData(),3*a)}if(m){const e=r.getTCoords();_.getData().set(e.getData(),2*a)}if(v){const e=r.getScalars();S.getData().set(e.getData(),a*S.getNumberOfComponents())}a+=t.getPoints().getNumberOfPoints()}o.setPoints(y),o.getVerts().setData(C),o.getLines().setData(w),o.getStrips().setData(E),o.getPolys().setData(T),x&&o.getPointData().setNormals(x),_&&o.getPointData().setTCoords(_),S&&o.getPointData().setScalars(S),r[0]=o}}(e,t)}var L={newInstance:r.m.newInstance(N,"vtkAppendPolyData"),extend:N};const k={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function F(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,k,n),r.m.obj(e,t),r.m.setGet(e,t,["height","radius","resolution","capping"]),r.m.setGetArray(e,t,["center","direction"],3),r.m.algo(e,t,0,1),function(e,t){t.classHierarchy.push("vtkConeSource"),e.requestData=function(e,n){if(t.deleted)return;let i=n[0];const o=2*Math.PI/t.resolution,a=-t.height/2,s=t.resolution+1,l=4*t.resolution+1+t.resolution;let c=0;const u=r.m.newTypedArray(t.pointType,3*s);let d=0;const p=new Uint32Array(l);u[0]=t.height/2,u[1]=0,u[2]=0,t.capping&&(p[d++]=t.resolution);for(let e=0;e<t.resolution;e++)c++,u[3*c+0]=a,u[3*c+1]=t.radius*Math.cos(e*o),u[3*c+2]=t.radius*Math.sin(e*o),t.capping&&(p[t.resolution-d+++1]=c);for(let e=0;e<t.resolution;e++)p[d++]=3,p[d++]=0,p[d++]=e+1,p[d++]=e+2>t.resolution?1:e+2;S.Z.buildFromRadian().translate(...t.center).rotateFromDirections([1,0,0],t.direction).apply(u),i=D.ZP.newInstance(),i.getPoints().setData(u,3),i.getPolys().setData(p,1),n[0]=i}}(e,t)}var V={newInstance:r.m.newInstance(F,"vtkConeSource"),extend:F};const U={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function B(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,U,n),r.m.obj(e,t),r.m.setGet(e,t,["height","initAngle","otherRadius","radius","resolution","capping"]),r.m.setGetArray(e,t,["center","direction"],3),r.m.algo(e,t,0,1),function(e,t){t.classHierarchy.push("vtkCylinderSource"),e.requestData=function(e,n){if(t.deleted)return;let i=n[0];const o=2*Math.PI/t.resolution;let a=2*t.resolution,s=5*t.resolution;t.capping&&(a=4*t.resolution,s=7*t.resolution+2);const l=r.m.newTypedArray(t.pointType,3*a);let c=0;const u=new Uint32Array(s),d=new Float32Array(3*a),p=g.default.newInstance({numberOfComponents:3,values:d,name:"Normals"}),h=new Float32Array(2*a),f=g.default.newInstance({numberOfComponents:2,values:h,name:"TCoords"}),m=[0,0,0],v=[0,0,0],y=[0,0,0],b=[0,0,0],C=[0,0],w=[0,0],E=null==t.otherRadius?t.radius:t.otherRadius;for(let e=0;e<t.resolution;e++){m[0]=Math.cos(e*o+t.initAngle),v[0]=m[0],y[0]=t.radius*m[0]+t.center[0],b[0]=y[0],C[0]=Math.abs(2*e/t.resolution-1),w[0]=C[0],y[1]=.5*t.height+t.center[1],b[1]=-.5*t.height+t.center[1],C[1]=0,w[1]=1,m[2]=-Math.sin(e*o+t.initAngle),v[2]=m[2],y[2]=E*m[2]+t.center[2],b[2]=y[2];const n=2*e;for(let e=0;e<3;e++)d[3*n+e]=m[e],d[3*(n+1)+e]=v[e],l[3*n+e]=y[e],l[3*(n+1)+e]=b[e],e<2&&(h[2*n+e]=C[e],h[2*(n+1)+e]=w[e])}for(let e=0;e<t.resolution;e++){u[c++]=4,u[c++]=2*e,u[c++]=2*e+1;const n=(2*e+3)%(2*t.resolution);u[c++]=n,u[c++]=n-1}if(t.capping){for(let e=0;e<t.resolution;e++){y[0]=t.radius*Math.cos(e*o+t.initAngle),b[0]=y[0],C[0]=y[0],w[0]=y[0],y[0]+=t.center[0],b[0]+=t.center[0],m[1]=1,v[1]=-1,y[1]=.5*t.height+t.center[1],b[1]=-.5*t.height+t.center[1],y[2]=-E*Math.sin(e*o+t.initAngle),b[2]=y[2],C[1]=y[2],w[1]=y[2],y[2]+=t.center[2],b[2]+=t.center[2];const n=2*t.resolution+e,r=3*t.resolution+t.resolution-e-1;for(let e=0;e<3;e++)d[3*n+e]=m[e],d[3*r+e]=v[e],l[3*n+e]=y[e],l[3*r+e]=b[e],e<2&&(h[2*n+e]=C[e],h[2*r+e]=w[e])}u[c++]=t.resolution;for(let e=0;e<t.resolution;e++)u[c++]=2*t.resolution+e;u[c++]=t.resolution;for(let e=0;e<t.resolution;e++)u[c++]=3*t.resolution+e}S.Z.buildFromRadian().translate(...t.center).rotateFromDirections([0,1,0],t.direction).translate(...t.center.map(e=>-1*e)).apply(l),i=D.ZP.newInstance(),i.getPoints().setData(l,3),i.getPolys().setData(u,1),i.getPointData().setNormals(p),i.getPointData().setTCoords(f),n[0]=i}}(e,t)}var G={newInstance:r.m.newInstance(B,"vtkCylinderSource"),extend:B};const W={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function z(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,W,n),r.m.obj(e,t),r.m.setGet(e,t,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),r.m.setGetArray(e,t,["direction"],3),r.m.algo(e,t,0,1),function(e,t){t.classHierarchy.push("vtkArrowSource"),e.requestData=function(e,n){if(t.deleted)return;const r=G.newInstance({capping:!0});r.setResolution(t.shaftResolution),r.setRadius(t.shaftRadius),r.setHeight(1-t.tipLength),r.setCenter(0,.5*(1-t.tipLength),0);const i=r.getOutputData(),o=i.getPoints().getData(),a=i.getPointData().getNormals().getData();S.Z.buildFromDegree().rotateZ(-90).apply(o).apply(a);const s=V.newInstance();s.setResolution(t.tipResolution),s.setHeight(t.tipLength),s.setRadius(t.tipRadius);const l=s.getOutputData(),c=l.getPoints().getData();S.Z.buildFromRadian().translate(1-.5*t.tipLength,0,0).apply(c);const u=L.newInstance();u.setInputData(i),u.addInputData(l);const d=u.getOutputData(),p=d.getPoints().getData();S.Z.buildFromRadian().translate(.5*t.tipLength-.5,0,0).apply(p),t.invert?(S.Z.buildFromRadian().rotateFromDirections([1,0,0],t.direction).scale(-1,-1,-1).apply(p),n[0]=d):(S.Z.buildFromRadian().rotateFromDirections([1,0,0],t.direction).scale(1,1,1).apply(p),n[0]=u.getOutputData())}}(e,t)}var H={newInstance:r.m.newInstance(z,"vtkArrowSource"),extend:z};function j(e){const t=e.getPoints().getBounds(),n=[.5*-(t[0]+t[1]),.5*-(t[2]+t[3]),.5*-(t[4]+t[5])];S.Z.buildFromDegree().translate(...n).apply(e.getPoints().getData())}function Z(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.getPoints().getBounds(),i=[0,0,0];i[t]=n?-r[2*t+1]:-r[2*t],S.Z.buildFromDegree().translate(...i).apply(e.getPoints().getData())}function K(e,t,n,r){const i=e.getPoints().getData().length,o=new Uint8ClampedArray(i);let a=0;for(;a<i;)o[a++]=t,o[a++]=n,o[a++]=r;e.getPointData().setScalars(g.default.newInstance({name:"color",numberOfComponents:3,values:o}))}function $(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};d.ZP.extend(e,t,function(e){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...e?.config},xConfig:{color:[255,0,0],invert:!1,...e?.xConfig},yConfig:{color:[255,255,0],invert:!1,...e?.yConfig},zConfig:{color:[0,128,0],invert:!1,...e?.zConfig}}}(n)),r.m.setGet(e,t,["config","xConfig","yConfig","zConfig"]),function(e,t){t.classHierarchy.push("vtkAxesActor");const n=p.default.newInstance();e.setMapper(n),e.update=()=>{let e={...t.config,...t.xConfig};const r=H.newInstance({direction:[1,0,0],...e}).getOutputData();t.config.recenter?j(r):Z(r,0,e.invert),K(r,...e.color),e={...t.config,...t.yConfig};const i=H.newInstance({direction:[0,1,0],...e}).getOutputData();t.config.recenter?j(i):Z(i,1,e.invert),K(i,...e.color),e={...t.config,...t.zConfig};const o=H.newInstance({direction:[0,0,1],...e}).getOutputData();t.config.recenter?j(o):Z(o,2,e.invert),K(o,...e.color);const a=L.newInstance();a.setInputData(r),a.addInputData(i),a.addInputData(o),n.setInputConnection(a.getOutputPort())},e.update();const i=r.m.debounce(e.update,0);e.setXAxisColor=t=>e.setXConfig({...e.getXConfig(),color:t}),e.setYAxisColor=t=>e.setYConfig({...e.getYConfig(),color:t}),e.setZAxisColor=t=>e.setZConfig({...e.getZConfig(),color:t}),e.getXAxisColor=()=>t.getXConfig().color,e.getYAxisColor=()=>t.getYConfig().color,e.getZAxisColor=()=>t.getZConfig().color,t._onConfigChanged=i,t._onXConfigChanged=i,t._onYConfigChanged=i,t._onZConfigChanged=i}(e,t)}var q={newInstance:r.m.newInstance($,"vtkAxesActor"),extend:$},X=n(39053),Y=Uint8Array,J=Uint16Array,Q=Uint32Array,ee=new Y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),te=new Y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ne=new Y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),re=function(e,t){for(var n=new J(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Q(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return[n,i]},ie=re(ee,2),oe=ie[0],ae=ie[1];oe[28]=258,ae[258]=28;for(var se=re(te,0),le=se[0],ce=(se[1],new J(32768)),ue=0;ue<32768;++ue){var de=(43690&ue)>>>1|(21845&ue)<<1;de=(61680&(de=(52428&de)>>>2|(13107&de)<<2))>>>4|(3855&de)<<4,ce[ue]=((65280&de)>>>8|(255&de)<<8)>>>1}var pe=function(e,t,n){for(var r=e.length,i=0,o=new J(t);i<r;++i)e[i]&&++o[e[i]-1];var a,s=new J(t);for(i=0;i<t;++i)s[i]=s[i-1]+o[i-1]<<1;if(n){a=new J(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],d=s[e[i]-1]++<<u,p=d|(1<<u)-1;d<=p;++d)a[ce[d]>>>l]=c}else for(a=new J(r),i=0;i<r;++i)e[i]&&(a[i]=ce[s[e[i]-1]++]>>>15-e[i]);return a},he=new Y(288);for(ue=0;ue<144;++ue)he[ue]=8;for(ue=144;ue<256;++ue)he[ue]=9;for(ue=256;ue<280;++ue)he[ue]=7;for(ue=280;ue<288;++ue)he[ue]=8;var fe=new Y(32);for(ue=0;ue<32;++ue)fe[ue]=5;var me=pe(he,9,1),ge=pe(fe,5,1),ve=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},ye=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},be=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Ce=function(e){return(e+7)/8|0},we=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(2==e.BYTES_PER_ELEMENT?J:4==e.BYTES_PER_ELEMENT?Q:Y)(n-t);return r.set(e.subarray(t,n)),r},Ee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Te=function(e,t,n){var r=new Error(t||Ee[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Te),!n)throw r;return r},xe=function(e,t,n){var r=e.length;if(!r||n&&n.f&&!n.l)return t||new Y(0);var i=!t||n,o=!n||n.i;n||(n={}),t||(t=new Y(3*r));var a=function(e){var n=t.length;if(e>n){var r=new Y(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,l=n.p||0,c=n.b||0,u=n.l,d=n.d,p=n.m,h=n.n,f=8*r;do{if(!u){s=ye(e,l,1);var m=ye(e,l+1,3);if(l+=3,!m){var g=e[(I=Ce(l)+4)-4]|e[I-3]<<8,v=I+g;if(v>r){o&&Te(0);break}i&&a(c+g),t.set(e.subarray(I,v),c),n.b=c+=g,n.p=l=8*v,n.f=s;continue}if(1==m)u=me,d=ge,p=9,h=5;else if(2==m){var y=ye(e,l,31)+257,b=ye(e,l+10,15)+4,C=y+ye(e,l+5,31)+1;l+=14;for(var w=new Y(C),E=new Y(19),T=0;T<b;++T)E[ne[T]]=ye(e,l+3*T,7);l+=3*b;var x=ve(E),_=(1<<x)-1,S=pe(E,x,1);for(T=0;T<C;){var I,D=S[ye(e,l,_)];if(l+=15&D,(I=D>>>4)<16)w[T++]=I;else{var A=0,P=0;for(16==I?(P=3+ye(e,l,3),l+=2,A=w[T-1]):17==I?(P=3+ye(e,l,7),l+=3):18==I&&(P=11+ye(e,l,127),l+=7);P--;)w[T++]=A}}var O=w.subarray(0,y),R=w.subarray(y);p=ve(O),h=ve(R),u=pe(O,p,1),d=pe(R,h,1)}else Te(1);if(l>f){o&&Te(0);break}}i&&a(c+131072);for(var M=(1<<p)-1,N=(1<<h)-1,L=l;;L=l){var k=(A=u[be(e,l)&M])>>>4;if((l+=15&A)>f){o&&Te(0);break}if(A||Te(2),k<256)t[c++]=k;else{if(256==k){L=l,u=null;break}var F=k-254;if(k>264){var V=ee[T=k-257];F=ye(e,l,(1<<V)-1)+oe[T],l+=V}var U=d[be(e,l)&N],B=U>>>4;U||Te(3),l+=15&U;R=le[B];if(B>3){V=te[B];R+=be(e,l)&(1<<V)-1,l+=V}if(l>f){o&&Te(0);break}i&&a(c+131072);for(var G=c+F;c<G;c+=4)t[c]=t[c-R],t[c+1]=t[c+1-R],t[c+2]=t[c+2-R],t[c+3]=t[c+3-R];c=G}}n.l=u,n.p=L,n.b=c,n.f=s,u&&(s=1,n.m=p,n.d=d,n.n=h)}while(!s);return c==t.length?t:we(t,0,c)},_e=new Y(0),Se=function(e){31==e[0]&&139==e[1]&&8==e[2]||Te(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},Ie=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},De=function(e){(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)&&Te(6,"invalid zlib data"),32&e[1]&&Te(6,"invalid zlib data: preset dictionaries not supported")};function Ae(e,t){return xe(e,t)}function Pe(e,t){return xe(e.subarray(Se(e),-8),t||new Y(Ie(e)))}function Oe(e,t){return xe((De(e),e.subarray(2,-4)),t)}var Re="undefined"!=typeof TextDecoder&&new TextDecoder;try{Re.decode(_e,{stream:!0})}catch(e){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var Me=n(54502);const Ne=[];Ne["-".charCodeAt(0)]=62,Ne["_".charCodeAt(0)]=63;const Le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let e=0;e<64;e++)Ne[Le.charCodeAt(e)]=e;function ke(e){return void 0!==Ne[e.charCodeAt(0)]}function Fe(e,t,n,r){const{start:i,count:o}=t,a=o%4,s=Math.floor(o/4);let l=i,c=null,u=n;for(let t=0;t<s;t++){for(;!ke(e[l]);)l++;for(c=Ne[e.charCodeAt(l++)]<<18;!ke(e[l]);)l++;for(c|=Ne[e.charCodeAt(l++)]<<12;!ke(e[l]);)l++;for(c|=Ne[e.charCodeAt(l++)]<<6;!ke(e[l]);)l++;c|=Ne[e.charCodeAt(l++)],r[u++]=c>>16&255,r[u++]=c>>8&255,r[u++]=255&c}switch(a){case 3:for(;!ke(e[l]);)l++;for(c=Ne[e.charCodeAt(l++)]<<10;!ke(e[l]);)l++;for(c|=Ne[e.charCodeAt(l++)]<<4;!ke(e[l]);)l++;c|=Ne[e.charCodeAt(l++)]>>2,r[u++]=c>>8&255,r[u++]=255&c;break;case 2:for(;!ke(e[l]);)l++;for(c=Ne[e.charCodeAt(l++)]<<2;!ke(e[l]);)l++;c|=Ne[e.charCodeAt(l++)]>>4,r[u++]=255&c;break;case 1:throw new Error("BASE64: remain 1 should not happen")}return u}function Ve(e,t,n){const r=(e<<16)+(t<<8)+n;return Le[r>>18]+Le[r>>12&63]+Le[r>>6&63]+Le[63&r]}var Ue={toArrayBuffer:function(e){const t=function(e){const t=e.length,n=[];let r=null;for(let i=0;i<t;i++)ke(e[i])?(r||(r={start:i,count:0}),r.count++,r.end=i):"="===e[i]&&r&&(n.push(r),r=null);return r&&n.push(r),n}(e),n=t[t.length-1].end+1,r=(4-n%4)%4,i=new ArrayBuffer(3*(n+r)/4-r),o=new Uint8Array(i);let a=0;for(let n=0;n<t.length;n++)a+=Fe(e,t[n],a,o),a+=(4-t[n].count%4)%4;return i},fromArrayBuffer:function(e){const t=new Uint8Array(e),n=e.byteLength%3,r=e.byteLength-n,i=Array(r/3);for(let e=0;e<i.length;e++){const n=3*e;i[e]=Ve(t[n],t[n+1],t[n+2])}if(n>0){const e=Ve(t[r],t[r+1]||0,t[r+2]||0);1===n?i.push(`${e.substr(0,2)}==`):2===n&&i.push(`${e.substr(0,3)}=`)}return i.join("")}};const Be={name:"",numberOfComponents:1,size:0,dataType:"string"};function Ge(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,Be,n),!t.empty&&!t.values&&!t.size)throw new TypeError("Cannot create vtkStringArray object without: size > 0, values");t.values?Array.isArray(t.values)&&(t.values=[...t.values]):t.values=[],t.values&&(t.size=t.values.length),r.m.obj(e,t),r.m.set(e,t,["name"]),function(e,t){t.classHierarchy.push("vtkStringArray"),e.getComponent=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.values[e*t.numberOfComponents+n]},e.setComponent=(n,r,i)=>{i!==t.values[n*t.numberOfComponents+r]&&(t.values[n*t.numberOfComponents+r]=i,e.modified())},e.getData=()=>t.values,e.getTuple=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=t.numberOfComponents||1;n.length&&(n.length=r);const i=e*r;for(let e=0;e<r;e++)n[e]=t.values[i+e];return n},e.getTupleLocation=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*t.numberOfComponents},e.getNumberOfComponents=()=>t.numberOfComponents,e.getNumberOfValues=()=>t.values.length,e.getNumberOfTuples=()=>t.values.length/t.numberOfComponents,e.getDataType=()=>t.dataType,e.newClone=()=>We({name:t.name,numberOfComponents:t.numberOfComponents,empty:!0}),e.getName=()=>(t.name||e.setName(`vtkStringArray${e.getMTime()}`),t.name),e.setData=(n,r)=>{t.values=n,t.size=n.length,r&&(t.numberOfComponents=r),t.size%t.numberOfComponents!==0&&(t.numberOfComponents=1),e.modified()}}(e,t)}const We=r.m.newInstance(Ge,"vtkStringArray");var ze={newInstance:We,extend:Ge},He=n(52739);n(84030);function je(e,t){return function(e,t){return[...e.getElementsByTagName(t)]}(e,t)[0]}const Ze={Int8:Int8Array,UInt8:Uint8Array,Int16:Int16Array,UInt16:Uint16Array,Int32:Int32Array,UInt32:Uint32Array,Int64:Int32Array,UInt64:Uint32Array,Float32:Float32Array,Float64:Float64Array},Ke={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,Int64:8,UInt64:8,Float32:4,Float64:8};function $e(e){const t=e.length-1;return e.filter((e,n)=>n<t&&n%2==0)}function qe(e,t,n){if(!["UInt64","UInt32"].includes(n))throw new Error(`Cannot handle a header type of ${n}`);let r=Ze[n],i=Ze[t],o=!1;"UInt64"===n&&(r=Ze.UInt32),/^U?Int64$/.test(t)&&(o=!0,i=Ze[t.replace("64","32")]);const{byteOffset:a}=e,s=Ke[t],l=Ke[n];let c;c=a%l===0?new r(e.buffer,a,1):new r(e.buffer.slice(a,a+l));const u=Number(c[0]);let d,p=u/s;o&&(p*=2);const h=a+l;return d=h%s===0?new i(e.buffer,h,p):new i(e.buffer.slice(h,h+u)),o&&(d=$e(d)),d}function Xe(e,t){const n=31==(r=e)[0]&&139==r[1]&&8==r[2]?Pe(r,i):8!=(15&r[0])||r[0]>>4>7||(r[0]<<8|r[1])%31?Ae(r,i):Oe(r,i);var r,i;t.uint8.set(n,t.offset),t.offset+=n.length}function Ye(e,t){const n=function(e,t){if("UInt64"===t){const t=8;let n=new Uint32Array(e.buffer,0,6);const r=n[0],i=[t,r,n[2],n[4]];n=new Uint32Array(e.buffer,24,2*r);for(let e=0;e<r;e++)i.push(n[2*e]);return i}let n=new Uint32Array(e.buffer,0,3);const r=n[0],i=[4,r,n[1],n[2]];n=new Uint32Array(e.buffer,12,r);for(let e=0;e<r;e++)i.push(n[e]);return i}(e,t),r=n[1],i=n[2],o=n[3];let a=0;r>0&&(a=0===o?r*i:(r-1)*i+o);const s=new ArrayBuffer(a),l={offset:0,uint8:new Uint8Array(s)};let c=function(e){const[t]=e;return(e.length-1)*t}(n);for(;c<e.length&&120!==e[c];)c++;for(let t=0;t<r;t++){const r=n[4+t];Xe(new Uint8Array(e.buffer,c,r),l),c+=r}return l.uint8}function Je(e,t,n,r,i,o){const a=t.getAttribute("type"),s=t.getAttribute("Name"),l=t.getAttribute("format"),c=Number(t.getAttribute("NumberOfComponents")||"1");let u=null;if("ascii"===l){u=new Ze[a](e*c);let n=0;t.firstChild.nodeValue.split(/[\\t \\n]+/).forEach(e=>{e.trim().length&&(u[n++]=Number(e))})}else if("binary"===l){const e=new Uint8Array(Ue.toArrayBuffer(t.firstChild.nodeValue.trim()));if("vtkZLibDataCompressor"===n){const t=Ye(e,i);u=new Ze[a](t.buffer),/^U?Int64$/.test(a)&&(u=$e(u))}else u=new Ze[a](e.buffer,Ke[i]),-1!==a.indexOf("Int64")&&(u=$e(u))}else if("appended"===l){const e=Number(t.getAttribute("offset"));u=qe(new Uint8Array(o,e),a,i)}else console.error("Format not supported",l);return{name:s,values:u,numberOfComponents:c}}function Qe(e){return(new TextDecoder).decode(e).split("\0").slice(0,-1)}function et(e,t,n,i,o){const a=[...e.getElementsByTagName("DataArray")].map(e=>g.default.newInstance(Je(Number(e.getAttribute("NumberOfTuples")),e,t,0,i,o))),s=[...e.getElementsByTagName("Array")].filter(e=>"String"===e.getAttribute("type")).map(e=>{const n=ze.newInstance(function(e,t,n,i,o){const a=e.getAttribute("Name"),s=e.getAttribute("format"),l=Number(e.getAttribute("NumberOfComponents")||"1"),c=Number(e.getAttribute("NumberOfTuples")||"1")*l,u=[];if("ascii"===s){const t=e.firstChild.nodeValue.trim().split(/\s+/);let n=0;const r=[];for(;u.length<c;){const e=Number(t[n++]);0===e?(u.push(r.join("")),r.length=0):r.push(String.fromCharCode(e))}}else if("binary"===s){const n=new Uint8Array(Ue.toArrayBuffer(e.firstChild.nodeValue.trim()));if("vtkZLibDataCompressor"===t){const e=Ye(n,i);u.push(...Qe(e))}else{const e=qe(n,"UInt8",i);u.push(...Qe(e))}}else if("appended"===s){const t=Number(e.getAttribute("offset")),n=qe(new Uint8Array(o,t),"UInt8",i);u.push(...Qe(n))}else r.m.vtkErrorMacro(`Format not supported: ${s}`);return{name:a,values:u,numberOfComponents:l}}(e,t,0,i,o));return n});return[...a,...s]}function tt(e,t){t.classHierarchy.push("vtkXMLReader"),t.dataAccessHelper||(t.dataAccessHelper=Me.ZP.get("http")),e.setUrl=function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.url=n;const i=n.split("/");return i.pop(),t.baseURL=i.join("/"),e.loadData(r)},e.loadData=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.dataAccessHelper.fetchBinary(e,n)}(t.url,n).then(e.parseAsArrayBuffer)},e.parseAsArrayBuffer=n=>{if(!n)return!1;if(n===t.rawDataBuffer)return!0;e.modified();const{text:r,binaryBuffer:i}=(o=n,He.Z.extractBinary(o,/^\s*<AppendedData\s+encoding="raw">\s*_/m,/\n\s*<\/AppendedData>/m));var o;t.rawDataBuffer=n,t.binaryBuffer=i;var a;const s=(a=r,(0,X.create)(a)).root(),l=s.node,c=l.getAttribute("type"),u=l.getAttribute("compressor"),d=l.getAttribute("byte_order"),p=l.getAttribute("header_type")||"UInt32";if(u&&"vtkZLibDataCompressor"!==u)return console.error("Invalid compressor",u),!1;if(d&&"LittleEndian"!==d)return console.error("Only LittleEndian encoding is supported"),!1;if(c!==t.dataType)return console.error("Invalid data type",c,"expecting",t.dataType),!1;if(je(l,"AppendedData")){const e=je(l,"AppendedData"),n=e.getAttribute("encoding"),r=s.filter(e=>{const{node:t}=e;return t.nodeType===Node.ELEMENT_NODE&&"appended"===t.getAttribute("format")&&t.hasAttribute("offset")},!1,!0).map(e=>({node:e.node,offset:Number(e.node.getAttribute("offset"))}));r.sort((e,t)=>e.offset-t.offset);let i=t.binaryBuffer;"base64"===n&&(i=e.textContent.trim().substr(1));const o=[];for(let e=0;e<r.length;++e){const t=r[e].offset;let a=0;a=e===r.length-1?i.length||i.byteLength:r[e+1].offset,"base64"===n?o.push(new Uint8Array(Ue.toArrayBuffer(i.substring(t,a)))):o.push(new Uint8Array(i.slice(t,a)))}if("vtkZLibDataCompressor"===u)for(let e=0;e<o.length;++e){const t=Ye(o[e],p),n=new Uint8Array(t.length+Ke[p]);new Ze[p](n.buffer,0,1)[0]=t.length,n.set(t,Ke[p]),o[e]=n}const a=o.reduce((e,t)=>e+t.length,0),c=new ArrayBuffer(a),d=new Uint8Array(c);for(let e=0,t=0;e<o.length;++e)r[e].node.setAttribute("offset",t),d.set(o[e],t),t+=o[e].length;if(t.binaryBuffer=c,!t.binaryBuffer)return console.error("Processing appended data format: requires binaryBuffer to parse"),!1}e.parseXML(l,c,u,d,p);const h=l.getElementsByTagName(c)[0].getElementsByTagName("FieldData")[0];if(h){const e=et(h,u,0,p,t.binaryBuffer);for(let n=0;n<t.output.length;n++){const r=t.output[n].getFieldData();for(let t=0;t<e.length;t++)r.addArray(e[t])}}return!0},e.requestData=(n,r)=>{e.parseAsArrayBuffer(t.rawDataBuffer)}}const nt={};var rt={extend:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,nt,n),r.m.obj(e,t),r.m.get(e,t,["url","baseURL"]),r.m.setGet(e,t,["dataAccessHelper"]),r.m.algo(e,t,0,1),tt(e,t)},processDataArray:Je,processFieldData:function(e,t,n,r,i,o,a){if(t){const i={};["Scalars","Vectors","Normals","Tensors","TCoords"].forEach(e=>{const r=t.getAttribute(e);r&&(i[r]=n[`set${e}`])});const s=t.getElementsByTagName("DataArray"),l=s.length;for(let t=0;t<l;t++){const l=s[t],c=g.default.newInstance(Je(e,l,r,0,o,a)),u=c.getName();(i[u]||n.addArray)(c)}}},processCells:function(e,t,n,r,i,o){const a={},s=t.getElementsByTagName("DataArray");for(let e=0;e<s.length;e++){const t=s[e];a[t.getAttribute("Name")]=t}const l=Je(e,a.offsets,n,0,i,o).values,c=l[l.length-1],u=Je(c,a.connectivity,n,0,i,o).values,d=new Uint32Array(e+c);let p=0,h=0;return l.forEach(e=>{const t=e-h;d[p++]=t;for(let e=0;e<t;e++)d[p++]=u[h+e];h=e}),d}};function it(e,t,n,r,i,o,a){const s=Number(n.getAttribute(`NumberOf${t}`));if(s>0){const l=n.getElementsByTagName(t)[0].getElementsByTagName("DataArray")[0],{values:c,numberOfComponents:u}=rt.processDataArray(s,l,r,i,o,a);e[`get${t}`]().setData(c,u)}return s}function ot(e,t,n,r,i,o,a){const s=Number(n.getAttribute(`NumberOf${t}`));if(s>0){const l=rt.processCells(s,n.getElementsByTagName(t)[0],r,i,o,a);e[`get${t}`]().setData(l)}return s}const at={dataType:"PolyData"};function st(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,at,n),rt.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkXMLPolyDataReader"),e.parseXML=(e,n,r,i,o)=>{const a=e.getElementsByTagName(t.dataType)[0].getElementsByTagName("Piece"),s=a.length;for(let e=0;e<s;e++){const n=D.ZP.newInstance(),s=a[e],l=it(n,"Points",s,r,i,o,t.binaryBuffer);let c=0;["Verts","Lines","Strips","Polys"].forEach(e=>{c+=ot(n,e,s,r,i,o,t.binaryBuffer)}),rt.processFieldData(l,s.getElementsByTagName("PointData")[0],n.getPointData(),r,i,o,t.binaryBuffer),rt.processFieldData(c,s.getElementsByTagName("CellData")[0],n.getCellData(),r,i,o,t.binaryBuffer),t.output[e]=n}}}(e,t)}var lt={newInstance:r.m.newInstance(st,"vtkXMLPolyDataReader"),extend:st},ct=n(93382),ut=n(62709),dt=n(46966),pt=n(27078),ht=n(68096);const ft={ANNOTATED_CUBE:1,AXES:2,CUSTOM:3};class mt extends ct.ml{static{this.CUBE=1}static{this.AXIS=2}static{this.VTPFILE=3}static{this.OVERLAY_MARKER_TYPES=ft}constructor(e={},t={configuration:{orientationWidget:{enabled:!0,viewportCorner:u.Corners.BOTTOM_RIGHT,viewportSize:.15,minPixelSize:100,maxPixelSize:300},overlayMarkerType:mt.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE,overlayConfiguration:{[mt.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE]:{faceProperties:{xPlus:{text:"R",faceColor:"#ffff00",faceRotation:90},xMinus:{text:"L",faceColor:"#ffff00",faceRotation:270},yPlus:{text:"P",faceColor:"#00ffff",fontColor:"white",faceRotation:180},yMinus:{text:"A",faceColor:"#00ffff",fontColor:"white"},zPlus:{text:"S"},zMinus:{text:"I"}},defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:e=>e/2,faceColor:"#0000ff",edgeThickness:.1,edgeColor:"black",resolution:400}},[mt.OVERLAY_MARKER_TYPES.AXES]:{},[mt.OVERLAY_MARKER_TYPES.CUSTOM]:{polyDataURL:"https://raw.githubusercontent.com/Slicer/Slicer/80ad0a04dacf134754459557bf2638c63f3d1d1b/Base/Logic/Resources/OrientationMarkers/Human.vtp"}}}}){super(e,t),this._resizeObservers=new Map,this.onSetToolEnabled=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolActive=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolDisabled=()=>{this.cleanUpData(),this._unsubscribeToViewportNewVolumeSet()},this._getViewportsInfo=()=>(0,pt.getToolGroup)(this.toolGroupId).viewportsInfo,this.resize=e=>{const t=this.orientationMarkers[e];if(!t)return;const{orientationWidget:n}=t;n.updateViewport()},this.orientationMarkers={}}_unsubscribeToViewportNewVolumeSet(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,ut.getEnabledElementByIds)(e,t),{element:r}=n;r.removeEventListener(ut.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));this._resizeObservers.get(e).unobserve(r)})};ut.eventTarget.removeEventListener(ht.Events.TOOLGROUP_VIEWPORT_ADDED,t=>{t.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}_subscribeToViewportEvents(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,ut.getEnabledElementByIds)(e,t),{element:r}=n;this.initViewports(),r.addEventListener(ut.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));const i=new ResizeObserver(()=>{setTimeout(()=>{const n=(0,ut.getEnabledElementByIds)(e,t);if(!n)return;const{viewport:r}=n;this.resize(e),r.render()},100)});i.observe(r),this._resizeObservers.set(e,i)})};e(),ut.eventTarget.addEventListener(ht.Events.TOOLGROUP_VIEWPORT_ADDED,t=>{t.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}cleanUpData(){(0,ut.getRenderingEngines)()[0].getViewports().forEach(e=>{const t=this.orientationMarkers[e.id];if(!t)return;const{actor:n,orientationWidget:r}=t;r?.setEnabled(!1),r?.delete(),n?.delete();e.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow().render(),e.getRenderingEngine().render(),delete this.orientationMarkers[e.id]})}initViewports(){const e=(0,ut.getRenderingEngines)()[0];if(!e)return;let t=e.getViewports();t=(0,dt.filterViewportsWithToolEnabled)(t,this.getToolName()),t.forEach(e=>{e.getWidget(this.getToolName())||this.addAxisActorInViewport(e)})}async addAxisActorInViewport(e){const t=e.id,n=this.configuration.overlayMarkerType,r=this.configuration.overlayConfiguration[n];if(this.orientationMarkers[t]){const{actor:n,orientationWidget:r}=this.orientationMarkers[t];e.getRenderer().removeActor(n),r.setEnabled(!1)}let i;1===n?i=this.createAnnotationCube(r):2===n?i=q.newInstance():3===n&&(i=await this.createCustomActor());const o=e.getRenderer(),a=e.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow(),{enabled:s,viewportCorner:l,viewportSize:c,minPixelSize:d,maxPixelSize:p}=this.configuration.orientationWidget,h=u.newInstance({actor:i,interactor:a.getInteractor(),parentRenderer:o});h.setEnabled(s),h.setViewportCorner(l),h.setViewportSize(c),h.setMinPixelSize(d),h.setMaxPixelSize(p),h.updateMarkerOrientation(),this.orientationMarkers[t]={orientationWidget:h,actor:i},e.addWidget(this.getToolName(),h),a.render(),e.getRenderingEngine().render()}async createCustomActor(){const e=this.configuration.overlayConfiguration[ft.CUSTOM].polyDataURL,t=await fetch(e),n=await t.arrayBuffer(),r=lt.newInstance();r.parseAsArrayBuffer(n),r.update();const i=D.ZP.newInstance();i.shallowCopy(r.getOutputData()),i.getPointData().setActiveScalars("Color");const o=p.default.newInstance();o.setInputData(i),o.setColorModeToDirectScalars();const a=d.ZP.newInstance();return a.setMapper(o),a.rotateZ(180),a}createAnnotationCube(e){const t=_.newInstance();return t.setDefaultStyle({...e.defaultStyle}),t.setXPlusFaceProperty({...e.faceProperties.xPlus}),t.setXMinusFaceProperty({...e.faceProperties.xMinus}),t.setYPlusFaceProperty({...e.faceProperties.yPlus}),t.setYMinusFaceProperty({...e.faceProperties.yMinus}),t.setZPlusFaceProperty({...e.faceProperties.zPlus}),t.setZMinusFaceProperty({...e.faceProperties.zMinus}),t}async createAnnotatedCubeActor(){const e=_.newInstance(),{faceProperties:t,defaultStyle:n}=this.configuration.annotatedCube;return e.setDefaultStyle(n),Object.keys(t).forEach(n=>{const r=`set${n.charAt(0).toUpperCase()+n.slice(1)}FaceProperty`;e[r](t[n])}),e}}mt.toolName="OrientationMarker"},51190:(e,t,n)=>{"use strict";var r=n(72076),i=n(62709),o=n(86614),a=n(27078),s=n(86785),l=n(66878),c=n(92622);const{EPSILON:u}=i.CONSTANTS;class d extends c.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceImageIds:[]}}){super(e,t),this.onSetToolEnabled=()=>{this._init()},this.onSetToolActive=()=>{this._init()},this._init=()=>{const e=this.configuration.sourceImageIds;if(!e?.length)return void console.warn("OverlayGridTool: No sourceImageIds provided in configuration");const t=i.metaData.get("imagePlaneModule",e[0]);if(!t)return void console.warn("OverlayGridTool: No imagePlaneModule found for sourceImageIds");const{frameOfReferenceUID:n}=t,r=(0,a.getToolGroup)(this.toolGroupId).viewportsInfo;if(!r?.length)return void console.warn("OverlayGridTool: No viewports found");const s=(0,o.getAnnotations)(this.getToolName(),n);if(!s?.length){const t=e.map(e=>this.calculateImageIdPointSets(e)),r={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:n,referencedImageId:null},data:{viewportData:new Map,pointSets:t}};(0,o.addAnnotation)(r,n)}(0,l.Z)((0,i.getRenderingEngine)(r[0].renderingEngineId),r.map(({viewportId:e})=>e))},this.calculateImageIdPointSets=e=>{const{imagePositionPatient:t,rows:n,columns:o,rowCosines:a,columnCosines:s,rowPixelSpacing:l,columnPixelSpacing:c}=i.metaData.get("imagePlaneModule",e),u=[...t],d=[...t],p=[...t],h=[...t];r.R3.scaleAndAdd(d,t,s,o*c),r.R3.scaleAndAdd(p,t,a,n*l),r.R3.scaleAndAdd(h,p,s,o*c);return{pointSet1:[u,p,d,h],pointSet2:[u,d,p,h]}},this.renderAnnotation=(e,t)=>{const n=this.configuration.sourceImageIds;let a=!1;if(!n?.length)return a;const{viewport:l,FrameOfReferenceUID:c}=e;if(l.getImageIds().length<2)return a;const u=(0,o.getAnnotations)(this.getToolName(),c);if(!u?.length)return a;const d=u[0],{annotationUID:p}=d,{focalPoint:h,viewPlaneNormal:f}=l.getCamera(),m={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},g=this.getImageIdNormal(n[0]);if(this.isParallel(f,g))return a;const v=i.utilities.planar.planeEquation(f,h),y=d.data.pointSets,b=d.data.viewportData;for(let e=0;e<n.length;e++){const{pointSet1:n,pointSet2:o}=y[e],a=b.get(l.id)||this.initializeViewportData(b,l.id);if(!a.pointSetsToUse[e]){let t=n,s=r.R3.subtract(r.R3.create(),n[0],n[1]);s=r.R3.normalize(r.R3.create(),s),this.isPerpendicular(s,f)&&(t=o),a.pointSetsToUse[e]=t,a.lineStartsWorld[e]=i.utilities.planar.linePlaneIntersection(t[0],t[1],v),a.lineEndsWorld[e]=i.utilities.planar.linePlaneIntersection(t[2],t[3],v)}const c=a.lineStartsWorld[e],u=a.lineEndsWorld[e];m.annotationUID=p;const h=this.getStyle("lineWidth",m,d),g=this.getStyle("lineDash",m,d),C=this.getStyle("color",m,d),w=this.getStyle("shadow",m,d),E=[c,u].map(e=>l.worldToCanvas(e)),T=`${p}-line`,x=`${e}`;(0,s.drawLine)(t,p,x,E[0],E[1],{color:C,width:h,lineDash:g,shadow:w},T)}return a=!0,a},this.initializeViewportData=(e,t)=>(e.set(t,{pointSetsToUse:[],lineStartsWorld:[],lineEndsWorld:[]}),e.get(t)),this.isPerpendicular=(e,t)=>{const n=r.R3.dot(e,t);return Math.abs(n)<u}}isParallel(e,t){return Math.abs(r.R3.dot(e,t))>1-u}getImageIdNormal(e){const{imageOrientationPatient:t}=i.metaData.get("imagePlaneModule",e),n=r.R3.fromValues(t[0],t[1],t[2]),o=r.R3.fromValues(t[3],t[4],t[5]);return r.R3.cross(r.R3.create(),n,o)}}d.toolName="OverlayGrid"},33908:(e,t,n)=>{"use strict";var r=n(93382),i=n(62709);class o extends r.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_dragCallback(e){const{element:t,deltaPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),o=n.world;if(0===o[0]&&0===o[1]&&0===o[2])return;const a=r.viewport.getCamera(),{focalPoint:s,position:l}=a,c=[l[0]-o[0],l[1]-o[1],l[2]-o[2]],u=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];r.viewport.setCamera({focalPoint:u,position:c}),r.viewport.render()}}o.toolName="Pan"},52826:(e,t,n)=>{"use strict";var r=n(62709),i=n(72076),o=n(93382),a=n(21221);class s extends o.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:t,currentPoints:n,startPoints:o}=e.detail,s=n.world,l=o.world,c=(0,r.getEnabledElement)(t),{viewport:u}=c,d=u.getCamera(),p=[.5*t.clientWidth,.5*t.clientHeight],h=u.canvasToWorld(p);let f=(0,a.Z)([l,h],[h,s]);const{viewPlaneNormal:m,viewUp:g}=d,v=i.R3.sub(i.R3.create(),h,l),y=i.R3.sub(i.R3.create(),h,s),b=i.R3.cross(i.R3.create(),v,y);if(i.R3.dot(m,b)>0&&(f=-f),!Number.isNaN(f)){if(u instanceof r.BaseVolumeViewport){const e=f*Math.PI/180,t=i._E.identity(new Float32Array(16));i._E.rotate(t,t,e,m);const n=i.R3.transformMat4(i.R3.create(),g,t);u.setCamera({viewUp:n})}else{const{rotation:e}=u.getProperties();u.setProperties({rotation:e+f})}u.render()}}}s.toolName="PlanarRotate"},69243:(e,t,n)=>{"use strict";var r=n(62709),i=n(86614),o=n(41836),a=n(86785),s=n(46966),l=n(66878),c=n(72076),u=n(92622),d=n(32899),p=n(23118),h=n(27078);class f extends u.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}}){super(e,t),this.isDrawing=!1,this.isHandleOutsideImage=!1,this._elementWithCursor=null,this._currentCursorWorldPosition=null,this._currentCanvasPosition=null,this._disableCursorEnabled=!1,this.mouseMoveCallback=e=>{const{detail:t}=e,{element:n,currentPoints:r}=t;this._currentCursorWorldPosition=r.world,this._currentCanvasPosition=r.canvas,this._elementWithCursor=n;const i=this.getActiveAnnotation(n);return null===i?(this.createInitialAnnotation(r.world,n),!1):(this.updateAnnotationPosition(n,i),!1)},this.createInitialAnnotation=(e,t)=>{const n=(0,r.getEnabledElement)(t);if(!n)throw new Error("No enabled element found");const{viewport:o,renderingEngine:a}=n;this.isDrawing=!0;const c=o.getCamera(),{viewPlaneNormal:u,viewUp:d}=c;if(!u||!d)throw new Error("Camera not found");const p=this.getReferencedImageId(o,e,u,d),h=o.getFrameOfReferenceUID(),f={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:h,referencedImageId:p},data:{label:"",handles:{points:[[...e]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if((0,i.getAnnotations)(this.getToolName(),t).length>0)return null;if(null===(0,i.addAnnotation)(f,t))return;const m=(0,s.getViewportIdsWithToolToRender)(t,this.getToolName(),!1);(0,l.Z)(a,m)},this.onCameraModified=e=>{const t=e.detail,{element:n,previousCamera:i,camera:o}=t,a=(0,r.getEnabledElement)(n).viewport;if(n!==this._elementWithCursor)return;const s=i.focalPoint,l=o.viewPlaneNormal,c=o.focalPoint,u=[0,0,0];if(d.ZP.subtract(c,s,u),0===u.reduce((e,t)=>e+t,0))return;const p=d.ZP.dot(u,l);if(Math.abs(p)<.01)return;if(!this._currentCanvasPosition)return;const h=a.canvasToWorld(this._currentCanvasPosition);this._currentCursorWorldPosition=h,this.updateAnnotationPosition(n,this.getActiveAnnotation(n))},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r,FrameOfReferenceUID:s}=e,l=this._elementWithCursor===r.element;this.configuration.positionSync&&!l&&this.updateViewportImage(r);const{element:c}=r;let u=(0,i.getAnnotations)(this.getToolName(),c);if(!u?.length)return n;if(u=this.filterInteractableAnnotationsForElement(c,u),!u?.length)return n;const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<u.length;e++){const i=u[e],{annotationUID:s,data:c}=i,{handles:p}=c,{points:h}=p;if(!s)return n;d.annotationUID=s;const f=parseFloat(this.getStyle("lineWidth",d,i)),m=f,g=this.getStyle("lineDash",d,i),v=this.getStyle("color",d,i);if(h[0].some(e=>isNaN(e)))return n;const y=h.map(e=>r.worldToCanvas(e));if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,o.isAnnotationVisible)(s))continue;const b={upper:"upper",right:"right",lower:"lower",left:"left"},[C,w]=y[0],E=l?20:7,T=l?5:7;(0,a.drawLine)(t,s,b.upper,[C,w-(E/2+T)],[C,w-E/2],{color:v,lineDash:g,lineWidth:m}),(0,a.drawLine)(t,s,b.lower,[C,w+(E/2+T)],[C,w+E/2],{color:v,lineDash:g,lineWidth:m}),(0,a.drawLine)(t,s,b.right,[C+(E/2+T),w],[C+E/2,w],{color:v,lineDash:g,lineWidth:m}),(0,a.drawLine)(t,s,b.left,[C-(E/2+T),w],[C-E/2,w],{color:v,lineDash:g,lineWidth:m}),n=!0}return n},this._disableCursorEnabled=this.configuration.disableCursor}onSetToolActive(){if(this._disableCursorEnabled=this.configuration.disableCursor,!this._disableCursorEnabled)return;const e=(0,h.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e)return;e.map(e=>(0,r.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)).forEach(e=>{e&&(0,p.hideElementCursor)(e.viewport.element)})}onSetToolDisabled(){if(!this._disableCursorEnabled)return;const e=(0,h.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e)return;e.map(e=>(0,r.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)).forEach(e=>{e&&(0,p.resetElementCursor)(e.viewport.element)})}getActiveAnnotation(e){const t=(0,i.getAnnotations)(this.getToolName(),e);if(!t.length)return null;return t[0]}updateAnnotationPosition(e,t){const n=this._currentCursorWorldPosition;if(!n)return;if(!t.data?.handles?.points)return;t.data.handles.points=[[...n]],t.invalidated=!0;const i=(0,s.getViewportIdsWithToolToRender)(e,this.getToolName(),!1),o=(0,r.getEnabledElement)(e);if(!o)return;const{renderingEngine:a}=o;(0,l.Z)(a,i)}filterInteractableAnnotationsForElement(e,t){if(!(t instanceof Array)||0===t.length)return[];const n=t[0],i=(0,r.getEnabledElement)(e)?.viewport;if(!i)return[];const o=i.getCamera(),{viewPlaneNormal:a,focalPoint:s}=o;if(!a||!s)return[];const l=n.data?.handles?.points;if(!(l instanceof Array)||1!==l.length)return[];const c=l[0],u=r.utilities.planar.planeEquation(a,s);return r.utilities.planar.planeDistanceToPoint(u,c)<this.configuration.displayThreshold?[n]:[]}updateViewportImage(e){const t=this._currentCursorWorldPosition;if(t&&!t.some(e=>isNaN(e)))if(e instanceof r.StackViewport){const n=r.utilities.getClosestStackImageIndexForPoint(t,e);if(null===n)return;n!==e.getCurrentImageIdIndex()&&e.setImageIdIndex(n)}else if(e instanceof r.VolumeViewport){const{focalPoint:n,viewPlaneNormal:i}=e.getCamera();if(!n||!i)return;const o=r.utilities.planar.planeEquation(i,n),a=r.utilities.planar.planeDistanceToPoint(o,t,!0);if(Math.abs(a)<.5)return;const s=c.R3.normalize(c.R3.create(),c.R3.fromValues(...i)),l=c.R3.scale(c.R3.create(),s,a),u=c.R3.add(c.R3.create(),c.R3.fromValues(...n),l);if(!0){e.setCamera({focalPoint:u});const t=e.getRenderingEngine();t&&t.renderViewport(e.id)}}}}f.toolName="ReferenceCursors"},2235:(e,t,n)=>{"use strict";var r=n(72076),i=n(62709),o=n(86614),a=n(86785),s=n(46966),l=n(66878),c=n(92622);const{EPSILON:u}=i.CONSTANTS;class d extends c.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:"",showFullDimension:!1}}){super(e,t),this.editData={},this._init=()=>{const e=(0,i.getRenderingEngines)()[0];if(!e)return;let t=e.getViewports();t=(0,s.filterViewportsWithToolEnabled)(t,this.getToolName());const n=e.getViewport(this.configuration.sourceViewportId);if(!n?.getImageData())return;const{element:r}=n,{viewUp:a,viewPlaneNormal:c}=n.getCamera(),u=i.utilities.getViewportImageCornersInWorld(n);let d=this.editData.annotation;const p=n.getFrameOfReferenceUID();if(d)this.editData.annotation.data.handles.points=u;else{const e={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...c],viewUp:[...a],FrameOfReferenceUID:p,referencedImageId:null},data:{handles:{points:u}}};(0,o.addAnnotation)(e,r),d=e}this.editData={sourceViewportId:n.id,renderingEngine:e,annotation:d},(0,l.Z)(e,t.filter(e=>e.id!==n.id).map(e=>e.id))},this.onSetToolEnabled=()=>{this._init()},this.onSetToolConfiguration=()=>{this._init()},this.onCameraModified=e=>{this._init()},this.renderAnnotation=(e,t)=>{const{viewport:n}=e,{annotation:o,sourceViewportId:s}=this.editData;let l=!1;const{viewport:c}=(0,i.getEnabledElementByViewportId)(s)||{};if(!c)return l;if(c.id===n.id)return l;if(!o||!o?.data?.handles?.points)return l;const u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},d=o.data.handles.points[0],p=o.data.handles.points[1],h=o.data.handles.points[2],f=o.data.handles.points[3],{focalPoint:m,viewPlaneNormal:g,viewUp:v}=n.getCamera(),{viewPlaneNormal:y}=c.getCamera();if(this.isParallel(g,y))return l;const b=i.utilities.planar.planeEquation(g,m),C=[d,h,p,f],w=[d,p,h,f];let E=C,T=r.R3.subtract(r.R3.create(),C[0],C[1]);T=r.R3.normalize(r.R3.create(),T);let x=r.R3.subtract(r.R3.create(),C[2],C[0]);x=r.R3.normalize(r.R3.create(),x);const _=r.R3.cross(r.R3.create(),T,x);if(this.isParallel(_,g))return l;this.isPerpendicular(T,g)&&(E=w);const S=i.utilities.planar.linePlaneIntersection(E[0],E[1],b),I=i.utilities.planar.linePlaneIntersection(E[2],E[3],b),{annotationUID:D}=o;u.annotationUID=D;const A=this.getStyle("lineWidth",u,o),P=this.getStyle("lineDash",u,o),O=this.getStyle("color",u,o),R=this.getStyle("shadow",u,o);let M=[S,I].map(e=>n.worldToCanvas(e));if(this.configuration.showFullDimension&&(M=this.handleFullDimension(n,S,g,v,I,M)),M.length<2)return l;const N=`${D}-line`;return(0,a.drawLine)(t,D,"1",M[0],M[1],{color:O,width:A,lineDash:P,shadow:R},N),l=!0,l},this.isPerpendicular=(e,t)=>{const n=r.R3.dot(e,t);return Math.abs(n)<u}}handleFullDimension(e,t,n,r,o,a){const s=e.getRenderingEngine(),l=this.getTargetId(e),c=this.getTargetIdImage(l,s),u=this.getReferencedImageId(e,t,n,r);if(u&&c)try{const{imageData:n,dimensions:r}=c,[s,l,d,p]=[n.indexToWorld([0,0,0]),n.indexToWorld([r[0]-1,0,0]),n.indexToWorld([r[0]-1,r[1]-1,0]),n.indexToWorld([0,r[1]-1,0])].map(e=>i.utilities.worldToImageCoords(u,e)),[h,f]=[t,o].map(e=>i.utilities.worldToImageCoords(u,e));a=[[s,l],[l,d],[p,d],[s,p]].map(([e,t])=>this.intersectInfiniteLines(e,t,h,f)).filter(e=>e&&this.isInBound(e,r)).map(t=>{const n=i.utilities.imageToWorldCoords(u,t);return e.worldToCanvas(n)})}catch(e){console.log(e)}return a}intersectInfiniteLines(e,t,n,r){const[i,o]=e,[a,s]=t,[l,c]=n,[d,p]=r,h=s-o,f=i-a,m=a*o-i*s,g=p-c,v=l-d,y=d*c-l*p;if(Math.abs(h*v-g*f)<u)return;return[(f*y-v*m)/(h*v-g*f),(g*m-h*y)/(h*v-g*f)]}isParallel(e,t){return Math.abs(r.R3.dot(e,t))>1-u}isInBound(e,t){return e[0]>=0&&e[0]<=t[0]&&e[1]>=0&&e[1]<=t[1]}}d.toolName="ReferenceLines"},94021:(e,t,n)=>{"use strict";var r=n(92622),i=n(72076),o=n(62709),a=n(86614),s=n(86785),l=n(27078);const c=[];class u extends r.Z{constructor(e={},t={configuration:{viewportId:"",scaleLocation:"bottom"}}){super(e,t),this.editData={},this._init=()=>{const e=(0,o.getRenderingEngines)()[0];if(!e)return;const t=(0,l.getToolGroup)(this.toolGroupId).viewportsInfo;if(!t)return;const n=t.map(e=>(0,o.getEnabledElementByIds)(e.viewportId,e.renderingEngineId));let{viewport:r}=n[0];const{FrameOfReferenceUID:i}=n[0];if(this.configuration.viewportId&&n.forEach(e=>{e.viewport.id==this.configuration.viewportId&&(r=e.viewport)}),!r)return;const{viewUp:s,viewPlaneNormal:u}=r.getCamera(),d=o.utilities.getViewportImageCornersInWorld(r);let p=this.editData.annotation;const h=(0,a.getAnnotations)(this.getToolName(),r.element);if(h.length&&(p=h.filter(e=>e.data.viewportId==r.id)[0]),c.includes(r.id))this.editData.annotation&&this.editData.annotation.data.viewportId==r.id&&(this.editData.annotation.data.handles.points=d,this.editData.annotation.data.viewportId=r.id);else{const e={metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...s],FrameOfReferenceUID:i,referencedImageId:null},data:{handles:{points:d},viewportId:r.id}};c.push(r.id),(0,a.addAnnotation)(e,r.element),p=e}this.editData={viewport:r,renderingEngine:e,annotation:p}},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=e=>{this.configuration.viewportId=e.detail.viewportId,this._init()},this.computeScaleSize=(e,t,n)=>{const r=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];let i;return i="top"==n||"bottom"==n?r.filter(t=>t<.6*e&&t>.2*e):r.filter(e=>e<.6*t&&e>.2*t),i[0]},this.computeEndScaleTicks=(e,t)=>{const n={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]};return{endTick1:[[e[1][0]+n[t][0][0],e[1][1]+n[t][0][0]],[e[1][0]+n[t][1][0],e[1][1]+n[t][1][1]]],endTick2:[[e[0][0]+n[t][0][0],e[0][1]+n[t][0][0]],[e[0][0]+n[t][1][0],e[0][1]+n[t][1][1]]]}},this.computeInnerScaleTicks=(e,t,n,r,i)=>{let o;"bottom"==t||"top"==t?o=i[0][0]-r[0][0]:"left"!=t&&"right"!=t||(o=i[0][1]-r[0][1]);const a=[],s=[],l=[];let c=e;e>=50&&(c=e/10);const u=o/c;for(let e=0;e<c-1;e++){const i={bottom:[[u*(e+1),0],[u*(e+1),5]],top:[[u*(e+1),0],[u*(e+1),-5]],left:[[0,u*(e+1)],[-5,u*(e+1)]],right:[[0,u*(e+1)],[5,u*(e+1)]]};a.push(`${n}-tick${e}`),s.push(`tick${e}`),(e+1)%5==0?l.push([[r[0][0]+i[t][0][0],r[0][1]+i[t][0][1]],[r[1][0]+i[t][0][0],r[1][1]+i[t][0][1]]]):l.push([[r[0][0]+i[t][0][0],r[0][1]+i[t][0][1]],[r[1][0]+i[t][1][0],r[1][1]+i[t][1][1]]])}return{tickIds:a,tickUIDs:s,tickCoordinates:l}},this.computeWorldScaleCoordinates=(e,t,n)=>{let r,o=i.R3.subtract(i.R3.create(),n[0],n[1]);o=i.R3.normalize(i.R3.create(),o);let a=i.R3.subtract(i.R3.create(),n[2],n[0]);a=i.R3.normalize(i.R3.create(),a);const s={bottom:[n[1],n[2]],top:[n[0],n[3]],right:[n[2],n[3]],left:[n[0],n[1]]},l=i.R3.add(i.R3.create(),s[t][0],s[t][0]).map(e=>e/2),c=e/2/Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)+Math.pow(o[2],2));return"top"==t||"bottom"==t?r=[i.R3.subtract(i.R3.create(),l,a.map(e=>e*c)),i.R3.add(i.R3.create(),l,a.map(e=>e*c))]:"left"!=t&&"right"!=t||(r=[i.R3.add(i.R3.create(),l,o.map(e=>e*c)),i.R3.subtract(i.R3.create(),l,o.map(e=>e*c))]),r},this.computeCanvasScaleCoordinates=(e,t,n,r,i)=>{let o;if("top"==i||"bottom"==i){const r=t[0][0]-t[1][0];o=[[e.width/2-r/2,n.height],[e.width/2+r/2,n.height]]}else if("left"==i||"right"==i){const n=t[0][1]-t[1][1];o=[[r.width,e.height/2-n/2],[r.width,e.height/2+n/2]]}return o},this.computeScaleBounds=(e,t,n,r)=>{const i=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),a={bottom:[-o,-i],top:[o,i],left:[o,i],right:[-o,-i]},s={bottom:[e.height,e.width],top:[0,e.width],left:[e.height,0],right:[e.height,e.width]};return{height:s[r][0]+a[r][0],width:s[r][1]+a[r][1]}}}renderAnnotation(e,t){if(!this.editData.viewport)return;const n=this.configuration.scaleLocation,{viewport:r}=e,o=(0,a.getAnnotations)(this.getToolName(),r.element).filter(e=>e.data.viewportId==r.id)[0],l=e.viewport.canvas,c=!1;if(!r)return c;const u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},d={width:l.width/window.devicePixelRatio||1,height:l.height/window.devicePixelRatio||1},p=o.data.handles.points[0],h=o.data.handles.points[1],f=o.data.handles.points[2],m=o.data.handles.points[3],g=[p,f,h,m],v=i.R3.distance(f,m),y=i.R3.distance(p,f),b=this.computeScaleBounds(d,.05,.05,n),C=this.computeScaleBounds(d,.05,.05,n),w=this.computeScaleSize(v,y,n),E=this.computeWorldScaleCoordinates(w,n,g).map(e=>r.worldToCanvas(e)),T=this.computeCanvasScaleCoordinates(d,E,C,b,n),x=this.computeEndScaleTicks(T,n),{annotationUID:_}=o;u.annotationUID=_;const S=this.getStyle("lineWidth",u,o),I=this.getStyle("lineDash",u,o),D=this.getStyle("color",u,o),A=this.getStyle("shadow",u,o),P=`${_}-scaleline`;(0,s.drawLine)(t,_,"1",T[0],T[1],{color:D,width:S,lineDash:I,shadow:A},P);const O=`${_}-left`;(0,s.drawLine)(t,_,"2",x.endTick1[0],x.endTick1[1],{color:D,width:S,lineDash:I,shadow:A},O);const R=`${_}-right`;(0,s.drawLine)(t,_,"3",x.endTick2[0],x.endTick2[1],{color:D,width:S,lineDash:I,shadow:A},R);const M={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},N=[T[0][0]+M[n][0],T[0][1]+M[n][1]],L=this._getTextLines(w),{tickIds:k,tickUIDs:F,tickCoordinates:V}=this.computeInnerScaleTicks(w,n,_,x.endTick1,x.endTick2);for(let e=0;e<F.length;e++)(0,s.drawLine)(t,_,F[e],V[e][0],V[e][1],{color:D,width:S,lineDash:I,shadow:A},k[e]);return(0,s.drawTextBox)(t,_,"text0",L,[N[0],N[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:D}),c}_getTextLines(e){let t,n;e>=50?(t=e/10,n=" cm"):(t=e,n=" mm");return[t.toString().concat(n)]}}u.toolName="ScaleOverlay"},36975:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(50097),a=n(60489),s=n(68096),l=n(33232),c=n(66878),u=n(23118),d=n(58429),p=n(36705);const h=(e,t,n)=>{if(!t?.data?.contour?.polyline?.length)return;const{polyline:r}=t.data.contour,{length:i}=r;let o=1/0;for(let t=0;t<i;t++){const i=e.worldToCanvas(r[t]),s=a.point.distanceToPoint(i,n);o=Math.min(o,s)}return o===1/0||isNaN(o)?void 0:o};var f=n(86785);class m{constructor(){this.toolInfo={toolSize:null,maxToolSize:null}}static{this.shapeName="Circle"}renderShape(e,t,n){(0,f.drawCircle)(e,"SculptorTool","0",t,this.toolInfo.toolSize,n)}pushHandles(e,t){const{points:n,mouseCanvasPoint:r}=t,i={first:void 0,last:void 0};for(let o=0;o<n.length;o++){const s=e.worldToCanvas(n[o]),l=a.point.distanceToPoint(s,r);l>this.toolInfo.toolSize||(this.pushOneHandle(o,l,t),void 0===i.first?(i.first=o,i.last=o):i.last=o)}return i}configureToolSize(e){const t=this.toolInfo;if(t.toolSize&&t.maxToolSize)return;const n=e.detail.element,r=Math.min(n.clientWidth,n.clientHeight)/12;t.toolSize=r,t.maxToolSize=r}updateToolSize(e,t,n){const r=this.toolInfo,i=h(t,n,e);i>0&&(r.toolSize=Math.min(r.maxToolSize,i))}getMaxSpacing(e){return Math.max(this.toolInfo.toolSize/4,e)}getInsertPosition(e,t,n){let i;const{points:o,element:s,mouseCanvasPoint:l}=n,c=this.toolInfo.toolSize,u=(0,r.getEnabledElement)(s),{viewport:d}=u,p=d.worldToCanvas(o[e]),h=d.worldToCanvas(o[t]),f=[(p[0]+h[0])/2,(p[1]+h[1])/2],m=a.point.distanceToPoint(l,f);if(m<c){const e={x:(f[0]-l[0])/m,y:(f[1]-l[1])/m};i=[l[0]+c*e.x,l[1]+c*e.y]}else i=f;return d.canvasToWorld(i)}pushOneHandle(e,t,n){const{points:r,mousePoint:i}=n,o=this.toolInfo.toolSize,a=r[e],s=(a[0]-i[0])/t,l=(a[1]-i[1])/t,c=(a[2]-i[2])/t,u={x:i[0]+o*s,y:i[1]+o*l,z:i[2]+o*c};a[0]=u.x,a[1]=u.y,a[2]=u.z}}const g=m;class v extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{minSpacing:1,referencedToolNames:["PlanarFreehandROI","PlanarFreehandContourSegmentationTool"],toolShape:"circle",referencedToolName:"PlanarFreehandROI"}}){super(e,t),this.registeredShapes=new Map,this.isActive=!1,this.commonData={activeAnnotationUID:null,viewportIdsToRender:[],isEditingOpenContour:!1,canvasLocation:void 0},this.preMouseDownCallback=e=>{const t=e.detail,n=t.element;if(this.configureToolSize(e),this.selectFreehandTool(t),null!==this.commonData.activeAnnotationUID)return this.isActive=!0,(0,u.hideElementCursor)(n),this.activateModify(n),!0},this.mouseMoveCallback=e=>{this.mode===s.ToolModes.Active?(this.configureToolSize(e),this.updateCursor(e)):this.commonData.canvasLocation=void 0},this.endCallback=e=>{const t=e.detail,{element:n}=t,i=this.configuration,o=(0,r.getEnabledElement)(n);this.isActive=!1,this.deactivateModify(n),(0,u.resetElementCursor)(n);const{renderingEngineId:a,viewportId:s}=o,c=l.fT.getToolGroupForViewport(s,a).getToolInstance(i.referencedToolName),d=this.filterSculptableAnnotationsForElement(n).find(e=>e.annotationUID===this.commonData.activeAnnotationUID);c.configuration.calculateStats&&(d.invalidated=!0),(0,p.hg)(d,n)},this.dragCallback=e=>{const t=e.detail,n=t.element;this.updateCursor(e);const r=this.filterSculptableAnnotationsForElement(n),i=r.find(e=>e.annotationUID===this.commonData.activeAnnotationUID);if(!r?.length||!this.isActive)return;const o=i.data.contour.polyline;this.sculpt(t,o)},this.registerShapes(g.shapeName,g),this.setToolShape(this.configuration.toolShape)}registerShapes(e,t){const n=new t;this.registeredShapes.set(e,n)}sculpt(e,t){const n=this.configuration,i=e.element,o=(0,r.getEnabledElement)(i),{viewport:a}=o,s=this.registeredShapes.get(this.selectedShape);this.sculptData={mousePoint:e.currentPoints.world,mouseCanvasPoint:e.currentPoints.canvas,points:t,maxSpacing:s.getMaxSpacing(n.minSpacing),element:i};const l=s.pushHandles(a,this.sculptData);void 0!==l.first&&this.insertNewHandles(l)}interpolatePointsWithinMaxSpacing(e,t,n,i){const{element:o}=this.sculptData,s=(0,r.getEnabledElement)(o),{viewport:l}=s,c=y(e+1,t.length),u=l.worldToCanvas(t[e]),d=l.worldToCanvas(t[c]);a.point.distanceToPoint(u,d)>i&&n.push(e)}updateCursor(e){const t=e.detail,n=t.element,i=(0,r.getEnabledElement)(n),{renderingEngine:o,viewport:a}=i;this.commonData.viewportIdsToRender=[a.id];const s=this.filterSculptableAnnotationsForElement(n);if(!s?.length)return;const l=s.find(e=>e.annotationUID===this.commonData.activeAnnotationUID);if(this.commonData.canvasLocation=t.currentPoints.canvas,this.isActive)l.highlighted=!0;else{const e=this.registeredShapes.get(this.selectedShape),n=t.currentPoints.canvas;e.updateToolSize(n,a,l)}(0,c.c)(o,this.commonData.viewportIdsToRender)}filterSculptableAnnotationsForElement(e){const t=this.configuration,n=(0,r.getEnabledElement)(e),{renderingEngineId:i,viewportId:a}=n,s=[],c=l.fT.getToolGroupForViewport(a,i).getToolInstance(t.referencedToolName);return t.referencedToolNames.forEach(t=>{const n=(0,o.fy)(t,e);n&&s.push(...n)}),c.filterInteractableAnnotationsForElement(e,s)}configureToolSize(e){this.registeredShapes.get(this.selectedShape).configureToolSize(e)}insertNewHandles(e){const t=this.findNewHandleIndices(e);let n=0;for(let e=0;e<t?.length;e++){const r=t[e]+1+n;this.insertHandleRadially(r),n++}}findNewHandleIndices(e){const{points:t,maxSpacing:n}=this.sculptData,r=[];for(let i=e.first;i<=e.last;i++)this.interpolatePointsWithinMaxSpacing(i,t,r,n);return r}insertHandleRadially(e){const{points:t}=this.sculptData;if(e>t.length-1&&this.commonData.isEditingOpenContour)return;const n=this.registeredShapes.get(this.selectedShape),r=e-1,i=y(e,t.length),o=n.getInsertPosition(r,i,this.sculptData);t.splice(e,0,o)}selectFreehandTool(e){const t=this.getClosestFreehandToolOnElement(e);void 0!==t&&(this.commonData.activeAnnotationUID=t)}getClosestFreehandToolOnElement(e){const{element:t}=e,n=(0,r.getEnabledElement)(t),{viewport:i}=n,o=this.configuration,a=this.filterSculptableAnnotationsForElement(t);if(!a?.length)return;const s=e.currentPoints.canvas,l={distance:1/0,toolIndex:void 0,annotationUID:void 0};for(let e=0;e<a?.length;e++){if(a[e].isLocked||!a[e].isVisible)continue;const t=h(i,a[e],s);-1!==t&&(t<l.distance&&(l.distance=t,l.toolIndex=e,l.annotationUID=a[e].annotationUID))}return this.commonData.isEditingOpenContour=!a[l.toolIndex].data.contour.closed,o.referencedToolName=a[l.toolIndex].metadata.toolName,l.annotationUID}activateModify(e){e.addEventListener(s.Events.MOUSE_UP,this.endCallback),e.addEventListener(s.Events.MOUSE_CLICK,this.endCallback),e.addEventListener(s.Events.MOUSE_DRAG,this.dragCallback),e.addEventListener(s.Events.TOUCH_TAP,this.endCallback),e.addEventListener(s.Events.TOUCH_END,this.endCallback),e.addEventListener(s.Events.TOUCH_DRAG,this.dragCallback)}deactivateModify(e){e.removeEventListener(s.Events.MOUSE_UP,this.endCallback),e.removeEventListener(s.Events.MOUSE_CLICK,this.endCallback),e.removeEventListener(s.Events.MOUSE_DRAG,this.dragCallback),e.removeEventListener(s.Events.TOUCH_TAP,this.endCallback),e.removeEventListener(s.Events.TOUCH_END,this.endCallback),e.removeEventListener(s.Events.TOUCH_DRAG,this.dragCallback)}setToolShape(e){this.selectedShape=this.registeredShapes.get(e)??g.shapeName}renderAnnotation(e,t){const{viewport:n}=e,{element:r}=n,i=this.commonData.viewportIdsToRender;if(!this.commonData.canvasLocation||this.mode!==s.ToolModes.Active||!i.includes(n.id))return;const o=this.filterSculptableAnnotationsForElement(r);if(!o?.length)return;const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};let l=(0,d.$)("color",a,s.AnnotationStyleStates.Default,this.mode);this.isActive&&(l=(0,d.$)("color",a,s.AnnotationStyleStates.Highlighted,this.mode));this.registeredShapes.get(this.selectedShape).renderShape(t,this.commonData.canvasLocation,{color:l})}}const y=(e,t)=>(e+t)%t;v.toolName="SculptorTool"},68049:(e,t,n)=>{"use strict";var r=n(62709),i=n(86614),o=n(86785),a=n(27078),s=n(66878),l=n(92622),c=(n(74474),n(5205)),u=n(79454);class d extends l.Z{constructor(e={},t={configuration:{opacity:.5}}){super(e,t),this._init=()=>{const e=(0,a.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e?.length)return void console.warn(this.getToolName()+"Tool: No viewports found");const t=(0,r.getRenderingEngine)(e[0].renderingEngineId)?.getViewport(e[0].viewportId);if(!t)return;const n=t.getFrameOfReferenceUID(),o=(0,i.getAnnotations)(this.getToolName(),n);if(!o?.length){const t=new Map;!function(e,t){t.forEach(({viewportId:t,renderingEngineId:n})=>{const i=(0,r.getRenderingEngine)(n)?.getViewport(t);p(e,i)})}(t,e);const o={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:n,referencedImageId:null},data:{actorsWorldPointsMap:t}};(0,i.addAnnotation)(o,n)}(0,s.Z)((0,r.getRenderingEngine)(e[0].renderingEngineId),e.map(({viewportId:e})=>e))},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=e=>{this._init()},this.renderAnnotation=(e,t)=>{const{viewport:n,FrameOfReferenceUID:r}=e;let a=!1;const s=(0,i.getAnnotations)(this.getToolName(),r);if(!s?.length)return a;const l=s[0],{annotationUID:c}=l,u=l.data.actorsWorldPointsMap;p(u,n);const d=n.getActors(),f=h(n);return d.forEach(e=>{if(!e?.clippingFilter)return;const r=u.get(e.uid);if(!r)return;if(!r.get(f))return;let i=1;const{worldPointsSet:a,color:s}=r.get(f);for(let r=0;r<a.length;r++){const l=a[r].map(e=>n.worldToCanvas(e)),u={color:s,fillColor:s,fillOpacity:this.configuration.opacity,closePath:!0,lineWidth:2},d=e.uid+"#"+i;(0,o.drawPath)(t,c,d,l,u),i++}}),a=!0,a}}}function p(e,t){const n=t.getActors(),r=h(t);n.forEach(t=>{if(!t?.clippingFilter)return;let n=e.get(t.uid);if(n||(n=new Map,e.set(t.uid,n)),!n.get(r)){const e=t.clippingFilter.getOutputData(),i=u.polyDataUtils.getPolyDataPoints(e);if(!i)return;const o=function(e){function t(e){let t=Math.floor(255*e).toString(16);return 1===t.length&&(t="0"+t),t}return"#"+t(e[0])+t(e[1])+t(e[2])}(t.actor.getProperty().getColor());n.set(r,{worldPointsSet:i,color:o})}})}function h(e){const{viewPlaneNormal:t}=e.getCamera(),n=e.getCurrentImageIdIndex();return`${e.id}-${(0,c.s)(t)}-${n}`}d.toolName="SegmentationIntersection"},61935:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(79454);class a extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}){super(e,t),this.deltaY=1}mouseDragCallback(e){this._dragCallback(e)}touchDragCallback(e){this._dragCallback(e)}_dragCallback(e){const{deltaPoints:t,viewportId:n,renderingEngineId:i}=e.detail,{viewport:a}=(0,r.getEnabledElementByIds)(n,i),s=this.getTargetId(a),{debounceIfNotLoaded:l,invert:c,loop:u}=this.configuration,d=t.canvas[1];let p;a instanceof r.VolumeViewport&&(p=s.split(/volumeId:|\?/)[1]);const h=this._getPixelPerImage(a),f=d+this.deltaY;if(h)if(Math.abs(f)>=h){const e=Math.round(f/h);(0,o.scroll)(a,{delta:c?-e:e,volumeId:p,debounceLoading:l,loop:u}),this.deltaY=f%h}else this.deltaY=f}_getPixelPerImage(e){const{element:t}=e,n=e.getNumberOfSlices();return Math.max(2,t.offsetHeight/Math.max(n,8))}}a.toolName="StackScroll"},13978:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(63478);class a extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1,scrollSlabs:!1}}){super(e,t)}mouseWheelCallback(e){const{wheel:t,element:n}=e.detail,{direction:i}=t,{invert:a}=this.configuration,{viewport:s}=(0,r.getEnabledElement)(n),l=i*(a?-1:1),c=this.getTargetId(s),u=r.utilities.getVolumeId(c);(0,o.Z)(s,{delta:l,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:u,scrollSlabs:this.configuration.scrollSlabs})}}a.toolName="StackScrollMouseWheel"},78791:(e,t,n)=>{"use strict";var r=n(32899),i=n(68096),o=n(62709),a=n(72076),s=n(93382),l=n(27078);class c extends s.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2}}){super(e,t),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,r=(0,o.getEnabledElement)(n),{viewport:i}=r,a=i.getDefaultActor().actor.getMapper(),s=a.getSampleDistance();return this._hasResolutionChanged||(a.setSampleDistance(2*s),this._hasResolutionChanged=!0,null!==this.cleanUp&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{a.setSampleDistance(s),i.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})),!0},this._getViewportsInfo=()=>(0,l.getToolGroup)(this.toolGroupId).viewportsInfo,this.onSetToolActive=()=>{const e=()=>{this._getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{if(!this._resizeObservers.has(e)){const{viewport:n}=(0,o.getEnabledElementByIds)(e,t)||{viewport:null};if(!n)return;const{element:r}=n,i=new ResizeObserver(()=>{const n=(0,o.getEnabledElementByIds)(e,t);if(!n)return;const{viewport:r}=n;r.resetCamera(),r.render()});i.observe(r),this._resizeObservers.set(e,i)}})};e(),this._viewportAddedListener=t=>{t.detail.toolGroupId===this.toolGroupId&&e()},o.eventTarget.addEventListener(i.Events.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener)},this.onSetToolDisabled=()=>{this._resizeObservers.forEach((e,t)=>{e.disconnect(),this._resizeObservers.delete(t)}),this._viewportAddedListener&&(o.eventTarget.removeEventListener(i.Events.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null)},this.rotateCamera=(e,t,n,r)=>{const i=e.getVtkActiveCamera(),o=i.getViewUp(),s=i.getFocalPoint(),l=i.getPosition(),c=[0,0,0],u=[0,0,0],d=[0,0,0],p=a._E.identity(new Float32Array(16));a._E.translate(p,p,t),a._E.rotate(p,p,r,n),a._E.translate(p,p,[-t[0],-t[1],-t[2]]),a.R3.transformMat4(c,l,p),a.R3.transformMat4(u,s,p),a._E.identity(p),a._E.rotate(p,p,r,n),a.R3.transformMat4(d,o,p),e.setCamera({position:c,viewUp:d,focalPoint:u})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:t,currentPoints:n,lastPoints:i}=e.detail,a=n.canvas,s=i.canvas,{rotateIncrementDegrees:l}=this.configuration,c=(0,o.getEnabledElement)(t),{viewport:u}=c,d=u.getCamera(),p=t.clientWidth,h=t.clientHeight,f=[a[0]/p,a[1]/h],m=[s[0]/p,s[1]/h],g=[.5*p,.5*h],v=u.canvasToWorld(g),y=(1+Math.abs(.5))**2,b=[m[0],0,0],C=[f[0],0,0],w=b[0]**2,E=C[0]**2,T=w>y?0:Math.sqrt(y-w),x=E>y?0:Math.sqrt(y-E),_=[b[0],0,T];r.ZP.normalize(_);const S=[C[0],0,x];r.ZP.normalize(S);const I=r.ZP.dot(_,S);if(Math.abs(I)>1e-4){const e=-2*Math.acos(r.ZP.clampValue(I,-1,1))*Math.sign(f[0]-m[0])*l,t=d.viewUp,n=d.viewPlaneNormal,i=[0,0,0],o=[0,0,0];r.ZP.cross(t,n,i),r.ZP.normalize(i),r.ZP.cross(n,i,o),r.ZP.normalize(o),r.ZP.normalize(t),this.rotateCamera(u,v,o,e);const a=(m[1]-f[1])*l;this.rotateCamera(u,v,i,a),u.render()}}}c.toolName="TrackballRotate"},95574:(e,t,n)=>{"use strict";var r=n(93382),i=n(62709),o=n(72076);const a=[0,0,1];class s extends r.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:a,rotateIncrementDegrees:30}}){super(e,t)}mouseWheelCallback(e){const{element:t,wheel:n}=e.detail,r=(0,i.getEnabledElement)(t),{viewport:a}=r,{direction:s,rotateIncrementDegrees:l}=this.configuration,c=a.getCamera(),{viewUp:u,position:d,focalPoint:p}=c,{direction:h}=n,[f,m,g]=p,[v,y,b]=s,C=h*(l*Math.PI)/180,w=[0,0,0],E=[0,0,0],T=[0,0,0],x=o._E.identity(new Float32Array(16));o._E.translate(x,x,[f,m,g]),o._E.rotate(x,x,C,[v,y,b]),o._E.translate(x,x,[-f,-m,-g]),o.R3.transformMat4(w,d,x),o.R3.transformMat4(E,p,x),o._E.identity(x),o._E.rotate(x,x,C,[v,y,b]),o.R3.transformMat4(T,u,x),a.setCamera({position:w,viewUp:T,focalPoint:E}),a.render()}}s.toolName="VolumeRotateMouseWheel"},6090:(e,t,n)=>{"use strict";var r=n(93382),i=n(62709),o=n(50097),a=n(36705),s=n(86785),l=n(33232),c=n(68096),u=n(46966),d=n(23118),p=n(66878),h=n(35066),f=n(79454);class m extends r.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,a=n.world,s=(0,i.getEnabledElement)(r),{viewport:l,renderingEngine:c}=s;this.isDrawing=!0;const h=l.getCamera(),{viewPlaneNormal:f,viewUp:m}=h,g=this.getReferencedImageId(l,a,f,m),v=l.getFrameOfReferenceUID(),y={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...m],FrameOfReferenceUID:v,referencedImageId:g},data:{handles:{points:[[...a],[...a],[...a],[...a]]},cachedStats:{}}};(0,o.ud)(y,r);const b=(0,u.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:y,viewportIdsToRender:b},this._activateDraw(r),(0,d.hideElementCursor)(r),e.preventDefault(),(0,p.Z)(c,b),y},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:s}=this.editData;this._deactivateDraw(n),(0,d.resetElementCursor)(n);const{renderingEngine:l}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,(0,o._x)(r.annotationUID),(0,p.Z)(l,s),(0,a.F$)(r),this.applyWindowLevelRegion(r,n)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o}=this.editData,{data:a}=r,{currentPoints:s}=t,l=(0,i.getEnabledElement)(n),{worldToCanvas:c,canvasToWorld:u}=l.viewport,d=s.world,{points:h}=a.handles;h[3]=[...d];const f=c(h[0]),m=c(h[3]),g=[m[0],f[1]],v=[f[0],m[1]],y=u(g),b=u(v);h[1]=y,h[2]=b,r.invalidated=!0;const{renderingEngine:C}=l;(0,p.Z)(C,o)},this._activateDraw=e=>{l.SB.isInteractingWithTool=!0,e.addEventListener(c.Events.MOUSE_UP,this._endCallback),e.addEventListener(c.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(c.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(c.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(c.Events.TOUCH_END,this._endCallback),e.addEventListener(c.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(c.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{l.SB.isInteractingWithTool=!1,e.removeEventListener(c.Events.MOUSE_UP,this._endCallback),e.removeEventListener(c.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(c.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(c.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(c.Events.TOUCH_END,this._endCallback),e.removeEventListener(c.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(c.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let a=(0,o.fy)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const i=a[e],{annotationUID:o,data:c}=i,{points:u}=c.handles,d=u.map(e=>r.worldToCanvas(e));l.annotationUID=o;const{color:p,lineWidth:h,lineDash:f}=this.getAnnotationStyle({annotation:i,styleSpecifier:l});if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const m=`${o}-rect`,g="0";(0,s.drawRect)(t,o,g,d[0],d[3],{color:p,lineDash:f,lineWidth:h},m),n=!0}return n},this.applyWindowLevelRegion=(e,t)=>{const n=(0,i.getEnabledElement)(t),{viewport:r}=n,o=h.windowLevel.extractWindowLevelRegionToolData(r),{data:a}=e,{points:s}=a.handles,l=s.map(e=>r.worldToCanvas(e)),c=l[0],u=l[3];let d=Math.min(c[0],u[0]),p=Math.min(c[1],u[1]),m=Math.abs(c[0]-u[0]),g=Math.abs(c[1]-u[1]);d=(0,f.clip)(d,0,o.width),p=(0,f.clip)(p,0,o.height),m=Math.floor(Math.min(m,Math.abs(o.width-d))),g=Math.floor(Math.min(g,Math.abs(o.height-p)));const v=h.windowLevel.getLuminanceFromRegion(o,Math.round(d),Math.round(p),m,g),y=h.windowLevel.calculateMinMaxMean(v,o.minPixelValue,o.maxPixelValue);void 0===this.configuration.minWindowWidth&&(this.configuration.minWindowWidth=10);const b=Math.max(Math.abs(y.max-y.min),this.configuration.minWindowWidth),C=y.mean,w=i.utilities.windowLevel.toLowHighRange(b,C);r.setProperties({voiRange:w}),r.render()},this.cancel=()=>null,this.isPointNearTool=()=>null,this.toolSelectedCallback=()=>null,this.handleSelectedCallback=()=>null,this._activateModify=()=>null,this._deactivateModify=()=>null}}m.toolName="WindowLevelRegion"},32e3:(e,t,n)=>{"use strict";var r=n(93382),i=n(62709);class o extends r.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this._getImageDynamicRangeFromMiddleSlice=(e,t)=>{const n=Math.floor(t[2]/2),r=t[0]*t[1];let i,o;e instanceof Float32Array?(i=4,o=Float32Array):e instanceof Uint8Array?(i=1,o=Uint8Array):e instanceof Uint16Array?(i=2,o=Uint16Array):e instanceof Int16Array&&(i=2,o=Int16Array);const a=new o(e.buffer,n*r*i,r),{max:s,min:l}=this._getMinMax(a,r);return s-l}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){const{element:t,deltaPoints:n}=e.detail,r=(0,i.getEnabledElement)(t),{renderingEngine:o,viewport:a}=r;let s,l,c,u,d,p,h=!1;const f=a.getProperties();if(a instanceof i.VolumeViewport){const e=this.getTargetId(a);s=i.utilities.getVolumeId(e),p=i.utilities.getViewportsWithVolumeId(s,o.id),({lower:l,upper:c}=f.voiRange);const t=i.cache.getVolume(s);if(!t)throw new Error("Volume not found "+s);u=t.metadata.Modality,h=t.scaling&&Object.keys(t.scaling).length>0}else{if(!f.voiRange)throw new Error("Viewport is not a valid type");{u=a.modality,({lower:l,upper:c}=f.voiRange);const{preScale:e={scaled:!1}}=a.getImageData?.()||{};h=e.scaled&&void 0!==e.scalingParameters?.suvbw}}d="PT"===u&&h?this.getPTScaledNewRange({deltaPointsCanvas:n.canvas,lower:l,upper:c,clientHeight:t.clientHeight,isPreScaled:h,viewport:a,volumeId:s}):this.getNewRange({viewport:a,deltaPointsCanvas:n.canvas,volumeId:s,lower:l,upper:c}),d.lower>=d.upper||(a.setProperties({voiRange:d}),a.render(),a instanceof i.VolumeViewport&&p.forEach(e=>{a!==e&&e.render()}))}getPTScaledNewRange({deltaPointsCanvas:e,lower:t,upper:n,clientHeight:r,viewport:i,volumeId:o,isPreScaled:a}){let s=4;s=a?5/r:this._getMultiplierFromDynamicRange(i,o)||4;return n-=e[1]*s,{lower:t,upper:n=a?Math.max(n,.1):n}}getNewRange({viewport:e,deltaPointsCanvas:t,volumeId:n,lower:r,upper:o}){const a=this._getMultiplierFromDynamicRange(e,n)||4,s=t[0]*a,l=t[1]*a;let{windowWidth:c,windowCenter:u}=i.utilities.windowLevel.toWindowLevel(r,o);return c+=s,u+=l,c=Math.max(c,1),i.utilities.windowLevel.toLowHighRange(c,u)}_getMultiplierFromDynamicRange(e,t){let n;if(t){const e=i.cache.getVolume(t),{dimensions:r}=e,o=e.getScalarData(),a=this._getImageDynamicRangeFromMiddleSlice(o,r),s=e?.metadata?.BitsStored,l=s?2**s:1/0;n=Math.min(a,l)}else n=this._getImageDynamicRangeFromViewport(e);const r=n/1024;return r>1?Math.round(r):r}_getImageDynamicRangeFromViewport(e){const{imageData:t}=e.getImageData(),n=t.getDimensions();if(t.getRange){const e=t.getRange();return e[1]-e[0]}let r,i;if(r=t.getScalarData?t.getScalarData():t.getPointData().getScalars().getData(),1!==n[2])return this._getImageDynamicRangeFromMiddleSlice(r,n);if(r.getRange)i=r.getRange();else{const{min:e,max:t}=this._getMinMax(r,r.length);i=[e,t]}return i[1]-i[0]}_getMinMax(e,t){let n=1/0,r=-1/0;for(let i=0;i<t;i++){const t=e[i];t<n&&(n=t),t>r&&(r=t)}return{max:r,min:n}}}o.toolName="WindowLevel"},61495:(e,t,n)=>{"use strict";var r=n(72076),i=n(32899),o=n(62709),a=n(93382);class s extends a.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.1,maxZoomScale:30,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,t),this.preMouseDownCallback=e=>{const t=e.detail,{element:n,currentPoints:i}=t,a=i.world,s=(0,o.getEnabledElement)(n).viewport.getCamera(),{focalPoint:l}=s;this.initialMousePosWorld=a;let c=r.R3.fromValues(l[0]-a[0],l[1]-a[1],l[2]-a[2]);return c=r.R3.normalize(r.R3.create(),c),this.dirVec=c,!1},this.preTouchStartCallback=e=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(e)},this._dragParallelProjection=(e,t,n,i=!1)=>{const{element:o,deltaPoints:a}=e.detail,s=i?e.detail.deltaDistance.canvas:a.canvas[1],l=[o.clientWidth,o.clientHeight],{parallelScale:c,focalPoint:u,position:d}=n,p=s*(5/l[1])*(this.configuration.invert?-1:1),h=(1-p)*c;let f=u,m=d;if(!this.configuration.zoomToCenter){const e=r.R3.distance(u,this.initialMousePosWorld);m=r.R3.scaleAndAdd(r.R3.create(),d,this.dirVec,-e*p),f=r.R3.scaleAndAdd(r.R3.create(),u,this.dirVec,-e*p)}const g=t.getImageData();let v=[1,1,1];g&&(v=g.spacing);const{minZoomScale:y,maxZoomScale:b}=this.configuration,C=o.clientHeight*v[1]*.5,w=C/h;let E=h,T=!1;g&&(w<y?(E=C/y,T=!0):w>=b&&(E=C/b,T=!0)),t.setCamera({parallelScale:E,focalPoint:T?u:f,position:T?d:m})},this._dragPerspectiveProjection=(e,t,n,r=!1)=>{const{element:o,deltaPoints:a}=e.detail,s=r?e.detail.deltaDistance.canvas:a.canvas[1],l=[o.clientWidth,o.clientHeight],{position:c,focalPoint:u,viewPlaneNormal:d}=n,p=i.ZP.distance2BetweenPoints(c,u),h=Math.sqrt(p)/l[1],f=[-d[0],-d[1],-d[2]],m=this.configuration.invert?s/h:s*h;let g=m*f[0];c[0]+=g,u[0]+=g,g=m*f[1],c[1]+=g,u[1]+=g,g=m*f[2],c[2]+=g,u[2]+=g,t.setCamera({position:c,focalPoint:u})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:t,currentPoints:n}=e.detail,i=(0,o.getEnabledElement)(t),{viewport:a}=i,s=a.getCamera(),l=n.world,{focalPoint:c}=s;this.initialMousePosWorld=l;let u=r.R3.fromValues(c[0]-l[0],c[1]-l[1],c[2]-l[2]);u=r.R3.normalize(r.R3.create(),u),this.dirVec=u,s.parallelProjection?this._dragParallelProjection(e,a,s,!0):this._dragPerspectiveProjection(e,a,s,!0),a.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:t}=e.detail,n=(0,o.getEnabledElement)(t),{viewport:r}=n,i=r.getCamera();i.parallelProjection?this._dragParallelProjection(e,r,i):this._dragPerspectiveProjection(e,r,i),r.render()}_panCallback(e){const{element:t,deltaPoints:n}=e.detail,r=(0,o.getEnabledElement)(t),i=n.world,a=r.viewport.getCamera(),{focalPoint:s,position:l}=a,c=[l[0]-i[0],l[1]-i[1],l[2]-i[2]],u=[s[0]-i[0],s[1]-i[1],s[2]-i[2]];r.viewport.setCamera({focalPoint:u,position:c}),r.viewport.render()}}s.toolName="Zoom"},37442:(e,t,n)=>{"use strict";var r=n(68096),i=n(62709),o=n(93382),a=n(90685),s=n(86614),l=n(11163),c=n(79922),u=n(21221),d=n(79454),p=n(86785),h=n(33232),f=n(46966),m=n(66878),g=n(36705),v=n(23118);class y extends o.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:b}}){super(e,t),this.addNewAnnotation=e=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:l,renderingEngine:c}=a;(0,v.hideElementCursor)(r),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:p}=u,h=this.getReferencedImageId(l,o,d,p),g=l.getFrameOfReferenceUID(),y={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...p],FrameOfReferenceUID:g,referencedImageId:h,...l.getViewReference({points:[o]})},data:{handles:{points:[[...o],[...o]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,s.addAnnotation)(y,r);const b=(0,f.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:y,viewportIdsToRender:b,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),e.preventDefault(),(0,m.Z)(c,b),y},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,[l,u,d]=s.handles.points,p=a.worldToCanvas(l),h=a.worldToCanvas(u),f={start:{x:p[0],y:p[1]},end:{x:h[0],y:h[1]}};if(c.distanceToPoint([f.start.x,f.start.y],[f.end.x,f.end.y],[n[0],n[1]])<=r)return!0;if(!d)return!1;const m=a.worldToCanvas(d),g={start:{x:h[0],y:h[1]},end:{x:m[0],y:m[1]}};return c.distanceToPoint([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]])<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,f.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(r),(0,v.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,m.Z)(s,o),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:a,hasMoved:l}=this.editData,{data:c}=r;if(a&&!l)return;if(this.angleStartedNotYetCompleted&&2===c.handles.points.length)return void(this.editData.handleIndex=2);this.angleStartedNotYetCompleted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,v.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(r.annotationUID),(0,m.Z)(d,o),a&&(0,g.F$)(r),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,m.Z)(u,o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,v.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const a=(0,i.getEnabledElement)(e),{renderingEngine:s}=a;return(0,m.Z)(s,n),r&&(0,g.F$)(t),this.editData=null,this.angleStartedNotYetCompleted=!1,t.annotationUID}},this._activateModify=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(r.Events.MOUSE_UP,this._endCallback),e.addEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(r.Events.TOUCH_TAP,this._endCallback),e.addEventListener(r.Events.TOUCH_END,this._endCallback),e.addEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(r.Events.MOUSE_UP,this._endCallback),e.removeEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(r.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(r.Events.TOUCH_END,this._endCallback),e.removeEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this._activateDraw=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(r.Events.MOUSE_UP,this._endCallback),e.addEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(r.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(r.Events.TOUCH_TAP,this._endCallback),e.addEventListener(r.Events.TOUCH_END,this._endCallback),e.addEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(r.Events.MOUSE_UP,this._endCallback),e.removeEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(r.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(r.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(r.Events.TOUCH_END,this._endCallback),e.removeEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let o=(0,s.getAnnotations)(this.getToolName(),i);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(i,o),!o?.length)return n;const a=this.getTargetId(r),c=r.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<o.length;i++){const s=o[i],{annotationUID:d,data:h}=s,{points:f,activeHandleIndex:m}=h.handles;u.annotationUID=d;const{color:g,lineWidth:v,lineDash:y}=this.getAnnotationStyle({annotation:s,styleSpecifier:u}),b=f.map(e=>r.worldToCanvas(e));let C;if(h.cachedStats[a]&&null!=h.cachedStats[a].angle?s.invalidated&&this._throttledCalculateCachedStats(s,c,e):(h.cachedStats[a]={angle:null},this._calculateCachedStats(s,c,e)),(0,l.isAnnotationLocked)(s)||this.editData||null===m||(C=[b[m]]),!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(C){const e="0";(0,p.drawHandles)(t,d,e,b,{color:g,lineDash:y,lineWidth:v})}let w="1";if((0,p.drawLine)(t,d,w,b[0],b[1],{color:g,width:v,lineDash:y}),n=!0,3!==b.length)return n;if(w="2",(0,p.drawLine)(t,d,w,b[1],b[2],{color:g,width:v,lineDash:y}),!h.cachedStats[a]?.angle)continue;const E=this.getLinkedTextBoxStyle(u,s);if(!E.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const T=this.configuration.getTextLines(h,a);if(!h.handles.textBox.hasMoved){const e=b[1];h.handles.textBox.worldPosition=r.canvasToWorld(e)}const x=r.worldToCanvas(h.handles.textBox.worldPosition),_="1",S=(0,p.drawLinkedTextBox)(t,d,_,T,x,b,{},E),{x:I,y:D,width:A,height:P}=S;h.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([I,D]),topRight:r.canvasToWorld([I+A,D]),bottomLeft:r.canvasToWorld([I,D+P]),bottomRight:r.canvasToWorld([I+A,D+P])}}return n},this._throttledCalculateCachedStats=(0,a.Z)(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,t,n){const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,f.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,v.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,m.Z)(d,c),e.preventDefault()}_calculateCachedStats(e,t,n){const r=e.data,{element:o}=n.viewport;if(3!==r.handles.points.length)return;const a=r.handles.points[0],s=r.handles.points[1],l=r.handles.points[2],{cachedStats:c}=r,d=Object.keys(c);for(let e=0;e<d.length;e++){const n=d[e],r=(0,u.Z)([a,s],[s,l]),{dimensions:o,imageData:p}=this.getTargetIdImage(n,t);this.isHandleOutsideImage=[a,s,l].map(e=>i.utilities.transformWorldToIndex(p,e)).some(e=>!i.utilities.indexWithinDimensions(e,o)),c[n]={angle:isNaN(r)?"Incomplete Angle":r}}return e.invalidated=!1,(0,g.hg)(e,o),c}}function b(e,t){const n=e.cachedStats[t],{angle:r}=n;if(void 0===r)return;if(isNaN(r))return[`${r}`];return[`${(0,d.roundNumber)(r)} ${String.fromCharCode(176)}`]}y.toolName="Angle"},45248:(e,t,n)=>{"use strict";var r,i=n(68096),o=n(62709),a=n(93382),s=n(86614),l=n(11163),c=n(79922),u=n(86785),d=n(33232),p=n(46966),h=n(66878),f=n(36705),m=n(23118);!function(e){e.POINTS="points",e.MOVABLE_POINTS="movable",e.DENTASCAN="dentascan"}(r||(r={}));class g extends a.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:v,changeTextCallback:y,preventHandleOutsideImage:!1,arrowFirst:!1}}){super(e,t),this.removeArrowAnnotation=e=>{(0,s.removeAnnotation)(e)},this.addNewAnnotationWithMode=(e,t,n,i)=>{const a=(0,o.getEnabledElement)(e),{viewport:l,renderingEngine:c}=a;(0,m.hideElementCursor)(e),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:g}=u,v=this.getReferencedImageId(l,t[0],d,g),y=l.getFrameOfReferenceUID();let b={creation:!0,highlighted:!0,invalidated:!0,isLocked:n!==r.MOVABLE_POINTS,isVisible:n!==r.MOVABLE_POINTS,metadata:{dentascan:n===r.DENTASCAN,handmade:n===r.MOVABLE_POINTS,color:i,toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...g],FrameOfReferenceUID:y,referencedImageId:v},data:{text:"",handles:{points:t,activeHandleIndex:null,arrowFirst:!1,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""},annotationUID:""};(0,s.addAnnotation)(b,e);const C=(0,p.getViewportIdsWithToolToRender)(e,this.getToolName());return this.editData={annotation:b,viewportIdsToRender:C,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(e),(0,h.Z)(c,C),b.data.handles.activeHandleIndex=null,this._deactivateModify(e),this._deactivateDraw(e),(0,m.resetElementCursor)(e),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(b.annotationUID),b.data.text="",(0,f.F$)(b),(0,h.Z)(c,C),this.editData=null,this.isDrawing=!1,b},this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,i=n.world,a=(0,o.getEnabledElement)(r),{viewport:l,renderingEngine:c}=a;(0,m.hideElementCursor)(r),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:f}=u,g=this.getReferencedImageId(l,i,d,f),{arrowFirst:v}=this.configuration,y=l.getFrameOfReferenceUID();let b={creation:!0,highlighted:!0,invalidated:!0,metadata:{dentascan:!1,handmade:!0,color:"rgb(0, 255, 0)",toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...f],FrameOfReferenceUID:y,referencedImageId:g,...l.getViewReference({points:[i]})},data:{text:"",handles:{points:[[...i],[...i]],activeHandleIndex:null,arrowFirst:v,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};(0,s.addAnnotation)(b,r);const C=(0,p.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:b,viewportIdsToRender:C,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e.preventDefault(),this._activateDraw(r),(0,h.Z)(c,C),b},this.isPointNearTool=(e,t,n,r)=>{const i=(0,o.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,[l,u]=s.handles.points,d=a.worldToCanvas(l),p=a.worldToCanvas(u),h={start:{x:d[0],y:d[1]},end:{x:p[0],y:p[1]}};return c.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]])<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const i=(0,p.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},this._activateModify(r),(0,m.hideElementCursor)(r);const a=(0,o.getEnabledElement)(r),{renderingEngine:s}=a;(0,h.Z)(s,i),e.preventDefault()},this._manageClickCallback=e=>{const t=e.detail,{mouseButton:n}=t;this.editData.annotation.creation?this.editData.annotation.creation=!1:1===n?this._prolongateCallback(e):2===n&&this._endCallback(e)},this._endCallback=e=>{const t=e.detail,{element:n,currentPoints:r,mouseButton:i}=t,{annotation:a,viewportIdsToRender:l,newAnnotation:c,hasMoved:u}=this.editData,{data:d}=a;if(c&&!u)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,m.resetElementCursor)(n);const{viewport:p,renderingEngine:g}=(0,o.getEnabledElement)(n);this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(a.annotationUID),c?(a.data.text="",(0,f.F$)(a),(0,h.Z)(g,l)):(0,f.hg)(a,n),this.editData=null,this.isDrawing=!1},this._prolongateCallback=e=>{const t=e.detail,{currentPoints:n,element:r}=t,i=n.world,a=(0,o.getEnabledElement)(r),{viewport:s,renderingEngine:l}=a,{annotation:c,viewportIdsToRender:u,handleIndex:d,movingTextBox:p}=this.editData,{data:f}=c;f.handles.points[d]=[...i],f.handles.points.push([...i]),this.editData.handleIndex+=1,e.preventDefault(),(0,h.Z)(l,u)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,o.getEnabledElement)(n),{renderingEngine:u}=c;(0,h.Z)(u,i)},this.touchTapCallback=e=>{2==e.detail.taps&&this.doubleClickCallback(e)},this.doubleClickCallback=e=>{const t=e.detail,{element:n}=t;let r=(0,s.getAnnotations)(this.getToolName(),n);if(r=this.filterInteractableAnnotationsForElement(n,r),!r?.length)return;const i=r.find(e=>this.isPointNearTool(n,e,t.currentPoints.canvas,6));if(!i)return;const o=i;this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,n,o)),this.editData=null,this.isDrawing=!1,e.stopImmediatePropagation(),e.preventDefault()},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,m.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:i}=t;t.highlighted=!1,i.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,o.getEnabledElement)(e);return(0,h.Z)(a,n),r&&(0,f.F$)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{d.SB.isInteractingWithTool=!0,e.addEventListener(i.Events.MOUSE_UP,this._endCallback),e.addEventListener(i.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(i.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(i.Events.TOUCH_TAP,this._endCallback),e.addEventListener(i.Events.TOUCH_END,this._endCallback),e.addEventListener(i.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{d.SB.isInteractingWithTool=!1,e.removeEventListener(i.Events.MOUSE_UP,this._endCallback),e.removeEventListener(i.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(i.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(i.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(i.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(i.Events.TOUCH_END,this._endCallback)},this._activateDraw=e=>{d.SB.isInteractingWithTool=!0,e.addEventListener(i.Events.MOUSE_UP,this._manageClickCallback),e.addEventListener(i.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(i.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(i.Events.MOUSE_CLICK,this._manageClickCallback),e.addEventListener(i.Events.TOUCH_TAP,this._manageClickCallback),e.addEventListener(i.Events.TOUCH_END,this._manageClickCallback),e.addEventListener(i.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{d.SB.isInteractingWithTool=!1,e.removeEventListener(i.Events.MOUSE_UP,this._manageClickCallback),e.removeEventListener(i.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(i.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(i.Events.MOUSE_CLICK,this._manageClickCallback),e.removeEventListener(i.Events.TOUCH_TAP,this._manageClickCallback),e.removeEventListener(i.Events.TOUCH_END,this._manageClickCallback),e.removeEventListener(i.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let o=(0,s.getAnnotations)(this.getToolName(),i);if(!o?.length)return n;const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<o.length;e++){const i=o[e];if(!i.isVisible)continue;const{annotationUID:s,data:c}=i,{handles:d,text:p}=c,{points:h,activeHandleIndex:f}=d;a.annotationUID=s;const{lineWidth:m,lineDash:g}=this.getAnnotationStyle({annotation:i,styleSpecifier:a}),v=i.metadata.color?i.metadata.color:"rgb(255, 255, 255)",y=h.map(e=>r.worldToCanvas(e));let b;(0,l.isAnnotationLocked)(i)||this.editData||null===f||(b=[y[f]]);const C="0";i.metadata.handmade&&(0,u.drawHandles)(t,s,C,y,{color:v,lineWidth:m});let w=1;for(let e=0;e<y.length-1;e++)(0,u.drawLine)(t,s,`${w}`,y[e],y[e+1],{color:v,width:m,lineDash:g}),w+=3;if(n=!0,!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!p)continue;const E=this.getLinkedTextBoxStyle(a,i);if(!E.visibility){c.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}if(!c.handles.textBox.hasMoved){const e=y[1];c.handles.textBox.worldPosition=r.canvasToWorld(e)}const T=r.worldToCanvas(c.handles.textBox.worldPosition),x="1",_=(0,u.drawLinkedTextBox)(t,s,x,[p],T,y,{},E),{x:S,y:I,width:D,height:A}=_;c.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([S,I]),topRight:r.canvasToWorld([S+D,I]),bottomLeft:r.canvasToWorld([S,I+A]),bottomRight:r.canvasToWorld([S+D,I+A])}}return n}}handleSelectedCallback(e,t,n){const r=e.detail,{element:i}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,p.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(i),(0,m.hideElementCursor)(i);const u=(0,o.getEnabledElement)(i),{renderingEngine:d}=u;(0,h.Z)(d,c),e.preventDefault()}_doneChangingTextCallback(e,t,n){t.data.text=n;const r=(0,o.getEnabledElement)(e),{renderingEngine:i}=r,a=(0,p.getViewportIdsWithToolToRender)(e,this.getToolName());(0,h.Z)(i,a),(0,f.hg)(t,e)}_isInsideVolume(e,t,n){return console.log("IS INSIDE VOLUME",e,t,n),o.utilities.indexWithinDimensions(e,n)&&o.utilities.indexWithinDimensions(t,n)}}function v(e){return e(prompt("Enter your annotation:"))}function y(e,t,n){return n(prompt("Enter your annotation:"))}g.toolName="ArrowAnnotate"},87248:(e,t,n)=>{"use strict";n.d(t,{Z:()=>D});var r=n(93382),i=n(62709),o=n(39661),a=n(79454),s=n(90685),l=n(86614),c=n(11163),u=n(41836),d=n(36705),p=n(86785),h=n(33232),f=n(68096),m=n(46966),g=n(20724),v=n(21259),y=n(23118),b=n(66878),C=n(15607),w=n(20752),E=n(57776),T=n(92600),x=n(51053);const{transformWorldToIndex:_}=i.utilities;class S extends r.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,centerPointRadius:0,getTextLines:I,statsCalculator:x.BasicStatsCalculator}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:s,renderingEngine:c}=a;this.isDrawing=!0;const u=s.getCamera(),{viewPlaneNormal:d,viewUp:p}=u,h=this.getReferencedImageId(s,o,d,p),f=s.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...p],FrameOfReferenceUID:f,referencedImageId:h,...s.getViewReference({points:[o]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...o],[...o]],activeHandleIndex:null},cachedStats:{}}};(0,l.addAnnotation)(g,r);const v=(0,m.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:v,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),(0,y.hideElementCursor)(r),e.preventDefault(),(0,b.Z)(c,v),g},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=l.map(e=>a.worldToCanvas(e)),u=(0,E.t)(c),d=(0,E.t)([c[0],n]);return Math.abs(d-u)<r/2},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,m.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},(0,y.hideElementCursor)(r),this._activateModify(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,b.Z)(s,o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex(e=>e===n)}const c=(0,m.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,y.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,b.Z)(d,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:a,hasMoved:s}=this.editData,{data:c}=r;if(a&&!s)return;r.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,y.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l.removeAnnotation)(r.annotationUID),(0,b.Z)(u,o),a&&(0,d.F$)(r)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.canvas,a=(0,i.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:u,viewportIdsToRender:d}=this.editData,{data:p}=u;p.handles.points=[p.handles.points[0],c(o)],u.invalidated=!0,this.editData.hasMoved=!0,(0,b.Z)(s,d)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else this._dragHandle(e),r.invalidated=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,b.Z)(u,o)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{canvasToWorld:o,worldToCanvas:a}=r.viewport,{annotation:s,handleIndex:l}=this.editData,{data:c}=s,{points:u}=c.handles,d=u.map(e=>a(e)),{currentPoints:p}=t,h=p.canvas;if(0===l){const e=h[0]-d[0][0],t=h[1]-d[0][1],n=h,r=[d[1][0]+e,d[1][1]+t];u[0]=o(n),u[1]=o(r)}else u[1]=o(h)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,y.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,i.getEnabledElement)(e);return(0,b.Z)(a,n),r&&(0,d.F$)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:o}=r;let a=(0,l.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(r),d=r.getRenderingEngine(),h={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let o=0;o<a.length;o++){const l=a[o],{annotationUID:f,data:m}=l,{handles:v}=m,{points:y,activeHandleIndex:b}=v;h.annotationUID=f;const{color:C,lineWidth:w,lineDash:T}=this.getAnnotationStyle({annotation:l,styleSpecifier:h}),x=y.map(e=>r.worldToCanvas(e)),_=x[0],S=(0,E.t)(x),I=(0,E.$)(x),{centerPointRadius:D}=this.configuration;if(m.cachedStats[s]&&null!=m.cachedStats[s].areaUnit){if(l.invalidated&&(this._throttledCalculateCachedStats(l,r,d,e),r instanceof i.VolumeViewport)){const{referencedImageId:e}=l.metadata;for(const t in m.cachedStats)if(t.startsWith("imageId")){d.getStackViewports().find(t=>{const n=i.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=i.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n})&&delete m.cachedStats[t]}}}else m.cachedStats[s]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},this._calculateCachedStats(l,r,d,e);if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let A;if(!(0,u.isAnnotationVisible)(f))continue;if((0,c.isAnnotationLocked)(l)||this.editData||null===b||(A=[x[b]]),A){const e="0";(0,p.drawHandles)(t,f,e,A,{color:C})}const P=`${f}-circle`,O="0";(0,p.drawCircle)(t,f,O,_,S,{color:C,lineDash:T,lineWidth:w},P),D>0&&S>3*D&&(0,p.drawCircle)(t,f,`${O}-center`,_,D,{color:C,lineDash:T,lineWidth:w}),n=!0;const R=this.getLinkedTextBoxStyle(h,l);if(!R.visibility){m.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const M=this.configuration.getTextLines(m,s);if(!M||0===M.length)continue;let N;m.handles.textBox.hasMoved||(N=(0,g.getTextBoxCoordsCanvas)(I),m.handles.textBox.worldPosition=r.canvasToWorld(N));const L=r.worldToCanvas(m.handles.textBox.worldPosition),k="1",F=(0,p.drawLinkedTextBox)(t,f,k,M,L,x,{},R),{x:V,y:U,width:B,height:G}=F;m.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([V,U]),topRight:r.canvasToWorld([V+B,U]),bottomLeft:r.canvasToWorld([V,U+G]),bottomRight:r.canvasToWorld([V+B,U+G])}}return n},this._calculateCachedStats=(e,t,n,r)=>{const i=e.data,{element:s}=t,{points:l}=i.handles,c=l.map(e=>t.worldToCanvas(e)),{viewPlaneNormal:u,viewUp:p}=t.getCamera(),[h,f]=(0,E.$)(c),m=t.canvasToWorld(h),g=t.canvasToWorld(f),{cachedStats:y}=i,b=Object.keys(y),x=m,S=g;for(let r=0;r<b.length;r++){const i=b[r],s=this.getTargetIdImage(i,n);if(!s)continue;const{dimensions:l,imageData:c,metadata:d,hasPixelSpacing:h}=s,f=_(c,x);f[0]=Math.floor(f[0]),f[1]=Math.floor(f[1]),f[2]=Math.floor(f[2]);const E=_(c,S);if(E[0]=Math.floor(E[0]),E[1]=Math.floor(E[1]),E[2]=Math.floor(E[2]),this._isInsideVolume(f,E,l)){const n=[[Math.min(f[0],E[0]),Math.max(f[0],E[0])],[Math.min(f[1],E[1]),Math.max(f[1],E[1])],[Math.min(f[2],E[2]),Math.max(f[2],E[2])]],r={center:[(m[0]+g[0])/2,(m[1]+g[1])/2,(m[2]+g[2])/2],xRadius:Math.abs(m[0]-g[0])/2,yRadius:Math.abs(m[1]-g[1])/2,zRadius:Math.abs(m[2]-g[2])/2},{worldWidth:l,worldHeight:h}=(0,v.Z)(u,p,x,S),b=0===l&&0===h,_=[f,E],{scale:I,units:D,areaUnits:A}=(0,a.getCalibratedLengthUnitsAndScale)(s,_),P=(0,o.G6)(s),O=Math.abs(Math.PI*(l/I/2)*(h/P/I/2)),R={isPreScaled:(0,w.P)(t,i),isSuvScaled:this.isSuvScaled(t,i,e.metadata.referencedImageId)},M=(0,C.F)(d.Modality,e.metadata.referencedImageId,R),N=(0,a.pointInShapeCallback)(c,e=>(0,T.pointInEllipse)(r,e,{fast:!0}),this.configuration.statsCalculator.statsCallback,n),L=this.configuration.statsCalculator.getStatistics();y[i]={Modality:d.Modality,area:O,mean:L.mean?.value,max:L.max?.value,stdDev:L.stdDev?.value,statsArray:L.array,pointsInShape:N,isEmptyArea:b,areaUnit:A,radius:l/2/I,radiusUnit:D,perimeter:2*Math.PI*(l/2)/I,modalityUnit:M}}else this.isHandleOutsideImage=!0,y[i]={Modality:d.Modality}}return e.invalidated=!1,(0,d.hg)(e,s),y},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,s.Z)(this._calculateCachedStats,100,{trailing:!0})}}function I(e,t){const n=e.cachedStats[t],{radius:r,radiusUnit:i,area:o,mean:s,stdDev:l,max:c,isEmptyArea:u,areaUnit:d,modalityUnit:p}=n,h=[];if(r){const e=u?"Radius: Oblique not supported":`Radius: ${(0,a.roundNumber)(r)} ${i}`;h.push(e)}if(o){const e=u?"Area: Oblique not supported":`Area: ${(0,a.roundNumber)(o)} ${d}`;h.push(e)}return s&&h.push(`Mean: ${(0,a.roundNumber)(s)} ${p}`),c&&h.push(`Max: ${(0,a.roundNumber)(c)} ${p}`),l&&h.push(`Std Dev: ${(0,a.roundNumber)(l)} ${p}`),h}S.toolName="CircleROI";const D=S},35061:(e,t,n)=>{"use strict";var r=n(72076),i=n(68096),o=n(62709),a=n(93382),s=n(90685),l=n(86614),c=n(11163),u=n(36705),d=n(79922),p=n(21221);const h=(...e)=>{const t=2===e[0].length?[0,0]:[0,0,0],n=e.length;for(const r of e)t[0]+=r[0]/n,t[1]+=r[1]/n,3===t.length&&(t[2]+=r[2]/n);return t},f=h;var m=n(86785),g=n(33232),v=n(46966),y=n(20724),b=n(66878),C=n(23118);class w extends a.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:E,showArcLines:!1}}){super(e,t),this.addNewAnnotation=e=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const t=e.detail,{currentPoints:n,element:r}=t,i=n.world,a=(0,o.getEnabledElement)(r),{viewport:s,renderingEngine:c}=a;(0,C.hideElementCursor)(r),this.isDrawing=!0;const u=s.getCamera(),{viewPlaneNormal:d,viewUp:p}=u,h=this.getReferencedImageId(s,i,d,p),f=s.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...p],FrameOfReferenceUID:f,referencedImageId:h,...s.getViewReference({points:[i]})},data:{handles:{points:[[...i],[...i]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,l.addAnnotation)(m,r);const g=(0,v.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:g,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),e.preventDefault(),(0,b.Z)(c,g),m},this.isPointNearTool=(e,t,n,r)=>{const i=(0,o.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{distanceToPoint:l,distanceToPoint2:c}=this.distanceToLines({viewport:a,points:s.handles.points,canvasCoords:n,proximity:r});return l<=r||c<=r},this.toolSelectedCallback=(e,t,n,r,i=6)=>{const a=e.detail,{element:s}=a;t.highlighted=!0;const l=(0,v.getViewportIdsWithToolToRender)(s,this.getToolName()),c=(0,o.getEnabledElement)(s),{renderingEngine:u,viewport:d}=c,{isNearFirstLine:p,isNearSecondLine:h}=this.distanceToLines({viewport:d,points:t.data.handles.points,canvasCoords:r,proximity:i});this.editData={annotation:t,viewportIdsToRender:l,movingTextBox:!1,isNearFirstLine:p,isNearSecondLine:h},this._activateModify(s),(0,C.hideElementCursor)(s),(0,b.Z)(u,l),e.preventDefault()},this._mouseUpCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:i,newAnnotation:a,hasMoved:s}=this.editData,{data:c}=r;if(a&&!s)return;if(this.angleStartedNotYetCompleted&&c.handles.points.length<4)return(0,C.resetElementCursor)(n),void(this.editData.handleIndex=c.handles.points.length);this.angleStartedNotYetCompleted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,C.resetElementCursor)(n);const d=(0,o.getEnabledElement)(n),{renderingEngine:p}=d;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l.removeAnnotation)(r.annotationUID),(0,b.Z)(p,i),a&&(0,u.F$)(r),this.editData=null,this.isDrawing=!1},this._mouseDownCallback=e=>{const{annotation:t,handleIndex:n}=this.editData,r=e.detail,{element:i,currentPoints:o}=r,a=o.world,{data:s}=t;return 1===n?(s.handles.points[1]=a,void(this.editData.hasMoved=s.handles.points[1][0]!==s.handles.points[0][0]||s.handles.points[1][1]!==s.handles.points[0][0])):3===n?(s.handles.points[3]=a,this.editData.hasMoved=s.handles.points[3][0]!==s.handles.points[2][0]||s.handles.points[3][1]!==s.handles.points[2][0],void(this.angleStartedNotYetCompleted=!1)):(this.editData.hasMoved=!1,(0,C.hideElementCursor)(i),s.handles.points[2]=s.handles.points[3]=a,void(this.editData.handleIndex=s.handles.points.length-1))},this._mouseDragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:i,handleIndex:a,movingTextBox:s,isNearFirstLine:l,isNearSecondLine:c}=this.editData,{data:u}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=u.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a&&(l||c)){const{deltaPoints:e}=t,n=e.world,i=u.handles.points;if(l){[i[0],i[1]].forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})}else if(c){[i[2],i[3]].forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})}r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;u.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const d=(0,o.getEnabledElement)(n),{renderingEngine:p}=d;(0,b.Z)(p,i)},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,C.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:i}=t;i.handles.points.length<4&&(0,l.removeAnnotation)(t.annotationUID),t.highlighted=!1,i.handles.activeHandleIndex=null;const a=(0,o.getEnabledElement)(e),{renderingEngine:s}=a;return(0,b.Z)(s,n),r&&(0,u.F$)(t),this.editData=null,this.angleStartedNotYetCompleted=!1,t.annotationUID},this._activateModify=e=>{g.SB.isInteractingWithTool=!0,e.addEventListener(i.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(i.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(i.Events.MOUSE_CLICK,this._mouseUpCallback)},this._deactivateModify=e=>{g.SB.isInteractingWithTool=!1,e.removeEventListener(i.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(i.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(i.Events.MOUSE_CLICK,this._mouseUpCallback)},this._activateDraw=e=>{g.SB.isInteractingWithTool=!0,e.addEventListener(i.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(i.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(i.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(i.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(i.Events.MOUSE_DOWN,this._mouseDownCallback)},this._deactivateDraw=e=>{g.SB.isInteractingWithTool=!1,e.removeEventListener(i.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(i.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(i.Events.MOUSE_MOVE,this._mouseDragCallback),e.removeEventListener(i.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(i.Events.MOUSE_DOWN,this._mouseDownCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let o=(0,l.getAnnotations)(this.getToolName(),i);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(i,o),!o?.length)return n;const a=this.getTargetId(r),s=r.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<o.length;i++){const l=o[i],{annotationUID:d,data:p}=l,{points:h,activeHandleIndex:g}=p.handles;u.annotationUID=d;const{color:v,lineWidth:b,lineDash:C}=this.getAnnotationStyle({annotation:l,styleSpecifier:u}),w=h.map(e=>r.worldToCanvas(e));let E;if(p.cachedStats[a]&&null!=p.cachedStats[a].angle?l.invalidated&&this._throttledCalculateCachedStats(l,s,e):(p.cachedStats[a]={angle:null,arc1Angle:null,arc2Angle:null,points:{world:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null},canvas:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null}}},this._calculateCachedStats(l,s,e)),(0,c.isAnnotationLocked)(l)||this.editData||null===g||(E=[w[g]]),!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(E){const e="0";(0,m.drawHandles)(t,d,e,w,{color:v,lineDash:C,lineWidth:b})}const T=[w[0],w[1]],x=[w[2],w[3]];let _="line1";if((0,m.drawLine)(t,d,_,T[0],T[1],{color:v,width:b,lineDash:C}),n=!0,w.length<4)return n;_="line2",(0,m.drawLine)(t,d,_,x[0],x[1],{color:v,width:b,lineDash:C}),_="linkLine";const S=f(T[0],T[1]),I=f(x[0],x[1]);(0,m.drawLine)(t,d,_,S,I,{color:v,lineWidth:"1",lineDash:"1,4"});const{arc1Start:D,arc1End:A,arc2End:P,arc2Start:O}=p.cachedStats[a].points.canvas,{arc1Angle:R,arc2Angle:M}=p.cachedStats[a];if(this.configuration.showArcLines&&(_="arc1",(0,m.drawLine)(t,d,_,D,A,{color:v,lineWidth:"1"}),_="arc2",(0,m.drawLine)(t,d,_,O,P,{color:v,lineWidth:"1"})),!p.cachedStats[a]?.angle)continue;const N=this.getLinkedTextBoxStyle(u,l);if(!N.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const L=this.configuration.getTextLines(p,a);if(!p.handles.textBox.hasMoved){const e=(0,y.getTextBoxCoordsCanvas)(w);p.handles.textBox.worldPosition=r.canvasToWorld(e)}const k=r.worldToCanvas(p.handles.textBox.worldPosition),F="cobbAngleText",V=(0,m.drawLinkedTextBox)(t,d,F,L,k,w,{},N),{x:U,y:B,width:G,height:W}=V;if(p.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([U,B]),topRight:r.canvasToWorld([U+G,B]),bottomLeft:r.canvasToWorld([U,B+W]),bottomRight:r.canvasToWorld([U+G,B+W])},this.configuration.showArcLines){const e="arcAngle1",n=[`${R.toFixed(2)} ${String.fromCharCode(176)}`],r=f(D,A);(0,m.drawTextBox)(t,d,e,n,r,{...N,padding:3});const i="arcAngle2",o=[`${M.toFixed(2)} ${String.fromCharCode(176)}`],a=f(O,P);(0,m.drawTextBox)(t,d,i,o,a,{...N,padding:3})}}return n},this.distanceToLines=({viewport:e,points:t,canvasCoords:n,proximity:r})=>{const[i,o,a,s]=t,l=e.worldToCanvas(i),c=e.worldToCanvas(o),u=e.worldToCanvas(a),p=e.worldToCanvas(s),h={start:{x:l[0],y:l[1]},end:{x:c[0],y:c[1]}},f={start:{x:u[0],y:u[1]},end:{x:p[0],y:p[1]}},m=d.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]]),g=d.distanceToPoint([f.start.x,f.start.y],[f.end.x,f.end.y],[n[0],n[1]]);let v=!1,y=!1;return m<=r?v=!0:g<=r&&(y=!0),{distanceToPoint:m,distanceToPoint2:g,isNearFirstLine:v,isNearSecondLine:y}},this.getArcsStartEndPoints=({firstLine:e,secondLine:t,mid1:n,mid2:r})=>{const i=[n,r],o=(0,p.Z)(e,i),a=(0,p.Z)(t,i),s=o>90?1:0,l=a>90?0:1,c=f(i[0],i[1]),u=Math.sqrt((i[1][0]-i[0][0])**2+(i[1][1]-i[0][1])**2),d=.1,h=f(e[0],e[1]),m=f(t[0],t[1]),g=[e[s][0]-h[0],e[s][1]-h[1]],v=Math.sqrt(g[0]**2+g[1]**2),y=[g[0]/v,g[1]/v],b=[h[0]+y[0]*u*d,h[1]+y[1]*u*d],C=[c[0]-n[0],c[1]-n[1]],w=Math.sqrt(C[0]**2+C[1]**2),E=[C[0]/w,C[1]/w],T=[n[0]+E[0]*u*d,n[1]+E[1]*u*d],x=[t[l][0]-m[0],t[l][1]-m[1]],_=Math.sqrt(x[0]**2+x[1]**2),S=[x[0]/_,x[1]/_],I=[m[0]+S[0]*u*d,m[1]+S[1]*u*d],D=[c[0]-r[0],c[1]-r[1]],A=Math.sqrt(D[0]**2+D[1]**2),P=[D[0]/A,D[1]/A];return{arc1Start:b,arc1End:T,arc2Start:I,arc2End:[r[0]+P[0]*u*d,r[1]+P[1]*u*d],arc1Angle:o>90?180-o:o,arc2Angle:a>90?180-a:a}},this._throttledCalculateCachedStats=(0,s.Z)(this._calculateCachedStats,25,{trailing:!0})}handleSelectedCallback(e,t,n,r="mouse"){const i=e.detail,{element:a}=i,{data:s}=t;t.highlighted=!0;let l,c=!1;n.worldPosition?c=!0:l=s.handles.points.findIndex(e=>e===n);const u=(0,v.getViewportIdsWithToolToRender)(a,this.getToolName());this.editData={annotation:t,viewportIdsToRender:u,handleIndex:l,movingTextBox:c},this._activateModify(a),(0,C.hideElementCursor)(a);const d=(0,o.getEnabledElement)(a),{renderingEngine:p}=d;(0,b.Z)(p,u),e.preventDefault()}_calculateCachedStats(e,t,n){const i=e.data;if(4!==i.handles.points.length)return;const o=[null,null],a=[null,null];let s=Number.MAX_VALUE;for(let e=0;e<2;e+=1)for(let t=2;t<4;t+=1){const n=r.R3.distance(i.handles.points[e],i.handles.points[t]);n<s&&(s=n,o[1]=i.handles.points[e],o[0]=i.handles.points[(e+1)%2],a[0]=i.handles.points[t],a[1]=i.handles.points[2+(t-1)%2])}const{viewport:l}=n,{element:c}=l,d=i.handles.points.map(e=>l.worldToCanvas(e)),h=[d[0],d[1]],m=[d[2],d[3]],g=f(h[0],h[1]),v=f(m[0],m[1]),{arc1Start:y,arc1End:b,arc2End:C,arc2Start:w,arc1Angle:E,arc2Angle:T}=this.getArcsStartEndPoints({firstLine:h,secondLine:m,mid1:g,mid2:v}),{cachedStats:x}=i,_=Object.keys(x);for(let e=0;e<_.length;e++){x[_[e]]={angle:(0,p.Z)(o,a),arc1Angle:E,arc2Angle:T,points:{canvas:{arc1Start:y,arc1End:b,arc2End:C,arc2Start:w},world:{arc1Start:l.canvasToWorld(y),arc1End:l.canvasToWorld(b),arc2End:l.canvasToWorld(C),arc2Start:l.canvasToWorld(w)}}}}return e.invalidated=!1,(0,u.hg)(e,c),x}}function E(e,t){const n=e.cachedStats[t],{angle:r}=n;if(void 0===r)return;return[`${r.toFixed(2)} ${String.fromCharCode(176)}`]}w.toolName="CobbAngle"},41495:(e,t,n)=>{"use strict";var r=n(62709),i=n(86785),o=n(46966),a=n(23118),s=n(66878),l=n(86479),c=n(20752);class u extends l.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:d}}){super(e,t),this.postMouseDownCallback=e=>{const t=e.detail,{currentPoints:n,element:i}=t,l=n.world,c=(0,r.getEnabledElement)(i),{viewport:u,renderingEngine:d}=c;this.isDrawing=!0;const p=u.getCamera(),{viewPlaneNormal:h,viewUp:f}=p,m=this.getReferencedImageId(u,l,h,f),g={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...f],FrameOfReferenceUID:u.getFrameOfReferenceUID(),referencedImageId:m},data:{label:"",handles:{points:[[...l]]},cachedStats:{}}},v=(0,o.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:g,newAnnotation:!0,viewportIdsToRender:v},this._activateModify(i),(0,a.hideElementCursor)(i),e.preventDefault(),(0,s.Z)(d,v),g},this.postTouchStartCallback=e=>this.postMouseDownCallback(e),this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e;if(!this.editData)return n;const o=this.filterInteractableAnnotationsForElement(r.element,[this.editData.annotation]);if(!o?.length)return n;const a=this.getTargetId(r),s=r.getRenderingEngine(),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},u=this.editData.annotation,d=u.annotationUID,p=u.data,h=p.handles.points[0],f=r.worldToCanvas(h);l.annotationUID=d;const{color:m}=this.getAnnotationStyle({annotation:u,styleSpecifier:l});(0,c.P)(r,a),this.isSuvScaled(r,a,u.metadata.referencedImageId);if(p.cachedStats[a]&&null!=p.cachedStats[a].value?u.invalidated&&this._calculateCachedStats(u,s,e):(p.cachedStats[a]={Modality:null,index:null,value:null},this._calculateCachedStats(u,s,e)),!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;(0,i.drawHandles)(t,d,"0",[f],{color:m}),n=!0;const g=this.configuration.getTextLines(p,a);if(g){const e=[f[0]+6,f[1]-6],n="0";(0,i.drawTextBox)(t,d,n,g,[e[0],e[1]],this.getLinkedTextBoxStyle(l,u))}return n}}}function d(e,t){const n=e.cachedStats[t],{index:r,value:i,modalityUnit:o}=n;if(void 0===i)return;const a=[];return a.push(`(${r[0]}, ${r[1]}, ${r[2]})`),a.push(`${i.toFixed(2)} ${o}`),a}u.toolName="DragProbe"},71330:(e,t,n)=>{"use strict";var r=n(93382),i=n(62709),o=n(39661),a=n(79454),s=n(90685),l=n(86614),c=n(11163),u=n(41836),d=n(36705),p=n(86785),h=n(33232),f=n(68096),m=n(46966),g=n(20724),v=n(21259),y=n(92600),b=n(23118),C=n(66878),w=n(15607),E=n(20752),T=n(51053);const{transformWorldToIndex:x}=i.utilities;class _ extends r.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,centerPointRadius:0,getTextLines:S,statsCalculator:T.BasicStatsCalculator}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(n.canvas,(0,i.getEnabledElement)(r)),{viewport:s,renderingEngine:c}=a;this.isDrawing=!0;const u=s.getCamera(),{viewPlaneNormal:d,viewUp:p}=u,h=this.getReferencedImageId(s,o,d,p),f=s.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...p],FrameOfReferenceUID:f,referencedImageId:h,...s.getViewReference({points:[o]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null},cachedStats:{},initialRotation:s.getRotation()}};(0,l.addAnnotation)(g,r);const v=(0,m.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:v,centerWorld:o,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),(0,b.hideElementCursor)(r),e.preventDefault(),(0,C.Z)(c,v),g},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=l.map(e=>a.worldToCanvas(e)),u=(0,y.getCanvasEllipseCorners)(c),[d,p]=u,h={left:Math.min(d[0],p[0])+r/2,top:Math.min(d[1],p[1])+r/2,width:Math.abs(d[0]-p[0])-r,height:Math.abs(d[1]-p[1])-r},f={left:Math.min(d[0],p[0])-r/2,top:Math.min(d[1],p[1])-r/2,width:Math.abs(d[0]-p[0])+r,height:Math.abs(d[1]-p[1])+r},m=this._pointInEllipseCanvas(h,n);return!(!this._pointInEllipseCanvas(f,n)||m)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,m.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},(0,b.hideElementCursor)(r),this._activateModify(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,C.Z)(s,o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l,c,u,d,p,h=!1;if(n.worldPosition)h=!0;else{const{points:e}=a.handles,{viewport:t}=(0,i.getEnabledElement)(o),{worldToCanvas:r,canvasToWorld:h}=t;s=e.findIndex(e=>e===n);const f=e.map(r);p=f[s],u=Math.abs(f[2][0]-f[3][0]),d=Math.abs(f[0][1]-f[1][1]),l=[(f[2][0]+f[3][0])/2,(f[0][1]+f[1][1])/2],c=h(l)}const f=(0,m.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:f,handleIndex:s,canvasWidth:u,canvasHeight:d,centerWorld:c,originalHandleCanvas:p,movingTextBox:h},this._activateModify(o),(0,b.hideElementCursor)(o);const g=(0,i.getEnabledElement)(o),{renderingEngine:v}=g;(0,C.Z)(v,f),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:a,hasMoved:s}=this.editData,{data:c}=r;if(a&&!s)return;r.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,b.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l.removeAnnotation)(r.annotationUID),(0,C.Z)(u,o),a&&(0,d.F$)(r)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:r}=t,o=r.canvas,a=(0,i.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:u,viewportIdsToRender:d,centerWorld:p}=this.editData,h=l.worldToCanvas(p),{data:f}=u,m=Math.abs(o[0]-h[0]),g=Math.abs(o[1]-h[1]),v=[h[0],h[1]-g],y=[h[0],h[1]+g],b=[h[0]-m,h[1]],w=[h[0]+m,h[1]];f.handles.points=[c(v),c(y),c(b),c(w)],u.invalidated=!0,this.editData.hasMoved=!0,(0,C.Z)(s,d)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else this._dragHandle(e),r.invalidated=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,C.Z)(u,o)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,{viewport:r}=(0,i.getEnabledElement)(n),{canvasToWorld:o,worldToCanvas:a}=r,{annotation:s,canvasWidth:l,canvasHeight:c,handleIndex:u,centerWorld:d,originalHandleCanvas:p}=this.editData,h=r.worldToCanvas(d),{data:f}=s,{points:m}=f.handles,{currentPoints:g}=t,v=g.canvas;if(0===u||1===u){const e=Math.abs(v[1]-h[1]),t=[h[0],h[1]-e],n=[h[0],h[1]+e];m[0]=o(t),m[1]=o(n);const r=l/2+(v[0]-p[0]),i=[h[0]-r,h[1]],a=[h[0]+r,h[1]];m[2]=o(i),m[3]=o(a)}else{const e=Math.abs(v[0]-h[0]),t=[h[0]-e,h[1]],n=[h[0]+e,h[1]];m[2]=o(t),m[3]=o(n);const r=c/2+(v[1]-p[1]),i=[h[0],h[1]-r],a=[h[0],h[1]+r];m[0]=o(i),m[1]=o(a)}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,b.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,i.getEnabledElement)(e);return(0,C.Z)(a,n),r&&(0,d.F$)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:o}=r;let a=(0,l.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(r),d=r.getRenderingEngine(),h={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let o=0;o<a.length;o++){const l=a[o],{annotationUID:f,data:m}=l,{handles:v}=m,{points:b,activeHandleIndex:C}=v;h.annotationUID=f;const{color:w,lineWidth:E,lineDash:T}=this.getAnnotationStyle({annotation:l,styleSpecifier:h}),x=b.map(e=>r.worldToCanvas(e)),_=(Math.abs(r.getRotation()-(m.initialRotation||0)),(0,y.getCanvasEllipseCorners)(x)),{centerPointRadius:S}=this.configuration;if(m.cachedStats[s]&&null!=m.cachedStats[s].areaUnit){if(l.invalidated&&(this._throttledCalculateCachedStats(l,r,d,e),r instanceof i.VolumeViewport)){const{referencedImageId:e}=l.metadata;for(const t in m.cachedStats)if(t.startsWith("imageId")){d.getStackViewports().find(t=>{const n=i.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=i.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n})&&delete m.cachedStats[t]}}}else m.cachedStats[s]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(l,r,d);if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let I;if(!(0,u.isAnnotationVisible)(f))continue;if((0,c.isAnnotationLocked)(l)||this.editData||null===C||(I=[x[C]]),I){const e="0";(0,p.drawHandles)(t,f,e,I,{color:w})}const D=`${f}-ellipse`,A="0";if((0,p.drawEllipseByCoordinates)(t,f,A,x,{color:w,lineDash:T,lineWidth:E},D),S>0){if(Math.min(Math.abs(_[0][0]-_[1][0])/2,Math.abs(_[0][1]-_[1][1])/2)>3*S){const e=this._getCanvasEllipseCenter(x);(0,p.drawCircle)(t,f,`${A}-center`,e,S,{color:w,lineDash:T,lineWidth:E})}}n=!0;const P=this.getLinkedTextBoxStyle(h,l);if(!P.visibility){m.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const O=this.configuration.getTextLines(m,s);if(!O||0===O.length)continue;let R;m.handles.textBox.hasMoved||(R=(0,g.getTextBoxCoordsCanvas)(_),m.handles.textBox.worldPosition=r.canvasToWorld(R));const M=r.worldToCanvas(m.handles.textBox.worldPosition),N="1",L=(0,p.drawLinkedTextBox)(t,f,N,O,M,x,{},P),{x:k,y:F,width:V,height:U}=L;m.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([k,F]),topRight:r.canvasToWorld([k+V,F]),bottomLeft:r.canvasToWorld([k,F+U]),bottomRight:r.canvasToWorld([k+V,F+U])}}return n},this._calculateCachedStats=(e,t,n)=>{const r=e.data,{element:i}=t,{points:s}=r.handles,l=s.map(e=>t.worldToCanvas(e)),{viewPlaneNormal:c,viewUp:u}=t.getCamera(),[p,h]=(0,y.getCanvasEllipseCorners)(l),f=t.canvasToWorld(p),m=t.canvasToWorld(h),{cachedStats:g}=r,b=Object.keys(g),C=f,T=m;for(let r=0;r<b.length;r++){const i=b[r],s=this.getTargetIdImage(i,n);if(!s)continue;const{dimensions:l,imageData:d,metadata:p}=s,h=x(d,C);h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]),h[2]=Math.floor(h[2]);const _=x(d,T);_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]),this.isHandleOutsideImage=!this._isInsideVolume(h,_,l);const S=[[Math.min(h[0],_[0]),Math.max(h[0],_[0])],[Math.min(h[1],_[1]),Math.max(h[1],_[1])],[Math.min(h[2],_[2]),Math.max(h[2],_[2])]],I={center:[(f[0]+m[0])/2,(f[1]+m[1])/2,(f[2]+m[2])/2],xRadius:Math.abs(f[0]-m[0])/2,yRadius:Math.abs(f[1]-m[1])/2,zRadius:Math.abs(f[2]-m[2])/2},{worldWidth:D,worldHeight:A}=(0,v.Z)(c,u,C,T),P=0===D&&0===A,O=[h,_],{scale:R,areaUnits:M}=(0,o.mh)(s,O),N=Math.abs(Math.PI*(D/2)*(A/2))/R/R,L={isPreScaled:(0,E.P)(t,i),isSuvScaled:this.isSuvScaled(t,i,e.metadata.referencedImageId)},k=(0,w.F)(p.Modality,e.metadata.referencedImageId,L),F=(0,a.pointInShapeCallback)(d,e=>(0,y.pointInEllipse)(I,e,{fast:!0}),this.configuration.statsCalculator.statsCallback,S),V=this.configuration.statsCalculator.getStatistics();g[i]={Modality:p.Modality,area:N,mean:V.mean?.value,max:V.max?.value,stdDev:V.stdDev?.value,statsArray:V.array,pointsInShape:F,isEmptyArea:P,areaUnit:M,modalityUnit:k}}return e.invalidated=!1,(0,d.hg)(e,i),g},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,s.Z)(this._calculateCachedStats,100,{trailing:!0})}_pointInEllipseCanvas(e,t){const n=e.width/2,r=e.height/2;if(n<=0||r<=0)return!1;const i=[e.left+n,e.top+r],o=[t[0]-i[0],t[1]-i[1]];return o[0]*o[0]/(n*n)+o[1]*o[1]/(r*r)<=1}_getCanvasEllipseCenter(e){const[t,n,r,i]=e,o=[r[0],n[1]],a=[i[0],t[1]];return[(o[0]+a[0])/2,(o[1]+a[1])/2]}}function S(e,t){const n=e.cachedStats[t],{area:r,mean:i,stdDev:o,max:s,isEmptyArea:l,areaUnit:c,modalityUnit:u}=n,d=[];if(r){const e=l?"Area: Oblique not supported":`Area: ${(0,a.roundNumber)(r)} ${c}`;d.push(e)}return i&&d.push(`Mean: ${(0,a.roundNumber)(i)} ${u}`),s&&d.push(`Max: ${(0,a.roundNumber)(s)} ${u}`),o&&d.push(`Std Dev: ${(0,a.roundNumber)(o)} ${u}`),d}_.toolName="EllipticalROI"},7003:(e,t,n)=>{"use strict";var r=n(68096),i=n(62709),o=n(93382),a=n(86614),s=n(36705),l=n(86785),c=n(33232),u=n(46966),d=n(66878),p=n(23118);class h extends o.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:f,changeTextCallback:m,canvasPosition:[10,10],canvasSize:10}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,l=(0,i.getEnabledElement)(r),{viewport:c,renderingEngine:p}=l,f=c.getCamera(),{viewPlaneNormal:m,viewUp:g}=f,v=this.getReferencedImageId(c,o,m,g),y=h.createAnnotation({metadata:{...c.getViewReference(),referencedImageId:v}});(0,a.addAnnotation)(y,r);const b=(0,u.getViewportIdsWithToolToRender)(r,this.getToolName());return e.preventDefault(),(0,d.Z)(p,b),this.configuration.getTextCallback(e=>{if(!e)return(0,a.removeAnnotation)(y.annotationUID),(0,d.Z)(p,b),void(this.isDrawing=!1);y.data.text=e,(0,s.F$)(y),(0,d.Z)(p,b)}),y},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{canvasPosition:l,canvasSize:c}=this.configuration;return!!l?.length&&(Math.abs(n[0]-l[0]+c/2)<=c/2&&Math.abs(n[1]-l[1]+c/2)<=c/2)},this.toolSelectedCallback=(e,t)=>{t.highlighted=!0,e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t;this._deactivateModify(n),(0,p.resetElementCursor)(n)},this.doubleClickCallback=e=>{const t=e.detail,{element:n}=t;let r=(0,a.getAnnotations)(this.getToolName(),n);if(r=this.filterInteractableAnnotationsForElement(n,r),!r?.length)return;const i=r.find(e=>this.isPointNearTool(n,e,t.currentPoints.canvas,6));if(!i)return;const o=i;this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,n,o)),this.isDrawing=!1,e.stopImmediatePropagation(),e.preventDefault()},this._activateModify=e=>{c.SB.isInteractingWithTool=!0,e.addEventListener(r.Events.MOUSE_UP,this._endCallback),e.addEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(r.Events.TOUCH_TAP,this._endCallback),e.addEventListener(r.Events.TOUCH_END,this._endCallback)},this._deactivateModify=e=>{c.SB.isInteractingWithTool=!1,e.removeEventListener(r.Events.MOUSE_UP,this._endCallback),e.removeEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(r.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(r.Events.TOUCH_END,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let o=(0,a.getAnnotations)(this.getToolName(),i);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(i,o),!o?.length)return n;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<o.length;e++){const i=o[e],{annotationUID:a}=i;s.annotationUID=a;const{color:c}=this.getAnnotationStyle({annotation:i,styleSpecifier:s}),{canvasPosition:u,canvasSize:d}=this.configuration;if(u?.length){const e="1";(0,l.drawArrow)(t,a,e,u.map(e=>e+d),u,{color:c,width:1})}if(n=!0,!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n}return n}}cancel(){}handleSelectedCallback(e,t,n){}_doneChangingTextCallback(e,t,n){t.data.text=n;const r=(0,i.getEnabledElement)(e),{renderingEngine:o}=r,a=(0,u.getViewportIdsWithToolToRender)(e,this.getToolName());(0,d.Z)(o,a),(0,s.hg)(t,e)}_isInsideVolume(e,t,n){return i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n)}}function f(e){return e(prompt("Enter your annotation:"))}function m(e,t,n){return n(prompt("Enter your annotation:"))}h.toolName="KeyImage"},3098:(e,t,n)=>{"use strict";var r=n(68096),i=n(62709),o=n(39661),a=n(79454),s=n(93382),l=n(90685),c=n(86614),u=n(11163),d=n(41836),p=n(36705),h=n(79922),f=n(86785),m=n(33232),g=n(46966),v=n(20724),y=n(66878),b=n(23118);const{transformWorldToIndex:C}=i.utilities;class w extends s.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:E}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:s,renderingEngine:l}=a;(0,b.hideElementCursor)(r),this.isDrawing=!0;const{viewPlaneNormal:u,viewUp:d,position:p}=s.getCamera(),h=this.getReferencedImageId(s,o,u,d),f={highlighted:!0,invalidated:!0,metadata:{...s.getViewReference({points:[o]}),toolName:this.getToolName(),referencedImageId:h,viewUp:d,cameraPosition:p},data:{handles:{points:[[...o],[...o]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,c.addAnnotation)(f,r);const m=(0,g.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:m,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),e.preventDefault(),(0,y.Z)(l,m),f},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,[l,c]=s.handles.points,u=a.worldToCanvas(l),d=a.worldToCanvas(c),p={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}};return h.distanceToPoint([p.start.x,p.start.y],[p.end.x,p.end.y],[n[0],n[1]])<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,g.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(r),(0,b.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,y.Z)(s,o),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:a,hasMoved:s}=this.editData,{data:l}=r;if(a&&!s)return;l.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,b.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,c.removeAnnotation)(r.annotationUID),(0,y.Z)(d,o),a&&(0,p.F$)(r),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,y.Z)(u,o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,b.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const a=(0,i.getEnabledElement)(e),{renderingEngine:s}=a;return(0,y.Z)(s,n),r&&(0,p.F$)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{m.SB.isInteractingWithTool=!0,e.addEventListener(r.Events.MOUSE_UP,this._endCallback),e.addEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(r.Events.TOUCH_END,this._endCallback),e.addEventListener(r.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(r.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{m.SB.isInteractingWithTool=!1,e.removeEventListener(r.Events.MOUSE_UP,this._endCallback),e.removeEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(r.Events.TOUCH_END,this._endCallback),e.removeEventListener(r.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(r.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{m.SB.isInteractingWithTool=!0,e.addEventListener(r.Events.MOUSE_UP,this._endCallback),e.addEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(r.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(r.Events.TOUCH_END,this._endCallback),e.addEventListener(r.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(r.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{m.SB.isInteractingWithTool=!1,e.removeEventListener(r.Events.MOUSE_UP,this._endCallback),e.removeEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(r.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(r.Events.TOUCH_END,this._endCallback),e.removeEventListener(r.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(r.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let o=(0,c.getAnnotations)(this.getToolName(),i);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(i,o),!o?.length)return n;const a=this.getTargetId(r),s=r.getRenderingEngine(),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<o.length;i++){const c=o[i],{annotationUID:p,data:h}=c,{points:m,activeHandleIndex:g}=h.handles;l.annotationUID=p;const{color:y,lineWidth:b,lineDash:C,shadow:w}=this.getAnnotationStyle({annotation:c,styleSpecifier:l}),E=m.map(e=>r.worldToCanvas(e));let T;if(h.cachedStats[a]&&null!=h.cachedStats[a].unit?c.invalidated&&this._throttledCalculateCachedStats(c,s,e):(h.cachedStats[a]={length:null,unit:null},this._calculateCachedStats(c,s,e)),!(0,d.isAnnotationVisible)(p))continue;if((0,u.isAnnotationLocked)(c)||this.editData||null===g||(T=[E[g]]),T){const e="0";(0,f.drawHandles)(t,p,e,E,{color:y,lineDash:C,lineWidth:b})}const x=`${p}-line`,_="1";if((0,f.drawLine)(t,p,_,E[0],E[1],{color:y,width:b,lineDash:C,shadow:w},x),n=!0,!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const S=this.getLinkedTextBoxStyle(l,c);if(!S.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const I=this.configuration.getTextLines(h,a);if(!h.handles.textBox.hasMoved){const e=(0,v.getTextBoxCoordsCanvas)(E);h.handles.textBox.worldPosition=r.canvasToWorld(e)}const D=r.worldToCanvas(h.handles.textBox.worldPosition),A="1",P=(0,f.drawLinkedTextBox)(t,p,A,I,D,E,{},S),{x:O,y:R,width:M,height:N}=P;h.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([O,R]),topRight:r.canvasToWorld([O+M,R]),bottomLeft:r.canvasToWorld([O,R+N]),bottomRight:r.canvasToWorld([O+M,R+N])}}return n},this._throttledCalculateCachedStats=(0,l.Z)(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,t,n){const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,g.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,b.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,y.Z)(d,c),e.preventDefault()}_calculateLength(e,t){const n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}_calculateCachedStats(e,t,n){const r=e.data,{element:i}=n.viewport,a=r.handles.points[0],s=r.handles.points[1],{cachedStats:l}=r,c=Object.keys(l);for(let e=0;e<c.length;e++){const n=c[e],r=this.getTargetIdImage(n,t);if(!r)continue;const{imageData:i,dimensions:u}=r,d=C(i,a),p=C(i,s),h=[d,p],{scale:f,units:m}=(0,o.mh)(r,h),g=this._calculateLength(a,s)/f;this._isInsideVolume(d,p,u)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,l[n]={length:g,unit:m}}return e.invalidated=!1,(0,p.hg)(e,i),l}_isInsideVolume(e,t,n){return i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n)}}function E(e,t){const n=e.cachedStats[t],{length:r,unit:i}=n;if(null==r||isNaN(r))return;return[`${(0,a.roundNumber)(r)} ${i}`]}w.toolName="Length"},57720:(e,t,n)=>{"use strict";var r=n(62709),i=n(36632),o=n(27479),a=n(36705),s=n(68096),l=n(86785);class c extends i.Z{updateInterpolatedAnnotation(e,t){!this.editData&&e.invalidated&&e.data.handles.interpolationSources&&(e.data.contour.originalPolyline=e.data.contour.polyline,queueMicrotask(()=>{if(!e.data.handles.interpolationSources)return;const{points:n}=e.data.handles,{element:i}=t.viewport;this.setupBaseEditData(n[0],i,e);const{length:l}=n,{scissors:c}=this,{nearestEdge:u,repeatInterpolation:d}=this.configuration.interpolation;e.data.handles.originalPoints=n;const{worldToSlice:p,sliceToWorld:h}=this.editData,f=[];if(u){let e=p(n[n.length-1]);n.forEach((t,i)=>{const o=p(t);e=o,f.push(o),c.startSearch(e),c.findPathToPoint(o),c.findPathToPoint(p(n[(i+3)%n.length]));const a=c.findMinNearby(o,u);r.utilities.isEqual(o,a)||(f[i]=a,e=a,n[i]=h(a))})}const m=new o.B;for(let e=0;e<l;e++){c.startSearch(p(n[e]));const t=c.findPathToPoint(p(n[(e+1)%l]));m.addPoints(t)}this.updateAnnotation(m),this.scissors=null,this.scissorsNext=null,this.editData=null,e.data.handles.interpolationSources=null,d&&(0,a.hg)(e,t.viewport.element,s.ChangeTypes.InterpolationUpdated)}))}renderAnnotationInstance(e){const{enabledElement:t,svgDrawingHelper:n}=e,r=e.annotation,{annotationUID:i}=r,{viewport:o}=t,{worldToCanvas:a}=o,{showInterpolationPolyline:s}=this.configuration.interpolation||{};this.updateInterpolatedAnnotation?.(r,t);const{originalPolyline:c}=r.data.contour,u=super.renderAnnotationInstance(e);if(s&&c&&r.autoGenerated){const e=c.map(a);e.push(e[0]),(0,l.drawPolyline)(n,i,"interpolationContour-0",e,{color:"#70ffff",lineWidth:1,fillOpacity:0})}return u}isContourSegmentationTool(){return!0}}c.toolName="LivewireContourSegmentationTool"},36632:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var r=n(72076),i=n(62709),o=n(86614),a=n(86785),s=n(33232),l=n(68096),c=n(23118),u=n(19197),d=n(79454),p=n(66299),h=n(46915),f=n(36705);class m{constructor({numBits:e,getPriority:t,areEqual:n}){this._bucketCount=1<<e,this._mask=this._bucketCount-1,this._size=0,this._currentBucketIndex=0,this._buckets=this._buildArray(this._bucketCount),this._getPriority=void 0!==t?t:e=>e,this._areEqual="function"==typeof n?n:(e,t)=>e===t}push(e){const t=this._getBucketIndex(e),n={value:e,next:this._buckets[t]};this._buckets[t]=n,this._size++}pop(){if(0===this._size)throw new Error("Cannot pop because the queue is empty.");for(;null===this._buckets[this._currentBucketIndex];)this._currentBucketIndex=(this._currentBucketIndex+1)%this._bucketCount;const e=this._buckets[this._currentBucketIndex];return this._buckets[this._currentBucketIndex]=e.next,this._size--,e.value}remove(e){if(!e)return!1;const t=this._getBucketIndex(e),n=this._buckets[t];let r,i=n;for(;null!==i&&!this._areEqual(e,i.value);)r=i,i=i.next;return null!==i&&(i===n?this._buckets[t]=i.next:r.next=i.next,this._size--,!0)}isEmpty(){return 0===this._size}_getBucketIndex(e){return this._getPriority(e)&this._mask}_buildArray(e){const t=new Array(e);return t.fill(null),t}}const{isEqual:g}=i.utilities,v=4294967295,y=2/(3*Math.PI);class b{constructor(e,t,n){this._getPointIndex=(e,t)=>{const{width:n}=this;return e*n+t},this._getPointCoordinate=e=>[e%this.width,Math.floor(e/this.width)],this._getPointCost=e=>Math.round(this.searchGranularity*this.costs[e]);const r=e.length;this.searchGranularityBits=8,this.searchGranularity=1<<this.searchGranularityBits,this.width=t,this.height=n,this.grayscalePixelData=e,this.laplace=null,this.gradXNew=null,this.gradYNew=null,this.laplace=this._computeLaplace(),this.gradMagnitude=this._computeGradient(),this.gradXNew=this._computeGradientX(),this.gradYNew=this._computeGradientY(),this.visited=new Array(r),this.parents=new Uint32Array(r),this.costs=new Float32Array(r)}startSearch(e){const t=this._getPointIndex(e[1],e[0]);this.startPoint=null,this.visited.fill(!1),this.parents.fill(v),this.costs.fill(1/0),this.priorityQueueNew=new m({numBits:this.searchGranularityBits,getPriority:this._getPointCost}),this.startPoint=e,this.costs[t]=0,this.priorityQueueNew.push(t)}findMinNearby(e,t=2){const[n,r]=e,{costs:i}=this,o=[Math.max(0,n-t),Math.min(n+t+1,this.width)],a=[Math.max(0,r-t),Math.min(r+t+1,this.height)];let s=.8*i[this._getPointIndex(r,n)],l=e;for(let n=o[0];n<o[1];n++)for(let r=a[0];r<a[1];r++){const o=1-(Math.abs(n-e[0])+Math.abs(r-e[1]))/t/2,a=.8*i[this._getPointIndex(r,n)]+.2*o;a<s&&(l=[n,r],s=a)}return l}findPathToPoint(e){if(!this.startPoint)throw new Error("There is no search in progress");const{startPoint:t,_getPointIndex:n,_getPointCoordinate:r}=this,i=n(t[1],t[0]),o=n(e[1],e[0]),{visited:a,parents:s,costs:l,priorityQueueNew:c}=this;if(o===i)return[];for(;!c.isEmpty()&&s[o]===v;){const e=c.pop();if(a[e])continue;const t=r(e),i=this._getNeighborPoints(t);a[e]=!0;for(let r=0,o=i.length;r<o;r++){const o=i[r],a=n(o[1],o[0]),u=this._getWeightedDistance(t,o),d=l[e]+u;d<l[a]&&(l[a]!==1/0&&c.remove(a),l[a]=d,s[a]=e,c.push(a))}}const u=[];let d=o;for(;d!==v;)u.push(r(d)),d=s[d];return u.reverse()}_getDeltaX(e,t){const{grayscalePixelData:n,width:r}=this;let i=this._getPointIndex(t,e);return e+1===r&&i--,n[i+1]-n[i]}_getDeltaY(e,t){const{grayscalePixelData:n,width:r,height:i}=this;let o=this._getPointIndex(t,e);return t+1===i&&(o-=r),n[o]-n[o+r]}_getGradientMagnitude(e,t){const n=this._getDeltaX(e,t),r=this._getDeltaY(e,t);return Math.sqrt(n*n+r*r)}_getLaplace(e,t){const{grayscalePixelData:n,_getPointIndex:r}=this;let i=n[r(t-2,e)];return i+=n[r(t-1,e-1)]+2*n[r(t-1,e)]+n[r(t-1,e+1)],i+=n[r(t,e-2)]+2*n[r(t,e-1)]-16*n[r(t,e)]+2*n[r(t,e+1)]+n[r(t,e+2)],i+=n[r(t+1,e-1)]+2*n[r(t+1,e)]+n[r(t+1,e+1)],i+=n[r(t+2,e)],i}_computeGradient(){const{width:e,height:t}=this,n=new Float32Array(e*t);let r=0,i=0,o=0,a=0;for(a=0;a<t-1;a++){for(o=0;o<e-1;o++)n[r]=this._getGradientMagnitude(o,a),i=Math.max(n[r],i),r++;n[r]=n[r-1],r++}for(let t=n.length;r<t;r++)n[r]=n[r-e];for(let e=0,t=n.length;e<t;e++)n[e]=1-n[e]/i;return n}_computeLaplace(){const{width:e,height:t,_getPointIndex:n}=this,r=new Float32Array(e*t);r.fill(1,0,n(2,0));for(let i=2;i<t-2;i++){r[n(i,0)]=1,r[n(i,1)]=1;for(let t=2;t<e-2;t++)r[n(i,t)]=this._getLaplace(t,i)>.33?0:1;r[n(i,e-2)]=1,r[n(i,e-1)]=1}return r.fill(1,n(t-2,0)),r}_computeGradientX(){const{width:e,height:t}=this,n=new Float32Array(e*t);let r=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++)n[r++]=this._getDeltaX(t,i);return n}_computeGradientY(){const{width:e,height:t}=this,n=new Float32Array(e*t);let r=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++)n[r++]=this._getDeltaY(t,i);return n}_getGradientUnitVector(e,t){const{gradXNew:n,gradYNew:r,_getPointIndex:i}=this,o=n[i(t,e)],a=r[i(t,e)];let s=Math.sqrt(o*o+a*a);return s=Math.max(s,1e-100),[o/s,a/s]}_getGradientDirection(e,t,n,r){const i=this._getGradientUnitVector(e,t),o=this._getGradientUnitVector(n,r);let a=i[1]*(n-e)-i[0]*(r-t),s=o[1]*(n-e)-o[0]*(r-t);a<0&&(a=-a,s=-s),e!==n&&t!==r&&(a*=Math.SQRT1_2,s*=Math.SQRT1_2),s=Math.min(Math.max(s,-1),1);const l=y*(Math.acos(Math.min(a,1))+Math.acos(s));return isNaN(l)||!isFinite(l)?(console.warn("Found non-direction:",e,t,n,r,a,s,l),1):l}getCost(e,t){return this._getWeightedDistance(e,t)}_getWeightedDistance(e,t){const{_getPointIndex:n,width:r,height:i}=this,[o,a]=e,[s,l]=t;if(s<0||s>=r||l<0||l>=i)return 1;if(o<0||a<0||o>=r||a>=i)return 0;const c=n(l,s);let u=this.gradMagnitude[c];o!==s&&a!==l||(u*=Math.SQRT1_2);return.43*u+.43*this.laplace[c]+.11*this._getGradientDirection(o,a,s,l)}_getNeighborPoints(e){const{width:t,height:n}=this,r=[],i=Math.max(e[0]-1,0),o=Math.max(e[1]-1,0),a=Math.min(e[0]+1,t-1),s=Math.min(e[1]+1,n-1);for(let t=o;t<=s;t++)for(let n=i;n<=a;n++)n===e[0]&&t===e[1]||r.push([n,t]);return r}static createInstanceFromRawPixelData(e,t,n,r){const i=e.length,o=new Float32Array(i),{lower:a,upper:s}=r,l=s-a;for(let t=0,n=e.length;t<n;t++)o[t]=Math.max(0,Math.min(1,(e[t]-a)/l));return new b(o,t,n)}}var C=n(27479),w=n(46966),E=n(22955);class T extends E.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:l.KeyboardBindings.Shift,snapHandleNearby:2,interpolation:{enabled:!1,nearestEdge:2,showInterpolationPolyline:!1},decimate:{enabled:!1,epsilon:.1},actions:{undo:{method:"undo",bindings:[{key:"Escape"}]}}}}){super(e,t),this.isHandleOutsideImage=!1,this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,s=r*r,l=t.data.contour.polyline.map(e=>a.worldToCanvas(e));let c=l[l.length-1];for(let e=0;e<l.length;e++){const t=l[e];if(d.math.lineSegment.distanceToPointSquared(c,t,n)<=s)return!0;c=t}return!1},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,w.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o};const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;this._activateModify(r),(0,d.triggerAnnotationRenderForViewportIds)(s,o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;const{points:s}=a.handles,l=s.findIndex(e=>e===n),c=(0,w.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:l},this._activateModify(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:p}=u;(0,d.triggerAnnotationRenderForViewportIds)(p,c),e.preventDefault()},this._endCallback=(e,t=!1)=>{const n=e.detail,{element:r}=n,{annotation:a,viewportIdsToRender:s,newAnnotation:u,contourHoleProcessingEnabled:p}=this.editData,{data:h}=a;h.handles.activeHandleIndex=null,this._deactivateModify(r),this._deactivateDraw(r),(0,c.resetElementCursor)(r);const f=(0,i.getEnabledElement)(r),{renderingEngine:m}=f;if(this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage||t)return(0,o.removeAnnotation)(a.annotationUID),this.clearEditData(),void(0,d.triggerAnnotationRenderForViewportIds)(m,s);(0,d.triggerAnnotationRenderForViewportIds)(m,s);const g=u?l.ChangeTypes.Completed:l.ChangeTypes.HandlesUpdated;this.triggerChangeEvent(a,f,g,p),this.clearEditData()},this.triggerChangeEvent=(e,t,n=l.ChangeTypes.StatsUpdated,r=!1)=>{n===l.ChangeTypes.Completed?(0,f.lf)(e,r):(0,f.hg)(e,t.viewport.element,n)},this._mouseDownCallback=e=>{const t=e.type===l.Events.MOUSE_DOUBLE_CLICK,{annotation:n,viewportIdsToRender:r,worldToSlice:o,sliceToWorld:a}=this.editData;if(this.editData.closed)return;const s=e.detail,{element:c}=s,{currentPoints:u}=s,{canvas:p,world:h}=u;let f=h;const m=(0,i.getEnabledElement)(c),{viewport:g,renderingEngine:v}=m,y=this.editData.currentPath.getControlPoints();let b=y.length>=2&&t;if(y.length>=2){const e={index:-1,distSquared:1/0};for(let t=0,n=y.length;t<n;t++){const n=a(y[t]),r=g.worldToCanvas(n),i=d.math.point.distanceToPointSquared(p,r);i<=100&&i<e.distSquared&&(e.distSquared=i,e.index=t)}0===e.index&&(b=!0)}const{snapHandleNearby:w}=this.configuration;if(w&&!this.editData.closed){const e=new C.B,t=this.scissors.findMinNearby(o(h),1),n=this.scissors.findPathToPoint(t);e.addPoints(n),e.prependPath(this.editData.confirmedPath),f=a(t),this.editData.currentPath=e}this.editData.closed=this.editData.closed||b,this.editData.confirmedPath=this.editData.currentPath;const E=this.editData.currentPath.getLastPoint();this.editData.confirmedPath.addControlPoint(E),n.data.handles.points.push(a(E)),this.scissors.startSearch(o(f)),n.invalidated=!0,(0,d.triggerAnnotationRenderForViewportIds)(v,r),this.editData.closed&&(this.updateAnnotation(this.editData.confirmedPath),this._endCallback(e)),e.preventDefault()},this._mouseMoveCallback=e=>{const{element:t,currentPoints:n}=e.detail,{world:r,canvas:o}=n,{renderingEngine:a}=(0,i.getEnabledElement)(t),s=(0,w.getViewportIdsWithToolToRender)(t,this.getToolName());this.editData.lastCanvasPoint=o;const{width:l,height:c}=this.scissors,{worldToSlice:u}=this.editData,p=u(r);if(p[0]<0||p[1]<0||p[0]>=l||p[1]>=c)return;const h=this.scissors.findPathToPoint(p),f=new C.B;f.addPoints(h),f.prependPath(this.editData.confirmedPath),this.editData.currentPath=f,(0,d.triggerAnnotationRenderForViewportIds)(a,s),e.preventDefault()},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a}=this.editData;if(void 0===a)console.warn("No drag implemented for livewire");else{const{currentPoints:e}=t,i=e.world;this.editHandle(i,n,r,a)}const s=(0,i.getEnabledElement)(n),{renderingEngine:l}=s;(0,d.triggerAnnotationRenderForViewportIds)(l,o)},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,c.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData;r&&(0,o.removeAnnotation)(t.annotationUID);const a=(0,i.getEnabledElement)(e),{renderingEngine:s}=a;return(0,d.triggerAnnotationRenderForViewportIds)(s,n),this.editData=null,this.scissors=null,t.annotationUID},this._activateModify=e=>{s.SB.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{s.SB.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{s.SB.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.addEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.addEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.addEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=e=>{s.SB.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.removeEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.removeEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)}}setupBaseEditData(e,t,n,o,a){const s=(0,i.getEnabledElement)(t),{viewport:l}=s;this.isDrawing=!0;const c=l.getImageData(),{imageData:u}=c;let d,p,h,f,{scalarData:m}=c;if(l instanceof i.VolumeViewport||!m){if(!(l instanceof i.VolumeViewport))throw new Error("Viewport not supported");{const e=i.utilities.getCurrentVolumeViewportSlice(l),{sliceToIndexMatrix:t,indexToSliceMatrix:n}=e;d=e=>{const t=i.utilities.transformWorldToIndex(u,e),o=r.R3.transformMat4([0,0,0],t,n);return[o[0],o[1]]},p=e=>{const n=r.R3.transformMat4([0,0,0],[e[0],e[1],0],t);return i.utilities.transformIndexToWorld(u,n)},m=e.scalarData,h=e.width,f=e.height}}else h=c.dimensions[0],f=c.dimensions[1],d=e=>{const t=i.utilities.transformWorldToIndex(u,e);return[t[0],t[1]]},p=e=>i.utilities.transformIndexToWorld(u,[e[0],e[1],0]);m=i.utilities.convertToGrayscale(m,h,f);const{voiRange:g}=l.getProperties(),v=d(e);this.scissors=b.createInstanceFromRawPixelData(m,h,f,g),o&&(this.scissorsNext=b.createInstanceFromRawPixelData(m,h,f,g),this.scissorsNext.startSearch(d(o))),this.scissors.startSearch(v);const y=!o,E=new C.B,T=new C.B,x=y?void 0:new C.B;E.addPoint(v),E.addControlPoint(v);const _=(0,w.getViewportIdsWithToolToRender)(t,this.getToolName()),S=l.worldToCanvas(e);this.editData={annotation:n,viewportIdsToRender:_,newAnnotation:y,hasMoved:!1,lastCanvasPoint:S,confirmedPath:E,currentPath:T,confirmedPathNext:x,closed:!1,handleIndex:this.editData?.handleIndex??n.handles?.activeHandleIndex,worldToSlice:d,sliceToWorld:p,contourHoleProcessingEnabled:a}}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:r}=t,{world:o}=n,{renderingEngine:a}=(0,i.getEnabledElement)(r),s=this.createAnnotation(e),l=(0,u.Z)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey;return this.setupBaseEditData(o,r,s,void 0,l),this.addAnnotation(s,r),this._activateDraw(r),e.preventDefault(),(0,d.triggerAnnotationRenderForViewportIds)(a,this.editData.viewportIdsToRender),s}clearEditData(){this.editData=null,this.scissors=null,this.scissorsNext=null,this.isDrawing=!1}editHandle(e,t,n,r){const{data:i}=n,{points:o}=i.handles,{length:a}=o,s=o[(r-1+a)%a],l=o[(r+1)%a];if(!this.editData?.confirmedPathNext){this.setupBaseEditData(s,t,n,l);const{polyline:e}=i.contour,o=new C.B,a=new C.B,{worldToSlice:c}=this.editData,u=(0,p.Z)(n,r-1),d=(0,p.Z)(n,r+1);if(-1===d||-1===u)throw new Error(`Can't find handle index ${-1===d&&l} ${-1===u&&s}`);0===r?a.addPoints(e.slice(d+1,u).map(c)):(o.addPoints(e.slice(0,u+1).map(c)),a.addPoints(e.slice(d,e.length).map(c))),this.editData.confirmedPath=o,this.editData.confirmedPathNext=a}const{editData:c,scissors:u}=this,{worldToSlice:d,sliceToWorld:h}=c,{activeHandleIndex:f}=i.handles;if(null==f)i.handles.activeHandleIndex=r;else if(f!==r)throw new Error(`Trying to edit a different handle than the one currently being edited ${r}!==${i.handles.activeHandleIndex}`);const m=d(e);if(m[0]<0||m[0]>=u.width||m[1]<0||m[1]>=u.height)return;o[r]=h(m);const g=u.findPathToPoint(m),v=this.scissorsNext.findPathToPoint(m),y=new C.B;y.prependPath(c.confirmedPath),0!==r&&y.addPoints(g),y.addPoints(v.reverse()),y.appendPath(c.confirmedPathNext),0===r&&y.addPoints(g),c.currentPath=y,n.invalidated=!0,c.hasMoved=!0}renderAnnotation(e,t){return this.updateAnnotation(this.editData?.currentPath),super.renderAnnotation(e,t)}isContourSegmentationTool(){return!1}createAnnotation(e){const t=super.createAnnotation(e),{world:n}=e.detail.currentPoints;return i.utilities.deepMerge(t,{data:{handles:{points:[[...n]]}}})}undo(e,t,n){this.editData&&this._endCallback(n,!0)}renderAnnotationInstance(e){const{annotation:t,enabledElement:n,svgDrawingHelper:r,annotationStyle:i}=e,{viewport:o}=n,{worldToCanvas:s}=o,{annotationUID:l,data:c,highlighted:u}=t,{handles:d}=c,p=this.editData?.newAnnotation,{lineWidth:h,lineDash:f,color:m}=i;if(u||p&&t.annotationUID===this.editData?.annotation?.annotationUID){const e="0",t=d.points.map(s);(0,a.drawHandles)(r,l,e,t,{color:m,lineDash:f,lineWidth:h})}return super.renderAnnotationInstance(e),!0}updateAnnotation(e){if(!this.editData||!e)return;const{annotation:t,sliceToWorld:n,worldToSlice:r,closed:i,newAnnotation:o}=this.editData;let{pointArray:a}=e;a.length>1&&(a=[...a,a[0]]);const s=o&&i?h.i.Clockwise:void 0;this.updateContourPolyline(t,{points:a,closed:i,targetWindingDirection:s},{canvasToWorld:n,worldToCanvas:r})}}T.toolName="LivewireContour";const x=T},51593:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(62709),i=n(32140),o=n(22455);class a extends o.Z{constructor(e){super(r.utilities.deepMerge({configuration:{calculateStats:!1,allowOpenContours:!1}},e))}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const t=e.annotation,{invalidated:n}=t,r=super.renderAnnotationInstance(e);if(n){const{segmentationId:e}=t.data.segmentation;(0,i.triggerSegmentationDataModified)(e)}return r}}a.toolName="PlanarFreehandContourSegmentationTool";const s=a},86479:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n(72076),i=n(62709),o=n(93382),a=n(86614),s=n(36705),l=n(39661),c=n(86785),u=n(33232),d=n(68096),p=n(46966),h=n(79454),f=n(23118),m=n(66878),g=n(15607),v=n(20752);const{transformWorldToIndex:y}=i.utilities;class b extends o.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:C}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,s=(0,i.getEnabledElement)(r),{viewport:l,renderingEngine:c}=s;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,o,d,h),v=l.getFrameOfReferenceUID(),y={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:v,referencedImageId:g},data:{label:"",handles:{points:[[...o]]},cachedStats:{}}};(0,a.addAnnotation)(y,r);const b=(0,p.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:y,newAnnotation:!0,viewportIdsToRender:b},this._activateModify(r),(0,f.hideElementCursor)(r),e.preventDefault(),(0,m.Z)(c,b),y},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:l}=this.editData,{viewportId:c,renderingEngine:u}=(0,i.getEnabledElement)(n);this.eventDispatchDetail={viewportId:c,renderingEngineId:u.id},this._deactivateModify(n),(0,f.resetElementCursor)(n),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,a.removeAnnotation)(r.annotationUID),(0,m.Z)(u,o),l&&(0,s.F$)(r)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,{annotation:a,viewportIdsToRender:s}=this.editData,{data:l}=a;l.handles.points[0]=[...o],a.invalidated=!0;const c=(0,i.getEnabledElement)(r),{renderingEngine:u}=c;(0,m.Z)(u,s)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(e),(0,f.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,i.getEnabledElement)(e);return(0,m.Z)(a,n),r&&(0,s.F$)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{u.SB.isInteractingWithTool=!0,e.addEventListener(d.Events.MOUSE_UP,this._endCallback),e.addEventListener(d.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(d.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(d.Events.TOUCH_END,this._endCallback),e.addEventListener(d.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(d.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{u.SB.isInteractingWithTool=!1,e.removeEventListener(d.Events.MOUSE_UP,this._endCallback),e.removeEventListener(d.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(d.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(d.Events.TOUCH_END,this._endCallback),e.removeEventListener(d.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(d.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:o}=r;let s=(0,a.getAnnotations)(this.getToolName(),o);if(!s?.length)return n;if(s=this.filterInteractableAnnotationsForElement(o,s),!s?.length)return n;const l=this.getTargetId(r),u=r.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let o=0;o<s.length;o++){const a=s[o],p=a.annotationUID,h=a.data,f=h.handles.points[0],m=r.worldToCanvas(f);d.annotationUID=p;const{color:g}=this.getAnnotationStyle({annotation:a,styleSpecifier:d});if(h.cachedStats||(h.cachedStats={}),h.cachedStats[l]&&null!=h.cachedStats[l].value){if(a.invalidated&&(this._calculateCachedStats(a,u,e),r instanceof i.VolumeViewport)){const{referencedImageId:e}=a.metadata;for(const t in h.cachedStats)if(t.startsWith("imageId")){u.getStackViewports().find(t=>{const n=i.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=i.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n})&&delete h.cachedStats[t]}}}else h.cachedStats[l]={Modality:null,index:null,value:null},this._calculateCachedStats(a,u,e);if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const v="0";(0,c.drawHandles)(t,p,v,[m],{color:g}),n=!0;const y=this.getLinkedTextBoxStyle(d,a);if(!y.visibility)continue;const b=this.configuration.getTextLines(h,l);if(b){const e=[m[0]+6,m[1]-6],n="0";(0,c.drawTextBox)(t,p,n,b,[e[0],e[1]],y)}}return n}}isPointNearTool(){return!1}toolSelectedCallback(){}getHandleNearImagePoint(e,t,n,o){const a=(0,i.getEnabledElement)(e),{viewport:s}=a,{data:l}=t,c=l.handles.points[0],u=s.worldToCanvas(c);if(!0===r.K4.distance(n,u)<o)return c}handleSelectedCallback(e,t){const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,p.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o},this._activateModify(r),(0,f.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,m.Z)(s,o),e.preventDefault()}_calculateCachedStats(e,t,n){const r=e.data,{renderingEngineId:o,viewport:a}=n,{element:c}=a,u=r.handles.points[0],{cachedStats:d}=r,p=Object.keys(d);for(let n=0;n<p.length;n++){const r=p[n],h={isPreScaled:(0,v.P)(a,r),isSuvScaled:this.isSuvScaled(a,r,e.metadata.referencedImageId)},f=this.getTargetIdImage(r,t);if(!f)continue;const{dimensions:m,imageData:b,metadata:C}=f,w="getScalarData"in f?f.getScalarData():f.scalarData,E=C.Modality,T=y(b,u).map(Math.round),x=w.length/m[2]/m[1]/m[0];if(i.utilities.indexWithinDimensions(T,m)){this.isHandleOutsideImage=!1;const t=m[0]*x,n=m[0]*m[1]*x,a=T[2]*n+T[1]*t+T[0]*x;let s,c=x>2?[w[a],w[a+1],w[a+2]]:w[a];if(r.startsWith("imageId:")){const e=r.split("imageId:")[1],t=i.utilities.imageIdToURI(e),n=i.utilities.getViewportsWithImageURI(t,o)[0];T[2]=n.getCurrentImageIdIndex()}if("US"===E){const e=(0,l.Sh)(f,[T]),t=e.values.every(e=>null!==e);c=t?e.values:c,s=t?e.units:"raw"}else s=(0,g.F)(E,e.metadata.referencedImageId,h);d[r]={index:T,value:c,Modality:E,modalityUnit:s}}else this.isHandleOutsideImage=!0,d[r]={index:T,Modality:E};e.invalidated=!1,(0,s.hg)(e,c)}return d}}function C(e,t){const n=e.cachedStats[t],{index:r,value:i,modalityUnit:o}=n;if(void 0===i)return;const a=[];if(a.push(`(${r[0]}, ${r[1]}, ${r[2]})`),i instanceof Array&&o instanceof Array)for(let e=0;e<i.length;e++)a.push(`${(0,h.roundNumber)(i[e])} ${o[e]}`);else a.push(`${(0,h.roundNumber)(i)} ${o}`);return a}b.toolName="Probe";const w=b},10279:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var r=n(93382),i=n(62709),o=n(39661),a=n(79454),s=n(90685),l=n(50097),c=n(11163),u=n(41836),d=n(36705),p=n(86785),h=n(33232),f=n(68096),m=n(46966),g=n(81671),v=n(20724),y=n(88582),b=n(23118),C=n(66878),w=n(15607),E=n(20752),T=n(51053);const{transformWorldToIndex:x}=i.utilities;class _ extends r.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:S,statsCalculator:T.BasicStatsCalculator}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:s,renderingEngine:c}=a;this.isDrawing=!0;const u=s.getCamera(),{viewPlaneNormal:d,viewUp:p}=u,h=this.getReferencedImageId(s,o,d,p),f=s.getFrameOfReferenceUID(),g={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...p],FrameOfReferenceUID:f,referencedImageId:h,...s.getViewReference({points:[o]})},data:{label:"",handles:{points:[[...o],[...o],[...o],[...o]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},cachedStats:{}}};(0,l.ud)(g,r);const v=(0,m.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:v,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),(0,b.hideElementCursor)(r),e.preventDefault(),(0,C.Z)(c,v),g},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=a.worldToCanvas(l[0]),u=a.worldToCanvas(l[3]),d=this._getRectangleImageCoordinates([c,u]),p=[n[0],n[1]],{left:h,top:f,width:m,height:v}=d;return g.distanceToPoint([h,f,m,v],p)<=r},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:r}=n;t.highlighted=!0;const o=(0,m.getViewportIdsWithToolToRender)(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1},this._activateModify(r),(0,b.hideElementCursor)(r);const a=(0,i.getEnabledElement)(r),{renderingEngine:s}=a;(0,C.Z)(s,o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex(e=>e===n);const c=(0,m.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o),(0,b.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:d}=u;(0,C.Z)(d,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:a,hasMoved:s}=this.editData,{data:c}=r;if(a&&!s)return;c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,b.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l._x)(r.annotationUID),(0,C.Z)(u,o),a&&(0,d.F$)(r)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world,{points:i}=l.handles;i.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,o=(0,i.getEnabledElement)(n),{worldToCanvas:s,canvasToWorld:c}=o.viewport,u=e.world,{points:d}=l.handles;let p,h,f,m,g,v,y,b;switch(d[a]=[...u],a){case 0:case 3:p=s(d[0]),m=s(d[3]),h=[m[0],p[1]],f=[p[0],m[1]],v=c(h),y=c(f),d[1]=v,d[2]=y;break;case 1:case 2:h=s(d[1]),f=s(d[2]),p=[f[0],h[1]],m=[h[0],f[1]],g=c(p),b=c(m),d[0]=g,d[3]=b}r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,C.Z)(u,o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,b.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,i.getEnabledElement)(e);return(0,C.Z)(a,n),r&&(0,d.F$)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(f.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(f.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._activateModify=e=>{h.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{h.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:o}=r;let a=(0,l.fy)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const s=this.getTargetId(r),d=r.getRenderingEngine(),h={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let o=0;o<a.length;o++){const l=a[o],{annotationUID:f,data:m}=l,{points:g,activeHandleIndex:y}=m.handles,b=g.map(e=>r.worldToCanvas(e));h.annotationUID=f;const{color:C,lineWidth:w,lineDash:E}=this.getAnnotationStyle({annotation:l,styleSpecifier:h}),{viewPlaneNormal:T,viewUp:x}=r.getCamera();if(m.cachedStats[s]&&null!=m.cachedStats[s].areaUnit){if(l.invalidated&&(this._throttledCalculateCachedStats(l,T,x,d,e),r instanceof i.VolumeViewport)){const{referencedImageId:e}=l.metadata;for(const t in m.cachedStats)if(t.startsWith("imageId")){d.getStackViewports().find(t=>{const n=i.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=i.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n})&&delete m.cachedStats[t]}}}else m.cachedStats[s]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(l,T,x,d,e);if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let _;if(!(0,u.isAnnotationVisible)(f))continue;if((0,c.isAnnotationLocked)(l)||this.editData||null===y||(_=[b[y]]),_){const e="0";(0,p.drawHandles)(t,f,e,_,{color:C})}const S=`${f}-rect`,I="0";(0,p.drawRectByCoordinates)(t,f,I,b,{color:C,lineDash:E,lineWidth:w},S),n=!0;const D=this.getLinkedTextBoxStyle(h,l);if(!D.visibility){m.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(m,s);if(!A||0===A.length)continue;if(!m.handles.textBox.hasMoved){const e=(0,v.getTextBoxCoordsCanvas)(b);m.handles.textBox.worldPosition=r.canvasToWorld(e)}const P=r.worldToCanvas(m.handles.textBox.worldPosition),O="1",R=(0,p.drawLinkedTextBox)(t,f,O,A,P,b,{},D),{x:M,y:N,width:L,height:k}=R;m.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([M,N]),topRight:r.canvasToWorld([M+L,N]),bottomLeft:r.canvasToWorld([M,N+k]),bottomRight:r.canvasToWorld([M+L,N+k])}}return n},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this._calculateCachedStats=(e,t,n,r,i)=>{const{data:s}=e,{viewport:l}=i,{element:c}=l,u=s.handles.points[0],p=s.handles.points[3],{cachedStats:h}=s,f=Object.keys(h);for(let i=0;i<f.length;i++){const s=f[i],c=this.getTargetIdImage(s,r);if(!c)continue;const{dimensions:d,imageData:m,metadata:g}=c,v=x(m,u);v[0]=Math.floor(v[0]),v[1]=Math.floor(v[1]),v[2]=Math.floor(v[2]);const b=x(m,p);if(b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]),this._isInsideVolume(v,b,d)){this.isHandleOutsideImage=!1;const r=[[Math.min(v[0],b[0]),Math.max(v[0],b[0])],[Math.min(v[1],b[1]),Math.max(v[1],b[1])],[Math.min(v[2],b[2]),Math.max(v[2],b[2])]],{worldWidth:i,worldHeight:d}=(0,y.Z)(t,n,u,p),f=[v,b],{scale:C,areaUnits:T}=(0,o.mh)(c,f),x=Math.abs(i*d)/(C*C),_={isPreScaled:(0,E.P)(l,s),isSuvScaled:this.isSuvScaled(l,s,e.metadata.referencedImageId)},S=(0,w.F)(g.Modality,e.metadata.referencedImageId,_),I=(0,a.pointInShapeCallback)(m,()=>!0,this.configuration.statsCalculator.statsCallback,r),D=this.configuration.statsCalculator.getStatistics();h[s]={Modality:g.Modality,area:x,mean:D.mean?.value,stdDev:D.stdDev?.value,max:D.max?.value,statsArray:D.array,pointsInShape:I,areaUnit:T,modalityUnit:S}}else this.isHandleOutsideImage=!0,h[s]={Modality:g.Modality}}return e.invalidated=!1,(0,d.hg)(e,c),h},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,s.Z)(this._calculateCachedStats,100,{trailing:!0})}}function S(e,t){const n=e.cachedStats[t],{area:r,mean:i,max:o,stdDev:s,areaUnit:l,modalityUnit:c}=n;if(void 0===i)return;const u=[];return u.push(`Area: ${(0,a.roundNumber)(r)} ${l}`),u.push(`Mean: ${(0,a.roundNumber)(i)} ${c}`),u.push(`Max: ${(0,a.roundNumber)(o)} ${c}`),u.push(`Std Dev: ${(0,a.roundNumber)(s)} ${c}`),u}_.toolName="RectangleROI";const I=_},69316:(e,t,n)=>{"use strict";var r=n(62709),i=n(60650);class o extends i.Z{constructor(e){super(r.utilities.deepMerge({configuration:{calculateStats:!1}},e))}isContourSegmentationTool(){return!0}}o.toolName="SplineContourSegmentationTool"},60650:(e,t,n)=>{"use strict";n.d(t,{Z:()=>A});var r=n(62709),i=n(72076),o=n(86614),a=n(86785),s=n(33232),l=n(68096),c=n(23118),u=n(79454),d=n(19197),p=n(46966),h=n(20724),f=n(46915),m=n(60489);class g{constructor(e){this._controlPoints=[],this._invalidated=!1,this._length=0,this._controlPoints=[],this._resolution=e?.resolution??20,this._fixedResolution=e?.fixedResolution??!1,this._closed=e?.closed??!1,this._invalidated=!0}get controlPoints(){return this._controlPoints}get numControlPoints(){return this._controlPoints.length}get resolution(){return this._resolution}set resolution(e){this._fixedResolution||this._resolution===e||(this._resolution=e,this.invalidated=!0)}get fixedResolution(){return this._fixedResolution}get closed(){return this._closed}set closed(e){this._closed!==e&&(this._closed=e,this.invalidated=!0)}get aabb(){return this._update(),this._aabb}get length(){return this._update(),this._length}get invalidated(){return this._invalidated}set invalidated(e){this._invalidated=e}hasTangentPoints(){return!1}addControlPoint(e){this._controlPoints.push([e[0],e[1]]),this.invalidated=!0}addControlPoints(e){e.forEach(e=>this.addControlPoint(e))}addControlPointAtU(e){const t=this._getLineSegmentAt(e),{start:n,end:r}=t.points,i=Math.floor(e),o=this._curveSegments[i],a=e-Math.floor(i),s=[n[0]+a*(r[0]-n[0]),n[1]+a*(r[1]-n[1])],l=this._controlPoints.indexOf(o.controlPoints.p1)+1;return this._controlPoints.splice(l,0,s),this.invalidated=!0,{index:l,point:s}}deleteControlPointByIndex(e){const t=this._closed?3:1;return e>=0&&e<this._controlPoints.length&&this._controlPoints.length>t&&(this._controlPoints.splice(e,1),this.invalidated=!0,!0)}clearControlPoints(){this._controlPoints=[],this.invalidated=!0}setControlPoints(e){this.clearControlPoints(),this.addControlPoints(e)}updateControlPoint(e,t){if(e<0||e>=this._controlPoints.length)throw new Error("Index out of bounds");this._controlPoints[e]=[...t],this.invalidated=!0}getControlPoints(){return this._controlPoints.map(e=>[e[0],e[1]])}getClosestControlPoint(e){const t=this._controlPoints;let n=1/0,r=-1;for(let i=0,o=t.length;i<o;i++){const o=t[i],a=e[0]-o[0],s=e[1]-o[1],l=a*a+s*s;l<n&&(n=l,r=i)}return{index:r,point:-1===r?void 0:[...t[r]],distance:Math.sqrt(n)}}getClosestControlPointWithinDistance(e,t){const n=this.getClosestControlPoint(e);return n.distance<=t?n:void 0}getClosestPoint(e){this._update();const t=this._getCurveSegmmentsDistanceSquaredInfo(e);if(!t.length)return;let n;t.sort((e,t)=>e.distanceSquared-t.distanceSquared);let r,i,o=-1,a=1/0;for(let s=0;s<t.length;s++){const l=t[s];if(l.distanceSquared>a)continue;const{curveSegmentIndex:c,curveSegment:u}=l,{lineSegments:d}=u;for(let t=0;t<d.length;t++){const s=d[t],{point:u,distanceSquared:p}=m.lineSegment.distanceToPointSquaredInfo(s.points.start,s.points.end,e);p<a&&(i=s,o=c,r=l.curveSegment,n=u,a=p)}}return{point:n,uValue:o+(i.previousLineSegmentsLength+m.point.distanceToPoint(i.points.start,n))/r.length,distance:Math.sqrt(a)}}getClosestPointOnControlPointLines(e){const t=[...this._controlPoints];if(this._closed&&t.push(this._controlPoints[0]),!t.length)return;let n,r=1/0,i=t[0];for(let o=1,a=t.length;o<a;o++){const a=t[o],{point:s,distanceSquared:l}=m.lineSegment.distanceToPointSquaredInfo(i,a,e);l<r&&(n=s,r=l),i=a}return{point:n,distance:Math.sqrt(r)}}getPolylinePoints(){return this._update(),this._convertCurveSegmentsToPolyline(this._curveSegments)}getPreviewPolylinePoints(e,t){if(this._closed)return[];this._update();const n=this.getClosestControlPointWithinDistance(e,t),r=0===n?.index,i=this.getPreviewCurveSegments(e,r);return i?.length?this._convertCurveSegmentsToPolyline(i):[]}isPointNearCurve(e,t){this._update();const n=this._getCurveSegmmentsWithinDistance(e,t),r=t*t;for(let t=0;t<n.length;t++){const{lineSegments:i}=n[t];for(let t=0;t<i.length;t++){const n=i[t];if(m.lineSegment.distanceToPointSquared(n.points.start,n.points.end,e)<=r)return!0}}return!1}containsPoint(e){this._update();if(this._controlPoints.length<3)return!1;const t=[...this._curveSegments],n=this._getClosingCurveSegmentWithStraightLineSegment();n&&t.push(n);let r=0;for(let n=0;n<t.length;n++){const i=t[n],{aabb:o}=i;if(!(e[0]<=o.maxX&&e[1]>=o.minY&&e[1]<o.maxY))continue;const{lineSegments:a}=i;for(let t=0;t<a.length;t++){const n=a[t],{aabb:i}=n;if(e[0]<=i.maxX&&e[1]>=i.minY&&e[1]<i.maxY){const{start:t,end:i}=n.points,o=t[0]===i[0],a=(e[1]-t[1])*(i[0]-t[0])/(i[1]-t[1])+t[0];r+=o||e[0]<=a?1:0}}}return r%2==1}_update(){if(!this._invalidated)return;const e=this.getSplineCurves();let t=0,n=1/0,r=1/0,i=-1/0,o=-1/0;for(let a=0,s=e.length;a<s;a++){const{aabb:s,length:l}=e[a];n=n<=s.minX?n:s.minX,r=r<=s.minY?r:s.minY,i=i>=s.maxX?i:s.maxX,o=o>=s.maxY?o:s.maxY,t+=l}this._curveSegments=e,this._aabb={minX:n,minY:r,maxX:i,maxY:o},this._length=t,this._invalidated=!1}_convertCurveSegmentsToPolyline(e){this._update();const t=[];return e.forEach(({lineSegments:e},n)=>{e.forEach((e,r)=>{0===n&&0===r&&t.push([...e.points.start]),t.push([...e.points.end])})}),t}_getCurveSegmmentsDistanceSquaredInfo(e){this._update();const t=[],{_curveSegments:n}=this;for(let r=0;r<n.length;r++){const i=n[r],o=m.aabb.distanceToPointSquared(i.aabb,e);t.push({curveSegmentIndex:r,curveSegment:i,distanceSquared:o})}return t}_getCurveSegmmentsWithinDistance(e,t){this._update();const n=t*t;if(m.aabb.distanceToPointSquared(this.aabb,e)>n)return[];const r=this._getCurveSegmmentsDistanceSquaredInfo(e),i=[];for(let e=0,t=r.length;e<t;e++){const{curveSegment:t,distanceSquared:o}=r[e];o<=n&&i.push(t)}return i}_getLineSegmentAt(e){this._update();const t=Math.floor(e),n=e-t,r=this._curveSegments[t],{lineSegments:i}=r,o=r.length*n;for(let e=0;e<i.length;e++){const t=i[e],n=t.previousLineSegmentsLength+t.length;if(o>=t.previousLineSegmentsLength&&o<=n)return t}}_getClosingCurveSegmentWithStraightLineSegment(){if(this.closed)return;const e=this._controlPoints,t=e[0],n=e[e.length-1],r={points:{start:[...t],end:[...n]},aabb:{minX:Math.min(t[0],n[0]),minY:Math.min(t[1],n[1]),maxX:Math.max(t[0],n[0]),maxY:Math.max(t[1],n[1])}};return{aabb:{minX:r.aabb.minX,minY:r.aabb.minY,maxX:r.aabb.maxX,maxY:r.aabb.maxY},lineSegments:[r]}}}class v extends g{getPreviewCurveSegments(e,t){const n=this._getNumCurveSegments()+1,r=Math.max(0,n-2),i=t?n:n-1,o=this.getTransformMatrix(),a=[...this.controlPoints],s=[];t||a.push(e);for(let e=r;e<=i;e++){const n=this._getCurveSegment(e,o,a,t);s.push(n)}return s}getSplineCurves(){const e=this._getNumCurveSegments(),t=new Array(e);if(e<=0)return[];const n=this.getTransformMatrix();let r=0;for(let i=0;i<e;i++){const e=this._getCurveSegment(i,n);e.previousCurveSegmentsLength=r,t[i]=e,r+=e.length}return t}_getNumCurveSegments(e=this.controlPoints,t=this.closed){return t?e.length:Math.max(0,e.length-1)}_getPoint(e,t,n=this.controlPoints,r=this.closed){const o=this._getNumCurveSegments(n,r),a=Math.floor(e);let s=a%o;const l=e-a;if(s<0||s>=o){if(!this.closed)return;s=(o+s)%o}const{p0:c,p1:u,p2:d,p3:p}=this._getCurveSegmentPoints(s,n,r),h=l*l,f=h*l,m=i.vh.fromValues(1,l,h,f),g=i.vh.transformMat4(i.vh.create(),m,t);return[i.vh.dot(g,i.vh.fromValues(c[0],u[0],d[0],p[0])),i.vh.dot(g,i.vh.fromValues(c[1],u[1],d[1],p[1]))]}_getCurveSegmentPoints(e,t=this.controlPoints,n=this.closed){const r=this._getNumCurveSegments(t,n),i=e-1,o=n?(e+1)%r:e+1,a=o+1,s=t[e],l=t[o];let c,u;return c=i>=0?t[i]:n?t[t.length-1]:m.point.mirror(l,s),u=a<t.length?t[a]:n?t[0]:m.point.mirror(s,l),{p0:c,p1:s,p2:l,p3:u}}_getLineSegments(e,t,n=this.controlPoints,r=this.closed){const i=this._getNumCurveSegments(n,r),o=this.resolution+1,a=1/o;let s=e+1;r||e!==i-1||(s-=1e-8);const l=[];let c,u,d=0;for(let i=0,p=e;i<=o;i++,p+=a){p=p>s?s:p;const e=this._getPoint(p,t,n,r);if(!i){c=e;continue}u=e;const o=u[0]-c[0],a=u[1]-c[1],h=Math.sqrt(o**2+a**2),f={minX:c[0]<=u[0]?c[0]:u[0],maxX:c[0]>=u[0]?c[0]:u[0],minY:c[1]<=u[1]?c[1]:u[1],maxY:c[1]>=u[1]?c[1]:u[1]};l.push({points:{start:c,end:u},aabb:f,length:h,previousLineSegmentsLength:d}),c=u,d+=h}return l}_getCurveSegment(e,t=this.getTransformMatrix(),n=this.controlPoints,r=this.closed){const{p0:i,p1:o,p2:a,p3:s}=this._getCurveSegmentPoints(e,n,r),l=this._getLineSegments(e,t,n,r);let c=0,u=1/0,d=1/0,p=-1/0,h=-1/0;return l.forEach(({aabb:e,length:t})=>{u=Math.min(u,e.minX),d=Math.min(d,e.minY),p=Math.max(p,e.maxX),h=Math.max(h,e.maxY),c+=t}),{controlPoints:{p0:i,p1:o,p2:a,p3:s},aabb:{minX:u,minY:d,maxX:p,maxY:h},length:c,previousCurveSegmentsLength:0,lineSegments:l}}}class y extends v{constructor(e){super(e),this._scale=e?.scale??.5,this._fixedScale=e?.fixedScale??!1}get scale(){return this._scale}set scale(e){this._fixedScale||this._scale===e||(this._scale=e,this.invalidated=!0)}get fixedScale(){return this._fixedScale}getTransformMatrix(){const{scale:e}=this,t=2*e;return[0,1,0,0,-e,0,e,0,t,e-3,3-t,-e,-e,2-e,e-2,e]}}class b extends y{constructor(){super({resolution:0,fixedResolution:!0,scale:0,fixedScale:!0})}}class C extends y{constructor(){super({scale:.5,fixedScale:!0})}}const w=i._E.multiplyScalar(i._E.create(),i._E.fromValues(1,4,1,0,-3,0,3,0,3,-6,3,0,-1,3,-3,1),1/6);class E extends v{getTransformMatrix(){return w}}var T=n(22955);const x={resolution:20,controlPointAdditionDistance:6,controlPointDeletionDistance:6,showControlPointsConnectors:!1,controlPointAdditionEnabled:!0,controlPointDeletionEnabled:!0};var _,S;!function(e){e.Cardinal="CARDINAL",e.Linear="LINEAR",e.CatmullRom="CATMULLROM",e.BSpline="BSPLINE"}(_||(_={})),function(e){e.AddControlPoint="addControlPoint",e.DeleteControlPoint="deleteControlPoint"}(S||(S={}));class I extends T.Z{static{this.SplineTypes=_}static{this.Actions=S}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:D,contourHoleAdditionModifierKey:l.KeyboardBindings.Shift,decimate:{enabled:!1,epsilon:.1},spline:{configuration:{[_.Cardinal]:{Class:y,scale:.5},[_.CatmullRom]:{Class:C},[_.Linear]:{Class:b},[_.BSpline]:{Class:E,controlPointAdditionEnabled:!1,controlPointDeletionEnabled:!1,showControlPointsConnectors:!0}},type:_.CatmullRom,drawPreviewEnabled:!0,lastControlPointDeletionKeys:["Backspace","Delete"]},actions:{[S.AddControlPoint]:{method:"addControlPointCallback",bindings:[{mouseButton:l.MouseBindings.Primary,modifierKey:l.KeyboardBindings.Shift}]},[S.DeleteControlPoint]:{method:"deleteControlPointCallback",bindings:[{mouseButton:l.MouseBindings.Primary,modifierKey:l.KeyboardBindings.Ctrl}]}}}}){super(e,t),this.isHandleOutsideImage=!1,this.fireChangeOnUpdate=null,this.isPointNearTool=(e,t,n,r)=>{const{instance:i}=t.data.spline;return i.isPointNearCurve(n,r)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n;t.highlighted=!0;const o=(0,p.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:o,movingTextBox:!1};const a=(0,r.getEnabledElement)(i),{renderingEngine:s}=a;this._activateModify(i),(0,u.triggerAnnotationRenderForViewportIds)(s,o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const i=e.detail,{element:o}=i,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex(e=>e===n)}const c=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(o);const d=(0,r.getEnabledElement)(o),{renderingEngine:h}=d;(0,u.triggerAnnotationRenderForViewportIds)(h,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:a,newAnnotation:s,contourHoleProcessingEnabled:d}=this.editData,{data:p}=i;i.autoGenerated=!1,p.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,c.resetElementCursor)(n);const h=(0,r.getEnabledElement)(n),{renderingEngine:f}=h,m=this.getTargetIdImage(this.getTargetId(h.viewport),h.renderingEngine),{imageData:g,dimensions:v}=m;this.isHandleOutsideImage=p.handles.points.map(e=>r.utilities.transformWorldToIndex(g,e)).some(e=>!r.utilities.indexWithinDimensions(e,v)),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,o.removeAnnotation)(i.annotationUID);const y=s?l.ChangeTypes.Completed:l.ChangeTypes.HandlesUpdated;this.fireChangeOnUpdate?(this.fireChangeOnUpdate.annotationUID=i.annotationUID,this.fireChangeOnUpdate.changeType=y):this.fireChangeOnUpdate={annotationUID:i.annotationUID,changeType:y,contourHoleProcessingEnabled:d},(0,u.triggerAnnotationRenderForViewportIds)(f,a),this.editData=null,this.isDrawing=!1},this._keyDownCallback=e=>{const t=e.detail,{element:n}=t,r=t.key??"",{lastControlPointDeletionKeys:i}=this.configuration.spline;if(!i.includes(r))return;const{annotation:o}=this.editData,{data:a}=o;if(3!==a.handles.points.length){{const e=a.handles.points.length-1;this._deleteControlPointByIndex(n,o,e)}e.preventDefault()}else this.cancel(n)},this._mouseMoveCallback=e=>{const{drawPreviewEnabled:t}=this.configuration.spline;if(!t)return;const{element:n}=e.detail,{renderingEngine:i}=(0,r.getEnabledElement)(n),o=(0,p.getViewportIdsWithToolToRender)(n,this.getToolName());this.editData.lastCanvasPoint=e.detail.currentPoints.canvas,(0,u.triggerAnnotationRenderForViewportIds)(i,o),e.preventDefault()},this._mouseDownCallback=e=>{const t=e.type===l.Events.MOUSE_DOUBLE_CLICK,{annotation:n,viewportIdsToRender:i}=this.editData,{data:o}=n;if(o.contour.closed)return;const a=e.detail,{element:s}=a,{currentPoints:c}=a,{canvas:d,world:p}=c,h=(0,r.getEnabledElement)(s),{renderingEngine:f}=h;let m=o.handles.points.length>=2&&t,g=!0;if(o.handles.points.length>=3){const{instance:e}=o.spline,t=e.getClosestControlPointWithinDistance(d,10);0===t?.index&&(g=!1,m=!0)}g&&o.handles.points.push(p),o.contour.closed=o.contour.closed||m,n.invalidated=!0,(0,u.triggerAnnotationRenderForViewportIds)(f,i),o.contour.closed&&this._endCallback(e),e.preventDefault()},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=i;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;this.moveAnnotation(i,n)}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],i.invalidated=!0}this.editData.hasMoved=!0;const c=(0,r.getEnabledElement)(n),{renderingEngine:d}=c;(0,u.triggerAnnotationRenderForViewportIds)(d,o)},this.triggerAnnotationCompleted=(e,t)=>{const n=l.Events.ANNOTATION_COMPLETED,i={annotation:e,changeType:l.ChangeTypes.Completed,contourHoleProcessingEnabled:t};(0,r.triggerEvent)(r.eventTarget,n,i)},this.triggerAnnotationModified=(e,t,n=l.ChangeTypes.StatsUpdated)=>{const{viewportId:i,renderingEngineId:o}=t,a=l.Events.ANNOTATION_MODIFIED,s={annotation:e,viewportId:i,renderingEngineId:o,changeType:n};(0,r.triggerEvent)(r.eventTarget,a,s)},this.triggerChangeEvent=(e,t,n=l.ChangeTypes.StatsUpdated,r)=>{n===l.ChangeTypes.Completed?this.triggerAnnotationCompleted(e,r):this.triggerAnnotationModified(e,t,n)},this._activateModify=e=>{s.SB.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{s.SB.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{s.SB.isInteractingWithTool=!0,e.addEventListener(l.Events.KEY_DOWN,this._keyDownCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.addEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.addEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.addEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=e=>{s.SB.isInteractingWithTool=!1,e.removeEventListener(l.Events.KEY_DOWN,this._keyDownCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.removeEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.removeEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)},this._renderStats=(e,t,n,r)=>{const i=e.data,o=this.getTargetId(t);if(!i.spline.instance.closed||!r.visibility)return;const s=this.configuration.getTextLines(i,o);if(!s||0===s.length)return;const l=i.handles.points.map(e=>t.worldToCanvas(e));if(!i.handles.textBox.hasMoved){const e=(0,h.getTextBoxCoordsCanvas)(l);i.handles.textBox.worldPosition=t.canvasToWorld(e)}const c=t.worldToCanvas(i.handles.textBox.worldPosition),u=(0,a.drawLinkedTextBox)(n,e.annotationUID??"","textBox",s,c,l,{},r),{x:d,y:p,width:f,height:m}=u;i.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([d,p]),topRight:t.canvasToWorld([d+f,p]),bottomLeft:t.canvasToWorld([d,p+m]),bottomRight:t.canvasToWorld([d+f,p+m])}},this.addControlPointCallback=(e,t)=>{const{data:n}=t,i=n.spline.type,o=this._getSplineConfig(i),a=o.controlPointAdditionDistance;if(!1===o.controlPointAdditionEnabled)return;const s=e.detail,{element:l}=s,c=(0,r.getEnabledElement)(l),{renderingEngine:d,viewport:h}=c,{canvasToWorld:f}=h,{instance:m}=n.spline,g=e.detail.currentPoints.canvas,v=m.getClosestPoint(g);if(v.distance>a)return;const{index:y,point:b}=m.addControlPointAtU(v.uValue);n.handles.points.splice(y,0,f(b)),t.invalidated=!0;const C=(0,p.getViewportIdsWithToolToRender)(l,this.getToolName());(0,u.triggerAnnotationRenderForViewportIds)(d,C)},this.deleteControlPointCallback=(e,t)=>{const n=t.data.spline.type,r=this._getSplineConfig(n),i=r.controlPointDeletionDistance;if(!1===r.controlPointDeletionEnabled)return;const o=e.detail,{element:a,currentPoints:s}=o,{canvas:l}=s,{instance:c}=t.data.spline,u=c.getClosestControlPointWithinDistance(l,i);u&&this._deleteControlPointByIndex(a,t,u.index)},this._calculateCachedStats=(e,t)=>{if(!this.configuration.calculateStats)return;const n=e.data;if(!n.contour.closed)return;const o=(0,r.getEnabledElement)(t),{viewport:a,renderingEngine:s}=o,{cachedStats:c}=n,{polyline:d}=n.contour,p=Object.keys(c);for(let e=0;e<p.length;e++){const t=p[e],n=this.getTargetIdImage(t,s);if(!n)continue;const{metadata:o}=n,l=d.map(e=>a.worldToCanvas(e)),h=l[0],f=a.canvasToWorld(h),m=a.canvasToWorld([h[0]+1,h[1]]),g=a.canvasToWorld([h[0],h[1]+1]),v=i.R3.distance(f,m),y=i.R3.distance(f,g),{imageData:b}=n,{scale:C,areaUnits:w}=(0,u.getCalibratedLengthUnitsAndScale)(n,()=>{const{maxX:e,maxY:t,minX:n,minY:i}=u.math.polyline.getAABB(l),o=a.canvasToWorld([n,i]),s=r.utilities.transformWorldToIndex(b,o),c=a.canvasToWorld([e,t]);return[s,r.utilities.transformWorldToIndex(b,c)]});let E=u.math.polyline.getArea(l)/C/C;E*=v*y,c[t]={Modality:o.Modality,area:E,areaUnit:w}}return this.triggerAnnotationModified(e,o,l.ChangeTypes.StatsUpdated),c},this._throttledCalculateCachedStats=(0,u.throttle)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:i}=t,{canvas:o}=n,a=(0,d.Z)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey,s=(0,r.getEnabledElement)(i),{renderingEngine:l}=s,c=this.createAnnotation(e);this.isDrawing=!0,this.addAnnotation(c,i);const h=(0,p.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:c,viewportIdsToRender:h,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,lastCanvasPoint:o,contourHoleProcessingEnabled:a},this._activateDraw(i),e.preventDefault(),(0,u.triggerAnnotationRenderForViewportIds)(l,h),c}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,c.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData;i&&(0,o.removeAnnotation)(t.annotationUID),super.cancelAnnotation(t);const a=(0,r.getEnabledElement)(e),{renderingEngine:s}=a;return(0,u.triggerAnnotationRenderForViewportIds)(s,n),this.editData=null,t.annotationUID}isContourSegmentationTool(){return!1}renderAnnotationInstance(e){const{enabledElement:t,targetId:n,svgDrawingHelper:r,annotationStyle:i}=e,{viewport:s}=t,{worldToCanvas:l}=s,{element:c}=s,u=e.annotation,{annotationUID:d,data:p,highlighted:h}=u,{handles:m}=p,{points:g,activeHandleIndex:v}=m,y=this.editData?.newAnnotation,{lineWidth:b,lineDash:C,color:w,locked:E}=i,T=g.map(e=>l(e)),{drawPreviewEnabled:x}=this.configuration.spline,_=u.data.spline.type,S=this._getSplineConfig(_),I=u.data.spline.instance,D=(0,o.getChildAnnotations)(u);if(-1!==D.findIndex(e=>!e))throw new Error(`Can't find annotation for child ${u.childAnnotationUIDs.join()}`);let A;if([u,...D].filter(e=>this._isSplineROIAnnotation(e)).forEach(e=>{const t=this._updateSplineInstance(c,e).getPolylinePoints();this.updateContourPolyline(e,{points:t,closed:p.contour.closed,targetWindingDirection:f.i.Clockwise},s)}),super.renderAnnotationInstance(e),p.cachedStats[n]&&null!=p.cachedStats[n].areaUnit?u.invalidated&&this._throttledCalculateCachedStats(u,c):(p.cachedStats[n]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(u,c)),E||this.editData||null===v||(A=[T[v]]),A||y||h){const e="0";(0,a.drawHandles)(r,d,e,T,{color:w,lineWidth:Math.max(1,b),handleRadius:"3"})}if(x&&I.numControlPoints>1&&this.editData?.lastCanvasPoint&&!I.closed){const{lastCanvasPoint:e}=this.editData,t=I.getPreviewPolylinePoints(e,10);(0,a.drawPolyline)(r,d,"previewSplineChange",t,{color:"#9EA0CA",lineDash:C,lineWidth:1})}if(S.showControlPointsConnectors){const e=[...T];I.closed&&e.push(T[0]),(0,a.drawPolyline)(r,d,"controlPointsConnectors",e,{color:"rgba(255, 255, 255, 0.5)",lineWidth:1})}return this._renderStats(u,s,r,i.textbox),this.fireChangeOnUpdate?.annotationUID===d&&(this.triggerChangeEvent(u,t,this.fireChangeOnUpdate.changeType,this.fireChangeOnUpdate.contourHoleProcessingEnabled),this.fireChangeOnUpdate=null),u.invalidated=!1,!0}createInterpolatedSplineControl(e){if(e.data.handles.points?.length)return;const{polyline:t}=e.data.contour;if(!t||!t.length)return;e.data.handles.points=[];const{points:n}=e.data.handles,r=Math.max(10,Math.floor(t.length/20));for(let e=0;e<t.length-r;e+=r)n.push(t[e]);n.push(t[t.length-1])}createAnnotation(e){const t=super.createAnnotation(e),{world:n}=e.detail.currentPoints,{type:i}=this.configuration.spline,o=this._getSplineConfig(i),a=new o.Class,s=()=>({type:o.type,instance:a,resolution:o.resolution});let l;return this.configuration.interpolation?.enabled&&(l=e=>{e.data.spline||=s(),this.createInterpolatedSplineControl(e)}),r.utilities.deepMerge(t,{data:{handles:{points:[[...n]]},spline:s(),cachedStats:{}},onInterpolationComplete:l})}_deleteControlPointByIndex(e,t,n){const i=(0,r.getEnabledElement)(e),{points:a}=t.data.handles;3===a.length?(0,o.removeAnnotation)(t.annotationUID):a.splice(n,1);const{renderingEngine:s}=i,l=(0,p.getViewportIdsWithToolToRender)(e,this.getToolName());t.invalidated=!0,(0,u.triggerAnnotationRenderForViewportIds)(s,l)}_isSplineROIAnnotation(e){return!!e.data?.spline}_getSplineConfig(e){const{configuration:t}=this,n=t.spline.configuration;return Object.assign({type:e},x,n[e])}_updateSplineInstance(e,t){const n=(0,r.getEnabledElement)(e),{viewport:i}=n,{worldToCanvas:o}=i,{data:a}=t,{type:s,instance:l}=t.data.spline,c=this._getSplineConfig(s),u=a.handles.points.map(o),d=void 0!==c.resolution?parseInt(c.resolution):void 0,p=void 0!==c.scale?parseFloat(c.scale):void 0;return l.setControlPoints(u),l.closed=!!a.contour.closed,l.fixedResolution||void 0===d||l.resolution===d||(l.resolution=d,t.invalidated=!0),l instanceof y&&!l.fixedScale&&void 0!==p&&l.scale!==p&&(l.scale=p,t.invalidated=!0),l}}function D(e,t){const n=e.cachedStats[t],{area:r,isEmptyArea:i,areaUnit:o}=n,a=[];if(r){const e=i?"Area: Oblique not supported":`Area: ${(0,u.roundNumber)(r)} ${o}`;a.push(e)}return a}I.toolName="SplineROI";const A=I},28073:(e,t,n)=>{"use strict";var r=n(68096),i=n(62709),o=n(93382),a=n(90685),s=n(86614),l=n(36705),c=n(86785),u=n(33232),d=n(46966),p=n(79454),h=n(74474),f=n(66878),m=n(23118),g=n(39661);const{transformWorldToIndex:v}=i.utilities;class y extends o.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:b,displayBothAxesDistances:!1}}){super(e,t),this.addNewAnnotation=e=>{if(this.startedDrawing)return;this.startedDrawing=!0;const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:l,renderingEngine:c}=a;if(!(l instanceof i.StackViewport))throw new Error("UltrasoundDirectionalTool can only be used on a StackViewport");(0,m.hideElementCursor)(r),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:p,viewUp:h}=u,g=this.getReferencedImageId(l,o,p,h),v=l.getFrameOfReferenceUID(),y={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...p],viewUp:[...h],FrameOfReferenceUID:v,referencedImageId:g},data:{handles:{points:[[...o],[...o]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,s.addAnnotation)(y,r);const b=(0,d.getViewportIdsWithToolToRender)(r,this.getToolName());return this.editData={annotation:y,viewportIdsToRender:b,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),e.preventDefault(),(0,f.Z)(c,b),y},this.isPointNearTool=(e,t,n,r)=>!1,this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,newAnnotation:a,hasMoved:c}=this.editData,{data:u}=r;if(a&&!c)return;if(this.startedDrawing&&1===u.handles.points.length)return void(this.editData.handleIndex=1);this.startedDrawing=!1,u.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,m.resetElementCursor)(n);const d=(0,i.getEnabledElement)(n),{renderingEngine:p}=d;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(r.annotationUID),(0,f.Z)(p,o),a&&(0,l.F$)(r),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportIdsToRender:o,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=r;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:r}=l.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],r.invalidated=!0}this.editData.hasMoved=!0;const c=(0,i.getEnabledElement)(n),{renderingEngine:u}=c;(0,f.Z)(u,o)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,m.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:r}=this.editData,{data:o}=t;t.highlighted=!1,o.handles.activeHandleIndex=null;const a=(0,i.getEnabledElement)(e),{renderingEngine:s}=a;return(0,f.Z)(s,n),r&&(0,l.F$)(t),this.editData=null,this.startedDrawing=!1,t.annotationUID}},this._activateModify=e=>{u.SB.isInteractingWithTool=!0,e.addEventListener(r.Events.MOUSE_UP,this._endCallback),e.addEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(r.Events.TOUCH_TAP,this._endCallback),e.addEventListener(r.Events.TOUCH_END,this._endCallback),e.addEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{u.SB.isInteractingWithTool=!1,e.removeEventListener(r.Events.MOUSE_UP,this._endCallback),e.removeEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(r.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(r.Events.TOUCH_END,this._endCallback),e.removeEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this._activateDraw=e=>{u.SB.isInteractingWithTool=!0,e.addEventListener(r.Events.MOUSE_UP,this._endCallback),e.addEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(r.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(r.Events.TOUCH_TAP,this._endCallback),e.addEventListener(r.Events.TOUCH_END,this._endCallback),e.addEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{u.SB.isInteractingWithTool=!1,e.removeEventListener(r.Events.MOUSE_UP,this._endCallback),e.removeEventListener(r.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(r.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(r.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(r.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(r.Events.TOUCH_END,this._endCallback),e.removeEventListener(r.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,{element:i}=r;let o=(0,s.getAnnotations)(this.getToolName(),i);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(i,o),!o?.length)return n;const a=this.getTargetId(r),l=r.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<o.length;i++){const s=o[i],{annotationUID:d,data:p}=s,{points:h}=p.handles;u.annotationUID=d;const f=this.getStyle("color",u,s),m=h.map(e=>r.worldToCanvas(e));if(p.cachedStats[a]&&null!=p.cachedStats[a].xValues?s.invalidated&&this._throttledCalculateCachedStats(s,l,e):(p.cachedStats[a]={xValues:[0,0],yValues:[0,0],isHorizontal:!1,units:[""],isUnitless:!1},this._calculateCachedStats(s,l,e)),!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let g="0";if((0,c.drawHandle)(t,d,g,m[0],{color:f},0),n=!0,2!==m.length)return n;g="1",(0,c.drawHandle)(t,d,g,m[1],{color:f},1);if(p.cachedStats[a].isUnitless){const e=`${d}-line-1`,n="1";(0,c.drawLine)(t,d,n,m[0],m[1],{color:f,width:1,shadow:this.configuration.shadow},e)}else{const e=m[0],n=m[1],r=n[1]-e[1],i=n[0]-e[0];let o=[0,0];o=p.cachedStats[a].isHorizontal?[e[0]+i,e[1]]:[e[0],e[1]+r];let s=`${d}-line-1`,l="1";(0,c.drawLine)(t,d,l,m[0],o,{color:f,width:1,shadow:this.configuration.shadow},s),s=`${d}-line-2`,l="2",(0,c.drawLine)(t,d,l,m[1],o,{color:f,width:1,lineDash:[1,1],shadow:this.configuration.shadow},s)}const v=this.getLinkedTextBoxStyle(u,s);if(!v.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const y=this.configuration.getTextLines(p,a,this.configuration);if(!p.handles.textBox.hasMoved){const e=m[1];p.handles.textBox.worldPosition=r.canvasToWorld(e)}const b=r.worldToCanvas(p.handles.textBox.worldPosition),C="1",w=(0,c.drawLinkedTextBox)(t,d,C,y,b,m,{},v),{x:E,y:T,width:x,height:_}=w;p.handles.textBox.worldBoundingBox={topLeft:r.canvasToWorld([E,T]),topRight:r.canvasToWorld([E+x,T]),bottomLeft:r.canvasToWorld([E,T+_]),bottomRight:r.canvasToWorld([E+x,T+_])}}return n},this._throttledCalculateCachedStats=(0,a.Z)(this._calculateCachedStats,100,{trailing:!0})}toolSelectedCallback(e,t,n,r){}handleSelectedCallback(e,t,n){const r=e.detail,{element:o}=r,{data:a}=t;t.highlighted=!0;const s=(0,d.getViewportIdsWithToolToRender)(o,this.getToolName());let l,c=!1;n.worldPosition?c=!0:l=a.handles.points.findIndex(e=>e===n),this.editData={handleIndex:l,annotation:t,viewportIdsToRender:s},this._activateModify(o),(0,m.hideElementCursor)(o);const u=(0,i.getEnabledElement)(o),{renderingEngine:p}=u;(0,f.Z)(p,s),e.preventDefault()}_calculateCachedStats(e,t,n){const r=e.data,{element:i}=n.viewport;if(2!==r.handles.points.length)return;const{cachedStats:o}=r,a=Object.keys(o);for(let e=0;e<a.length;e++){const i=a[e],s=this.getTargetIdImage(i,t);if(!s)continue;const{imageData:l}=s,c=r.handles.points[0],u=r.handles.points[1],d=v(l,c),p=v(l,u),{values:f,units:m}=(0,g.Sh)(s,[d]),{values:y,units:b}=(0,g.Sh)(s,[p]);let C,w,E,T,x=!1;if(m[0]!==b[0]||m[1]!==b[1]||"raw"===m[0]&&"raw"===b[0]){const e=(0,h.distanceToPoint)(c,u);C=[e,0],w=[e,0],E=["px"],x=!0}else{const e=n.viewport.worldToCanvas(c),t=n.viewport.worldToCanvas(u),r=t[1]-e[1],i=t[0]-e[0];T=Math.abs(i)>Math.abs(r),C=[f[0],y[0]],w=[f[1],y[1]],E=[m[0],m[1]]}o[i]={xValues:C,yValues:w,isHorizontal:T,units:E,isUnitless:x}}return e.invalidated=!1,(0,l.hg)(e,i),o}}function b(e,t,n){const r=e.cachedStats[t],{xValues:i,yValues:o,units:a,isUnitless:s,isHorizontal:l}=r;if(s)return[`${(0,p.roundNumber)(i[0])} px`];if(n.displayBothAxesDistances){const e=Math.abs(i[1]-i[0]),t=Math.abs(o[1]-o[0]);return[`${(0,p.roundNumber)(e)} ${a[0]}`,`${(0,p.roundNumber)(t)} ${a[1]}`]}if(l){const e=Math.abs(i[1]-i[0]);return[`${(0,p.roundNumber)(e)} ${a[0]}`]}{const e=Math.abs(o[1]-o[0]);return[`${(0,p.roundNumber)(e)} ${a[1]}`]}}y.toolName="UltrasoundDirectionalTool"},51948:(e,t,n)=>{"use strict";var r=n(72076),i=n(62709),o=n(93382),a=n(90685),s=n(50097),l=n(86785),c=n(33232),u=n(68096),d=n(46966),p=n(81671),h=n(23118),f=n(66878),m=n(21259);class g extends o.A8{constructor(e={}){super(e,{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:r}=t,o=n.world,a=(0,i.getEnabledElement)(r),{viewport:l,renderingEngine:c}=a;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:p,viewUp:m}=u,g=this.getReferencedImageId(l,o,p,m),v={metadata:{viewPlaneNormal:[0,0,1],viewUp:[0,1,0],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:g,toolName:this.getToolName()},data:{invalidated:!0,handles:{points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null},cachedStats:{},active:!0}};(0,s.ud)(v,r);const y=(0,d.getViewportIdsWithToolToRender)(r,this.getToolName(),!1);return this.editData={annotation:v,viewportUIDsToRender:y,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),(0,h.hideElementCursor)(r),e.preventDefault(),(0,f.Z)(c,y),v},this.getHandleNearImagePoint=(e,t,n,o)=>{const a=(0,i.getEnabledElement)(e),{viewport:s}=a,{data:l}=t,{points:c}=l.handles;for(let e=0;e<c.length;e++){const t=c[e],i=s.worldToCanvas(t);if(!0===r.K4.distance(n,i)<o)return l.handles.activeHandleIndex=e,t}l.handles.activeHandleIndex=null},this.isPointNearTool=(e,t,n,r)=>{const o=(0,i.getEnabledElement)(e),{viewport:a}=o,{data:s}=t,{points:l}=s.handles,c=a.worldToCanvas(l[0]),u=a.worldToCanvas(l[3]),d=this._getRectangleImageCoordinates([c,u]),h=[n[0],n[1]],{left:f,top:m,width:g,height:v}=d;if(p.distanceToPoint([f,m,g,v],h)<=r)return!0},this.toolSelectedCallback=(e,t,n="mouse")=>{const r=e.detail,{element:o}=r,{data:a}=t;a.active=!0;const s=(0,d.getViewportIdsWithToolToRender)(o,this.getToolName(),!1);this.editData={annotation:t,viewportUIDsToRender:s},this._activateModify(o),(0,h.hideElementCursor)(o);const l=(0,i.getEnabledElement)(o),{renderingEngine:c}=l;(0,f.Z)(c,s),e.preventDefault()},this.handleSelectedCallback=(e,t,n,r="mouse")=>{const o=e.detail,{element:a}=o,{data:s}=t;s.active=!0;let l,c=!1;n.worldPosition?c=!0:l=s.handles.points.findIndex(e=>e===n);const u=(0,d.getViewportIdsWithToolToRender)(a,this.getToolName(),!1);this.editData={annotation:t,viewportUIDsToRender:u,handleIndex:l},this._activateModify(a),(0,h.hideElementCursor)(a);const p=(0,i.getEnabledElement)(a),{renderingEngine:m}=p;(0,f.Z)(m,u),e.preventDefault()},this._mouseUpCallback=e=>{const t=e.detail,{element:n}=t,{annotation:r,viewportUIDsToRender:o,newAnnotation:a,hasMoved:l}=this.editData,{data:c}=r;if(a&&!l)return;c.active=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,h.resetElementCursor)(n);const u=(0,i.getEnabledElement)(n),{renderingEngine:d}=u;this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s._x)(r.annotationUID),(0,f.Z)(d,o)},this._mouseDragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:r,viewportUIDsToRender:o,handleIndex:a}=this.editData,{data:s}=r;if(void 0===a){const{deltaPoints:e}=t,n=e.world,{points:r}=s.handles;r.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),s.invalidated=!0}else{const{currentPoints:e}=t,r=(0,i.getEnabledElement)(n),{worldToCanvas:o,canvasToWorld:l}=r.viewport,c=e.world,{points:u}=s.handles;let d,p,h,f,m,g,v,y;switch(u[a]=[...c],a){case 0:case 3:d=o(u[0]),f=o(u[3]),p=[f[0],d[1]],h=[d[0],f[1]],g=l(p),v=l(h),u[1]=g,u[2]=v;break;case 1:case 2:p=o(u[1]),h=o(u[2]),d=[h[0],p[1]],f=[p[0],h[1]],m=l(d),y=l(f),u[0]=m,u[3]=y}s.invalidated=!0}this.editData.hasMoved=!0;const l=(0,i.getEnabledElement)(n),{renderingEngine:c}=l;(0,f.Z)(c,o)},this._activateDraw=e=>{c.SB.isInteractingWithTool=!0,e.addEventListener(u.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(u.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(u.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(u.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(u.Events.TOUCH_END,this._mouseUpCallback),e.addEventListener(u.Events.TOUCH_DRAG,this._mouseDragCallback)},this._deactivateDraw=e=>{c.SB.isInteractingWithTool=!1,e.removeEventListener(u.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(u.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(u.Events.MOUSE_MOVE,this._mouseDragCallback),e.removeEventListener(u.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(u.Events.TOUCH_END,this._mouseUpCallback),e.removeEventListener(u.Events.TOUCH_DRAG,this._mouseDragCallback)},this._activateModify=e=>{c.SB.isInteractingWithTool=!0,e.addEventListener(u.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(u.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(u.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(u.Events.TOUCH_END,this._mouseUpCallback),e.addEventListener(u.Events.TOUCH_DRAG,this._mouseDragCallback)},this._deactivateModify=e=>{c.SB.isInteractingWithTool=!1,e.removeEventListener(u.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(u.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(u.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(u.Events.TOUCH_END,this._mouseUpCallback),e.removeEventListener(u.Events.TOUCH_DRAG,this._mouseDragCallback)},this.renderAnnotation=(e,t)=>{const n=!1,{viewport:r}=e,{element:i}=r;let o=(0,s.fy)(this.getToolName(),i);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(i,o),!o?.length)return n;this.getTargetId(r),r.getRenderingEngine();const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<o.length;e++){const n=o[e],{annotationUID:i}=n,s=(n.metadata,n.data),{points:c,activeHandleIndex:u}=s.handles,d=c.map(e=>r.worldToCanvas(e)),p=this.getStyle("lineWidth",a,n),h=this.getStyle("lineDash",a,n),f=this.getStyle("color",a,n);if(!r.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");let m;if(this.editData||null===u||(m=[d[u]]),m){const e="0";(0,l.drawHandles)(t,i,e,m,{color:f})}const g="0";(0,l.drawRedactionRect)(t,i,g,d[0],d[3],{color:"black",lineDash:h,lineWidth:p})}},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this._calculateCachedStats=(e,t,n,o,a)=>{const{data:s}=e,{viewportUID:l,renderingEngineUID:c,sceneUID:d}=a,p=s.handles.points[0],h=s.handles.points[3],{cachedStats:f}=s,g=Object.keys(f);for(let e=0;e<g.length;e++){const i=g[e],{imageVolume:a}=this._getImageVolumeFromTargetUID(i,o),{dimensions:s,scalarData:l,vtkImageData:c,metadata:u}=a,d=r.R3.fromValues(0,0,0),v=r.R3.fromValues(0,0,0);if(c.worldToIndexVec3(p,d),d[0]=Math.floor(d[0]),d[1]=Math.floor(d[1]),d[2]=Math.floor(d[2]),c.worldToIndexVec3(h,v),v[0]=Math.floor(v[0]),v[1]=Math.floor(v[1]),v[2]=Math.floor(v[2]),this._isInsideVolume(d,v,s)){this.isHandleOutsideImage=!1;const e=Math.min(d[0],v[0]),r=Math.max(d[0],v[0]),o=Math.min(d[1],v[1]),a=Math.max(d[1],v[1]),c=Math.min(d[2],v[2]),g=Math.max(d[2],v[2]),{worldWidth:y,worldHeight:b}=(0,m.Z)(t,n,p,h),C=y*b;let w=0,E=0,T=0;const x=s[0],_=s[0]*s[1];for(let t=c;t<=g;t++)for(let n=o;n<=a;n++)for(let i=e;i<=r;i++){w++,E+=l[t*_+n*x+i]}E/=w;for(let t=c;t<=g;t++)for(let n=o;n<=a;n++)for(let i=e;i<=r;i++){const e=l[t*_+n*x+i]-E;T+=e*e}T/=w,T=Math.sqrt(T),f[i]={Modality:u.Modality,area:C,mean:E,stdDev:T}}else this.isHandleOutsideImage=!0,f[i]={Modality:u.Modality}}s.invalidated=!1;const v=u.Events.ANNOTATION_MODIFIED,y={annotation:e,viewportUID:l,renderingEngineUID:c,sceneUID:d};return(0,i.triggerEvent)(i.eventTarget,v,y),f},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._getTargetVolumeUID=e=>{if(this.configuration.volumeUID)return this.configuration.volumeUID;const t=e.getVolumeActors();return t||t.length?t[0].uid:void 0},this._throttledCalculateCachedStats=(0,a.Z)(this._calculateCachedStats,100,{trailing:!0})}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,h.resetElementCursor)(e);const{annotation:t,viewportUIDsToRender:n}=this.editData,{data:r}=t;r.active=!1,r.handles.activeHandleIndex=null;const o=(0,i.getEnabledElement)(e),{renderingEngine:a}=o;return(0,f.Z)(a,n),this.editData=null,t.metadata.annotationUID}_getImageVolumeFromTargetUID(e,t){let n;if(e.startsWith("stackTarget")){const r=e.indexOf(":"),i=e.substring(r+1);n=t.getViewport(i).getImageData()}else n=i.cache.getVolume(e);return{imageVolume:n,viewport:undefined}}_getTargetStackUID(e){return`stackTarget:${e.uid}`}}g.toolName="VideoRedaction"},58391:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r=n(72076),i=n(62709),o=n(33232),a=n(68096),s=n(23118),l=n(60489),c=n(46915),u=n(26492),d=n(66878),p=n(48561),h=n(36705);const{getSubPixelSpacingAndXYDirections:f,addCanvasPointsToArray:m,getArea:g}=l.polyline;function v(e,t,n){this.isEditingClosed=!0;const r=e.detail,{currentPoints:l,element:c}=r,u=l.canvas,d=(0,i.getEnabledElement)(c);if(!d)return;const{viewport:p}=d,h=t.data.contour.polyline.map(p.worldToCanvas),{spacing:m,xDir:g,yDir:v}=f(p,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:h,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:t,viewportIdsToRender:n,spacing:m,xDir:g,yDir:v,movingTextBox:!1},o.SB.isInteractingWithTool=!0,c.addEventListener(a.Events.MOUSE_UP,this.mouseUpClosedContourEditCallback),c.addEventListener(a.Events.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),c.addEventListener(a.Events.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),c.addEventListener(a.Events.TOUCH_END,this.mouseUpClosedContourEditCallback),c.addEventListener(a.Events.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),c.addEventListener(a.Events.TOUCH_TAP,this.mouseUpClosedContourEditCallback),(0,s.hideElementCursor)(c)}function y(e){o.SB.isInteractingWithTool=!1,e.removeEventListener(a.Events.MOUSE_UP,this.mouseUpClosedContourEditCallback),e.removeEventListener(a.Events.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),e.removeEventListener(a.Events.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),e.removeEventListener(a.Events.TOUCH_END,this.mouseUpClosedContourEditCallback),e.removeEventListener(a.Events.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),e.removeEventListener(a.Events.TOUCH_TAP,this.mouseUpClosedContourEditCallback),(0,s.resetElementCursor)(e)}function b(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=n.canvas,l=(0,i.getEnabledElement)(o),{renderingEngine:c,viewport:u}=l,{viewportIdsToRender:p,xDir:h,yDir:f,spacing:g}=this.commonData,{editIndex:v,editCanvasPoints:y,startCrossingIndex:b}=this.editData,C=y[y.length-1],w=u.canvasToWorld(C),E=r.R3.create();r.R3.subtract(E,a,w);const T=Math.abs(r.R3.dot(E,h)),x=Math.abs(r.R3.dot(E,f));if(T<=g[0]&&x<=g[1])return;void 0!==b&&this.checkAndRemoveCrossesOnEditLine(e);const _=v+m(o,y,s,this.commonData);this.editData.editIndex=_,void 0===b&&y.length>1&&this.checkForFirstCrossing(e,!0),this.editData.snapIndex=this.findSnapIndex(),-1!==this.editData.snapIndex?(this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(e),void 0!==b&&this.checkForSecondCrossing(e,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(e)),(0,d.Z)(c,p)):this.finishEditAndStartNewEdit(e)}function C(e){const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{viewport:o,renderingEngine:a}=r,{annotation:s,viewportIdsToRender:l}=this.commonData,{fusedCanvasPoints:u,editCanvasPoints:f}=this.editData;(0,p.Z)(s,{points:u,closed:!0,targetWindingDirection:c.i.Clockwise},o),s.autoGenerated&&(s.autoGenerated=!1),(0,h.hg)(s,n);const m=f.pop();this.editData={prevCanvasPoints:u,editCanvasPoints:[m],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0},(0,d.Z)(a,l)}function w(e){const{prevCanvasPoints:t,editCanvasPoints:n,startCrossingIndex:i,snapIndex:o}=this.editData;if(void 0===i||void 0===o)return;const a=e.detail,{element:s}=a,l=[...n];let c,u;m(s,l,t[o],this.commonData),l.length>n.length&&l.pop(),i>o?(c=o,u=i):(c=i,u=o);const d=r.K4.distance(t[c],l[0]),p=r.K4.distance(t[c],l[l.length-1]),h=r.K4.distance(t[u],l[0]),f=r.K4.distance(t[u],l[l.length-1]),v=[];for(let e=0;e<c;e++){const n=t[e];v.push([n[0],n[1]])}let y=d+f,b=p+h;if(y<b)for(let e=0;e<l.length;e++){const t=l[e];v.push([t[0],t[1]])}else for(let e=l.length-1;e>=0;e--){const t=l[e];v.push([t[0],t[1]])}for(let e=u;e<t.length;e++){const n=t[e];v.push([n[0],n[1]])}const C=[];for(let e=c;e<u;e++){const n=t[e];C.push([n[0],n[1]])}if(y=h+p,b=f+d,y<b)for(let e=0;e<l.length;e++){const t=l[e];C.push([t[0],t[1]])}else for(let e=l.length-1;e>=0;e--){const t=l[e];C.push([t[0],t[1]])}return g(v)>g(C)?v:C}function E(e){const t=e.detail,{element:n}=t;this.completeClosedContourEdit(n)}function T(e){const t=(0,i.getEnabledElement)(e),{viewport:n,renderingEngine:r}=t,{annotation:o,viewportIdsToRender:a}=this.commonData,{fusedCanvasPoints:s,prevCanvasPoints:l}=this.editData;if(s){const t=(0,u.x)(this.configuration,o)?(0,u.K)(this.configuration,s,l):s,r=this.configuration?.decimate||{};(0,p.Z)(o,{points:t,closed:!0,targetWindingDirection:c.i.Clockwise},n,{decimate:{enabled:!!r.enabled,epsilon:r.epsilon}}),o.autoGenerated&&(o.autoGenerated=!1),(0,h.hg)(o,e)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,(0,d.Z)(r,a),this.deactivateClosedContourEdit(e)}function x(e){this.completeClosedContourEdit(e)}const _=function(e){e.activateClosedContourEdit=v.bind(e),e.deactivateClosedContourEdit=y.bind(e),e.mouseDragClosedContourEditCallback=b.bind(e),e.mouseUpClosedContourEditCallback=E.bind(e),e.finishEditAndStartNewEdit=C.bind(e),e.fuseEditPointsWithClosedContour=w.bind(e),e.cancelClosedContourEdit=x.bind(e),e.completeClosedContourEdit=T.bind(e)}},75698:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(62709),i=n(23118),o=n(68096),a=n(33232),s=n(72076),l=n(26492),c=n(19197),u=n(66878),d=n(36705),p=n(69706),h=n(60489),f=n(86614),m=n(46915);const{addCanvasPointsToArray:g,pointsAreWithinCloseContourProximity:v,getFirstLineSegmentIntersectionIndexes:y,getSubPixelSpacingAndXYDirections:b}=h.polyline;function C(e,t,n){this.isDrawing=!0;const s=e.detail,{currentPoints:l,element:u}=s,d=l.canvas,p=(0,r.getEnabledElement)(u),{viewport:h}=p,f=(0,c.Z)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:m,xDir:g,yDir:v}=b(h,this.configuration.subPixelResolution);this.drawData={canvasPoints:[d],polylineIndex:0,contourHoleProcessingEnabled:f},this.commonData={annotation:t,viewportIdsToRender:n,spacing:m,xDir:g,yDir:v,movingTextBox:!1},a.SB.isInteractingWithTool=!0,u.addEventListener(o.Events.MOUSE_UP,this.mouseUpDrawCallback),u.addEventListener(o.Events.MOUSE_DRAG,this.mouseDragDrawCallback),u.addEventListener(o.Events.MOUSE_CLICK,this.mouseUpDrawCallback),u.addEventListener(o.Events.TOUCH_END,this.mouseUpDrawCallback),u.addEventListener(o.Events.TOUCH_DRAG,this.mouseDragDrawCallback),u.addEventListener(o.Events.TOUCH_TAP,this.mouseUpDrawCallback),(0,i.hideElementCursor)(u)}function w(e){a.SB.isInteractingWithTool=!1,e.removeEventListener(o.Events.MOUSE_UP,this.mouseUpDrawCallback),e.removeEventListener(o.Events.MOUSE_DRAG,this.mouseDragDrawCallback),e.removeEventListener(o.Events.MOUSE_CLICK,this.mouseUpDrawCallback),e.removeEventListener(o.Events.TOUCH_END,this.mouseUpDrawCallback),e.removeEventListener(o.Events.TOUCH_DRAG,this.mouseDragDrawCallback),e.removeEventListener(o.Events.TOUCH_TAP,this.mouseUpDrawCallback),(0,i.resetElementCursor)(e)}function E(e){const t=e.detail,{currentPoints:n,element:i}=t,o=n.world,a=n.canvas,l=(0,r.getEnabledElement)(i),{renderingEngine:c,viewport:d}=l,{annotation:p,viewportIdsToRender:h,xDir:f,yDir:m,spacing:v,movingTextBox:y}=this.commonData,{polylineIndex:b,canvasPoints:C}=this.drawData,w=C[C.length-1],E=d.canvasToWorld(w),T=s.R3.create();s.R3.subtract(T,o,E);const x=Math.abs(s.R3.dot(T,f)),_=Math.abs(s.R3.dot(T,m));if(!(x<=v[0]&&_<=v[1])){if(y){this.isDrawing=!1;const{deltaPoints:e}=t,n=e.world,{textBox:r}=p.data.handles,{worldPosition:i}=r;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],r.hasMoved=!0}else{const t=this.findCrossingIndexDuringCreate(e);if(void 0!==t)this.applyCreateOnCross(e,t);else{const e=g(i,C,a,this.commonData);this.drawData.polylineIndex=b+e}}(0,u.Z)(c,h)}}function T(e){const{allowOpenContours:t}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],o=n[n.length-1],a=e.detail,{element:s}=a;t&&!v(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:r})}function x(e,t){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:i,minPointsToSave:o}=t??{};if(o&&n.length<o)return!1;if(this.haltDrawing(e,n))return!1;const{annotation:a,viewportIdsToRender:s}=this.commonData,c=(0,r.getEnabledElement)(e),{viewport:p,renderingEngine:h}=c;g(e,n,n[0],this.commonData),n.pop();const f=(0,l.x)(this.configuration,a)?(0,l.K)(this.configuration,n):n;this.updateContourPolyline(a,{points:f,closed:!0,targetWindingDirection:m.i.Clockwise},p);const{textBox:v}=a.data.handles;return v?.hasMoved||(0,d.lf)(a,i),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,(0,u.Z)(h,s),this.deactivateDraw(e),!0}function _(){const{canvasPoints:e}=this.drawData,t=e.length,n=[e[0],e[t-1]],r=e.slice(0,-1).slice(1),i=y(r,n[0],n[1],!1);if(i){const t=i[1];this.drawData.canvasPoints=1===t?e.splice(1):e.splice(0,t)}}function S(e,t){const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:i}=t??{};if(this.haltDrawing(e,n))return!1;const{annotation:o,viewportIdsToRender:a}=this.commonData,s=(0,r.getEnabledElement)(e),{viewport:c,renderingEngine:h}=s,f=(0,l.x)(this.configuration,o)?(0,l.K)(this.configuration,n):n;this.updateContourPolyline(o,{points:f,closed:!1},c);const{textBox:m}=o.data.handles,g=o.data.contour.polyline;return o.data.handles.points=[g[0],g[g.length-1]],o.data.isOpenUShapeContour&&(o.data.openUShapeContourVectorToPeak=(0,p.Z)(n,c)),m.hasMoved||(0,d.lf)(o,i),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,(0,u.Z)(h,a),this.deactivateDraw(e),!0}function I(e){const t=e.detail,{currentPoints:n,lastPoints:r}=t,i=n.canvas,o=r.canvas,{canvasPoints:a}=this.drawData,s=a.slice(0,-1),l=y(s,i,o,!1);if(void 0===l)return;return l[0]}function D(e,t){const n=e.detail,{element:i}=n,{canvasPoints:o,contourHoleProcessingEnabled:a}=this.drawData,{annotation:s,viewportIdsToRender:l}=this.commonData;g(i,o,o[t],this.commonData),o.pop();const c=o.slice(t),u=h.polyline.getArea(c);if(r.utilities.isEqual(u,0))return void o.splice(t+1);o.splice(0,t);const d={contourHoleProcessingEnabled:a,minPointsToSave:3};this.completeDrawClosedContour(i,d)&&this.activateClosedContourEdit(e,s,l)}function A(e){const{allowOpenContours:t}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],o=n[n.length-1];t&&!v(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(e,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(e,{contourHoleProcessingEnabled:r})}function P(e,t){const{subPixelResolution:n}=this.configuration;if(function(e,t){const n=Math.max(3*t,3);return e.length<n}(t,n)){const{annotation:t,viewportIdsToRender:n}=this.commonData,i=(0,r.getEnabledElement)(e),{renderingEngine:o}=i;return(0,f.removeAnnotation)(t.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,(0,u.Z)(o,n),this.deactivateDraw(e),!0}return!1}const O=function(e){e.activateDraw=C.bind(e),e.deactivateDraw=w.bind(e),e.applyCreateOnCross=D.bind(e),e.findCrossingIndexDuringCreate=I.bind(e),e.completeDrawOpenContour=S.bind(e),e.removeCrossedLinesOnCompleteDraw=_.bind(e),e.mouseDragDrawCallback=E.bind(e),e.mouseUpDrawCallback=T.bind(e),e.completeDrawClosedContour=x.bind(e),e.cancelDrawing=A.bind(e),e.haltDrawing=P.bind(e)}},89026:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(72076),i=n(60489);const{addCanvasPointsToArray:o,getFirstLineSegmentIntersectionIndexes:a}=i.polyline;function s(e,t){const n=e.detail,{element:i,currentPoints:s,lastPoints:l}=n,c=s.canvas,u=l.canvas,{editCanvasPoints:d,prevCanvasPoints:p}=this.editData,h=a(p,c,u,t);if(h)this.editData.startCrossingIndex=h[0],this.removePointsUpUntilFirstCrossing(t);else if(p.length>=2)if(d.length>this.configuration.checkCanvasEditFallbackProximity){const e=d[0],t=[];for(let n=0;n<p.length;n++){const i=p[n],o=r.K4.distance(i,e);t.push({distance:o,index:n})}t.sort((e,t)=>e.distance-t.distance);const n=[t[0],t[1]],i=Math.min(n[0].index,n[1].index);this.editData.startCrossingIndex=i}else{const e=r.K4.create();r.K4.subtract(e,d[1],d[0]),r.K4.normalize(e,e);const n=6,s=[d[0][0]-e[0]*n,d[0][1]-e[1]*n],l=a(p,s,d[0],t);if(l){const e=[s];o(i,e,d[0],this.commonData),d.unshift(...e),this.removePointsUpUntilFirstCrossing(t),this.editData.editIndex=d.length-1,this.editData.startCrossingIndex=l[0]}}}function l(e){const{editCanvasPoints:t,prevCanvasPoints:n}=this.editData;let r=0;for(let i=0;i<t.length-1;i++){const o=[t[i],t[i+1]];if(r++,!!a(n,o[0],o[1],e))break}t.splice(0,r),this.editData.editIndex=t.length-1}function c(e,t){const n=e.detail,{currentPoints:r,lastPoints:i}=n,o=r.canvas,s=i.canvas,{prevCanvasPoints:l}=this.editData;return!!a(l,o,s,t)}function u(e){const{prevCanvasPoints:t,editCanvasPoints:n}=this.editData;for(let r=n.length-1;r>0;r--){const i=[n[r],n[r-1]],o=!!a(t,i[0],i[1],e);if(n.pop(),o)break}}function d(){const{editCanvasPoints:e,prevCanvasPoints:t,startCrossingIndex:n}=this.editData;if(void 0===n)return;const i=e[e.length-1],o=[];for(let e=0;e<t.length;e++){const n=t[e],a=r.K4.distance(n,i);o.push({distance:a,index:e})}o.sort((e,t)=>e.distance-t.distance);const s=e.slice(0,-1);for(let n=0;n<o.length;n++){const{index:r}=o[n],i=t[r],l=e[e.length-1];if(!a(s,i,l,!1))return r}return-1}function p(e){const t=e.detail,{currentPoints:n,lastPoints:r}=t,i=n.canvas,o=r.canvas,{editCanvasPoints:s}=this.editData,l=s.slice(0,-2),c=a(l,i,o,!1);if(!c)return;const u=c[0],d=s.length-u;for(let e=0;e<d;e++)s.pop()}const h=function(e){e.checkForFirstCrossing=s.bind(e),e.removePointsUpUntilFirstCrossing=l.bind(e),e.checkForSecondCrossing=c.bind(e),e.findSnapIndex=d.bind(e),e.removePointsAfterSecondCrossing=u.bind(e),e.checkAndRemoveCrossesOnEditLine=p.bind(e)}},69706:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i,b:()=>o});var r=n(72076);function i(e,t){const n=e[0],i=e[e.length-1],o=r.K4.create();r.K4.set(o,i[0]-n[0],i[1]-n[1]),r.K4.normalize(o,o);const a=r.K4.create(),s=r.K4.create();r.K4.set(a,-o[1],o[0]),r.K4.set(s,o[1],-o[0]);const l=[(n[0]+i[0])/2,(n[1]+i[1])/2],c={dist:0,index:null};for(let t=0;t<e.length;t++){const n=e[t],i=r.K4.dist(n,l);i>c.dist&&(c.dist=i,c.index=t)}return[e[c.index],l].map(t.canvasToWorld)}function o(e,t){const{viewport:n}=e;return i(t.data.contour.polyline.map(n.worldToCanvas),n)}},21879:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var r=n(72076),i=n(62709),o=n(33232),a=n(68096),s=n(23118),l=n(60489),c=n(26492),u=n(66878),d=n(11203),p=n(69706),h=n(36705);const{addCanvasPointsToArray:f,getSubPixelSpacingAndXYDirections:m}=l.polyline;function g(e,t,n){this.isEditingOpen=!0;const r=e.detail,{currentPoints:l,element:c}=r,u=l.canvas,d=(0,i.getEnabledElement)(c),{viewport:p}=d,h=t.data.contour.polyline.map(p.worldToCanvas),{spacing:f,xDir:g,yDir:v}=m(p,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:h,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:t,viewportIdsToRender:n,spacing:f,xDir:g,yDir:v,movingTextBox:!1},o.SB.isInteractingWithTool=!0,c.addEventListener(a.Events.MOUSE_UP,this.mouseUpOpenContourEditCallback),c.addEventListener(a.Events.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),c.addEventListener(a.Events.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),c.addEventListener(a.Events.TOUCH_END,this.mouseUpOpenContourEditCallback),c.addEventListener(a.Events.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),c.addEventListener(a.Events.TOUCH_TAP,this.mouseUpOpenContourEditCallback),(0,s.hideElementCursor)(c)}function v(e){o.SB.isInteractingWithTool=!1,e.removeEventListener(a.Events.MOUSE_UP,this.mouseUpOpenContourEditCallback),e.removeEventListener(a.Events.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),e.removeEventListener(a.Events.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),e.removeEventListener(a.Events.TOUCH_END,this.mouseUpOpenContourEditCallback),e.removeEventListener(a.Events.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),e.removeEventListener(a.Events.TOUCH_TAP,this.mouseUpOpenContourEditCallback),(0,s.resetElementCursor)(e)}function y(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,s=n.canvas,l=(0,i.getEnabledElement)(o),{renderingEngine:c,viewport:d}=l,{viewportIdsToRender:p,xDir:h,yDir:m,spacing:g}=this.commonData,{editIndex:v,editCanvasPoints:y,startCrossingIndex:b}=this.editData,C=y[y.length-1],w=d.canvasToWorld(C),E=r.R3.create();r.R3.subtract(E,a,w);const T=Math.abs(r.R3.dot(E,h)),x=Math.abs(r.R3.dot(E,m));if(T<=g[0]&&x<=g[1])return;void 0!==b&&this.checkAndRemoveCrossesOnEditLine(e);const _=v+f(o,y,s,this.commonData);this.editData.editIndex=_,void 0===b&&y.length>1&&this.checkForFirstCrossing(e,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(e),void 0!==b&&this.checkForSecondCrossing(e,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(e)):this.checkIfShouldOverwriteAnEnd(e)&&this.openContourEditOverwriteEnd(e),(0,u.Z)(c,p)}function b(e){const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{viewport:o}=r,{annotation:a,viewportIdsToRender:s}=this.commonData,l=this.fuseEditPointsForOpenContourEndEdit();(0,d.updateContourPolyline)(a,{points:l,closed:!1},o);const c=a.data.contour.polyline;a.data.handles.points=[c[0],c[c.length-1]],a.data.handles.activeHandleIndex=1,(0,h.hg)(a,n),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.deactivateOpenContourEdit(n),this.activateOpenContourEndEdit(e,a,s,null)}function C(e){const t=e.detail,{currentPoints:n,lastPoints:i}=t,o=n.canvas,a=i.canvas,{snapIndex:s,prevCanvasPoints:l,startCrossingIndex:c}=this.editData;if(void 0===c||void 0===s)return!1;if(-1===s)return!0;if(0!==s&&s!==l.length-1)return!1;const u=o,d=a,p=l[s],h=r.K4.create(),f=r.K4.create();r.K4.set(h,u[0]-d[0],u[1]-d[1]),r.K4.set(f,u[0]-p[0],u[1]-p[1]);const m=r.K4.dot(h,f),g=Math.sqrt(h[0]*h[0]+h[1]*h[1]),v=Math.sqrt(f[0]*f[0]+f[1]*f[1]);return Math.acos(m/(g*v))<Math.PI/2}function w(){const{snapIndex:e,prevCanvasPoints:t,editCanvasPoints:n,startCrossingIndex:i}=this.editData,o=[];if(0===e)for(let e=t.length-1;e>=i;e--){const n=t[e];o.push([n[0],n[1]])}else for(let e=0;e<i;e++){const n=t[e];o.push([n[0],n[1]])}if(r.K4.distance(t[i],n[0])<r.K4.distance(t[i],n[n.length-1]))for(let e=0;e<n.length;e++){const t=n[e];o.push([t[0],t[1]])}else for(let e=n.length-1;e>=0;e--){const t=n[e];o.push([t[0],t[1]])}return o}function E(e){const{prevCanvasPoints:t,editCanvasPoints:n,startCrossingIndex:i,snapIndex:o}=this.editData;if(void 0===i||void 0===o)return;const a=e.detail,{element:s}=a,l=[...n];let c,u;f(s,l,t[o],this.commonData),l.length>n.length&&l.pop(),i>o?(c=o,u=i):(c=i,u=o);const d=r.K4.distance(t[c],l[0]),p=r.K4.distance(t[c],l[l.length-1]),h=r.K4.distance(t[u],l[0]),m=r.K4.distance(t[u],l[l.length-1]),g=[];for(let e=0;e<c;e++){const n=t[e];g.push([n[0],n[1]])}if(d+m<p+h)for(let e=0;e<l.length;e++){const t=l[e];g.push([t[0],t[1]])}else for(let e=l.length-1;e>=0;e--){const t=l[e];g.push([t[0],t[1]])}for(let e=u;e<t.length;e++){const n=t[e];g.push([n[0],n[1]])}return g}function T(e){const t=e.detail,{element:n}=t,r=(0,i.getEnabledElement)(n),{viewport:o,renderingEngine:a}=r,{annotation:s,viewportIdsToRender:l}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:p}=this.editData;(0,d.updateContourPolyline)(s,{points:c,closed:!1},o);const f=s.data.contour.polyline;s.data.handles.points=[f[0],f[f.length-1]],(0,h.hg)(s,n);const m=p.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[m],startCrossingIndex:void 0,editIndex:0},(0,u.Z)(a,l)}function x(e){const t=e.detail,{element:n}=t;this.completeOpenContourEdit(n)}function _(e){const t=(0,i.getEnabledElement)(e),{viewport:n,renderingEngine:r}=t,{annotation:o,viewportIdsToRender:a}=this.commonData,{fusedCanvasPoints:s,prevCanvasPoints:l}=this.editData;if(s){const t=(0,c.x)(this.configuration)?(0,c.K)(this.configuration,s,l):s,r=this.configuration?.decimate||{};(0,d.updateContourPolyline)(o,{points:t,closed:!1},n,{decimate:{enabled:!!r.enabled,epsilon:r.epsilon}});const i=o.data.contour.polyline;o.data.handles.points=[i[0],i[i.length-1]],o.data.isOpenUShapeContour&&(o.data.openUShapeContourVectorToPeak=(0,p.Z)(s,n)),(0,h.hg)(o,e)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,(0,u.Z)(r,a),this.deactivateOpenContourEdit(e)}function S(e){this.completeOpenContourEdit(e)}const I=function(e){e.activateOpenContourEdit=g.bind(e),e.deactivateOpenContourEdit=v.bind(e),e.mouseDragOpenContourEditCallback=y.bind(e),e.mouseUpOpenContourEditCallback=x.bind(e),e.fuseEditPointsWithOpenContour=E.bind(e),e.finishEditOpenOnSecondCrossing=T.bind(e),e.checkIfShouldOverwriteAnEnd=C.bind(e),e.fuseEditPointsForOpenContourEndEdit=w.bind(e),e.openContourEditOverwriteEnd=b.bind(e),e.cancelOpenContourEdit=S.bind(e),e.completeOpenContourEdit=_.bind(e)}},82571:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(62709),i=n(33232),o=n(68096),a=n(23118),s=n(60489);const{getSubPixelSpacingAndXYDirections:l}=s.polyline;function c(e,t,n,s){this.isDrawing=!0;const c=e.detail,{element:u}=c,d=(0,r.getEnabledElement)(u),{viewport:p}=d,{spacing:h,xDir:f,yDir:m}=l(p,this.configuration.subPixelResolution),g=t.data.contour.polyline.map(p.worldToCanvas);0===t.data.handles.activeHandleIndex&&g.reverse();let v=!1;s?.worldPosition&&(v=!0),this.drawData={canvasPoints:g,polylineIndex:g.length-1},this.commonData={annotation:t,viewportIdsToRender:n,spacing:h,xDir:f,yDir:m,movingTextBox:v},i.SB.isInteractingWithTool=!0,u.addEventListener(o.Events.MOUSE_UP,this.mouseUpDrawCallback),u.addEventListener(o.Events.MOUSE_DRAG,this.mouseDragDrawCallback),u.addEventListener(o.Events.MOUSE_CLICK,this.mouseUpDrawCallback),u.addEventListener(o.Events.TOUCH_END,this.mouseUpDrawCallback),u.addEventListener(o.Events.TOUCH_DRAG,this.mouseDragDrawCallback),u.addEventListener(o.Events.TOUCH_TAP,this.mouseUpDrawCallback),(0,a.hideElementCursor)(u)}const u=function(e){e.activateOpenContourEndEdit=c.bind(e)}},54435:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(86785),i=n(60489),o=n(69706),a=n(11203);const{pointsAreWithinCloseContourProximity:s}=i.polyline;function l(e,t){const n={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id,annotationUID:t.annotationUID},{lineWidth:r,lineDash:i,color:o,fillColor:a,fillOpacity:s}=this.getAnnotationStyle({annotation:t,styleSpecifier:n}),{closed:l}=t.data.contour;return{color:o,width:r,lineDash:i,fillColor:a,fillOpacity:s,closePath:l}}function c(e,t,n){e?.viewport?.getImageData()&&(n.data.contour.closed?this.renderClosedContour(e,t,n):n.data.isOpenUShapeContour?(!function(e,t){t.data.openUShapeContourVectorToPeak||(t.data.openUShapeContourVectorToPeak=(0,o.b)(e,t))}(e,n),this.renderOpenUShapedContour(e,t,n)):this.renderOpenContour(e,t,n))}function u(e,t,n){if(n.parentAnnotationUID)return;const{viewport:i}=e,o=this._getRenderingOptions(e,n),s=[n.data.contour.polyline.map(e=>i.worldToCanvas(e)),...(0,a.getContourHolesDataCanvas)(n,i)];(0,r.drawPath)(t,n.annotationUID,"1",s,o)}function d(e,t,n){const{viewport:i}=e,o=this._getRenderingOptions(e,n),a=n.data.contour.polyline.map(e=>i.worldToCanvas(e));(0,r.drawPolyline)(t,n.annotationUID,"1",a,o);const s=n.data.handles.activeHandleIndex;if(!0===this.configuration.alwaysRenderOpenContourHandles?.enabled){const e=this.configuration.alwaysRenderOpenContourHandles.radius,i="0",l=[a[0],a[a.length-1]];0===s?l.shift():1===s&&l.pop(),(0,r.drawHandles)(t,n.annotationUID,i,l,{color:o.color,handleRadius:e})}if(null!==s){const e="1",i=a[0===s?0:a.length-1];(0,r.drawHandles)(t,n.annotationUID,e,[i],{color:o.color})}}function p(e,t,n){const{viewport:i}=e,{openUShapeContourVectorToPeak:o}=n.data,{polyline:a}=n.data.contour;if(this.renderOpenContour(e,t,n),!o)return;const s=i.worldToCanvas(a[0]),l=i.worldToCanvas(a[a.length-1]),c=[i.worldToCanvas(o[0]),i.worldToCanvas(o[1])],u=this._getRenderingOptions(e,n);(0,r.drawPolyline)(t,n.annotationUID,"first-to-last",[s,l],{color:u.color,width:u.width,closePath:!1,lineDash:"2,2"}),(0,r.drawPolyline)(t,n.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:u.color,width:u.width,closePath:!1,lineDash:"2,2"})}function h(e,t,n){const i=this._getRenderingOptions(e,n),{allowOpenContours:o}=this.configuration,{canvasPoints:a}=this.drawData;if(i.closePath=!1,(0,r.drawPolyline)(t,n.annotationUID,"1",a,i),o){const e=a[0],o=a[a.length-1];if(s(e,o,this.configuration.closeContourProximity))(0,r.drawPolyline)(t,n.annotationUID,"2",[o,e],i);else{const o="0";(0,r.drawHandles)(t,n.annotationUID,o,[e],{color:i.color,handleRadius:2})}}}function f(e,t,n){const{viewport:i}=e,{fusedCanvasPoints:o}=this.editData;if(void 0===o)return void this.renderClosedContour(e,t,n);const s=[o,...(0,a.getContourHolesDataCanvas)(n,i)],l=this._getRenderingOptions(e,n);n.parentAnnotationUID&&l.fillOpacity&&(l.fillOpacity=0),(0,r.drawPath)(t,n.annotationUID,"preview-1",s,l)}function m(e,t,n){const{fusedCanvasPoints:i}=this.editData;if(void 0===i)return void this.renderOpenContour(e,t,n);const o=this._getRenderingOptions(e,n);(0,r.drawPolyline)(t,n.annotationUID,"preview-1",i,o)}function g(e,t,n){if(n.parentAnnotationUID)return;const{viewport:i}=e,o=this._getRenderingOptions(e,n),s=n.data.contour.polyline.map(e=>i.worldToCanvas(e)),l=(0,a.getContourHolesDataCanvas)(n,i),c=s[0],u=[];for(let e=0;e<100;e++){const t=e/100*2*Math.PI,n=c[0]+6*Math.cos(t),r=c[1]+6*Math.sin(t);u.push([n,r])}const d=[[c[0]-12,c[1]],[c[0]+12,c[1]],[c[0],c[1]-12],[c[0],c[1]+12]];(0,r.drawPath)(t,n.annotationUID,"1-crosshair_v",[d[0],d[1]],o),(0,r.drawPath)(t,n.annotationUID,"1-crosshair_h",[d[2],d[3]],o);const p=[u,...l];(0,r.drawPath)(t,n.annotationUID,"1",p,o)}const v=function(e){e.renderContour=c.bind(e),e.renderClosedContour=u.bind(e),e.renderOpenContour=d.bind(e),e.renderPointContourWithMarker=g.bind(e),e.renderOpenUShapedContour=p.bind(e),e.renderContourBeingDrawn=h.bind(e),e.renderClosedContourBeingEdited=f.bind(e),e.renderOpenContourBeingEdited=m.bind(e),e._getRenderingOptions=l.bind(e)}},92622:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(62709),i=n(78552),o=n(86614),a=n(64307),s=n(69943),l=n(58429),c=n(64311);class u extends i.Z{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:t,imageId:n}=e.detail,i=r.utilities.imageIdToURI(n),s=(0,o.getAnnotationManager)();s.getFramesOfReference().forEach(e=>{const n=s.getAnnotations(e)[this.getToolName()];n&&n.length&&(n.forEach(e=>{if(!e.metadata?.referencedImageId)return;r.utilities.imageIdToURI(e.metadata.referencedImageId)===i&&(e.invalidated=!0,e.data.cachedStats={})}),(0,a.ZP)(t))})}}filterInteractableAnnotationsForElement(e,t){if(!t||!t.length)return;const n=(0,r.getEnabledElement)(e),{viewport:i}=n;return(0,s.Z)(i,t)}getReferencedImageIds(e){const t=this.getTargetId(e);let n;if(e instanceof r.StackViewport)n=[t.split("imageId:")[1]];else if(e instanceof r.VideoViewport)n=[t.split("videoId:")[1]];else{const e=r.utilities.getVolumeId(t);n=r.cache.getVolume(e).imageIds}return n}getReferencedImageId(e,t,n,i){const o=this.getTargetId(e);let a=o.split(/^[a-zA-Z]+:/)[1];if(e instanceof r.BaseVolumeViewport){const e=r.utilities.getVolumeId(o),i=r.cache.getVolume(e);a=r.utilities.getClosestImageId(i,t,n)}return a}getStyle(e,t,n){return(0,l.$)(e,t,(0,c.getState)(n),this.mode)}}u.toolName="AnnotationDisplayTool";const d=u},78552:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(62709),i=n(22712);class o{constructor(e,t){const n=r.utilities.deepMerge(t,e),{configuration:o={},supportedInteractionTypes:a,toolGroupId:s}=n;o.strategies||(o.strategies={},o.defaultStrategy=void 0,o.activeStrategy=void 0,o.strategyOptions={}),this.toolGroupId=s,this.supportedInteractionTypes=a||[],this.configuration=Object.assign({},o),this.mode=i.default.Disabled}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,t){const{strategies:n,activeStrategy:r}=this.configuration;return n[r]?.call(this,e,t)}applyActiveStrategyCallback(e,t,n){const{strategies:r,activeStrategy:i}=this.configuration;if(!r[i])throw new Error(`applyActiveStrategyCallback: active strategy ${i} not found, check tool configuration or spellings`);return r[i][n]?.call(this,e,t)}setConfiguration(e){this.configuration=r.utilities.deepMerge(this.configuration,e),e.strategySpecificConfiguration?.THRESHOLD_INSIDE_CIRCLE&&(this.configuration.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold=e.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetVolumeId(e){if(this.configuration.volumeId)return this.configuration.volumeId;const t=e.getActors();return t?t.find(e=>"vtkVolume"===e.actor.getClassName())?.uid:void 0}getTargetIdImage(e,t){if(e.startsWith("imageId:")){const n=e.split("imageId:")[1],i=r.utilities.imageIdToURI(n);let o=r.utilities.getViewportsWithImageURI(i,t.id);if(!o||!o.length)return;if(o=o.filter(e=>e.getCurrentImageId()===n),!o||!o.length)return;return o[0].getImageData()}if(e.startsWith("volumeId:")){const n=r.utilities.getVolumeId(e),i=r.utilities.getViewportsWithVolumeId(n,t.id);if(!i||!i.length)return;return i[0].getImageData()}if(e.startsWith("videoId:")){const n=r.utilities.imageIdToURI(e),i=r.utilities.getViewportsWithImageURI(n,t.id);if(!i||!i.length)return;return i[0].getImageData()}throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){const t=e.getReferenceId?.();if(t)return t;if(e instanceof r.BaseVolumeViewport)return`volumeId:${this.getTargetVolumeId(e)}`;throw new Error("getTargetId: viewport must have a getReferenceId method")}}o.toolName="BaseTool";const a=o},22955:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var r=n(62709),i=n(95482),o=n(68096),a=n(86614),s=n(86785),l=n(66809),c=n(11203);class u extends l.Z{constructor(e,t){super(e,t)}renderAnnotation(e,t){let n=!1;const{viewport:r}=e,{element:i}=r;if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let o=(0,a.getAnnotations)(this.getToolName(),i);if(!o?.length)return n;if(o=this.filterInteractableAnnotationsForElement(i,o),!o?.length)return n;const s=this.getTargetId(r),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<o.length;r++){const i=o[r];l.annotationUID=i.annotationUID;const a=this.getAnnotationStyle({annotation:i,styleSpecifier:l});if(!a.visibility)continue;const c=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:i,annotationStyle:a,svgDrawingHelper:t});n||=c,i.invalidated=!1}return n}createAnnotation(e){const t=e.detail,{currentPoints:n,element:i}=t,{world:o}=n,a=(0,r.getEnabledElement)(i),{viewport:s}=a,l=s.getCamera(),{viewPlaneNormal:c,viewUp:u,position:d}=l,p=this.getReferencedImageId(s,o,c,u),h=s.getViewReference({points:[o]});return{highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),...h,referencedImageId:p,viewUp:u,cameraPosition:d},data:{handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{polyline:[],closed:!1}},interpolationUID:"",autoGenerated:!1}}addAnnotation(e,t){return(0,a.addAnnotation)(e,t)}cancelAnnotation(e){}moveAnnotation(e,t){const{points:n}=e.data.handles;for(let e=0,r=n.length;e<r;e++){const r=n[e];r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]}e.invalidated=!0,(0,a.getChildAnnotations)(e).forEach(e=>this.moveAnnotation(e,t))}updateContourPolyline(e,t,n){const r=this.configuration?.decimate||{};(0,c.updateContourPolyline)(e,t,n,{decimate:{enabled:!!r.enabled,epsilon:r.epsilon}})}getPolylinePoints(e){return e.data.contour?.polyline??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:t,annotationStyle:n,svgDrawingHelper:r}=e,i=e.annotation;if(i.parentAnnotationUID)return;const{annotationUID:o}=i,{viewport:a}=t,{worldToCanvas:l}=a,u=this.getPolylinePoints(i).map(e=>l(e)),{lineWidth:d,lineDash:p,color:h,fillColor:f,fillOpacity:m}=n,g=[u,...(0,c.getContourHolesDataCanvas)(i,a)];return(0,s.drawPath)(r,o,"contourPolyline",g,{color:h,lineDash:p,lineWidth:Math.max(.1,d),fillColor:f,fillOpacity:m}),!0}}var d=n(32140),p=n(61065),h=n(59865),f=n(60721),m=n(79454);class g extends u{constructor(e,t){super(e,t),this.configuration.interpolation?.enabled&&p.InterpolationManager.addTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const{toolGroupId:t}=this,n=super.createAnnotation(e);if(!this.isContourSegmentationTool())return n;const a=i.activeSegmentation.getActiveSegmentationRepresentation(t);if(!a)throw new Error("No active segmentation detected, create one before using scissors tool");const{type:s}=a;if(s!==o.SegmentationRepresentations.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:l}=a,c=i.segmentIndex.getActiveSegmentIndex(l);return r.utilities.deepMerge(n,{data:{segmentation:{segmentationId:l,segmentIndex:c}}})}addAnnotation(e,t){const n=super.addAnnotation(e,t);if(this.isContourSegmentationTool()){const t=e;(0,h.addContourSegmentationAnnotation)(t)}return n}cancelAnnotation(e){this.isContourSegmentationTool()&&(0,h.removeContourSegmentationAnnotation)(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const t=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return t;const n=this._getContourSegmentationStyle(e);return r.utilities.deepMerge(t,n)}renderAnnotationInstance(e){const{annotation:t}=e,{invalidated:n}=t,r=super.renderAnnotationInstance(e);if(n&&this.isContourSegmentationTool()){const{segmentationId:e}=t.data.segmentation;(0,d.triggerSegmentationDataModified)(e);const n=(0,f.getToolGroupIdsWithSegmentation)(e);(0,m.triggerAnnotationRenderForToolGroupIds)(n)}return r}_getContourSegmentationStyle(e){const{toolGroupId:t}=this,n=e.annotation,{segmentationId:r,segmentIndex:o}=n.data.segmentation,a=i.state.getSegmentation(r),s=this._getSegmentationRepresentation(r);if(!s)return{};const{segmentationRepresentationUID:l}=s,{active:c}=s,{autoGenerated:u}=n,d=i.segmentLocking.getLockedSegments(r).includes(o),p=i.config.color.getColorForSegmentIndex(t,l,o),h=i.config.visibility.getSegmentationVisibility(t,l),f=i.config.getGlobalConfig(),m=i.config.getToolGroupSpecificConfig(t),g=i.config.getSegmentationRepresentationSpecificConfig(t,l),v=i.config.getSegmentSpecificConfig(t,l,o),y=i.config.visibility.getSegmentVisibility(t,l,o),b=Object.assign({},f?.representations?.CONTOUR??{},m?.representations?.CONTOUR??{},g?.CONTOUR??{},v?.CONTOUR??{});let C,w=1,E=1,T=0;u?(w=b.outlineWidthAutoGenerated??w,C=b.outlineDashAutoGenerated??C,E=b.outlineOpacity??E,T=b.fillAlphaAutoGenerated??T):c?(w=b.outlineWidthActive??w,C=b.outlineDashActive??C,E=b.outlineOpacity??E,T=b.fillAlpha??T):(w=b.outlineWidthInactive??w,C=b.outlineDashInactive??C,E=b.outlineOpacityInactive??E,T=b.fillAlphaInactive??T),a.activeSegmentIndex===o&&(w+=b.activeSegmentOutlineWidthDelta),w=b.renderOutline?w:0,T=b.renderFill?T:0;const x=`rgba(${p[0]}, ${p[1]}, ${p[2]}, ${E})`;return{color:x,fillColor:`rgb(${p[0]}, ${p[1]}, ${p[2]})`,lineWidth:w,fillOpacity:T,lineDash:C,textbox:{color:x},visibility:h&&y,locked:d}}_getSegmentationRepresentation(e){const t=i.state.getSegmentationRepresentations(this.toolGroupId).filter(t=>t.segmentationId===e);if(t)return i.state.getSegmentationRepresentations(this.toolGroupId).length>1&&console.warn("Multiple segmentation representations detected for this tool group. The first one will be used."),t[0];console.warn(`No segmentation representation found for toolGroupId: ${this.toolGroupId}`)}}},93382:(e,t,n)=>{"use strict";n.d(t,{A8:()=>i.Z,ml:()=>r.Z});var r=n(78552),i=n(66809);n(92622)},44284:(e,t,n)=>{"use strict";n.d(t,{p:()=>b});var r=n(62709),i=n(74297),o=n(60721),a=n(27078),s=n(50097);const l=function(e,t,n=!1){const r=(0,o.getSegmentationRepresentationByUID)(t,e),{segmentationId:i}=r,a=(0,o.getSegmentation)(i),{annotationUIDsMap:l}=a.representationData.CONTOUR;l.forEach(e=>{e.forEach(e=>{(0,s._x)(e)})})},c=new Map;function u(e){return c.get(e)}function d(e,t){c.set(e,t)}var p=n(95482),h=n(13278);n(17197),n(23834),n(46576);function f(e,t,n){let r=e.segmentSpecificConfig?.[t];return r||(r=e.segmentSpecificConfig?.[n]),r?r.CONTOUR:null}var m=n(59865);function g(e,t,n,i){const{segmentationRepresentationUID:o,segmentsHidden:a}=n,s=i.representations.CONTOUR,l=u(o),c=s.outlineWidthActive;l?.outlineWidthActive!==c&&d(o,Object.assign({},l,{outlineWidthActive:c}));const p=[],h=[];for(const e of a)l.segmentsHidden.has(e)||p.push(e);for(const e of l.segmentsHidden)a.has(e)||h.push(e);const m=Array.from(l.segmentsHidden).filter(e=>!h.includes(e)).concat(p),{segmentSpecificConfigs:g}=t.reduce((e,t)=>{const i=r.cache.getGeometry(t),{data:o}=i,a=o.getSegmentIndex(),s=f(n,t,a);return e.segmentSpecificConfigs[a]=s??{},e},{contourSets:[],segmentSpecificConfigs:{}}),v=[...m,...h],y=Object.values(g).some(e=>Object.keys(e).length>0);(v.length||y)&&d(o,Object.assign({},l,{segmentsHidden:new Set(a)})),e.render()}function v(e,t,n,i){const{segmentationRepresentationUID:o,segmentationId:a,segmentsHidden:l}=n,c=new Map;t.forEach(t=>{const i=r.cache.getGeometry(t);if(!i)return void console.warn(`No geometry found for geometryId ${t}. Skipping render.`);const o=i.data.getSegmentIndex();!function(e){if(!e)throw new Error(`No contours found for geometryId ${e.id}`);const t=e.id;if(e.type!==r.Enums.GeometryType.CONTOUR)throw new Error(`Geometry type ${e.type} not supported for rendering.`);e.data||console.warn(`No contours found for geometryId ${t}. Skipping render.`)}(i);const l=f(n,t,o);i.data.contours.forEach(t=>{const{points:n,color:i,id:l}=t,c={annotationUID:r.utilities.uuidv4(),data:{contour:{closed:!0,polyline:n},segmentation:{segmentationId:a,segmentIndex:o,color:i,id:l},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:(0,h.B)(e,n[0],e.getCamera().viewPlaneNormal),toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:e.getFrameOfReferenceUID(),viewPlaneNormal:e.getCamera().viewPlaneNormal}},u=e.element;(0,s.ud)(c,u),(0,m.addContourSegmentationAnnotation)(c)}),l&&c.set(o,l)});const p=i.representations.CONTOUR.outlineWidthActive;d(o,Object.assign({},u(o),{segmentsHidden:new Set(l),segmentSpecificMap:c,outlineWidthActive:p})),e.resetCamera(),e.render()}let y=!1;const b={render:async function(e,t,n){const{segmentationId:r}=t,a=o.getSegmentation(r);if(!a)return;let s=a.representationData[i.default.Contour];s||!p.polySeg.canComputeRequestedRepresentation(t.segmentationRepresentationUID)||y||(y=!0,s=await p.polySeg.computeAndAddContourRepresentation(r,{segmentationRepresentationUID:t.segmentationRepresentationUID,viewport:e})),s&&s?.geometryIds?.length&&function(e,t,n,r,i){(n.size?g:v)(e,t,r,i)}(e,s.geometryIds,s.annotationUIDsMap,t,n)},removeSegmentationRepresentation:function(e,t,n=!1){if(function(e,t){const n=(0,a.getToolGroup)(e);if(void 0===n)throw new Error(`ToolGroup with ToolGroupId ${e} does not exist`);const{viewportsInfo:i}=n;for(const n of i){const{viewportId:i,renderingEngineId:o}=n;(0,r.getEnabledElementByIds)(i,o);l(t,e)}}(e,t),o.removeSegmentationRepresentation(e,t),function(e){c.delete(e)}(t),n){(0,a.getToolGroup)(e).getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{(0,r.getEnabledElementByIds)(e,t).viewport.render()})}}}},83456:(e,t,n)=>{"use strict";n.d(t,{$W:()=>i.G,Pm:()=>r.ZP});var r=n(60950),i=(n(35904),n(88286))},60950:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>C,iq:()=>m});var r=n(44031),i=n(5193),o=n(62709),a=n(74297),s=n(60721),l=n(27078),c=n(88439);const u=async function(e,t,n){const r=(0,o.getEnabledElement)(e),{renderingEngine:i,viewport:a}=r,{id:s}=a;if((0,c.y)(t,a)){const e=[{volumeId:t.volumeId,actorUID:n,visibility:true,blendMode:o.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND}];await(0,o.addVolumesToViewports)(i,e,[s],false,true)}else{const e=[{imageId:t.imageIdReferenceMap.get(a.getCurrentImageId()),actorUID:n}];await(0,o.addImageSlicesToViewports)(i,e,[s])}};const d=function(e,t,n=!1){const r=(0,o.getEnabledElement)(e),{viewport:i}=r;i.removeActors([t])};var p=n(95482);const h=255,f=new Map;function m(){const e=i.ZP.newInstance(),t=r.ZP.newInstance();return t.addPoint(0,0),{ofun:t,cfun:e}}let g=!1;function v(e,t,n,r){const i={...e,...t,...r||{}};return{fillAlpha:n?i.fillAlpha:i.fillAlphaInactive,outlineWidth:n?i.outlineWidthActive:i.outlineWidthInactive,renderFill:n?i.renderFill:i.renderFillInactive,renderOutline:i.renderOutline,outlineOpacity:n?i.outlineOpacity:i.outlineOpacityInactive}}function y(e,t,n,{fillAlpha:r,renderFill:i,renderOutline:o,segmentColor:a,outlineWidth:s,segmentsHidden:l}){const c=`${e}-${t}-${n}`,u=f.get(c);if(!u)return f.set(c,{fillAlpha:r,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(l)}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:d,renderFill:p,renderOutline:h,outlineWidth:m,segmentColor:g,segmentsHidden:v}=u,y=g[0]!==a[0]||g[1]!==a[1]||g[2]!==a[2],b=g[3]!==a[3]||d!==r||p!==i||h!==o||m!==s||v.has(n)!==l.has(n);return f.set(c,{fillAlpha:r,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(l)}),{forceOpacityUpdate:b,forceColorUpdate:y}}async function b(e,t,n){await u(e.element,t,n)}const C={getRepresentationRenderingConfig:m,render:async function(e,t,n){const{colorLUTIndex:r,active:i,segmentationId:l,segmentationRepresentationUID:u,segmentsHidden:d,config:f}=t,m=s.getSegmentation(l);if(!m)return void console.warn("No segmentation found for segmentationId: ",l);let C=m.representationData[a.default.Labelmap],w=e.getActor(u);if(!C&&p.polySeg.canComputeRequestedRepresentation(u)&&!g){if(g=!0,C=await p.polySeg.computeAndAddLabelmapRepresentation(l,{segmentationRepresentationUID:u,viewport:e}),!C)throw new Error(`No labelmap data found for segmentationId ${l}.`);g=!1}if(!C)return;if((0,c.y)(C,e)){if(e instanceof o.StackViewport)return;const{volumeId:t}=C;if(!o.cache.getVolume(t))throw new Error(`No Labelmap found for volumeId: ${t}`);if(!function(e,t){if(!t)return!0;const n=e.getDefaultActor();if(!n)return!1;const{uid:r}=n,i=o.cache.getVolume(r);if(i){const e=o.cache.getVolume(t);if(e&&i.metadata.FrameOfReferenceUID===e.metadata.FrameOfReferenceUID)return!0}return!1}(e,C?.referencedVolumeId))return;w||await b(e,C,u),w=e.getActor(u)}else{if(e instanceof o.VolumeViewport)return;const t=e.getCurrentImageId(),{imageIdReferenceMap:n}=C;if(!n.has(t))return;w||await b(e,C,u),w=e.getActor(u)}if(!w)return;const{cfun:E,ofun:T}=f,x=n.renderInactiveSegmentations;!function(e,t,n,r,i,o,l,c,u,d){const{segmentSpecificConfig:p,segmentationRepresentationSpecificConfig:f}=l,m=f[a.default.Labelmap],g=s.getColorLUT(i),b=Math.min(256,g.length),{uid:C}=t,{outlineWidth:w,renderOutline:E,outlineOpacity:T}=v(o,m,c);for(let t=0;t<b;t++){const i=t,s=g[i],l=p[i]?.[a.default.Labelmap],{fillAlpha:u,outlineWidth:f,renderFill:b,renderOutline:w}=v(o,m,c,l),{forceOpacityUpdate:E,forceColorUpdate:T}=y(e,C,i,{fillAlpha:u,renderFill:b,renderOutline:w,segmentColor:s,outlineWidth:f,segmentsHidden:d});if(T&&n.addRGBPoint(i,s[0]/h,s[1]/h,s[2]/h),E)if(b){const e=d.has(i)?0:s[3]/255*u;r.removePoint(i),r.addPointLong(i,e,.5,1)}else r.addPointLong(i,.01,.5,1)}const x=t.actor;x.getProperty().setRGBTransferFunction(0,n),r.setClamping(!1),x.getProperty().setScalarOpacity(0,r),x.getProperty().setInterpolationTypeToNearest(),x.getProperty().setUseLabelOutline(E),x.getProperty().setLabelOutlineOpacity(T);const{activeSegmentIndex:_}=s.getSegmentation(l.segmentationId),S=new Array(b-1);for(let e=1;e<b;e++){d.has(e)?S[e-1]=0:S[e-1]=e===_?w+o.activeSegmentOutlineWidthDelta:w}x.getProperty().setLabelOutlineThickness(S);const I=c||u;x.setVisibility(I)}(e.id,w,E,T,r,n.representations[a.default.Labelmap],t,i,x,d)},removeSegmentationRepresentation:function(e,t,n=!1){if(function(e,t){const n=(0,l.getToolGroup)(e);if(void 0===n)throw new Error(`ToolGroup with ToolGroupId ${e} does not exist`);const{viewportsInfo:r}=n;for(const e of r){const{viewportId:n,renderingEngineId:r}=e,i=(0,o.getEnabledElementByIds)(n,r);d(i.viewport.element,t)}}(e,t),s.removeSegmentationRepresentation(e,t),n){(0,l.getToolGroup)(e).getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{(0,o.getEnabledElementByIds)(e,t).viewport.render()})}}}},88286:(e,t,n)=>{"use strict";n.d(t,{G:()=>a,K:()=>o});var r=n(62709);function i(e){if("volumeId"in e){if(!r.cache.getVolume(e.volumeId))throw new Error(`volumeId of ${e.volumeId} not found in cache, you should load and cache volume before adding segmentation`)}else{if(!("imageIdReferenceMap"in e))throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData");if(!e.imageIdReferenceMap)throw new Error("The segmentationInput.representationData.imageIdReferenceMap is undefined, please provide a valid representationData.imageIdReferenceMap")}}function o(e){if(!e.representation.data)throw new Error("The segmentationInput.representationData.data is undefined, please provide a valid representationData.data");i(e.representation.data)}function a(e){i(e)}},61958:(e,t,n)=>{"use strict";n.d(t,{o:()=>m});var r=n(62709),i=n(60721),o=n(74297),a=n(27078);const s=function(e,t,n=!1){const i=(0,r.getEnabledElement)(e),{viewport:o}=i,a=o.getActors().map(({uid:e})=>e.startsWith(t)?e:void 0).filter(Boolean);o.removeActors(a)};var l=n(93702),c=n(16623),u=n(46576),d=n(17197),p=n(11510);const h=function(e,t,n){const i=(0,p.rX)(n,t.id),o=(0,r.getEnabledElement)(e),{viewport:a}=o,s=a.getActor(i)?.actor;if(s){const e=s.getMapper(),n=e.getInputData(),r=t.getPoints(),i=t.getPolys(),o=n.getPoints().getData(),l=n.getPolys().getData();if(r.length===o.length&&i.length===l.length)return;const c=u.ZP.newInstance();c.getPoints().setData(r,3);const p=d.ZP.newInstance({values:Float32Array.from(i)});return c.setPolys(p),e.setInputData(c),e.modified(),void setTimeout(()=>{a.getRenderer().resetCameraClippingRange()},0)}const h=t.getPoints(),f=t.getPolys(),m=t.getColor(),g=u.ZP.newInstance();g.getPoints().setData(h,3);const v=d.ZP.newInstance({values:Float32Array.from(f)});g.setPolys(v);const y=l.default.newInstance({});y.setInputData(g);const b=c.ZP.newInstance();b.setMapper(y),b.getProperty().setColor(m[0]/255,m[1]/255,m[2]/255),b.getProperty().setLineWidth(2),a.addActor({actor:b,uid:i,clippingFilter:undefined}),a.resetCamera(),a.render(),setTimeout(()=>{a.getRenderer().resetCameraClippingRange()},0)};var f=n(95482);const m={render:async function(e,t){const{colorLUTIndex:n,segmentationId:a,segmentationRepresentationUID:s}=t,l=i.getSegmentation(a);if(!l)return;if(!(e instanceof r.VolumeViewport3D))throw new Error("Surface rendering is only supported in 3D viewports, if you need to visualize the surface cuts in 2D viewports, you can use the Contour representation, see polySeg converters");let c=l.representationData[o.default.Surface];if(!c&&f.polySeg.canComputeRequestedRepresentation(s)&&(c=await f.polySeg.computeAndAddSurfaceRepresentation(a,{segmentationRepresentationUID:s}),!c))throw new Error(`No Surface data found for segmentationId ${a}.`);const{geometryIds:u}=c;u?.size||console.warn(`No Surfaces found for segmentationId ${a}. Skipping render.`);const d=i.getColorLUT(n),p=[];u.forEach((t,n)=>{const i=r.cache.getGeometry(t);if(!i?.data)return void console.warn(`No Surfaces found for geometryId ${t}. Skipping render.`);const o=i.data,a=d[n];o.setColor(a.slice(0,3)),h(e.element,o,s),p.push(o)}),e.render()},removeSegmentationRepresentation:function(e,t,n=!1){if(function(e,t){const n=(0,a.getToolGroup)(e);if(void 0===n)throw new Error(`ToolGroup with ToolGroupId ${e} does not exist`);const{viewportsInfo:i}=n;for(const e of i){const{viewportId:n,renderingEngineId:i}=e,o=(0,r.getEnabledElementByIds)(n,i);s(o.viewport.element,t)}}(e,t),i.removeSegmentationRepresentation(e,t),n){(0,a.getToolGroup)(e).getViewportsInfo().forEach(({viewportId:e,renderingEngineId:t})=>{(0,r.getEnabledElementByIds)(e,t).viewport.render()})}}}},95459:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(62709),i=n(72076),o=n(93382),a=n(92596),s=n(57624),l=n(62309),c=n(62455),u=n(68096),d=n(86785),p=n(23118),h=n(66878),f=n(95482),m=n(88439);class g extends o.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:l.TO,FILL_INSIDE_SPHERE:a.pR,THRESHOLD_INSIDE_CIRCLE:l.jV,THRESHOLD_INSIDE_SPHERE:a.Yo,ERASE_INSIDE_CIRCLE:c.x,ERASE_INSIDE_SPHERE:s.F,REPLACE_INSIDE_CIRCLE:l.Yr,REPLACE_INSIDE_SPHERE:a.Wv},strategySpecificConfiguration:{THRESHOLD:{threshold:[-1e3,3095]},REPLACE:{targetSegmentIndex:0}},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",thresholdVolumeId:null,brushSize:10,eraseFocusIndex:0,preview:{enabled:!1,previewColors:{},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[u.StrategyCallbacks.AcceptPreview]:{method:u.StrategyCallbacks.AcceptPreview,bindings:[{key:"Enter"}]},[u.StrategyCallbacks.RejectPreview]:{method:u.StrategyCallbacks.RejectPreview,bindings:[{key:"Escape"}]}}}}){super(e,t),this._previewData={preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1},this.onSetToolPassive=e=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=e=>{this.disableCursor()},this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,i=(0,r.getEnabledElement)(n),{renderingEngine:o}=i;this._editData=this.createEditData(n),this._activateDraw(n),(0,p.hideElementCursor)(n),e.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const a=this._hoverData||this.createHoverData(n);return(0,h.Z)(o,a.viewportIdsToRender),this.applyActiveStrategyCallback(i,this.getOperationData(n),u.StrategyCallbacks.OnInteractionStart),!0},this.mouseMoveCallback=e=>{if(this.mode===u.ToolModes.Active){if(this.updateCursor(e),!this.configuration.preview.enabled)return;const{previewTimeMs:t,previewMoveDistance:n,dragMoveDistance:r}=this.configuration.preview,{currentPoints:o,element:a}=e.detail,{canvas:s}=o,{preview:l,startPoint:c,timer:u,timerStart:d,isDrag:p}=this._previewData,h=i.K4.distance(s,c),f=Date.now()-d;if((h>n||f>t&&h>r)&&(u&&(window.clearTimeout(u),this._previewData.timer=null),l&&!p&&this.rejectPreview(a)),!this._previewData.timer){const e=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:e,startPoint:s,element:a})}}},this.previewCallback=()=>{this._previewData.preview||(this._previewData.timer=null,this._previewData.preview=this.applyActiveStrategyCallback((0,r.getEnabledElement)(this._previewData.element),this.getOperationData(this._previewData.element),u.StrategyCallbacks.Preview))},this._dragCallback=e=>{const t=e.detail,{element:n,currentPoints:o}=t,a=(0,r.getEnabledElement)(n),{renderingEngine:s}=a;this.updateCursor(e);const{viewportIdsToRender:l}=this._hoverData;(0,h.Z)(s,l);const c=i.K4.distance(o.canvas,this._previewData.startPoint),{dragTimeMs:u,dragMoveDistance:d}=this.configuration.preview;!this._previewData.isDrag&&this._previewData.preview&&Date.now()-this._previewData.timerStart<u&&c<d||(this._previewData.preview=this.applyActiveStrategy(a,this.getOperationData(n)),this._previewData.element=n,this._previewData.timerStart=Date.now()+u,this._previewData.isDrag=!0,this._previewData.startPoint=o.canvas)},this._endCallback=e=>{const t=e.detail,{element:n}=t,i=(0,r.getEnabledElement)(n),o=this.getOperationData(n);this._previewData.preview||this._previewData.isDrag||this.applyActiveStrategy(i,o),this._deactivateDraw(n),(0,p.resetElementCursor)(n),this.updateCursor(e),this._editData=null,this.applyActiveStrategyCallback(i,o,u.StrategyCallbacks.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(n)},this._activateDraw=e=>{e.addEventListener(u.Events.MOUSE_UP,this._endCallback),e.addEventListener(u.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(u.Events.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(u.Events.MOUSE_UP,this._endCallback),e.removeEventListener(u.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(u.Events.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}createEditData(e){const t=(0,r.getEnabledElement)(e),{viewport:n}=t,i=this.toolGroupId,o=f.activeSegmentation.getActiveSegmentationRepresentation(i);if(!o)throw new Error("No active segmentation detected, create a segmentation representation before using the brush tool");const{segmentationId:a,type:s,segmentationRepresentationUID:l}=o;if(s===u.SegmentationRepresentations.Contour)throw new Error("Not implemented yet");const c=f.segmentLocking.getLockedSegments(a),{representationData:d}=f.state.getSegmentation(a),p=d[u.SegmentationRepresentations.Labelmap];if((0,m.y)(p,n)){const{volumeId:e}=d[s],t=n.getActors();if(n instanceof r.StackViewport){const e=new CustomEvent(r.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return r.eventTarget.dispatchEvent(e),null}const i=t.map(e=>r.cache.getVolume(e.referenceId)),o=r.cache.getVolume(e),a=i.find(e=>r.utilities.isEqual(e.dimensions,o.dimensions))?.volumeId||i[0]?.volumeId;return{volumeId:e,referencedVolumeId:this.configuration.thresholdVolumeId??a,segmentsLocked:c,segmentationRepresentationUID:l}}{const{imageIdReferenceMap:e}=p,t=n.getCurrentImageId();if(!e.get(t))return;if(this.configuration.activeStrategy.includes("SPHERE"))throw new Error("Sphere manipulation is not supported for stacks of image segmentations yet");return{imageIdReferenceMap:e,segmentsLocked:c,segmentationRepresentationUID:l}}}createHoverData(e,t){const n=(0,r.getEnabledElement)(e),{viewport:i}=n,o=i.getCamera(),{viewPlaneNormal:a,viewUp:s}=o,l=[i.id],{segmentIndex:c,segmentationId:u,segmentationRepresentationUID:d,segmentColor:p}=this.getActiveSegmentationData()||{};return{brushCursor:{metadata:{viewPlaneNormal:[...a],viewUp:[...s],FrameOfReferenceUID:i.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:p},data:{}},centerCursorInWorld:t,segmentIndex:c,segmentationId:u,segmentationRepresentationUID:d,segmentColor:p,viewportIdsToRender:l}}getActiveSegmentationData(){const e=this.toolGroupId,t=f.activeSegmentation.getActiveSegmentationRepresentation(e);if(!t)return void console.warn("No active segmentation detected, create one before using the brush tool");const{segmentationRepresentationUID:n,segmentationId:r}=t,i=f.segmentIndex.getActiveSegmentIndex(r);return{segmentIndex:i,segmentationId:r,segmentationRepresentationUID:n,segmentColor:f.config.color.getColorForSegmentIndex(e,n,i)}}updateCursor(e){const t=e.detail,{element:n}=t,{currentPoints:i}=t,o=i.world;this._hoverData=this.createHoverData(n,o),this._calculateCursor(n,o),this._hoverData&&(0,h.Z)((0,r.getEnabledElement)(n).renderingEngine,this._hoverData.viewportIdsToRender)}getOperationData(e){const t=this._editData||this.createEditData(e),{segmentIndex:n,segmentationId:r,segmentationRepresentationUID:i,brushCursor:o}=this._hoverData||this.createHoverData(e),{data:a,metadata:s={}}=o||{},{viewPlaneNormal:l,viewUp:c}=s;return{...t,points:a?.handles?.points,segmentIndex:n,previewColors:this.configuration.preview.enabled?this.configuration.preview.previewColors:null,viewPlaneNormal:l,toolGroupId:this.toolGroupId,segmentationId:r,segmentationRepresentationUID:i,viewUp:c,strategySpecificConfiguration:this.configuration.strategySpecificConfiguration,eraseFocusIndex:this.configuration.eraseFocusIndex,preview:this._previewData?.preview}}_calculateCursor(e,t){const n=(0,r.getEnabledElement)(e),{viewport:o}=n,a=o.getCamera(),{brushSize:s}=this.configuration,l=i.R3.fromValues(a.viewUp[0],a.viewUp[1],a.viewUp[2]),c=i.R3.fromValues(a.viewPlaneNormal[0],a.viewPlaneNormal[1],a.viewPlaneNormal[2]),u=i.R3.create();i.R3.cross(u,l,c);const d=i.R3.create(),p=i.R3.create(),h=i.R3.create(),f=i.R3.create();for(let e=0;e<=2;e++)d[e]=t[e]-l[e]*s,p[e]=t[e]+l[e]*s,h[e]=t[e]-u[e]*s,f[e]=t[e]+u[e]*s;if(!this._hoverData)return;const{brushCursor:m}=this._hoverData,{data:g}=m;void 0===g.handles&&(g.handles={}),g.handles.points=[d,p,h,f];const v=this.configuration.activeStrategy,y=this.configuration.strategies[v];"function"==typeof y.computeInnerCircleRadius&&y.computeInnerCircleRadius({configuration:this.configuration,viewport:o}),g.invalidated=!1}rejectPreview(e=this._previewData.element){if(!e||!this._previewData.preview)return;const t=(0,r.getEnabledElement)(e);this.applyActiveStrategyCallback(t,this.getOperationData(e),u.StrategyCallbacks.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(e=this._previewData.element){if(!e)return;const t=(0,r.getEnabledElement)(e);this.applyActiveStrategyCallback(t,this.getOperationData(e),u.StrategyCallbacks.AcceptPreview),this._previewData.isDrag=!1,this._previewData.preview=null}invalidateBrushCursor(){if(void 0===this._hoverData)return;const{data:e}=this._hoverData.brushCursor;e.invalidated=!0;const{segmentColor:t}=this.getActiveSegmentationData()||{};this._hoverData.brushCursor.metadata.segmentColor=t}renderAnnotation(e,t){if(!this._hoverData)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;const r=this._hoverData.brushCursor;if(!0===r.data.invalidated){const{centerCursorInWorld:e}=this._hoverData,{element:t}=n;this._calculateCursor(t,e)}const i=r.metadata;if(!i)return;const o=i.brushCursorUID,a=r.data,{points:s}=a.handles,l=s.map(e=>n.worldToCanvas(e)),c=l[0],u=l[1],p=[Math.floor((c[0]+u[0])/2),Math.floor((c[1]+u[1])/2)],h=Math.abs(c[1]-Math.floor((c[1]+u[1])/2)),f=`rgb(${i.segmentColor?.slice(0,3)||[0,0,0]})`;if(!n.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");(0,d.drawCircle)(t,o,"0",p,h,{color:f});const m=this.configuration.activeStrategy,{dynamicRadiusInCanvas:g}=this.configuration.strategySpecificConfiguration[m]||{dynamicRadiusInCanvas:0};if(g){const e="1";(0,d.drawCircle)(t,o,e,p,g,{color:f})}}}g.toolName="Brush";const v=g},2023:(e,t,n)=>{"use strict";var r=n(62709),i=n(72076),o=n(68096),a=n(86614),s=n(11163),l=n(86785),c=n(46966),u=n(90685),d=n(41836),p=n(23118),h=n(66878),f=n(36705),m=n(87248),g=n(57776),v=n(92600),y=n(79454);const{transformWorldToIndex:b}=r.utilities;class C extends m.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{numSlicesToPropagate:10,calculatePointsInsideVolume:!1}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:i}=t,o=n.world,s=(0,r.getEnabledElement)(i),{viewport:l,renderingEngine:u}=s;this.isDrawing=!0;const d=l.getCamera(),{viewPlaneNormal:f,viewUp:m}=d;let g,v,y;if(l instanceof r.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(l);y=r.utilities.getVolumeId(e),v=r.cache.getVolume(y),g=r.utilities.getClosestImageId(v,o,f)}const b=r.utilities.getSpacingInNormalDirection(v,f),C=this._getStartSliceIndex(v,o,b,f),w=this._getEndSliceIndex(v,o,b,f),E=l.getFrameOfReferenceUID(),T={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...m],FrameOfReferenceUID:E,referencedImageId:g,volumeId:y,spacingInNormal:b,enabledElement:s},data:{label:"",startSlice:C,endSlice:w,handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...o],[...o]],activeHandleIndex:null},cachedStats:{pointsInVolume:[],projectionPoints:[]},labelmapUID:null}};(0,a.addAnnotation)(T,i);const x=(0,c.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:T,viewportIdsToRender:x,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),(0,p.hideElementCursor)(i),e.preventDefault(),(0,h.Z)(u,x),T},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:o,newAnnotation:s,hasMoved:l}=this.editData,{data:c}=i;if(s&&!l)return;i.highlighted=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,p.resetElementCursor)(n);const u=(0,r.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,a.removeAnnotation)(i.annotationUID);const d=this.getTargetId(u.viewport),m=r.cache.getVolume(d.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(i,m,u),(0,h.Z)(u.renderingEngine,o),s&&(0,f.F$)(i)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:r}=e,i=(0,a.getAnnotations)(this.getToolName(),r.element);if(!i?.length)return n;const o=r.getCurrentImageIdIndex(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let a=0;a<i.length;a++){const u=i[a],{annotationUID:p,data:h}=u,{startSlice:f,endSlice:m}=h,{points:v,activeHandleIndex:y}=h.handles;c.annotationUID=p;const b=this.getStyle("lineWidth",c,u),C=this.getStyle("lineDash",c,u),w=this.getStyle("color",c,u),E=v.map(e=>r.worldToCanvas(e)),T=E[0],x=(0,g.t)(E),{centerPointRadius:_}=this.configuration;if(o<Math.min(f,m)||o>Math.max(f,m))continue;u.invalidated&&this._throttledCalculateCachedStats(u,e);let S,I=!1;if(o===Math.round((f+m)/2)&&(I=!0),!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,d.isAnnotationVisible)(p))continue;if((0,s.isAnnotationLocked)(u)||this.editData||null===y||!I||(S=[E[y]]),S){const e="0";(0,l.drawHandles)(t,p,e,S,{color:w})}let D=b;I&&(D=3);const A="0";(0,l.drawCircle)(t,p,A,T,x,{color:w,lineDash:C,lineWidth:D}),_>0&&x>3*_&&(0,l.drawCircle)(t,p,`${A}-center`,T,_,{color:w,lineDash:C,lineWidth:b}),n=!0}return n},this._throttledCalculateCachedStats=(0,u.Z)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:r}=e,{viewPlaneNormal:o,spacingInNormal:a}=r,{imageData:s}=t,{startSlice:l,endSlice:c}=n,{points:u}=n.handles,d=b(s,u[0]);if(d[2]=l,d[2]!==l)throw new Error("Start slice does not match");const p=i.R3.fromValues(d[0],d[1],c),h=i.R3.create();s.indexToWorldVec3(d,h);const f=i.R3.create();s.indexToWorldVec3(p,f);const m=i.R3.distance(h,f),g=[];for(let e=0;e<m;e+=a)g.push(u.map(t=>{const n=i.R3.create();return i.R3.scaleAndAdd(n,t,o,e),Array.from(n)}));n.cachedStats.projectionPoints=g}_computePointsInsideVolume(e,t,n){const{data:r}=e,{viewport:i}=n,o=r.cachedStats.projectionPoints,a=[[]];for(let e=0;e<o.length;e++){if(!t)continue;const n=o[e][0],r=o[e].map(e=>i.worldToCanvas(e)),[s,l]=(0,g.$)(r),c=i.canvasToWorld(s),u=i.canvasToWorld(l),d=c,p=u,{dimensions:h,imageData:f}=t,m=b(f,d),C=b(f,n);m[0]=Math.floor(m[0]),m[1]=Math.floor(m[1]),m[2]=Math.floor(C[2]);const w=b(f,p);if(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.floor(C[2]),this._isInsideVolume(m,w,h)){const e=[[Math.min(m[0],w[0]),Math.max(m[0],w[0])],[Math.min(m[1],w[1]),Math.max(m[1],w[1])],[Math.min(m[2],w[2]),Math.max(m[2],w[2])]],t={center:n,xRadius:Math.abs(c[0]-u[0])/2,yRadius:Math.abs(c[1]-u[1])/2,zRadius:Math.abs(c[2]-u[2])/2},r=(0,y.pointInShapeCallback)(f,e=>(0,v.pointInEllipse)(t,e),null,e);a.push(r)}}r.cachedStats.pointsInVolume=a}_calculateCachedStatsTool(e,t){const n=e.data,{viewportId:i,renderingEngineId:a,viewport:s}=t,{cachedStats:l}=n,c=this.getTargetId(s),u=r.cache.getVolume(c.split(/volumeId:|\?/)[1]);this._computeProjectionPoints(e,u),e.invalidated=!1;const d=o.Events.ANNOTATION_MODIFIED,p={annotation:e,viewportId:i,renderingEngineId:a};return(0,r.triggerEvent)(r.eventTarget,d,p),l}_getStartSliceIndex(e,t,n,r){const o=this.configuration.numSlicesToPropagate,a=Math.round(o/2),s=i.R3.create();i.R3.scaleAndAdd(s,t,r,a*-n);return this._getImageIdIndex(e,s,n,r)}_getEndSliceIndex(e,t,n,r){const o=this.configuration.numSlicesToPropagate,a=Math.round(o/2),s=i.R3.create();i.R3.scaleAndAdd(s,t,r,a*n);return this._getImageIdIndex(e,s,n,r)}_getImageIdIndex(e,t,n,o){const a=n/2,{imageIds:s}=e;let l;for(let e=0;e<s.length;e++){const n=s[e],{imagePositionPatient:c}=r.metaData.get("imagePlaneModule",n),u=i.R3.create();i.R3.sub(u,t,c);const d=i.R3.dot(u,o);Math.abs(d)<a&&(l=e)}return l}}C.toolName="CircleROIStartEndThreshold"},30809:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(62309),a=n(62455),s=n(68096),l=n(86785),c=n(23118),u=n(66878),d=n(95482),p=n(60721),h=n(88439);class f extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:o.TO,ERASE_INSIDE:a.x},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE",eraseFocusIndex:0}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:i}=t,o=n.world,a=n.canvas,s=(0,r.getEnabledElement)(i),{viewport:l,renderingEngine:f}=s;this.isDrawing=!0;const m=l.getCamera(),{viewPlaneNormal:g,viewUp:v}=m,y=this.toolGroupId,b=d.activeSegmentation.getActiveSegmentationRepresentation(y);if(!b)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationRepresentationUID:C,segmentationId:w,type:E}=b,T=d.segmentIndex.getActiveSegmentIndex(w),x=d.segmentLocking.getLockedSegments(w),_=d.config.color.getColorForSegmentIndex(y,C,T),{representationData:S}=(0,p.getSegmentation)(w),I=S[E];if(!I)throw new Error("No labelmap data found for the active segmentation, create one before using scissors tool");const D={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:[...g],viewUp:[...v],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:_},data:{handles:{points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},A=[l.id];if(this.editData={annotation:D,centerCanvas:a,segmentIndex:T,segmentationId:w,segmentsLocked:x,segmentColor:_,viewportIdsToRender:A,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,segmentationRepresentationUID:C},(0,h.y)(I,l)){const{volumeId:e}=I,t=r.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else{const{imageIdReferenceMap:e}=I;this.editData={...this.editData,imageIdReferenceMap:e}}return this._activateDraw(i),(0,c.hideElementCursor)(i),e.preventDefault(),(0,u.Z)(f,A),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:i}=t,o=i.canvas,a=(0,r.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:d,viewportIdsToRender:p,centerCanvas:h}=this.editData,{data:f}=d,m=Math.abs(o[0]-h[0]),g=Math.abs(o[1]-h[1]),v=Math.sqrt(m*m+g*g),y=[h[0],h[1]+v],b=[h[0],h[1]-v],C=[h[0]-v,h[1]],w=[h[0]+v,h[1]];f.handles.points=[c(y),c(b),c(C),c(w)],d.invalidated=!0,this.editData.hasMoved=!0,(0,u.Z)(s,p)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,newAnnotation:o,hasMoved:a}=this.editData,{data:s}=i,{viewPlaneNormal:l,viewUp:u}=i.metadata;if(o&&!a)return;s.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,c.resetElementCursor)(n);const d=(0,r.getEnabledElement)(n),p={...this.editData,points:s.handles.points,viewPlaneNormal:l,viewUp:u,strategySpecificConfiguration:{},eraseFocusIndex:this.configuration.eraseFocusIndex};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(d,p)},this._activateDraw=e=>{e.addEventListener(s.Events.MOUSE_UP,this._endCallback),e.addEventListener(s.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(s.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(s.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(s.Events.TOUCH_TAP,this._endCallback),e.addEventListener(s.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(s.Events.TOUCH_END,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(s.Events.MOUSE_UP,this._endCallback),e.removeEventListener(s.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(s.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(s.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(s.Events.TOUCH_END,this._endCallback),e.removeEventListener(s.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(s.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:r}=e,{viewportIdsToRender:i}=this.editData;if(!i.includes(r.id))return n;const{annotation:o}=this.editData,a=o.metadata,s=o.annotationUID,c=o.data,{points:u}=c.handles,d=u.map(e=>r.worldToCanvas(e)),p=d[0],h=d[1],f=[Math.floor((p[0]+h[0])/2),Math.floor((p[1]+h[1])/2)],m=Math.abs(p[1]-Math.floor((p[1]+h[1])/2)),g=`rgb(${a.segmentColor.slice(0,3)})`;if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,l.drawCircle)(t,s,"0",f,m,{color:g}),n=!0,n}}}f.toolName="CircleScissor"},78566:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(68096),a=n(32140),s=n(95482),l=n(2680),c=n(60721),u=n(88439);const{transformWorldToIndex:d,isEqual:p}=r.utilities;class h extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.preMouseDownCallback=e=>{const t=e.detail,{currentPoints:n,element:i}=t,p=n.world,h=(0,r.getEnabledElement)(i),{viewport:f}=h,m=f.getCamera(),{viewPlaneNormal:g}=m,v=this.toolGroupId,y=s.activeSegmentation.getActiveSegmentationRepresentation(v);if(!y)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:b,type:C}=y,w=s.segmentIndex.getActiveSegmentIndex(b),E=s.segmentLocking.getLockedSegments(b),{representationData:T}=(0,c.getSegmentation)(b),x=T[o.SegmentationRepresentations.Labelmap];let _,S,I,D;if((0,u.y)(x,f)){const{volumeId:e}=T[C],t=r.cache.getVolume(e);({dimensions:_,direction:S}=t),I=t.getScalarData(),D=d(t.imageData,p)}else{const{imageIdReferenceMap:e}=x,t=h.viewport.getCurrentImageId(),n=e.get(t);if(!n)throw new Error("No active segmentation imageId detected, create one before using scissors tool");const i=r.cache.getImage(n);I=i.getPixelData();const{imageData:o}=f.getImageData();_=o.getDimensions(),S=o.getDirection(),D=d(o,p)}const A=this.getFixedDimension(g,S);if(void 0===A)return void console.warn("Oblique paint fill not yet supported");const{floodFillGetter:P,getLabelValue:O,getScalarDataPositionFromPlane:R,inPlaneSeedPoint:M,fixedDimensionValue:N}=this.generateHelpers(I,_,D,A);if(D[0]<0||D[0]>=_[0]||D[1]<0||D[1]>=_[1]||D[2]<0||D[2]>=_[2])return;const L=O(D[0],D[1],D[2]);if(E.includes(L))return;const k=(0,l.Z)(P,M),{flooded:F}=k;F.forEach(e=>{const t=R(e[0],e[1]);I[t]=w});const V=this.getFramesModified(A,N,k);return(0,a.triggerSegmentationDataModified)(b,V),!0},this.getFramesModified=(e,t,n)=>{const{boundaries:r}=n;if(2===e)return[t];let i=1/0,o=-1/0;for(let e=0;e<r.length;e++){const t=r[e][1];t<i&&(i=t),t>o&&(o=t)}const a=[];for(let e=i;e<=o;e++)a.push(e);return a},this.generateHelpers=(e,t,n,r=2)=>{let i,o;switch(r){case 0:i=n[0],o=[n[1],n[2]];break;case 1:i=n[1],o=[n[0],n[2]];break;case 2:i=n[2],o=[n[0],n[1]];break;default:throw new Error(`Invalid fixedDimension: ${r}`)}const a=(e,n,r)=>r*t[1]*t[0]+n*t[0]+e,s=(t,n,r)=>e[a(t,n,r)],l=this.generateFloodFillGetter(t,r,i,s);return{getScalarDataPositionFromPlane:this.generateGetScalarDataPositionFromPlane(a,r,i),getLabelValue:s,floodFillGetter:l,inPlaneSeedPoint:o,fixedDimensionValue:i}},this.generateFloodFillGetter=(e,t,n,r)=>{let i;switch(t){case 0:i=(t,i)=>{if(!(t>=e[1]||t<0||i>=e[2]||i<0))return r(n,t,i)};break;case 1:i=(t,i)=>{if(!(t>=e[0]||t<0||i>=e[2]||i<0))return r(t,n,i)};break;case 2:i=(t,i)=>{if(!(t>=e[0]||t<0||i>=e[1]||i<0))return r(t,i,n)};break;default:throw new Error(`Invalid fixedDimension: ${t}`)}return i},this.generateGetScalarDataPositionFromPlane=(e,t,n)=>{let r;switch(t){case 0:r=(t,r)=>e(n,t,r);break;case 1:r=(t,r)=>e(t,n,r);break;case 2:r=(t,r)=>e(t,r,n);break;default:throw new Error(`Invalid fixedDimension: ${t}`)}return r}}getFixedDimension(e,t){const n=t.slice(0,3),r=t.slice(3,6),i=t.slice(6,9),o=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],a=[Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])];if(p(o,a))return 0;const s=[Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2])];if(p(o,s))return 1;const l=[Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2])];return p(o,l)?2:void 0}}h.toolName="PaintFill"},38207:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(25429);function a(e,t,n=!0){const r=Object.assign({},t,{segmentIndex:0});(0,o.h)(e,r)}function s(e,t){a(e,t,!0)}var l=n(46966),c=n(68096),u=n(86785),d=n(23118),p=n(66878),h=n(95482),f=n(60721),m=n(88439);class g extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:o.h,ERASE_INSIDE:s},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE",eraseFocusIndex:0}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:i}=t,o=n.world,a=(0,r.getEnabledElement)(i),{viewport:s,renderingEngine:u}=a;this.isDrawing=!0;const g=s.getCamera(),{viewPlaneNormal:v,viewUp:y}=g,b=this.toolGroupId,C=h.activeSegmentation.getActiveSegmentationRepresentation(b);if(!C)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationRepresentationUID:w,segmentationId:E,type:T}=C,x=h.segmentIndex.getActiveSegmentIndex(E),_=h.segmentLocking.getLockedSegments(E),S=h.config.color.getColorForSegmentIndex(b,w,x),{representationData:I}=(0,f.getSegmentation)(E),D=I[c.SegmentationRepresentations.Labelmap],A={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...v],viewUp:[...y],FrameOfReferenceUID:s.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:S},data:{handles:{points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null}}},P=(0,l.getViewportIdsWithToolToRender)(i,this.getToolName());if(this.editData={annotation:A,segmentIndex:x,segmentationId:E,segmentsLocked:_,segmentColor:S,viewportIdsToRender:P,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,segmentationRepresentationUID:w},(0,m.y)(D,s)){const{volumeId:e}=D,t=r.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else{const{imageIdReferenceMap:e}=D;this.editData={...this.editData,imageIdReferenceMap:e}}return this._activateDraw(i),(0,d.hideElementCursor)(i),e.preventDefault(),(0,p.Z)(u,P),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:o,handleIndex:a}=this.editData,{data:s}=i,{currentPoints:l}=t,c=(0,r.getEnabledElement)(n),{worldToCanvas:u,canvasToWorld:d}=c.viewport,h=l.world,{points:f}=s.handles;let m,g,v,y,b,C,w,E;switch(f[a]=[...h],a){case 0:case 3:m=u(f[0]),y=u(f[3]),g=[y[0],m[1]],v=[m[0],y[1]],C=d(g),w=d(v),f[1]=C,f[2]=w;break;case 1:case 2:g=u(f[1]),v=u(f[2]),m=[v[0],g[1]],y=[g[0],v[1]],b=d(m),E=d(y),f[0]=b,f[3]=E}i.invalidated=!0,this.editData.hasMoved=!0;const{renderingEngine:T}=c;(0,p.Z)(T,o)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,newAnnotation:o,hasMoved:a}=this.editData,{data:s}=i;if(o&&!a)return;s.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,d.resetElementCursor)(n);const l=(0,r.getEnabledElement)(n),c={...this.editData,points:s.handles.points,eraseFocusIndex:this.configuration.eraseFocusIndex};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(l,c)},this._activateDraw=e=>{e.addEventListener(c.Events.MOUSE_UP,this._endCallback),e.addEventListener(c.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(c.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(c.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(c.Events.TOUCH_END,this._endCallback),e.addEventListener(c.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(c.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(c.Events.MOUSE_UP,this._endCallback),e.removeEventListener(c.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(c.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(c.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(c.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(c.Events.TOUCH_END,this._endCallback),e.removeEventListener(c.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:r}=e,{annotation:i}=this.editData,o=i.metadata,a=i.annotationUID,s=i.data,{points:l}=s.handles,c=l.map(e=>r.worldToCanvas(e)),d=`rgb(${o.segmentColor.slice(0,3)})`;if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,u.drawRect)(t,a,"0",c[0],c[3],{color:d}),n=!0,n}}}g.toolName="RectangleScissor"},45986:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(32140),a=n(66878),s=n(46629),l=n(74297),c=n(43850),u=n(68203),d=n(33232);class p extends i.ml{static{this.SelectMode={Inside:"Inside",Border:"Border"}}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,mode:p.SelectMode.Border,searchRadius:6}}){super(e,t),this.mouseMoveCallback=e=>(this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setActiveSegment(e),this.hoverTimer=null},this.configuration.hoverTimeout),!0),this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.hoverTimer=null}_setActiveSegment(e={}){if(d.SB.isInteractingWithTool)return;const{element:t,currentPoints:n}=e.detail,i=n.world,o=(0,r.getEnabledElement)(t);if(!o)return;const{viewport:a}=o,c=(0,s.getActiveSegmentationRepresentation)(this.toolGroupId);if(!c)return;[l.default.Labelmap,l.default.Contour].includes(c.type)?this._setActiveSegmentForType(c,i,a):console.warn("SegmentSelectTool does not support the current segmentation type.")}_setActiveSegmentForType(e,t,n){if(!n.getImageData())return;const{segmentationId:r,type:i}=e;let s;if(this.configuration.mode===p.SelectMode.Inside)s=(0,u.getSegmentAtWorldPoint)(r,t,{viewport:n});else switch(i){case l.default.Labelmap:s=(0,u.getSegmentAtLabelmapBorder)(r,t,{viewport:n,searchRadius:this.configuration.searchRadius});break;case l.default.Contour:s=(0,u.getHoveredContourSegmentationAnnotation)(r)}if(!s||0===s)return;(0,c.setActiveSegmentIndex)(r,s);const d=n.getRenderingEngine(),h=d.getViewports().map(e=>e.id);(0,o.triggerSegmentationModified)(r),(0,a.Z)(d,h)}}p.toolName="SegmentSelectTool"},30862:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=n(92596),a=n(57624),s=n(68096),l=n(86785),c=n(23118),u=n(66878),d=n(95482),p=n(60721),h=n(88439);class f extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:o.pR,ERASE_INSIDE:a.F},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE",eraseFocusIndex:0}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:i}=t,o=n.world,a=n.canvas,l=(0,r.getEnabledElement)(i),{viewport:f,renderingEngine:m}=l;this.isDrawing=!0;const g=f.getCamera(),{viewPlaneNormal:v,viewUp:y}=g,b=this.toolGroupId,C=d.activeSegmentation.getActiveSegmentationRepresentation(b);if(!C)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationRepresentationUID:w,segmentationId:E}=C,T=d.segmentIndex.getActiveSegmentIndex(E),x=d.segmentLocking.getLockedSegments(E),_=d.config.color.getColorForSegmentIndex(b,w,T);this.isDrawing=!0;const S={metadata:{viewPlaneNormal:[...v],viewUp:[...y],FrameOfReferenceUID:f.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:_},data:{invalidated:!0,handles:{points:[[...o],[...o],[...o],[...o]],activeHandleIndex:null},cachedStats:{},highlighted:!0}},I=[f.id];this.editData={annotation:S,centerCanvas:a,segmentationRepresentationUID:w,segmentIndex:T,segmentationId:E,segmentsLocked:x,segmentColor:_,toolGroupId:b,viewportIdsToRender:I,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1};const{representationData:D}=(0,p.getSegmentation)(E),A=D[s.SegmentationRepresentations.Labelmap];if((0,h.y)(A,f)){const{volumeId:e}=A,t=r.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else{const{imageIdReferenceMap:e}=A;this.editData={...this.editData,imageIdReferenceMap:e}}return this._activateDraw(i),(0,c.hideElementCursor)(i),e.preventDefault(),(0,u.Z)(m,I),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:i}=t,o=i.canvas,a=(0,r.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:c}=l,{annotation:d,viewportIdsToRender:p,centerCanvas:h}=this.editData,{data:f}=d,m=Math.abs(o[0]-h[0]),g=Math.abs(o[1]-h[1]),v=Math.sqrt(m*m+g*g),y=[h[0],h[1]+v],b=[h[0],h[1]-v],C=[h[0]-v,h[1]],w=[h[0]+v,h[1]];f.handles.points=[c(y),c(b),c(C),c(w)],d.invalidated=!0,this.editData.hasMoved=!0,(0,u.Z)(s,p)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,newAnnotation:o,hasMoved:a,segmentIndex:s,segmentationRepresentationUID:l,segmentsLocked:u}=this.editData,{data:d}=i,{viewPlaneNormal:p,viewUp:h}=i.metadata;if(o&&!a)return;i.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,c.resetElementCursor)(n);const f=(0,r.getEnabledElement)(n),m={...this.editData,points:d.handles.points,segmentIndex:s,segmentationRepresentationUID:l,segmentsLocked:u,viewPlaneNormal:p,viewUp:h,eraseFocusIndex:this.configuration.eraseFocusIndex};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(f,m)},this._activateDraw=e=>{e.addEventListener(s.Events.MOUSE_UP,this._endCallback),e.addEventListener(s.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(s.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(s.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(s.Events.TOUCH_END,this._endCallback),e.addEventListener(s.Events.TOUCH_TAP,this._endCallback),e.addEventListener(s.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{e.removeEventListener(s.Events.MOUSE_UP,this._endCallback),e.removeEventListener(s.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(s.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(s.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(s.Events.TOUCH_END,this._endCallback),e.removeEventListener(s.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(s.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:r}=e,{viewportIdsToRender:i}=this.editData;if(!i.includes(r.id))return n;const{annotation:o}=this.editData,a=o.metadata,s=o.annotationUID,c=o.data,{points:u}=c.handles,d=u.map(e=>r.worldToCanvas(e)),p=d[0],h=d[1],f=[Math.floor((p[0]+h[0])/2),Math.floor((p[1]+h[1])/2)],m=Math.abs(p[1]-Math.floor((p[1]+h[1])/2)),g=`rgb(${a.segmentColor.slice(0,3)})`;if(!r.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,l.drawCircle)(t,s,"0",f,m,{color:g}),n=!0,n}}}f.toolName="SphereScissor"},99787:(e,t,n)=>{"use strict";var r=n(62709),i=n(93382),o=(n(25429),n(62309),n(32140));function a(e,t){const{volume:n,segmentationId:r,oldScalarData:i}=t,a=n.getScalarData();for(let e=0;e<a.length;e++)a[e]=i[e];(0,o.triggerSegmentationDataModified)(r)}var s=n(95482);class l extends i.ml{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_REPLACE:a},defaultStrategy:"FILL_REPLACE",activeStrategy:"FILL_REPLACE"}}){super(e,t),this.onSetToolPassive=()=>{window.addEventListener("replace",this.applyReplaceCallback)},this.applyReplaceCallback=e=>{const{element:t,oldScalarData:n}=e.detail,i=this.toolGroupId,o=s.activeSegmentation.getActiveSegmentationRepresentation(i);if(!o)throw new Error("No active segmentation detected, create one before using the brush tool");const{segmentationId:a,type:l}=o,{representationData:c}=s.state.getSegmentation(a),{volumeId:u}=c[l],d={volume:r.cache.getVolume(u),segmentationId:a,oldScalarData:n},p=(0,r.getEnabledElement)(t);this.applyActiveStrategy(p,d)}}}l.toolName="Undo"},25029:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(62709),i=n(32140),o=n(6858),a=n(91322),s=n(68096);const{VoxelManager:l}=r.utilities;class c{static{this.COMPOSITIONS=o.Z}static{this.childFunctions={[s.StrategyCallbacks.OnInteractionStart]:u(s.StrategyCallbacks.OnInteractionStart,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.OnInteractionEnd]:u(s.StrategyCallbacks.OnInteractionEnd,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.Fill]:u(s.StrategyCallbacks.Fill),[s.StrategyCallbacks.Initialize]:u(s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.CreateIsInThreshold]:d(s.StrategyCallbacks.CreateIsInThreshold),[s.StrategyCallbacks.CreateIsTargetSegment]:d(s.StrategyCallbacks.CreateIsTargetSegment),[s.StrategyCallbacks.AcceptPreview]:u(s.StrategyCallbacks.AcceptPreview,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.RejectPreview]:u(s.StrategyCallbacks.RejectPreview,s.StrategyCallbacks.Initialize),[s.StrategyCallbacks.INTERNAL_setValue]:d(s.StrategyCallbacks.INTERNAL_setValue),[s.StrategyCallbacks.Preview]:d(s.StrategyCallbacks.Preview,!1),[s.StrategyCallbacks.ComputeInnerCircleRadius]:u(s.StrategyCallbacks.ComputeInnerCircleRadius),compositions:null}}constructor(e,...t){this._initialize=[],this._fill=[],this._onInteractionStart=[],this.fill=(e,t)=>{const n=this.initialize(e,t,s.StrategyCallbacks.Fill);if(!n)return;const{strategySpecificConfiguration:o={},centerIJK:a}=n;if(r.utilities.isEqual(a,o.centerIJK))return t.preview;o.centerIJK=a,this._fill.forEach(e=>e(n));const{segmentationVoxelManager:l,previewVoxelManager:c,previewSegmentIndex:u}=n;return(0,i.triggerSegmentationDataModified)(n.segmentationId,l.getArrayOfSlices()),u&&c.modifiedSlices.size?n.preview||n:null},this.onInteractionStart=(e,t)=>{const{preview:n}=t;if(n?.isPreviewFromHover)return void(n.isPreviewFromHover=!1);const r=this.initialize(e,t);r&&this._onInteractionStart.forEach(e=>e.call(this,r))},this.configurationName=e,this.compositions=t,t.forEach(e=>{const t="function"==typeof e?e():e;if(t)for(const e in t){if(!c.childFunctions[e])throw new Error(`Didn't find ${e} as a brush strategy`);c.childFunctions[e](this,t[e])}}),this.strategyFunction=(e,t)=>this.fill(e,t);for(const e of Object.keys(c.childFunctions))this.strategyFunction[e]=this[e]}initialize(e,t,n){const{viewport:r}=e,i=(0,a.L)({operationData:t,viewport:r});if(!i)return console.warn("No data found for BrushStrategy"),t.preview;const{imageVoxelManager:o,segmentationVoxelManager:s,segmentationImageData:c}=i,u=t.preview?.previewVoxelManager||l.createHistoryVoxelManager(s),d={operationName:n,previewSegmentIndex:!!t.previewColors?255:void 0,...t,enabledElement:e,imageVoxelManager:o,segmentationVoxelManager:s,segmentationImageData:c,previewVoxelManager:u,viewport:r,centerWorld:null,brushStrategy:this};return this._initialize.forEach(e=>e(d)),d}}function u(e,t){const n=`_${e}`;return(r,i)=>{r[n]||=[],r[n].push(i),r[e]||=t?(i,o)=>{const a=r[t](i,o,e);r[n].forEach(e=>e.call(r,a))}:e=>{r[n].forEach(t=>t.call(r,e))}}}function d(e,t=!0){return(n,r)=>{if(n[e])throw new Error(`The singleton method ${e} already exists`);n[e]=t?r:(e,t)=>(t.enabledElement=e,r.call(n,t))}}},6858:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r=n(31955),i=n(39708);const o={[i.Z.Initialize]:e=>{const{strategySpecificConfiguration:t}=e;if(!t)return;const{centerSegmentIndex:n}=t;n&&(e.segmentIndex=n.segmentIndex)},[i.Z.OnInteractionStart]:e=>{const{segmentIndex:t,previewSegmentIndex:n,segmentationVoxelManager:i,centerIJK:o,strategySpecificConfiguration:a,imageVoxelManager:s,segmentationImageData:l,preview:c}=e;if(!a?.useCenterSegmentIndex)return;delete a.centerSegmentIndex;let u=!1,d=!1;if((0,r.Z)(l,s.isInObject,({value:e})=>{u||=e===t,d||=e===n},i.boundsIJK),!u&&!d)return;let p=i.getAtIJKPoint(o);if(p===n){if(!c)return;p=c.segmentIndex}else d&&(p=null);e.segmentIndex=p,a.centerSegmentIndex={segmentIndex:p}}};var a=n(72076);const s={[i.Z.Initialize]:e=>{const{operationName:t,centerIJK:n,strategySpecificConfiguration:r,segmentationVoxelManager:o,imageVoxelManager:s,segmentIndex:l}=e,{THRESHOLD:c}=r;if(!c?.isDynamic||!n||!l)return;if(t===i.Z.RejectPreview||t===i.Z.OnInteractionEnd)return;const{boundsIJK:u}=o,{threshold:d,dynamicRadius:p=0}=c,h=d?0:p,f=u.map((e,t)=>{const[r,i]=e;return[Math.max(r,n[t]-h),Math.min(i,n[t]+h)]}),m=d||[1/0,-1/0];s.forEach(({value:e})=>{const t=Array.isArray(e)?a.R3.len(e):e;m[0]=Math.min(t,m[0]),m[1]=Math.max(t,m[1])},{boundsIJK:f}),e.strategySpecificConfiguration.THRESHOLD.threshold=m},[i.Z.OnInteractionStart]:e=>{const{strategySpecificConfiguration:t,preview:n}=e;(t?.THRESHOLD?.isDynamic||n)&&(t.THRESHOLD.threshold=null)},[i.Z.ComputeInnerCircleRadius]:e=>{const{configuration:t,viewport:n}=e,{THRESHOLD:{dynamicRadius:r=0}={}}=t.strategySpecificConfiguration||{};if(0===r)return;const{spacing:i}=n.getImageData(),o=[n.element.clientWidth/2,n.element.clientHeight/2],a=r*i[0],s=n.canvasToWorld(o).map(e=>e+a),l=n.worldToCanvas(s),c=Math.abs(o[0]-l[0]),{strategySpecificConfiguration:u,activeStrategy:d}=t;u[d]||(u[d]={}),u[d].dynamicRadiusInCanvas=c}},l={[i.Z.Initialize]:e=>{e.segmentIndex=0}};var c=n(2680),u=n(32140);const d={[i.Z.OnInteractionEnd]:e=>{const{previewVoxelManager:t,segmentationVoxelManager:n,strategySpecificConfiguration:r,previewSegmentIndex:i,segmentIndex:o}=e;if(!r.THRESHOLD||null===o)return;const a=t.getPoints();if(!a?.length)return;if(void 0===i)return;const s=t.getBoundsIJK().map((e,t)=>[Math.min(e[0],...a.map(e=>e[t])),Math.max(e[1],...a.map(e=>e[t]))]);if(s.find(e=>e[0]<0||e[1]>65535))return;const l=new Set,d=(e,t,r)=>{if(e<s[0][0]||e>s[0][1]||t<s[1][0]||t>s[1][1]||r<s[2][0]||r>s[2][1])return-1;const a=n.toIndex([e,t,r]);if(l.has(a))return-2;const c=n.getAtIndex(a),u=c===i||c===o?1:0;return u||n.addPoint(a),u};let p=0;const h=(e,r,o)=>{const a=n.toIndex([e,r,o]);l.has(a)||(t.setAtIJK(e,r,o,i),l.add(a),p++)};a.forEach(e=>{1===d(...e)&&(0,c.Z)(d,e,{onFlood:h,diagonals:!0})});let f=0,m=0;t.forEach(({index:e,pointIJK:r,value:a})=>{const s=n.getAtIndex(e);if(l.has(e)){m++;const e=a===o?o:i;t.setAtIJKPoint(r,e)}else if(s===i){f++;const e=a??0;t.setAtIJKPoint(r,e)}},{}),p-m!==0&&console.warn("There were flooded=",p,"cleared=",f,"preview count=",m,"not handled",p-m);const g=new Set(n.points||[]);l.clear();for(const e of g.keys()){if(l.has(e))continue;let n=!0;const r=new Set,o=(e,i,o)=>{const a=t.toIndex([e,i,o]);l.add(a),(s[0][0]===s[0][1]||e!==s[0][0]&&e!==s[0][1])&&(s[1][0]===s[1][1]||i!==s[1][0]&&i!==s[1][1])&&(s[2][0]===s[2][1]||o!==s[2][0]&&o!==s[2][1])||(n=!1),n&&r.add(a)},a=t.toIJK(e);if(0===d(...a)&&((0,c.Z)(d,a,{onFlood:o,diagonals:!1}),n))for(const e of r)t.setAtIndex(e,i)}(0,u.triggerSegmentationDataModified)(e.segmentationId,t.getArrayOfSlices())}};var p=n(95482);const h={[i.Z.Preview]:function(e){const{previewColors:t,strategySpecificConfiguration:n,enabledElement:r}=e;if(!t||!n)return;e.preview&&delete e.preview,delete n.centerSegmentIndex,this.onInteractionStart?.(r,e);const i=this.fill(r,e);return i&&(i.isPreviewFromHover=!0,e.preview=i,this.onInteractionEnd?.(r,e)),i},[i.Z.Initialize]:e=>{const{toolGroupId:t,segmentIndex:n,segmentationRepresentationUID:r,previewSegmentIndex:i,previewColors:o,preview:a}=e;if(void 0===o)return;if(a&&(a.previewVoxelManager.sourceVoxelManager=e.segmentationVoxelManager,e.previewVoxelManager=a.previewVoxelManager),null===n||!i)return;const s=o?.[n],l=p.config.color.getColorForSegmentIndex(t,r,n);if(!s&&!l)return;const c=s||function(e,t,n,r,i=.4){return[Math.round(e+(255-e)*i),Math.round(t+(255-t)*i),Math.round(n+(255-n)*i),r]}(...l);p.config.color.setColorForSegmentIndex(t,r,i,c)},[i.Z.AcceptPreview]:e=>{const{segmentationVoxelManager:t,previewVoxelManager:n,previewSegmentIndex:r,preview:i}=e||{};if(void 0===r)return;const o=i?.segmentIndex??e.segmentIndex,a=n;if(!a||0===a.modifiedSlices.size)return;a.forEach(({index:e})=>{t.getAtIndex(e)===r&&t.setAtIndex(e,o)},{}),(0,u.triggerSegmentationDataModified)(e.segmentationId,a.getArrayOfSlices()),a.clear()},[i.Z.RejectPreview]:e=>{const{previewVoxelManager:t,segmentationVoxelManager:n}=e;if(0===t.modifiedSlices.size)return;t.forEach(({index:e,value:t})=>{n.setAtIndex(e,t)}),(0,u.triggerSegmentationDataModified)(e.segmentationId,t.getArrayOfSlices()),t.clear()}},f={[i.Z.Fill]:e=>{const{segmentsLocked:t,segmentationImageData:n,segmentationVoxelManager:i,previewVoxelManager:o,imageVoxelManager:a,brushStrategy:s,centerIJK:l}=e,c=s.createIsInThreshold?.(e),u=s.createIsTargetSegment?.(e),{setValue:d}=s,p=c?n=>{const{value:r,index:i}=n;!t.includes(r)&&c(i)&&d(e,n)}:u?n=>{const{value:r,index:i}=n;!t.includes(r)&&u(i)&&d(e,n)}:t=>d(e,t);(0,r.Z)(n,a?.isInObject||i.isInObject,p,i.boundsIJK),o.addPoint(l)}},m={determineSegmentIndex:o,dynamicThreshold:s,erase:l,islandRemoval:d,preview:h,regionFill:f,setValue:{[i.Z.INTERNAL_setValue]:(e,{value:t,index:n})=>{const{segmentsLocked:r,segmentIndex:i,previewVoxelManager:o,previewSegmentIndex:a,segmentationVoxelManager:s}=e,l=s.getAtIndex(n);if(null===i){const e=o.getAtIndex(n);return void(void 0!==e&&o.setAtIndex(n,e))}if(l===i||r.includes(t))return;if(0===i){const t=e.eraseFocusIndex??0;if(0!==t&&t!==l)return}if(l===a){if(void 0!==o.getAtIndex(n))return;s.setAtIndex(n,i)}const c=a??i;o.setAtIndex(n,c)}},targetSegment:{[i.Z.CreateIsTargetSegment]:e=>{const{segmentationVoxelManager:t,strategySpecificConfiguration:n}=e;if(n)return e=>{const{REPLACE:r,REPLACE_INSIDE_CIRCLE:i}=n,o=t.scalarData[e],{targetSegmentIndex:a}=r||i||{};return void 0===a||a===o}}},threshold:{[i.Z.CreateIsInThreshold]:e=>{const{imageVoxelManager:t,strategySpecificConfiguration:n,segmentIndex:r}=e;if(n&&r)return e=>{const{THRESHOLD:r,THRESHOLD_INSIDE_CIRCLE:i}=n,o=t.getAtIndex(e),s=Array.isArray(o)?a.R3.length(o):o,{threshold:l}=r||i||{};return!l?.length||l[0]<=s&&s<=l[1]}}}}},62455:(e,t,n)=>{"use strict";n.d(t,{x:()=>a});var r=n(25029),i=n(62309),o=n(6858);const a=new r.Z("EraseCircle",o.Z.erase,...i.Gh.compositions).strategyFunction},57624:(e,t,n)=>{"use strict";n.d(t,{F:()=>a});var r=n(25029),i=n(92596),o=n(6858);const a=new r.Z("EraseSphere",o.Z.erase,...i.Jk.compositions).strategyFunction},62309:(e,t,n)=>{"use strict";n.d(t,{Gh:()=>m,TO:()=>y,Yr:()=>C,jV:()=>b,s2:()=>f});var r=n(72076),i=n(62709),o=n(92600),a=n(87758),s=n(25029),l=n(68096),c=n(6858),u=n(34603);const{transformWorldToIndex:d,isEqual:p}=i.utilities,h={[l.StrategyCallbacks.Initialize]:e=>{const{points:t,imageVoxelManager:n,viewport:i,segmentationImageData:s,segmentationVoxelManager:l}=e;if(!t)return;const c=r.R3.fromValues(0,0,0);t.forEach(e=>{r.R3.add(c,c,e)}),r.R3.scale(c,c,1/t.length),e.centerWorld=c,e.centerIJK=d(s,c);const u=t.map(e=>i.worldToCanvas(e)),[p,h]=(0,o.getCanvasEllipseCorners)(u),m=i.canvasToWorld(p),g=i.canvasToWorld(h),v=t.map(e=>d(s,e)),y=(0,a.getBoundingBoxAroundShapeIJK)(v,s.getDimensions());l.boundsIJK=y,n.isInObject=f({topLeftWorld:m,bottomRightWorld:g,center:c})}};function f(e){const{topLeftWorld:t,bottomRightWorld:n,center:r}=e,i=Math.abs(t[0]-n[0])/2,a=Math.abs(t[1]-n[1])/2,s=Math.abs(t[2]-n[2])/2,l=Math.max(i,a,s);if(p(i,l)&&p(a,l)&&p(s,l)){const e={center:r,radius:l,radius2:l*l};return t=>(0,u.E)(e,t)}const c={center:r,xRadius:i,yRadius:a,zRadius:s},{precalculated:d}=(0,o.precalculatePointInEllipse)(c,{});return d}const m=new s.Z("Circle",c.Z.regionFill,c.Z.setValue,h,c.Z.determineSegmentIndex,c.Z.preview),g=new s.Z("CircleThreshold",c.Z.regionFill,c.Z.setValue,h,c.Z.determineSegmentIndex,c.Z.dynamicThreshold,c.Z.threshold,c.Z.preview,c.Z.islandRemoval),v=new s.Z("CircleReplace",...m.compositions,c.Z.targetSegment,c.Z.islandRemoval),y=m.strategyFunction,b=g.strategyFunction,C=v.strategyFunction},25429:(e,t,n)=>{"use strict";n.d(t,{h:()=>d});var r=n(62709),i=n(87758),o=n(79454),a=n(32140),s=n(91322),l=n(59941);const{transformWorldToIndex:c}=r.utilities;function u(e,t,n=!0){const{points:u,segmentsLocked:d,segmentIndex:p,segmentationId:h}=t,{viewport:f}=e,m=(0,s.L)({operationData:t,viewport:e.viewport});if(!m)return void console.warn("No data found for fillRectangle");const{segmentationImageData:g,segmentationScalarData:v}=m;let y=u.map(e=>c(g,e));y=y.map(e=>e.map(e=>Math.round(e)));const b=(0,i.getBoundingBoxAroundShapeIJK)(y,g.getDimensions()),C=f instanceof r.StackViewport||(0,l.r)(y),w=g.getDirection(),E=g.getSpacing(),{viewPlaneNormal:T}=f.getCamera(),x=r.utilities.getSpacingInNormalDirection({direction:w,spacing:E},T),_=(0,i.getBoundingBoxAroundShapeWorld)(u);let[[S,I],[D,A],[P,O]]=_;S-=x,I+=x,D-=x,A+=x,P-=x,O+=x;const R=C?()=>!0:e=>{const[t,n,r]=e;return t>=S&&t<=I&&(n>=D&&n<=A)&&(r>=P&&r<=O)};(0,o.pointInShapeCallback)(g,R,({value:e,index:n})=>{if(d.includes(e))return;const r=t.eraseFocusIndex??0;0!==r&&r!==v[n]||(v[n]=p)},b),(0,a.triggerSegmentationDataModified)(h)}function d(e,t){u(e,t,!0)}},92596:(e,t,n)=>{"use strict";n.d(t,{Jk:()=>p,Wv:()=>v,Yo:()=>g,pR:()=>h});var r=n(62709),i=n(72076),o=n(25029),a=n(6858),s=n(39708),l=n(62309),c=n(28921);const{transformWorldToIndex:u}=r.utilities,d={[s.Z.Initialize]:e=>{const{points:t,imageVoxelManager:n,viewport:r,segmentationImageData:o,segmentationVoxelManager:a}=e;if(!t)return;const s=i.R3.fromValues(0,0,0);t.forEach(e=>{i.R3.add(s,s,e)}),i.R3.scale(s,s,1/t.length),e.centerWorld=s,e.centerIJK=u(o,s);const{boundsIJK:d,topLeftWorld:p,bottomRightWorld:h}=(0,c.v)(t.slice(0,2),o,r);a.boundsIJK=d,n?n.isInObject=(0,l.s2)({topLeftWorld:p,bottomRightWorld:h,center:s}):a.isInObject=(0,l.s2)({topLeftWorld:p,bottomRightWorld:h,center:s})}},p=new o.Z("Sphere",a.Z.regionFill,a.Z.setValue,d,a.Z.determineSegmentIndex,a.Z.preview),h=p.strategyFunction,f=new o.Z("SphereThreshold",...p.compositions,a.Z.dynamicThreshold,a.Z.threshold,a.Z.islandRemoval),m=new o.Z("SphereReplace",...p.compositions,a.Z.targetSegment,a.Z.islandRemoval),g=f.strategyFunction,v=m.strategyFunction},91322:(e,t,n)=>{"use strict";n.d(t,{L:()=>a});var r=n(62709),i=n(88439);const{VoxelManager:o}=r.utilities;function a({operationData:e,viewport:t}){let n,a,s,l,c,u,d;if((0,i.y)(e,t)){const{volumeId:t,referencedVolumeId:i}=e,o=r.cache.getVolume(t);if(!o)return;if(d=o.voxelManager,i){const e=r.cache.getVolume(i);s=e.getScalarData(),l=e.dimensions}({imageData:n}=o),a=o.getScalarData(),c=o.dimensions}else{const{imageIdReferenceMap:i,segmentationRepresentationUID:o}=e;if(!i)return;const p=t.getCurrentImageId();if(!p)return;const h=t.getActor(o);if(!h)return;n=h.actor.getMapper().getInputData(),d=n.voxelManager;const f=i.get(p),m=r.cache.getImage(f);if(!m)return;a=m.getPixelData?.();const g=r.cache.getImage(p),v=g?null:t.getImageData();s=g?.getPixelData()||v.getScalarData(),l=g?[g.columns,g.rows,1]:v.dimensions,c=[m.columns,m.rows,1],u=g?.voxelManager}return d||=o.createVolumeVoxelManager(c,a),u||=l&&o.createVolumeVoxelManager(l,s),{segmentationImageData:n,segmentationScalarData:a,segmentationVoxelManager:d,imageScalarData:s,imageVoxelManager:u}}},88439:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});var r=n(62709);function i(e,t){const{imageIdReferenceMap:n}=e,{volumeId:i}=e;if(i&&!n)return!0;if(n&&!i)return!1;if(i&&n&&!t)throw new Error("isVolumeSegmentation: viewport is required when both volumeId and imageIdReferenceMap are provided");return t instanceof r.VolumeViewport}},46915:(e,t,n)=>{"use strict";var r;n.d(t,{i:()=>r}),function(e){e[e.CounterClockwise=-1]="CounterClockwise",e[e.Unknown=0]="Unknown",e[e.Clockwise=1]="Clockwise"}(r||(r={}))},35106:()=>{},94627:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class r{constructor(){}static getContourSequence(e,t){const{data:n}=e,{projectionPoints:r,projectionPointsImageIds:i}=n.cachedStats;return r.map((e,n)=>{const r=function(e){const t=[...e[0],...e[1],...e[3],...e[2]],n=t.flat().map(e=>e.toFixed(2));return n}(e),o=function(e,t){const n=t.get("sopCommonModule",e);return{ReferencedSOPClassUID:n.sopClassUID,ReferencedSOPInstanceUID:n.sopInstanceUID}}(i[n],t);return{NumberOfContourPoints:r.length/3,ContourImageSequence:o,ContourGeometricType:"CLOSED_PLANAR",ContourData:r}})}}r.toolName="RectangleROIStartEndThreshold";const i=r},3915:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(86614);const i="PlanarFreehandContourSegmentationTool";function o(e,t=[]){const{viewport:n,sliceData:o,annotation:a}=e,s=new Map,{toolName:l,originalToolName:c}=a.metadata,u=c||l,d=((0,r.getAnnotations)(u,n.element)||[]).filter(e=>!e.metadata.originalToolName||e.metadata.originalToolName===u);if(u!==i){const e=(0,r.getAnnotations)(i,n.element);e?.length&&e.forEach(e=>{const{metadata:t}=e;t.originalToolName===u&&t.originalToolName!==t.toolName&&d.push(e)})}if(!d?.length)return s;for(let e=0;e<o.numberOfSlices;e++){const n=d.filter(t=>t.metadata.sliceIndex===e);if(!n?.length)continue;const r=n.filter(e=>t.every(t=>{const n=t.parentKey?t.parentKey(e):e,r=n?.[t.key];return Array.isArray(r)?r.every((e,n)=>e===t.value[n]):r===t.value}));r.length&&s.set(e,r)}return s}},92472:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(3915);function i(e,t){const n=(0,r.Z)(e,t),i=[];if(!n?.size)return i;for(const e of n.values())e.forEach(e=>{i.push(e)});return i}},28898:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r=n(62709),i=n(72076);function o(e,t,n){const i=r.utilities.deepMerge({data:{},metadata:{}},n);return Object.assign(i,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(i.data,{handles:{points:t.points||t||[],interpolationSources:t.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...n.data.contour,polyline:e}}),i}var a=n(3915);function s(e,t){const n=e.get(t);return!n?.length||1===n.length&&n[0].autoGenerated}function l(e,t,n){const[r]=e;t[r]||={pair:e,list:[]},t[r].list.push(n)}function c(e,t,n){const r=[];let i=!0;for(let o=e-1;o>=t[0];o--){const e=n.get(o);if(e?.length){if(e[0].autoGenerated)continue;e.length>1&&(i=!1),r.push(o);break}}if(i&&r.length){for(let o=e+1;o<=t[1];o++){const e=n.get(o);if(e?.length){if(e[0].autoGenerated)continue;e.length>1&&(i=!1),r.push(o);break}}if(i&&!(r.length<2))return r}}const u=function(e,t){const n=(0,a.Z)(t,[{key:"interpolationUID",value:t.interpolationUID}]),r=function(e){let t=1/0,n=-1/0,r=!1;for(const[i,o]of e.entries())o.length&&(t=Math.min(i,t),n=Math.max(i,n),r=!0);if(!r)return;return[t,n]}(n);if(!r)return void console.warn("No annotations found to interpolate",n);const i=function(e,t){for(const[n,r]of e)for(let e=0;e<r.length;e++)if(r[e].annotationUID===t)return n;return}(n,e.annotationUID),o=[];for(let e=r[0]+1;e<r[1];e++)if(s(n,e)){const t=c(e,r,n);t?.[0]!==i&&t?.[1]!==i||l(t,o,e)}return{interpolationData:n,interpolationList:o}};var d=n(34539),p=n(88706);const{PointsManager:h}=r.utilities;function f(e,t=12){const n=h.create3(t);n.sources=[];const{sources:r}=n,{length:o,sources:a=[]}=e;if(o<15)return e.subselect(t);const s=Math.floor(Math.max(2*o/t,10));a.forEach(()=>r.push(h.create3(t)));const l=function(e,t=6){const{length:n}=e,r=i.R3.create(),o=i.R3.create(),a=new Float32Array(n);for(let s=0;s<n;s++){const l=e.getPoint(s),c=e.getPoint(s-t),u=e.getPoint((s+t)%n);i.R3.sub(r,l,c),i.R3.sub(o,u,l);const d=i.R3.dot(r,o)/(i.R3.len(r)*i.R3.len(o));a[s]=d}return a}(e,5),c=function(e,t){const{max:n,deviation:r}=function(e){const{length:t}=e;let n=0,r=1/0,i=-1/0,o=0;for(let o=0;o<t;o++){const t=e[o];n+=t,r=Math.min(r,t),i=Math.max(i,t)}const a=n/t;for(let n=0;n<t;n++){const t=e[n]-a;o+=t*t}return{mean:a,max:i,min:r,sumSq:o,deviation:Math.sqrt(o/t)}}(e),{length:i}=e;if(r<.01||i<3*t)return[];const o=[];let a,s=null,l=0;for(let t=0;t<i;t++){const i=e[t];i<n-r?s?(s[2]=t,i<a&&(a=i,l=t),s[1]=l):(a=i,l=t,s=[t,t,t]):s&&(o.push(s),s=null)}s&&(0===o[0][0]?o[0][0]=s[0]:(s[1]=l,s[2]=i-1,o.push(s)));return o}(l,t),u=[];if(c?.length>2){let e=-1;const t=s/3;c.forEach(n=>{const[r,,i]=n,a=Math.ceil((r+i)/2);i-e<t||(a-r>2*t?(m(u,e,r,s,o),e=m(u,r,a,s,o)):e=m(u,e,a,s,o),i-e>t&&(e=m(u,e,i,s,o)))});const n=u[0];g(n+o-e,o)>2*t&&m(u,e,n-t,s,o)}else{const e=Math.floor(o/t);m(u,-1,o-e,e,o)}return u.forEach(t=>{const i=e.getPointArray(t);n.push(i),a.forEach((e,n)=>r[n].push(e.getPoint(t)))}),n}function m(e,t,n,r,i){n<t&&(n+=i);const o=n-t,a=Math.ceil(o/r);if(a<=0)return e[e.length-1]!==n&&e.push(g(n,i)),n;for(let n=1;n<=a;n++){const r=g(t+n*o/a,i);e.push(r)}return e[e.length-1]}function g(e,t){return(Math.round(e)+t)%t}var v=n(72362);const{PointsManager:y}=r.utilities,b=.2;function C(e,t,n,r){const a=n.get(t[0])[0],s=n.get(t[1])[0],l=A(a.data.contour.polyline),c=A(s.data.contour.polyline),{c1Interp:u,c2Interp:d}=function(e,t){const n=D(e),r=D(t),i=Math.max(Math.ceil(n[n.length-1]/b),Math.ceil(r[r.length-1]/b)),o=I(n),a=I(r),s=i+t.x.length,l=i+e.x.length,c=S(s,o),u=S(l,a),d=_(s-2,e.x.length),p=_(l-2,t.x.length),h=x(c,d),f=x(u,p),m=T(e,h),g=T(t,f);return function(e,t){const n=e.x.length,r={startingNode:0,totalSquaredXYLengths:1/0};for(let i=0;i<n;i++){let o=i,a=0;for(let r=0;r<n;r++)a+=(e.x[o]-t.x[r])**2+(e.y[o]-t.y[r])**2+(e.z[o]-t.z[r])**2,o++,o===n&&(o=0);a<r.totalSquaredXYLengths&&(r.totalSquaredXYLengths=a,r.startingNode=i)}const i=r.startingNode;E(e.x,i),E(e.y,i),E(e.z,i),E(e.I,i)}(m,g),function(e,t){const n={x:[],y:[],z:[],I:[]},r={x:[],y:[],z:[],I:[]};for(let i=0;i<e.x.length;i++)(e.I[i]||t.I[i])&&(n.x.push(e.x[i]),n.y.push(e.y[i]),n.z.push(e.z[i]),n.I.push(e.I[i]),r.x.push(t.x[i]),r.y.push(t.y[i]),r.z.push(t.z[i]),r.I.push(t.I[i]));return{c1Interp:n,c2Interp:r}}(m,g)}(l,c);u.kIndex=t[0],d.kIndex=t[1],e.forEach(function(e){!function(e,t,n,r,a,s,l){const[c,u]=r,d=(n-c)/(u-c),h=a.get(c)[0],m=a.get(u)[0],g=function(e,t,n,r){const o=r?e.I:t.I,a=y.fromXYZ(e),s=y.fromXYZ(t),{length:l}=a,c=y.create3(l),u=i.R3.create(),d=i.R3.create(),p=y.create3(l);p.kIndex=e.kIndex;const h=y.create3(l);h.kIndex=t.kIndex;for(let t=0;t<e.x.length;t++)if(o[t]){const e=a.getPoint(t),r=s.getPoint(t);p.push(e),h.push(r),i.R3.sub(u,r,e),c.push(i.R3.scaleAndAdd(d,e,u,n))}return c.sources=[p,h],c}(e,t,d,s),b=d>.5?m:h,C=f(g);a.has(n)?function(e,t,n,r,i){const a=w(r,n,i),s=e.points,l=o(s,t,a);Object.assign(a,{metadata:l.metadata,data:l.data})}(g,C,n,b,l):function(e,t,n,r,i){const a=e.points,{viewport:s}=i,l=o(a,t,r),c=s.getViewReference({sliceIndex:n});if(!c)throw new Error(`Can't find slice ${n}`);Object.assign(l.metadata,c),p.state.addAnnotation(l,s.element),r.onInterpolationComplete?.(l,r);const{parentAnnotationUID:u}=r;if(u){const e=w(p.state.getAnnotation(u),n,i);(0,v.h)(s,e,l)}}(g,C,n,b,l)}(u,d,e,t,n,l.x.length>c.x.length,r)})}function w(e,t,n){const{viewport:r}=n,i=p.state.getAnnotations(e.metadata.toolName,r.element);for(let n=0;n<i.length;n++){const r=i[n];if(r.interpolationUID===e.interpolationUID&&r.metadata.sliceIndex===t)return r}}function E(e,t){t-=e.length*Math.floor(t/e.length);const n=e.splice(0,t);return e.push(...n),e}function T(e,t){const n={x:[],y:[],z:[],I:[]};for(let r=0;r<e.x.length-1;r++){n.x.push(e.x[r]),n.y.push(e.y[r]),n.z.push(e.z[r]),n.I.push(!0);const i=(e.x[r+1]-e.x[r])/(t[r]+1),o=(e.y[r+1]-e.y[r])/(t[r]+1),a=(e.z[r+1]-e.z[r])/(t[r]+1);for(let e=0;e<t[r]-1;e++)n.x.push(n.x[n.x.length-1]+i),n.y.push(n.y[n.y.length-1]+o),n.z.push(n.z[n.z.length-1]+a),n.I.push(!1)}return n}function x(e,t){const n=[];for(let t=0;t<e.length;++t)n[t]=t;n.sort(function(t,n){return e[t]<e[n]?-1:1});const r=[];for(let e=0;e<t.length;e++)r.push(t[n[e]]);const i=r.reduce(function(e,t,n){return t&&e.push(n),e},[]),o=[];for(let e=0;e<i.length-1;e++)o.push(i[e+1]-i[e]);return o}function _(e,t){const n=new Array(e+t);return n.fill(!1,0,e),n.fill(!0,e,e+t),n}function S(e,t){const n=1/(e-1),r=[n];for(let t=1;t<e-2;t++)r.push(r[r.length-1]+n);return r.concat(t)}function I(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n]/e[e.length-1]);return t}function D(e){const t=[0];for(let n=1;n<e.x.length;n++){const r=Math.sqrt((e.x[n]-e.x[n-1])**2+(e.y[n]-e.y[n-1])**2+(e.z[n]-e.z[n-1])**2);t.push(t[n-1]+r)}return t}function A(e){const t={x:[],y:[],z:[]};for(let n=0;n<e.length;n++)t.x[n]=e[n][0],t.y[n]=e[n][1],t.z[n]=e[n][2];return t.x.push(t.x[0]),t.y.push(t.y[0]),t.z.push(t.z[0]),t}const P=function(e){if(!e.annotation)return;const{isInterpolationUpdate:t,annotation:n}=e;queueMicrotask(()=>{try{t&&(n.isInterpolationUpdate=!0,n.autoGenerated=!1),function(e){const{annotation:t}=e;!function(e){const{parentAnnotationUID:t,annotationUID:n}=e;if(!t)return e.interpolationUID;const r=p.state.getAnnotation(t),{interpolationUID:i}=r,o=r.childAnnotationUIDs.indexOf(n);e.interpolationUID=`${i}-${o}`,e.interpolationUID}(t);const{interpolationData:n,interpolationList:i}=u(t,e)||{};if(!n||!i)return;const o={toolName:t.metadata.toolName,toolType:t.metadata.toolName,viewport:e.viewport};for(let e=0;e<i.length;e++)i[e]&&C(i[e].list,i[e].pair,n,o);const{id:a,renderingEngineId:s,element:l}=e.viewport,c={annotation:t,element:l,viewportId:a,renderingEngineId:s};i.length&&(0,r.triggerEvent)(e.viewport.element,d.default.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c)}(e)}finally{t&&(n.autoGenerated=!0)}})}},15607:(e,t,n)=>{"use strict";n.d(t,{F:()=>i});var r=n(62709);function i(e,t,n){return"CT"===e?"HU":"PT"===e?function(e,t){if(!t.isPreScaled)return"raw";if(t.isSuvScaled)return"SUV";const n=r.metaData.get("generalSeriesModule",e);if("PT"===n?.modality){const t=r.metaData.get("petSeriesModule",e);return t?.units||"unitless"}}(t,n):""}},67298:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(33232),i=n(62709);function o(e,t){const n=(0,i.getEnabledElement)(e),{renderingEngineId:o,viewportId:a}=n,s=r.fT.getToolGroupForViewport(a,o);if(!s)return[];const l=[],c=Object.keys(s.toolOptions);for(let e=0;e<c.length;e++){const n=c[e],r=s.toolOptions[n];if(r&&t.includes(r.mode)){const e=s.getToolInstance(n);l.push(e)}}return l}},22319:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(62709);const{isEqual:i}=r.utilities;function o(e){const{metadata:t}=e;return(0,r.getEnabledElements)().filter(e=>{if(e.FrameOfReferenceUID===t.FrameOfReferenceUID){const n=e.viewport,{viewPlaneNormal:r,viewUp:o}=n.getCamera();return i(r,t.viewPlaneNormal)&&(!t.viewUp||i(o,t.viewUp))}}).map(e=>e.viewport)}},27479:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});class r{constructor(e,t){this.pointArray=e?e.slice():[],this._controlPointIndexes=t?t.slice():[]}getPoint(e){return this.pointArray[e]}getLastPoint(){return this.pointArray[this.pointArray.length-1]}isControlPoint(e){const t=this.pointArray.indexOf(e);if(-1!==t)return-1!==this._controlPointIndexes.indexOf(t);throw new Error("Error: isControlPoint called with not in list point.")}addPoint(e){this.pointArray.push(e)}addControlPoint(e){const t=this.pointArray.indexOf(e);if(-1===t)throw new Error("Cannot mark a non registered point as control point.");this._controlPointIndexes.push(t)}getControlPoints(){return this._controlPointIndexes.map(e=>this.pointArray[e])}getNumControlPoints(){return this._controlPointIndexes.length}removeLastControlPoint(){this._controlPointIndexes.length&&this._controlPointIndexes.pop()}getLastControlPoint(){if(this._controlPointIndexes.length)return this.pointArray[this._controlPointIndexes[this._controlPointIndexes.length-1]]}removeLastPoints(e){this.pointArray.splice(this.pointArray.length-e,e)}addPoints(e){this.pointArray=this.pointArray.concat(e)}prependPath(e){const t=e.pointArray.length,n=[];this.pointArray=e.pointArray.concat(this.pointArray);for(let e=0;e<this._controlPointIndexes.length;++e)n[e]=this._controlPointIndexes[e]+t;this._controlPointIndexes=e._controlPointIndexes.concat(n)}appendPath(e){this.addPoints(e.pointArray),e._controlPointIndexes.forEach(e=>this._controlPointIndexes.push(e))}}},21221:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(72076);function i(e,t){return 3===e[0].length?function(e,t){const[n,i]=e,[o,a]=t,s=r.R3.sub(r.R3.create(),i,n),l=r.R3.sub(r.R3.create(),o,a),c=r.R3.dot(s,l)/(r.R3.length(s)*r.R3.length(l));return 180*Math.acos(c)/Math.PI}(e,t):function(e,t){const[n,i]=e,[o,a]=t,s=r.K4.sub(r.K4.create(),i,n),l=r.K4.sub(r.K4.create(),o,a),c=r.K4.dot(s,l)/(r.K4.length(s)*r.K4.length(l));return Math.acos(c)*(180/Math.PI)}(e,t)}},57776:(e,t,n)=>{"use strict";n.d(t,{$:()=>o,t:()=>i});var r=n(74474);function i(e){const[t,n]=e;return(0,r.distanceToPoint)(t,n)}function o(e){const[t,n]=e,i=(0,r.distanceToPoint)(t,n);return[[t[0]-i,t[1]-i],[t[0]+i,t[1]+i]]}},74474:(e,t,n)=>{"use strict";n.r(t),n.d(t,{distanceToPoint:()=>r.Z,distanceToPointSquared:()=>i.Z,mirror:()=>o.Z});var r=n(25523),i=n(94363),o=n(18668)},13837:(e,t,n)=>{"use strict";function r(e,t){let n=e;const r=t?.numDimensions||2,i=3===r;if(!Array.isArray(e[0])){const t=e,o=t.length/r;n=new Array(t.length/r);for(let e=0,a=o;e<a;e++)n[e]=[t[e*r],t[e*r+1]],i&&n[e].push(t[e*r+2])}let o=1/0,a=1/0,s=-1/0,l=-1/0,c=1/0,u=-1/0;for(let e=0,t=n.length;e<t;e++){const[t,r,d]=n[e];o=o<t?o:t,a=a<r?a:r,s=s>t?s:t,l=l>r?l:r,i&&(c=c<d?c:d,u=u>d?u:d)}return i?{minX:o,maxX:s,minY:a,maxY:l,minZ:c,maxZ:u}:{minX:o,maxX:s,minY:a,maxY:l}}n.d(t,{Z:()=>r})},78924:(e,t,n)=>{"use strict";function r(e,t){let n=[0,0],r=Number.MAX_SAFE_INTEGER;return e.forEach(function(e){const i=function(e,t){const[n,r]=e,[i,o]=t;return Math.sqrt(Math.pow(n-i,2)+Math.pow(r-o,2))}(t,e);i<r&&(r=i,n=[...e])}),n}n.d(t,{Z:()=>r})},4912:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(90583),i=n(72018);function o(e,t,n,o){const a=n-t+1,s=Math.floor(o/100*a)??1,l=Math.floor(a/s)??1;if(isNaN(a)||!a||!l)return e;if(a/l<2)return e;const c=Math.max(0,t),u=Math.min(e.length-1,n),d=e.slice(0,c),p=e.slice(u+1,e.length),h=function(e,t){if(!t||0===t.length||t.length===e.length)return e;const n=t[t.length-1]-t[0]+1,o=(0,r.nH)(t.map(t=>e[t][0])),a=(0,r.nH)(t.map(t=>e[t][1]));if(s=e,3===s[0]?.length){const s=(0,r.nH)(t.map(t=>e[t][2]));return(0,i.$R)((0,r.q$)(o,n),(0,r.q$)(a,n),(0,r.q$)(s,n))}return(0,i.$R)((0,r.q$)(o,n),(0,r.q$)(a,n));var s}(e,function(e,t){const n=[],[r,i]=t,o=i-r+1,a=Math.floor(o/e);let s=0,l=Math.round((o-1)/(a-1)*s)+r;for(;l<=i;)n.push(l),s++,l=Math.round((o-1)/(a-1)*s)+r;return n}(l,[c,u]));return[...d,...h,...p]}},2036:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(27446),i=n(33232),o=n(4912);function a(e,t,n){if(function(e,t,n){if(!t?.data?.polyline||n<=0)return!0;if(!e.viewport)return!0;const{renderingEngineId:o,viewportId:a,FrameOfReferenceUID:s}=e,l=i.fT.getToolGroupForViewport(a,o);if(t.metadata.FrameOfReferenceUID!==s)return!0;if(!l)return!0;const c=l.getToolInstance(t.metadata.toolName);return!(c instanceof r.Hx)||c.isDrawing||c.isEditingOpen||c.isEditingClosed}(e,t,n))return!1;const{viewport:a}=e,s=t.data.contour.polyline.map(a.worldToCanvas),l=(0,o.Z)(s,0,s.length,n);return l!==s&&(t.data.contour.polyline=l.map(a.canvasToWorld),!0)}},26492:(e,t,n)=>{"use strict";n.d(t,{K:()=>u,x:()=>o});var r=n(60489),i=n(4912);function o(e,t){if(t?.autoGenerated)return!1;return!0===e?.smoothing?.smoothOnAdd||!0===e?.smoothing?.smoothOnEdit}function a(e,t){return 0===r.point.distanceToPoint(e,t)}function s(e,t,n){return(e+t+n)%t}function l(e,t,n,r){const[,i,o]=e,[,a,l]=t,c=o.length,u=l.length;let d=e[0],p=t[0];if(!(o[d]&&l[p]&&o[i]&&l[a]))return[void 0,void 0];for(;d!==i&&p!==a;){if(n(l[p],o[d]))return[d,p];d=s(d,c,r),p=s(p,u,r)}return[void 0,void 0]}function c(e,t){const[n,i]=function(e,t){for(let n=0;n<e.length;n++)for(let r=0;r<t.length;r++)if(a(e[n],t[r]))return[n,r]}(e,t)||[],o=(e,t)=>!1===function(e,t){return r.point.distanceToPoint(e,t)<.001}(e,t),[c,u]=l([s(n,e.length,1),n,e],[s(i,t.length,1),i,t],o,1),[d]=l([s(c,e.length,-1),c,e],[s(u,t.length,-1),u,t],o,-1);return[c,d]}function u(e,t,n){const{interpolation:r,smoothing:o}=e,a=t;if(r){const{knotsRatioPercentageOnAdd:e,knotsRatioPercentageOnEdit:r,smoothOnAdd:a=!1,smoothOnEdit:s=!1}=o,l=n?r:e;if(n?s:a){const[e,r]=n?c(t,n):[0,t.length-1];return t[e]&&t[r]?(0,i.Z)(t,e,r,l):t}}return a}},69943:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(62709),i=n(88642);function o(e,t,n={}){if(e instanceof r.VolumeViewport){const n=e.getCamera(),{spacingInNormalDirection:o}=r.utilities.getTargetVolumeAndSpacingInNormalDir(e,n);return(0,i.Z)(t,n,o)}if(e instanceof r.StackViewport){const t=e.getCurrentImageId(),r=t.indexOf(":");n.imageURI=t.substring(r+1)}return t.filter(t=>!!t.isVisible&&(!!t.data.isCanvasAnnotation||e.isReferenceViewable(t.metadata,n)))}},88642:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(72076),i=n(62709);const{EPSILON:o}=i.CONSTANTS,a=1-o;function s(e,t,n){const{viewPlaneNormal:o}=t,s=e.filter(e=>{let t=e.metadata.viewPlaneNormal;if(!t){const{referencedImageId:n}=e.metadata,{imageOrientationPatient:o}=i.metaData.get("imagePlaneModule",n),a=r.R3.fromValues(o[0],o[1],o[2]),s=r.R3.fromValues(o[3],o[4],o[5]);t=r.R3.create(),r.R3.cross(t,a,s),e.metadata.viewPlaneNormal=t}const n=Math.abs(r.R3.dot(o,t))>a;return t&&n});if(!s.length)return[];const l=n/2,{focalPoint:c}=t,u=[];for(const e of s){const t=e.data.handles.points[0];if(!e.isVisible)continue;const n=r.R3.create();r.R3.sub(n,c,t);const i=r.R3.dot(n,o);Math.abs(i)<l&&u.push(e)}return u}},1023:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(32899),i=n(62709);function o(e,t,n,o,s=.25){const l=e.getCamera(),{position:c}=l,{spacingInNormalDirection:u}=i.utilities.getTargetVolumeAndSpacingInNormalDir(e,l,n),d=u*s,p=e.getBounds(),h=p[0],f=p[1],m=[0,0,0];let g,v=[0,0,0];r.ZP.subtract(t,c,m);for(let t=h;t<=f;t+=d){v=[t,0,0];const n=(t-c[0])/m[0];if(v[1]=n*m[1]+c[1],v[2]=n*m[2]+c[2],a(v,p)){const t=o(e.getIntensityFromWorld(v),v);t&&(g=t)}}return g}const a=function(e,t){const[n,r,i,o,a,s]=t;return e[0]>n&&e[0]<r&&e[1]>i&&e[1]<o&&e[2]>a&&e[2]<s}},88582:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(72076);function i(e,t,n,i){const o=r.R3.create();r.R3.cross(o,t,e);const a=r.R3.fromValues(...n),s=r.R3.fromValues(...i),l=r.R3.create();r.R3.subtract(l,a,s);const c=r.R3.length(l);if(c<1e-4)return{worldWidth:0,worldHeight:0};const u=r.R3.dot(l,o)/(c*r.R3.length(o));return{worldWidth:Math.sqrt(1-u*u)*c,worldHeight:u*c}}},21259:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(72076);function i(e,t,n,i){const o=r.R3.create();r.R3.cross(o,t,e);const a=r.R3.fromValues(...n),s=r.R3.fromValues(...i),l=r.R3.create();r.R3.subtract(l,a,s);const c=r.R3.length(l);if(c<1e-4)return{worldWidth:0,worldHeight:0};const u=r.R3.dot(l,o)/(c*r.R3.length(o));return{worldWidth:Math.sqrt(1-u*u)*c,worldHeight:u*c}}},61890:(e,t,n)=>{"use strict";n.d(t,{U:()=>i});var r=n(72076);const i=(e,t,n,i,o,a,s,l)=>{const c=[r.R3.fromValues(n,i,o),r.R3.fromValues(a,i,o),r.R3.fromValues(n,s,o),r.R3.fromValues(a,s,o),r.R3.fromValues(n,i,l),r.R3.fromValues(a,i,l),r.R3.fromValues(n,s,l),r.R3.fromValues(a,s,l)],u=r.R3.fromValues(t[0],t[1],t[2]),d=r.R3.fromValues(e[0],e[1],e[2]),p=-r.R3.dot(u,d);let h=null;for(const e of c){const t=r.R3.dot(u,e)+p;if(null===h)h=Math.sign(t);else if(Math.sign(t)!==h)return!0}return!1}},16524:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(62709),i=n(88706),o=n(28898),a=n(3915),s=n(34539);function l(e){const{annotation:t}=e,n=(0,a.Z)(e,[{key:"interpolationUID",value:e.interpolationUID}]),l=t.metadata.sliceIndex;let c=-1,u=e.sliceData.numberOfSlices;for(const[e,t]of n.entries()){if(e===l)continue;const n=t.find(e=>!e.autoGenerated);n&&(e<l?c=Math.max(e,c):u=Math.min(e,u))}const d=[];for(const[e,t]of n.entries())e<=c||e>=u||e===l||t.forEach(e=>{e.autoGenerated&&(i.state.removeAnnotation(e.annotationUID),d.push(e))});if(d.length){const t={annotations:d,element:e.viewport.element,viewportId:e.viewport.id,renderingEngineId:e.viewport.getRenderingEngine().id};(0,r.triggerEvent)(e.viewport.element,s.default.INTERPOLATED_ANNOTATIONS_REMOVED,t)}if(c>=0&&u<e.sliceData.numberOfSlices){const t=n.get(u)[0],r={viewport:e.viewport,sliceData:{numberOfSlices:e.sliceData.numberOfSlices,imageIndex:t.metadata.sliceIndex},annotation:t,interpolationUID:t.interpolationUID};(0,o.Z)(r)}}},23267:(e,t,n)=>{"use strict";n.d(t,{gK:()=>l,t7:()=>c});var r=n(62709),i=n(60721),o=n(88439),a=n(68096);const s=new Map,l=e=>{const t=s.get(e);t&&(t.isDirty=!0)};function c(e){const t=function(e){const t=s.get(e);return t&&!t.isDirty?t.indices:null}(e);if(t)return t;const n=(0,i.getSegmentation)(e);if(!n)throw new Error(`No segmentation found for segmentationId ${e}`);let l;switch(n.type){case a.SegmentationRepresentations.Labelmap:l=function(e,t){const n=e.representationData[a.SegmentationRepresentations.Labelmap],i=new Set;(0,o.y)(n)?function(e,t){const n=r.cache.getVolume(t);n.getScalarData().forEach(t=>{0!==t&&e.add(t)})}(i,t):function(e,t){t.forEach(t=>{r.cache.getImage(t).getPixelData().forEach(t=>{0!==t&&e.add(t)})})}(i,n.imageIdReferenceMap);return Array.from(i).map(Number).sort((e,t)=>e-t)}(n,e);break;case a.SegmentationRepresentations.Contour:l=function(e){const{annotationUIDsMap:t,geometryIds:n}=e.representationData.CONTOUR||{};if(!n)throw new Error(`No geometryIds found for segmentationId ${e.segmentationId}`);const i=new Set([...t.keys()]);return n.forEach(e=>{const t=r.cache.getGeometry(e);i.add(t.data.getSegmentIndex())}),Array.from(i).sort((e,t)=>e-t)}(n);break;case a.SegmentationRepresentations.Surface:l=function(e){const t=e.representationData.SURFACE?.geometryIds??[];return Array.from(t.keys()).map(Number).sort((e,t)=>e-t)}(n);break;default:throw new Error(`Unsupported segmentation type: ${n.type}`)}return s.set(e,{indices:l,isDirty:!1}),l}},31131:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c,ZW:()=>s,ih:()=>l});var r=n(62709),i=n(68096),o=n(27078),a=n(27446);const s=new class{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedToolGroups=()=>{this._throwIfDestroyed();const e=Array.from(this._needsRender.values());for(const t of e)if(this._triggerRender(t),this._needsRender.delete(t),0===this._needsRender.size)return this._animationFrameSet=!1,void(this._animationFrameHandle=null)}}removeToolGroup(e){this._needsRender.delete(e),0===this._needsRender.size&&this._reset()}renderToolGroupSegmentations(e){this._setToolGroupSegmentationToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setToolGroupSegmentationToBeRenderedNextFrame(e){e.forEach(e=>{this._needsRender.add(e)}),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedToolGroups),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,o.getToolGroup)(e);if(!t)return void console.warn(`No tool group found with toolGroupId: ${e}`);const{viewportsInfo:n}=t,s=n.map(({viewportId:e,renderingEngineId:t})=>{const n=(0,r.getRenderingEngine)(t);if(!n)return void console.warn("rendering Engine has been destroyed");const i=n.getViewport(e);return i||void 0}).filter(Boolean),l=t.getToolInstance(a.xX.toolName);function c(e){const{element:t,viewportId:n,renderingEngineId:a}=e.detail;t.removeEventListener(r.Enums.Events.IMAGE_RENDERED,c);const s=(0,o.getToolGroupForViewport)(n,a);if(!s)return void console.warn("toolGroup has been destroyed");const l={toolGroupId:s.id,viewportId:n};(0,r.triggerEvent)(r.eventTarget,i.Events.SEGMENTATION_RENDERED,{...l})}l?(s.forEach(({element:e})=>{e.addEventListener(r.Enums.Events.IMAGE_RENDERED,c)}),l.renderSegmentation(e)):console.warn("No segmentation tool found inside",e)}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}};function l(e){s.renderToolGroupSegmentations(e)}const c=l},93471:(e,t,n)=>{"use strict";n.d(t,{EI:()=>d,O3:()=>a,cD:()=>l,gf:()=>c,mN:()=>u,rI:()=>o,w6:()=>s});var r=n(62709),i=n(22446);const o=r.Enums.RequestType.Prefetch,a=0;function s(e,t){e=Math.round(e)||0;const n=[];let r=(t=Math.round(t)||0)-e+1;if(r<=0)return n;for(;r--;)n[r]=t--;return n}function l(e,t){let n=0,r=e.length-1;return e.forEach((e,i)=>{e<t?n=Math.max(i,n):e>t&&(r=Math.min(i,r))}),{low:n,high:r}}function c(e){const t=(0,r.getEnabledElement)(e);if(!t)return null;const{viewport:n}=t;return n instanceof r.StackViewport?{currentImageIdIndex:n.getCurrentImageIdIndex(),imageIds:n.getImageIds()}:(console.warn("stackPrefetch: element must be a StackViewport, VolumeViewport stackPrefetch not yet implemented"),null)}function u(e){return function(t){const n=t.detail;let r;try{r=c(e)}catch(e){return}if(!r||!r.imageIds||0===r.imageIds.length)return;const o=r.imageIds.indexOf(n.imageId);if(o<0)return;const a=(0,i.T)(e);a&&a.data&&a.data.length&&a.indicesToRequest.push(o)}}const d=e=>{const t=new Set(e.imageIds);return e=>e.type!==o||!t.has(e.additionalDetails.imageId)}},22446:(e,t,n)=>{"use strict";n.d(t,{T:()=>a,w:()=>o});var r=n(62709);const i={};function o(e,t){const n=(0,r.getEnabledElement)(e),{viewportId:o}=n;i[o]=t}function a(e){const t=(0,r.getEnabledElement)(e),{viewportId:n}=t;return i[n]}},64307:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>d});var r=n(62709),i=n(68096),o=n(86785),a=n(67298);const{Active:s,Passive:l,Enabled:c}=i.ToolModes;const u=new class{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let t=0;t<e.length;t++){const n=e[t];if(this._needsRender.has(n)&&(this._triggerRender(n),this._needsRender.delete(n),0===this._needsRender.size))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,t){this._viewportElements.set(e,t)}removeViewportElement(e,t){this._viewportElements.delete(e),this._needsRender.delete(t),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(e=>{this._needsRender.add(e)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const t=[...this._viewportElements.values()];e.forEach(e=>{-1!==t.indexOf(e)&&this._needsRender.add(e)}),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,r.getEnabledElement)(e);if(!t)return;if(!(0,r.getRenderingEngine)(t.renderingEngineId))return void console.warn("rendering Engine has been destroyed");const n=(0,a.Z)(e,[s,l,c]),{renderingEngineId:u,viewportId:d}=t,p={element:e,renderingEngineId:u,viewportId:d};(0,o.draw)(e,o=>{let a=!1;n.forEach(e=>{if(e.renderAnnotation){const n=e.renderAnnotation(t,o);a=a||n}}),a&&(0,r.triggerEvent)(e,i.Events.ANNOTATION_RENDERED,{...p})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}};const d=function(e){u.renderViewport(e)}},66878:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o,c:()=>i});var r=n(64307);function i(e,t){t.length&&e&&t.forEach(t=>{const n=e.getViewport(t);if(!n)return void console.warn(`Viewport not available for ${t}`);const{element:i}=n;(0,r.ZP)(i)})}const o=i},17197:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(68470),i=n(54131),o=n(89262);function a(e){let t=0;return e.filter((e,n)=>n===t&&(t+=e+1,!0))}function s(e){let t=0;for(let n=0;n<e.length;)n+=e[n]+1,t++;return t}const l={extractCellSizes:a,getNumberOfCells:s};function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.default.extend(e,t,function(e){return{empty:!0,numberOfComponents:1,dataType:o.Tu.UNSIGNED_INT,...e}}(n)),function(e,t){t.classHierarchy.push("vtkCellArray");const n={...e};e.getNumberOfCells=n=>void 0===t.numberOfCells||n?(t.cellSizes?t.numberOfCells=t.cellSizes.length:t.numberOfCells=s(e.getData()),t.numberOfCells):t.numberOfCells,e.getCellSizes=n=>void 0===t.cellSizes||n?(t.cellSizes=a(e.getData()),t.cellSizes):t.cellSizes,e.resize=r=>{const i=e.getNumberOfTuples();n.resize(r);const o=e.getNumberOfTuples();o<i&&(0===o?(t.numberOfCells=0,t.cellSizes=[]):(t.numberOfCells=void 0,t.cellSizes=void 0))},e.setData=e=>{n.setData(e,1),t.numberOfCells=void 0,t.cellSizes=void 0},e.getCell=e=>{let n=e;const r=t.values[n++];return t.values.subarray(n,n+r)},e.insertNextCell=n=>{const r=e.getNumberOfCells();return e.insertNextTuples([n.length,...n]),++t.numberOfCells,null!=t.cellSizes&&t.cellSizes.push(n.length),r}}(e,t)}var u={newInstance:r.m.newInstance(c,"vtkCellArray"),extend:c,...l}},86096:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class r extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}},54131:(e,t,n)=>{"use strict";n.d(t,{default:()=>g});var r=n(89262),i=n(68470),o=n(59474);const{vtkErrorMacro:a}=i.c,{DefaultDataType:s}=r.default;function l(e,t,n){const r=e.length;let i,o,a=Number.MAX_VALUE,s=-Number.MAX_VALUE;for(o=t;o<r;o+=n)if(!Number.isNaN(e[o])){a=e[o],s=a;break}for(;o<r;o+=n)i=e[o],i<a?a=i:i>s&&(s=i);return{min:a,max:s}}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<0&&n>1){const t=e.length/n,r=new Float64Array(t);for(let i=0,o=0;i<t;++i){for(let t=o+n;o<t;++o)r[i]+=e[o]*e[o];r[i]**=.5}return l(r,0,1)}return l(e,t<0?0:t,n)}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=e||[];for(;n.length<=t;)n.push(null);return n}function d(e){return Object.prototype.toString.call(e).slice(8,-1)}const p={computeRange:c,createRangeHelper:function(){let e=Number.MAX_VALUE,t=-Number.MAX_VALUE,n=0,r=0;return{add(i){e>i&&(e=i),t<i&&(t=i),n++,r+=i},get:()=>({min:e,max:t,count:n,sum:r,mean:r/n}),getRange:()=>({min:e,max:t})}},fastComputeRange:l,getDataType:d,getMaxNorm:function(e){const t=e.getNumberOfComponents();let n=0;const r=new Array(t);for(let i=0;i<e.getNumberOfTuples();++i){e.getTuple(i,r);const a=(0,o.n)(r,t);a>n&&(n=a)}return n}};const h={name:"",numberOfComponents:1,dataType:s,rangeTuple:[0,0]};function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,h,n),!t.empty&&!t.values&&!t.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(t.values?Array.isArray(t.values)&&(t.values=(0,i.b)(t.dataType,t.values)):t.values=(0,i.a)(t.dataType,t.size),t.values&&(t.size=t.size??t.values.length,t.dataType=d(t.values)),(0,i.o)(e,t),(0,i.s)(e,t,["name","numberOfComponents"]),t.size%t.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");!function(e,t){function n(n){if(n<0)return!1;const r=e.getNumberOfComponents(),o=t.values.length/(r>0?r:1);if(n===o)return!0;if(n>o){const e=t.values;return t.values=(0,i.a)(t.dataType,(n+o)*r),t.values.set(e),!0}return t.size>n*r&&(t.size=n*r,e.dataChange()),!0}t.classHierarchy.push("vtkDataArray"),e.dataChange=()=>{t.ranges=null,e.modified()},e.resize=r=>{n(r);const i=r*e.getNumberOfComponents();return t.size!==i&&(t.size=i,e.dataChange(),!0)},e.initialize=()=>{e.resize(0)},e.getElementComponentSize=()=>t.values.BYTES_PER_ELEMENT,e.getComponent=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.values[e*t.numberOfComponents+n]},e.setComponent=(n,r,i)=>{i!==t.values[n*t.numberOfComponents+r]&&(t.values[n*t.numberOfComponents+r]=i,e.dataChange())},e.getValue=n=>{const r=n/t.numberOfComponents,i=n%t.numberOfComponents;return e.getComponent(r,i)},e.setValue=(n,r)=>{const i=n/t.numberOfComponents,o=n%t.numberOfComponents;e.setComponent(i,o,r)},e.getData=()=>t.size===t.values.length?t.values:t.values.subarray(0,t.size),e.getRange=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=n;r<0&&(r=1===t.numberOfComponents?0:t.numberOfComponents);let i=null;return t.ranges||(t.ranges=u(t.ranges,t.numberOfComponents)),i=t.ranges[r],i?(t.rangeTuple[0]=i.min,t.rangeTuple[1]=i.max,t.rangeTuple):(i=c(e.getData(),n,t.numberOfComponents),t.ranges[r]=i,t.rangeTuple[0]=i.min,t.rangeTuple[1]=i.max,t.rangeTuple)},e.setRange=(e,n)=>{t.ranges||(t.ranges=u(t.ranges,t.numberOfComponents));const r={min:e.min,max:e.max};return t.ranges[n]=r,t.rangeTuple[0]=r.min,t.rangeTuple[1]=r.max,t.rangeTuple},e.setTuple=(e,n)=>{const r=e*t.numberOfComponents;for(let e=0;e<t.numberOfComponents;e++)t.values[r+e]=n[e]},e.setTuples=(e,n)=>{let r=e*t.numberOfComponents;const i=Math.min(n.length,t.size-r);for(let e=0;e<i;)t.values[r++]=n[e++]},e.insertTuple=(r,i)=>(t.size<=r*t.numberOfComponents&&(t.size=(r+1)*t.numberOfComponents,n(r+1)),e.setTuple(r,i),r),e.insertTuples=(r,i)=>{const o=r+i.length/t.numberOfComponents;return t.size<o*t.numberOfComponents&&(t.size=o*t.numberOfComponents,n(o)),e.setTuples(r,i),o},e.insertNextTuple=n=>{const r=t.size/t.numberOfComponents;return e.insertTuple(r,n)},e.insertNextTuples=n=>{const r=t.size/t.numberOfComponents;return e.insertTuples(r,n)},e.findTuple=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;for(let r=0;r<t.size;r+=t.numberOfComponents)if(Math.abs(e[0]-t.values[r])<=n){let i=!0;for(let o=1;o<t.numberOfComponents;++o)if(Math.abs(e[o]-t.values[r+o])>n){i=!1;break}if(i)return r/t.numberOfComponents}return-1},e.getTuple=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=t.numberOfComponents||1,i=e*r;switch(r){case 4:n[3]=t.values[i+3];case 3:n[2]=t.values[i+2];case 2:n[1]=t.values[i+1];case 1:n[0]=t.values[i];break;default:for(let e=r-1;e>=0;--e)n[e]=t.values[i+e]}return n},e.getTuples=(n,r)=>{const i=(n??0)*t.numberOfComponents,o=(r??e.getNumberOfTuples())*t.numberOfComponents,a=e.getData().subarray(i,o);return a.length>0?a:null},e.getTupleLocation=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*t.numberOfComponents},e.getNumberOfComponents=()=>t.numberOfComponents,e.getNumberOfValues=()=>t.size,e.getNumberOfTuples=()=>t.size/t.numberOfComponents,e.getDataType=()=>t.dataType,e.newClone=()=>m({empty:!0,name:t.name,dataType:t.dataType,numberOfComponents:t.numberOfComponents}),e.getName=()=>(t.name||(e.modified(),t.name=`vtkDataArray${e.getMTime()}`),t.name),e.setData=(n,r)=>{t.values=n,t.size=n.length,t.dataType=d(n),r&&(t.numberOfComponents=r),t.size%t.numberOfComponents!==0&&(t.numberOfComponents=1),e.dataChange()},e.getState=()=>{if(t.deleted)return null;const n={...t,vtkClass:e.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(e=>{n[e]||delete n[e]});const r={};return Object.keys(n).sort().forEach(e=>{r[e]=n[e]}),r.mtime&&delete r.mtime,r},e.deepCopy=n=>{const r=e.getDataType(),i=t.values;e.shallowCopy(n),i?.length>=n.getNumberOfValues()&&r===n.getDataType()?(i.set(n.getData()),t.values=i,e.dataChange()):e.setData(n.getData().slice())},e.interpolateTuple=(n,r,i,o,s,l)=>{const c=t.numberOfComponents||1;c===r.getNumberOfComponents()&&c===o.getNumberOfComponents()||a("numberOfComponents must match");const u=r.getTuple(i),d=o.getTuple(s),p=[];switch(p.length=c,c){case 4:p[3]=u[3]+(d[3]-u[3])*l;case 3:p[2]=u[2]+(d[2]-u[2])*l;case 2:p[1]=u[1]+(d[1]-u[1])*l;case 1:p[0]=u[0]+(d[0]-u[0])*l;break;default:for(let e=0;e<c;e++)p[e]=u[e]+(d[e]-u[e])*l}return e.insertTuple(n,p)}}(e,t)}const m=(0,i.n)(f,"vtkDataArray");var g={newInstance:m,extend:f,...p,...r.default}},89262:(e,t,n)=>{"use strict";n.d(t,{Tu:()=>i,Xe:()=>r,default:()=>o});const r={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},i={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"};var o={DefaultDataType:i.FLOAT,DataTypeByteSize:r,VtkDataTypes:i}},32069:(e,t,n)=>{"use strict";n.d(t,{default:()=>o});const r=new Float32Array(1),i=new Int32Array(r.buffer);var o={fromHalf:function(e){const t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0===n?(t?-1:1)*2**-14*(r/1024):31===n?r?NaN:1/0*(t?-1:1):(t?-1:1)*2**(n-15)*(1+r/1024)},toHalf:function(e){r[0]=e;const t=i[0];let n=t>>16&32768,o=t>>12&2047;const a=t>>23&255;return a<103?n:a>142?(n|=31744,n|=(255===a?0:1)&&8388607&t,n):a<113?(o|=2048,n|=(o>>114-a)+(o>>113-a&1),n):(n|=a-112<<10|o>>1,n+=1&o,n)}}},1600:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>d});var r=n(68470),i=n(59474),o=n(4666),a=n(77415),s=n(89262);const{vtkErrorMacro:l}=r.m;const c={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),o.default.extend(e,t,n),t.table||(t.table=[]),t.buildTime={},r.m.obj(t.buildTime),t.opaqueFlagBuildTime={},r.m.obj(t.opaqueFlagBuildTime,{mtime:0}),t.insertTime={},r.m.obj(t.insertTime,{mtime:0}),r.m.get(e,t,["buildTime"]),r.m.setGet(e,t,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),r.m.setArray(e,t,["alphaRange","hueRange","saturationRange","valueRange"],2),r.m.setArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"],4),r.m.getArray(e,t,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),function(e,t){t.classHierarchy.push("vtkLookupTable"),e.isOpaque=()=>{if(t.opaqueFlagBuildTime.getMTime()<e.getMTime()){let e=!0;t.nanColor[3]<1&&(e=0),t.useBelowRangeColor&&t.belowRangeColor[3]<1&&(e=0),t.useAboveRangeColor&&t.aboveRangeColor[3]<1&&(e=0);for(let n=3;n<t.table.length&&e;n+=4)t.table[n]<255&&(e=!1);t.opaqueFlag=e,t.opaqueFlagBuildTime.modified()}return t.opaqueFlag},e.usingLogScale=()=>!1,e.getNumberOfAvailableColors=()=>t.table.length/4,e.linearIndexLookup=(e,t)=>{let n=0;const r=Number(e);return r<t.range[0]?n=t.maxIndex+0+1.5:r>t.range[1]?n=t.maxIndex+1+1.5:(n=(r+t.shift)*t.scale,n=n<t.maxIndex?n:t.maxIndex),Math.floor(n)},e.linearLookup=(t,n,r)=>{let o=0;o=(0,i.i)(t)?Math.floor(r.maxIndex+1.5+2):e.linearIndexLookup(t,r);const a=4*o;return n.slice(a,a+4)},e.indexedLookupFunction=(n,r,i)=>{let o=e.getAnnotatedValueIndexInternal(n);-1===o&&(o=t.numberOfColors+2);const a=4*o;return[r[a],r[a+1],r[a+2],r[a+3]]},e.lookupShiftAndScale=(e,t)=>{t.shift=-e[0],t.scale=Number.MAX_VALUE,e[1]>e[0]&&(t.scale=(t.maxIndex+1)/(e[1]-e[0]))},e.mapScalarsThroughTable=(n,r,i,o)=>{let s=e.linearLookup;t.indexedLookup&&(s=e.indexedLookupFunction);const l=e.getMappingRange(),c={maxIndex:e.getNumberOfColors()-1,range:l,shift:0,scale:0};e.lookupShiftAndScale(l,c);const u=e.getAlpha(),d=n.getNumberOfTuples(),p=n.getNumberOfComponents(),h=r.getData(),f=n.getData();if(u>=1){if(i===a.O.RGBA)for(let e=0;e<d;e++){const n=s(f[e*p+o],t.table,c);h[4*e]=n[0],h[4*e+1]=n[1],h[4*e+2]=n[2],h[4*e+3]=n[3]}}else if(i===a.O.RGBA)for(let e=0;e<d;e++){const n=s(f[e*p+o],t.table,c);h[4*e]=n[0],h[4*e+1]=n[1],h[4*e+2]=n[2],h[4*e+3]=Math.floor(n[3]*u+.5)}},e.forceBuild=()=>{let n=0,r=0,o=0,a=0;const s=t.numberOfColors-1;s&&(n=(t.hueRange[1]-t.hueRange[0])/s,r=(t.saturationRange[1]-t.saturationRange[0])/s,o=(t.valueRange[1]-t.valueRange[0])/s,a=(t.alphaRange[1]-t.alphaRange[0])/s),t.table.length=4*s+16;const l=[],c=[];for(let e=0;e<=s;e++)l[0]=t.hueRange[0]+e*n,l[1]=t.saturationRange[0]+e*r,l[2]=t.valueRange[0]+e*o,(0,i.h)(l,c),c[3]=t.alphaRange[0]+e*a,t.table[4*e]=255*c[0]+.5,t.table[4*e+1]=255*c[1]+.5,t.table[4*e+2]=255*c[2]+.5,t.table[4*e+3]=255*c[3]+.5;e.buildSpecialColors(),t.buildTime.modified()},e.setTable=n=>{if(Array.isArray(n)){const r=n[0].length;t.numberOfColors=n.length;const i=4-r;let o=0;for(let e=0;e<t.numberOfColors;e++)t.table[4*e]=255,t.table[4*e+1]=255,t.table[4*e+2]=255,t.table[4*e+3]=255;for(let e=0;e<n.length;e++){const a=n[e];for(let e=0;e<r;e++)t.table[o++]=a[e];o+=i}return e.buildSpecialColors(),t.insertTime.modified(),e.modified(),!0}if(4!==n.getNumberOfComponents())return l("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==s.Tu.UNSIGNED_CHAR)return l("Expected unsigned char values for RGBA colors"),!1;t.numberOfColors=n.getNumberOfTuples();const r=n.getData();t.table.length=r.length;for(let e=0;e<r.length;e++)t.table[e]=r[e];return e.buildSpecialColors(),t.insertTime.modified(),e.modified(),!0},e.buildSpecialColors=()=>{const{numberOfColors:e}=t,n=t.table;let r=4*(e+0);t.useBelowRangeColor||0===e?(n[r]=255*t.belowRangeColor[0]+.5,n[r+1]=255*t.belowRangeColor[1]+.5,n[r+2]=255*t.belowRangeColor[2]+.5,n[r+3]=255*t.belowRangeColor[3]+.5):(n[r]=n[0],n[r+1]=n[1],n[r+2]=n[2],n[r+3]=n[3]),r=4*(e+1),t.useAboveRangeColor||0===e?(n[r]=255*t.aboveRangeColor[0]+.5,n[r+1]=255*t.aboveRangeColor[1]+.5,n[r+2]=255*t.aboveRangeColor[2]+.5,n[r+3]=255*t.aboveRangeColor[3]+.5):(n[r]=n[4*(e-1)+0],n[r+1]=n[4*(e-1)+1],n[r+2]=n[4*(e-1)+2],n[r+3]=n[4*(e-1)+3]),r=4*(e+2),n[r]=255*t.nanColor[0]+.5,n[r+1]=255*t.nanColor[1]+.5,n[r+2]=255*t.nanColor[2]+.5,n[r+3]=255*t.nanColor[3]+.5},e.build=()=>{(t.table.length<1||e.getMTime()>t.buildTime.getMTime()&&t.insertTime.getMTime()<=t.buildTime.getMTime())&&e.forceBuild()},t.table.length>0&&(e.buildSpecialColors(),t.insertTime.modified())}(e,t)}var d={newInstance:r.m.newInstance(u,"vtkLookupTable"),extend:u}},32899:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r.f});n(53775),n(68470),n(40286);var r=n(59474)},40286:(e,t,n)=>{"use strict";n.d(t,{B0:()=>a,Ib:()=>o,Wd:()=>r,qt:()=>i});const r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[1,0,0,0,1,0,0,0,1],o=1e-6,a=1e-12},59474:(e,t,n)=>{"use strict";n.d(t,{A:()=>g,C:()=>qe,F:()=>ut,J:()=>y,K:()=>at,L:()=>Ve,M:()=>He,N:()=>je,O:()=>v,P:()=>re,Q:()=>I,R:()=>le,S:()=>pt,T:()=>Ke,U:()=>D,a:()=>me,b:()=>Ee,c:()=>Xe,d:()=>W,e:()=>Y,f:()=>vt,g:()=>Oe,h:()=>Ue,i:()=>ct,j:()=>H,k:()=>k,l:()=>Z,m:()=>B,n:()=>j,o:()=>ie,r:()=>m,s:()=>F,u:()=>Ze});var r=n(53775),i=n.n(r),o=n(68470),a=n(40286);const{vtkErrorMacro:s,vtkWarningMacro:l}=o.m;let c=0;function u(e){return()=>s(`vtkMath::${e} - NOT IMPLEMENTED`)}function d(e,t,n,r){let i;for(let o=0;o<t;o++)i=e[n*t+o],e[n*t+o]=e[r*t+o],e[r*t+o]=i}function p(e,t,n,r){let i;for(let o=0;o<t;o++)i=e[o*t+n],e[o*t+n]=e[o*t+r],e[o*t+r]=i}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;const t=Array(e);for(let n=0;n<e;++n)t[n]=0;return t}const f=()=>Math.PI;function m(e){return e/180*Math.PI}function g(e){return 180*e/Math.PI}const{round:v,floor:y,ceil:b,min:C,max:w}=Math;function E(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=1/0;for(let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.length;r<i;r+=t)e[r]<n&&(n=e[r]);return n}function T(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=-1/0;for(let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.length;r<i;r+=t)n<e[r]&&(n=e[r]);return n}function x(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=1/0,r=-1/0;for(let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=e.length;i<o;i+=t)e[i]<n&&(n=e[i]),r<e[i]&&(r=e[i]);return[n,r]}const _=u("ceilLog2"),S=u("factorial");function I(e){let t=1;for(;t<e;)t*=2;return t}function D(e){return e===I(e)}function A(e,t){let n=1;for(let r=1;r<=t;++r)n*=(e-r+1)/r;return Math.floor(n)}function P(e,t){if(e<t)return 0;const n=h(t);for(let e=0;e<t;++e)n[e]=e;return n}function O(e,t,n){let r=0;for(let i=t-1;i>=0;--i)if(n[i]<e-t+i){let e=n[i]+1;for(;i<t;)n[i++]=e++;r=1;break}return r}function R(e){i()(`${e}`,{global:!0}),c=e}function M(){return c}function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e+((arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)-e)*Math.random()}const L=u("gaussian");function k(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function F(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function V(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e}function U(e,t){return e[0]*=t,e[1]*=t,e}function B(e,t,n,r){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r}function G(e,t,n,r){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r}function W(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function z(e,t,n){n[0]=e[0]*t[0],n[1]=e[0]*t[1],n[2]=e[0]*t[2],n[3]=e[1]*t[0],n[4]=e[1]*t[1],n[5]=e[1]*t[2],n[6]=e[2]*t[0],n[7]=e[2]*t[1],n[8]=e[2]*t[2]}function H(e,t,n){const r=e[1]*t[2]-e[2]*t[1],i=e[2]*t[0]-e[0]*t[2],o=e[0]*t[1]-e[1]*t[0];return n[0]=r,n[1]=i,n[2]=o,n}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;switch(t){case 1:return Math.abs(e);case 2:return Math.sqrt(e[0]*e[0]+e[1]*e[1]);case 3:return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);default:{let n=0;for(let r=0;r<t;r++)n+=e[r]*e[r];return Math.sqrt(n)}}}function Z(e){const t=j(e);return 0!==t&&(e[0]/=t,e[1]/=t,e[2]/=t),t}function K(e,t,n,r){const i=e[0]*e[0],o=e[1]*e[1],a=e[2]*e[2],s=Math.sqrt(i+o+a);let l,c,u;i>o&&i>a?(l=0,c=1,u=2):o>a?(l=1,c=2,u=0):(l=2,c=0,u=1);const d=e[l]/s,p=e[c]/s,h=e[u]/s,f=Math.sqrt(d*d+h*h);if(0!==r){const e=Math.sin(r),i=Math.cos(r);t&&(t[l]=(h*i-d*p*e)/f,t[c]=e*f,t[u]=(-d*i-p*h*e)/f),n&&(n[l]=(-h*e-d*p*i)/f,n[c]=i*f,n[u]=(d*e-p*h*i)/f)}else t&&(t[l]=h/f,t[c]=0,t[u]=-d/f),n&&(n[l]=-d*p/f,n[c]=f,n[u]=-p*h/f)}function $(e,t,n){const r=W(t,t);if(0===r)return n[0]=0,n[1]=0,n[2]=0,!1;const i=W(e,t)/r;for(let e=0;e<3;e++)n[e]=t[e];return V(n,i),!0}function q(e,t){return e[0]*t[0]+e[1]*t[1]}function X(e,t,n){const r=q(t,t);if(0===r)return n[0]=0,n[1]=0,!1;const i=q(e,t)/r;for(let e=0;e<2;e++)n[e]=t[e];return U(n,i),!0}function Y(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])}function J(e,t){const n=[0,0,0];return H(e,t,n),Math.atan2(j(n),W(e,t))}function Q(e,t,n){const r=Math.abs(e-n);return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-(r**2)/(2*t))}function ee(e,t,n){const r=Math.abs(e-n);return Math.exp(-(r**2)/(2*t))}function te(e,t,n){n[0]=e[0]*t[0],n[1]=e[0]*t[1],n[2]=e[1]*t[0],n[3]=e[1]*t[1]}function ne(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function re(e){const t=ne(e);return 0!==t&&(e[0]/=t,e[1]/=t),t}function ie(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 2===t.length?t[0][0]*t[1][1]-t[1][0]*t[0][1]:4===t.length?t[0]*t[3]-t[1]*t[2]:Number.NaN}function oe(e,t){let n,r,i;const o=[0,0,0];for(let t=0;t<3;t++)i=Math.abs(e[3*t]),(r=Math.abs(e[3*t+1]))>i&&(i=r),(r=Math.abs(e[3*t+2]))>i&&(i=r),o[t]=1/i;i=o[0]*Math.abs(e[0]),n=0,(r=o[1]*Math.abs(e[3]))>=i&&(i=r,n=1),(r=o[2]*Math.abs(e[6]))>=i&&(n=2),0!==n&&(d(e,3,n,0),o[n]=o[0]),t[0]=n,e[3]/=e[0],e[6]/=e[0],e[4]-=e[3]*e[1],e[7]-=e[6]*e[1],i=o[1]*Math.abs(e[4]),n=1,(r=o[2]*Math.abs(e[7]))>=i&&(n=2,d(e,3,1,2),o[2]=o[1]),t[1]=n,e[7]/=e[4],e[5]-=e[3]*e[2],e[8]-=e[6]*e[2]+e[7]*e[5],t[2]=2}function ae(e,t,n){let r=n[t[0]];n[t[0]]=n[0],n[0]=r,r=n[t[1]],n[t[1]]=n[1],n[1]=r-e[3]*n[0],r=n[t[2]],n[t[2]]=n[2],n[2]=r-e[6]*n[0]-e[7]*n[1],n[2]/=e[8],n[1]=(n[1]-e[5]*n[2])/e[4],n[0]=(n[0]-e[1]*n[1]-e[2]*n[2])/e[0]}function se(e,t,n){const r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=+ie(s,u,l,d),h=-ie(a,c,l,d),f=+ie(a,c,s,u),m=-ie(i,u,o,d),g=+ie(r,c,o,d),v=-ie(r,c,i,u),y=+ie(i,s,o,l),b=-ie(r,a,o,l),C=+ie(r,a,i,s),w=r*p+i*h+o*f,E=p*t[0]+m*t[1]+y*t[2],T=h*t[0]+g*t[1]+b*t[2],x=f*t[0]+v*t[1]+C*t[2];n[0]=E/w,n[1]=T/w,n[2]=x/w}function le(e,t,n){const r=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],i=e[3]*t[0]+e[4]*t[1]+e[5]*t[2],o=e[6]*t[0]+e[7]*t[1]+e[8]*t[2];n[0]=r,n[1]=i,n[2]=o}function ce(e,t,n){const r=[...e],i=[...t];for(let e=0;e<3;e++)n[e]=r[0]*i[e]+r[1]*i[e+3]+r[2]*i[e+6],n[e+3]=r[3]*i[e]+r[4]*i[e+3]+r[5]*i[e+6],n[e+6]=r[6]*i[e]+r[7]*i[e+3]+r[8]*i[e+6]}function ue(e,t,n,r,i,o,a){r!==i&&s("Number of columns of A must match number of rows of B.");const l=[...e],c=[...t];for(let e=0;e<n;e++)for(let t=0;t<o;t++){a[e*o+t]=0;for(let n=0;n<r;n++)a[e*o+t]+=l[e*r+n]*c[t+o*n]}}function de(e,t){let n;n=e[3],t[3]=e[1],t[1]=n,n=e[6],t[6]=e[2],t[2]=n,n=e[7],t[7]=e[5],t[5]=n,t[0]=e[0],t[4]=e[4],t[8]=e[8]}function pe(e,t){const n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],u=e[7],d=e[8],p=+ie(a,u,s,d),h=-ie(o,c,s,d),f=+ie(o,c,a,u),m=-ie(r,u,i,d),g=+ie(n,c,i,d),v=-ie(n,c,r,u),y=+ie(r,a,i,s),b=-ie(n,o,i,s),C=+ie(n,o,r,a),w=n*p+r*h+i*f;0===w&&l("Matrix has 0 determinant"),t[0]=p/w,t[3]=h/w,t[6]=f/w,t[1]=m/w,t[4]=g/w,t[7]=v/w,t[2]=y/w,t[5]=b/w,t[8]=C/w}function he(e){return e[0]*e[4]*e[8]+e[3]*e[7]*e[2]+e[6]*e[1]*e[5]-e[0]*e[7]*e[5]-e[3]*e[1]*e[8]-e[6]*e[4]*e[2]}function fe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Ib;if(e.length!==t.length)return!1;return e.every(function(e,r){return Math.abs(e-t[r])<=n})}const me=fe;function ge(e){for(let t=0;t<3;t++)e[3*t]=e[3*t+1]=e[3*t+2]=0,e[3*t+t]=1}function ve(e,t){for(let n=0;n<e;n++){for(let r=0;r<e;r++)t[n*e+r]=0;t[n*e+n]=1}return t}function ye(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Ib;return me(e,a.Wd,t)}function be(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Ib;return me(e,a.qt,t)}function Ce(e,t){const n=e[0]*e[0],r=e[0]*e[1],i=e[0]*e[2],o=e[0]*e[3],a=e[1]*e[1],s=e[2]*e[2],l=e[3]*e[3],c=e[1]*e[2],u=e[1]*e[3],d=e[2]*e[3],p=a+s+l;let h=1/(n+p);const f=(n-p)*h;h*=2,t[0]=a*h+f,t[3]=(c+o)*h,t[6]=(u-i)*h,t[1]=(c-o)*h,t[4]=s*h+f,t[7]=(d+r)*h,t[2]=(u+i)*h,t[5]=(d-r)*h,t[8]=l*h+f}function we(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!`${e}`.includes("e"))return+`${Math.round(`${e}e+${t}`)}e-${t}`;const n=`${e}`.split("e");let r="";return+n[1]+t>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+t}`)}e-${t}`}function Ee(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t[0]=we(e[0],n),t[1]=we(e[1],n),t[2]=we(e[2],n),t}function Te(e,t,n,r){let i,o,s,c,u,d,f,m,g,v,y,b,C,w,E,T;const x=h(t),_=h(t),S=(e,t,n)=>{w=e[t],C=e[n],e[t]=w-b*(C+w*v),e[n]=C+b*(w-C*v)};for(ve(t,r),u=0;u<t;u++)x[u]=n[u]=e[u+u*t],_[u]=0;for(i=0;i<20;i++){for(y=0,u=0;u<t-1;u++)for(c=u+1;c<t;c++)y+=Math.abs(e[u*t+c]);if(0===y)break;for(f=i<3?.2*y/(t*t):0,u=0;u<t-1;u++)for(c=u+1;c<t;c++)if(w=100*Math.abs(e[u*t+c]),i>3&&Math.abs(n[u])+w===Math.abs(n[u])&&Math.abs(n[c])+w===Math.abs(n[c]))e[u*t+c]=0;else if(Math.abs(e[u*t+c])>f){for(C=n[c]-n[u],Math.abs(C)+w===Math.abs(C)?g=e[u*t+c]/C:(m=.5*C/e[u*t+c],g=1/(Math.abs(m)+Math.sqrt(1+m*m)),m<0&&(g=-g)),E=1/Math.sqrt(1+g*g),b=g*E,v=b/(1+E),C=g*e[u*t+c],_[u]-=C,_[c]+=C,n[u]-=C,n[c]+=C,e[u*t+c]=0,o=0;o<=u-1;o++)S(e,o*t+u,o*t+c);for(o=u+1;o<=c-1;o++)S(e,u*t+o,o*t+c);for(o=c+1;o<t;o++)S(e,u*t+o,c*t+o);for(o=0;o<t;o++)S(r,o*t+u,o*t+c)}for(u=0;u<t;u++)x[u]+=_[u],n[u]=x[u],_[u]=0}if(i>=20)return l("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(o=0;o<t-1;o++){for(s=o,T=n[s],i=o+1;i<t;i++)(n[i]>=T||Math.abs(n[i]-T)<a.B0)&&(s=i,T=n[s]);s!==o&&(n[s]=n[o],n[o]=T,p(r,t,o,s))}const I=(t>>1)+(1&t);for(d=0,i=0;i<t*t;i++)r[i]>=0&&d++;if(d<I)for(i=0;i<t;i++)r[i*t+o]*=-1;return 1}function xe(e,t){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=e[0]+e[4]+e[8],n[5]=e[0]-e[4]-e[8],n[10]=-e[0]+e[4]-e[8],n[15]=-e[0]-e[4]+e[8],n[1]=n[4]=e[7]-e[5],n[2]=n[8]=e[2]-e[6],n[3]=n[12]=e[3]-e[1],n[6]=n[9]=e[3]+e[1],n[7]=n[13]=e[2]+e[6],n[11]=n[14]=e[7]+e[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];Te([...n],4,[0,0,0,0],r),t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12]}function _e(e,t,n){const r=e[0]*t[0],i=e[0]*t[1],o=e[0]*t[2],a=e[0]*t[3],s=e[1]*t[0],l=e[1]*t[1],c=e[1]*t[2],u=e[1]*t[3],d=e[2]*t[0],p=e[2]*t[1],h=e[2]*t[2],f=e[2]*t[3],m=e[3]*t[0],g=e[3]*t[1],v=e[3]*t[2],y=e[3]*t[3];n[0]=r-l-h-y,n[1]=i+s+f-v,n[2]=o-u+d+g,n[3]=a+c-p+m}function Se(e,t){for(let n=0;n<9;n++)t[n]=e[n];const n=h(3),r=h(3);let i;for(let e=0;e<3;e++){const r=Math.abs(t[3*e]),o=Math.abs(t[3*e+1]),a=Math.abs(t[3*e+2]);i=o>r?o:r,i=a>i?a:i,n[e]=1,0!==i&&(n[e]/=i)}const o=Math.abs(t[0])*n[0],a=Math.abs(t[3])*n[1],s=Math.abs(t[6])*n[2];r[0]=0,i=o,a>=i&&(i=a,r[0]=1),s>=i&&(r[0]=2),0!==r[0]&&(p(t,3,r[0],0),n[r[0]]=n[0]);const l=Math.abs(t[4])*n[1],c=Math.abs(t[7])*n[2];r[1]=1,i=l,c>=i&&(r[1]=2,p(t,3,1,2)),r[2]=2;let u=0;if(he(t)<0){u=1;for(let e=0;e<9;e++)t[e]=-t[e]}const d=h(4);if(xe(t,d),Ce(d,t),u)for(let e=0;e<9;e++)t[e]=-t[e];1!==r[1]&&p(t,3,r[1],1),0!==r[0]&&p(t,3,r[0],0)}function Ie(e,t,n){let r,i,o,a,s,l;if(Te([...e],3,t,n),t[0]!==t[1]||t[0]!==t[2]){for(de(n,n),r=0;r<3;r++)if(t[(r+1)%3]===t[(r+2)%3]){for(l=Math.abs(n[3*r]),a=0,i=1;i<3;i++)l<(s=Math.abs(n[3*r+i]))&&(l=s,a=i);a!==r&&(s=t[a],t[a]=t[r],t[r]=s,d(n,3,r,a)),n[3*a+a]<0&&(n[3*a]=-n[3*a],n[3*a+1]=-n[3*a+1],n[3*a+2]=-n[3*a+2]),i=(a+1)%3,o=(a+2)%3,n[3*i]=0,n[3*i+1]=0,n[3*i+2]=0,n[3*i+i]=1;const e=H([n[3*a],n[3*a+1],n[3*a+2]],[n[3*i],n[3*i+1],n[3*i+2]],[]);Z(e);const c=H(e,[n[3*a],n[3*a+1],n[3*a+2]],[]);for(let t=0;t<3;t++)n[3*o+t]=e[t],n[3*i+t]=c[t];return void de(n,n)}for(l=Math.abs(n[0]),a=0,r=1;r<3;r++)l<(s=Math.abs(n[3*r]))&&(l=s,a=r);if(0!==a){const e=t[a];t[a]=t[0],t[0]=e,d(n,3,a,0)}if(Math.abs(n[4])<Math.abs(n[7])){const e=t[2];t[2]=t[1],t[1]=e,d(n,3,1,2)}for(r=0;r<2;r++)n[3*r+r]<0&&(n[3*r]=-n[3*r],n[3*r+1]=-n[3*r+1],n[3*r+2]=-n[3*r+2]);he(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),de(n,n)}else ge(n)}function De(e,t,n,r){let i;const o=[...e],a=he(o);if(a<0)for(i=0;i<9;i++)o[i]=-o[i];Se(o,t),de(o,o),ce(o,t,r),Ie(r,n,r),ce(t,r,t),de(r,r),a<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function Ae(e,t,n){let r,i,o,s,c,u,d,p=0;const f=h(n);for(r=0;r<n;r++){for(s=0,i=0;i<n;i++)(d=Math.abs(e[r*n+i]))>s&&(s=d);if(0===s)return l("Unable to factor linear system"),0;f[r]=1/s}for(i=0;i<n;i++){for(r=0;r<i;r++){for(c=e[r*n+i],o=0;o<r;o++)c-=e[r*n+o]*e[o*n+i];e[r*n+i]=c}for(s=0,r=i;r<n;r++){for(c=e[r*n+i],o=0;o<i;o++)c-=e[r*n+o]*e[o*n+i];e[r*n+i]=c,(u=f[r]*Math.abs(c))>=s&&(s=u,p=r)}if(i!==p){for(o=0;o<n;o++)u=e[p*n+o],e[p*n+o]=e[i*n+o],e[i*n+o]=u;f[p]=f[i]}if(t[i]=p,Math.abs(e[i*n+i])<=a.B0)return l("Unable to factor linear system"),0;if(i!==n-1)for(u=1/e[i*n+i],r=i+1;r<n;r++)e[r*n+i]*=u}return 1}function Pe(e,t,n,r){let i,o,a,s,l;for(a=-1,i=0;i<r;i++){if(s=t[i],l=n[s],n[s]=n[i],a>=0)for(o=a;o<=i-1;o++)l-=e[i*r+o]*n[o];else 0!==l&&(a=i);n[i]=l}for(i=r-1;i>=0;i--){for(l=n[i],o=i+1;o<r;o++)l-=e[i*r+o]*n[o];n[i]=l/e[i*r+i]}}function Oe(e,t,n){if(2===n){const n=h(2),r=ie(e[0],e[1],e[2],e[3]);return 0===r?0:(n[0]=(e[3]*t[0]-e[1]*t[1])/r,n[1]=(-e[2]*t[0]+e[0]*t[1])/r,t[0]=n[0],t[1]=n[1],1)}if(1===n)return 0===e[0]?0:(t[0]/=e[0],1);const r=h(n);return 0===Ae(e,r,n)?0:(Pe(e,r,t,n),1)}function Re(e,t,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)||h(n),o=r||h(n);if(0===Ae(e,i,n))return null;for(let r=0;r<n;r++){for(let e=0;e<n;e++)o[e]=0;o[r]=1,Pe(e,i,o,n);for(let e=0;e<n;e++)t[e*n+r]=o[e]}return t}function Me(e,t){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<t;n++)for(let i=n;i<t;i++)Math.abs(e[n*t+i])>r&&(r=Math.abs(e[n*t+i]));for(let r=0;r<t;r++)Math.abs(e[r*t+r])<n&&(n=Math.abs(e[r*t+r]));return 0===n?Number.MAX_VALUE:r/n}function Ne(e,t,n){return Te(e,3,t,n)}function Le(e,t,n,r){if(e<n)return l("Insufficient number of samples. Underdetermined."),0;let i,o,a;const s=h(n*n),c=h(n),u=h(n*n);for(a=0;a<e;a++)for(i=0;i<n;i++)for(o=i;o<n;o++)s[i*n+o]+=t[a*n+i]*t[a*n+o];for(i=0;i<n;i++)for(o=0;o<i;o++)s[i*n+o]=s[o*n+i];for(Te(s,n,c,u),i=0;i<n;i++)r[i]=u[i*n+n-1];return 1}function ke(e,t,n,r,i,o){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(e<n||e<i)return l("Insufficient number of samples. Underdetermined."),0;const c=h(i);let u,d,p,f,m=1,g=0,v=0;if(s){for(p=0;p<i;p++)c[p]=1;for(d=0;d<e;d++)for(p=0;p<i;p++)Math.abs(r[d*i+p])>a.B0&&(m=0,c[p]=0);if(m&&1===i)return l("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),Le(e,t,n,o);if(m)v=1;else for(p=0;p<i;p++)c[p]&&(v=1)}v&&(u=h(n),g=Le(e,t,n,u));const y=h(n*n),b=h(n*n),C=h(n*i);for(f=0;f<e;f++)for(d=0;d<n;d++){for(p=d;p<n;p++)y[d*n+p]+=t[f*n+d]*t[f*n+p];for(p=0;p<i;p++)C[d*i+p]+=t[f*n+d]*r[f*i+p]}for(d=0;d<n;d++)for(p=0;p<d;p++)y[d*n+p]=y[p*n+d];const w=Re(y,b,n);if(w)for(d=0;d<n;d++)for(p=0;p<i;p++)for(o[d*i+p]=0,f=0;f<n;f++)o[d*i+p]+=b[d*n+f]*C[f*i+p];if(v)for(p=0;p<i;p++)if(c[p])for(d=0;d<n;d++)o[d*i+p]=u[d*i];return v?g&&w:w}function Fe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,.5,1];switch(e.length){case 3:return t[0]=17*parseInt(e[0],16)/255,t[1]=17*parseInt(e[1],16)/255,t[2]=17*parseInt(e[2],16)/255,t;case 4:return t[0]=17*parseInt(e[1],16)/255,t[1]=17*parseInt(e[2],16)/255,t[2]=17*parseInt(e[3],16)/255,t;case 6:return t[0]=parseInt(e.substr(0,2),16)/255,t[1]=parseInt(e.substr(2,2),16)/255,t[2]=parseInt(e.substr(4,2),16)/255,t;case 7:return t[0]=parseInt(e.substr(1,2),16)/255,t[1]=parseInt(e.substr(3,2),16)/255,t[2]=parseInt(e.substr(5,2),16)/255,t;case 9:return t[0]=parseInt(e.substr(1,2),16)/255,t[1]=parseInt(e.substr(3,2),16)/255,t[2]=parseInt(e.substr(5,2),16)/255,t[3]=parseInt(e.substr(7,2),16)/255,t;default:return t}}function Ve(e,t){let n,r;const[i,o,a]=e,s=1/6;let l=i,c=i;o>l?l=o:o<c&&(c=o),a>l?l=a:a<c&&(c=a);const u=l;r=u>0?(l-c)/l:0,r>0?(n=i===l?s*(o-a)/(l-c):o===l?1/3+s*(a-i)/(l-c):2/3+s*(i-o)/(l-c),n<0&&(n+=1)):n=0,t[0]=n,t[1]=r,t[2]=u}function Ue(e,t){const[n,r,i]=e,o=1/3,a=1/6,s=2/3,l=5/6;let c,u,d;n>a&&n<=o?(u=1,c=(o-n)/a,d=0):n>o&&n<=.5?(u=1,d=(n-o)/a,c=0):n>.5&&n<=s?(d=1,u=(s-n)/a,c=0):n>s&&n<=l?(d=1,c=(n-s)/a,u=0):n>l&&n<=1?(c=1,d=(1-n)/a,u=0):(c=1,u=n/a,d=0),c=r*c+(1-r),u=r*u+(1-r),d=r*d+(1-r),c*=i,u*=i,d*=i,t[0]=c,t[1]=u,t[2]=d}function Be(e,t){const[n,r,i]=e;let o=(n+16)/116,a=r/500+o,s=o-i/200;o**3>.008856?o**=3:o=(o-16/116)/7.787,a**3>.008856?a**=3:a=(a-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;t[0]=.9505*a,t[1]=1*o,t[2]=1.089*s}function Ge(e,t){const[n,r,i]=e;let o=n/.9505,a=r/1,s=i/1.089;o>.008856?o**=1/3:o=7.787*o+16/116,a>.008856?a**=1/3:a=7.787*a+16/116,s>.008856?s**=1/3:s=7.787*s+16/116,t[0]=116*a-16,t[1]=500*(o-a),t[2]=200*(a-s)}function We(e,t){const[n,r,i]=e;let o=3.2406*n+-1.5372*r+-.4986*i,a=-.9689*n+1.8758*r+.0415*i,s=.0557*n+-.204*r+1.057*i;o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let l=o;l<a&&(l=a),l<s&&(l=s),l>1&&(o/=l,a/=l,s/=l),o<0&&(o=0),a<0&&(a=0),s<0&&(s=0),t[0]=o,t[1]=a,t[2]=s}function ze(e,t){let[n,r,i]=e;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,t[0]=.4124*n+.3576*r+.1805*i,t[1]=.2126*n+.7152*r+.0722*i,t[2]=.0193*n+.1192*r+.9505*i}function He(e,t){const n=[0,0,0];ze(e,n),Ge(n,t)}function je(e,t){const n=[0,0,0];Be(e,n),We(n,t)}function Ze(e){return e[0]=1,e[1]=-1,e[2]=1,e[3]=-1,e[4]=1,e[5]=-1,e}function Ke(e){return!(e[1]-e[0]<0)}function $e(e,t,n){return n[0]=Math.min(e[0],t[0]),n[1]=Math.max(e[0],t[0]),n[2]=Math.min(e[1],t[1]),n[3]=Math.max(e[1],t[1]),n[4]=Math.min(e[2],t[2]),n[5]=Math.max(e[2],t[2]),n}function qe(e,t,n){return e<t?t:e>n?n:e}function Xe(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0];return r[0]=qe(e[0],t[0],n[0]),r[1]=qe(e[1],t[1],n[1]),r[2]=qe(e[2],t[2],n[2]),r}function Ye(e,t){let n=0;return t[0]!==t[1]&&(n=e<t[0]?t[0]:e>t[1]?t[1]:e,n=(n-t[0])/(t[1]-t[0])),n}const Je=u("GetScalarTypeFittingRange"),Qe=u("GetAdjustedScalarRange");function et(e,t){if(!e||!t)return 0;for(let n=0;n<6;n+=2)if(e[n]<t[n]||e[n]>t[n+1]||e[n+1]<t[n]||e[n+1]>t[n+1])return 0;return 1}function tt(e,t,n){if(!e||!t)return 0;for(let r=0;r<6;r+=2)if(e[r]+n[r/2]<t[r]||e[r]-n[r/2]>t[r+1]||e[r+1]+n[r/2]<t[r]||e[r+1]-n[r/2]>t[r+1])return 0;return 1}function nt(e,t,n){if(!e||!t||!n)return 0;for(let r=0;r<3;r++)if(e[r]+n[r]<t[2*r]||e[r]-n[r]>t[2*r+1])return 0;return 1}function rt(e,t,n,r){const i=h(3),o=h(3),a=h(3),s=h(3),l=h(3),c=h(3);for(let r=0;r<3;++r)i[r]=e[r]-t[r],o[r]=t[r]-n[r],a[r]=n[r]-e[r],s[r]=-i[r],l[r]=-o[r],c[r]=-a[r];const u=j(s),d=j(l),p=j(a),f=h(3);H(i,o,f);const m=j(f),g=u*d*p/(2*m),v=2*m*m,y=d*d*W(i,c)/v,b=p*p*W(s,o)/v,C=u*u*W(a,l)/v;for(let i=0;i<3;++i)r[i]=y*e[i]+b*t[i]+C*n[i];return g}const it=1/0,ot=-1/0,at=e=>!Number.isFinite(e),{isFinite:st,isNaN:lt}=Number,ct=lt;function ut(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function dt(e){let t=-1,n=-1;for(let r=0;r<e.length;r++){const i=Math.abs(e[r]);i>t&&(n=r,t=i)}return n}function pt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const n=new Array(t),r=new Array(t);for(let e=0;e<t;++e)n[e]=e,r[e]=e;for(let i=t-1;i>0;i--){let o=-1/0,a=0,s=0;for(let l=0;l<=i;++l){const c=n[l];for(let n=0;n<=i;++n){const i=r[n],u=Math.abs(e[c+t*i]);u>o&&(o=u,a=l,s=n)}}[n[i],n[a]]=[n[a],n[i]],[r[i],r[s]]=[r[s],r[i]]}const i=new Array(t*t).fill(0);for(let o=0;o<t;++o){const a=n[o]+t*r[o];i[a]=e[a]<0?-1:1}return i}function ht(e){const t=Math.floor(255*e);return t>15?t.toString(16):`0${t.toString(16)}`}function ft(e){return`${arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#"}${e.map(ht).join("")}`}function mt(e){return Math.round(255*e)}function gt(e){return 3===e.length?`rgb(${e.map(mt).join(", ")})`:`rgba(${mt(e[0]||0)}, ${mt(e[1]||0)}, ${mt(e[2]||0)}, ${e[3]||0})`}var vt={Pi:f,radiansFromDegrees:m,degreesFromRadians:g,round:v,floor:y,ceil:b,ceilLog2:_,min:C,max:w,arrayMin:E,arrayMax:T,arrayRange:x,isPowerOfTwo:D,nearestPowerOfTwo:I,factorial:S,binomial:A,beginCombination:P,nextCombination:O,randomSeed:R,getSeed:M,random:N,gaussian:L,add:k,subtract:F,multiplyScalar:V,multiplyScalar2D:U,multiplyAccumulate:B,multiplyAccumulate2D:G,dot:W,outer:z,cross:H,norm:j,normalize:Z,perpendiculars:K,projectVector:$,projectVector2D:X,distance2BetweenPoints:Y,angleBetweenVectors:J,gaussianAmplitude:Q,gaussianWeight:ee,dot2D:q,outer2D:te,norm2D:ne,normalize2D:re,determinant2x2:ie,LUFactor3x3:oe,LUSolve3x3:ae,linearSolve3x3:se,multiply3x3_vect3:le,multiply3x3_mat3:ce,multiplyMatrix:ue,transpose3x3:de,invert3x3:pe,identity3x3:ge,identity:ve,isIdentity:ye,isIdentity3x3:be,determinant3x3:he,quaternionToMatrix3x3:Ce,areEquals:fe,areMatricesEqual:me,roundNumber:we,roundVector:Ee,matrix3x3ToQuaternion:xe,multiplyQuaternion:_e,orthogonalize3x3:Se,diagonalize3x3:Ie,singularValueDecomposition3x3:De,solveLinearSystem:Oe,invertMatrix:Re,luFactorLinearSystem:Ae,luSolveLinearSystem:Pe,estimateMatrixCondition:Me,jacobi:Ne,jacobiN:Te,solveHomogeneousLeastSquares:Le,solveLeastSquares:ke,hex2float:Fe,rgb2hsv:Ve,hsv2rgb:Ue,lab2xyz:Be,xyz2lab:Ge,xyz2rgb:We,rgb2xyz:ze,rgb2lab:He,lab2rgb:je,uninitializeBounds:Ze,areBoundsInitialized:Ke,computeBoundsFromPoints:$e,clampValue:qe,clampVector:Xe,clampAndNormalizeValue:Ye,getScalarTypeFittingRange:Je,getAdjustedScalarRange:Qe,extentIsWithinOtherExtent:et,boundsIsWithinOtherBounds:tt,pointIsWithinBounds:nt,solve3PointCircle:rt,inf:it,negInf:ot,isInf:at,isNan:lt,isNaN:lt,isFinite:st,createUninitializedBounds:ut,getMajorAxisIndex:dt,getSparseOrthogonalMatrix:pt,floatToHex2:ht,floatRGB2HexCode:ft,float2CssRGBA:gt}},45802:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(72076),i=n(59474),o=n(40286);const a=e=>e,s=1e-6;class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.matrix=r._E.identity(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?r.DV.toRadian:a}rotateFromDirections(e,t){const n=new Float64Array(3),i=new Float64Array(3),o=new Float64Array(16);r.R3.set(n,e[0],e[1],e[2]),r.R3.set(i,t[0],t[1],t[2]),r.R3.normalize(n,n),r.R3.normalize(i,i);const a=r.R3.dot(n,i);return a>=1||(r.R3.cross(this.tmp,n,i),r.R3.length(this.tmp)<s&&(r.R3.cross(this.tmp,[1,0,0],e),r.R3.length(this.tmp)<s&&r.R3.cross(this.tmp,[0,1,0],e)),r._E.fromRotation(o,Math.acos(a),this.tmp),r._E.multiply(this.matrix,this.matrix,o)),this}rotate(e,t){return r.R3.set(this.tmp,...t),r.R3.normalize(this.tmp,this.tmp),r._E.rotate(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return r._E.rotateX(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return r._E.rotateY(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return r._E.rotateZ(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,t,n){return r.R3.set(this.tmp,e,t,n),r._E.translate(this.matrix,this.matrix,this.tmp),this}scale(e,t,n){return r.R3.set(this.tmp,e,t,n),r._E.scale(this.matrix,this.matrix,this.tmp),this}multiply(e){return r._E.multiply(this.matrix,this.matrix,e),this}multiply3x3(e){return r._E.multiply(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return r._E.invert(this.matrix,this.matrix),this}identity(){return r._E.identity(this.matrix),this}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if((0,i.a)(o.Wd,this.matrix))return this;const a=-1===n?e.length:t+3*n;for(let n=t;n<a;n+=3)r.R3.set(this.tmp,e[n],e[n+1],e[n+2]),r.R3.transformMat4(this.tmp,this.tmp,this.matrix),e[n]=this.tmp[0],e[n+1]=this.tmp[1],e[n+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&16===e.length&&r._E.copy(this.matrix,e),this}}var c={buildFromDegree:function(){return new l(!0)},buildFromRadian:function(){return new l(!1)}}},23834:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(68470),i=n(54131),o=n(89262);const{vtkErrorMacro:a}=r.m,s=[1,-1,1,-1,1,-1];const l={empty:!0,numberOfComponents:3,dataType:o.Tu.FLOAT,bounds:[1,-1,1,-1,1,-1]};function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,l,n),i.default.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkPoints"),e.getNumberOfPoints=e.getNumberOfTuples,e.setNumberOfPoints=function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;e.getNumberOfPoints()!==n&&(t.size=n*i,t.values=r.m.newTypedArray(t.dataType,t.size),e.setNumberOfComponents(i),e.modified())},e.setPoint=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.setTuple(t,r)},e.getPoint=e.getTuple,e.findPoint=e.findTuple,e.insertNextPoint=(t,n,r)=>e.insertNextTuple([t,n,r]),e.getBounds=()=>{if(3===e.getNumberOfComponents()){const n=e.getRange(0);t.bounds[0]=n[0],t.bounds[1]=n[1];const r=e.getRange(1);t.bounds[2]=r[0],t.bounds[3]=r[1];const i=e.getRange(2);return t.bounds[4]=i[0],t.bounds[5]=i[1],t.bounds}if(2!==e.getNumberOfComponents())return a(`getBounds called on an array with components of\n        ${e.getNumberOfComponents()}`),s;const n=e.getRange(0);t.bounds[0]=n[0],t.bounds[1]=n[1];const r=e.getRange(1);return t.bounds[2]=r[0],t.bounds[3]=r[1],t.bounds[4]=0,t.bounds[5]=0,t.bounds},e.computeBounds=e.getBounds,e.setNumberOfComponents(t.numberOfComponents<2?3:t.numberOfComponents)}(e,t)}var u={newInstance:r.m.newInstance(c,"vtkPoints"),extend:c}},4666:(e,t,n)=>{"use strict";n.d(t,{default:()=>g});var r=n(68470),i=n(54131),o=n(77415),a=n(85687);const{ScalarMappingTarget:s,VectorMode:l}=o.default,{VtkDataTypes:c}=i.default,{ColorMode:u}=a.default,{vtkErrorMacro:d}=r.m;function p(e){return e}function h(e){return Math.floor(255*e+.5)}const f={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:l.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function m(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,f,n),r.m.obj(e,t),t.mappingRange=[0,255],t.annotationArray=[],t.annotatedValueMap=[],r.m.setGet(e,t,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),r.m.setArray(e,t,["mappingRange"],2),r.m.getArray(e,t,["mappingRange"]),function(e,t){t.classHierarchy.push("vtkScalarsToColors"),e.setVectorModeToMagnitude=()=>e.setVectorMode(l.MAGNITUDE),e.setVectorModeToComponent=()=>e.setVectorMode(l.COMPONENT),e.setVectorModeToRGBColors=()=>e.setVectorMode(l.RGBCOLORS),e.build=()=>{},e.isOpaque=()=>!0,e.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r))if(n&&r&&n.length!==r.length)d("Values and annotations do not have the same number of tuples so ignoring");else{if(t.annotationArray=[],r&&n){const e=r.length;for(let i=0;i<e;i++)t.annotationArray.push({value:n[i],annotation:String(r[i])})}e.updateAnnotatedValueMap(),e.modified()}},e.setAnnotation=(n,r)=>{let i=e.checkForAnnotatedValue(n),o=!1;return i>=0?t.annotationArray[i].annotation!==r&&(t.annotationArray[i].annotation=r,o=!0):(t.annotationArray.push({value:n,annotation:r}),i=t.annotationArray.length-1,o=!0),o&&(e.updateAnnotatedValueMap(),e.modified()),i},e.getNumberOfAnnotatedValues=()=>t.annotationArray.length,e.getAnnotatedValue=e=>e<0||e>=t.annotationArray.length?null:t.annotationArray[e].value,e.getAnnotation=e=>void 0===t.annotationArray[e]?null:t.annotationArray[e].annotation,e.getAnnotatedValueIndex=n=>t.annotationArray.length?e.checkForAnnotatedValue(n):-1,e.removeAnnotation=n=>{const r=e.checkForAnnotatedValue(n),i=r>=0;return i&&(t.annotationArray.splice(r,1),e.updateAnnotatedValueMap(),e.modified()),i},e.resetAnnotations=()=>{t.annotationArray=[],t.annotatedValueMap=[],e.modified()},e.getAnnotationColor=(n,r)=>{if(t.indexedLookup){const t=e.getAnnotatedValueIndex(n);e.getIndexedColor(t,r)}else e.getColor(parseFloat(n),r),r[3]=1},e.checkForAnnotatedValue=t=>e.getAnnotatedValueIndexInternal(t),e.getAnnotatedValueIndexInternal=e=>{if(void 0!==t.annotatedValueMap[e]){const n=t.annotationArray.length;return t.annotatedValueMap[e]%n}return-1},e.getIndexedColor=(e,t)=>{t[0]=0,t[1]=0,t[2]=0,t[3]=0},e.updateAnnotatedValueMap=()=>{t.annotatedValueMap=[];const e=t.annotationArray.length;for(let n=0;n<e;n++)t.annotatedValueMap[t.annotationArray[n].value]=n},e.mapScalars=(t,n,o)=>{const a=t.getNumberOfComponents();let l=null;if(n===u.DEFAULT&&(t.getDataType()===c.UNSIGNED_CHAR||t.getDataType()===c.UNSIGNED_CHAR_CLAMPED)||n===u.DIRECT_SCALARS&&t)l=e.convertToRGBA(t,a,t.getNumberOfTuples());else{const n={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:c.UNSIGNED_CHAR},u=r.m.newTypedArray(n.dataType,4*t.getNumberOfTuples());n.values=u,n.size=u.length,l=i.default.newInstance(n);let d=o;d<0&&a>1?e.mapVectorsThroughTable(t,l,s.RGBA,-1,-1):(d<0&&(d=0),d>=a&&(d=a-1),e.mapScalarsThroughTable(t,l,s.RGBA,d))}return l},e.mapVectorsToMagnitude=(e,t,n)=>{const r=e.getNumberOfTuples(),i=e.getNumberOfComponents(),o=t.getData(),a=e.getData();for(let e=0;e<r;e++){let t=0;for(let r=0;r<n;r++)t+=a[e*i+r]*a[e*i+r];o[e]=Math.sqrt(t)}},e.mapVectorsThroughTable=(t,n,r,o,a)=>{let s=e.getVectorMode(),c=a,u=o;const d=t.getNumberOfComponents();s===l.COMPONENT?(-1===u&&(u=e.getVectorComponent()),u<0&&(u=0),u>=d&&(u=d-1)):(-1===c&&(c=e.getVectorSize()),c<=0?(u=0,c=d):(u<0&&(u=0),u>=d&&(u=d-1),u+c>d&&(c=d-u)),s!==l.MAGNITUDE||1!==d&&1!==c||(s=l.COMPONENT));let p=0;switch(u>0&&(p=u),s){case l.COMPONENT:e.mapScalarsThroughTable(t,n,r,p);break;case l.RGBCOLORS:break;case l.MAGNITUDE:default:{const o=i.default.newInstance({numberOfComponents:1,values:new Float32Array(t.getNumberOfTuples())});e.mapVectorsToMagnitude(t,o,c),e.mapScalarsThroughTable(o,n,r,0);break}}},e.luminanceToRGBA=(e,t,n,r)=>{const i=r(n),o=t.getData(),a=e.getData(),s=o.length;let l=0;for(let e=0;e<s;e+=1){const t=r(o[e]);a[4*l]=t,a[4*l+1]=t,a[4*l+2]=t,a[4*l+3]=i,l++}},e.luminanceAlphaToRGBA=(e,t,n,r)=>{const i=t.getData(),o=e.getData(),a=i.length;let s=0;for(let e=0;e<a;e+=2){const t=r(i[e]);o[s]=t,o[s+1]=t,o[s+2]=t,o[s+3]=r(i[e+1])*n,s+=4}},e.rGBToRGBA=(e,t,n,r)=>{const i=h(n),o=t.getData(),a=e.getData(),s=o.length;let l=0;for(let e=0;e<s;e+=3)a[4*l]=r(o[e]),a[4*l+1]=r(o[e+1]),a[4*l+2]=r(o[e+2]),a[4*l+3]=i,l++},e.rGBAToRGBA=(e,t,n,r)=>{const i=t.getData(),o=e.getData(),a=i.length;let s=0;for(let e=0;e<a;e+=4)o[4*s]=r(i[e]),o[4*s+1]=r(i[e+1]),o[4*s+2]=r(i[e+2]),o[4*s+3]=r(i[e+3])*n,s++},e.convertToRGBA=(n,r,o)=>{let{alpha:a}=t;if(4===r&&a>=1&&n.getDataType()===c.UNSIGNED_CHAR)return n;const s=i.default.newInstance({numberOfComponents:4,empty:!0,size:4*o,dataType:c.UNSIGNED_CHAR});if(o<=0)return s;a=a>0?a:0,a=a<1?a:1;let l=p;switch(n.getDataType()!==c.FLOAT&&n.getDataType()!==c.DOUBLE||(l=h),r){case 1:e.luminanceToRGBA(s,n,a,l);break;case 2:e.luminanceAlphaToRGBA(s,n,l);break;case 3:e.rGBToRGBA(s,n,a,l);break;case 4:e.rGBAToRGBA(s,n,a,l);break;default:return d("Cannot convert colors"),null}return s},e.usingLogScale=()=>!1,e.getNumberOfAvailableColors=()=>16777216,e.setRange=(t,n)=>e.setMappingRange(t,n),e.getRange=()=>e.getMappingRange(),e.areScalarsOpaque=(n,r,i)=>{if(!n)return e.isOpaque();const o=n.getNumberOfComponents();return(r!==u.DEFAULT||n.getDataType()!==c.UNSIGNED_CHAR)&&r!==u.DIRECT_SCALARS||(3===o||1===o?t.alpha>=1:255===n.getRange(o-1)[0])}}(e,t)}var g={newInstance:r.m.newInstance(m,"vtkScalarsToColors"),extend:m,...o.default}},77415:(e,t,n)=>{"use strict";n.d(t,{O:()=>r,default:()=>i});const r={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var i={VectorMode:{MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},ScalarMappingTarget:r}},58514:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>l});var r=n(68470),i=n(59474),o=n(23834);const a={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),r.m.obj(e,t),t.points||(t.points=o.ZP.newInstance()),r.m.get(e,t,["points","pointsIds"]),function(e,t){t.classHierarchy.push("vtkCell"),e.initialize=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n){t.pointsIds=n;let i=t.points.getData();i.length!==3*t.pointsIds.length&&(i=r.m.newTypedArray(e.getDataType(),3*t.pointsIds.length));const o=e.getData();t.pointsIds.forEach((e,t)=>{let n=3*e,r=3*t;i[r]=o[n],i[++r]=o[++n],i[++r]=o[++n]}),t.points.setData(i)}else{t.points=e,t.pointsIds=new Array(e.getNumberOfPoints());for(let n=e.getNumberOfPoints()-1;n>=0;--n)t.pointsIds[n]=n}},e.getBounds=()=>{const e=t.points.getNumberOfPoints(),n=[];if(e){t.points.getPoint(0,n),t.bounds[0]=n[0],t.bounds[1]=n[0],t.bounds[2]=n[1],t.bounds[3]=n[1],t.bounds[4]=n[2],t.bounds[5]=n[2];for(let r=1;r<e;r++)t.points.getPoint(r,n),t.bounds[0]=n[0]<t.bounds[0]?n[0]:t.bounds[0],t.bounds[1]=n[0]>t.bounds[1]?n[0]:t.bounds[1],t.bounds[2]=n[1]<t.bounds[2]?n[1]:t.bounds[2],t.bounds[3]=n[1]>t.bounds[3]?n[1]:t.bounds[3],t.bounds[4]=n[2]<t.bounds[4]?n[2]:t.bounds[4],t.bounds[5]=n[2]>t.bounds[5]?n[2]:t.bounds[5]}else(0,i.u)(t.bounds);return t.bounds},e.getLength2=()=>{e.getBounds();let n=0,r=0;for(let e=0;e<3;e++)r=t.bounds[2*e+1]-t.bounds[2*e],n+=r*r;return n},e.getParametricDistance=e=>{let t,n=0;for(let r=0;r<3;r++)t=e[r]<0?-e[r]:e[r]>1?e[r]-1:0,t>n&&(n=t);return n},e.getNumberOfPoints=()=>t.points.getNumberOfPoints(),e.deepCopy=e=>{e.initialize(t.points,t.pointsIds)},e.getCellDimension=()=>{},e.intersectWithLine=(e,t,n,r,i,o,a)=>{},e.evaluatePosition=(e,t,n,i,o,a)=>{r.m.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}(e,t)}var l={newInstance:r.m.newInstance(s,"vtkCell"),extend:s}},21477:(e,t,n)=>{"use strict";n.d(t,{XJ:()=>r,default:()=>i});const r={DEFAULT:0,SINGLE:1,DOUBLE:2};var i={AttributeCopyOperations:{COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},AttributeLimitTypes:{MAX:0,EXACT:1,NOLIMIT:2},AttributeTypes:{SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},CellGhostTypes:{DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},DesiredOutputPrecision:r,PointGhostTypes:{DUPLICATEPOINT:1,HIDDENPOINT:2},ghostArrayName:"vtkGhostType"}},29699:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.oriented=e,this.edgeMap=new Map}initialize(){this.edgeMap.clear()}computeEdgeKey(e,t){return this.oriented||e<t?e*t*.5*(e*t+1)+t:t*e*.5*(t*e+1)+e}insertUniqueEdge(e,t,n){const r=this.computeEdgeKey(e,t);let i=this.edgeMap.get(r);return i||(i={key:r,edgeId:this.edgeMap.size,value:n},this.edgeMap.set(r,i)),i}insertEdge(e,t,n){const r=this.computeEdgeKey(e,t),i={key:r,edgeId:this.edgeMap.size,value:n};return this.edgeMap.set(r,i),i}isInsertedEdge(e,t){const n=this.computeEdgeKey(e,t);return this.edgeMap.get(n)}static getEdgePointIds(e){const t=.5*(-1+Math.sqrt(8*e.key+1)),n=e.key-.5*(t+1)*t;return[n,t-n]}}var i={newInstance:function(){return new r((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oriented)}}},96455:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>f});var r=n(68470);var i={IntersectionState:{NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2}},o=n(58514),a=n(59474),s=n(72076);const{IntersectionState:l}=i;function c(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},o=[];let s;o[0]=n[0]-t[0],o[1]=n[1]-t[1],o[2]=n[2]-t[2];const l=o[0]*(e[0]-t[0])+o[1]*(e[1]-t[1])+o[2]*(e[2]-t[2]),c=(0,a.d)(o,o);let u=1e-5*l;return 0!==c&&(i.t=l/c),u<0&&(u=-u),-u<c&&c<u||c<=0||i.t<0?s=t:i.t>1?s=n:(s=o,o[0]=t[0]+i.t*o[0],o[1]=t[1]+i.t*o[1],o[2]=t[2]+i.t*o[2]),r&&(r[0]=s[0],r[1]=s[1],r[2]=s[2]),i.distance=(0,a.e)(s,e),i}function u(e,t,n,r,i,o){const s=[],u=[],d=[];i[0]=0,o[0]=0,(0,a.s)(t,e,s),(0,a.s)(r,n,u),(0,a.s)(n,e,d);const p=[(0,a.d)(s,s),-(0,a.d)(s,u),-(0,a.d)(s,u),(0,a.d)(u,u)],h=[];if(h[0]=(0,a.d)(s,d),h[1]=-(0,a.d)(u,d),0===(0,a.g)(p,h,2)){let a=Number.MAX_VALUE;const s=[e,t,n,r],u=[n,n,e,e],d=[r,r,t,t];let p;o[0],o[0],i[0],i[0],i[0],i[0],o[0],o[0];for(let e=0;e<4;e++)p=c(s[e],u[e],d[e]),p.distance<a&&(a=p.distance);return l.ON_LINE}return i[0]=h[0],o[0]=h[1],i[0]>=0&&i[0]<=1&&o[0]>=0&&o[0]<=1?l.YES_INTERSECTION:l.NO_INTERSECTION}const d={distanceToLine:c,intersection:u};const p={orientations:null};function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,p,n),o.ZP.extend(e,t,n),r.m.setGet(e,t,["orientations"]),function(e,t){t.classHierarchy.push("vtkLine"),e.getCellDimension=()=>1,e.intersectWithLine=(e,n,r,i,o)=>{const s={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;const d=[],p=[],h=[];t.points.getPoint(0,p),t.points.getPoint(1,h);const f=[],m=[],g=u(e,n,p,h,f,m);var v;if(s.t=f[0],s.betweenPoints=(v=s.t)>=0&&v<=1,o[0]=m[0],g===l.YES_INTERSECTION){for(let t=0;t<3;t++)i[t]=p[t]+o[0]*(h[t]-p[t]),d[t]=e[t]+s.t*(n[t]-e[t]);if((0,a.e)(i,d)<=r*r)return s.intersect=1,s}else{let t;if(s.t<0)return t=c(e,p,h,i),t.distance<=r*r?(s.t=0,s.intersect=1,s.betweenPoints=!0,s):s;if(s.t>1)return t=c(n,p,h,i),t.distance<=r*r?(s.t=1,s.intersect=1,s.betweenPoints=!0,s):s;if(o[0]<0)return o[0]=0,t=c(p,e,n,i),s.t=t.t,t.distance<=r*r?(s.intersect=1,s):s;if(o[0]>1)return o[0]=1,t=c(h,e,n,i),s.t=t.t,t.distance<=r*r?(s.intersect=1,s):s}return s},e.evaluateLocation=(e,n,r)=>{const i=[],o=[];t.points.getPoint(0,i),t.points.getPoint(1,o);for(let t=0;t<3;t++)n[t]=i[t]+e[0]*(o[t]-i[t]);r[0]=1-e[0],r[1]=e[0]},e.evaluateOrientation=(e,n,r)=>!!t.orientations&&(s.gf.slerp(n,t.orientations[0],t.orientations[1],e[0]),r[0]=1-e[0],r[1]=e[0],!0)}(e,t)}var f={newInstance:r.m.newInstance(h,"vtkLine"),extend:h,...d,...i}},46576:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>D});var r=n(68470),i=n(99824),o=n(17197),a=n(58514);const s={array:null,maxId:0,extend:0};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),r.m.obj(e,t),function(e,t){t.classHierarchy.push("vtkCellLinks"),e.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),i=n.getNumberOfCells(),o=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let t=0;t<i;++t){const{cellPointIds:r}=n.getCellPoints(t);r.forEach(t=>{e.incrementLinkCount(t)})}e.allocateLinks(r),t.maxId=r-1;for(let t=0;t<i;++t){const{cellPointIds:r}=n.getCellPoints(t);r.forEach(n=>{e.insertCellReference(n,o[n]++,t)})}}else{for(let t=0;t<i;t++)a.ZP.newInstance().getPointsIds().forEach(t=>{e.incrementLinkCount(t)});e.allocateLinks(r),t.maxId=r-1;for(let t=0;t<i;++t)a.ZP.newInstance().getPointsIds().forEach(n=>{e.insertCellReference(n,o[n]++,t)})}},e.allocate=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;t.array=Array(e).fill().map(()=>({ncells:0,cells:null})),t.extend=n,t.maxId=-1},e.initialize=()=>{t.array=null},e.getLink=e=>t.array[e],e.getNcells=e=>t.array[e].ncells,e.getCells=e=>t.array[e].cells,e.insertNextPoint=e=>{t.array.push({ncells:e,cells:Array(e)}),++t.maxId},e.insertNextCellReference=(e,n)=>{t.array[e].cells[t.array[e].ncells++]=n},e.deletePoint=e=>{t.array[e].ncells=0,t.array[e].cells=null},e.removeCellReference=(e,n)=>{t.array[n].cells=t.array[n].cells.filter(t=>t!==e),t.array[n].ncells=t.array[n].cells.length},e.addCellReference=(e,n)=>{t.array[n].cells[t.array[n].ncells++]=e},e.resizeCellList=(e,n)=>{t.array[e].cells.length=n},e.squeeze=()=>{!function(e,t){let n=t;for(t>=e.array.length&&(n+=e.array.length);n>e.array.length;)e.array.push({ncells:0,cells:null});e.array.length=n}(t,t.maxId+1)},e.reset=()=>{t.maxId=-1},e.deepCopy=e=>{t.array=[...e.array],t.extend=e.extend,t.maxId=e.maxId},e.incrementLinkCount=e=>{++t.array[e].ncells},e.allocateLinks=e=>{for(let n=0;n<e;++n)t.array[n].cells=new Array(t.array[n].ncells)},e.insertCellReference=(e,n,r)=>{t.array[e].cells[n]=r}}(e,t)}var c={newInstance:r.m.newInstance(l,"vtkCellLinks"),extend:l};const u={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},d=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];const p={getClassNameFromTypeId:function(e){return e<d.length?d[e]:"UnknownClass"},getTypeIdFromClassName:function(e){return d.findIndex(e)},isLinear:function(e){return e<u.VTK_QUADRATIC_EDGE||e===u.VTK_CONVEX_POINT_SET||e===u.VTK_POLYHEDRON},hasSubCells:function(e){return e===u.VTK_TRIANGLE_STRIP||e===u.VTK_POLY_LINE||e===u.VTK_POLY_VERTEX}};const h={size:0,maxId:-1,extend:1e3};function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,h,n),r.m.obj(e,t),r.m.get(e,t,["size","maxId","extend"]),r.m.getArray(e,t,["typeArray","locationArray"]),function(e,t){t.classHierarchy.push("vtkCellTypes"),e.allocate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;t.size=e>0?e:1,t.extend=n>0?n:1,t.maxId=-1,t.typeArray=new Uint8Array(e),t.locationArray=new Uint32Array(e)},e.insertCell=(e,n,r)=>{t.typeArray[e]=n,t.locationArray[e]=r,e>t.maxId&&(t.maxId=e)},e.insertNextCell=(n,r)=>(e.insertCell(++t.maxId,n,r),t.maxId),e.setCellTypes=(e,n,r)=>{t.size=e,t.typeArray=n,t.locationArray=r,t.maxId=e-1},e.getCellLocation=e=>t.locationArray[e],e.deleteCell=e=>{t.typeArray[e]=u.VTK_EMPTY_CELL},e.getNumberOfTypes=()=>t.maxId+1,e.isType=t=>{const n=e.getNumberOfTypes();for(let r=0;r<n;++r)if(t===e.getCellType(r))return!0;return!1},e.insertNextType=t=>e.insertNextCell(t,-1),e.getCellType=e=>t.typeArray[e],e.reset=()=>{t.maxId=-1},e.deepCopy=n=>{e.allocate(n.getSize(),n.getExtend()),t.typeArray.set(n.getTypeArray()),t.locationArray.set(n.getLocationArray()),t.maxId=n.getMaxId()}}(e,t)}var m={newInstance:r.m.newInstance(f,"vtkCellTypes"),extend:f,...p},g=n(96455),v=n(14418),y=n(23834);const b={};function C(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,b,n),v.default.extend(e,t,n),r.m.setGet(e,t,["points"]),function(e,t){t.classHierarchy.push("vtkPointSet"),t.points?t.points=(0,i.Z)(t.points):t.points=y.ZP.newInstance(),e.getNumberOfPoints=()=>t.points.getNumberOfPoints(),e.getBounds=()=>t.points.getBounds(),e.computeBounds=()=>{e.getBounds()};const n=e.shallowCopy;e.shallowCopy=function(e){n(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),t.points=y.ZP.newInstance(),t.points.shallowCopy(e.getPoints())}}(e,t)}var w={newInstance:r.m.newInstance(C,"vtkPointSet"),extend:C},E=n(92603);const T=["verts","lines","polys","strips"];const{vtkWarningMacro:x}=r.m,_={[u.VTK_LINE]:g.ZP,[u.VTK_POLY_LINE]:g.ZP,[u.VTK_TRIANGLE]:E.ZP};const S={};function I(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,S,n),w.extend(e,t,n),r.m.get(e,t,["cells","links"]),r.m.setGet(e,t,["verts","lines","polys","strips"]),function(e,t){t.classHierarchy.push("vtkPolyData"),T.forEach(n=>{var r;e[`getNumberOf${r=n,r.replace(/(?:^\w|[A-Z]|\b\w)/g,e=>e.toUpperCase()).replace(/\s+/g,"")}`]=()=>t[n].getNumberOfCells(),t[n]?t[n]=(0,i.Z)(t[n]):t[n]=o.ZP.newInstance()}),e.getNumberOfCells=()=>T.reduce((e,n)=>e+t[n].getNumberOfCells(),0);const n=e.shallowCopy;e.shallowCopy=function(e){n(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),T.forEach(n=>{t[n]=o.ZP.newInstance(),t[n].shallowCopy(e.getReferenceByName(n))})},e.buildCells=()=>{const n=e.getNumberOfVerts(),r=e.getNumberOfLines(),i=e.getNumberOfPolys(),o=e.getNumberOfStrips(),a=n+r+i+o,s=new Uint8Array(a);let l=s;const c=new Uint32Array(a);let d=c;if(n){let e=0;t.verts.getCellSizes().forEach((t,n)=>{d[n]=e,l[n]=t>1?u.VTK_POLY_VERTEX:u.VTK_VERTEX,e+=t+1}),d=d.subarray(n),l=l.subarray(n)}if(r){let e=0;t.lines.getCellSizes().forEach((t,n)=>{d[n]=e,l[n]=t>2?u.VTK_POLY_LINE:u.VTK_LINE,1===t&&x("Building VTK_LINE ",n," with only one point, but VTK_LINE needs at least two points. Check the input."),e+=t+1}),d=d.subarray(r),l=l.subarray(r)}if(i){let e=0;t.polys.getCellSizes().forEach((t,n)=>{switch(d[n]=e,t){case 3:l[n]=u.VTK_TRIANGLE;break;case 4:l[n]=u.VTK_QUAD;break;default:l[n]=u.VTK_POLYGON}t<3&&x("Building VTK_TRIANGLE ",n," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),e+=t+1}),d+=d.subarray(i),l+=l.subarray(i)}if(o){let e=0;l.fill(u.VTK_TRIANGLE_STRIP,0,o),t.strips.getCellSizes().forEach((t,n)=>{d[n]=e,e+=t+1})}t.cells=m.newInstance(),t.cells.setCellTypes(a,s,c)},e.buildLinks=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;void 0===t.cells&&e.buildCells(),t.links=c.newInstance(),n>0?t.links.allocate(n):t.links.allocate(e.getPoints().getNumberOfPoints()),t.links.buildLinks(e)},e.getCellType=e=>t.cells.getCellType(e),e.getCellPoints=n=>{const r=e.getCellType(n);let i=null;switch(r){case u.VTK_VERTEX:case u.VTK_POLY_VERTEX:i=t.verts;break;case u.VTK_LINE:case u.VTK_POLY_LINE:i=t.lines;break;case u.VTK_TRIANGLE:case u.VTK_QUAD:case u.VTK_POLYGON:i=t.polys;break;case u.VTK_TRIANGLE_STRIP:i=t.strips;break;default:return i=null,{type:0,cellPointIds:null}}const o=t.cells.getCellLocation(n);return{cellType:r,cellPointIds:i.getCell(o)}},e.getPointCells=e=>t.links.getCells(e),e.getCellEdgeNeighbors=(e,n,r)=>{const i=t.links.getLink(n),o=t.links.getLink(r);return i.cells.filter(t=>t!==e&&-1!==o.cells.indexOf(t))},e.getCell=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=e.getCellPoints(t),i=n||_[r.cellType].newInstance();return i.initialize(e.getPoints(),r.cellPointIds),i}}(e,t)}var D={newInstance:r.m.newInstance(I,"vtkPolyData"),extend:I}},92603:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>h});var r=n(68470),i=n(58514),o=n(59474),a=n(96455),s=n(3969);function l(e,t,n,r){const i=n[0]-t[0],o=n[1]-t[1],a=n[2]-t[2],s=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2];r[0]=o*c-a*l,r[1]=a*s-i*c,r[2]=i*l-o*s}function c(e,t,n,r){l(e,t,n,r);const i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);0!==i&&(r[0]/=i,r[1]/=i,r[2]/=i)}const u={computeNormalDirection:l,computeNormal:c,intersectWithTriangle:function(e,t,n,r,i,a){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e-6,u=!1;const d=[],p=[],h=[],f=[],m=[];c(e,t,n,f),c(r,i,a,m);const g=-(0,o.d)(f,e),v=-(0,o.d)(m,r),y=[(0,o.d)(m,e)+v,(0,o.d)(m,t)+v,(0,o.d)(m,n)+v];if(y[0]*y[1]>l&&y[0]*y[2]>l)return{intersect:!1,coplanar:u,pt1:d,pt2:p,surfaceId:h};const b=[(0,o.d)(f,r)+g,(0,o.d)(f,i)+g,(0,o.d)(f,a)+g];if(b[0]*b[1]>l&&b[0]*b[2]>l)return{intersect:!1,coplanar:u,pt1:d,pt2:p,surfaceId:h};if(Math.abs(f[0]-m[0])<1e-9&&Math.abs(f[1]-m[1])<1e-9&&Math.abs(f[2]-m[2])<1e-9&&Math.abs(g-v)<1e-9)return u=!0,{intersect:!1,coplanar:u,pt1:d,pt2:p,surfaceId:h};const C=[e,t,n],w=[r,i,a],E=(0,o.d)(f,m),T=(g-v*E)/(E*E-1),x=(v-g*E)/(E*E-1),_=[T*f[0]+x*m[0],T*f[1]+x*m[1],T*f[2]+x*m[2]],S=(0,o.j)(f,m,[]);(0,o.l)(S);let I=0,D=0;const A=[],P=[];let O,R,M=50,N=50;for(let t=0;t<3;t++){const n=t,i=(t+1)%3,a=s.ZP.intersectWithLine(C[n],C[i],r,m);a.intersection&&a.t>0-l&&a.t<1+l&&(a.t<1+l&&a.t>1-l&&(M=I),A[I++]=(0,o.d)(a.x,S)-(0,o.d)(_,S));const c=s.ZP.intersectWithLine(w[n],w[i],e,f);c.intersection&&c.t>0-l&&c.t<1+l&&(c.t<1+l&&c.t>1-l&&(N=D),P[D++]=(0,o.d)(c.x,S)-(0,o.d)(_,S))}if(I>2){I--;const e=A[2];A[2]=A[M],A[M]=e}if(D>2){D--;const e=P[2];P[2]=P[N],P[N]=e}if(2!==I||2!==D)return{intersect:!1,coplanar:u,pt1:d,pt2:p,surfaceId:h};if(Number.isNaN(A[0])||Number.isNaN(A[1])||Number.isNaN(P[0])||Number.isNaN(P[1]))return{intersect:!1,coplanar:u,pt1:d,pt2:p,surfaceId:h};if(A[0]>A[1]){const e=A[1];A[1]=A[0],A[0]=e}if(P[0]>P[1]){const e=P[1];P[1]=P[0],P[0]=e}return A[1]<P[0]||P[1]<A[0]?{intersect:!1,coplanar:u,pt1:d,pt2:p,surfaceId:h}:(A[0]<P[0]?A[1]<P[1]?(h[0]=2,h[1]=1,O=P[0],R=A[1]):(h[0]=2,h[1]=2,O=P[0],R=P[1]):A[1]<P[1]?(h[0]=1,h[1]=1,O=A[0],R=A[1]):(h[0]=1,h[1]=2,O=A[0],R=P[1]),(0,o.m)(_,S,O,d),(0,o.m)(_,S,R,p),{intersect:!0,coplanar:u,pt1:d,pt2:p,surfaceId:h})}};const d={};function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,d,n),i.ZP.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkTriangle"),e.getCellDimension=()=>2,e.intersectWithLine=(n,r,i,l,u)=>{const d={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};u[2]=0;const p=[],h=i*i,f=[],m=[],g=[];t.points.getPoint(0,f),t.points.getPoint(1,m),t.points.getPoint(2,g);const v=[],y=[];if(c(f,m,g,v),0!==v[0]||0!==v[1]||0!==v[2]){const t=s.ZP.intersectWithLine(n,r,f,v);if(d.betweenPoints=t.betweenPoints,d.t=t.t,l[0]=t.x[0],l[1]=t.x[1],l[2]=t.x[2],!t.intersection)return u[0]=0,u[1]=0,d.intersect=0,d;const i=e.evaluatePosition(l,p,u,y);if(i.evaluation>=0)return i.dist2<=h?(d.intersect=1,d):(d.intersect=i.evaluation,d)}const b=(0,o.e)(f,m),C=(0,o.e)(m,g),w=(0,o.e)(g,f);t.line||(t.line=a.ZP.newInstance()),b>C&&b>w?(t.line.getPoints().setPoint(0,f),t.line.getPoints().setPoint(1,m)):C>w&&C>b?(t.line.getPoints().setPoint(0,m),t.line.getPoints().setPoint(1,g)):(t.line.getPoints().setPoint(0,g),t.line.getPoints().setPoint(1,f));const E=t.line.intersectWithLine(n,r,i,l,u);if(d.betweenPoints=E.betweenPoints,d.t=E.t,E.intersect){const e=[],t=[],n=[];for(let r=0;r<3;r++)e[r]=f[r]-g[r],t[r]=m[r]-g[r],n[r]=l[r]-g[r];return u[0]=(0,o.d)(n,e)/w,u[1]=(0,o.d)(n,t)/C,d.intersect=1,d}return u[0]=0,u[1]=0,d.intersect=0,d},e.evaluatePosition=(e,n,r,i)=>{const c={subId:0,dist2:0,evaluation:-1};let u,d;const p=[],h=[],f=[],m=[];let g;const v=[],y=[],b=[];let C=0,w=0;const E=[];let T,x,_,S=[];const I=[],D=[],A=[];c.subId=0,r[2]=0,t.points.getPoint(1,p),t.points.getPoint(2,h),t.points.getPoint(0,f),l(p,h,f,m),s.ZP.generalizedProjectPoint(e,p,m,A);let P=0;for(u=0;u<3;u++)g=m[u]<0?-m[u]:m[u],g>P&&(P=g,w=u);for(d=0,u=0;u<3;u++)u!==w&&(E[d++]=u);for(u=0;u<2;u++)v[u]=A[E[u]]-f[E[u]],y[u]=p[E[u]]-f[E[u]],b[u]=h[E[u]]-f[E[u]];if(C=(0,o.o)(y,b),0===C)return r[0]=0,r[1]=0,c.evaluation=-1,c;if(r[0]=(0,o.o)(v,b)/C,r[1]=(0,o.o)(y,v)/C,i[0]=1-(r[0]+r[1]),i[1]=r[0],i[2]=r[1],i[0]>=0&&i[0]<=1&&i[1]>=0&&i[1]<=1&&i[2]>=0&&i[2]<=1)n&&(c.dist2=(0,o.e)(A,e),n[0]=A[0],n[1]=A[1],n[2]=A[2]),c.evaluation=1;else{let t;if(n)if(i[1]<0&&i[2]<0)for(T=(0,o.e)(e,f),x=a.ZP.distanceToLine(e,p,f,t,I),_=a.ZP.distanceToLine(e,f,h,t,D),T<x?(c.dist2=T,S=f):(c.dist2=x,S=I),_<c.dist2&&(c.dist2=_,S=D),u=0;u<3;u++)n[u]=S[u];else if(i[2]<0&&i[0]<0)for(T=(0,o.e)(e,p),x=a.ZP.distanceToLine(e,p,f,t,I),_=a.ZP.distanceToLine(e,p,h,t,D),T<x?(c.dist2=T,S=p):(c.dist2=x,S=I),_<c.dist2&&(c.dist2=_,S=D),u=0;u<3;u++)n[u]=S[u];else if(i[1]<0&&i[0]<0)for(T=(0,o.e)(e,h),x=a.ZP.distanceToLine(e,h,f,t,I),_=a.ZP.distanceToLine(e,p,h,t,D),T<x?(c.dist2=T,S=h):(c.dist2=x,S=I),_<c.dist2&&(c.dist2=_,S=D),u=0;u<3;u++)n[u]=S[u];else if(i[0]<0){const t=a.ZP.distanceToLine(e,p,h,n);c.dist2=t.distance}else if(i[1]<0){const t=a.ZP.distanceToLine(e,h,f,n);c.dist2=t.distance}else if(i[2]<0){const t=a.ZP.distanceToLine(e,p,f,n);c.dist2=t.distance}c.evaluation=0}return c},e.evaluateLocation=(e,n,r)=>{const i=[],o=[],a=[];t.points.getPoint(0,i),t.points.getPoint(1,o),t.points.getPoint(2,a);const s=1-e[0]-e[1];for(let t=0;t<3;t++)n[t]=i[t]*s+o[t]*e[0]+a[t]*e[1];r[0]=s,r[1]=e[0],r[2]=e[1]},e.getParametricDistance=e=>{let t,n=0;const r=[];r[0]=e[0],r[1]=e[1],r[2]=1-e[0]-e[1];for(let e=0;e<3;e++)t=r[e]<0?-r[e]:r[e]>1?r[e]-1:0,t>n&&(n=t);return n}}(e,t)}var h={newInstance:r.m.newInstance(p,"vtkTriangle"),extend:p,...u}},2755:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var r=n(68470),i=n(46576);const{vtkErrorMacro:o}=r.c;function a(e,t){t.classHierarchy.push("vtkCutter");const n={...e};function a(e,n){const i=e.getPoints(),o=i.getData(),a=i.getNumberOfPoints(),s=[],l=[],c=[];(!t.cutScalars||t.cutScalars.length<a)&&(t.cutScalars=new Float32Array(a));let u=0,d=0;for(;u<o.length;)t.cutScalars[d++]=t.cutFunction.evaluateFunction(o[u++],o[u++],o[u++]);const p=[],h=new Array(3),f=new Array(3),m=[];for(const n=function(e){const t=e.getPolys().getData(),n=e.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<t.length){r.cellSize=t[r.polyIdx];const e=r.polyIdx+1,n=e+r.cellSize;r.polyIdx=n;let i=0;for(let o=e;o<n;++o)r.cell[i++]=t[o]}else if(r.stripIdx<n.length){r.cellSize=3,0===r.remainingStripLength&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const e=r.stripIdx-2,t=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let i=0;for(let o=e;o<t;++o)r.cell[i++]=n[o]}else{if(r.done)throw new Error("Iterator is done");r.done=!0}}};return r.next(),r}(e);!n.done;n.next()){if(n.cellSize<=2)continue;for(let e=0;e<n.cellSize;)m[e]=t.cutScalars[n.cell[e++]];const e=m[0]>0;let r=!0;for(let t=1;t<n.cell.length;t++){if(m[t]>0!==e){r=!1;break}}if(r)continue;const i=[];for(let e=0;e<n.cellSize;e++){const r=e+1===n.cellSize?0:e+1,a=m[e]>0;if(m[r]>0===a)continue;let s=e,l=r,c=m[l]-m[s];c<=0&&(s=r,l=e,c*=-1);let u=0;0!==c&&(u=(t.cutValue-m[s])/c);const d=n.cell[s],p=n.cell[l];h[0]=o[3*d],h[1]=o[3*d+1],h[2]=o[3*d+2],f[0]=o[3*p],f[1]=o[3*p+1],f[2]=o[3*p+2];const g=[h[0]+u*(f[0]-h[0]),h[1]+u*(f[1]-h[1]),h[2]+u*(f[2]-h[2])];i.push({pointEdge1:d,pointEdge2:p,intersectedPoint:g,newPointID:-1})}for(let e=0;e<i.length;e++){const t=i[e];let n=!1;for(let r=0;r<p.length;r++){const o=p[r],a=t.pointEdge1===o.pointEdge1&&t.pointEdge2===o.pointEdge2,s=t.intersectedPoint[0]===o.intersectedPoint[0]&&t.intersectedPoint[1]===o.intersectedPoint[1]&&t.intersectedPoint[2]===o.intersectedPoint[2];if(a||s){n=!0,i[e].newPointID=p[r].newPointID;break}}n||(s.push(t.intersectedPoint[0]),s.push(t.intersectedPoint[1]),s.push(t.intersectedPoint[2]),i[e].newPointID=s.length/3-1,p.push(i[e]))}const a=i.length;2===a?l.push(a,i[0].newPointID,i[1].newPointID):a>2&&(c.push(a),i.forEach(e=>{c.push(e.newPointID)}))}n.getPoints().setData((0,r.b)(i.getDataType(),s),3),0!==l.length&&n.getLines().setData(Uint16Array.from(l)),0!==c.length&&n.getPolys().setData(Uint16Array.from(c))}e.getMTime=()=>{let e=n.getMTime();return t.cutFunction?(e=Math.max(e,t.cutFunction.getMTime()),e):e},e.requestData=(e,n)=>{const r=e[0];if(!r)return void o("Invalid or missing input");if(!t.cutFunction)return void o("Missing cut function");const s=i.ZP.newInstance();a(r,s),n[0]=s}}const s={cutFunction:null,cutScalars:null,cutValue:0};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),(0,r.o)(e,t),(0,r.d)(e,t,1,1),(0,r.e)(e,t,["cutFunction","cutValue"]),a(e,t)}var c={newInstance:(0,r.n)(l,"vtkCutter"),extend:l}},87570:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const r=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],i=[[0,1],[1,3],[2,3],[0,2]];var o={getCase:function(e){return r[e]},getEdge:function(e){return i[e]}}},97442:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>p});var r=n(68470),i=n(17197),o=n(54131),a=n(46576),s=n(45802);const l=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],c=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];const u={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,u,n),r.m.obj(e,t),r.m.setGet(e,t,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),r.m.setGetArray(e,t,["center","rotations"],3),r.m.setGetArray(e,t,["matrix"],16),t._polys=i.ZP.newInstance({values:Uint16Array.from(c)}),t._lineCells=i.ZP.newInstance({values:Uint16Array.from(l)}),r.m.moveToProtected(e,t,["polys","lineCells"]),r.m.algo(e,t,0,1),function(e,t){t.classHierarchy.push("vtkCubeSource"),e.setBounds=function(){let t=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))t=arguments.length<=0?void 0:arguments[0];else for(let e=0;e<arguments.length;e++)t.push(e<0||arguments.length<=e?void 0:arguments[e]);6===t.length&&(e.setXLength(t[1]-t[0]),e.setYLength(t[3]-t[2]),e.setZLength(t[5]-t[4]),e.setCenter([(t[0]+t[1])/2,(t[2]+t[3])/2,(t[4]+t[5])/2]))},e.requestData=function(e,n){if(t.deleted)return;const i=a.ZP.newInstance();n[0]=i;const l=r.m.newTypedArray(t.pointType,72);i.getPoints().setData(l,3);const c=r.m.newTypedArray(t.pointType,72),u=o.default.newInstance({name:"Normals",values:c,numberOfComponents:3});i.getPointData().setNormals(u);let d=2;!0===t.generate3DTextureCoordinates&&(d=3);const p=r.m.newTypedArray(t.pointType,24*d),h=o.default.newInstance({name:"TextureCoordinates",values:p,numberOfComponents:d});i.getPointData().setTCoords(h);const f=[0,0,0],m=[0,0,0],g=[0,0];let v=0;f[0]=-t.xLength/2,m[0]=-1,m[1]=0,m[2]=0;for(let e=0;e<2;e++){f[1]=-t.yLength/2;for(let n=0;n<2;n++){g[1]=f[1]+.5,f[2]=-t.zLength/2;for(let r=0;r<2;r++)g[0]=(f[2]+.5)*(1-2*e),l[3*v]=f[0],l[3*v+1]=f[1],l[3*v+2]=f[2],c[3*v]=m[0],c[3*v+1]=m[1],c[3*v+2]=m[2],2===d?(p[v*d]=g[0],p[v*d+1]=g[1]):(p[v*d]=2*e-1,p[v*d+1]=2*n-1,p[v*d+2]=2*r-1),v++,f[2]+=t.zLength;f[1]+=t.yLength}f[0]+=t.xLength,m[0]+=2}f[1]=-t.yLength/2,m[1]=-1,m[0]=0,m[2]=0;for(let e=0;e<2;e++){f[0]=-t.xLength/2;for(let n=0;n<2;n++){g[0]=(f[0]+.5)*(2*e-1),f[2]=-t.zLength/2;for(let r=0;r<2;r++)g[1]=-1*(f[2]+.5),l[3*v]=f[0],l[3*v+1]=f[1],l[3*v+2]=f[2],c[3*v]=m[0],c[3*v+1]=m[1],c[3*v+2]=m[2],2===d?(p[v*d]=g[0],p[v*d+1]=g[1]):(p[v*d]=2*n-1,p[v*d+1]=2*e-1,p[v*d+2]=2*r-1),v++,f[2]+=t.zLength;f[0]+=t.xLength}f[1]+=t.yLength,m[1]+=2}f[2]=-t.zLength/2,m[2]=-1,m[0]=0,m[1]=0;for(let e=0;e<2;e++){f[1]=-t.yLength/2;for(let n=0;n<2;n++){g[1]=f[1]+.5,f[0]=-t.xLength/2;for(let r=0;r<2;r++)g[0]=(f[0]+.5)*(2*e-1),l[3*v]=f[0],l[3*v+1]=f[1],l[3*v+2]=f[2],c[3*v]=m[0],c[3*v+1]=m[1],c[3*v+2]=m[2],2===d?(p[v*d]=g[0],p[v*d+1]=g[1]):(p[v*d]=2*r-1,p[v*d+1]=2*n-1,p[v*d+2]=2*e-1),v++,f[0]+=t.xLength;f[1]+=t.yLength}f[2]+=t.zLength,m[2]+=2}if(t.rotations&&s.Z.buildFromDegree().rotateX(t.rotations[0]).rotateY(t.rotations[1]).rotateZ(t.rotations[2]).apply(l).apply(c),t.center&&s.Z.buildFromRadian().translate(...t.center).apply(l),t.matrix){s.Z.buildFromRadian().setMatrix(t.matrix).apply(l);const e=[t.matrix[0],t.matrix[1],t.matrix[2],0,t.matrix[4],t.matrix[5],t.matrix[6],0,t.matrix[8],t.matrix[9],t.matrix[10],0,0,0,0,1];s.Z.buildFromRadian().setMatrix(e).apply(c)}t.generateFaces?i.getPolys().deepCopy(t._polys):i.getPolys().initialize(),t.generateLines?(i.getLines().deepCopy(t._lineCells),i.getPointData().setNormals(null)):i.getLines().initialize(),i.modified()}}(e,t)}var p={newInstance:r.m.newInstance(d,"vtkCubeSource"),extend:d}},52739:(e,t,n)=>{"use strict";function r(e){return new TextDecoder("latin1").decode(e)}n.d(t,{Z:()=>i});var i={arrayBufferToString:r,extractBinary:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=r(e),o=t.exec(i);if(!o)return{text:i};const a=o.index+o[0].length,s=i.substring(0,a);let l=null;const c=n?n.exec(i):null;if(c){l={text:s+i.substr(c.index),binaryBuffer:e.slice(a,c.index)}}else l={text:s,binaryBuffer:e.slice(a)};return l}}},54502:(e,t,n)=>{"use strict";n.d(t,{Fn:()=>o,ZP:()=>a,e$:()=>i});const r={};function i(e){return!!r[e]}function o(e,t){r[e]=t}var a={get:function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http"](e)},has:i,registerType:o}},84030:(e,t,n)=>{"use strict";var r=n(68470);function i(){const e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);return t[0]=161,t[1]=178,t[2]=195,t[3]=212,3569595041===n[0]?"LittleEndian":2712847316===n[0]?"BigEndian":null}var o={ENDIANNESS:i(),getEndianness:i,swapBytes:function(e,t){if(t<2)return;const n=new Int8Array(e),r=n.length,i=[];for(let e=0;e<r;e+=t){for(let r=0;r<t;r++)i.push(n[e+r]);for(let r=0;r<t;r++)n[e+r]=i.pop()}}},a=n(89262),s=n(54502);const{vtkErrorMacro:l,vtkDebugMacro:c}=r.m,u=()=>(l("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let d=0;function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new XMLHttpRequest;return r.open(e,t,!0),n.headers&&Object.entries(n.headers).forEach(e=>{let[t,n]=e;return r.setRequestHeader(t,n)}),n.progressCallback&&r.addEventListener("progress",n.progressCallback),r}const h={fetchArray:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i&&i.compression?u():n.ref&&!n.ref.pending?new Promise((s,u)=>{const h=p("GET",[t,n.ref.basepath,n.ref.id].join("/"),i);h.onreadystatechange=t=>{1===h.readyState&&(n.ref.pending=!0,1===++d&&e?.invokeBusy&&e.invokeBusy(!0)),4===h.readyState&&(n.ref.pending=!1,200===h.status||0===h.status?(n.buffer=h.response,"JSON"===n.ref.encode?n.values=JSON.parse(n.buffer):(o.ENDIANNESS!==n.ref.encode&&o.ENDIANNESS&&(c(`Swap bytes of ${n.name}`),o.swapBytes(n.buffer,a.Xe[n.dataType])),n.values=r.m.newTypedArray(n.dataType,n.buffer)),n.values.length!==n.size&&l(`Error in FetchArray: ${n.name}, does not have the proper array size. Got ${n.values.length}, instead of ${n.size}`),delete n.ref,0===--d&&e?.invokeBusy&&e.invokeBusy(!1),e?.modified&&e.modified(),s(n)):u({xhr:h,e:t}))},h.responseType="string"!==n.dataType?"arraybuffer":"text",h.send()}):Promise.resolve(n)},fetchJSON:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n&&n.compression?u():new Promise((r,i)=>{const o=p("GET",t,n);o.onreadystatechange=t=>{1===o.readyState&&1===++d&&e?.invokeBusy&&e.invokeBusy(!0),4===o.readyState&&(0===--d&&e?.invokeBusy&&e.invokeBusy(!1),200===o.status||0===o.status?r(JSON.parse(o.responseText)):i({xhr:o,e:t}))},o.responseType="text",o.send()})},fetchText:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n&&n.compression?u():new Promise((r,i)=>{const o=p("GET",t,n);o.onreadystatechange=t=>{1===o.readyState&&1===++d&&e?.invokeBusy&&e.invokeBusy(!0),4===o.readyState&&(0===--d&&e?.invokeBusy&&e.invokeBusy(!1),200===o.status||0===o.status?r(o.responseText):i({xhr:o,e:t}))},o.responseType="text",o.send()})},fetchBinary:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((n,r)=>{const i=p("GET",e,t);i.onreadystatechange=e=>{4===i.readyState&&(200===i.status||0===i.status?n(i.response):r({xhr:i,e}))},i.responseType="arraybuffer",i.send()})},fetchImage:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((e,r)=>{const i=new Image;n.crossOrigin&&(i.crossOrigin=n.crossOrigin),i.onload=()=>e(i),i.onerror=r,i.src=t})}};(0,s.e$)("http")||(0,s.Fn)("http",e=>h)},93751:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(68470),i=n(21924),o=n(59474);const a={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};var s={extend:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),i.Z.extend(e,t,n),r.m.setGet(e,t,["slice","useCustomExtents"]),r.m.setGetArray(e,t,["customDisplayExtent"],6),r.m.setGetArray(e,t,["backgroundColor"],4),function(e,t){t.classHierarchy.push("vtkAbstractImageMapper"),e.getIsOpaque=()=>!0,e.getCurrentImage=()=>null,e.getBoundsForSlice=()=>(r.m.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),(0,o.F)())}(e,t)}}},68649:(e,t,n)=>{"use strict";n.d(t,{L:()=>s,U:()=>a});var r=n(72076),i=n(3969);function o(e,t,n){const o=n.getCurrentImage(),a=o.getExtent(),s=[a[0],a[2],a[4]],{ijkMode:l}=n.getClosestIJKAxis();let c=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();l!==n.getSlicingMode()&&(c=n.getSliceAtPosition(c)),s[l]+=c;const u=[0,0,0];o.indexToWorld(s,u),s[l]+=1;const d=[0,0,0];o.indexToWorld(s,d),d[0]-=u[0],d[1]-=u[1],d[2]-=u[2],r.R3.normalize(d,d);const p=i.ZP.intersectWithLine(e,t,u,d);if(p.intersection){const e=p.x,t=[0,0,0];return o.worldToIndex(e,t),{t:p.t,absoluteIJK:t}}return null}function a(e,t,n){const r=o(e,t,n);if(r){const e=n.getCurrentImage().getExtent(),t=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return t[0]<e[0]||t[0]>e[1]||t[1]<e[2]||t[1]>e[3]||t[2]<e[4]||t[2]>e[5]?null:{t:r.t,ijk:t}}return null}function s(e,t,n){const r=o(e,t,n);if(r){const e=n.getCurrentImage().getExtent(),t=r.absoluteIJK,i=[Math.floor(t[0]),Math.floor(t[1]),Math.floor(t[2])];if(i[0]<e[0]||i[0]>e[1]-1||i[1]<e[2]||i[1]>e[3]-1||i[2]<e[4]||i[2]>(e[5]?e[5]-1:e[5]))return null;const o=[t[0]-i[0],t[1]-i[1],t[2]-i[2]];return{t:r.t,ijk:i,pCoords:o}}return null}},16595:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(68470);const i={clippingPlanes:[]};var o={extend:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,i,n),r.m.obj(e,t),r.m.algo(e,t,1,0),t.clippingPlanes||(t.clippingPlanes=[]),function(e,t){t.classHierarchy.push("vtkAbstractMapper"),e.update=()=>{e.getInputData()},e.addClippingPlane=n=>!!n.isA("vtkPlane")&&!t.clippingPlanes.includes(n)&&(t.clippingPlanes.push(n),e.modified(),!0),e.getNumberOfClippingPlanes=()=>t.clippingPlanes.length,e.removeAllClippingPlanes=()=>0!==t.clippingPlanes.length&&(t.clippingPlanes.length=0,e.modified(),!0),e.removeClippingPlane=n=>{const r=t.clippingPlanes.indexOf(n);return-1!==r&&(t.clippingPlanes.splice(r,1),e.modified(),!0)},e.getClippingPlanes=()=>t.clippingPlanes,e.setClippingPlanes=t=>{if(t)if(Array.isArray(t)){const n=t.length;for(let r=0;r<n&&r<6;r++)e.addClippingPlane(t[r])}else e.addClippingPlane(t)},e.getClippingPlaneInDataCoords=(e,n,i)=>{const o=t.clippingPlanes,a=e;if(o){const e=o.length;if(n>=0&&n<e){const e=o[n],t=e.getNormal(),r=e.getOrigin(),s=t[0],l=t[1],c=t[2],u=-(s*r[0]+l*r[1]+c*r[2]);return i[0]=s*a[0]+l*a[4]+c*a[8]+u*a[12],i[1]=s*a[1]+l*a[5]+c*a[9]+u*a[13],i[2]=s*a[2]+l*a[6]+c*a[10]+u*a[14],void(i[3]=s*a[3]+l*a[7]+c*a[11]+u*a[15])}}r.m.vtkErrorMacro(`Clipping plane index ${n} is out of range.`)}}(e,t)}}},21924:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(68470),i=n(16595),o=n(91382),a=n(59474);var s={extend:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,(e=>({bounds:[...o.ZP.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...e}))(n)),i.Z.extend(e,t,n),r.m.setGet(e,t,["viewSpecificProperties"]),function(e,t){e.getBounds=()=>(r.m.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),(0,a.F)()),e.getCenter=()=>{const n=e.getBounds();return t.center=o.ZP.isValid(n)?o.ZP.getCenter(n):null,t.center?.slice()},e.getLength=()=>{const t=e.getBounds();return o.ZP.getDiagonalLength(t)}}(e,t)}}},16623:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>d});var r=n(72076),i=n(68470),o=n(91382),a=n(49445),s=n(98589);const{vtkDebugMacro:l}=i.m;const c={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),a.ZP.extend(e,t,n),t.boundsMTime={},i.m.obj(t.boundsMTime),i.m.set(e,t,["property"]),i.m.setGet(e,t,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),function(e,t){t.classHierarchy.push("vtkActor");const n={...e};e.getActors=()=>[e],e.getIsOpaque=()=>{if(t.forceOpaque)return!0;if(t.forceTranslucent)return!1;t.property||e.getProperty();let n=t.property.getOpacity()>=1;return n=n&&(!t.texture||!t.texture.isTranslucent()),n=n&&(!t.mapper||t.mapper.getIsOpaque()),n},e.hasTranslucentPolygonalGeometry=()=>null!==t.mapper&&(null===t.property&&e.setProperty(e.makeProperty()),!e.getIsOpaque()),e.makeProperty=s.default.newInstance,e.getProperty=()=>(null===t.property&&(t.property=e.makeProperty()),t.property),e.getBounds=()=>{if(null===t.mapper)return t.bounds;const n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;if(!t.mapperBounds||n[0]!==t.mapperBounds[0]||n[1]!==t.mapperBounds[1]||n[2]!==t.mapperBounds[2]||n[3]!==t.mapperBounds[3]||n[4]!==t.mapperBounds[4]||n[5]!==t.mapperBounds[5]||e.getMTime()>t.boundsMTime.getMTime()){l("Recomputing bounds..."),t.mapperBounds=n.concat();const i=[];o.ZP.getCorners(n,i),e.computeMatrix();const a=new Float64Array(16);r._E.transpose(a,t.matrix),i.forEach(e=>r.R3.transformMat4(e,e,a)),t.bounds[0]=t.bounds[2]=t.bounds[4]=Number.MAX_VALUE,t.bounds[1]=t.bounds[3]=t.bounds[5]=-Number.MAX_VALUE,t.bounds=t.bounds.map((e,t)=>t%2==0?i.reduce((e,n)=>e>n[t/2]?n[t/2]:e,e):i.reduce((e,n)=>e<n[(t-1)/2]?n[(t-1)/2]:e,e)),t.boundsMTime.modified()}return t.bounds},e.getMTime=()=>{let e=n.getMTime();if(null!==t.property){const n=t.property.getMTime();e=n>e?n:e}if(null!==t.backfaceProperty){const n=t.backfaceProperty.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=()=>{let e=t.mtime;if(null!==t.mapper){let n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}return e},e.getSupportsSelection=()=>!!t.mapper&&t.mapper.getSupportsSelection(),e.processSelectorPixelBuffers=(e,n)=>{t.mapper&&t.mapper.processSelectorPixelBuffers&&t.mapper.processSelectorPixelBuffers(e,n)}}(e,t)}var d={newInstance:i.m.newInstance(u,"vtkActor"),extend:u}},40188:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});var r=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,7.54296e-7,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,1.11641e-7,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,3.63578e-7,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,4.05298e-7,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4.264e-8,0,6.20844e-7,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,3.3216e-7,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,4.05432e-7,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,4.55569e-8]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,4.55569e-8,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}]},48858:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});var r={ColorSpace:{RGB:0,HSV:1,LAB:2,DIVERGING:3},Scale:{LINEAR:0,LOG10:1}}},72795:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});var r={SlicingMode:{NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5}}},1408:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var r=n(68470),i=n(39648);const{InterpolationType:o}=i.default,{vtkErrorMacro:a}=r.m;const s={independentComponents:!1,interpolationType:o.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,s,n),r.m.obj(e,t),!t.componentData){t.componentData=[];for(let e=0;e<4;e++)t.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}r.m.setGet(e,t,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),r.m.setGetArray(e,t,["labelOutlineThickness"]),function(e,t){t.classHierarchy.push("vtkImageProperty"),e.getMTime=()=>{let e,n=t.mtime;for(let r=0;r<4;r++)t.componentData[r].rGBTransferFunction&&(e=t.componentData[r].rGBTransferFunction.getMTime(),n=n>e?n:e),t.componentData[r].piecewiseFunction&&(e=t.componentData[r].piecewiseFunction.getMTime(),n=n>e?n:e);return n},e.setRGBTransferFunction=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Number.isInteger(n)||(i=n,r=0),t.componentData[r].rGBTransferFunction!==i&&(t.componentData[r].rGBTransferFunction=i,e.modified(),!0)},e.getRGBTransferFunction=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.componentData[e].rGBTransferFunction},e.setPiecewiseFunction=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Number.isInteger(n)||(i=n,r=0),t.componentData[r].piecewiseFunction!==i&&(t.componentData[r].piecewiseFunction=i,e.modified(),!0)},e.getPiecewiseFunction=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.componentData[e].piecewiseFunction},e.setScalarOpacity=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Number.isInteger(t)||(r=t,n=0),e.setPiecewiseFunction(n,r)},e.getScalarOpacity=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e.getPiecewiseFunction(t)},e.setComponentWeight=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(n<0||n>=4)return a("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return t.componentData[n].componentWeight!==i&&(t.componentData[n].componentWeight=i,e.modified(),!0)},e.getComponentWeight=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<0||e>=4?(a("Invalid index"),0):t.componentData[e].componentWeight},e.setInterpolationTypeToNearest=()=>e.setInterpolationType(o.NEAREST),e.setInterpolationTypeToLinear=()=>e.setInterpolationType(o.LINEAR),e.getInterpolationTypeAsString=()=>r.m.enumToString(o,t.interpolationType)}(e,t)}var c={newInstance:r.m.newInstance(l,"vtkImageProperty"),extend:l}},39648:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r,default:()=>i});const r={NEAREST:0,LINEAR:1};var i={InterpolationType:r}},93702:(e,t,n)=>{"use strict";n.d(t,{default:()=>_});var r=n(68470),i=n(21924),o=n(54131),a=n(8455),s=n(1600),l=n(59474),c=n(77415),u=n(84418),d=n(85687),p=n(14418),h=n(18603);const{FieldAssociations:f}=p.default,{staticOffsetAPI:m,otherStaticMethods:g}=u.default,{ColorMode:v,ScalarMode:y,GetArray:b}=d.default,{VectorMode:C}=c.default,{VtkDataTypes:w}=o.default;function E(e){return()=>r.m.vtkErrorMacro(`vtkMapper::${e} - NOT IMPLEMENTED`)}const T={colorMapColors:null,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function x(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,T,n),i.Z.extend(e,t,n),r.m.get(e,t,["colorCoordinates","colorMapColors","colorTextureMap","selectionWebGLIdsToVTKIds"]),r.m.setGet(e,t,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),r.m.setGetArray(e,t,["scalarRange"],2),u.default.implementCoincidentTopologyMethods(e,t),function(e,t){t.classHierarchy.push("vtkMapper"),e.getBounds=()=>{const n=e.getInputData();return n?(t.static||e.update(),t.bounds=n.getBounds()):t.bounds=(0,l.F)(),t.bounds},e.setForceCompileOnly=e=>{t.forceCompileOnly=e},e.setSelectionWebGLIdsToVTKIds=e=>{t.selectionWebGLIdsToVTKIds=e},e.createDefaultLookupTable=()=>{t.lookupTable=s.ZP.newInstance()},e.getColorModeAsString=()=>r.m.enumToString(v,t.colorMode),e.setColorModeToDefault=()=>e.setColorMode(0),e.setColorModeToMapScalars=()=>e.setColorMode(1),e.setColorModeToDirectScalars=()=>e.setColorMode(2),e.getScalarModeAsString=()=>r.m.enumToString(y,t.scalarMode),e.setScalarModeToDefault=()=>e.setScalarMode(0),e.setScalarModeToUsePointData=()=>e.setScalarMode(1),e.setScalarModeToUseCellData=()=>e.setScalarMode(2),e.setScalarModeToUsePointFieldData=()=>e.setScalarMode(3),e.setScalarModeToUseCellFieldData=()=>e.setScalarMode(4),e.setScalarModeToUseFieldData=()=>e.setScalarMode(5),e.getAbstractScalars=(e,n,r,i,o)=>{if(!e||!t.scalarVisibility)return{scalars:null,cellFLag:!1};let a=null,s=!1;if(n===y.DEFAULT)a=e.getPointData().getScalars(),a||(a=e.getCellData().getScalars(),s=!0);else if(n===y.USE_POINT_DATA)a=e.getPointData().getScalars();else if(n===y.USE_CELL_DATA)a=e.getCellData().getScalars(),s=!0;else if(n===y.USE_POINT_FIELD_DATA){const t=e.getPointData();a=r===b.BY_ID?t.getArrayByIndex(i):t.getArrayByName(o)}else if(n===y.USE_CELL_FIELD_DATA){const t=e.getCellData();s=!0,a=r===b.BY_ID?t.getArrayByIndex(i):t.getArrayByName(o)}else if(n===y.USE_FIELD_DATA){const t=e.getFieldData();a=r===b.BY_ID?t.getArrayByIndex(i):t.getArrayByName(o)}return{scalars:a,cellFlag:s}},e.mapScalars=(n,r)=>{const i=e.getAbstractScalars(n,t.scalarMode,t.arrayAccessMode,t.arrayId,t.colorByArrayName).scalars;if(!i)return t.colorCoordinates=null,t.colorTextureMap=null,void(t.colorMapColors=null);const o=`${e.getMTime()}${i.getMTime()}${r}`;if(t.colorBuildString!==o){if(t.useLookupTableScalarRange||e.getLookupTable().setRange(t.scalarRange[0],t.scalarRange[1]),e.canUseTextureMapForColoring(n))e.mapScalarsToTexture(i,r);else{t.colorCoordinates=null,t.colorTextureMap=null;const n=e.getLookupTable();n&&(n.build(),t.colorMapColors=n.mapScalars(i,t.colorMode,t.fieldDataTupleId))}t.colorBuildString=`${e.getMTime()}${i.getMTime()}${r}`}},e.scalarToTextureCoordinate=(e,t,n)=>{let r=.5,i=1;return(0,l.i)(e)||(i=.49,r=(e-t)*n,r>1e3?r=1e3:r<-1e3&&(r=-1e3)),{texCoordS:r,texCoordT:i}},e.createColorTextureCoordinates=(t,n,r,i,o,a,l,c,u)=>{const d=(a[1]-a[0])/c,p=[];p[0]=a[0]-d,p[1]=a[1]+d;const h=1/(p[1]-p[0]),f=n.getData(),m=t.getData();let g=0,v=0;if(o<0||o>=i)for(let t=0;t<r;++t){let t=0;for(let e=0;e<i;++e)t+=m[g]*m[g],g++;let n=Math.sqrt(t);u&&(n=s.ZP.applyLogScale(n,l,a));const r=e.scalarToTextureCoordinate(n,p[0],h);f[v]=r.texCoordS,f[v+1]=r.texCoordT,v+=2}else{g+=o;for(let t=0;t<r;++t){let t=m[g];u&&(t=s.ZP.applyLogScale(t,l,a));const n=e.scalarToTextureCoordinate(t,p[0],h);f[v]=n.texCoordS,f[v+1]=n.texCoordT,v+=2,g+=i}}},e.mapScalarsToTexture=(n,r)=>{const i=t.lookupTable.getRange(),l=t.lookupTable.usingLogScale();l&&s.ZP.getLogRange(i,i);const c=t.lookupTable.getAlpha();if(t.colorMapColors=null,null==t.colorTextureMap||e.getMTime()>t.colorTextureMap.getMTime()||t.lookupTable.getMTime()>t.colorTextureMap.getMTime()||t.lookupTable.getAlpha()!==r){t.lookupTable.setAlpha(r),t.colorTextureMap=null,t.lookupTable.build();let e=t.lookupTable.getNumberOfAvailableColors();e>4094&&(e=4094),e<64&&(e=64),e+=2;const n=(i[1]-i[0])/(e-2),s=new Float64Array(2*e);for(let t=0;t<e;++t)s[t]=i[0]+t*n-n/2,l&&(s[t]=10**s[t]);for(let t=0;t<e;++t)s[t+e]=NaN;t.colorTextureMap=a.ZP.newInstance(),t.colorTextureMap.setExtent(0,e-1,0,1,0,0);const u=o.default.newInstance({numberOfComponents:1,values:s});t.colorTextureMap.getPointData().setScalars(t.lookupTable.mapScalars(u,t.colorMode,0)),t.lookupTable.setAlpha(c)}if(!t.colorCoordinates||e.getMTime()>t.colorCoordinates.getMTime()||e.getInputData(0).getMTime()>t.colorCoordinates.getMTime()||t.lookupTable.getMTime()>t.colorCoordinates.getMTime()){t.colorCoordinates=null;const r=n.getNumberOfComponents(),a=n.getNumberOfTuples();t.colorCoordinates=o.default.newInstance({numberOfComponents:2,values:new Float32Array(2*a)});let s=t.lookupTable.getVectorComponent();t.lookupTable.getVectorMode()===C.MAGNITUDE&&n.getNumberOfComponents()>1&&(s=-1),e.createColorTextureCoordinates(n,t.colorCoordinates,a,r,s,i,t.lookupTable.getRange(),t.colorTextureMap.getPointData().getScalars().getNumberOfTuples()/2-2,l)}},e.getIsOpaque=()=>{const n=e.getInputData(),r=e.getAbstractScalars(n,t.scalarMode,t.arrayAccessMode,t.arrayId,t.colorByArrayName).scalars;if(!t.scalarVisibility||null==r)return!0;const i=e.getLookupTable();return!i||(i.build(),i.areScalarsOpaque(r,t.colorMode,-1))},e.canUseTextureMapForColoring=n=>{if(!t.interpolateScalarsBeforeMapping)return!1;if(t.lookupTable&&t.lookupTable.getIndexedLookup())return!1;const r=e.getAbstractScalars(n,t.scalarMode,t.arrayAccessMode,t.arrayId,t.colorByArrayName),i=r.scalars;return!(!i||r.cellFlag||t.colorMode===v.DEFAULT&&i.getDataType()===w.UNSIGNED_CHAR||t.colorMode===v.DIRECT_SCALARS)},e.clearColorArrays=()=>{t.colorMapColors=null,t.colorCoordinates=null,t.colorTextureMap=null},e.getLookupTable=()=>(t.lookupTable||e.createDefaultLookupTable(),t.lookupTable),e.getMTime=()=>{let e=t.mtime;if(null!==t.lookupTable){const n=t.lookupTable.getMTime();e=n>e?n:e}return e},e.getPrimitiveCount=()=>{const t=e.getInputData();return{points:t.getPoints().getNumberOfValues()/3,verts:t.getVerts().getNumberOfValues()-t.getVerts().getNumberOfCells(),lines:t.getLines().getNumberOfValues()-2*t.getLines().getNumberOfCells(),triangles:t.getPolys().getNumberOfValues()-3*t.getPolys().getNumberOfCells()}},e.acquireInvertibleLookupTable=E("AcquireInvertibleLookupTable"),e.valueToColor=E("ValueToColor"),e.colorToValue=E("ColorToValue"),e.useInvertibleColorFor=E("UseInvertibleColorFor"),e.clearInvertibleColor=E("ClearInvertibleColor"),e.processSelectorPixelBuffers=(e,n)=>{if(!e||!t.selectionWebGLIdsToVTKIds||!t.populateSelectionSettings)return;const r=e.getRawPixelBuffer(h.X.ID_LOW24),i=e.getRawPixelBuffer(h.X.ID_HIGH24),o=e.getCurrentPass(),a=e.getFieldAssociation();let s=null;a===f.FIELD_ASSOCIATION_POINTS?s=t.selectionWebGLIdsToVTKIds.points:a===f.FIELD_ASSOCIATION_CELLS&&(s=t.selectionWebGLIdsToVTKIds.cells),s&&n.forEach(t=>{if(o===h.X.ID_LOW24){let n=0;i&&(n+=i[t],n*=256),n+=r[t+2],n*=256,n+=r[t+1],n*=256,n+=r[t];const o=s[n],a=e.getPixelBuffer(h.X.ID_LOW24);a[t]=255&o,a[t+1]=(65280&o)>>8,a[t+2]=(16711680&o)>>16}else if(o===h.X.ID_HIGH24&&i){let n=0;n+=i[t],n*=256,n+=r[t],n*=256,n+=r[t+1],n*=256,n+=r[t+2];const o=s[n];e.getPixelBuffer(h.X.ID_HIGH24)[t]=(4278190080&o)>>24}})}}(e,t)}var _={newInstance:r.m.newInstance(x,"vtkMapper"),extend:x,...m,...g,...d.default}},84418:(e,t,n)=>{"use strict";n.d(t,{default:()=>p});let r=1,i=0;const o=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function a(){i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0}var s={getResolveCoincidentTopologyAsString:function(){return o[i]},getResolveCoincidentTopologyPolygonOffsetFaces:function(){return r},getResolveCoincidentTopology:function(){return i},setResolveCoincidentTopology:a,setResolveCoincidentTopologyPolygonOffsetFaces:function(e){r=e},setResolveCoincidentTopologyToDefault:function(){a(0)},setResolveCoincidentTopologyToOff:function(){a(0)},setResolveCoincidentTopologyToPolygonOffset:function(){a(1)}},l=n(68470);function c(e,t,n){n.forEach(n=>{e[`get${n.method}`]=()=>t[n.key],e[`set${n.method}`]=(e,r)=>{t[n.key]={factor:e,offset:r}}})}const u=["Polygon","Line","Point"],d={};c(d,{Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},u.map(e=>({key:e,method:`ResolveCoincidentTopology${e}OffsetParameters`})));var p={implementCoincidentTopologyMethods:function(e,t){void 0===t.resolveCoincidentTopology&&(t.resolveCoincidentTopology=!1),l.m.setGet(e,t,["resolveCoincidentTopology"]),t.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(s).forEach(t=>{e[t]=s[t]}),Object.keys(d).forEach(t=>{e[t]=d[t]}),c(e,t.topologyOffset,u.map(e=>({key:e,method:`RelativeCoincidentTopology${e}OffsetParameters`}))),e.getCoincidentTopologyPolygonOffsetParameters=()=>{const t=d.getResolveCoincidentTopologyPolygonOffsetParameters(),n=e.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:t.factor+n.factor,offset:t.offset+n.offset}},e.getCoincidentTopologyLineOffsetParameters=()=>{const t=d.getResolveCoincidentTopologyLineOffsetParameters(),n=e.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:t.factor+n.factor,offset:t.offset+n.offset}},e.getCoincidentTopologyPointOffsetParameter=()=>{const t=d.getResolveCoincidentTopologyPointOffsetParameters(),n=e.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:t.factor+n.factor,offset:t.offset+n.offset}}},staticOffsetAPI:d,otherStaticMethods:s,CATEGORIES:u}},85687:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});var r={ColorMode:{DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},GetArray:{BY_ID:0,BY_NAME:1},ScalarMode:{DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5}}},54873:(e,t,n)=>{"use strict";n.d(t,{default:()=>c});var r=n(68470);var i={CoordinateSystem:{DISPLAY:0,WORLD:1}};const{CoordinateSystem:o}=i;function a(e){return()=>r.m.vtkErrorMacro(`vtkProp::${e} - NOT IMPLEMENTED`)}const s={allocatedRenderTime:10,coordinateSystem:o.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),r.m.obj(e,t),r.m.get(e,t,["estimatedRenderTime","allocatedRenderTime"]),r.m.setGet(e,t,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),r.m.moveToProtected(e,t,["parentProp"]),function(e,t){t.classHierarchy.push("vtkProp"),e.getMTime=()=>{let e=t.mtime;for(let n=0;n<t.textures.length;++n){const r=t.textures[n].getMTime();r>e&&(e=r)}return e},e.processSelectorPixelBuffers=(e,t)=>{},e.getNestedProps=()=>null,e.getActors=()=>[],e.getActors2D=()=>[],e.getVolumes=()=>[],e.pick=a("pick"),e.hasKey=a("hasKey"),e.getNestedVisibility=()=>t.visibility&&(!t._parentProp||t._parentProp.getNestedVisibility()),e.getNestedPickable=()=>t.pickable&&(!t._parentProp||t._parentProp.getNestedPickable()),e.getNestedDragable=()=>t.dragable&&(!t._parentProp||t._parentProp.getNestedDragable()),e.getRedrawMTime=()=>t.mtime,e.setEstimatedRenderTime=e=>{t.estimatedRenderTime=e,t.savedEstimatedRenderTime=e},e.restoreEstimatedRenderTime=()=>{t.estimatedRenderTime=t.savedEstimatedRenderTime},e.addEstimatedRenderTime=e=>{t.estimatedRenderTime+=e},e.setAllocatedRenderTime=e=>{t.allocatedRenderTime=e,t.savedEstimatedRenderTime=t.estimatedRenderTime,t.estimatedRenderTime=0},e.getSupportsSelection=()=>!1,e.getTextures=()=>t.textures,e.hasTexture=e=>-1!==t.textures.indexOf(e),e.addTexture=n=>{n&&!e.hasTexture(n)&&(t.textures=t.textures.concat(n),e.modified())},e.removeTexture=n=>{const r=t.textures.filter(e=>e!==n);t.textures.length!==r.length&&(t.textures=r,e.modified())},e.removeAllTextures=()=>{t.textures=[],e.modified()},e.setCoordinateSystemToWorld=()=>e.setCoordinateSystem(o.WORLD),e.setCoordinateSystemToDisplay=()=>e.setCoordinateSystem(o.DISPLAY)}(e,t)}var c={newInstance:r.m.newInstance(l,"vtkProp"),extend:l,...i}},49445:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(72076),i=n(68470),o=n(91382),a=n(59474),s=n(54873);const l={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,l,n),s.default.extend(e,t,n),t.matrixMTime={},i.m.obj(t.matrixMTime),i.m.get(e,t,["bounds","isIdentity"]),i.m.getArray(e,t,["orientation"]),i.m.setGetArray(e,t,["origin","position","scale"],3),t.matrix=r._E.identity(new Float64Array(16)),t.rotation=r._E.identity(new Float64Array(16)),t.userMatrix=r._E.identity(new Float64Array(16)),t.transform=null,function(e,t){t.classHierarchy.push("vtkProp3D"),e.addPosition=n=>{t.position=t.position.map((e,t)=>e+n[t]),e.modified()},e.getOrientationWXYZ=()=>{const e=r.gf.create();r._E.getRotation(e,t.rotation);const n=new Float64Array(3),i=r.gf.getAxisAngle(n,e);return[(0,a.A)(i),n[0],n[1],n[2]]},e.getOrientationQuaternion=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r._E.getRotation(e,t.rotation)},e.rotateX=n=>{0!==n&&(r._E.rotateX(t.rotation,t.rotation,(0,a.r)(n)),e.modified())},e.rotateY=n=>{0!==n&&(r._E.rotateY(t.rotation,t.rotation,(0,a.r)(n)),e.modified())},e.rotateZ=n=>{0!==n&&(r._E.rotateZ(t.rotation,t.rotation,(0,a.r)(n)),e.modified())},e.rotateWXYZ=(n,i,o,s)=>{if(0===n||0===i&&0===o&&0===s)return;const l=(0,a.r)(n),c=r.gf.create();r.gf.setAxisAngle(c,[i,o,s],l);const u=new Float64Array(16);r._E.fromQuat(u,c),r._E.multiply(t.rotation,t.rotation,u),e.modified()},e.rotateQuaternion=n=>{if(Math.abs(n[3])>=.999999)return;const i=r._E.fromQuat(new Float64Array(16),n);r._E.multiply(t.rotation,t.rotation,i),e.modified()},e.setOrientation=(n,i,o)=>(n!==t.orientation[0]||i!==t.orientation[1]||o!==t.orientation[2])&&(t.orientation=[n,i,o],r._E.identity(t.rotation),e.rotateZ(o),e.rotateX(n),e.rotateY(i),e.modified(),!0),e.setUserMatrix=n=>!(0,a.a)(t.userMatrix,n)&&(r._E.copy(t.userMatrix,n),e.modified(),!0),e.getMatrix=()=>(e.computeMatrix(),t.matrix),e.computeMatrix=()=>{if(e.getMTime()>t.matrixMTime.getMTime()){r._E.identity(t.matrix),t.userMatrix&&r._E.multiply(t.matrix,t.matrix,t.userMatrix),r._E.translate(t.matrix,t.matrix,t.origin),r._E.translate(t.matrix,t.matrix,t.position),r._E.multiply(t.matrix,t.matrix,t.rotation),r._E.scale(t.matrix,t.matrix,t.scale),r._E.translate(t.matrix,t.matrix,[-t.origin[0],-t.origin[1],-t.origin[2]]),r._E.transpose(t.matrix,t.matrix),t.isIdentity=!0;for(let e=0;e<4;++e)for(let n=0;n<4;++n)(e===n?1:0)!==t.matrix[e+4*n]&&(t.isIdentity=!1);t.matrixMTime.modified()}},e.getCenter=()=>o.ZP.getCenter(t.bounds),e.getLength=()=>o.ZP.getLength(t.bounds),e.getXRange=()=>o.ZP.getXRange(t.bounds),e.getYRange=()=>o.ZP.getYRange(t.bounds),e.getZRange=()=>o.ZP.getZRange(t.bounds),e.getUserMatrix=()=>t.userMatrix,e.onModified(function(){e.computeMatrix()})}(e,t)}var u={newInstance:i.m.newInstance(c,"vtkProp3D"),extend:c}},98589:(e,t,n)=>{"use strict";n.d(t,{default:()=>u});var r=n(68470),i=n(42695);const{Representation:o,Interpolation:a}=i.default;function s(e){return()=>r.m.vtkErrorMacro(`vtkProperty::${e} - NOT IMPLEMENTED`)}const l={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:a.GOURAUD,representation:o.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,l,n),r.m.obj(e,t),r.m.setGet(e,t,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),r.m.setGetArray(e,t,["ambientColor","specularColor","diffuseColor","edgeColor"],3),function(e,t){t.classHierarchy.push("vtkProperty"),e.setColor=(n,r,i)=>{Array.isArray(n)?t.color[0]===n[0]&&t.color[1]===n[1]&&t.color[2]===n[2]||(t.color[0]=n[0],t.color[1]=n[1],t.color[2]=n[2],e.modified()):t.color[0]===n&&t.color[1]===r&&t.color[2]===i||(t.color[0]=n,t.color[1]=r,t.color[2]=i,e.modified()),e.setDiffuseColor(t.color),e.setAmbientColor(t.color),e.setSpecularColor(t.color)},e.computeCompositeColor=s("ComputeCompositeColor"),e.getColor=()=>{let e=0;t.ambient+t.diffuse+t.specular>0&&(e=1/(t.ambient+t.diffuse+t.specular));for(let n=0;n<3;n++)t.color[n]=e*(t.ambient*t.ambientColor[n]+t.diffuse*t.diffuseColor[n]+t.specular*t.specularColor[n]);return[].concat(t.color)},e.setSpecularPower=n=>{const r=1/Math.max(1,n);t.roughness===r&&t.specularPower===n||(t.specularPower=n,t.roughness=r,e.modified())},e.addShaderVariable=s("AddShaderVariable"),e.setInterpolationToFlat=()=>e.setInterpolation(a.FLAT),e.setInterpolationToGouraud=()=>e.setInterpolation(a.GOURAUD),e.setInterpolationToPhong=()=>e.setInterpolation(a.PHONG),e.getInterpolationAsString=()=>r.m.enumToString(a,t.interpolation),e.setRepresentationToWireframe=()=>e.setRepresentation(o.WIREFRAME),e.setRepresentationToSurface=()=>e.setRepresentation(o.SURFACE),e.setRepresentationToPoints=()=>e.setRepresentation(o.POINTS),e.getRepresentationAsString=()=>r.m.enumToString(o,t.representation)}(e,t)}var u={newInstance:r.m.newInstance(c,"vtkProperty"),extend:c,...i.default}},42695:(e,t,n)=>{"use strict";n.d(t,{default:()=>o,hX:()=>i});const r={FLAT:0,GOURAUD:1,PHONG:2},i={POINTS:0,WIREFRAME:1,SURFACE:2};var o={Shading:r,Representation:i,Interpolation:r}},32198:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>E});var r=n(72076),i=n(68470),o=n(34535),a=n(59474);const s={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),i.m.obj(e,t),i.m.setGet(e,t,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),i.m.setGetArray(e,t,["color","position","focalPoint","attenuationValues"],3),function(e,t){t.classHierarchy.push("vtkLight");const n=new Float64Array(3);e.getTransformedPosition=()=>(t.transformMatrix?r.R3.transformMat4(n,t.position,t.transformMatrix):r.R3.set(n,t.position[0],t.position[1],t.position[2]),n),e.getTransformedFocalPoint=()=>(t.transformMatrix?r.R3.transformMat4(n,t.focalPoint,t.transformMatrix):r.R3.set(n,t.focalPoint[0],t.focalPoint[1],t.focalPoint[2]),n),e.getDirection=()=>(t.directionMTime<t.mtime&&(r.R3.sub(t.direction,t.focalPoint,t.position),(0,a.l)(t.direction),t.directionMTime=t.mtime),t.direction),e.setDirection=e=>{const n=new Float64Array(3);r.R3.sub(n,t.position,e),t.focalPoint=n},e.setDirectionAngle=(t,n)=>{const r=(0,a.r)(t),i=(0,a.r)(n);e.setPosition(Math.cos(r)*Math.sin(i),Math.sin(r),Math.cos(r)*Math.cos(i)),e.setFocalPoint(0,0,0),e.setPositional(0)},e.setLightTypeToHeadLight=()=>{e.setLightType("HeadLight")},e.setLightTypeToCameraLight=()=>{e.setLightType("CameraLight")},e.setLightTypeToSceneLight=()=>{e.setTransformMatrix(null),e.setLightType("SceneLight")},e.lightTypeIsHeadLight=()=>"HeadLight"===t.lightType,e.lightTypeIsSceneLight=()=>"SceneLight"===t.lightType,e.lightTypeIsCameraLight=()=>"CameraLight"===t.lightType}(e,t)}var c={newInstance:i.m.newInstance(l,"vtkLight"),extend:l,LIGHT_TYPES:["HeadLight","CameraLight","SceneLight"]};const{vtkErrorMacro:u}=i.m;function d(e,t){function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.push(e);const r=e.getNestedProps();if(r&&r.length)for(let e=0;e<r.length;e++)n(r[e],t);return t}var r;t.classHierarchy.push("vtkViewport"),e.getViewProps=()=>t.props,e.hasViewProp=e=>t.props.includes(e),e.addViewProp=n=>{n&&!e.hasViewProp(n)&&t.props.push(n)},e.removeViewProp=e=>{const n=t.props.filter(t=>t!==e);t.props.length!==n.length&&(t.props=n)},e.removeAllViewProps=()=>{t.props=[]},e.getViewPropsWithNestedProps=()=>{const e=[];for(let r=0;r<t.props.length;r++)n(t.props[r],e);return e},e.addActor2D=e.addViewProp,e.removeActor2D=t=>{e.removeViewProp(t)},e.getActors2D=()=>(t.actors2D=[],t.props.forEach(e=>{t.actors2D=t.actors2D.concat(e.getActors2D())}),t.actors2D),e.displayToView=()=>u("call displayToView on your view instead"),e.viewToDisplay=()=>u("callviewtodisplay on your view instead"),e.getSize=()=>u("call getSize on your View instead"),e.normalizedDisplayToProjection=(t,n,r)=>{const i=e.normalizedDisplayToNormalizedViewport(t,n,r);return e.normalizedViewportToProjection(i[0],i[1],i[2])},e.normalizedDisplayToNormalizedViewport=(e,n,r)=>{const i=[t.viewport[2]-t.viewport[0],t.viewport[3]-t.viewport[1]];return[(e-t.viewport[0])/i[0],(n-t.viewport[1])/i[1],r]},e.normalizedViewportToProjection=(e,t,n)=>[2*e-1,2*t-1,2*n-1],e.projectionToNormalizedDisplay=(t,n,r)=>{const i=e.projectionToNormalizedViewport(t,n,r);return e.normalizedViewportToNormalizedDisplay(i[0],i[1],i[2])},e.normalizedViewportToNormalizedDisplay=(e,n,r)=>{const i=[t.viewport[2]-t.viewport[0],t.viewport[3]-t.viewport[1]];return[e*i[0]+t.viewport[0],n*i[1]+t.viewport[1],r]},e.projectionToNormalizedViewport=(e,t,n)=>[.5*(e+1),.5*(t+1),.5*(n+1)],e.PickPropFrom=(r="PickPropFrom",()=>u(`vtkViewport::${r} - NOT IMPLEMENTED`))}const p={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,p,n),i.m.obj(e,t),i.m.event(e,t,"event"),i.m.setGetArray(e,t,["viewport"],4),i.m.setGetArray(e,t,["background","background2"],3),d(e,t)}var f={newInstance:i.m.newInstance(h,"vtkViewport"),extend:h},m=n(91382);const{vtkDebugMacro:g,vtkErrorMacro:v,vtkWarningMacro:y}=i.c;function b(e){return()=>v(`vtkRenderer::${e} - NOT IMPLEMENTED`)}const C={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:(0,a.F)(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function w(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(Object.assign(t,C,n),f.extend(e,t,n),t.background||(t.background=[0,0,0,1]);t.background.length<3;)t.background.push(0);3===t.background.length&&t.background.push(1),(0,i.g)(e,t,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),(0,i.e)(e,t,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),(0,i.k)(e,t,["actors","volumes","lights"]),(0,i.l)(e,t,["background"],4,1),(0,i.i)(e,t,["renderWindow"]),function(e,t){t.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:e},i={type:"ResetCameraClippingRangeEvent",renderer:e},s={type:"ResetCameraEvent",renderer:e};e.updateCamera=()=>(t.activeCamera||(g("No cameras are on, creating one."),e.getActiveCameraAndResetIfCreated()),t.activeCamera.render(e),!0),e.updateLightsGeometryToFollowCamera=()=>{const n=e.getActiveCameraAndResetIfCreated();t.lights.forEach(e=>{e.lightTypeIsSceneLight()||(e.lightTypeIsHeadLight()?(e.setPositionFrom(n.getPositionByReference()),e.setFocalPointFrom(n.getFocalPointByReference()),e.modified(n.getMTime())):e.lightTypeIsCameraLight()?e.setTransformMatrix(n.getCameraLightTransformMatrix(r._E.create())):v("light has unknown light type",e.get()))})},e.updateLightGeometry=()=>!t.lightFollowCamera||e.updateLightsGeometryToFollowCamera(),e.allocateTime=b("allocateTime"),e.updateGeometry=b("updateGeometry"),e.getVTKWindow=()=>t._renderWindow,e.setLayer=n=>{g(e.getClassName(),e,"setting Layer to ",n),t.layer!==n&&(t.layer=n,e.modified()),e.setPreserveColorBuffer(!!n)},e.setActiveCamera=n=>t.activeCamera!==n&&(t.activeCamera=n,e.modified(),e.invokeEvent({type:"ActiveCameraEvent",camera:n}),!0),e.makeCamera=()=>{const t=o.ZP.newInstance();return e.invokeEvent({type:"CreateCameraEvent",camera:t}),t},e.getActiveCamera=()=>(t.activeCamera||(t.activeCamera=e.makeCamera()),t.activeCamera),e.getActiveCameraAndResetIfCreated=()=>(t.activeCamera||(e.getActiveCamera(),e.resetCamera()),t.activeCamera),e.getActors=()=>(t.actors=[],t.props.forEach(e=>{t.actors=t.actors.concat(e.getActors())}),t.actors),e.addActor=e.addViewProp,e.removeActor=n=>{t.actors=t.actors.filter(e=>e!==n),e.removeViewProp(n),e.modified()},e.removeAllActors=()=>{e.getActors().forEach(t=>{e.removeViewProp(t)}),t.actors=[],e.modified()},e.getVolumes=()=>(t.volumes=[],t.props.forEach(e=>{t.volumes=t.volumes.concat(e.getVolumes())}),t.volumes),e.addVolume=e.addViewProp,e.removeVolume=n=>{t.volumes=t.volumes.filter(e=>e!==n),e.removeViewProp(n),e.modified()},e.removeAllVolumes=()=>{e.getVolumes().forEach(t=>{e.removeViewProp(t)}),t.volumes=[],e.modified()},e.hasLight=e=>t.lights.includes(e),e.addLight=n=>{n&&!e.hasLight(n)&&(t.lights.push(n),e.modified())},e.removeLight=n=>{t.lights=t.lights.filter(e=>e!==n),e.modified()},e.removeAllLights=()=>{t.lights=[],e.modified()},e.setLightCollection=n=>{t.lights=n,e.modified()},e.makeLight=c.newInstance,e.createLight=()=>{t.automaticLightCreation&&(t._createdLight&&(e.removeLight(t._createdLight),t._createdLight.delete(),t._createdLight=null),t._createdLight=e.makeLight(),e.addLight(t._createdLight),t._createdLight.setLightTypeToHeadLight(),t._createdLight.setPosition(e.getActiveCamera().getPosition()),t._createdLight.setFocalPoint(e.getActiveCamera().getFocalPoint()))},e.normalizedDisplayToWorld=(t,n,r,i)=>{let o=e.normalizedDisplayToProjection(t,n,r);return o=e.projectionToView(o[0],o[1],o[2],i),e.viewToWorld(o[0],o[1],o[2])},e.worldToNormalizedDisplay=(t,n,r,i)=>{let o=e.worldToView(t,n,r);return o=e.viewToProjection(o[0],o[1],o[2],i),e.projectionToNormalizedDisplay(o[0],o[1],o[2])},e.viewToWorld=(e,n,i)=>{if(null===t.activeCamera)return v("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const o=t.activeCamera.getViewMatrix();r._E.invert(o,o),r._E.transpose(o,o);const a=new Float64Array([e,n,i]);return r.R3.transformMat4(a,a,o),a},e.projectionToView=(e,n,i,o)=>{if(null===t.activeCamera)return v("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const a=t.activeCamera.getProjectionMatrix(o,-1,1);r._E.invert(a,a),r._E.transpose(a,a);const s=new Float64Array([e,n,i]);return r.R3.transformMat4(s,s,a),s},e.worldToView=(e,n,i)=>{if(null===t.activeCamera)return v("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const o=t.activeCamera.getViewMatrix();r._E.transpose(o,o);const a=new Float64Array([e,n,i]);return r.R3.transformMat4(a,a,o),a},e.viewToProjection=(e,n,i,o)=>{if(null===t.activeCamera)return v("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const a=t.activeCamera.getProjectionMatrix(o,-1,1);r._E.transpose(a,a);const s=new Float64Array([e,n,i]);return r.R3.transformMat4(s,s,a),s},e.computeVisiblePropBounds=()=>{t.allBounds[0]=m.ZP.INIT_BOUNDS[0],t.allBounds[1]=m.ZP.INIT_BOUNDS[1],t.allBounds[2]=m.ZP.INIT_BOUNDS[2],t.allBounds[3]=m.ZP.INIT_BOUNDS[3],t.allBounds[4]=m.ZP.INIT_BOUNDS[4],t.allBounds[5]=m.ZP.INIT_BOUNDS[5];let r=!0;e.invokeEvent(n);for(let e=0;e<t.props.length;++e){const n=t.props[e];if(n.getVisibility()&&n.getUseBounds()){const e=n.getBounds();e&&(0,a.T)(e)&&(r=!1,e[0]<t.allBounds[0]&&(t.allBounds[0]=e[0]),e[1]>t.allBounds[1]&&(t.allBounds[1]=e[1]),e[2]<t.allBounds[2]&&(t.allBounds[2]=e[2]),e[3]>t.allBounds[3]&&(t.allBounds[3]=e[3]),e[4]<t.allBounds[4]&&(t.allBounds[4]=e[4]),e[5]>t.allBounds[5]&&(t.allBounds[5]=e[5]))}}return r&&((0,a.u)(t.allBounds),g("Can't compute bounds, no 3D props are visible")),t.allBounds},e.resetCamera=function(){const n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||e.computeVisiblePropBounds(),r=[0,0,0];if(!(0,a.T)(n))return g("Cannot reset camera!"),!1;let i=null;if(!e.getActiveCamera())return v("Trying to reset non-existent camera"),!1;i=t.activeCamera.getViewPlaneNormal(),t.activeCamera.setViewAngle(30),r[0]=(n[0]+n[1])/2,r[1]=(n[2]+n[3])/2,r[2]=(n[4]+n[5])/2;let o=n[1]-n[0],l=n[3]-n[2],c=n[5]-n[4];o*=o,l*=l,c*=c;let u=o+l+c;u=0===u?1:u,u=.5*Math.sqrt(u);const d=(0,a.r)(t.activeCamera.getViewAngle()),p=u,h=u/Math.sin(.5*d),f=t.activeCamera.getViewUp();return Math.abs((0,a.d)(f,i))>.999&&(y("Resetting view-up since view plane normal is parallel"),t.activeCamera.setViewUp(-f[2],f[0],f[1])),t.activeCamera.setFocalPoint(r[0],r[1],r[2]),t.activeCamera.setPosition(r[0]+h*i[0],r[1]+h*i[1],r[2]+h*i[2]),e.resetCameraClippingRange(n),t.activeCamera.setParallelScale(p),t.activeCamera.setPhysicalScale(u),t.activeCamera.setPhysicalTranslation(-r[0],-r[1],-r[2]),e.invokeEvent(s),!0},e.resetCameraClippingRange=function(){const n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||e.computeVisiblePropBounds();if(!(0,a.T)(n))return g("Cannot reset camera clipping range!"),!1;if(e.getActiveCameraAndResetIfCreated(),!t.activeCamera)return v("Trying to reset clipping range of non-existent camera"),!1;const r=t.activeCamera.computeClippingRange(n);let o=0;if(t.activeCamera.getParallelProjection())o=.2*t.activeCamera.getParallelScale();else{const e=(0,a.r)(t.activeCamera.getViewAngle());o=.2*Math.tan(e/2)*r[1]}return r[1]-r[0]<o&&(o=o-r[1]+r[0],r[1]+=o/2,r[0]-=o/2),r[0]<0&&(r[0]=0),r[0]=.99*r[0]-(r[1]-r[0])*t.clippingRangeExpansion,r[1]=1.01*r[1]+(r[1]-r[0])*t.clippingRangeExpansion,r[0]=r[0]>=r[1]?.01*r[1]:r[0],t.nearClippingPlaneTolerance||(t.nearClippingPlaneTolerance=.01),r[0]<t.nearClippingPlaneTolerance*r[1]&&(r[0]=t.nearClippingPlaneTolerance*r[1]),t.activeCamera.setClippingRange(r[0],r[1]),e.invokeEvent(i),!1},e.setRenderWindow=e=>{e!==t._renderWindow&&(t._vtkWindow=e,t._renderWindow=e)},e.visibleActorCount=()=>t.props.filter(e=>e.getVisibility()).length,e.visibleVolumeCount=e.visibleActorCount,e.getMTime=()=>{let e=t.mtime;const n=t.activeCamera?t.activeCamera.getMTime():0;n>e&&(e=n);const r=t._createdLight?t._createdLight.getMTime():0;return r>e&&(e=r),e},e.getTransparent=()=>!!t.preserveColorBuffer,e.isActiveCameraCreated=()=>!!t.activeCamera}(e,t)}var E={newInstance:(0,i.n)(w,"vtkRenderer"),extend:w}},64725:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>a});var r=n(68470);const i={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,i,n),r.m.obj(e,t),r.m.algo(e,t,6,0),r.m.get(e,t,["canvas","image","jsImageData","imageLoaded","resizable"]),r.m.setGet(e,t,["repeat","edgeClamp","interpolate","mipLevel"]),function(e,t){t.classHierarchy.push("vtkTexture"),e.imageLoaded=()=>{t.image.removeEventListener("load",e.imageLoaded),t.imageLoaded=!0,e.modified()},e.setJsImageData=n=>{t.jsImageData!==n&&(null!==n&&(e.setInputData(null),e.setInputConnection(null),t.image=null,t.canvas=null),t.jsImageData=n,t.imageLoaded=!0,e.modified())},e.setCanvas=n=>{t.canvas!==n&&(null!==n&&(e.setInputData(null),e.setInputConnection(null),t.image=null,t.jsImageData=null),t.canvas=n,e.modified())},e.setImage=n=>{t.image!==n&&(null!==n&&(e.setInputData(null),e.setInputConnection(null),t.canvas=null,t.jsImageData=null),t.image=n,t.imageLoaded=!1,n.complete?e.imageLoaded():n.addEventListener("load",e.imageLoaded),e.modified())},e.getDimensionality=()=>{let n=0,r=0,i=1;if(e.getInputData()){const t=e.getInputData();n=t.getDimensions()[0],r=t.getDimensions()[1],i=t.getDimensions()[2]}return t.jsImageData&&(n=t.jsImageData.width,r=t.jsImageData.height),t.canvas&&(n=t.canvas.width,r=t.canvas.height),t.image&&(n=t.image.width,r=t.image.height),(n>1)+(r>1)+(i>1)},e.getInputAsJsImageData=()=>{if(!t.imageLoaded||e.getInputData())return null;if(t.jsImageData)return t.jsImageData();if(t.canvas)return t.canvas.getContext("2d").getImageData(0,0,t.canvas.width,t.canvas.height);if(t.image){const e=document.createElement("canvas");e.width=t.image.width,e.height=t.image.height;const n=e.getContext("2d");return n.translate(0,e.height),n.scale(1,-1),n.drawImage(t.image,0,0,t.image.width,t.image.height),n.getImageData(0,0,e.width,e.height)}return null}}(e,t)}var a={newInstance:r.m.newInstance(o,"vtkTexture"),extend:o,...{generateMipmaps:(e,t,n,r)=>{const i=[1,2,1],o=e.length/(t*n);let a=t,s=n,l=e;const c=[l];for(let e=0;e<r;e++){const e=[...l];a/=2,s/=2,l=new Uint8ClampedArray(a*s*o);const t=o*a;let n=0;for(let r=0;r<l.length;r+=o){r%t===0&&(n+=2*o*a);for(let i=0;i<o;i++){let a=e[n+i];a+=e[n+o+i],a+=e[n-2*t+i],a+=e[n-2*t+o+i],a/=4,l[r+i]=a}n+=2*o}let r=[...l];for(let e=0;e<l.length;e+=o)for(let n=0;n<o;n++){let a=-(i.length-1)/2,s=4,c=0;for(let l=0;l<i.length;l++){let u=e+n+a*o;const d=u%t-(e+n)%t;d>o&&(u+=t),d<-o&&(u-=t),r[u]?c+=r[u]*i[l]:s-=i[l],a+=1}l[e+n]=c/s}r=[...l];for(let e=0;e<l.length;e+=o)for(let n=0;n<o;n++){let o=-(i.length-1)/2,a=4,s=0;for(let l=0;l<i.length;l++){const c=e+n+o*t;r[c]?s+=r[c]*i[l]:a-=i[l],o+=1}l[e+n]=s/a}c.push(l)}return c}}}},60337:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>h});var r=n(68470),i=n(59474),o=n(83336),a=n(21924),s=n(44031);const{BlendMode:l,FilterMode:c}=o.default;const u={createRadonTransferFunction:function(e,t,n,r,i){let o=null;return i?(o=i,o.removeAllPoints()):o=s.ZP.newInstance(),o.addPointLong(-1024,0,1,1),o.addPoint(e,t),o.addPoint(n,r),o}};const d={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:l.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:c.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,d,n),a.Z.extend(e,t,n),r.m.setGet(e,t,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),r.m.setGetArray(e,t,["ipScalarRange"],2),r.m.event(e,t,"lightingActivated"),function(e,t){t.classHierarchy.push("vtkVolumeMapper");const n={...e};e.getBounds=()=>{const n=e.getInputData();return n?(t.static||e.update(),t.bounds=n.getBounds()):t.bounds=(0,i.F)(),t.bounds},e.update=()=>{e.getInputData()},e.setBlendModeToComposite=()=>{e.setBlendMode(l.COMPOSITE_BLEND)},e.setBlendModeToMaximumIntensity=()=>{e.setBlendMode(l.MAXIMUM_INTENSITY_BLEND)},e.setBlendModeToMinimumIntensity=()=>{e.setBlendMode(l.MINIMUM_INTENSITY_BLEND)},e.setBlendModeToAverageIntensity=()=>{e.setBlendMode(l.AVERAGE_INTENSITY_BLEND)},e.setBlendModeToAdditiveIntensity=()=>{e.setBlendMode(l.ADDITIVE_INTENSITY_BLEND)},e.setBlendModeToRadonTransform=()=>{e.setBlendMode(l.RADON_TRANSFORM_BLEND)},e.getBlendModeAsString=()=>r.m.enumToString(l,t.blendMode),e.setAverageIPScalarRange=(t,n)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),e.setIpScalarRange(t,n)},e.getFilterModeAsString=()=>r.m.enumToString(c,t.filterMode),e.setFilterModeToOff=()=>{e.setFilterMode(c.OFF)},e.setFilterModeToNormalized=()=>{e.setFilterMode(c.NORMALIZED)},e.setFilterModeToRaw=()=>{e.setFilterMode(c.RAW)},e.setGlobalIlluminationReach=e=>n.setGlobalIlluminationReach((0,i.C)(e,0,1)),e.setVolumetricScatteringBlending=e=>n.setVolumetricScatteringBlending((0,i.C)(e,0,1)),e.setVolumeShadowSamplingDistFactor=e=>n.setVolumeShadowSamplingDistFactor(e>=1?e:1),e.setAnisotropy=e=>n.setAnisotropy((0,i.C)(e,-.99,.99)),e.setLAOKernelSize=e=>n.setLAOKernelSize((0,i.J)((0,i.C)(e,1,32))),e.setLAOKernelRadius=e=>n.setLAOKernelRadius(e>=1?e:1)}(e,t)}var h={newInstance:r.m.newInstance(p,"vtkVolumeMapper"),extend:p,...u}},83336:(e,t,n)=>{"use strict";n.d(t,{b:()=>r,default:()=>i});const r={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5};var i={BlendMode:r,FilterMode:{OFF:0,NORMALIZED:1,RAW:2}}},6123:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>p});var r=n(68470),i=n(5193),o=n(44031),a=n(54024);const{InterpolationType:s,OpacityMode:l}=a.default,{vtkErrorMacro:c}=r.m;const u={colorMixPreset:null,independentComponents:!0,interpolationType:s.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,u,n),r.m.obj(e,t),!t.componentData){t.componentData=[];for(let e=0;e<4;++e)t.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:l.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}r.m.setGet(e,t,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),r.m.setGetArray(e,t,["labelOutlineThickness"]),function(e,t){t.classHierarchy.push("vtkVolumeProperty"),e.getMTime=()=>{let e,n=t.mtime;for(let r=0;r<4;r++)1===t.componentData[r].colorChannels?t.componentData[r].grayTransferFunction&&(e=t.componentData[r].grayTransferFunction.getMTime(),n=n>e?n:e):3===t.componentData[r].colorChannels&&t.componentData[r].rGBTransferFunction&&(e=t.componentData[r].rGBTransferFunction.getMTime(),n=n>e?n:e),t.componentData[r].scalarOpacity&&(e=t.componentData[r].scalarOpacity.getMTime(),n=n>e?n:e),t.componentData[r].gradientOpacity&&(t.componentData[r].disableGradientOpacity||(e=t.componentData[r].gradientOpacity.getMTime(),n=n>e?n:e));return n},e.getColorChannels=e=>e<0||e>3?(c("Bad index - must be between 0 and 3"),0):t.componentData[e].colorChannels,e.setGrayTransferFunction=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!1;return t.componentData[n].grayTransferFunction!==r&&(t.componentData[n].grayTransferFunction=r,i=!0),1!==t.componentData[n].colorChannels&&(t.componentData[n].colorChannels=1,i=!0),i&&e.modified(),i},e.getGrayTransferFunction=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null===t.componentData[n].grayTransferFunction&&(t.componentData[n].grayTransferFunction=o.ZP.newInstance(),t.componentData[n].grayTransferFunction.addPoint(0,0),t.componentData[n].grayTransferFunction.addPoint(1024,1),1!==t.componentData[n].colorChannels&&(t.componentData[n].colorChannels=1),e.modified()),t.componentData[n].grayTransferFunction},e.setRGBTransferFunction=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!1;return t.componentData[n].rGBTransferFunction!==r&&(t.componentData[n].rGBTransferFunction=r,i=!0),3!==t.componentData[n].colorChannels&&(t.componentData[n].colorChannels=3,i=!0),i&&e.modified(),i},e.getRGBTransferFunction=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null===t.componentData[n].rGBTransferFunction&&(t.componentData[n].rGBTransferFunction=i.ZP.newInstance(),t.componentData[n].rGBTransferFunction.addRGBPoint(0,0,0,0),t.componentData[n].rGBTransferFunction.addRGBPoint(1024,1,1,1),3!==t.componentData[n].colorChannels&&(t.componentData[n].colorChannels=3),e.modified()),t.componentData[n].rGBTransferFunction},e.setScalarOpacity=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t.componentData[n].scalarOpacity!==r&&(t.componentData[n].scalarOpacity=r,e.modified(),!0)},e.getScalarOpacity=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null===t.componentData[n].scalarOpacity&&(t.componentData[n].scalarOpacity=o.ZP.newInstance(),t.componentData[n].scalarOpacity.addPoint(0,1),t.componentData[n].scalarOpacity.addPoint(1024,1),e.modified()),t.componentData[n].scalarOpacity},e.setComponentWeight=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(n<0||n>=4)return c("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return t.componentData[n].componentWeight!==i&&(t.componentData[n].componentWeight=i,e.modified(),!0)},e.getComponentWeight=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<0||e>=4?(c("Invalid index"),0):t.componentData[e].componentWeight},e.setInterpolationTypeToNearest=()=>e.setInterpolationType(s.NEAREST),e.setInterpolationTypeToLinear=()=>e.setInterpolationType(s.LINEAR),e.setInterpolationTypeToFastLinear=()=>e.setInterpolationType(s.FAST_LINEAR),e.getInterpolationTypeAsString=()=>r.m.enumToString(s,t.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(n=>{const i=r.m.capitalize(n);e[`set${i}`]=(r,i)=>t.componentData[r][`${n}`]!==i&&(t.componentData[r][`${n}`]=i,e.modified(),!0)}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(n=>{const i=r.m.capitalize(n);e[`get${i}`]=e=>t.componentData[e][`${n}`]})}(e,t)}var p={newInstance:r.m.newInstance(d,"vtkVolumeProperty"),extend:d,...a.default}},54024:(e,t,n)=>{"use strict";n.d(t,{Xk:()=>i,ZG:()=>r,default:()=>a,jw:()=>o});const r={NEAREST:0,LINEAR:1,FAST_LINEAR:2},i={FRACTIONAL:0,PROPORTIONAL:1},o={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var a={InterpolationType:r,OpacityMode:i,ColorMixPreset:o}},67739:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(72076),i=n(68470),o=n(6814),a=n(11145);const s={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),o.Z.extend(e,t,n),t.keyMatrixTime={},(0,i.o)(t.keyMatrixTime,{mtime:0}),t.keyMatrices={normalMatrix:r.wO.identity(new Float64Array(9)),mcwc:r._E.identity(new Float64Array(16))},(0,i.e)(e,t,["context"]),(0,i.g)(e,t,["activeTextures"]),function(e,t){t.classHierarchy.push("vtkOpenGLActor"),e.buildPass=n=>{if(n){t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t.context=t._openGLRenderWindow.getContext(),e.prepareNodes(),e.addMissingNodes(t.renderable.getTextures()),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes(),t.ogltextures=null,t.activeTextures=null;for(let e=0;e<t.children.length;e++){const n=t.children[e];n.isA("vtkOpenGLTexture")?(t.ogltextures||(t.ogltextures=[]),t.ogltextures.push(n)):t.oglmapper=n}}},e.traverseZBufferPass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.oglmapper.traverse(n),e.apply(n,!1))},e.traverseOpaqueZBufferPass=t=>e.traverseOpaquePass(t),e.traverseOpaquePass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.oglmapper.traverse(n),e.apply(n,!1))},e.traverseTranslucentPass=n=>{!t.renderable||!t.renderable.getNestedVisibility()||t.renderable.getIsOpaque()||t._openGLRenderer.getSelector()&&!t.renderable.getNestedPickable()||(e.apply(n,!0),t.oglmapper.traverse(n),e.apply(n,!1))},e.activateTextures=()=>{if(t.ogltextures){t.activeTextures=[];for(let e=0;e<t.ogltextures.length;e++){const n=t.ogltextures[e];n.render(),n.getHandle()&&t.activeTextures.push(n)}}},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;t.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},e.zBufferPass=(t,n)=>e.opaquePass(t,n),e.opaqueZBufferPass=(t,n)=>e.opaquePass(t,n),e.opaquePass=(n,r)=>{if(n)t.context.depthMask(!0),e.activateTextures();else if(t.activeTextures)for(let e=0;e<t.activeTextures.length;e++)t.activeTextures[e].deactivate()},e.translucentPass=(n,r)=>{if(n)t.context.depthMask(!1),e.activateTextures();else if(t.activeTextures)for(let e=0;e<t.activeTextures.length;e++)t.activeTextures[e].deactivate()},e.getKeyMatrices=()=>(t.renderable.getMTime()>t.keyMatrixTime.getMTime()&&(t.renderable.computeMatrix(),r._E.copy(t.keyMatrices.mcwc,t.renderable.getMatrix()),r._E.transpose(t.keyMatrices.mcwc,t.keyMatrices.mcwc),t.renderable.getIsIdentity()?r.wO.identity(t.keyMatrices.normalMatrix):(r.wO.fromMat4(t.keyMatrices.normalMatrix,t.keyMatrices.mcwc),r.wO.invert(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),r.wO.transpose(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix)),t.keyMatrixTime.modified()),t.keyMatrices)}(e,t)}const c=(0,i.n)(l);var u={newInstance:c,extend:l};(0,a.vw)("vtkActor",c)},40704:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var r=n(68470),i=n(6814),o=n(11145);const a={context:null,activeTextures:null};function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),i.Z.extend(e,t,n),(0,r.e)(e,t,["context"]),(0,r.g)(e,t,["activeTextures"]),function(e,t){t.classHierarchy.push("vtkOpenGLActor2D"),e.buildPass=n=>{if(n){if(!t.renderable)return;t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t.context=t._openGLRenderWindow.getContext(),e.prepareNodes(),e.addMissingNodes(t.renderable.getTextures()),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes(),t.ogltextures=null,t.activeTextures=null;for(let e=0;e<t.children.length;e++){const n=t.children[e];n.isA("vtkOpenGLTexture")?(t.ogltextures||(t.ogltextures=[]),t.ogltextures.push(n)):t.oglmapper=n}}},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;n.incrementOverlayActorCount()}},e.traverseOpaquePass=n=>{t.oglmapper&&t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.oglmapper.traverse(n),e.apply(n,!1))},e.traverseTranslucentPass=n=>{t.oglmapper&&t.renderable&&t.renderable.getNestedVisibility()&&!t.renderable.getIsOpaque()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.oglmapper.traverse(n),e.apply(n,!1))},e.traverseOverlayPass=n=>{t.oglmapper&&t.renderable&&t.renderable.getNestedVisibility()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable)&&(e.apply(n,!0),t.oglmapper.traverse(n),e.apply(n,!1))},e.activateTextures=()=>{if(t.ogltextures){t.activeTextures=[];for(let e=0;e<t.ogltextures.length;e++){const n=t.ogltextures[e];n.render(),n.getHandle()&&t.activeTextures.push(n)}}},e.opaquePass=(n,r)=>{if(n)t.context.depthMask(!0),e.activateTextures();else if(t.activeTextures)for(let e=0;e<t.activeTextures.length;e++)t.activeTextures[e].deactivate()},e.translucentPass=(n,r)=>{if(n)t.context.depthMask(!1),e.activateTextures();else if(t.activeTextures)for(let e=0;e<t.activeTextures.length;e++)t.activeTextures[e].deactivate()},e.overlayPass=(n,r)=>{if(n)t.context.depthMask(!0),e.activateTextures();else if(t.activeTextures)for(let e=0;e<t.activeTextures.length;e++)t.activeTextures[e].deactivate()}}(e,t)}const l=(0,r.n)(s);var c={newInstance:l,extend:s};(0,o.vw)("vtkActor2D",l)},88681:(e,t,n)=>{"use strict";n.d(t,{default:()=>l});var r=n(68470),i=n(37148);const{ObjectType:o}=i.default;const a={objectType:o.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),r.m.obj(e,t),r.m.get(e,t,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),r.m.moveToProtected(e,t,["openGLRenderWindow"]),function(e,t){function n(e){switch(e){case o.ELEMENT_ARRAY_BUFFER:return t.context.ELEMENT_ARRAY_BUFFER;case o.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in t.context)return t.context.TEXTURE_BUFFER;case o.ARRAY_BUFFER:default:return t.context.ARRAY_BUFFER}}t.classHierarchy.push("vtkOpenGLBufferObject");let r=null,i=null,a=!0,s="";e.getType=()=>r,e.setType=e=>{r=e},e.getHandle=()=>i,e.isReady=()=>!1===a,e.generateBuffer=e=>{const o=n(e);return null===i&&(i=t.context.createBuffer(),r=e),n(r)===o},e.upload=(o,l)=>e.generateBuffer(l)?(t.context.bindBuffer(n(r),i),t.context.bufferData(n(r),o,t.context.STATIC_DRAW),t.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,a=!1,!0):(s="Trying to upload array buffer to incompatible buffer.",!1),e.bind=()=>!!i&&(t.context.bindBuffer(n(r),i),!0),e.release=()=>!!i&&(t.context.bindBuffer(n(r),null),!0),e.releaseGraphicsResources=()=>{null!==i&&(t.context.bindBuffer(n(r),null),t.context.deleteBuffer(i),i=null,t.allocatedGPUMemoryInBytes=0)},e.setOpenGLRenderWindow=n=>{t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))},e.getError=()=>s}(e,t)}var l={newInstance:r.m.newInstance(s),extend:s,...i.default}},37148:(e,t,n)=>{"use strict";n.d(t,{L:()=>r,default:()=>i});const r={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var i={ObjectType:r}},34349:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(72076),i=n(68470),o=n(6814),a=n(11145);const s={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),o.Z.extend(e,t,n),t.keyMatrixTime={},(0,i.o)(t.keyMatrixTime),t.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},(0,i.e)(e,t,["context","keyMatrixTime"]),function(e,t){t.classHierarchy.push("vtkOpenGLCamera"),e.buildPass=n=>{n&&(t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.context=t._openGLRenderWindow.getContext())},e.opaquePass=e=>{if(e){const e=t._openGLRenderer.getTiledSizeAndOrigin();t.context.viewport(e.lowerLeftU,e.lowerLeftV,e.usize,e.vsize),t.context.scissor(e.lowerLeftU,e.lowerLeftV,e.usize,e.vsize)}},e.translucentPass=e.opaquePass,e.zBufferPass=e.opaquePass,e.opaqueZBufferPass=e.opaquePass,e.volumePass=e.opaquePass,e.getKeyMatrices=n=>{if(n!==t.lastRenderer||t._openGLRenderWindow.getMTime()>t.keyMatrixTime.getMTime()||e.getMTime()>t.keyMatrixTime.getMTime()||n.getMTime()>t.keyMatrixTime.getMTime()||t.renderable.getMTime()>t.keyMatrixTime.getMTime()){r._E.copy(t.keyMatrices.wcvc,t.renderable.getViewMatrix()),r.wO.fromMat4(t.keyMatrices.normalMatrix,t.keyMatrices.wcvc),r.wO.invert(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),r._E.transpose(t.keyMatrices.wcvc,t.keyMatrices.wcvc);const e=t._openGLRenderer.getAspectRatio();r._E.copy(t.keyMatrices.vcpc,t.renderable.getProjectionMatrix(e,-1,1)),r._E.transpose(t.keyMatrices.vcpc,t.keyMatrices.vcpc),r._E.multiply(t.keyMatrices.wcpc,t.keyMatrices.vcpc,t.keyMatrices.wcvc),t.keyMatrixTime.modified(),t.lastRenderer=n}return t.keyMatrices}}(e,t)}const c=(0,i.n)(l);var u={newInstance:c,extend:l};(0,a.vw)("vtkCamera",c)},93245:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var r=n(68470),i=n(41247),o=n(89262),a=n(87730);const s={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),(0,r.o)(e,t),t.colorBuffers&&(0,r.r)("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),t.colorBuffers=[],(0,r.k)(e,t,["colorBuffers"]),function(e,t){t.classHierarchy.push("vtkFramebuffer"),e.getBothMode=()=>t.context.FRAMEBUFFER,e.saveCurrentBindingsAndBuffers=t=>{const n=void 0!==t?t:e.getBothMode();e.saveCurrentBindings(n),e.saveCurrentBuffers(n)},e.saveCurrentBindings=e=>{if(!t.context)return void(0,r.r)("you must set the OpenGLRenderWindow before calling saveCurrentBindings");const n=t.context;t.previousDrawBinding=n.getParameter(t.context.FRAMEBUFFER_BINDING),t.previousActiveFramebuffer=t._openGLRenderWindow.getActiveFramebuffer()},e.saveCurrentBuffers=e=>{},e.restorePreviousBindingsAndBuffers=t=>{const n=void 0!==t?t:e.getBothMode();e.restorePreviousBindings(n),e.restorePreviousBuffers(n)},e.restorePreviousBindings=e=>{if(!t.context)return void(0,r.r)("you must set the OpenGLRenderWindow before calling restorePreviousBindings");const n=t.context;n.bindFramebuffer(n.FRAMEBUFFER,t.previousDrawBinding),t._openGLRenderWindow.setActiveFramebuffer(t.previousActiveFramebuffer)},e.restorePreviousBuffers=e=>{},e.bind=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===n&&(n=t.context.FRAMEBUFFER),t.context.bindFramebuffer(n,t.glFramebuffer);for(let e=0;e<t.colorBuffers.length;e++)t.colorBuffers[e].bind();t._openGLRenderWindow.setActiveFramebuffer(e)},e.create=(e,n)=>{t.context?(t.glFramebuffer=t.context.createFramebuffer(),t.glFramebuffer.width=e,t.glFramebuffer.height=n):(0,r.r)("you must set the OpenGLRenderWindow before calling create")},e.setColorBuffer=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=t.context;if(!i)return void(0,r.r)("you must set the OpenGLRenderWindow before calling setColorBuffer");let o=i.COLOR_ATTACHMENT0;if(n>0){if(!t._openGLRenderWindow.getWebgl2())return void(0,r.r)("Using multiple framebuffer attachments requires WebGL 2");o+=n}t.colorBuffers[n]=e,i.framebufferTexture2D(i.FRAMEBUFFER,o,i.TEXTURE_2D,e.getHandle(),0)},e.removeColorBuffer=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const n=t.context;if(!n)return void(0,r.r)("you must set the OpenGLRenderWindow before calling removeColorBuffer");let i=n.COLOR_ATTACHMENT0;if(e>0){if(!t._openGLRenderWindow.getWebgl2())return void(0,r.r)("Using multiple framebuffer attachments requires WebGL 2");i+=e}n.framebufferTexture2D(n.FRAMEBUFFER,i,n.TEXTURE_2D,null,0),t.colorBuffers=t.colorBuffers.splice(e,1)},e.setDepthBuffer=e=>{if(t.context)if(t._openGLRenderWindow.getWebgl2()){const n=t.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,e.getHandle(),0)}else(0,r.r)("Attaching depth buffer textures to fbo requires WebGL 2");else(0,r.r)("you must set the OpenGLRenderWindow before calling setDepthBuffer")},e.removeDepthBuffer=()=>{if(t.context)if(t._openGLRenderWindow.getWebgl2()){const e=t.context;e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,null,0)}else(0,r.r)("Attaching depth buffer textures to framebuffers requires WebGL 2");else(0,r.r)("you must set the OpenGLRenderWindow before calling removeDepthBuffer")},e.getGLFramebuffer=()=>t.glFramebuffer,e.setOpenGLRenderWindow=n=>{t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))},e.releaseGraphicsResources=()=>{t.glFramebuffer&&t.context.deleteFramebuffer(t.glFramebuffer)},e.getSize=()=>null==t.glFramebuffer?null:[t.glFramebuffer.width,t.glFramebuffer.height],e.populateFramebuffer=()=>{if(!t.context)return void(0,r.r)("you must set the OpenGLRenderWindow before calling populateFrameBuffer");e.bind();const n=t.context,s=i.default.newInstance();s.setOpenGLRenderWindow(t._openGLRenderWindow),s.setMinificationFilter(a.w.LINEAR),s.setMagnificationFilter(a.w.LINEAR),s.create2DFromRaw(t.glFramebuffer.width,t.glFramebuffer.height,4,o.Tu.UNSIGNED_CHAR,null),e.setColorBuffer(s),t.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,t.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t.glFramebuffer.width,t.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t.depthTexture)},e.getColorTexture=()=>t.colorBuffers[0]}(e,t)}var c={newInstance:(0,r.n)(l,"vtkFramebuffer"),extend:l}},18603:(e,t,n)=>{"use strict";n.d(t,{X:()=>r,default:()=>i});const r={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var i={PassTypes:r}},59269:(e,t,n)=>{"use strict";n.d(t,{default:()=>y});var r=n(68470),i=n(72076),o=n(88681),a=n(37148),s=n(42695);const{vtkErrorMacro:l}=r.m;function c(e,t){t.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),e.setType(a.L.ARRAY_BUFFER),e.createVBO=function(n,r,i,l){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!n.getData()||!n.getData().length)return t.elementCount=0,0;t.blockSize=3,t.vertexOffset=0,t.normalOffset=0,t.tCoordOffset=0,t.tCoordComponents=0,t.colorComponents=0,t.colorOffset=0,t.customData=[];const u=l.points.getData();let d=null,p=null,h=null;const f=l.colors?l.colors.getNumberOfComponents():0,m=l.tcoords?l.tcoords.getNumberOfComponents():0;l.normals&&(t.normalOffset=4*t.blockSize,t.blockSize+=3,d=l.normals.getData()),l.customAttributes&&l.customAttributes.forEach(e=>{e&&(t.customData.push({data:e.getData(),offset:4*t.blockSize,components:e.getNumberOfComponents(),name:e.getName()}),t.blockSize+=e.getNumberOfComponents())}),l.tcoords&&(t.tCoordOffset=4*t.blockSize,t.tCoordComponents=m,t.blockSize+=m,p=l.tcoords.getData()),l.colors?(t.colorComponents=l.colors.getNumberOfComponents(),t.colorOffset=0,h=l.colors.getData(),t.colorBO||(t.colorBO=o.default.newInstance()),t.colorBO.setOpenGLRenderWindow(t._openGLRenderWindow)):t.colorBO=null,t.stride=4*t.blockSize;let g,v=0,y=0,b=0,C=0,w=0,E=0;const T={anythingToPoints(e,t,n){for(let r=0;r<e;++r)g(t[n+r])},linesToWireframe(e,t,n){for(let r=0;r<e-1;++r)g(t[n+r]),g(t[n+r+1])},polysToWireframe(e,t,n){if(e>2)for(let r=0;r<e;++r)g(t[n+r]),g(t[n+(r+1)%e])},stripsToWireframe(e,t,n){if(e>2){for(let r=0;r<e-1;++r)g(t[n+r]),g(t[n+r+1]);for(let r=0;r<e-2;r++)g(t[n+r]),g(t[n+r+2])}},polysToSurface(e,t,n){for(let r=0;r<e-2;r++)g(t[n+0]),g(t[n+r+1]),g(t[n+r+2])},stripsToSurface(e,t,n){for(let r=0;r<e-2;r++)g(t[n+r]),g(t[n+r+1+r%2]),g(t[n+r+1+(r+1)%2])}},x={anythingToPoints:(e,t)=>e,linesToWireframe:(e,t)=>e>1?2*(e-1):0,polysToWireframe:(e,t)=>e>2?2*e:0,stripsToWireframe:(e,t)=>e>2?4*e-6:0,polysToSurface:(e,t)=>e>2?3*(e-2):0,stripsToSurface:(e,t,n)=>e>2?3*(e-2):0};let _=null,S=null;i===s.hX.POINTS||"verts"===r?(_=T.anythingToPoints,S=x.anythingToPoints):i===s.hX.WIREFRAME||"lines"===r?(_=T[`${r}ToWireframe`],S=x[`${r}ToWireframe`]):(_=T[`${r}ToSurface`],S=x[`${r}ToSurface`]);const I=n.getData(),D=I.length;let A=0;for(let e=0;e<D;)A+=S(I[e],I),e+=I[e]+1;let P=null;const O=new Float32Array(A*t.blockSize);h&&(P=new Uint8Array(4*A));let R=0,M=0,N=0,L=0;for(let e=0;e<3;++e){const t=l.points.getRange(e),n=t[1]-t[0];N+=n*n;const r=.5*(t[1]+t[0]);L+=r*r}if(N>0&&(Math.abs(L)/N>1e6||Math.abs(Math.log10(N))>3||0===N&&L>1e6)){const t=new Float64Array(3),n=new Float64Array(3);for(let e=0;e<3;++e){const r=l.points.getRange(e),i=r[1]-r[0];t[e]=.5*(r[1]+r[0]),n[e]=i>0?1/i:1}e.setCoordShiftAndScale(t,n)}else!0===t.coordShiftAndScaleEnabled&&e.setCoordShiftAndScale(null,null);if(c)if(c.points||c.cells){const e=new Int32Array(A+c.points.length);e.set(c.points),c.points=e;const t=new Int32Array(A+c.cells.length);t.set(c.cells),c.cells=t}else c.points=new Int32Array(A),c.cells=new Int32Array(A);let k=l.vertexOffset;g=function(e){if(c&&(c.points[k]=e,c.cells[k]=E+l.cellOffset),++k,v=3*e,t.coordShiftAndScaleEnabled?(O[R++]=(u[v++]-t.coordShift[0])*t.coordScale[0],O[R++]=(u[v++]-t.coordShift[1])*t.coordScale[1],O[R++]=(u[v++]-t.coordShift[2])*t.coordScale[2]):(O[R++]=u[v++],O[R++]=u[v++],O[R++]=u[v++]),null!==d&&(y=l.haveCellNormals?3*(E+l.cellOffset):3*e,O[R++]=d[y++],O[R++]=d[y++],O[R++]=d[y++]),t.customData.forEach(t=>{w=e*t.components;for(let e=0;e<t.components;++e)O[R++]=t.data[w++]}),null!==p){b=e*m;for(let e=0;e<m;++e)O[R++]=p[b++]}null!==h&&(C=l.haveCellScalars?(E+l.cellOffset)*f:e*f,P[M++]=h[C++],P[M++]=h[C++],P[M++]=h[C++],P[M++]=4===f?h[C++]:255)};for(let e=0;e<D;)_(I[e],I,e+1),e+=I[e]+1,E++;return t.elementCount=A,e.upload(O,a.L.ARRAY_BUFFER),t.colorBO&&(t.colorBOStride=4,t.colorBO.upload(P,a.L.ARRAY_BUFFER)),E},e.setCoordShiftAndScale=(e,n)=>{null===e||e.constructor===Float64Array&&3===e.length?null===n||n.constructor===Float64Array&&3===n.length?(null!==t.coordShift&&null!==e&&i.R3.equals(e,t.coordShift)||(t.coordShift=e),null!==t.coordScale&&null!==n&&i.R3.equals(n,t.coordScale)||(t.coordScale=n),t.coordShiftAndScaleEnabled=function(e,t){return null!==e&&null!==t&&!(i.R3.exactEquals(e,[0,0,0])&&i.R3.exactEquals(t,[1,1,1]))}(t.coordShift,t.coordScale),t.coordShiftAndScaleEnabled?t.inverseShiftAndScaleMatrix=function(e,t){const n=new Float64Array(3);i.R3.inverse(n,t);const r=new Float64Array(16);return i._E.fromRotationTranslationScale(r,i.gf.create(),e,n),r}(t.coordShift,t.coordScale):t.inverseShiftAndScaleMatrix=null):l("Wrong type for coordScale, expected vec3 or null"):l("Wrong type for coordShift, expected vec3 or null")}}const u={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,u,n),o.default.extend(e,t,n),r.m.setGet(e,t,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),r.m.get(e,t,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),c(e,t)}var p={newInstance:r.m.newInstance(d),extend:d},h=n(53118),f=n(62739);const m={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};const g={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,g,n),r.m.obj(e,t),t.shaderSourceTime={},r.m.obj(t.shaderSourceTime),t.attributeUpdateTime={},r.m.obj(t.attributeUpdateTime),r.m.setGet(e,t,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),t.program=h.Z.newInstance(),t.VAO=f.ZP.newInstance(),t.CABO=p.newInstance(),function(e,t){t.classHierarchy.push("vtkOpenGLHelper"),e.setOpenGLRenderWindow=e=>{t.context=e.getContext(),t.program.setContext(t.context),t.VAO.setOpenGLRenderWindow(e),t.CABO.setOpenGLRenderWindow(e)},e.releaseGraphicsResources=e=>{t.VAO.releaseGraphicsResources(),t.CABO.releaseGraphicsResources(),t.CABO.setElementCount(0)},e.drawArrays=(n,r,i,o)=>{if(t.CABO.getElementCount()){const a=e.getOpenGLMode(i),s=e.haveWideLines(n,r),l=t.context,c=l.getParameter(l.DEPTH_WRITEMASK);t.pointPicking&&l.depthMask(!1),a===l.LINES&&s?(e.updateShaders(n,r,o),l.drawArraysInstanced(a,0,t.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(l.lineWidth(r.getProperty().getLineWidth()),e.updateShaders(n,r,o),l.drawArrays(a,0,t.CABO.getElementCount()),l.lineWidth(1));const u=(a===l.POINTS?1:0)||(a===l.LINES?2:3);return t.pointPicking&&l.depthMask(c),t.CABO.getElementCount()/u}return 0},e.getOpenGLMode=e=>{if(t.pointPicking)return t.context.POINTS;const n=t.primitiveType;return e===s.hX.POINTS||n===m.Points?t.context.POINTS:e===s.hX.WIREFRAME||n===m.Lines||n===m.TrisEdges||n===m.TriStripsEdges?t.context.LINES:t.context.TRIANGLES},e.haveWideLines=(e,n)=>n.getProperty().getLineWidth()>1&&!(t.CABO.getOpenGLRenderWindow()&&t.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()),e.getNeedToRebuildShaders=(t,n,r)=>!!(r.getNeedToRebuildShaders(e,t,n)||0===e.getProgram()||e.getShaderSourceTime().getMTime()<r.getMTime()||e.getShaderSourceTime().getMTime()<n.getMTime()),e.updateShaders=(n,r,i)=>{if(e.getNeedToRebuildShaders(n,r,i)){const o={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(o,n,r);const a=t.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==e.getProgram()&&(e.setProgram(a),e.getVAO().releaseGraphicsResources()),e.getShaderSourceTime().modified()}else t.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(e.getProgram());e.getVAO().bind(),i.setMapperShaderParameters(e,n,r),i.setPropertyShaderParameters(e,n,r),i.setCameraShaderParameters(e,n,r),i.setLightingShaderParameters(e,n,r),i.invokeShaderCallbacks(e,n,r)},e.setMapperShaderParameters=(n,r,i)=>{if(e.haveWideLines(n,r)){e.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const t=parseFloat(r.getProperty().getLineWidth()),n=t/2;e.getProgram().setUniformf("lineWidthStepSize",t/Math.ceil(t)),e.getProgram().setUniformf("halfLineWidth",n)}t.primitiveType===m.Points||r.getProperty().getRepresentation()===s.hX.POINTS?e.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):t.pointPicking&&e.getProgram().setUniformf("pointSize",e.getPointPickingPrimitiveSize())},e.replaceShaderPositionVC=(n,r,i)=>{let o=n.Vertex;o=h.Z.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,o=h.Z.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,e.getOpenGLMode(i.getProperty().getRepresentation())===t.context.LINES&&e.haveWideLines(r,i)&&(o=h.Z.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,o=h.Z.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=o},e.getPointPickingPrimitiveSize=()=>t.primitiveType===m.Points?2:t.primitiveType===m.Lines?4:6,e.getAllocatedGPUMemoryInBytes=()=>e.getCABO().getAllocatedGPUMemoryInBytes()}(e,t)}var y={newInstance:r.m.newInstance(v),extend:v,primTypes:m}},80129:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>I});var r=n(72076),i=n(72795),o=n(68470),a=n(54131),s=n(89262),l=n(59269),c=n(59474),u=n(41247),d=n(53118),p=n(6814),h=n(42695),f=n(87730),m=n(39648),g=n(81270),v=n(25460),y=n(51815),b=n(11145);const{vtkErrorMacro:C}=o.c,{SlicingMode:w}=i.default;function E(e,t,n){if(t){const r=e.getIndependentComponents();return`${t.getMTime()}-${r}-${n}`}return"0"}function T(e){const t=e.split("\n"),n=[];for(let e=0;e<t.length;++e){const r=t[e].trim();r.length>0&&n.push(r)}return n}const x={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,_scalars:null};function _(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,x,n),p.Z.extend(e,t,n),y.Z.implementReplaceShaderCoincidentOffset(e,t,n),y.Z.implementBuildShadersWithReplacements(e,t,n),t.tris=l.default.newInstance(),t.imagemat=r._E.identity(new Float64Array(16)),t.imagematinv=r._E.identity(new Float64Array(16)),t.projectionToWorld=r._E.identity(new Float64Array(16)),t.idxToView=r._E.identity(new Float64Array(16)),t.idxNormalMatrix=r.wO.identity(new Float64Array(9)),t.modelToView=r._E.identity(new Float64Array(16)),t.projectionToView=r._E.identity(new Float64Array(16)),(0,o.e)(e,t,[]),t.VBOBuildTime={},(0,o.o)(t.VBOBuildTime),function(e,t){t.classHierarchy.push("vtkOpenGLImageMapper"),e.buildPass=n=>{if(n){t.currentRenderPass=null,t.openGLImageSlice=e.getFirstAncestorOfType("vtkOpenGLImageSlice"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.context=t._openGLRenderWindow.getContext(),t.tris.setOpenGLRenderWindow(t._openGLRenderWindow);const n=t._openGLRenderer.getRenderable();t.openGLCamera=t._openGLRenderer.getViewNodeFor(n.getActiveCamera()),t.renderable.isA("vtkImageMapper")&&t.renderable.getSliceAtFocalPoint()&&t.renderable.setSliceFromCamera(n.getActiveCamera())}},e.translucentPass=(n,r)=>{n&&(t.currentRenderPass=r,e.render())},e.zBufferPass=n=>{n&&(t.haveSeenDepthRequest=!0,t.renderDepth=!0,e.render(),t.renderDepth=!1)},e.opaqueZBufferPass=t=>e.zBufferPass(t),e.opaquePass=t=>{t&&e.render()},e.getCoincidentParameters=(e,n)=>t.renderable.getResolveCoincidentTopology()?t.renderable.getCoincidentTopologyPolygonOffsetParameters():null,e.render=()=>{const n=t.openGLImageSlice.getRenderable(),r=t._openGLRenderer.getRenderable();e.renderPiece(r,n)},e.getShaderTemplate=(e,t,n)=>{e.Vertex=g.v,e.Fragment=v.v,e.Geometry=""},e.replaceShaderValues=(n,r,i)=>{let o=n.Vertex,a=n.Fragment;o=d.Z.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=d.Z.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,o=d.Z.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,o=d.Z.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const s=t.openGLTexture.getComponents(),l=i.getProperty().getIndependentComponents();let c=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(l){for(let e=1;e<s;e++)c=c.concat([`uniform float cshift${e};`,`uniform float cscale${e};`,`uniform float pwfshift${e};`,`uniform float pwfscale${e};`]);switch(s){case 1:c=c.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:c=c.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:c=c.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:C("Unsupported number of independent coordinates.")}}if(a=d.Z.substitute(a,"//VTK::TCoord::Dec",c).result,!0===i.getProperty().getUseLabelOutline()&&(a=d.Z.substitute(a,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;"]).result,a=d.Z.substitute(a,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,a=d.Z.substitute(a,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","#endif"]).result),l){const e=["r","g","b","a"];let t=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let n=0;n<s;n++)t=t.concat([`vec3 tcolor${n} = mix${n} * texture2D(colorTexture1, vec2(tvalue.${e[n]} * cscale${n} + cshift${n}, height${n})).rgb;`,`float compWeight${n} = mix${n} * texture2D(pwfTexture1, vec2(tvalue.${e[n]} * pwfscale${n} + pwfshift${n}, height${n})).r;`]);switch(s){case 1:t=t.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:t=t.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:t=t.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:t=t.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:C("Unsupported number of independent coordinates.")}a=d.Z.substitute(a,"//VTK::TCoord::Impl",t).result}else switch(s){case 1:a=d.Z.substitute(a,"//VTK::TCoord::Impl",[...T("\n                #ifdef vtkImageLabelOutlineOn\n                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); \n                  float centerValue = texture2D(texture1, centerPosIS.xy).r;\n                  bool pixelOnBorder = false;\n                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;\n                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;\n                  float opacityToUse = scalarOpacity * opacity;\n                  int segmentIndex = int(centerValue * 255.0);\n                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;\n                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;\n                  int actualThickness = int(textureValue * 255.0);\n\n                  if (segmentIndex == 0){\n                    gl_FragData[0] = vec4(0.0, 1.0, 1.0, 0.0);\n                    return;\n                  }\n\n                  for (int i = -actualThickness; i <= actualThickness; i++) {\n                    for (int j = -actualThickness; j <= actualThickness; j++) {\n                      if (i == 0 || j == 0) {\n                        continue;\n                      }\n                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),\n                        gl_FragCoord.y + float(j),\n                        gl_FragCoord.z, gl_FragCoord.w);\n                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);\n                      float value = texture2D(texture1, neighborPosIS.xy).r;\n                      if (value != centerValue) {\n                        pixelOnBorder = true;\n                        break;\n                      }\n                    }\n                    if (pixelOnBorder == true) {\n                      break;\n                    }\n                  }\n                  if (pixelOnBorder == true) {\n                    gl_FragData[0] = vec4(tColor, outlineOpacity);\n                  }\n                  else {\n                    gl_FragData[0] = vec4(tColor, opacityToUse);\n                  }\n                #else\n                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;\n                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;\n                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;\n                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);\n                #endif\n                ")]).result;break;case 2:a=d.Z.substitute(a,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:a=d.Z.substitute(a,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:a=d.Z.substitute(a,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}t.haveSeenDepthRequest&&(a=d.Z.substitute(a,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,a=d.Z.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=o,n.Fragment=a,e.replaceShaderClip(n,r,i),e.replaceShaderCoincidentOffset(n,r,i)},e.replaceShaderClip=(e,n,r)=>{let i=e.Vertex,a=e.Fragment;if(t.renderable.getNumberOfClippingPlanes()){let e=t.renderable.getNumberOfClippingPlanes();e>6&&((0,o.r)("OpenGL has a limit of 6 clipping planes"),e=6),i=d.Z.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,i=d.Z.substitute(i,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,a=d.Z.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,a=d.Z.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}e.Vertex=i,e.Fragment=a},e.getNeedToRebuildShaders=(e,n,r)=>{const i=t.openGLTexture.getComponents(),o=r.getProperty().getIndependentComponents();let a=!1;return(!t.currentRenderPass&&t.lastRenderPassShaderReplacement||t.currentRenderPass&&t.currentRenderPass.getShaderReplacement()!==t.lastRenderPassShaderReplacement)&&(a=!0),!(!a&&t.lastHaveSeenDepthRequest===t.haveSeenDepthRequest&&0!==e.getProgram()?.getHandle()&&t.lastTextureComponents===i&&t.lastIndependentComponents===o||(t.lastHaveSeenDepthRequest=t.haveSeenDepthRequest,t.lastTextureComponents=i,t.lastIndependentComponents=o,0))},e.updateShaders=(n,r,i)=>{if(t.lastBoundBO=n,e.getNeedToRebuildShaders(n,r,i)){const o={Vertex:null,Fragment:null,Geometry:null};e.buildShaders(o,r,i);const a=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==n.getProgram()&&(n.setProgram(a),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),e.setMapperShaderParameters(n,r,i),e.setCameraShaderParameters(n,r,i),e.setPropertyShaderParameters(n,r,i)},e.setMapperShaderParameters=(n,i,a)=>{n.getCABO().getElementCount()&&(t.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||C("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),t.context.FLOAT,n.getCABO().getTCoordComponents(),t.context.FALSE)||C("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());const s=t.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",s);const l=t.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents();if(c)for(let e=0;e<l;e++)n.getProgram().setUniformf(`mix${e}`,a.getProperty().getComponentWeight(e));const u=t.openGLTexture.getShiftAndScale();for(let e=0;e<l;e++){let t=a.getProperty().getColorWindow(),r=a.getProperty().getColorLevel();const i=c?e:0,o=a.getProperty().getRGBTransferFunction(i);if(o&&a.getProperty().getUseLookupTableScalarRange()){const e=o.getRange();t=e[1]-e[0],r=.5*(e[1]+e[0])}const s=u.scale/t,l=(u.shift-r)/t+.5;n.getProgram().setUniformf(`cshift${e}`,l),n.getProgram().setUniformf(`cscale${e}`,s)}for(let e=0;e<l;e++){let t=1,r=0;const i=c?e:0,o=a.getProperty().getPiecewiseFunction(i);if(o){const e=o.getRange(),n=e[1]-e[0],i=.5*(e[0]+e[1]);t=u.scale/n,r=(u.shift-i)/n+.5}n.getProgram().setUniformf(`pwfshift${e}`,r),n.getProgram().setUniformf(`pwfscale${e}`,t)}if(t.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",t.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const t=e.getCoincidentParameters(i,a);n.getProgram().setUniformf("coffset",t.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",t.factor)}const d=t.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",d);const p=t.pwfTexture.getTextureUnit();n.getProgram().setUniformi("pwfTexture1",p);const h=t.labelOutlineThicknessTexture.getTextureUnit();if(n.getProgram().setUniformi("labelOutlineTexture1",h),t.renderable.getNumberOfClippingPlanes()){let e=t.renderable.getNumberOfClippingPlanes();e>6&&((0,o.r)("OpenGL has a limit of 6 clipping planes"),e=6);const i=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,s=i?r._E.copy(t.imagematinv,a.getMatrix()):a.getMatrix();i&&(r._E.transpose(s,s),r._E.multiply(s,s,i),r._E.transpose(s,s)),r._E.transpose(t.imagemat,t.currentInput.getIndexToWorld()),r._E.multiply(t.imagematinv,s,t.imagemat);const l=[];for(let n=0;n<e;n++){const e=[];t.renderable.getClippingPlaneInDataCoords(t.imagematinv,n,e);for(let t=0;t<4;t++)l.push(e[t])}n.getProgram().setUniformi("numClipPlanes",e),n.getProgram().setUniform4fv("clipPlanes",l)}if(!0===a.getProperty().getUseLabelOutline()){const e=a.getProperty().getLabelOutlineOpacity();n.getProgram().setUniformf("outlineOpacity",e)}},e.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=t.openGLImageSlice.getKeyMatrices(),l=t.currentInput,c=l.getIndexToWorld();r._E.multiply(t.imagemat,s.mcwc,c);const u=t.openGLCamera.getKeyMatrices(i);if(r._E.multiply(t.imagemat,u.wcpc,t.imagemat),n.getCABO().getCoordShiftAndScaleEnabled()){const e=n.getCABO().getInverseShiftAndScaleMatrix();r._E.multiply(t.imagemat,t.imagemat,e)}if(a.setUniformMatrix("MCPCMatrix",t.imagemat),!0===o.getProperty().getUseLabelOutline()){const n=l.getWorldToIndex(),o=l.getDimensions();a.setUniform3i("imageDimensions",o[0],o[1],1),a.setUniformMatrix("vWCtoIDX",n);const s=t.openGLCamera.getKeyMatrices(i);r._E.invert(t.projectionToWorld,s.wcpc),t.openGLCamera.getKeyMatrices(i),a.setUniformMatrix("PCWCMatrix",t.projectionToWorld);const c=e.getRenderTargetSize();a.setUniformf("vpWidth",c[0]),a.setUniformf("vpHeight",c[1]);const u=e.getRenderTargetOffset();a.setUniformf("vpOffsetX",u[0]/c[0]),a.setUniformf("vpOffsetY",u[1]/c[1])}},e.setPropertyShaderParameters=(e,t,n)=>{const r=e.getProgram(),i=n.getProperty().getOpacity();r.setUniformf("opacity",i)},e.renderPieceStart=(n,r)=>{e.updateBufferObjects(n,r),t.lastBoundBO=null},e.renderPieceDraw=(n,r)=>{const i=t.context;t.openGLTexture.activate(),t.colorTexture.activate(),t.labelOutlineThicknessTexture.activate(),t.pwfTexture.activate(),t.tris.getCABO().getElementCount()&&(e.updateShaders(t.tris,n,r),i.drawArrays(i.TRIANGLES,0,t.tris.getCABO().getElementCount()),t.tris.getVAO().release()),t.openGLTexture.deactivate(),t.colorTexture.deactivate(),t.labelOutlineThicknessTexture.deactivate(),t.pwfTexture.deactivate()},e.renderPieceFinish=(e,t)=>{},e.renderPiece=(n,r)=>{e.invokeEvent({type:"StartEvent"}),t.renderable.update(),t.currentInput=t.renderable.getCurrentImage(),e.invokeEvent({type:"EndEvent"}),t.currentInput?(e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r)):C("No input!")},e.computeBounds=(n,r)=>{e.getInput()?t.bounds=e.getInput().getBounds():(0,c.u)(t.bounds)},e.updateBufferObjects=(t,n)=>{e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=(n,r)=>t.VBOBuildTime.getMTime()<e.getMTime()||t.VBOBuildTime.getMTime()<r.getMTime()||t.VBOBuildTime.getMTime()<t.renderable.getMTime()||t.VBOBuildTime.getMTime()<r.getProperty().getMTime()||t.VBOBuildTime.getMTime()<t.currentInput.getMTime(),e.buildBufferObjects=(n,r)=>{const i=t.currentInput;if(!i)return;const o=i.getPointData()&&i.getPointData().getScalars();if(!o)return;const l=o.getDataType(),c=o.getNumberOfComponents(),d=r.getProperty(),p=d.getInterpolationType(),g=d.getIndependentComponents(),v=g?c:1,y=g?2*v:1,b=d.getRGBTransferFunction(),T=E(d,b,v),x=t._openGLRenderWindow.getGraphicsResourceForObject(b);if(x?.vtkObj&&x?.hash===T&&t.colorTextureString===T)t.colorTexture=x.vtkObj,t.colorTextureString=x.hash;else{const e=1024,n=new Uint8ClampedArray(e*y*3);if(t.colorTexture||(t.colorTexture=u.default.newInstance({resizable:!0}),t.colorTexture.setOpenGLRenderWindow(t._openGLRenderWindow)),p===m.Z.NEAREST?(t.colorTexture.setMinificationFilter(f.w.NEAREST),t.colorTexture.setMagnificationFilter(f.w.NEAREST)):(t.colorTexture.setMinificationFilter(f.w.LINEAR),t.colorTexture.setMagnificationFilter(f.w.LINEAR)),b){const r=new Float32Array(3*e);for(let t=0;t<v;t++){const i=d.getRGBTransferFunction(t),o=i.getRange();if(i.getTable(o[0],o[1],e,r,1),g)for(let i=0;i<3*e;i++)n[t*e*6+i]=255*r[i],n[t*e*6+i+3*e]=255*r[i];else for(let i=0;i<3*e;i++)n[t*e*6+i]=255*r[i]}t.colorTexture.releaseGraphicsResources(t._openGLRenderWindow),t.colorTexture.resetFormatAndType(),t.colorTexture.create2DFromRaw(e,y,3,s.Tu.UNSIGNED_CHAR,n)}else{for(let t=0;t<3*e;++t)n[t]=255*t/(3*(e-1)),n[t+1]=255*t/(3*(e-1)),n[t+2]=255*t/(3*(e-1));t.colorTexture.create2DFromRaw(e,1,3,s.Tu.UNSIGNED_CHAR,n)}t.colorTextureString=T,b&&t._openGLRenderWindow.setGraphicsResourceForObject(b,t.colorTexture,t.colorTextureString)}const _=d.getPiecewiseFunction(),S=E(d,_,v),I=t._openGLRenderWindow.getGraphicsResourceForObject(_);if(I?.vtkObj&&I?.hash===S&&t.pwfTextureString===S)t.pwfTexture=I.vtkObj,t.pwfTextureString=I.hash;else{const e=1024,n=e*y,r=new Uint8ClampedArray(n);if(t.pwfTexture||(t.pwfTexture=u.default.newInstance({resizable:!0}),t.pwfTexture.setOpenGLRenderWindow(t._openGLRenderWindow)),p===m.Z.NEAREST?(t.pwfTexture.setMinificationFilter(f.w.NEAREST),t.pwfTexture.setMagnificationFilter(f.w.NEAREST)):(t.pwfTexture.setMinificationFilter(f.w.LINEAR),t.pwfTexture.setMagnificationFilter(f.w.LINEAR)),_){const r=new Float32Array(n),i=new Float32Array(e);for(let t=0;t<v;++t){const n=d.getPiecewiseFunction(t);if(null===n)r.fill(1);else{const o=n.getRange();if(n.getTable(o[0],o[1],e,i,1),g)for(let n=0;n<e;n++)r[t*e*2+n]=i[n],r[t*e*2+n+e]=i[n];else for(let n=0;n<e;n++)r[t*e*2+n]=i[n]}}t.pwfTexture.releaseGraphicsResources(t._openGLRenderWindow),t.pwfTexture.resetFormatAndType(),t.pwfTexture.create2DFromRaw(e,y,1,s.Tu.FLOAT,r)}else r.fill(255),t.pwfTexture.create2DFromRaw(e,1,1,s.Tu.UNSIGNED_CHAR,r);t.pwfTextureString=S,_&&t._openGLRenderWindow.setGraphicsResourceForObject(_,t.pwfTexture,t.pwfTextureString)}e.updatelabelOutlineThicknessTexture(r);const{ijkMode:D}=t.renderable.getClosestIJKAxis();let A=t.renderable.getSlice();D!==t.renderable.getSlicingMode()&&(A=t.renderable.getSliceAtPosition(A));const P=t.renderable.isA("vtkImageArrayMapper")?t.renderable.getSubSlice():Math.round(A),O=i.getExtent();let R;D===w.I&&(R=P-O[0]),D===w.J&&(R=P-O[2]),D!==w.K&&D!==w.NONE||(R=P-O[4]);const M=`${A}A${i.getMTime()}A${o.getMTime()}B${e.getMTime()}C${t.renderable.getSlicingMode()}D${r.getProperty().getInterpolationType()}`;if(t.VBOBuildString!==M){const e=i.getDimensions();t.openGLTexture||(t.openGLTexture=u.default.newInstance({resizable:!0}),t.openGLTexture.setOpenGLRenderWindow(t._openGLRenderWindow)),t.openGLTexture.setOglNorm16Ext(t.context.getExtension("EXT_texture_norm16")),p===m.Z.NEAREST?(new Set([1,3,4]).has(c)&&l===s.Tu.UNSIGNED_CHAR&&!g?(t.openGLTexture.setGenerateMipmap(!0),t.openGLTexture.setMinificationFilter(f.w.NEAREST)):t.openGLTexture.setMinificationFilter(f.w.NEAREST),t.openGLTexture.setMagnificationFilter(f.w.NEAREST)):(4!==c||l!==s.Tu.UNSIGNED_CHAR||g?t.openGLTexture.setMinificationFilter(f.w.LINEAR):(t.openGLTexture.setGenerateMipmap(!0),t.openGLTexture.setMinificationFilter(f.w.LINEAR_MIPMAP_LINEAR)),t.openGLTexture.setMagnificationFilter(f.w.LINEAR)),t.openGLTexture.setWrapS(f.E.CLAMP_TO_EDGE),t.openGLTexture.setWrapT(f.E.CLAMP_TO_EDGE);const n=e[0]*e[1]*c,r=new Float32Array(12),d=new Float32Array(8);for(let e=0;e<4;e++)d[2*e]=e%2?1:0,d[2*e+1]=e>1?1:0;const v=[w.X,w.Y,w.Z].includes(t.renderable.getSlicingMode())?A:P,y=i.getSpatialExtent(),b=o.getData();let E=null;if(D===w.I){E=new b.constructor(e[2]*e[1]*c);let t=0;for(let n=0;n<e[2];n++)for(let r=0;r<e[1];r++){let i=(R+r*e[0]+n*e[0]*e[1])*c;t=(n*e[1]+r)*c;const o=i+c;for(;i<o;)E[t++]=b[i++]}e[0]=e[1],e[1]=e[2],r[0]=v,r[1]=y[2],r[2]=y[4],r[3]=v,r[4]=y[3],r[5]=y[4],r[6]=v,r[7]=y[2],r[8]=y[5],r[9]=v,r[10]=y[3],r[11]=y[5]}else if(D===w.J){E=new b.constructor(e[2]*e[0]*c);let t=0;for(let n=0;n<e[2];n++)for(let r=0;r<e[0];r++){let i=(r+R*e[0]+n*e[0]*e[1])*c;t=(n*e[0]+r)*c;const o=i+c;for(;i<o;)E[t++]=b[i++]}e[1]=e[2],r[0]=y[0],r[1]=v,r[2]=y[4],r[3]=y[1],r[4]=v,r[5]=y[4],r[6]=y[0],r[7]=v,r[8]=y[5],r[9]=y[1],r[10]=v,r[11]=y[5]}else D===w.K||D===w.NONE?(E=b.subarray(R*n,(R+1)*n),r[0]=y[0],r[1]=y[2],r[2]=v,r[3]=y[1],r[4]=y[2],r[5]=v,r[6]=y[0],r[7]=y[3],r[8]=v,r[9]=y[1],r[10]=y[3],r[11]=v):C("Reformat slicing not yet supported.");const T=t._openGLRenderWindow.getGraphicsResourceForObject(E);T?.vtkObj?(t.openGLTexture=T.vtkObj,t.VBOBuildString=T.hash):(t._scalars!==E&&(t._openGLRenderWindow.releaseGraphicsResourcesForObject(t._scalars),t._scalars=E),t.openGLTexture.resetFormatAndType(),t.openGLTexture.create2DFilterableFromRaw(e[0],e[1],c,o.getDataType(),E,t.renderable.getPreferSizeOverAccuracy?.()),t._openGLRenderWindow.setGraphicsResourceForObject(E,t.openGLTexture,t.VBOBuildString)),t.openGLTexture.activate(),t.openGLTexture.sendParameters(),t.openGLTexture.deactivate();const x=a.default.newInstance({numberOfComponents:3,values:r});x.setName("points");const _=a.default.newInstance({numberOfComponents:2,values:d});_.setName("tcoords");const S=new Uint16Array(8);S[0]=3,S[1]=0,S[2]=1,S[3]=3,S[4]=3,S[5]=0,S[6]=3,S[7]=2;const I=a.default.newInstance({numberOfComponents:1,values:S});t.tris.getCABO().createVBO(I,"polys",h.hX.SURFACE,{points:x,tcoords:_,cellOffset:0}),t.VBOBuildTime.modified(),t.VBOBuildString=M}},e.updatelabelOutlineThicknessTexture=e=>{t.labelOutlineThicknessTexture||(t.labelOutlineThicknessTexture=u.default.newInstance({resizable:!1}),t.labelOutlineThicknessTexture.setOpenGLRenderWindow(t._openGLRenderWindow));const n=e.getProperty().getLabelOutlineThickness(),r=t._openGLRenderWindow.getGraphicsResourceForObject(n),i=`${n.join("-")}`;if(r?.vtkObj&&r?.hash===i&&t.labelOutlineThicknessTextureString===i)t.labelOutlineThicknessTexture=r.vtkObj,t.labelOutlineThicknessTextureString=r.hash;else{const e=1024,r=1,o=new Uint8Array(e*r);for(let t=0;t<e;++t){const e=void 0!==n[t]?n[t]:n[0];o[t]=e}t.labelOutlineThicknessTexture.releaseGraphicsResources(t._openGLRenderWindow),t.labelOutlineThicknessTexture.resetFormatAndType(),t.labelOutlineThicknessTexture.setMinificationFilter(f.w.NEAREST),t.labelOutlineThicknessTexture.setMagnificationFilter(f.w.NEAREST),t.labelOutlineThicknessTexture.create2DFromRaw(e,r,1,s.Tu.UNSIGNED_CHAR,o),t.labelOutlineThicknessTextureString=i,n&&t._openGLRenderWindow.setGraphicsResourceForObject(n,t.labelOutlineThicknessTexture,t.labelOutlineThicknessTextureString)}},e.getRenderTargetSize=()=>{if(t._useSmallViewport)return[t._smallViewportWidth,t._smallViewportHeight];const{usize:e,vsize:n}=t._openGLRenderer.getTiledSizeAndOrigin();return[e,n]},e.getRenderTargetOffset=()=>{const{lowerLeftU:e,lowerLeftV:n}=t._openGLRenderer.getTiledSizeAndOrigin();return[e,n]}}(e,t)}const S=(0,o.n)(_,"vtkOpenGLImageMapper");var I={newInstance:S,extend:_};(0,b.vw)("vtkAbstractImageMapper",S)},43634:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(72076),i=n(68470),o=n(6814),a=n(11145);const s={context:null,keyMatrixTime:null,keyMatrices:null};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),o.Z.extend(e,t,n),t.keyMatrixTime={},(0,i.o)(t.keyMatrixTime,{mtime:0}),t.keyMatrices={mcwc:r._E.identity(new Float64Array(16))},(0,i.e)(e,t,["context"]),function(e,t){t.classHierarchy.push("vtkOpenGLImageSlice"),e.buildPass=n=>{if(t.renderable&&t.renderable.getVisibility()&&n){if(!t.renderable)return;t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t.context=t._openGLRenderWindow.getContext(),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes()}},e.traverseZBufferPass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children.forEach(e=>{e.traverse(n)}),e.apply(n,!1))},e.traverseOpaqueZBufferPass=t=>e.traverseOpaquePass(t),e.traverseOpaquePass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children.forEach(e=>{e.traverse(n)}),e.apply(n,!1))},e.traverseTranslucentPass=n=>{!t.renderable||!t.renderable.getNestedVisibility()||t.renderable.getIsOpaque()||t._openGLRenderer.getSelector()&&!t.renderable.getNestedPickable()||(e.apply(n,!0),t.children.forEach(e=>{e.traverse(n)}),e.apply(n,!1))},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;t.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},e.zBufferPass=(t,n)=>e.opaquePass(t,n),e.opaqueZBufferPass=(t,n)=>e.opaquePass(t,n),e.opaquePass=(e,n)=>{e&&t.context.depthMask(!0)},e.translucentPass=(e,n)=>{t.context.depthMask(!e)},e.getKeyMatrices=()=>(t.renderable.getMTime()>t.keyMatrixTime.getMTime()&&(r._E.copy(t.keyMatrices.mcwc,t.renderable.getMatrix()),r._E.transpose(t.keyMatrices.mcwc,t.keyMatrices.mcwc),t.keyMatrixTime.modified()),t.keyMatrices)}(e,t)}const c=(0,i.n)(l,"vtkOpenGLImageSlice");var u={newInstance:c,extend:l};(0,a.vw)("vtkImageSlice",c)},1385:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(68470),i=n(6814),o=n(11145);const{vtkDebugMacro:a}=r.c;const s={};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),i.Z.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),e.opaquePass=(n,r)=>{t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent();const i=t._openGLRenderer.getAspectRatio(),o=t._openGLRenderer?t._openGLRenderer.getRenderable().getActiveCamera():null,s=t._openGLRenderer.getTiledSizeAndOrigin();let l=null;if(t.renderable.getUseZValues()){const e=r.getZBufferTexture(),n=Math.floor(e.getWidth()),i=Math.floor(e.getHeight()),o=t._openGLRenderWindow.getContext();e.bind();const s=r.getFramebuffer();s?s.saveCurrentBindingsAndBuffers():a("No framebuffer to save/restore");const c=o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,c),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e.getHandle(),0),o.checkFramebufferStatus(o.FRAMEBUFFER)===o.FRAMEBUFFER_COMPLETE&&(l=new Uint8Array(n*i*4),o.viewport(0,0,n,i),o.readPixels(0,0,n,i,o.RGBA,o.UNSIGNED_BYTE,l)),s&&s.restorePreviousBindingsAndBuffers(),o.deleteFramebuffer(c)}t.renderable.invokeCallback(t.renderable.getInputData(),o,i,s,l)},e.queryPass=(e,n)=>{e&&t.renderable.getUseZValues()&&n.requestDepth()}}(e,t)}const c=(0,r.n)(l,"vtkOpenGLPixelSpaceCallbackMapper");var u={newInstance:c,extend:l};(0,o.vw)("vtkPixelSpaceCallbackMapper",c)},73399:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>N});var r=n(72076),i=n(68470),o=n(59269),a=n(93702),s=n(59474),l=n(41247),c=n(54873),u=n(98589),d=n(53118),p=n(6814),h=n(81270),f=n(25460),m=n(51815),g=n(11145),v=n(18603),y=n(14418);const{FieldAssociations:b}=y.default,{primTypes:C}=o.default,{Representation:w,Shading:E}=u.default,{ScalarMode:T}=a.default,{Filter:x,Wrap:_}=l.default,{vtkErrorMacro:S}=i.c,I={type:"StartEvent"},D={type:"EndEvent"},{CoordinateSystem:A}=c.default;function P(e,t){function n(e,t,n){return t.identity(n),e.reduce((e,n,r)=>0===r?n?t.copy(e,n):t.identity(e):n?t.multiply(e,e,n):e,n)}t.classHierarchy.push("vtkOpenGLPolyDataMapper"),e.buildPass=n=>{n&&(t.currentRenderPass=null,t.openGLActor=e.getFirstAncestorOfType("vtkOpenGLActor"),t._openGLRenderer=t.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.openGLCamera=t._openGLRenderer.getViewNodeFor(t._openGLRenderer.getRenderable().getActiveCamera()))},e.translucentPass=(n,r)=>{n&&(t.currentRenderPass=r,e.render())},e.zBufferPass=n=>{n&&(t.haveSeenDepthRequest=!0,t.renderDepth=!0,e.render(),t.renderDepth=!1)},e.opaqueZBufferPass=t=>e.zBufferPass(t),e.opaquePass=t=>{t&&e.render()},e.render=()=>{const n=t._openGLRenderWindow.getContext();if(t.context!==n){t.context=n;for(let e=C.Start;e<C.End;e++)t.primitives[e].setOpenGLRenderWindow(t._openGLRenderWindow)}const r=t.openGLActor.getRenderable(),i=t._openGLRenderer.getRenderable();e.renderPiece(i,r)},e.getShaderTemplate=(e,t,n)=>{e.Vertex=h.v,e.Fragment=f.v,e.Geometry=""},e.replaceShaderColor=(e,n,r)=>{let i=e.Vertex,o=e.Geometry,a=e.Fragment;const s=t.lastBoundBO.getReferenceByName("lastLightComplexity");let l=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];s&&(l=l.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let c=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];s&&(c=c.concat(["  vec3 specularColor;","  float specularPower;"])),c=c.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),s&&(c=c.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),0===t.lastBoundBO.getCABO().getColorComponents()||t.drawingEdges||(l=l.concat(["varying vec4 vertexColorVSOutput;"]),i=d.Z.substitute(i,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,i=d.Z.substitute(i,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=d.Z.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=d.Z.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),0===t.lastBoundBO.getCABO().getColorComponents()||t.drawingEdges?t.renderable.getInterpolateScalarsBeforeMapping()&&t.renderable.getColorCoordinates()&&!t.drawingEdges?a=d.Z.substitute(a,"//VTK::Color::Impl",c.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(r.getBackfaceProperty()&&!t.drawingEdges&&(l=l.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),s?(l=l.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),c=c.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):c=c.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),t.haveCellScalars&&!t.drawingEdges&&(l=l.concat(["uniform samplerBuffer texture1;"])),a=d.Z.substitute(a,"//VTK::Color::Impl",c).result):a=d.Z.substitute(a,"//VTK::Color::Impl",c.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result,a=d.Z.substitute(a,"//VTK::Color::Dec",l).result,e.Vertex=i,e.Geometry=o,e.Fragment=a},e.replaceShaderLight=(e,n,r)=>{let i=e.Fragment;const o=t.lastBoundBO.getReferenceByName("lastLightComplexity"),a=t.lastBoundBO.getReferenceByName("lastLightCount");let s=[];switch(o){case 0:i=d.Z.substitute(i,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:i=d.Z.substitute(i,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let e=0;e<a;++e)s=s.concat([`uniform vec3 lightColor${e};`,`uniform vec3 lightDirectionVC${e}; // normalized`,`uniform vec3 lightHalfAngleVC${e}; // normalized`]);i=d.Z.substitute(i,"//VTK::Light::Dec",s).result,s=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let e=0;e<a;++e)s=s.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${e}));`,`  diffuseL += ((df) * lightColor${e});`,`  if (dot(normalVCVSOutput, lightDirectionVC${e}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,\n                                              dot(reflect(lightDirectionVC${e},normalVCVSOutput),\n                                                  normalize(-vertexVC.xyz))),\n                                         specularPower);`,`    specularL += (sf * lightColor${e});`,"    }"]);s=s.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=d.Z.substitute(i,"//VTK::Light::Impl",s,!1).result;break;case 3:for(let e=0;e<a;++e)s=s.concat([`uniform vec3 lightColor${e};`,`uniform vec3 lightDirectionVC${e}; // normalized`,`uniform vec3 lightHalfAngleVC${e}; // normalized`,`uniform vec3 lightPositionVC${e};`,`uniform vec3 lightAttenuation${e};`,`uniform float lightConeAngle${e};`,`uniform float lightExponent${e};`,`uniform int lightPositional${e};`]);i=d.Z.substitute(i,"//VTK::Light::Dec",s).result,s=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let e=0;e<a;++e)s=s.concat(["  attenuation = 1.0;",`  if (lightPositional${e} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${e};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${e};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${e}.x`,`       + lightAttenuation${e}.y * distanceVC`,`       + lightAttenuation${e}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${e} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${e});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${e})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${e});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df) * lightColor${e});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,\n                                                           dot(reflect(lightDirectionVC${e},\n                                                                       normalVCVSOutput),\n                                                               normalize(-vertexVC.xyz))),\n                                                       specularPower);`,`    specularL += ((sf) * lightColor${e});`,"    }"]);s=s.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=d.Z.substitute(i,"//VTK::Light::Impl",s,!1).result;break;default:S("bad light complexity")}e.Fragment=i},e.replaceShaderNormal=(e,n,r)=>{if(t.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let n=e.Vertex,i=e.Geometry,o=e.Fragment;t.lastBoundBO.getCABO().getNormalOffset()?(n=d.Z.substitute(n,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,n=d.Z.substitute(n,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,i=d.Z.substitute(i,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,i=d.Z.substitute(i,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,o=d.Z.substitute(o,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,o=d.Z.substitute(o,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):t.haveCellNormals?(o=d.Z.substitute(o,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,o=d.Z.substitute(o,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):t.lastBoundBO.getOpenGLMode(r.getProperty().getRepresentation())===t.context.LINES?(o=d.Z.substitute(o,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,o=d.Z.substitute(o,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(o=d.Z.substitute(o,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,o=d.Z.substitute(o,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,o=d.Z.substitute(o,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),e.Vertex=n,e.Geometry=i,e.Fragment=o}},e.replaceShaderPositionVC=(e,n,r)=>{t.lastBoundBO.replaceShaderPositionVC(e,n,r);let i=e.Vertex,o=e.Geometry,a=e.Fragment;t.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(i=d.Z.substitute(i,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,i=d.Z.substitute(i,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,i=d.Z.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=d.Z.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=d.Z.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,a=d.Z.substitute(a,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,a=d.Z.substitute(a,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(i=d.Z.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,i=d.Z.substitute(i,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),e.Vertex=i,e.Geometry=o,e.Fragment=a},e.replaceShaderTCoord=(e,n,r)=>{if(t.lastBoundBO.getCABO().getTCoordOffset()){let n=e.Vertex,r=e.Geometry,i=e.Fragment;if(t.drawingEdges)return;n=d.Z.substitute(n,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const o=t.openGLActor.getActiveTextures();let a=2,s=2;if(o&&o.length>0&&(a=o[0].getComponents(),o[0].getTarget()===t.context.TEXTURE_CUBE_MAP&&(s=3)),t.renderable.getColorTextureMap()&&(a=t.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),s=2),2===s){if(n=d.Z.substitute(n,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,r=d.Z.substitute(r,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,r=d.Z.substitute(r,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,i=d.Z.substitute(i,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,o&&o.length>=1)switch(a){case 1:i=d.Z.substitute(i,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:i=d.Z.substitute(i,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:i=d.Z.substitute(i,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(n=d.Z.substitute(n,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,r=d.Z.substitute(r,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,r=d.Z.substitute(r,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,i=d.Z.substitute(i,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,a){case 1:i=d.Z.substitute(i,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:i=d.Z.substitute(i,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:i=d.Z.substitute(i,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}e.Vertex=n,e.Geometry=r,e.Fragment=i}},e.replaceShaderClip=(e,n,r)=>{let i=e.Vertex,o=e.Fragment;if(t.renderable.getNumberOfClippingPlanes()){const e=t.renderable.getNumberOfClippingPlanes();i=d.Z.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${e}];`,`varying float clipDistancesVSOutput[${e}];`]).result,i=d.Z.substitute(i,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${e}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=d.Z.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${e}];`]).result,o=d.Z.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${e}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}e.Vertex=i,e.Fragment=o},e.getCoincidentParameters=(e,n)=>{let r={factor:0,offset:0};const i=n.getProperty();if(t.renderable.getResolveCoincidentTopology()||i.getEdgeVisibility()&&i.getRepresentation()===w.SURFACE){const e=t.lastBoundBO.getPrimitiveType();e===C.Points||i.getRepresentation()===w.POINTS?r=t.renderable.getCoincidentTopologyPointOffsetParameter():e===C.Lines||i.getRepresentation()===w.WIREFRAME?r=t.renderable.getCoincidentTopologyLineOffsetParameters():e!==C.Tris&&e!==C.TriStrips||(r=t.renderable.getCoincidentTopologyPolygonOffsetParameters()),e!==C.TrisEdges&&e!==C.TriStripsEdges||(r=t.renderable.getCoincidentTopologyPolygonOffsetParameters(),r.factor/=2,r.offset/=2)}const o=t._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===b.FIELD_ASSOCIATION_POINTS&&(r.offset-=2),r},e.replaceShaderPicking=(e,n,r)=>{let i=e.Fragment,o=e.Vertex;if(i=d.Z.substitute(i,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,t._openGLRenderer.getSelector()){switch(t.lastSelectionState!==v.X.ID_LOW24&&t.lastSelectionState!==v.X.ID_HIGH24||(o=d.Z.substitute(o,"//VTK::Picking::Dec",["flat out int vertexIDVSOutput;\n","uniform int VertexIDOffset;\n"]).result,o=d.Z.substitute(o,"//VTK::Picking::Impl","  vertexIDVSOutput = gl_VertexID + VertexIDOffset;\n").result,i=d.Z.substitute(i,"//VTK::Picking::Dec","flat in int vertexIDVSOutput;\n").result,i=d.Z.substitute(i,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),t.lastSelectionState){case v.X.ID_LOW24:i=d.Z.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case v.X.ID_HIGH24:i=d.Z.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx)/255.0, 0.0, 0.0, 1.0);").result;break;default:i=d.Z.substitute(i,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,i=d.Z.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}e.Fragment=i,e.Vertex=o}},e.replaceShaderValues=(n,r,i)=>{if(e.replaceShaderColor(n,r,i),e.replaceShaderNormal(n,r,i),e.replaceShaderLight(n,r,i),e.replaceShaderTCoord(n,r,i),e.replaceShaderPicking(n,r,i),e.replaceShaderClip(n,r,i),e.replaceShaderCoincidentOffset(n,r,i),e.replaceShaderPositionVC(n,r,i),t.haveSeenDepthRequest){let e=n.Fragment;e=d.Z.substitute(e,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,e=d.Z.substitute(e,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=e}},e.getNeedToRebuildShaders=(e,n,r)=>{let i=0,o=0;const a=e.getPrimitiveType(),s=t.currentInput;let l=!1;const c=s.getPointData().getNormals(),u=s.getCellData().getNormals(),d=r.getProperty().getInterpolation()===E.FLAT,p=r.getProperty().getRepresentation(),h=e.getOpenGLMode(p,a);if(h===t.context.TRIANGLES||u&&!c||!d&&c?l=!0:d||h!==t.context.LINES||(l=!0),r.getProperty().getLighting()&&l){i=0;const e=n.getLightsByReference();for(let t=0;t<e.length;++t){const n=e[t];n.getSwitch()>0&&(o++,0===i&&(i=1)),1===i&&(o>1||1!==n.getIntensity()||!n.lightTypeIsHeadLight())&&(i=2),i<3&&n.getPositional()&&(i=3)}}let f=!1;const m=t.lastBoundBO.getReferenceByName("lastLightComplexity"),g=t.lastBoundBO.getReferenceByName("lastLightCount");return m===i&&g===o||(t.lastBoundBO.set({lastLightComplexity:i},!0),t.lastBoundBO.set({lastLightCount:o},!0),f=!0),(!t.currentRenderPass&&t.lastRenderPassShaderReplacement||t.currentRenderPass&&t.currentRenderPass.getShaderReplacement()!==t.lastRenderPassShaderReplacement)&&(f=!0),!!(t.lastHaveSeenDepthRequest!==t.haveSeenDepthRequest||e.getShaderSourceTime().getMTime()<t.renderable.getMTime()||e.getShaderSourceTime().getMTime()<t.currentInput.getMTime()||e.getShaderSourceTime().getMTime()<t.selectionStateChanged.getMTime()||f)&&(t.lastHaveSeenDepthRequest=t.haveSeenDepthRequest,!0)},e.invokeShaderCallbacks=(e,n,r)=>{const i=t.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(t=>{t.callback(t.userData,e,n,r)})},e.setMapperShaderParameters=(n,i,o)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",t.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",t.vertexIDOffset),n.getCABO().getElementCount()&&(t.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){const e=t.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),t.context.FLOAT,3,!1)||S("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&e>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),t.context.FLOAT,3,!1)||S("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),t.renderable.getCustomShaderAttributes().forEach((e,r)=>{n.getProgram().isAttributeUsed(`${e}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${e}MC`,n.getCABO().getCustomData()[r].offset,n.getCABO().getStride(),t.context.FLOAT,n.getCABO().getCustomData()[r].components,!1)||S(`Error setting ${e}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),t.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||S("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),t.context.UNSIGNED_BYTE,4,!0)||S("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(t.renderable.getNumberOfClippingPlanes()){const e=t.renderable.getNumberOfClippingPlanes(),i=[],a=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,s=a?r._E.copy(t.tmpMat4,o.getMatrix()):o.getMatrix();a&&(r._E.transpose(s,s),r._E.multiply(s,s,a),r._E.transpose(s,s));for(let n=0;n<e;n++){const e=[];t.renderable.getClippingPlaneInDataCoords(s,n,e);for(let t=0;t<4;t++)i.push(e[t])}n.getProgram().setUniformi("numClipPlanes",e),n.getProgram().setUniform4fv("clipPlanes",i)}t.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",t.internalColorTexture.getTextureUnit());const a=t.openGLActor.getActiveTextures();if(a)for(let e=0;e<a.length;++e){const t=a[e].getTextureUnit(),r=`texture${t+1}`;n.getProgram().isUniformUsed(r)&&n.getProgram().setUniformi(r,t)}if(t.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",t.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const t=e.getCoincidentParameters(i,o);n.getProgram().setUniformf("coffset",t.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",t.factor)}n.setMapperShaderParameters(i,o,t._openGLRenderer.getTiledSizeAndOrigin());const s=t._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},e.setLightingShaderParameters=(e,n,i)=>{const o=t.lastBoundBO.getReferenceByName("lastLightComplexity");if(o<2)return;const a=e.getProgram();let l=0;const c=n.getLightsByReference();for(let e=0;e<c.length;++e){const r=c[e];if(r.getSwitch()>0){const e=r.getColorByReference(),i=r.getIntensity();t.lightColor[0]=e[0]*i,t.lightColor[1]=e[1]*i,t.lightColor[2]=e[2]*i;const o=r.getDirection(),c=n.getActiveCamera().getViewMatrix(),u=[...o];r.lightTypeIsSceneLight()&&(u[0]=c[0]*o[0]+c[1]*o[1]+c[2]*o[2],u[1]=c[4]*o[0]+c[5]*o[1]+c[6]*o[2],u[2]=c[8]*o[0]+c[9]*o[1]+c[10]*o[2],(0,s.l)(u)),t.lightDirection[0]=u[0],t.lightDirection[1]=u[1],t.lightDirection[2]=u[2],(0,s.l)(t.lightDirection),a.setUniform3fArray(`lightColor${l}`,t.lightColor),a.setUniform3fArray(`lightDirectionVC${l}`,t.lightDirection),l++}}if(o<3)return;const u=n.getActiveCamera().getViewMatrix();r._E.transpose(u,u),l=0;for(let e=0;e<c.length;++e){const t=c[e];if(t.getSwitch()>0){const e=t.getTransformedPosition(),n=new Float64Array(3);r.R3.transformMat4(n,e,u),a.setUniform3fArray(`lightAttenuation${l}`,t.getAttenuationValuesByReference()),a.setUniformi(`lightPositional${l}`,t.getPositional()),a.setUniformf(`lightExponent${l}`,t.getExponent()),a.setUniformf(`lightConeAngle${l}`,t.getConeAngle()),a.setUniform3fArray(`lightPositionVC${l}`,[n[0],n[1],n[2]]),l++}}},e.setCameraShaderParameters=(e,i,o)=>{const a=e.getProgram(),s=t.openGLCamera.getKeyMatrices(i),l=i.getActiveCamera(),c=t.openGLCamera.getKeyMatrixTime().getMTime(),u=a.getLastCameraMTime(),d=e.getCABO().getCoordShiftAndScaleEnabled()?e.getCABO().getInverseShiftAndScaleMatrix():null,p=o.getIsIdentity(),h=p?{mcwc:null,normalMatrix:null}:t.openGLActor.getKeyMatrices();if(o.getCoordinateSystem()===A.DISPLAY){const e=t._openGLRenderer.getTiledSizeAndOrigin();r._E.identity(t.tmpMat4),t.tmpMat4[0]=2/e.usize,t.tmpMat4[12]=-1,t.tmpMat4[5]=2/e.vsize,t.tmpMat4[13]=-1,r._E.multiply(t.tmpMat4,t.tmpMat4,d),a.setUniformMatrix("MCPCMatrix",t.tmpMat4)}else a.setUniformMatrix("MCPCMatrix",n([s.wcpc,h.mcwc,d],r._E,t.tmpMat4));a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",n([s.wcvc,h.mcwc,d],r._E,t.tmpMat4)),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",n([s.normalMatrix,h.normalMatrix],r.wO,t.tmpMat3)),u!==c&&(a.isUniformUsed("cameraParallel")&&a.setUniformi("cameraParallel",l.getParallelProjection()),a.setLastCameraMTime(c)),p||a.setLastCameraMTime(0)},e.setPropertyShaderParameters=(e,n,r)=>{const i=e.getProgram();let o=r.getProperty(),a=o.getOpacity(),s=t.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),l=t.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),c=t.drawingEdges?1:o.getAmbient(),u=t.drawingEdges?0:o.getDiffuse(),d=t.drawingEdges?0:o.getSpecular();const p=o.getSpecularPower();i.setUniformf("opacityUniform",a),i.setUniform3fArray("ambientColorUniform",s),i.setUniform3fArray("diffuseColorUniform",l),i.setUniformf("ambient",c),i.setUniformf("diffuse",u);const h=t.lastBoundBO.getReferenceByName("lastLightComplexity");if(h<1)return;let f=o.getSpecularColorByReference();if(i.setUniform3fArray("specularColorUniform",f),i.setUniformf("specularPowerUniform",p),i.setUniformf("specular",d),i.isUniformUsed("ambientIntensityBF")){if(o=r.getBackfaceProperty(),a=o.getOpacity(),s=o.getAmbientColor(),c=o.getAmbient(),l=o.getDiffuseColor(),u=o.getDiffuse(),f=o.getSpecularColor(),d=o.getSpecular(),i.setUniformf("ambientIntensityBF",c),i.setUniformf("diffuseIntensityBF",u),i.setUniformf("opacityUniformBF",a),i.setUniform3fArray("ambientColorUniformBF",s),i.setUniform3fArray("diffuseColorUniformBF",l),h<1)return;i.setUniformf("specularIntensityBF",d),i.setUniform3fArray("specularColorUniformBF",f),i.setUniformf("specularPowerUniformBF",p)}},e.updateMaximumPointCellIds=(e,n)=>{const r=t._openGLRenderer.getSelector();if(!r)return;if(t.selectionWebGLIdsToVTKIds?.points?.length){const e=t.selectionWebGLIdsToVTKIds.points.length;r.setMaximumPointId(e-1)}if(t.selectionWebGLIdsToVTKIds?.cells?.length){const e=t.selectionWebGLIdsToVTKIds.cells.length;r.setMaximumCellId(e-1)}r.getFieldAssociation()===b.FIELD_ASSOCIATION_POINTS&&(t.pointPicking=!0)},e.renderPieceStart=(n,r)=>{t.primitiveIDOffset=0,t.vertexIDOffset=0;const i=function(e){const t=e.getSelector();return t?t.getCurrentPass():v.X.MIN_KNOWN_PASS-1}(t._openGLRenderer);t.lastSelectionState!==i&&(t.selectionStateChanged.modified(),t.lastSelectionState=i),t._openGLRenderer.getSelector()&&t._openGLRenderer.getSelector().renderProp(r),e.updateBufferObjects(n,r),t.renderable.getColorTextureMap()&&t.internalColorTexture.activate(),t.lastBoundBO=null},e.renderPieceDraw=(n,r)=>{const i=r.getProperty().getRepresentation(),o=r.getProperty().getEdgeVisibility()&&i===w.SURFACE,a=t._openGLRenderer.getSelector(),s=a&&a.getFieldAssociation()===b.FIELD_ASSOCIATION_POINTS&&(t.lastSelectionState===v.X.ID_LOW24||t.lastSelectionState===v.X.ID_HIGH24);for(let a=C.Start;a<C.End;a++){t.primitives[a].setPointPicking(s);t.primitives[a].getCABO().getElementCount()&&(t.drawingEdges=o&&(a===C.TrisEdges||a===C.TriStripsEdges),t.drawingEdges&&(t.renderDepth||t.lastSelectionState>=0)||(t.lastBoundBO=t.primitives[a],t.primitiveIDOffset+=t.primitives[a].drawArrays(n,r,i,e),t.vertexIDOffset+=t.primitives[a].getCABO().getElementCount()))}},e.renderPieceFinish=(e,n)=>{t.LastBoundBO&&t.LastBoundBO.getVAO().release(),t.renderable.getColorTextureMap()&&t.internalColorTexture.deactivate()},e.renderPiece=(n,r)=>{if(e.invokeEvent(I),t.renderable.getStatic()||t.renderable.update(),t.currentInput=t.renderable.getInputData(),e.invokeEvent(D),!t.currentInput)return void S("No input!");if(!t.currentInput.getPoints||!t.currentInput.getPoints().getNumberOfValues())return;const i=t.context,o=r.getProperty().getBackfaceCulling(),a=r.getProperty().getFrontfaceCulling();o||a?a?(t._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(t._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)):t._openGLRenderWindow.disableCullFace(),e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r)},e.computeBounds=(n,r)=>{e.getInput()?t.bounds=e.getInput().getBounds():(0,s.u)(t.bounds)},e.updateBufferObjects=(t,n)=>{e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=(n,r)=>{const i=t.VBOBuildTime.getMTime();return i<e.getMTime()||i<t.renderable.getMTime()||i<r.getMTime()||i<t.currentInput.getMTime()},e.buildBufferObjects=(n,r)=>{const i=t.currentInput;if(null===i)return;t.renderable.mapScalars(i,1);const o=t.renderable.getColorMapColors();t.haveCellScalars=!1;const a=t.renderable.getScalarMode();t.renderable.getScalarVisibility()&&(a!==T.USE_CELL_DATA&&a!==T.USE_CELL_FIELD_DATA&&a!==T.USE_FIELD_DATA&&i.getPointData().getScalars()||a===T.USE_POINT_FIELD_DATA||!o||(t.haveCellScalars=!0));let s=r.getProperty().getInterpolation()!==E.FLAT?i.getPointData().getNormals():null;null===s&&i.getCellData().getNormals()&&(t.haveCellNormals=!0,s=i.getCellData().getNormals());const c=r.getProperty().getRepresentation();let u=i.getPointData().getTCoords();if(t.openGLActor.getActiveTextures()||(u=null),t.renderable.getColorCoordinates()){u=t.renderable.getColorCoordinates(),t.internalColorTexture||(t.internalColorTexture=l.default.newInstance({resizable:!0}));const e=t.internalColorTexture;e.setMinificationFilter(x.NEAREST),e.setMagnificationFilter(x.NEAREST),e.setWrapS(_.CLAMP_TO_EDGE),e.setWrapT(_.CLAMP_TO_EDGE),e.setOpenGLRenderWindow(t._openGLRenderWindow);const n=t.renderable.getColorTextureMap(),r=n.getExtent(),i=n.getPointData().getScalars();e.create2DFromRaw(r[1]-r[0]+1,r[3]-r[2]+1,i.getNumberOfComponents(),i.getDataType(),i.getData()),e.activate(),e.sendParameters(),e.deactivate()}const d=`${i.getMTime()}A${c}B${i.getMTime()}C${s?s.getMTime():1}D${o?o.getMTime():1}E${r.getProperty().getEdgeVisibility()}F${u?u.getMTime():1}`;if(t.VBOBuildString!==d){const n={points:i.getPoints(),normals:s,tcoords:u,colors:o,cellOffset:0,vertexOffset:0,haveCellScalars:t.haveCellScalars,haveCellNormals:t.haveCellNormals,customAttributes:t.renderable.getCustomShaderAttributes().map(e=>i.getPointData().getArrayByName(e))};t.renderable.getPopulateSelectionSettings()&&(t.selectionWebGLIdsToVTKIds={points:null,cells:null});const a=[{inRep:"verts",cells:i.getVerts()},{inRep:"lines",cells:i.getLines()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()}],l=r.getProperty().getEdgeVisibility()&&c===w.SURFACE;for(let e=C.Start;e<C.End;e++)e!==C.TrisEdges&&e!==C.TriStripsEdges?(n.cellOffset+=t.primitives[e].getCABO().createVBO(a[e].cells,a[e].inRep,c,n,t.selectionWebGLIdsToVTKIds),n.vertexOffset+=t.primitives[e].getCABO().getElementCount()):l?t.primitives[e].getCABO().createVBO(a[e].cells,a[e].inRep,w.WIREFRAME,{...n,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):t.primitives[e].releaseGraphicsResources();t.renderable.getPopulateSelectionSettings()&&(t.renderable.setSelectionWebGLIdsToVTKIds(t.selectionWebGLIdsToVTKIds),e.updateMaximumPointCellIds()),t.VBOBuildTime.modified(),t.VBOBuildString=d}},e.getAllocatedGPUMemoryInBytes=()=>{let e=0;return t.primitives.forEach(t=>{e+=t.getAllocatedGPUMemoryInBytes()}),e}}const O={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:v.X.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function R(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,O,n),p.Z.extend(e,t,n),m.Z.implementReplaceShaderCoincidentOffset(e,t,n),m.Z.implementBuildShadersWithReplacements(e,t,n),t.primitives=[],t.primTypes=C,t.tmpMat3=r.wO.identity(new Float64Array(9)),t.tmpMat4=r._E.identity(new Float64Array(16));for(let e=C.Start;e<C.End;e++)t.primitives[e]=o.default.newInstance(),t.primitives[e].setPrimitiveType(e),t.primitives[e].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);(0,i.e)(e,t,["context"]),t.VBOBuildTime={},(0,i.o)(t.VBOBuildTime,{mtime:0}),t.selectionStateChanged={},(0,i.o)(t.selectionStateChanged,{mtime:0}),P(e,t)}const M=(0,i.n)(R,"vtkOpenGLPolyDataMapper");var N={newInstance:M,extend:R};(0,g.vw)("vtkMapper",M)},6872:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(68470),i=n(6814),o=n(11145);const{vtkDebugMacro:a}=r.c;const s={context:null,_openGLRenderWindow:null,selector:null};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),i.Z.extend(e,t,n),(0,r.g)(e,t,["shaderCache"]),(0,r.e)(e,t,["selector"]),(0,r.i)(e,t,["openGLRenderWindow"]),function(e,t){t.classHierarchy.push("vtkOpenGLRenderer"),e.buildPass=n=>{if(n){if(!t.renderable)return;e.updateLights(),e.prepareNodes(),e.addMissingNode(t.renderable.getActiveCamera()),e.addMissingNodes(t.renderable.getViewPropsWithNestedProps()),e.removeUnusedNodes()}},e.updateLights=()=>{let e=0;const n=t.renderable.getLightsByReference();for(let t=0;t<n.length;++t)n[t].getSwitch()>0&&e++;return e||(a("No lights are on, creating one."),t.renderable.createLight()),e},e.zBufferPass=n=>{if(n){let n=0;const r=t.context;t.renderable.getTransparent()||(t.context.clearColor(1,0,0,1),n|=r.COLOR_BUFFER_BIT),t.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,t.context.depthMask(!0));const i=e.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.colorMask(!0,!0,!0,!0),n&&r.clear(n),r.enable(r.DEPTH_TEST)}},e.opaqueZBufferPass=t=>e.zBufferPass(t),e.cameraPass=t=>{t&&e.clear()},e.getAspectRatio=()=>{const e=t._parent.getSizeByReference(),n=t.renderable.getViewportByReference();return e[0]*(n[2]-n[0])/((n[3]-n[1])*e[1])},e.getTiledSizeAndOrigin=()=>{const e=t.renderable.getViewportByReference(),n=[0,0,1,1],r=e[0]-n[0],i=e[1]-n[1],o=t._parent.normalizedDisplayToDisplay(r,i),a=Math.round(o[0]),s=Math.round(o[1]),l=e[2]-n[0],c=e[3]-n[1],u=t._parent.normalizedDisplayToDisplay(l,c);let d=Math.round(u[0])-a,p=Math.round(u[1])-s;return d<0&&(d=0),p<0&&(p=0),{usize:d,vsize:p,lowerLeftU:a,lowerLeftV:s}},e.clear=()=>{let n=0;const r=t.context;if(!t.renderable.getTransparent()){const e=t.renderable.getBackgroundByReference();r.clearColor(e[0],e[1],e[2],e[3]),n|=r.COLOR_BUFFER_BIT}t.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const i=e.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},e.releaseGraphicsResources=()=>{null!==t.selector&&t.selector.releaseGraphicsResources(),t.renderable&&t.renderable.getViewProps().forEach(e=>{e.modified()})},e.setOpenGLRenderWindow=n=>{t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))}}(e,t)}const c=(0,r.n)(l,"vtkOpenGLRenderer");var u={newInstance:c,extend:l};(0,o.vw)("vtkRenderer",c)},51815:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(53118);var i={implementReplaceShaderCoincidentOffset:function(e,t){e.replaceShaderCoincidentOffset=(n,i,o)=>{const a=e.getCoincidentParameters(i,o);if(a&&(0!==a.factor||0!==a.offset)){let e=n.Fragment;e=r.Z.substitute(e,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,t.context.getExtension("EXT_frag_depth")&&(0!==a.factor?(e=r.Z.substitute(e,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,e=r.Z.substitute(e,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):e=r.Z.substitute(e,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),t._openGLRenderWindow.getWebgl2()&&(0!==a.factor?(e=r.Z.substitute(e,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,e=r.Z.substitute(e,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):e=r.Z.substitute(e,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=e}}},implementBuildShadersWithReplacements:function(e,t){e.applyShaderReplacements=(e,t,n)=>{let i=null;if(t&&(i=t.ShaderReplacements),i)for(let t=0;t<i.length;t++){const o=i[t];if(n&&o.replaceFirst||!n&&!o.replaceFirst){const t=o.shaderType,n=e[t],i=r.Z.substitute(n,o.originalValue,o.replacementValue,o.replaceAll);e[t]=i.result}}},e.buildShaders=(n,r,i)=>{e.getReplacedShaderTemplate(n,r,i),t.lastRenderPassShaderReplacement=t.currentRenderPass?t.currentRenderPass.getShaderReplacement():null,t.lastRenderPassShaderReplacement&&t.lastRenderPassShaderReplacement(n);const o=t.renderable.getViewSpecificProperties().OpenGL;e.applyShaderReplacements(n,o,!0),e.replaceShaderValues(n,r,i),e.applyShaderReplacements(n,o)},e.getReplacedShaderTemplate=(n,r,i)=>{const o=t.renderable.getViewSpecificProperties().OpenGL;e.getShaderTemplate(n,r,i);let a=n.Vertex;if(o){const e=o.VertexShaderCode;void 0!==e&&""!==e&&(a=e)}n.Vertex=a;let s=n.Fragment;if(o){const e=o.FragmentShaderCode;void 0!==e&&""!==e&&(s=e)}n.Fragment=s;let l=n.Geometry;if(o){const e=o.GeometryShaderCode;void 0!==e&&(l=e)}n.Geometry=l}}}},53118:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(68470);const{vtkErrorMacro:i}=r.m;const o={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,o,n),r.m.obj(e,t),r.m.setGet(e,t,["shaderType","source","error","handle","context"]),function(e,t){t.classHierarchy.push("vtkShader"),e.compile=()=>{let e=t.context.VERTEX_SHADER;if(!t.source||!t.source.length||"Unknown"===t.shaderType)return!1;if(0!==t.handle&&(t.context.deleteShader(t.handle),t.handle=0),e="Fragment"===t.shaderType?t.context.FRAGMENT_SHADER:t.context.VERTEX_SHADER,t.handle=t.context.createShader(e),t.context.shaderSource(t.handle,t.source),t.context.compileShader(t.handle),!t.context.getShaderParameter(t.handle,t.context.COMPILE_STATUS)){const e=t.context.getShaderInfoLog(t.handle);return i(`Error compiling shader '${t.source}': ${e}`),t.context.deleteShader(t.handle),t.handle=0,!1}return!0},e.cleanup=()=>{"Unknown"!==t.shaderType&&0!==t.handle&&(t.context.deleteShader(t.handle),t.handle=0,t.dirty=!0)}}(e,t)}var s={newInstance:r.m.newInstance(a,"vtkShader"),extend:a};const{vtkErrorMacro:l}=r.m;const c={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),t.attributesLocs={},t.uniformLocs={},t.vertexShader=s.newInstance(),t.vertexShader.setShaderType("Vertex"),t.fragmentShader=s.newInstance(),t.fragmentShader.setShaderType("Fragment"),t.geometryShader=s.newInstance(),t.geometryShader.setShaderType("Geometry"),r.m.obj(e,t),r.m.get(e,t,["lastCameraMTime"]),r.m.setGet(e,t,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),function(e,t){t.classHierarchy.push("vtkShaderProgram"),e.compileShader=()=>t.vertexShader.compile()?t.fragmentShader.compile()?e.attachShader(t.vertexShader)&&e.attachShader(t.fragmentShader)?e.link()?(e.setCompiled(!0),1):(l(`Links failed: ${t.error}`),0):(l(t.error),0):(l(t.fragmentShader.getSource().split("\n").map((e,t)=>`${t}: ${e}`).join("\n")),l(t.fragmentShader.getError()),0):(l(t.vertexShader.getSource().split("\n").map((e,t)=>`${t}: ${e}`).join("\n")),l(t.vertexShader.getError()),0),e.cleanup=()=>{"Unknown"!==t.shaderType&&0!==t.handle&&(e.release(),0!==t.vertexShaderHandle&&(t.context.detachShader(t.handle,t.vertexShaderHandle),t.vertexShaderHandle=0),0!==t.fragmentShaderHandle&&(t.context.detachShader(t.handle,t.fragmentShaderHandle),t.fragmentShaderHandle=0),t.context.deleteProgram(t.handle),t.handle=0,e.setCompiled(!1))},e.bind=()=>!(!t.linked&&!e.link()||(t.context.useProgram(t.handle),e.setBound(!0),0)),e.isBound=()=>!!t.bound,e.release=()=>{t.context.useProgram(null),e.setBound(!1)},e.setContext=e=>{t.vertexShader.setContext(e),t.fragmentShader.setContext(e),t.geometryShader.setContext(e)},e.link=()=>{if(t.linked)return!0;if(0===t.handle)return t.error="Program has not been initialized, and/or does not have shaders.",!1;if(t.uniformLocs={},t.context.linkProgram(t.handle),!t.context.getProgramParameter(t.handle,t.context.LINK_STATUS)){const e=t.context.getProgramInfoLog(t.handle);return l(`Error linking shader ${e}`),t.handle=0,!1}return e.setLinked(!0),t.attributeLocs={},!0},e.setUniformMatrix=(n,r)=>{const i=e.findUniform(n);if(-1===i)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;const o=new Float32Array(r);return t.context.uniformMatrix4fv(i,!1,o),!0},e.setUniformMatrix3x3=(n,r)=>{const i=e.findUniform(n);if(-1===i)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;const o=new Float32Array(r);return t.context.uniformMatrix3fv(i,!1,o),!0},e.setUniformf=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform1f(i,r),!0)},e.setUniformfv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform1fv(i,r),!0)},e.setUniformi=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform1i(i,r),!0)},e.setUniformiv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform1iv(i,r),!0)},e.setUniform2f=(n,r,i)=>{const o=e.findUniform(n);if(-1===o)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;if(void 0===i)throw new RangeError("Invalid number of values for array");return t.context.uniform2f(o,r,i),!0},e.setUniform2fv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform2fv(i,r),!0)},e.setUniform2i=(n,r,i)=>{const o=e.findUniform(n);if(-1===o)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;if(void 0===i)throw new RangeError("Invalid number of values for array");return t.context.uniform2i(o,r,i),!0},e.setUniform2iv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform2iv(i,r),!0)},e.setUniform3f=(n,r,i,o)=>{const a=e.findUniform(n);if(-1===a)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;if(void 0===o)throw new RangeError("Invalid number of values for array");return t.context.uniform3f(a,r,i,o),!0},e.setUniform3fArray=(n,r)=>{const i=e.findUniform(n);if(-1===i)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||3!==r.length)throw new RangeError("Invalid number of values for array");return t.context.uniform3f(i,r[0],r[1],r[2]),!0},e.setUniform3fv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform3fv(i,r),!0)},e.setUniform3i=function(n){const r=e.findUniform(n);if(-1===r)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(1===s.length&&Array.isArray(s[0])&&(s=s[0]),3!==s.length)throw new RangeError("Invalid number of values for array");return t.context.uniform3i(r,s[0],s[1],s[2]),!0},e.setUniform3iv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform3iv(i,r),!0)},e.setUniform4f=function(n){const r=e.findUniform(n);if(-1===r)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(1===s.length&&Array.isArray(s[0])&&(s=s[0]),4!==s.length)throw new RangeError("Invalid number of values for array");return t.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},e.setUniform4fv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform4fv(i,r),!0)},e.setUniform4i=function(n){const r=e.findUniform(n);if(-1===r)return t.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(1===s.length&&Array.isArray(s[0])&&(s=s[0]),4!==s.length)throw new RangeError("Invalid number of values for array");return t.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},e.setUniform4iv=(n,r)=>{const i=e.findUniform(n);return-1===i?(t.error=`Could not set uniform ${n} . No such uniform.`,!1):(t.context.uniform4iv(i,r),!0)},e.findUniform=e=>{if(!e||!t.linked)return-1;let n=t.uniformLocs[e];return void 0!==n?n:(n=t.context.getUniformLocation(t.handle,e),null===n?(t.error=`Uniform ${e} not found in current shader program.`,t.uniformLocs[e]=-1,-1):(t.uniformLocs[e]=n,n))},e.isUniformUsed=e=>{if(!e)return!1;let n=t.uniformLocs[e];return void 0!==n?null!==n:t.linked?(n=t.context.getUniformLocation(t.handle,e),t.uniformLocs[e]=n,null!==n):(l("attempt to find uniform when the shader program is not linked"),!1)},e.isAttributeUsed=e=>{if(!e)return!1;if(e in t.attributeLocs)return!0;if(!t.linked)return l("attempt to find uniform when the shader program is not linked"),!1;const n=t.context.getAttribLocation(t.handle,e);return-1!==n&&(t.attributeLocs[e]=n,!0)},e.attachShader=n=>{if(0===n.getHandle())return t.error="Shader object was not initialized, cannot attach it.",!1;if("Unknown"===n.getShaderType())return t.error="Shader object is of type Unknown and cannot be used.",!1;if(0===t.handle){const e=t.context.createProgram();if(0===e)return t.error="Could not create shader program.",!1;t.handle=e,t.linked=!1}return"Vertex"===n.getShaderType()&&(0!==t.vertexShaderHandle&&t.context.detachShader(t.handle,t.vertexShaderHandle),t.vertexShaderHandle=n.getHandle()),"Fragment"===n.getShaderType()&&(0!==t.fragmentShaderHandle&&t.context.detachShader(t.handle,t.fragmentShaderHandle),t.fragmentShaderHandle=n.getHandle()),t.context.attachShader(t.handle,n.getHandle()),e.setLinked(!1),!0},e.detachShader=e=>{if(0===e.getHandle())return t.error="shader object was not initialized, cannot attach it.",!1;if("Unknown"===e.getShaderType())return t.error="Shader object is of type Unknown and cannot be used.",!1;switch(0===t.handle&&(t.error="This shader program has not been initialized yet."),e.getShaderType()){case"Vertex":return t.vertexShaderHandle!==e.getHandle()?(t.error="The supplied shader was not attached to this program.",!1):(t.context.detachShader(t.handle,e.getHandle()),t.vertexShaderHandle=0,t.linked=!1,!0);case"Fragment":return t.fragmentShaderHandle!==e.getHandle()?(t.error="The supplied shader was not attached to this program.",!1):(t.context.detachShader(t.handle,e.getHandle()),t.fragmentShaderHandle=0,t.linked=!1,!0);default:return!1}},e.setContext=e=>{t.context=e,t.vertexShader.setContext(e),t.fragmentShader.setContext(e),t.geometryShader.setContext(e)},e.setLastCameraMTime=e=>{t.lastCameraMTime=e}}(e,t)}var d={newInstance:r.m.newInstance(u,"vtkShaderProgram"),extend:u,substitute:function(e,t,n,r){const i="string"==typeof n?n:n.join("\n"),o=!1===r?t:new RegExp(t,"g"),a=e.replace(o,i);return{replace:a!==i,result:a}}}},41983:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>m});var r=n(72076),i=n(68470),o=n(54131),a=n(59269),s=n(6814),l=n(41247),c=n(42695),u=n(11145);const{vtkErrorMacro:d}=i.c;const p={context:null};function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,p,n),s.Z.extend(e,t,n),t.openGLTexture=l.default.newInstance(),t.tris=a.default.newInstance(),t.keyMatrixTime={},(0,i.o)(t.keyMatrixTime,{mtime:0}),t.keyMatrices={normalMatrix:r.wO.identity(new Float64Array(9)),mcwc:r._E.identity(new Float64Array(16))},(0,i.e)(e,t,["context"]),(0,i.g)(e,t,["activeTextures"]),function(e,t){t.classHierarchy.push("vtkOpenGLSkybox"),e.buildPass=n=>{if(n){t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.context=t._openGLRenderWindow.getContext(),t.tris.setOpenGLRenderWindow(t._openGLRenderWindow),t.openGLTexture.setOpenGLRenderWindow(t._openGLRenderWindow);const n=t._openGLRenderer.getRenderable();t.openGLCamera=t._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},e.opaquePass=(n,i)=>{if(n&&!t._openGLRenderer.getSelector()){e.updateBufferObjects(),t.context.depthMask(!0),t._openGLRenderWindow.getShaderCache().readyShaderProgram(t.tris.getProgram()),t.openGLTexture.render(t._openGLRenderWindow);const n=t.openGLTexture.getTextureUnit();t.tris.getProgram().setUniformi("sbtexture",n);const i=t._openGLRenderer.getRenderable(),o=t.openGLCamera.getKeyMatrices(i),a=new Float64Array(16);if(r._E.invert(a,o.wcpc),t.tris.getProgram().setUniformMatrix("IMCPCMatrix",a),"box"===t.lastFormat){const e=i.getActiveCamera().getPosition();t.tris.getProgram().setUniform3f("camPos",e[0],e[1],e[2])}t.tris.getVAO().bind(),t.context.drawArrays(t.context.TRIANGLES,0,t.tris.getCABO().getElementCount()),t.tris.getVAO().release(),t.openGLTexture.deactivate()}},e.updateBufferObjects=()=>{if(!t.tris.getCABO().getElementCount()){const e=new Float32Array(12);for(let t=0;t<4;t++)e[3*t]=t%2*2-1,e[3*t+1]=t>1?1:-1,e[3*t+2]=1;const n=o.default.newInstance({numberOfComponents:3,values:e});n.setName("points");const r=new Uint16Array(8);r[0]=3,r[1]=0,r[2]=1,r[3]=3,r[4]=3,r[5]=0,r[6]=3,r[7]=2;const i=o.default.newInstance({numberOfComponents:1,values:r});t.tris.getCABO().createVBO(i,"polys",c.hX.SURFACE,{points:n,cellOffset:0})}t.renderable.getFormat()!==t.lastFormat&&(t.lastFormat=t.renderable.getFormat(),"box"===t.lastFormat&&t.tris.setProgram(t._openGLRenderWindow.getShaderCache().readyShaderProgramArray("//VTK::System::Dec\n             attribute vec3 vertexMC;\n             uniform mat4 IMCPCMatrix;\n             varying vec3 TexCoords;\n             void main () {\n              gl_Position = vec4(vertexMC.xyz, 1.0);\n              vec4 wpos = IMCPCMatrix * gl_Position;\n              TexCoords = wpos.xyz/wpos.w;\n             }","//VTK::System::Dec\n             //VTK::Output::Dec\n             varying vec3 TexCoords;\n             uniform samplerCube sbtexture;\n             uniform vec3 camPos;\n             void main () {\n               // skybox looks from inside out\n               // which means we have to adjust\n               // our tcoords. Otherwise text would\n               // be flipped\n               vec3 tc = normalize(TexCoords - camPos);\n               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))\n               {\n                 tc = vec3(1.0, 1.0, -1.0) * tc;\n               }\n               else\n               {\n                 tc = vec3(-1.0, 1.0, 1.0) * tc;\n               }\n               gl_FragData[0] = textureCube(sbtexture, tc);\n             }","")),"background"===t.lastFormat&&t.tris.setProgram(t._openGLRenderWindow.getShaderCache().readyShaderProgramArray("//VTK::System::Dec\n             attribute vec3 vertexMC;\n             uniform mat4 IMCPCMatrix;\n             varying vec2 TexCoords;\n             void main () {\n              gl_Position = vec4(vertexMC.xyz, 1.0);\n              vec4 wpos = IMCPCMatrix * gl_Position;\n              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;\n             }","//VTK::System::Dec\n             //VTK::Output::Dec\n             varying vec2 TexCoords;\n             uniform sampler2D sbtexture;\n             void main () {\n               gl_FragData[0] = texture2D(sbtexture, TexCoords);\n             }","")),t.tris.getShaderSourceTime().modified(),t.tris.getVAO().bind(),t.tris.getVAO().addAttributeArray(t.tris.getProgram(),t.tris.getCABO(),"vertexMC",t.tris.getCABO().getVertexOffset(),t.tris.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||d("Error setting vertexMC in shader VAO."));const e=t.renderable.getTextures();e.length||d("vtkSkybox requires a texture map"),t.openGLTexture.getRenderable()!==e[0]&&(t.openGLTexture.releaseGraphicsResources(t._openGLRenderWindow),t.openGLTexture.setRenderable(e[0]))}}(e,t)}const f=(0,i.n)(h);var m={newInstance:f,extend:h};(0,u.vw)("vtkSkybox",f)},41247:(e,t,n)=>{"use strict";n.d(t,{default:()=>w});var r=n(87730),i=n(32069),o=n(68470),a=n(54131),s=n(59474),l=n(6814),c=n(11145);const{Wrap:u,Filter:d}=r.default,{VtkDataTypes:p}=a.default,{vtkDebugMacro:h,vtkErrorMacro:f,vtkWarningMacro:m}=o.c,{toHalf:g}=i.default;function v(e,t){function n(e,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[];let o=t.width*t.height*t.components;if(r&&(o*=t.depth),e!==p.FLOAT&&t.openGLDataType===t.context.FLOAT)for(let e=0;e<n.length;e++)if(n[e]){const t=n[e].length>o?n[e].subarray(0,o):n[e];i.push(new Float32Array(t))}else i.push(null);if(e!==p.UNSIGNED_CHAR&&t.openGLDataType===t.context.UNSIGNED_BYTE)for(let e=0;e<n.length;e++)if(n[e]){const t=n[e].length>o?n[e].subarray(0,o):n[e];i.push(new Uint8Array(t))}else i.push(null);let a=!1;if(t._openGLRenderWindow.getWebgl2())a=t.openGLDataType===t.context.HALF_FLOAT;else{const e=t.context.getExtension("OES_texture_half_float");a=e&&t.openGLDataType===e.HALF_FLOAT_OES}if(a)for(let e=0;e<n.length;e++)if(n[e]){const t=new Uint16Array(o),r=n[e];for(let e=0;e<o;e++)t[e]=g(r[e]);i.push(t)}else i.push(null);if(0===i.length)for(let e=0;e<n.length;e++)i.push(n[e]);return i}function r(e){if(t._openGLRenderWindow.getWebgl2())return e;const n=[],r=t.width,o=t.height,a=t.components;if(e&&(!(0,s.U)(r)||!(0,s.U)(o))){const l=t.context.getExtension("OES_texture_half_float"),c=(0,s.Q)(r),u=(0,s.Q)(o),d=c*u*t.components;for(let s=0;s<e.length;s++)if(null!==e[s]){let p=null;const h=o/u,f=r/c;let m=!1;t.openGLDataType===t.context.FLOAT?p=new Float32Array(d):l&&t.openGLDataType===l.HALF_FLOAT_OES?(p=new Uint16Array(d),m=!0):p=new Uint8Array(d);for(let t=0;t<u;t++){const n=t*c*a,l=t*h;let u=Math.floor(l),d=Math.ceil(l);d>=o&&(d=o-1);const g=l-u,v=1-g;u=u*r*a,d=d*r*a;for(let t=0;t<c;t++){const o=t*a,l=t*f;let c=Math.floor(l),h=Math.ceil(l);h>=r&&(h=r-1);const y=l-c;c*=a,h*=a;for(let t=0;t<a;t++)p[n+o+t]=m?i.default.toHalf(i.default.fromHalf(e[s][u+c+t])*v*(1-y)+i.default.fromHalf(e[s][u+h+t])*v*y+i.default.fromHalf(e[s][d+c+t])*g*(1-y)+i.default.fromHalf(e[s][d+h+t])*g*y):e[s][u+c+t]*v*(1-y)+e[s][u+h+t]*v*y+e[s][d+c+t]*g*(1-y)+e[s][d+h+t]*g*y}}n.push(p),t.width=c,t.height=u}else n.push(null)}if(0===n.length)for(let t=0;t<e.length;t++)n.push(e[t]);return n}function l(e){if(t._openGLRenderWindow){if(t.resizable||t.renderable?.getResizable())return!1;if(t._openGLRenderWindow.getWebgl2()){return!(t._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&t.oglNorm16Ext)||e!==p.UNSIGNED_SHORT&&e!==p.SHORT}return!1}return!1}function c(n,r){const i=n.getNumberOfComponents(),o=n.getDataType(),a=n.getData(),s=new Array(i),l=new Array(i);for(let e=0;e<i;++e){const[t,r]=n.getRange(e);s[e]=t,l[e]=r}const c=function(e,t,n){const r=new Array(n),i=new Array(n);for(let o=0;o<n;++o)r[o]=e[o],i[o]=t[o]-e[o]||1;return{scale:i,offset:r}}(s,l,i);return function(n,r,i,o){e.getOpenGLDataType(n);let a=!1;if(t._openGLRenderWindow.getWebgl2())a=t.openGLDataType===t.context.HALF_FLOAT;else{const e=t.context.getExtension("OES_texture_half_float");a=e&&t.openGLDataType===e.HALF_FLOAT_OES}const s=a&&(function(e,t){for(let n=0;n<e.length;n++){const r=e[n],i=t[n]+r;if(r<-2048||r>2048||i<-2048||i>2048)return!1}return!0}(r,i)||o);t.useHalfFloat=s}(o,c.offset,c.scale,r),t.useHalfFloat||e.getOpenGLDataType(o,!0),{numComps:i,dataType:o,data:a,scaleOffsets:c}}t.classHierarchy.push("vtkOpenGLTexture"),e.render=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n?t._openGLRenderWindow=n:(t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent()),t.context=t._openGLRenderWindow.getContext(),t.renderable.getInterpolate()?(t.generateMipmap?e.setMinificationFilter(d.LINEAR_MIPMAP_LINEAR):e.setMinificationFilter(d.LINEAR),e.setMagnificationFilter(d.LINEAR)):(e.setMinificationFilter(d.NEAREST),e.setMagnificationFilter(d.NEAREST)),t.renderable.getRepeat()&&(e.setWrapR(u.REPEAT),e.setWrapS(u.REPEAT),e.setWrapT(u.REPEAT)),t.renderable.getInputData()&&t.renderable.setImage(null),!t.handle||t.renderable.getMTime()>t.textureBuildTime.getMTime()){if(null!==t.renderable.getImage()&&(t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(d.LINEAR_MIPMAP_LINEAR)),t.renderable.getImage()&&t.renderable.getImageLoaded()&&(e.create2DFromImage(t.renderable.getImage()),e.activate(),e.sendParameters(),t.textureBuildTime.modified())),null!==t.renderable.getCanvas()){t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(d.LINEAR_MIPMAP_LINEAR));const n=t.renderable.getCanvas();e.create2DFromRaw(n.width,n.height,4,p.UNSIGNED_CHAR,n,!0),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}if(null!==t.renderable.getJsImageData()){const n=t.renderable.getJsImageData();t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(d.LINEAR_MIPMAP_LINEAR)),e.create2DFromRaw(n.width,n.height,4,p.UNSIGNED_CHAR,n.data,!0),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}const n=t.renderable.getInputData(0);if(n&&n.getPointData().getScalars()){const r=n.getExtent(),i=n.getPointData().getScalars(),o=[];for(let e=0;e<t.renderable.getNumberOfInputPorts();++e){const n=t.renderable.getInputData(e),r=n?n.getPointData().getScalars().getData():null;r&&o.push(r)}t.renderable.getInterpolate()&&4===i.getNumberOfComponents()&&(t.generateMipmap=!0,e.setMinificationFilter(d.LINEAR_MIPMAP_LINEAR)),o.length%6==0?e.createCubeFromRaw(r[1]-r[0]+1,r[3]-r[2]+1,i.getNumberOfComponents(),i.getDataType(),o):e.create2DFromRaw(r[1]-r[0]+1,r[3]-r[2]+1,i.getNumberOfComponents(),i.getDataType(),i.getData()),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}}t.handle&&e.activate()},e.destroyTexture=()=>{e.deactivate(),t.context&&t.handle&&t.context.deleteTexture(t.handle),t.handle=0,t.numberOfDimensions=0,t.target=0,t.components=0,t.width=0,t.height=0,t.depth=0,e.resetFormatAndType()},e.createTexture=()=>{t.handle||(t.handle=t.context.createTexture(),t.target&&(t.context.bindTexture(t.target,t.handle),t.context.texParameteri(t.target,t.context.TEXTURE_MIN_FILTER,e.getOpenGLFilterMode(t.minificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_MAG_FILTER,e.getOpenGLFilterMode(t.magnificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_S,e.getOpenGLWrapMode(t.wrapS)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_T,e.getOpenGLWrapMode(t.wrapT)),t._openGLRenderWindow.getWebgl2()&&t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_R,e.getOpenGLWrapMode(t.wrapR)),t.context.bindTexture(t.target,null)))},e.getTextureUnit=()=>t._openGLRenderWindow?t._openGLRenderWindow.getTextureUnitForTexture(e):-1,e.activate=()=>{t._openGLRenderWindow.activateTexture(e),e.bind()},e.deactivate=()=>{t._openGLRenderWindow&&t._openGLRenderWindow.deactivateTexture(e)},e.releaseGraphicsResources=n=>{n&&t.handle&&(n.activateTexture(e),n.deactivateTexture(e),t.context.deleteTexture(t.handle),t.handle=0,t.numberOfDimensions=0,t.target=0,t.internalFormat=0,t.format=0,t.openGLDataType=0,t.components=0,t.width=0,t.height=0,t.depth=0,t.allocatedGPUMemoryInBytes=0),t.shaderProgram&&(t.shaderProgram.releaseGraphicsResources(n),t.shaderProgram=null)},e.bind=()=>{t.context.bindTexture(t.target,t.handle),t.autoParameters&&e.getMTime()>t.sendParametersTime.getMTime()&&e.sendParameters()},e.isBound=()=>{let e=!1;if(t.context&&t.handle){let n=0;if(t.target===t.context.TEXTURE_2D)n=t.context.TEXTURE_BINDING_2D;else m("impossible case");e=t.context.getIntegerv(n)===t.handle}return e},e.sendParameters=()=>{t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_S,e.getOpenGLWrapMode(t.wrapS)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_T,e.getOpenGLWrapMode(t.wrapT)),t._openGLRenderWindow.getWebgl2()&&t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_R,e.getOpenGLWrapMode(t.wrapR)),t.context.texParameteri(t.target,t.context.TEXTURE_MIN_FILTER,e.getOpenGLFilterMode(t.minificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_MAG_FILTER,e.getOpenGLFilterMode(t.magnificationFilter)),t._openGLRenderWindow.getWebgl2()&&(t.context.texParameteri(t.target,t.context.TEXTURE_BASE_LEVEL,t.baseLevel),t.context.texParameteri(t.target,t.context.TEXTURE_MAX_LEVEL,t.maxLevel)),t.sendParametersTime.modified()},e.getInternalFormat=(n,r)=>(t._forceInternalFormat||(t.internalFormat=e.getDefaultInternalFormat(n,r)),t.internalFormat||h(`Unable to find suitable internal format for T=${n} NC= ${r}`),[t.context.R32F,t.context.RG32F,t.context.RGB32F,t.context.RGBA32F].includes(t.internalFormat)&&!t.context.getExtension("OES_texture_float_linear")&&m("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),t.internalFormat),e.getDefaultInternalFormat=(e,n)=>{let r=0;return r=t._openGLRenderWindow.getDefaultTextureInternalFormat(e,n,t.oglNorm16Ext,t.useHalfFloat),r||(r||(h("Unsupported internal texture type!"),h(`Unable to find suitable internal format for T=${e} NC= ${n}`)),r)},e.setInternalFormat=n=>{t._forceInternalFormat=!0,n!==t.internalFormat&&(t.internalFormat=n,e.modified())},e.getFormat=(n,r)=>(t.format=e.getDefaultFormat(n,r),t.format),e.getDefaultFormat=(e,n)=>{if(t._openGLRenderWindow.getWebgl2())switch(n){case 1:return t.context.RED;case 2:return t.context.RG;case 3:default:return t.context.RGB;case 4:return t.context.RGBA}else switch(n){case 1:return t.context.LUMINANCE;case 2:return t.context.LUMINANCE_ALPHA;case 3:default:return t.context.RGB;case 4:return t.context.RGBA}},e.resetFormatAndType=()=>{t.format=0,t.internalFormat=0,t._forceInternalFormat=!1,t.openGLDataType=0},e.getDefaultDataType=e=>{if(t._openGLRenderWindow.getWebgl2())switch(e){case p.UNSIGNED_CHAR:return t.context.UNSIGNED_BYTE;case t.oglNorm16Ext&&!t.useHalfFloat&&p.SHORT:return t.context.SHORT;case t.oglNorm16Ext&&!t.useHalfFloat&&p.UNSIGNED_SHORT:return t.context.UNSIGNED_SHORT;case t.useHalfFloat&&p.SHORT:case t.useHalfFloat&&p.UNSIGNED_SHORT:return t.context.HALF_FLOAT;case p.FLOAT:case p.VOID:default:return t.context.FLOAT}switch(e){case p.UNSIGNED_CHAR:return t.context.UNSIGNED_BYTE;case p.FLOAT:case p.VOID:default:if(t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear"))return t.context.FLOAT;{const e=t.context.getExtension("OES_texture_half_float");if(e&&t.context.getExtension("OES_texture_half_float_linear"))return e.HALF_FLOAT_OES}return t.context.UNSIGNED_BYTE}},e.getOpenGLDataType=function(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.openGLDataType&&!r||(t.openGLDataType=e.getDefaultDataType(n)),t.openGLDataType},e.getShiftAndScale=()=>{let e=0,n=1;switch(t.openGLDataType){case t.context.BYTE:n=127.5,e=n-128;break;case t.context.UNSIGNED_BYTE:n=255,e=0;break;case t.context.SHORT:n=32767.5,e=n-32768;break;case t.context.UNSIGNED_SHORT:n=65536,e=0;break;case t.context.INT:n=2147483647.5,e=n-2147483648;break;case t.context.UNSIGNED_INT:n=4294967295,e=0;case t.context.FLOAT:}return{shift:e,scale:n}},e.getOpenGLFilterMode=e=>{switch(e){case d.NEAREST:return t.context.NEAREST;case d.LINEAR:return t.context.LINEAR;case d.NEAREST_MIPMAP_NEAREST:return t.context.NEAREST_MIPMAP_NEAREST;case d.NEAREST_MIPMAP_LINEAR:return t.context.NEAREST_MIPMAP_LINEAR;case d.LINEAR_MIPMAP_NEAREST:return t.context.LINEAR_MIPMAP_NEAREST;case d.LINEAR_MIPMAP_LINEAR:return t.context.LINEAR_MIPMAP_LINEAR;default:return t.context.NEAREST}},e.getOpenGLWrapMode=e=>{switch(e){case u.CLAMP_TO_EDGE:return t.context.CLAMP_TO_EDGE;case u.REPEAT:return t.context.REPEAT;case u.MIRRORED_REPEAT:return t.context.MIRRORED_REPEAT;default:return t.context.CLAMP_TO_EDGE}},e.create2DFromRaw=function(i,o,a,s,c){let u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e.getOpenGLDataType(s,!0),e.getInternalFormat(s,a),e.getFormat(s,a),!t.internalFormat||!t.format||!t.openGLDataType)return f("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=a,t.width=i,t.height=o,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind();const d=r(n(s,[c]));return t.context.pixelStorei(t.context.UNPACK_FLIP_Y_WEBGL,u),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),l(s)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=d[0]&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,d[0])):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,d[0]),t.generateMipmap&&t.context.generateMipmap(t.target),u&&t.context.pixelStorei(t.context.UNPACK_FLIP_Y_WEBGL,!1),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*a*t._openGLRenderWindow.getDefaultTextureByteSize(s,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.createCubeFromRaw=(i,a,s,c,u)=>{if(e.getOpenGLDataType(c),e.getInternalFormat(c,s),e.getFormat(c,s),!t.internalFormat||!t.format||!t.openGLDataType)return f("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_CUBE_MAP,t.components=s,t.width=i,t.height=a,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),t.maxLevel=u.length/6-1,e.createTexture(),e.bind();const d=r(n(c,u)),p=[];let h=t.width,m=t.height;for(let e=0;e<d.length;e++){e%6==0&&0!==e&&(h/=2,m/=2),p[e]=(0,o.a)(c,m*h*t.components);for(let n=0;n<m;++n){const r=n*h*t.components,i=(m-n-1)*h*t.components;p[e].set(d[e].slice(i,i+h*t.components),r)}}t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),l(c)&&t.context.texStorage2D(t.target,6,t.internalFormat,t.width,t.height);for(let e=0;e<6;e++){let n=0,r=t.width,i=t.height;for(;r>=1&&i>=1;){let o=null;n<=t.maxLevel&&(o=p[6*n+e]),l(c)?null!=o&&t.context.texSubImage2D(t.context.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,r,i,t.format,t.openGLDataType,o):t.context.texImage2D(t.context.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,t.internalFormat,r,i,0,t.format,t.openGLDataType,o),n++,r/=2,i/=2}}return t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*s*t._openGLRenderWindow.getDefaultTextureByteSize(c,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.createDepthFromRaw=(n,r,i,o)=>(e.getOpenGLDataType(i),t.format=t.context.DEPTH_COMPONENT,t._openGLRenderWindow.getWebgl2()?i===p.FLOAT?t.internalFormat=t.context.DEPTH_COMPONENT32F:t.internalFormat=t.context.DEPTH_COMPONENT16:t.internalFormat=t.context.DEPTH_COMPONENT,t.internalFormat&&t.format&&t.openGLDataType?(t.target=t.context.TEXTURE_2D,t.components=1,t.width=n,t.height=r,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),l(i)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=o&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,o)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,o),t.generateMipmap&&t.context.generateMipmap(t.target),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*t.components*t._openGLRenderWindow.getDefaultTextureByteSize(i,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0):(f("Failed to determine texture parameters."),!1)),e.create2DFromImage=n=>{if(e.getOpenGLDataType(p.UNSIGNED_CHAR),e.getInternalFormat(p.UNSIGNED_CHAR,4),e.getFormat(p.UNSIGNED_CHAR,4),!t.internalFormat||!t.format||!t.openGLDataType)return f("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=4,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1);const r=!(t._openGLRenderWindow.getWebgl2()||(0,s.U)(n.width)&&(0,s.U)(n.height)),i=document.createElement("canvas");i.width=r?(0,s.Q)(n.width):n.width,i.height=r?(0,s.Q)(n.height):n.height,t.width=i.width,t.height=i.height;const o=i.getContext("2d");o.translate(0,i.height),o.scale(1,-1),o.drawImage(n,0,0,n.width,n.height,0,0,i.width,i.height);const a=i;return l(p.UNSIGNED_CHAR)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=a&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,a)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,a),t.generateMipmap&&t.context.generateMipmap(t.target),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*t.components*t._openGLRenderWindow.getDefaultTextureByteSize(p.UNSIGNED_CHAR,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.create2DFilterableFromRaw=function(t,n,r,i,o){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return e.create2DFilterableFromDataArray(t,n,a.default.newInstance({numberOfComponents:r,dataType:i,values:o}),s)},e.create2DFilterableFromDataArray=function(t,n,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{numComps:o,dataType:a,data:s}=c(r,i);e.create2DFromRaw(t,n,o,a,s)},e.create3DFromRaw=(i,o,a,s,c,u)=>{if(e.getOpenGLDataType(c),e.getInternalFormat(c,s),e.getFormat(c,s),!t.internalFormat||!t.format||!t.openGLDataType)return f("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_3D,t.components=s,t.width=i,t.height=o,t.depth=a,t.numberOfDimensions=3,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind();const d=r(n(c,[u],!0));return t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),l(c)?(t.context.texStorage3D(t.target,1,t.internalFormat,t.width,t.height,t.depth),null!=d[0]&&t.context.texSubImage3D(t.target,0,0,0,0,t.width,t.height,t.depth,t.format,t.openGLDataType,d[0])):t.context.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.openGLDataType,d[0]),t.generateMipmap&&t.context.generateMipmap(t.target),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*t.components*t._openGLRenderWindow.getDefaultTextureByteSize(c,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.create3DFilterableFromRaw=function(t,n,r,i,o,s){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return e.create3DFilterableFromDataArray(t,n,r,a.default.newInstance({numberOfComponents:i,dataType:o,values:s}),l)},e.create3DFilterableFromDataArray=function(n,r,i,o){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{numComps:u,dataType:d,data:h,scaleOffsets:m}=c(o,a),g=n*r*i,v=[],y=[];for(let e=0;e<u;++e)v[e]=0,y[e]=1;t.volumeInfo={scale:y,offset:v,dataComputedScale:m.scale,dataComputedOffset:m.offset,width:n,height:r,depth:i};const b=structuredClone(m);if(t._openGLRenderWindow.getWebgl2()){if(t.oglNorm16Ext&&!t.useHalfFloat&&d===p.SHORT){for(let e=0;e<u;++e)t.volumeInfo.scale[e]=32767;return e.create3DFromRaw(n,r,i,u,d,h)}if(t.oglNorm16Ext&&!t.useHalfFloat&&d===p.UNSIGNED_SHORT){for(let e=0;e<u;++e)t.volumeInfo.scale[e]=65535;return e.create3DFromRaw(n,r,i,u,d,h)}if(d===p.FLOAT||t.useHalfFloat&&(d===p.SHORT||d===p.UNSIGNED_SHORT))return e.create3DFromRaw(n,r,i,u,d,h);if(d===p.UNSIGNED_CHAR){for(let e=0;e<u;++e)t.volumeInfo.scale[e]=255;return e.create3DFromRaw(n,r,i,u,d,h)}const o=new Float32Array(g*u);t.volumeInfo.offset=b.offset,t.volumeInfo.scale=b.scale;let a=0;const s=b.scale.map(e=>1/e);for(let e=0;e<g;e++)for(let e=0;e<u;e++)o[a]=(h[a]-b.offset[e])*s[e],a++;return e.create3DFromRaw(n,r,i,u,p.FLOAT,o)}let C=(e,t,n,r,i)=>{e[t]=n},w=p.UNSIGNED_CHAR;if(d===p.UNSIGNED_CHAR)for(let e=0;e<u;++e)b.offset[e]=0,b.scale[e]=255;else t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear")?(w=p.FLOAT,C=(e,t,n,r,i)=>{e[t]=(n-r)/i}):(w=p.UNSIGNED_CHAR,C=(e,t,n,r,i)=>{e[t]=255*(n-r)/i});if(e.getOpenGLDataType(w),e.getInternalFormat(w,u),e.getFormat(w,u),!t.internalFormat||!t.format||!t.openGLDataType)return f("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=u,t.depth=1,t.numberOfDimensions=2;let E=t.context.getParameter(t.context.MAX_TEXTURE_SIZE);E>4096&&(w===p.FLOAT||u>=3)&&(E=4096);let T=1,x=1;g>E*E&&(T=Math.ceil(Math.sqrt(g/(E*E))),x=T);let _=Math.sqrt(g)/T;_=(0,s.Q)(_);const S=Math.floor(_*T/n),I=Math.ceil(i/S),D=(0,s.Q)(r*I/x);let A;t.width=_,t.height=D,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.volumeInfo.xreps=S,t.volumeInfo.yreps=I,t.volumeInfo.xstride=T,t.volumeInfo.ystride=x,t.volumeInfo.offset=b.offset,t.volumeInfo.scale=b.scale;const P=_*D*u;A=w===p.FLOAT?new Float32Array(P):new Uint8Array(P);let O=0;const R=Math.floor(n/T),M=Math.floor(r/x);for(let e=0;e<I;e++){const o=Math.min(S,i-e*S),a=u*(t.width-o*Math.floor(n/T));for(let t=0;t<M;t++){for(let i=0;i<o;i++){const o=u*((e*S+i)*n*r+x*t*n);for(let e=0;e<R;e++)for(let t=0;t<u;t++)C(A,O,h[o+T*e*u+t],b.offset[t],b.scale[t]),O++}O+=a}}return t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),l(w)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=A&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,A)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,A),e.deactivate(),!0},e.setOpenGLRenderWindow=n=>{t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))},e.getMaximumTextureSize=e=>e&&e.isCurrent()?e.getIntegerv(e.MAX_TEXTURE_SIZE):-1}const y={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:u.CLAMP_TO_EDGE,wrapT:u.CLAMP_TO_EDGE,wrapR:u.CLAMP_TO_EDGE,minificationFilter:d.NEAREST,magnificationFilter:d.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,useHalfFloat:!0,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0};function b(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,y,n),l.Z.extend(e,t,n),t.sendParametersTime={},(0,o.o)(t.sendParametersTime,{mtime:0}),t.textureBuildTime={},(0,o.o)(t.textureBuildTime,{mtime:0}),(0,o.s)(e,t,["format","openGLDataType"]),(0,o.e)(e,t,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),(0,o.g)(e,t,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),(0,o.i)(e,t,["openGLRenderWindow"]),v(e,t)}const C=(0,o.n)(b,"vtkOpenGLTexture");var w={newInstance:C,extend:b,...r.default};(0,c.vw)("vtkTexture",C)},87730:(e,t,n)=>{"use strict";n.d(t,{E:()=>r,default:()=>o,w:()=>i});const r={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},i={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var o={Wrap:r,Filter:i}},62739:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>s});var r=n(68470),i=n(37148);const o={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,o,n),t.buffers=[],r.m.obj(e,t),r.m.get(e,t,["supported"]),r.m.setGet(e,t,["forceEmulation"]),function(e,t){t.classHierarchy.push("vtkOpenGLVertexArrayObject"),e.exposedMethod=()=>{},e.initialize=()=>{t.instancingExtension=null,t._openGLRenderWindow.getWebgl2()||(t.instancingExtension=t.context.getExtension("ANGLE_instanced_arrays")),!t.forceEmulation&&t._openGLRenderWindow&&t._openGLRenderWindow.getWebgl2()?(t.extension=null,t.supported=!0,t.handleVAO=t.context.createVertexArray()):(t.extension=t.context.getExtension("OES_vertex_array_object"),!t.forceEmulation&&t.extension?(t.supported=!0,t.handleVAO=t.extension.createVertexArrayOES()):t.supported=!1)},e.isReady=()=>0!==t.handleVAO||!1===t.supported,e.bind=()=>{if(e.isReady()||e.initialize(),e.isReady()&&t.supported)t.extension?t.extension.bindVertexArrayOES(t.handleVAO):t.context.bindVertexArray(t.handleVAO);else if(e.isReady()){const e=t.context;for(let n=0;n<t.buffers.length;++n){const r=t.buffers[n];t.context.bindBuffer(e.ARRAY_BUFFER,r.buffer);for(let n=0;n<r.attributes.length;++n){const i=r.attributes[n],o=i.isMatrix?i.size:1;for(let n=0;n<o;++n)e.enableVertexAttribArray(i.index+n),e.vertexAttribPointer(i.index+n,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*n/i.size),i.divisor>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(i.index+n,1):e.vertexAttribDivisor(i.index+n,1))}}}},e.release=()=>{if(e.isReady()&&t.supported)t.extension?t.extension.bindVertexArrayOES(null):t.context.bindVertexArray(null);else if(e.isReady()){const e=t.context;for(let n=0;n<t.buffers.length;++n){const r=t.buffers[n];t.context.bindBuffer(e.ARRAY_BUFFER,r.buffer);for(let n=0;n<r.attributes.length;++n){const i=r.attributes[n],o=i.isMatrix?i.size:1;for(let n=0;n<o;++n)e.enableVertexAttribArray(i.index+n),e.vertexAttribPointer(i.index+n,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*n/i.size),i.divisor>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(i.index+n,0):e.vertexAttribDivisor(i.index+n,0)),e.disableVertexAttribArray(i.index+n)}}}},e.shaderProgramChanged=()=>{e.release(),t.handleVAO&&(t.extension?t.extension.deleteVertexArrayOES(t.handleVAO):t.context.deleteVertexArray(t.handleVAO)),t.handleVAO=0,t.handleProgram=0},e.releaseGraphicsResources=()=>{e.shaderProgramChanged(),t.handleVAO&&(t.extension?t.extension.deleteVertexArrayOES(t.handleVAO):t.context.deleteVertexArray(t.handleVAO)),t.handleVAO=0,t.supported=!0,t.handleProgram=0},e.addAttributeArray=(t,n,r,i,o,a,s,l)=>e.addAttributeArrayWithDivisor(t,n,r,i,o,a,s,l,0,!1),e.addAttributeArrayWithDivisor=(n,r,o,a,s,l,c,u,d,p)=>{if(!n)return!1;if(!n.isBound()||0===r.getHandle()||r.getType()!==i.L.ARRAY_BUFFER)return!1;if(0===t.handleProgram&&(t.handleProgram=n.getHandle()),e.isReady()||e.initialize(),!e.isReady()||t.handleProgram!==n.getHandle())return!1;const h=t.context,f={};if(f.name=o,f.index=h.getAttribLocation(t.handleProgram,o),f.offset=a,f.stride=s,f.type=l,f.size=c,f.normalize=u,f.isMatrix=p,f.divisor=d,-1===f.Index)return!1;if(r.bind(),h.enableVertexAttribArray(f.index),h.vertexAttribPointer(f.index,f.size,f.type,f.normalize,f.stride,f.offset),d>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(f.index,1):h.vertexAttribDivisor(f.index,1)),f.buffer=r.getHandle(),!t.supported){let e=!1;for(let n=0;n<t.buffers.length;++n){const r=t.buffers[n];if(r.buffer===f.buffer){e=!0;let t=!1;for(let e=0;e<r.attributes.length;++e)r.attributes[e].name===o&&(t=!0,r.attributes[e]=f);t||r.attributes.push(f)}}e||t.buffers.push({buffer:f.buffer,attributes:[f]})}return!0},e.addAttributeMatrixWithDivisor=(n,r,i,o,a,s,l,c,u)=>{const d=e.addAttributeArrayWithDivisor(n,r,i,o,a,s,l,c,u,!0);if(!d)return d;const p=t.context,h=p.getAttribLocation(t.handleProgram,i);for(let e=1;e<l;e++)p.enableVertexAttribArray(h+e),p.vertexAttribPointer(h+e,l,s,c,a,o+a*e/l),u>0&&(t.instancingExtension?t.instancingExtension.vertexAttribDivisorANGLE(h+e,1):p.vertexAttribDivisor(h+e,1));return!0},e.removeAttributeArray=n=>{if(!e.isReady()||0===t.handleProgram)return!1;if(!t.supported)for(let e=0;e<t.buffers.length;++e){const r=t.buffers[e];for(let i=0;i<r.attributes.length;++i)if(r.attributes[i].name===n)return r.attributes.splice(i,1),r.attributes.length||t.buffers.splice(e,1),!0}return!0},e.setOpenGLRenderWindow=n=>{t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))}}(e,t)}var s={newInstance:r.m.newInstance(a,"vtkOpenGLVertexArrayObject"),extend:a}},11145:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c,vw:()=>a});var r=n(68470),i=n(79410);const o=Object.create(null);function a(e,t){o[e]=t}const s={};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),t.overrides=o,i.ZP.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkOpenGLViewNodeFactory")}(0,t)}var c={newInstance:r.m.newInstance(l,"vtkOpenGLViewNodeFactory"),extend:l}},10905:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(72076),i=n(68470),o=n(6814),a=n(11145);const s={};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),o.Z.extend(e,t,n),t.keyMatrixTime={},(0,i.o)(t.keyMatrixTime,{mtime:0}),t.normalMatrix=new Float64Array(9),t.MCWCMatrix=new Float64Array(16),(0,i.e)(e,t,["context"]),function(e,t){t.classHierarchy.push("vtkOpenGLVolume"),e.buildPass=n=>{t.renderable&&t.renderable.getVisibility()&&n&&(t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t.context=t._openGLRenderWindow.getContext(),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes())},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;n.incrementVolumeCount()}},e.traverseVolumePass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&(!t._openGLRenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children[0].traverse(n),e.apply(n,!1))},e.volumePass=e=>{t.renderable&&t.renderable.getVisibility()&&t.context.depthMask(!e)},e.getKeyMatrices=()=>(t.renderable.getMTime()>t.keyMatrixTime.getMTime()&&(t.renderable.computeMatrix(),r._E.copy(t.MCWCMatrix,t.renderable.getMatrix()),r._E.transpose(t.MCWCMatrix,t.MCWCMatrix),t.renderable.getIsIdentity()?r.wO.identity(t.normalMatrix):(r.wO.fromMat4(t.normalMatrix,t.MCWCMatrix),r.wO.invert(t.normalMatrix,t.normalMatrix),r.wO.transpose(t.normalMatrix,t.normalMatrix)),t.keyMatrixTime.modified()),{mcwc:t.MCWCMatrix,normalMatrix:t.normalMatrix})}(e,t)}const c=(0,i.n)(l,"vtkOpenGLVolume");var u={newInstance:c,extend:l};(0,a.vw)("vtkVolume",c)},9170:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>A});var r=n(68470),i=n(25686),o=n.n(i),a=n(72076),s=n(54131),l=n(89262),c=n(59269),u=n(59474),d=n(93245),p=n(41247),h=n(51815),f=n(53118),m=n(62739),g=n(6814),v=n(42695),y=n(87730),b=n(54024),C=n(83336),w=n(11145);const{vtkWarningMacro:E,vtkErrorMacro:T}=r.c;function x(e,t,n){return e?`${e.getMTime()}-${t}-${n}`:"0"}function _(e,t){t.classHierarchy.push("vtkOpenGLVolumeMapper"),e.buildPass=()=>{t.zBufferTexture=null},e.zBufferPass=(e,n)=>{if(e){const e=n.getZBufferTexture();e!==t.zBufferTexture&&(t.zBufferTexture=e)}},e.opaqueZBufferPass=(t,n)=>e.zBufferPass(t,n),e.volumePass=(n,r)=>{if(n){t._openGLRenderWindow=e.getFirstAncestorOfType("vtkOpenGLRenderWindow"),t.context=t._openGLRenderWindow.getContext(),t.tris.setOpenGLRenderWindow(t._openGLRenderWindow),t.jitterTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.framebuffer.setOpenGLRenderWindow(t._openGLRenderWindow),t.scalarTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.colorTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.opacityTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.labelOutlineThicknessTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.openGLVolume=e.getFirstAncestorOfType("vtkOpenGLVolume");const n=t.openGLVolume.getRenderable();t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer");const r=t._openGLRenderer.getRenderable();t.openGLCamera=t._openGLRenderer.getViewNodeFor(r.getActiveCamera()),e.renderPiece(r,n)}},e.getShaderTemplate=(e,t,n)=>{e.Vertex="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyDataVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n\nattribute vec4 vertexDC;\n\nvarying vec3 vertexVCVSOutput;\nuniform mat4 PCVCMatrix;\n\nuniform float dcxmin;\nuniform float dcxmax;\nuniform float dcymin;\nuniform float dcymax;\n\nvoid main()\n{\n  // dcsmall is the device coords reduced to the\n  // x y area covered by the volume\n  vec4 dcsmall = vec4(\n    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),\n    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),\n    vertexDC.z,\n    vertexDC.w);\n  vec4 vcpos = PCVCMatrix * dcsmall;\n  vertexVCVSOutput = vcpos.xyz/vcpos.w;\n  gl_Position = dcsmall;\n}\n",e.Fragment="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkVolumeFS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n// Template for the volume mappers fragment shader\n\n// the output of this shader\n//VTK::Output::Dec\n\nvarying vec3 vertexVCVSOutput;\n\n// first declare the settings from the mapper\n// that impact the code paths in here\n\n// always set vtkNumComponents 1,2,3,4\n//VTK::NumComponents\n\n// possibly define vtkTrilinearOn\n//VTK::TrilinearOn\n\n// possibly define UseIndependentComponents\n//VTK::IndependentComponentsOn\n\n// possibly define vtkCustomComponentsColorMix\n//VTK::CustomComponentsColorMixOn\n\n// possibly define any \"proportional\" components\n//VTK::vtkProportionalComponents\n\n// possibly define any components that are forced to nearest interpolation\n//VTK::vtkForceNearestComponents\n\n// Define the blend mode to use\n#define vtkBlendMode //VTK::BlendMode\n\n// Possibly define vtkImageLabelOutlineOn\n//VTK::ImageLabelOutlineOn\n\n#ifdef vtkImageLabelOutlineOn\n\nuniform float outlineOpacity;\nuniform float vpWidth;\nuniform float vpHeight;\nuniform float vpOffsetX;\nuniform float vpOffsetY;\nuniform mat4 PCWCMatrix;\nuniform mat4 vWCtoIDX;\n#endif\n\n// define vtkLightComplexity\n//VTK::LightComplexity\n#if vtkLightComplexity > 0\nuniform float vSpecularPower;\nuniform float vAmbient;\nuniform float vDiffuse;\nuniform float vSpecular;\n//VTK::Light::Dec\n#endif\n\n//VTK::VolumeShadowOn\n//VTK::SurfaceShadowOn\n//VTK::localAmbientOcclusionOn\n//VTK::LAO::Dec\n//VTK::VolumeShadow::Dec\n\n// define vtkComputeNormalFromOpacity\n//VTK::vtkComputeNormalFromOpacity\n\n// possibly define vtkGradientOpacityOn\n//VTK::GradientOpacityOn\n#ifdef vtkGradientOpacityOn\nuniform float goscale0;\nuniform float goshift0;\nuniform float gomin0;\nuniform float gomax0;\n#ifdef UseIndependentComponents\n#if vtkNumComponents > 1\nuniform float goscale1;\nuniform float goshift1;\nuniform float gomin1;\nuniform float gomax1;\n#if vtkNumComponents > 2\nuniform float goscale2;\nuniform float goshift2;\nuniform float gomin2;\nuniform float gomax2;\n#if vtkNumComponents > 3\nuniform float goscale3;\nuniform float goshift3;\nuniform float gomin3;\nuniform float gomax3;\n#endif\n#endif\n#endif\n#endif\n#endif\n\n// if you want to see the raw tiled\n// data in webgl1 uncomment the following line\n// #define debugtile\n\n// camera values\nuniform float camThick;\nuniform float camNear;\nuniform float camFar;\nuniform int cameraParallel;\n\n// values describing the volume geometry\nuniform vec3 vOriginVC;\nuniform vec3 vSpacing;\nuniform ivec3 volumeDimensions; // 3d texture dimensions\nuniform vec3 vPlaneNormal0;\nuniform float vPlaneDistance0;\nuniform vec3 vPlaneNormal1;\nuniform float vPlaneDistance1;\nuniform vec3 vPlaneNormal2;\nuniform float vPlaneDistance2;\nuniform vec3 vPlaneNormal3;\nuniform float vPlaneDistance3;\nuniform vec3 vPlaneNormal4;\nuniform float vPlaneDistance4;\nuniform vec3 vPlaneNormal5;\nuniform float vPlaneDistance5;\n\n//VTK::ClipPlane::Dec\n\n// opacity and color textures\nuniform sampler2D otexture;\nuniform float oshift0;\nuniform float oscale0;\nuniform sampler2D ctexture;\nuniform float cshift0;\nuniform float cscale0;\n\n#if vtkNumComponents >= 2\nuniform float oshift1;\nuniform float oscale1;\nuniform float cshift1;\nuniform float cscale1;\n#endif\n#if vtkNumComponents >= 3\nuniform float oshift2;\nuniform float oscale2;\nuniform float cshift2;\nuniform float cscale2;\n#endif\n#if vtkNumComponents >= 4\nuniform float oshift3;\nuniform float oscale3;\nuniform float cshift3;\nuniform float cscale3;\n#endif\n\n// jitter texture\nuniform sampler2D jtexture;\nuniform sampler2D ttexture;\n\n\n// some 3D texture values\nuniform float sampleDistance;\nuniform vec3 vVCToIJK;\n\n// the heights defined below are the locations\n// for the up to four components of the tfuns\n// the tfuns have a height of 2XnumComps pixels so the\n// values are computed to hit the middle of the two rows\n// for that component\n#ifdef UseIndependentComponents\n#if vtkNumComponents == 1\nuniform float mix0;\n#define height0 0.5\n#endif\n#if vtkNumComponents == 2\nuniform float mix0;\nuniform float mix1;\n#define height0 0.25\n#define height1 0.75\n#endif\n#if vtkNumComponents == 3\nuniform float mix0;\nuniform float mix1;\nuniform float mix2;\n#define height0 0.17\n#define height1 0.5\n#define height2 0.83\n#endif\n#if vtkNumComponents == 4\nuniform float mix0;\nuniform float mix1;\nuniform float mix2;\nuniform float mix3;\n#define height0 0.125\n#define height1 0.375\n#define height2 0.625\n#define height3 0.875\n#endif\n#endif\n\nuniform vec4 ipScalarRangeMin;\nuniform vec4 ipScalarRangeMax;\n\n// declaration for intermixed geometry\n//VTK::ZBuffer::Dec\n\n//=======================================================================\n// global and custom variables (a temporary section before photorealistics rendering module is complete)\nvec3 rayDirVC;\nfloat sampleDistanceISVS;\nfloat sampleDistanceIS;\n\n#define SQRT3    1.7321\n#define INV4PI   0.0796\n#define EPSILON  0.001\n#define PI       3.1415\n#define PI2      9.8696\n\n//=======================================================================\n// Webgl2 specific version of functions\n#if __VERSION__ == 300\n\nuniform highp sampler3D texture1;\n\nvec4 getTextureValue(vec3 pos)\n{\n  vec4 tmp = texture(texture1, pos);\n\n  #if defined(vtkComponent0ForceNearest) || \\\n      defined(vtkComponent1ForceNearest) || \\\n      defined(vtkComponent2ForceNearest) || \\\n      defined(vtkComponent3ForceNearest)\n    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);\n    vec4 nearestValue = texture(texture1, nearestPos);\n    #ifdef vtkComponent0ForceNearest\n      tmp[0] = nearestValue[0];\n    #endif\n    #ifdef vtkComponent1ForceNearest\n      tmp[1] = nearestValue[1];\n    #endif\n    #ifdef vtkComponent2ForceNearest\n      tmp[2] = nearestValue[2];\n    #endif\n    #ifdef vtkComponent3ForceNearest\n      tmp[3] = nearestValue[3];\n    #endif\n  #endif\n\n  #ifndef UseIndependentComponents\n    #if vtkNumComponents == 1\n      tmp.a = tmp.r;\n    #endif\n    #if vtkNumComponents == 2\n      tmp.a = tmp.g;\n    #endif\n    #if vtkNumComponents == 3\n      tmp.a = length(tmp.rgb);\n    #endif\n  #endif\n\n  return tmp;\n}\n\n//=======================================================================\n// WebGL1 specific version of functions\n#else\n\nuniform sampler2D texture1;\n\nuniform float texWidth;\nuniform float texHeight;\nuniform int xreps;\nuniform int xstride;\nuniform int ystride;\n\n// if computing trilinear values from multiple z slices\n#ifdef vtkTrilinearOn\nvec4 getTextureValue(vec3 ijk)\n{\n  float zoff = 1.0/float(volumeDimensions.z);\n  vec4 val1 = getOneTextureValue(ijk);\n  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));\n\n  float indexZ = float(volumeDimensions)*ijk.z;\n  float zmix =  indexZ - floor(indexZ);\n\n  return mix(val1, val2, zmix);\n}\n\nvec4 getOneTextureValue(vec3 ijk)\n#else // nearest or fast linear\nvec4 getTextureValue(vec3 ijk)\n#endif\n{\n  vec3 tdims = vec3(volumeDimensions);\n\n#ifdef debugtile\n  vec2 tpos = vec2(ijk.x, ijk.y);\n  vec4 tmp = texture2D(texture1, tpos);\n  tmp.a = 1.0;\n\n#else\n  int z = int(ijk.z * tdims.z);\n  int yz = z / xreps;\n  int xz = z - yz*xreps;\n\n  int tileWidth = volumeDimensions.x/xstride;\n  int tileHeight = volumeDimensions.y/ystride;\n\n  xz *= tileWidth;\n  yz *= tileHeight;\n\n  float ni = float(xz) + (ijk.x*float(tileWidth));\n  float nj = float(yz) + (ijk.y*float(tileHeight));\n\n  vec2 tpos = vec2(ni/texWidth, nj/texHeight);\n\n  vec4 tmp = texture2D(texture1, tpos);\n\n#if vtkNumComponents == 1\n  tmp.a = tmp.r;\n#endif\n#if vtkNumComponents == 2\n  tmp.g = tmp.a;\n#endif\n#if vtkNumComponents == 3\n  tmp.a = length(tmp.rgb);\n#endif\n#endif\n\n  return tmp;\n}\n\n// End of Webgl1 specific code\n//=======================================================================\n#endif\n\n//=======================================================================\n// transformation between VC and IS space\n\n// convert vector position from idx to vc\n#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)\nvec3 IStoVC(vec3 posIS){\n  vec3 posVC = posIS / vVCToIJK;\n  return posVC.x * vPlaneNormal0 +\n         posVC.y * vPlaneNormal2 +\n         posVC.z * vPlaneNormal4 +\n         vOriginVC;\n}\n\n// convert vector position from vc to idx\nvec3 VCtoIS(vec3 posVC){\n  posVC = posVC - vOriginVC;\n  posVC = vec3(\n    dot(posVC, vPlaneNormal0),\n    dot(posVC, vPlaneNormal2),\n    dot(posVC, vPlaneNormal4));\n  return posVC * vVCToIJK;\n}\n#endif\n\n//Rotate vector to view coordinate\n#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)\nvoid rotateToViewCoord(inout vec3 dirIS){\n  dirIS.xyz =\n    dirIS.x * vPlaneNormal0 +\n    dirIS.y * vPlaneNormal2 +\n    dirIS.z * vPlaneNormal4;\n}\n\n//Rotate vector to idx coordinate\nvec3 rotateToIDX(vec3 dirVC){\n  vec3 dirIS;\n  dirIS.xyz = vec3(\n    dot(dirVC, vPlaneNormal0),\n    dot(dirVC, vPlaneNormal2),\n    dot(dirVC, vPlaneNormal4));\n  return dirIS;\n}\n#endif\n\n//=======================================================================\n// Given a normal compute the gradient opacity factors\nfloat computeGradientOpacityFactor(\n  float normalMag, float goscale, float goshift, float gomin, float gomax)\n{\n  return clamp(normalMag * goscale + goshift, gomin, gomax);\n}\n\n//=======================================================================\n// compute the normal and gradient magnitude for a position, uses forward difference\n#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)\n  #ifdef vtkClippingPlanesOn\n    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)\n    {\n      vec3 g1VC[3];\n      for (int i = 0; i < 3; ++i)\n      {\n        g1VC[i] = IStoVC(texPos[i]);\n      }\n      vec3 posVC = IStoVC(pos);\n      for (int i = 0; i < clip_numPlanes; ++i)\n      {\n        for (int j = 0; j < 3; ++j)\n        {\n          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)\n          {\n            g1[j] = 0.0;\n          }\n        }\n      }\n    }\n  #endif\n\n  #ifdef vtkComputeNormalFromOpacity\n    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {\n      vec3 opacityG1, opacityG2;\n      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;\n      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;\n      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;\n      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;\n      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;\n      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;\n      opacityG1.xyz *= gradientOpacity;\n      opacityG2.xyz *= gradientOpacity;\n\n      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);\n      // divide by spacing\n      opacityG.xyz /= vSpacing;\n      opacityG.w = length(opacityG.xyz);\n      // rotate to View Coords\n      rotateToViewCoord(opacityG.xyz);\n      if (!all(equal(opacityG.xyz, vec3(0.0)))) {\n        return vec4(normalize(opacityG.xyz),opacityG.w);\n      } else {\n        return vec4(0.0);\n      }\n    }\n\n    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)\n    {\n      vec3 xvec = vec3(tstep.x, 0.0, 0.0);\n      vec3 yvec = vec3(0.0, tstep.y, 0.0);\n      vec3 zvec = vec3(0.0, 0.0, tstep.z);\n      vec3 texPosPVec[3];\n      texPosPVec[0] = pos + xvec;\n      texPosPVec[1] = pos + yvec;\n      texPosPVec[2] = pos + zvec;\n      vec3 texPosNVec[3];\n      texPosNVec[0] = pos - xvec;\n      texPosNVec[1] = pos - yvec;\n      texPosNVec[2] = pos - zvec;\n      vec3 g1, g2;\n\n      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];\n      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];\n      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];\n      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];\n      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];\n      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];\n\n      #ifdef vtkClippingPlanesOn\n        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);\n        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);\n      #endif\n      vec4 result;\n      result.x = scalarInterp[0].x - scalarInterp[1].x;\n      result.y = scalarInterp[0].y - scalarInterp[1].y;\n      result.z = scalarInterp[0].z - scalarInterp[1].z;\n      // divide by spacing\n      result.xyz /= vSpacing;\n      result.w = length(result.xyz);\n      // rotate to View Coords\n      rotateToViewCoord(result.xyz);\n      if (length(result.xyz) > 0.0) {\n        return vec4(normalize(result.xyz),result.w);\n      } else {\n        return vec4(0.0);\n      }\n    }\n  #endif\n\n  // only works with dependent components\n  vec4 computeNormal(vec3 pos, vec3 tstep)\n  {\n    vec3 xvec = vec3(tstep.x, 0.0, 0.0);\n    vec3 yvec = vec3(0.0, tstep.y, 0.0);\n    vec3 zvec = vec3(0.0, 0.0, tstep.z);\n    vec3 texPosPVec[3];\n    texPosPVec[0] = pos + xvec;\n    texPosPVec[1] = pos + yvec;\n    texPosPVec[2] = pos + zvec;\n    vec3 texPosNVec[3];\n    texPosNVec[0] = pos - xvec;\n    texPosNVec[1] = pos - yvec;\n    texPosNVec[2] = pos - zvec;\n    vec3 g1, g2;\n    g1.x = getTextureValue(texPosPVec[0]).a;\n    g1.y = getTextureValue(texPosPVec[1]).a;\n    g1.z = getTextureValue(texPosPVec[2]).a;\n    g2.x = getTextureValue(texPosNVec[0]).a;\n    g2.y = getTextureValue(texPosNVec[1]).a;\n    g2.z = getTextureValue(texPosNVec[2]).a;\n    #ifdef vtkClippingPlanesOn\n      adjustClippedVoxelValues(pos, texPosPVec, g1);\n      adjustClippedVoxelValues(pos, texPosNVec, g2);\n    #endif\n    vec4 result;\n    result = vec4(g1 - g2, -1.0);\n    // divide by spacing\n    result.xyz /= vSpacing;\n    result.w = length(result.xyz);\n    if (result.w > 0.0){\n      // rotate to View Coords\n      rotateToViewCoord(result.xyz);\n      return vec4(normalize(result.xyz),result.w);\n    } else {\n      return vec4(0.0);\n    }\n  }\n#endif\n\n#ifdef vtkImageLabelOutlineOn\nvec3 fragCoordToIndexSpace(vec4 fragCoord) {\n  vec4 pcPos = vec4(\n    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,\n    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,\n    (fragCoord.z - 0.5) * 2.0,\n    1.0);\n\n  vec4 worldCoord = PCWCMatrix * pcPos;\n  vec4 vertex = (worldCoord/worldCoord.w);\n\n  vec3 index = (vWCtoIDX * vertex).xyz;\n\n  // half voxel fix for labelmapOutline\n  return (index + vec3(0.5)) / vec3(volumeDimensions);\n}\n#endif\n\n//=======================================================================\n// compute the normals and gradient magnitudes for a position\n// for independent components\nmat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)\n{\n  mat4 result;\n  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;\n  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;\n  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;\n\n  // divide by spacing\n  distX /= vSpacing.x;\n  distY /= vSpacing.y;\n  distZ /= vSpacing.z;\n\n  mat3 rot;\n  rot[0] = vPlaneNormal0;\n  rot[1] = vPlaneNormal2;\n  rot[2] = vPlaneNormal4;\n\n#if !defined(vtkComponent0Proportional)\n  result[0].xyz = vec3(distX.r, distY.r, distZ.r);\n  result[0].a = length(result[0].xyz);\n  result[0].xyz *= rot;\n  if (result[0].w > 0.0)\n  {\n    result[0].xyz /= result[0].w;\n  }\n#endif\n\n// optionally compute the 2nd component\n#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)\n  result[1].xyz = vec3(distX.g, distY.g, distZ.g);\n  result[1].a = length(result[1].xyz);\n  result[1].xyz *= rot;\n  if (result[1].w > 0.0)\n  {\n    result[1].xyz /= result[1].w;\n  }\n#endif\n\n// optionally compute the 3rd component\n#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)\n  result[2].xyz = vec3(distX.b, distY.b, distZ.b);\n  result[2].a = length(result[2].xyz);\n  result[2].xyz *= rot;\n  if (result[2].w > 0.0)\n  {\n    result[2].xyz /= result[2].w;\n  }\n#endif\n\n// optionally compute the 4th component\n#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)\n  result[3].xyz = vec3(distX.a, distY.a, distZ.a);\n  result[3].a = length(result[3].xyz);\n  result[3].xyz *= rot;\n  if (result[3].w > 0.0)\n  {\n    result[3].xyz /= result[3].w;\n  }\n#endif\n\n  return result;\n}\n\n//=======================================================================\n// global shadow - secondary ray\n#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)\nfloat random()\n{\n  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);\n  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;\n  uint pcg_state = floatBitsToUint(jitter);\n  uint state = pcg_state;\n  pcg_state = pcg_state * uint(747796405) + uint(2891336453);\n  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);\n  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;\n}\n#endif\n\n#ifdef VolumeShadowOn\n// henyey greenstein phase function\nfloat phase_function(float cos_angle)\n{\n  // divide by 2.0 instead of 4pi to increase intensity\n  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;\n}\n\n// Computes the intersection between a ray and a box\nstruct Hit\n{\n  float tmin;\n  float tmax;\n};\n\nstruct Ray\n{\n  vec3 origin;\n  vec3 dir;\n  vec3 invDir;\n};\n\nbool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)\n{\n  vec3 tbot = r.invDir * (boundMin - r.origin);\n  vec3 ttop = r.invDir * (boundMax - r.origin);\n  vec3 tmin = min(ttop, tbot);\n  vec3 tmax = max(ttop, tbot);\n  vec2 t = max(tmin.xx, tmin.yz);\n  float t0 = max(t.x, t.y);\n  t = min(tmax.xx, tmax.yz);\n  float t1 = min(t.x, t.y);\n  hit.tmin = t0;\n  hit.tmax = t1;\n  return t1 > max(t0,0.0);\n}\n\n// As BBoxIntersect requires the inverse of the ray coords,\n// this function is used to avoid numerical issues\nvoid safe_0_vector(inout Ray ray)\n{\n  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;\n  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;\n  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;\n}\n\nfloat volume_shadow(vec3 posIS, vec3 lightDirNormIS)\n{\n  float shadow = 1.0;\n  float opacity = 0.0;\n\n  // modify sample distance with a random number between 1.5 and 3.0\n  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());\n  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;\n\n  // in case the first sample near surface has a very tiled light ray, we need to offset start position\n  posIS += sampleDistanceISVS_jitter * lightDirNormIS;\n\n  // compute the start and end points for the ray\n  Ray ray;\n  Hit hit;\n  ray.origin = posIS;\n  ray.dir = lightDirNormIS;\n  safe_0_vector(ray);\n  ray.invDir = 1.0/ray.dir;\n\n  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))\n  {\n    return 1.0;\n  }\n  float maxdist = hit.tmax;\n\n  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach\n  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);\n  maxdist = min(maxdist,maxgi);\n  if(maxdist < EPSILON) {\n    return 1.0;\n  }\n\n  float current_dist = 0.0;\n  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);\n  float clamped_step = 0.0;\n\n  vec4 scalar = vec4(0.0);\n  while(current_dist < maxdist)\n  {\n#ifdef vtkClippingPlanesOn\n    vec3 posVC = IStoVC(posIS);\n    for (int i = 0; i < clip_numPlanes; ++i)\n    {\n      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)\n      {\n        current_dist = maxdist;\n      }\n    }\n#endif\n    scalar = getTextureValue(posIS);\n    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;\n    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)\n      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));\n      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);\n    #endif\n    shadow *= 1.0 - opacity;\n\n    // optimization: early termination\n    if (shadow < EPSILON){\n      return 0.0;\n    }\n\n    clamped_step = min(maxdist - current_dist, current_step);\n    posIS += clamped_step * lightDirNormIS;\n    current_dist += current_step;\n  }\n\n  return shadow;\n}\n\nvec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)\n{\n  vec3 vertLight = vec3(0.0);\n  vec3 secondary_contrib = vec3(0.0);\n  // here we assume only positional light, no effect of cones\n  for (int i = 0; i < lightNum; i++)\n  {\n    #if(vtkLightComplexity==3)\n      if (lightPositional[i] == 1){\n        vertLight = lightPositionVC[i] - IStoVC(posIS);\n      }else{\n        vertLight = - lightDirectionVC[i];\n      }\n    #else\n      vertLight = - lightDirectionVC[i];\n    #endif\n    // here we assume achromatic light, only intensity\n    float dDotL = dot(viewDirectionVC, normalize(vertLight));\n    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity\n    float phase_attenuation = 0.5;\n    if (abs(anisotropy) > EPSILON){\n      phase_attenuation = phase_function(dDotL);\n    }\n    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));\n    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;\n    secondary_contrib += tColor * vAmbient;\n  }\n  return secondary_contrib;\n}\n#endif\n\n//=======================================================================\n// local ambient occlusion\n#ifdef localAmbientOcclusionOn\nvec3 sample_direction_uniform(int i)\n{\n  float rand = random() * 0.5;\n  float theta = PI2 * (kernelSample[i][0] + rand);\n  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;\n  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));\n}\n\n// return a matrix that transform startDir into z axis; startDir should be normalized\nmat3 zBaseRotationalMatrix(vec3 startDir){\n  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));\n  float cosA = startDir.z;\n  float k = 1.0 / (1.0 + cosA);\n  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,\n              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,\n              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);\n  return matrix;\n}\n\nfloat computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){\n  // apply LAO only at selected locations, otherwise return full brightness\n  if (normal.w > 0.0 && op > 0.05){\n    float total_transmittance = 0.0;\n    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));\n    vec3 currPos, randomDirStep;\n    float weight, transmittance, opacity;\n    for (int i = 0; i < kernelSize; i++)\n    {\n      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;\n      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));\n      currPos = posIS;\n      transmittance = 1.0;\n      for (int j = 0; j < kernelRadius ; j++){\n        currPos += randomDirStep;\n        // check if it's at clipping plane, if so return full brightness\n        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){\n          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;\n          #ifdef vtkGradientOpacityOn\n             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);\n          #endif\n          transmittance *= 1.0 - opacity;\n        }\n        else{\n          break;\n        }\n      }\n      total_transmittance += transmittance / float(kernelRadius) * weight;\n\n      // early termination if fully translucent\n      if (total_transmittance > 1.0 - EPSILON){\n        return 1.0;\n      }\n    }\n    // average transmittance and reduce variance\n    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);\n  } else {\n    return 1.0;\n  }\n}\n#endif\n\n//=======================================================================\n// surface light contribution\n#if vtkLightComplexity > 0\n  void applyLighting(inout vec3 tColor, vec4 normal)\n  {\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 specular = vec3(0.0, 0.0, 0.0);\n    float df, sf = 0.0;\n    for (int i = 0; i < lightNum; i++){\n        df = abs(dot(normal.rgb, -lightDirectionVC[i]));\n        diffuse += df * lightColor[i];\n        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);\n        specular += sf * lightColor[i];\n    }\n    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;\n  }\n  #ifdef SurfaceShadowOn\n  #if vtkLightComplexity < 3\n    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)\n    {\n      // everything in VC\n      vec3 diffuse = vec3(0.0);\n      vec3 specular = vec3(0.0);\n      #ifdef localAmbientOcclusionOn\n        vec3 ambient = vec3(0.0);\n      #endif\n      vec3 vertLightDirection;\n      for (int i = 0; i < lightNum; i++){\n        float ndotL,vdotR;\n        vertLightDirection = lightDirectionVC[i];\n        ndotL = dot(normal.xyz, vertLightDirection);\n        if (ndotL < 0.0 && twoSidedLighting)\n        {\n          ndotL = -ndotL;\n        }\n        if (ndotL > 0.0)\n        {\n          diffuse += ndotL * lightColor[i];\n          //specular\n          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));\n          if (vdotR > 0.0)\n          {\n            specular += pow(vdotR, vSpecularPower) * lightColor[i];\n          }\n        }\n        #ifdef localAmbientOcclusionOn\n            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);\n        #endif\n      }\n      #ifdef localAmbientOcclusionOn\n        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;\n      #else\n        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;\n      #endif\n    }\n  #else\n    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)\n    {\n      // everything in VC\n      vec3 diffuse = vec3(0.0);\n      vec3 specular = vec3(0.0);\n      #ifdef localAmbientOcclusionOn\n        vec3 ambient = vec3(0.0);\n      #endif\n      vec3 vertLightDirection;\n      for (int i = 0; i < lightNum; i++){\n        float distance,attenuation,ndotL,vdotR;\n        vec3 lightDir;\n        if (lightPositional[i] == 1){\n          lightDir = lightDirectionVC[i];\n          vertLightDirection = posVC - lightPositionVC[i];\n          distance = length(vertLightDirection);\n          vertLightDirection = normalize(vertLightDirection);\n          attenuation = 1.0 / (lightAttenuation[i].x\n                              + lightAttenuation[i].y * distance\n                              + lightAttenuation[i].z * distance * distance);\n          // per OpenGL standard cone angle is 90 or less for a spot light\n          if (lightConeAngle[i] <= 90.0){\n            float coneDot = dot(vertLightDirection, lightDir);\n            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone\n              attenuation = attenuation * pow(coneDot, lightExponent[i]);\n            }\n            else {\n              attenuation = 0.0;\n            }\n          }\n          ndotL = dot(normal.xyz, vertLightDirection);\n          if (ndotL < 0.0 && twoSidedLighting)\n          {\n            ndotL = -ndotL;\n          }\n          if (ndotL > 0.0)\n          {\n            diffuse += ndotL * attenuation * lightColor[i];\n            //specular\n            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));\n            if (vdotR > 0.0)\n            {\n              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];\n            }\n          }\n          #ifdef localAmbientOcclusionOn\n            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);\n          #endif\n        } else {\n          vertLightDirection = lightDirectionVC[i];\n          ndotL = dot(normal.xyz, vertLightDirection);\n          if (ndotL < 0.0 && twoSidedLighting)\n          {\n            ndotL = -ndotL;\n          }\n          if (ndotL > 0.0)\n          {\n            diffuse += ndotL * lightColor[i];\n            //specular\n            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));\n            if (vdotR > 0.0)\n            {\n              specular += pow(vdotR, vSpecularPower) * lightColor[i];\n            }\n          }\n          #ifdef localAmbientOcclusionOn\n            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);\n          #endif\n        }\n      }\n      #ifdef localAmbientOcclusionOn\n        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;\n      #else\n        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;\n      #endif\n    }\n  #endif\n  #endif\n#endif\n\n// LAO of surface shadows and volume shadows only work with dependent components\nvec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {\n  #if vtkLightComplexity > 0\n    // surface shadows if needed\n    #ifdef SurfaceShadowOn\n      #if vtkLightComplexity < 3\n        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);\n      #else\n        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));\n      #endif\n    #endif\n\n    // volume shadows if needed\n    #ifdef VolumeShadowOn\n      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);\n    #endif\n\n    // merge\n    #ifdef VolumeShadowOn\n      #ifdef SurfaceShadowOn\n        // surface shadows + volumetric shadows\n        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);\n        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;\n      #else\n        // volumetric shadows only\n        tColor = tColorVS;\n      #endif\n    #else\n      #ifdef SurfaceShadowOn\n        // surface shadows only\n        tColor = tColorS;\n      #else\n        // no shadows\n        applyLighting(tColor, normal3);\n      #endif\n    #endif\n  #endif\n  return tColor;\n}\n\n//=======================================================================\n// Given a texture value compute the color and opacity\n//\nvec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)\n{\n#ifdef vtkImageLabelOutlineOn\n  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space\n  vec4 centerValue = getTextureValue(centerPosIS);\n  bool pixelOnBorder = false;\n  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));\n\n  // Get alpha of segment from opacity function.\n  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;\n\n  int segmentIndex = int(centerValue.r * 255.0);\n  \n  // Use texture sampling for outlineThickness\n  float textureCoordinate = float(segmentIndex - 1) / 1024.0;\n  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;\n\n  int actualThickness = int(textureValue * 255.0);\n\n\n  // If it is the background (segment index 0), we should quickly bail out. \n  // Previously, this was determined by tColor.a, which was incorrect as it\n  // prevented the outline from appearing when the fill is 0.\n  if (segmentIndex == 0){\n    return vec4(0, 0, 0, 0);\n  }\n\n  // Only perform outline check on fragments rendering voxels that aren't invisible.\n  // Saves a bunch of needless checks on the background.\n  // TODO define epsilon when building shader?\n  for (int i = -actualThickness; i <= actualThickness; i++) {\n    for (int j = -actualThickness; j <= actualThickness; j++) {\n      if (i == 0 || j == 0) {\n        continue;\n      }\n\n      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),\n        gl_FragCoord.y + float(j),\n        gl_FragCoord.z, gl_FragCoord.w);\n\n      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);\n      vec4 value = getTextureValue(neighborPosIS);\n\n      // If any of my neighbours are not the same value as I\n      // am, this means I am on the border of the segment.\n      // We can break the loops\n      if (any(notEqual(value, centerValue))) {\n        pixelOnBorder = true;\n        break;\n      }\n    }\n\n    if (pixelOnBorder == true) {\n      break;\n    }\n  }\n\n  // If I am on the border, I am displayed at full opacity\n  if (pixelOnBorder == true) {\n    tColor.a = outlineOpacity;\n  }\n\n  return tColor;\n\n#else\n  // compute the normal and gradient magnitude if needed\n  // We compute it as a vec4 if possible otherwise a mat4\n\n  #ifdef UseIndependentComponents\n    // sample textures\n    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;\n    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;\n\n    #if vtkNumComponents > 1\n      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;\n      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;\n\n      #if vtkNumComponents > 2\n        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;\n        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;\n\n        #if vtkNumComponents > 3\n          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;\n          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;\n        #endif\n      #endif\n    #endif\n\n    #if !defined(vtkCustomComponentsColorMix)\n      // default path for component color mix\n\n      // compute the normal vectors as needed\n      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)\n        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);\n      #endif\n\n      // compute gradient opacity factors as needed\n      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);\n      #if defined(vtkGradientOpacityOn)\n        #if !defined(vtkComponent0Proportional)\n          goFactor.x =\n            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);\n        #endif\n        #if vtkNumComponents > 1\n          #if !defined(vtkComponent1Proportional)\n            goFactor.y =\n              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);\n          #endif\n          #if vtkNumComponents > 2\n            #if !defined(vtkComponent2Proportional)\n              goFactor.z =\n                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);\n            #endif\n            #if vtkNumComponents > 3\n              #if !defined(vtkComponent3Proportional)\n                goFactor.w =\n                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);\n              #endif\n            #endif\n          #endif\n        #endif\n      #endif\n\n      // process color and opacity for each component\n      #if !defined(vtkComponent0Proportional)\n        float alpha = goFactor.x*mix0*pwfValue0;\n        #if vtkLightComplexity > 0\n          applyLighting(tColor0, normalMat[0]);\n        #endif\n      #else\n        tColor0 *= pwfValue0;\n        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));\n      #endif\n\n      #if vtkNumComponents > 1\n        #if !defined(vtkComponent1Proportional)\n          alpha += goFactor.y*mix1*pwfValue1;\n          #if vtkLightComplexity > 0\n            applyLighting(tColor1, normalMat[1]);\n          #endif\n        #else\n          tColor1 *= pwfValue1;\n          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));\n        #endif\n\n        #if vtkNumComponents > 2\n          #if !defined(vtkComponent2Proportional)\n            alpha += goFactor.z*mix2*pwfValue2;\n            #if vtkLightComplexity > 0\n              applyLighting(tColor2, normalMat[2]);\n            #endif\n          #else\n            tColor2 *= pwfValue2;\n            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));\n          #endif\n        #endif\n\n        #if vtkNumComponents > 3\n          #if !defined(vtkComponent3Proportional)\n            alpha += goFactor.w*mix3*pwfValue3;\n            #if vtkLightComplexity > 0\n              applyLighting(tColor3, normalMat[3]);\n            #endif\n          #else\n            tColor3 *= pwfValue3;\n            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));\n          #endif\n        #endif\n      #endif\n\n      // perform final independent blend\n      vec3 tColor = mix0 * tColor0;\n      #if vtkNumComponents > 1\n        tColor += mix1 * tColor1;\n        #if vtkNumComponents > 2\n          tColor += mix2 * tColor2;\n          #if vtkNumComponents > 3\n            tColor += mix3 * tColor3;\n          #endif\n        #endif\n      #endif\n\n      return vec4(tColor, alpha);\n    #else\n      /*\n       * Mix the color information from all the independent components to get a single rgba output\n       * Gradient opactity factors and normals are not computed\n       *\n       * You can compute these using:\n       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix\n       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),\n       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper\n       * - computeGradientOpacityFactor: always available, used in a lot of places\n       *\n       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)\n       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight\n       */\n      //VTK::CustomComponentsColorMix::Impl\n    #endif\n  #else\n    // dependent components\n\n    // compute normal if needed\n    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)\n      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value\n      #ifdef vtkComputeNormalFromOpacity\n        vec3 scalarInterp[2];\n        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);\n      #else\n        vec4 normal0 = computeNormal(posIS, tstep);\n      #endif\n    #endif\n\n    // compute gradient opacity factor enabled\n    #if defined(vtkGradientOpacityOn)\n      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);\n    #else\n      const float gradientOpacity = 1.0;\n    #endif\n\n    // get color and opacity\n    #if vtkNumComponents == 1\n      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;\n      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;\n      if (alpha < EPSILON){\n        return vec4(0.0);\n      }\n    #endif\n    #if vtkNumComponents == 2\n      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);\n      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;\n    #endif\n    #if vtkNumComponents == 3\n      vec3 tColor;\n      tColor.r = tValue.r * cscale0 + cshift0;\n      tColor.g = tValue.g * cscale1 + cshift1;\n      tColor.b = tValue.b * cscale2 + cshift2;\n      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;\n    #endif\n    #if vtkNumComponents == 4\n      vec3 tColor;\n      tColor.r = tValue.r * cscale0 + cshift0;\n      tColor.g = tValue.g * cscale1 + cshift1;\n      tColor.b = tValue.b * cscale2 + cshift2;\n      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;\n    #endif\n\n    // lighting\n    #if (vtkLightComplexity > 0)\n      #ifdef vtkComputeNormalFromOpacity\n        vec4 normalLight;\n        if (!all(equal(normal0, vec4(0.0)))) {\n          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;\n          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;\n          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);\n          if (all(equal(normalLight, vec4(0.0)))) {\n            normalLight = normal0;\n          }\n        }\n      #else\n        vec4 normalLight = normal0;\n      #endif\n      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);\n    #endif\n\n    return vec4(tColor, alpha);\n  #endif // dependent\n#endif\n}\n\nbool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {\n  bool withinRange = false;\n  #if vtkNumComponents == 1\n    if (val.r >= min.r && val.r <= max.r) {\n      withinRange = true;\n    }\n  #else\n    #ifdef UseIndependentComponents\n      #if vtkNumComponents == 2\n        if (val.r >= min.r && val.r <= max.r &&\n            val.g >= min.g && val.g <= max.g) {\n          withinRange = true;\n        }\n      #else\n        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&\n            all(lessThanEqual(val, ipScalarRangeMax))) {\n          withinRange = true;\n        }\n      #endif\n    #endif\n  #endif\n  return withinRange;\n}\n\n//=======================================================================\n// Apply the specified blend mode operation along the ray's path.\n//\nvoid applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)\n{\n  vec3 tstep = 1.0/tdims;\n\n  // start slightly inside and apply some jitter\n  vec3 delta = endIS - posIS;\n  vec3 stepIS = normalize(delta)*sampleDistanceIS;\n  float raySteps = length(delta)/sampleDistanceIS;\n\n  // avoid 0.0 jitter\n  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;\n  float stepsTraveled = jitter;\n\n  // local vars for the loop\n  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 tValue;\n  vec4 tColor;\n\n  // if we have less than one step then pick the middle point\n  // as our value\n  // if (raySteps <= 1.0)\n  // {\n  //   posIS = (posIS + endIS)*0.5;\n  // }\n\n  // Perform initial step at the volume boundary\n  // compute the scalar\n  tValue = getTextureValue(posIS);\n\n  #if vtkBlendMode == 0 // COMPOSITE_BLEND\n    // now map through opacity and color\n    tColor = getColorForValue(tValue, posIS, tstep);\n\n    // handle very thin volumes\n    if (raySteps <= 1.0)\n    {\n      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);\n      gl_FragData[0] = tColor;\n      return;\n    }\n\n    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);\n    color = vec4(tColor.rgb*tColor.a, tColor.a);\n    posIS += (jitter*stepIS);\n\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // now map through opacity and color\n      tColor = getColorForValue(tValue, posIS, tstep);\n\n      float mix = (1.0 - color.a);\n\n      // this line should not be needed but nvidia seems to not handle\n      // the break correctly on windows/chrome 58 angle\n      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));\n\n      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;\n      stepsTraveled++;\n      posIS += stepIS;\n      if (color.a > 0.99) { color.a = 1.0; break; }\n    }\n\n    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)\n    {\n      posIS = endIS;\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // now map through opacity and color\n      tColor = getColorForValue(tValue, posIS, tstep);\n      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);\n\n      float mix = (1.0 - color.a);\n      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;\n    }\n\n    gl_FragData[0] = vec4(color.rgb/color.a, color.a);\n  #endif\n  #if vtkBlendMode == 1 || vtkBlendMode == 2\n    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND\n    // Find maximum/minimum intensity along the ray.\n\n    // Define the operation we will use (min or max)\n    #if vtkBlendMode == 1\n    #define OP max\n    #else\n    #define OP min\n    #endif\n\n    // If the clipping range is shorter than the sample distance\n    // we can skip the sampling loop along the ray.\n    if (raySteps <= 1.0)\n    {\n      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);\n      return;\n    }\n\n    vec4 value = tValue;\n    posIS += (jitter*stepIS);\n\n    // Sample along the ray until MaximumSamplesValue,\n    // ending slightly inside the total distance\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      // If we have reached the last step, break\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // Update the maximum value if necessary\n      value = OP(tValue, value);\n\n      // Otherwise, continue along the ray\n      stepsTraveled++;\n      posIS += stepIS;\n    }\n\n    // Perform the last step along the ray using the\n    // residual distance\n    posIS = endIS;\n    tValue = getTextureValue(posIS);\n    value = OP(tValue, value);\n\n    // Now map through opacity and color\n    gl_FragData[0] = getColorForValue(value, posIS, tstep);\n  #endif\n  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND\n    vec4 sum = vec4(0.);\n\n    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {\n      sum += tValue;\n    }\n\n    if (raySteps <= 1.0) {\n      gl_FragData[0] = getColorForValue(sum, posIS, tstep);\n      return;\n    }\n\n    posIS += (jitter*stepIS);\n\n    // Sample along the ray until MaximumSamplesValue,\n    // ending slightly inside the total distance\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      // If we have reached the last step, break\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar\n      tValue = getTextureValue(posIS);\n\n      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.\n      // Notes:\n      // - We are comparing all values in the texture to see if any of them\n      //   are outside of the scalar range. In the future we might want to allow\n      //   scalar ranges for each component.\n      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {\n        // Sum the values across each step in the path\n        sum += tValue;\n      }\n      stepsTraveled++;\n      posIS += stepIS;\n    }\n\n    // Perform the last step along the ray using the\n    // residual distance\n    posIS = endIS;\n\n    // compute the scalar\n    tValue = getTextureValue(posIS);\n\n    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation\n    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {\n      sum += tValue;\n\n      stepsTraveled++;\n    }\n\n    #if vtkBlendMode == 3 // Average\n      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);\n    #endif\n\n    gl_FragData[0] = getColorForValue(sum, posIS, tstep);\n  #endif\n  #if vtkBlendMode == 5 // RADON\n    float normalizedRayIntensity = 1.0;\n\n    // handle very thin volumes\n    if (raySteps <= 1.0)\n    {\n      tValue = getTextureValue(posIS);\n      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;\n      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));\n      return;\n    }\n\n    posIS += (jitter*stepIS);\n\n    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)\n    {\n      if (stepsTraveled + 1.0 >= raySteps) { break; }\n\n      // compute the scalar value\n      tValue = getTextureValue(posIS);\n\n      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity\n      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;\n\n      posIS += stepIS;\n      stepsTraveled++;\n    }\n\n    // map normalizedRayIntensity to color\n    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));\n\n  #endif\n}\n\n//=======================================================================\n// Compute a new start and end point for a given ray based\n// on the provided bounded clipping plane (aka a rectangle)\nvoid getRayPointIntersectionBounds(\n  vec3 rayPos, vec3 rayDir,\n  vec3 planeDir, float planeDist,\n  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,\n  float vSize1, float vSize2)\n{\n  float result = dot(rayDir, planeDir);\n  if (abs(result) < 1e-6)\n  {\n    return;\n  }\n  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;\n  vec3 xposVC = rayPos + rayDir*result;\n  vec3 vxpos = xposVC - vOriginVC;\n  vec2 vpos = vec2(\n    dot(vxpos, vPlaneX),\n    dot(vxpos, vPlaneY));\n\n  // on some apple nvidia systems this does not work\n  // if (vpos.x < 0.0 || vpos.x > vSize1 ||\n  //     vpos.y < 0.0 || vpos.y > vSize2)\n  // even just\n  // if (vpos.x < 0.0 || vpos.y < 0.0)\n  // fails\n  // so instead we compute a value that represents in and out\n  //and then compute the return using this value\n  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds\n  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out\n\n  tbounds = mix(\n   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value\n   tbounds, // out value\n   check);  // 0 in 1 out\n}\n\n//=======================================================================\n// given a\n// - ray direction (rayDir)\n// - starting point (vertexVCVSOutput)\n// - bounding planes of the volume\n// - optionally depth buffer values\n// - far clipping plane\n// compute the start/end distances of the ray we need to cast\nvec2 computeRayDistances(vec3 rayDir, vec3 tdims)\n{\n  vec2 dists = vec2(100.0*camFar, -1.0);\n\n  vec3 vSize = vSpacing*tdims;\n\n  // all this is in View Coordinates\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,\n    vSize.y, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,\n    vSize.y, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,\n    vSize.x, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,\n    vSize.x, vSize.z);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,\n    vSize.x, vSize.y);\n  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,\n    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,\n    vSize.x, vSize.y);\n\n  //VTK::ClipPlane::Impl\n\n  // do not go behind front clipping plane\n  dists.x = max(0.0,dists.x);\n\n  // do not go PAST far clipping plane\n  float farDist = -camThick/rayDir.z;\n  dists.y = min(farDist,dists.y);\n\n  // Do not go past the zbuffer value if set\n  // This is used for intermixing opaque geometry\n  //VTK::ZBuffer::Impl\n\n  return dists;\n}\n\n//=======================================================================\n// Compute the index space starting position (pos) and end\n// position\n//\nvoid computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)\n{\n  // compute starting and ending values in volume space\n  pos = vertexVCVSOutput + dists.x*rayDir;\n  pos = pos - vOriginVC;\n  // convert to volume basis and origin\n  pos = vec3(\n    dot(pos, vPlaneNormal0),\n    dot(pos, vPlaneNormal2),\n    dot(pos, vPlaneNormal4));\n\n  endPos = vertexVCVSOutput + dists.y*rayDir;\n  endPos = endPos - vOriginVC;\n  endPos = vec3(\n    dot(endPos, vPlaneNormal0),\n    dot(endPos, vPlaneNormal2),\n    dot(endPos, vPlaneNormal4));\n\n  float delta = length(endPos - pos);\n\n  pos *= vVCToIJK;\n  endPos *= vVCToIJK;\n\n  float delta2 = length(endPos - pos);\n  sampleDistanceIS = sampleDistance*delta2/delta;\n  #ifdef VolumeShadowOn\n    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;\n  #endif\n}\n\nvoid main()\n{\n\n  if (cameraParallel == 1)\n  {\n    // Camera is parallel, so the rayDir is just the direction of the camera.\n    rayDirVC = vec3(0.0, 0.0, -1.0);\n  } else {\n    // camera is at 0,0,0 so rayDir for perspective is just the vc coord\n    rayDirVC = normalize(vertexVCVSOutput);\n  }\n\n  vec3 tdims = vec3(volumeDimensions);\n\n  // compute the start and end points for the ray\n  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);\n\n  // do we need to composite? aka does the ray have any length\n  // If not, bail out early\n  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)\n  {\n    discard;\n  }\n\n  // IS = Index Space\n  vec3 posIS;\n  vec3 endIS;\n  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);\n\n  // Perform the blending operation along the ray\n  applyBlend(posIS, endIS, tdims);\n}\n",e.Geometry=""},e.useIndependentComponents=e=>{const n=e.getIndependentComponents(),r=t.currentInput,i=r?.getPointData()?.getScalars()?.getNumberOfComponents(),o=e.getColorMixPreset();return n&&i>=2||!!o},e.replaceShaderValues=(n,r,i)=>{const o=i.getProperty();let s=n.Fragment;o.getInterpolationType()===b.ZG.LINEAR&&(s=f.Z.substitute(s,"//VTK::TrilinearOn","#define vtkTrilinearOn").result);!0===o.getUseLabelOutline()&&(s=f.Z.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result);const l=t.scalarTexture.getComponents();s=f.Z.substitute(s,"//VTK::NumComponents",`#define vtkNumComponents ${l}`).result;const c=e.useIndependentComponents(o);c&&(s=f.Z.substitute(s,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const u=[],d=[];for(let e=0;e<l;e++)o.getOpacityMode(e)===b.Xk.PROPORTIONAL&&u.push(`#define vtkComponent${e}Proportional`),o.getForceNearestInterpolation(e)&&d.push(`#define vtkComponent${e}ForceNearest`);s=f.Z.substitute(s,"//VTK::vtkProportionalComponents",u.join("\n")).result,s=f.Z.substitute(s,"//VTK::vtkForceNearestComponents",d.join("\n")).result;const p=function(e){switch(e){case b.jw.CUSTOM:return"//VTK::CustomColorMix";case b.jw.ADDITIVE:return"\n        // compute normals\n        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);\n        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)\n          vec3 scalarInterp0[2];\n          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);\n          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;\n          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;\n          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);\n\n          vec3 scalarInterp1[2];\n          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);\n          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;\n          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;\n          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);\n        #else\n          vec4 normalLight0 = normalMat[0];\n          vec4 normalLight1 = normalMat[1];\n        #endif\n\n        // compute opacities\n        float opacity0 = pwfValue0;\n        float opacity1 = pwfValue1;\n        #ifdef vtkGradientOpacityOn\n          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);\n          opacity0 *= gof0;\n          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);\n          opacity1 *= gof1;\n        #endif\n        float opacitySum = opacity0 + opacity1;\n        if (opacitySum <= 0.0) {\n          return vec4(0.0);\n        }\n\n        // mix the colors and opacities\n        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);\n        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);\n        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;\n        return vec4(mixedColor, min(1.0, opacitySum));\n";case b.jw.COLORIZE:return"\n        // compute normals\n        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);\n        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)\n          vec3 scalarInterp0[2];\n          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);\n          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;\n          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;\n          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);\n        #else\n          vec4 normalLight0 = normalMat[0];\n        #endif\n\n        // compute opacities\n        float opacity0 = pwfValue0;\n        #ifdef vtkGradientOpacityOn\n          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);\n          opacity0 *= gof0;\n        #endif\n\n        // mix the colors and opacities\n        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);\n        color = applyAllLightning(color, opacity0, posIS, normalLight0);\n        return vec4(color, opacity0);\n";default:return null}}(o.getColorMixPreset());p&&(s=f.Z.substitute(s,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,s=f.Z.substitute(s,"//VTK::CustomComponentsColorMix::Impl",p).result);const h=t.currentInput.getSpatialExtent(),m=t.currentInput.getSpacing(),g=new Float64Array(3);a.R3.set(g,(h[1]-h[0])*m[0],(h[3]-h[2])*m[1],(h[5]-h[4])*m[2]);const v=a.R3.length(g)/e.getCurrentSampleDistance(r);s=f.Z.substitute(s,"//VTK::MaximumSamplesValue",`${Math.ceil(v)}`).result,s=f.Z.substitute(s,"//VTK::LightComplexity",`#define vtkLightComplexity ${t.lightComplexity}`).result,t.lightComplexity>0&&(t.renderable.getVolumetricScatteringBlending()>0&&(s=f.Z.substitute(s,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),t.renderable.getVolumetricScatteringBlending()<1&&(s=f.Z.substitute(s,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),t.renderable.getLocalAmbientOcclusion()&&o.getAmbient()>0&&(s=f.Z.substitute(s,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const y=c?l:1;t.gopacity=!1;for(let e=0;!t.gopacity&&e<y;++e)t.gopacity||=o.getUseGradientOpacity(e);t.gopacity&&(s=f.Z.substitute(s,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),t.renderable.getComputeNormalFromOpacity()&&(s=f.Z.substitute(s,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),null!==t.zBufferTexture&&(s=f.Z.substitute(s,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,s=f.Z.substitute(s,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {","zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}\n","zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),s=f.Z.substitute(s,"//VTK::BlendMode",`${t.renderable.getBlendMode()}`).result,n.Fragment=s,e.replaceShaderLight(n,r,i),e.replaceShaderClippingPlane(n,r,i)},e.replaceShaderLight=(e,n,r)=>{if(0===t.lightComplexity)return;let i=e.Fragment,o=0;n.getLights().forEach(e=>{e.getSwitch()&&(o+=1)}),i=f.Z.substitute(i,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${o}];`,`uniform vec3 lightDirectionVC[${o}]; // normalized`,`uniform vec3 lightHalfAngleVC[${o}];`,"//VTK::Light::Dec"],!1).result,3===t.lightComplexity&&(i=f.Z.substitute(i,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${o}];`,`uniform vec3 lightAttenuation[${o}];`,`uniform float lightConeAngle[${o}];`,`uniform float lightExponent[${o}];`,`uniform int lightPositional[${o}];`],!1).result),t.renderable.getVolumetricScatteringBlending()>0&&(i=f.Z.substitute(i,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),t.renderable.getLocalAmbientOcclusion()&&r.getProperty().getAmbient()>0&&(i=f.Z.substitute(i,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${t.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),e.Fragment=i},e.replaceShaderClippingPlane=(e,n,r)=>{let i=e.Fragment;if(t.renderable.getClippingPlanes().length>0){const e=t.renderable.getClippingPlanes().length;i=f.Z.substitute(i,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,i=f.Z.substitute(i,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${e}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}e.Fragment=i};e.getNeedToRebuildShaders=(n,r,i)=>{const s=i.getProperty();((n,r)=>{let i=0;n.getProperty().getShade()&&t.renderable.getBlendMode()===C.b.COMPOSITE_BLEND&&(i=0,t.numberOfLights=0,r.forEach(e=>{e.getSwitch()>0&&(t.numberOfLights++,0===i&&(i=1)),1===i&&(t.numberOfLights>1||1!==e.getIntensity()||!e.lightTypeIsHeadLight())&&(i=2),i<3&&e.getPositional()&&(i=3)})),i!==t.lightComplexity&&(t.lightComplexity=i,e.modified())})(i,r.getLights());const l=t.scalarTexture.getComponents(),c=[],u=[];for(let e=0;e<l;e++)c.push(s.getOpacityMode(e)),u.push(s.getForceNearestInterpolation(e));const d=t.currentInput.getSpatialExtent(),p=t.currentInput.getSpacing(),h=new Float64Array(3);a.R3.set(h,(d[1]-d[0])*p[0],(d[3]-d[2])*p[1],(d[5]-d[4])*p[2]);const f=a.R3.length(h)/e.getCurrentSampleDistance(r),m=!!t.zBufferTexture,g={iComps:s.getIndependentComponents(),colorMixPreset:s.getColorMixPreset(),interpolationType:s.getInterpolationType(),useLabelOutline:s.getUseLabelOutline(),numComp:l,maxSamples:f,useGradientOpacity:s.getUseGradientOpacity(0),blendMode:t.renderable.getBlendMode(),hasZBufferTexture:m,opacityModes:c,forceNearestInterps:u};return(0===n.getProgram()?.getHandle()||n.getShaderSourceTime().getMTime()<e.getMTime()||n.getShaderSourceTime().getMTime()<t.renderable.getMTime()||!t.previousState||!o()(t.previousState,g))&&(t.previousState=g,!0)},e.updateShaders=(n,r,i)=>{if(e.getNeedToRebuildShaders(n,r,i)){const o={Vertex:null,Fragment:null,Geometry:null};e.buildShaders(o,r,i);const a=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==n.getProgram()&&(n.setProgram(a),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),e.setMapperShaderParameters(n,r,i),e.setCameraShaderParameters(n,r,i),e.setPropertyShaderParameters(n,r,i),e.getClippingPlaneShaderParameters(n,r,i)},e.setMapperShaderParameters=(n,r,i)=>{const o=n.getProgram();n.getCABO().getElementCount()&&(t.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexDC")&&(n.getVAO().addAttributeArray(o,n.getCABO(),"vertexDC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||T("Error setting vertexDC in shader VAO.")),n.getAttributeUpdateTime().modified()),o.setUniformi("texture1",t.scalarTexture.getTextureUnit()),o.setUniformf("sampleDistance",e.getCurrentSampleDistance(r));const a=t.scalarTexture.getVolumeInfo(),s=t.renderable.getIpScalarRange(),l=[],c=[];for(let e=0;e<4;e++)l[e]=s[0]*a.dataComputedScale[e]+a.dataComputedOffset[e],c[e]=s[1]*a.dataComputedScale[e]+a.dataComputedOffset[e],l[e]=(l[e]-a.offset[e])/a.scale[e],c[e]=(c[e]-a.offset[e])/a.scale[e];if(o.setUniform4f("ipScalarRangeMin",l[0],l[1],l[2],l[3]),o.setUniform4f("ipScalarRangeMax",c[0],c[1],c[2],c[3]),null!==t.zBufferTexture){o.setUniformi("zBufferTexture",t.zBufferTexture.getTextureUnit());const e=t._useSmallViewport?[t._smallViewportWidth,t._smallViewportHeight]:t._openGLRenderWindow.getFramebufferSize();o.setUniformf("vpZWidth",e[0]),o.setUniformf("vpZHeight",e[1])}},e.setCameraShaderParameters=(n,r,i)=>{const o=t.openGLCamera.getKeyMatrices(r),s=t.openGLVolume.getKeyMatrices();a._E.multiply(t.modelToView,o.wcvc,s.mcwc);const l=n.getProgram(),c=t.openGLCamera.getRenderable(),u=c.getClippingRange();l.setUniformf("camThick",u[1]-u[0]),l.setUniformf("camNear",u[0]),l.setUniformf("camFar",u[1]);const d=t.currentInput.getBounds(),p=t.currentInput.getDimensions(),h=new Float64Array(3),f=new Float64Array(3);let m=1,g=-1,v=1,y=-1;for(let e=0;e<8;++e){if(a.R3.set(h,d[e%2],d[2+Math.floor(e/2)%2],d[4+Math.floor(e/4)]),a.R3.transformMat4(h,h,t.modelToView),!c.getParallelProjection()){a.R3.normalize(f,h);const e=-u[0]/h[2];a.R3.scale(h,f,e)}a.R3.transformMat4(h,h,o.vcpc),m=Math.min(h[0],m),g=Math.max(h[0],g),v=Math.min(h[1],v),y=Math.max(h[1],y)}l.setUniformf("dcxmin",m),l.setUniformf("dcxmax",g),l.setUniformf("dcymin",v),l.setUniformf("dcymax",y),l.isUniformUsed("cameraParallel")&&l.setUniformi("cameraParallel",c.getParallelProjection());const b=t.currentInput.getSpatialExtent(),C=t.currentInput.getSpacing(),w=new Float64Array(3);a.R3.set(w,(b[1]-b[0])*C[0],(b[3]-b[2])*C[1],(b[5]-b[4])*C[2]),l.setUniform3f("vSpacing",C[0],C[1],C[2]),a.R3.set(h,b[0],b[2],b[4]),t.currentInput.indexToWorldVec3(h,h),a.R3.transformMat4(h,h,t.modelToView),l.setUniform3f("vOriginVC",h[0],h[1],h[2]);const T=t.currentInput.getIndexToWorld();a._E.multiply(t.idxToView,t.modelToView,T),a.wO.multiply(t.idxNormalMatrix,o.normalMatrix,s.normalMatrix),a.wO.multiply(t.idxNormalMatrix,t.idxNormalMatrix,t.currentInput.getDirectionByReference());const x=a.R3.length(w)/e.getCurrentSampleDistance(r);x>t.renderable.getMaximumSamplesPerRay()&&E(`The number of steps required ${Math.ceil(x)} is larger than the\n        specified maximum number of steps ${t.renderable.getMaximumSamplesPerRay()}.\n        Please either change the\n        volumeMapper sampleDistance or its maximum number of samples.`);const _=new Float64Array(3);if(a.R3.set(_,1,1,1),a.R3.divide(_,_,w),l.setUniform3f("vVCToIJK",_[0],_[1],_[2]),l.setUniform3i("volumeDimensions",p[0],p[1],p[2]),!t._openGLRenderWindow.getWebgl2()){const e=t.scalarTexture.getVolumeInfo();l.setUniformf("texWidth",t.scalarTexture.getWidth()),l.setUniformf("texHeight",t.scalarTexture.getHeight()),l.setUniformi("xreps",e.xreps),l.setUniformi("xstride",e.xstride),l.setUniformi("ystride",e.ystride)}const S=new Float64Array(3),I=new Float64Array(3);for(let e=0;e<6;++e){switch(e){case 1:a.R3.set(S,-1,0,0),a.R3.set(I,b[0],b[2],b[4]);break;case 2:a.R3.set(S,0,1,0),a.R3.set(I,b[1],b[3],b[5]);break;case 3:a.R3.set(S,0,-1,0),a.R3.set(I,b[0],b[2],b[4]);break;case 4:a.R3.set(S,0,0,1),a.R3.set(I,b[1],b[3],b[5]);break;case 5:a.R3.set(S,0,0,-1),a.R3.set(I,b[0],b[2],b[4]);break;default:a.R3.set(S,1,0,0),a.R3.set(I,b[1],b[3],b[5])}a.R3.transformMat3(S,S,t.idxNormalMatrix),a.R3.transformMat4(I,I,t.idxToView);const n=-1*a.R3.dot(I,S);l.setUniform3f(`vPlaneNormal${e}`,S[0],S[1],S[2]),l.setUniformf(`vPlaneDistance${e}`,n)}if(i.getProperty().getUseLabelOutline()){const n=t.currentInput.getWorldToIndex();l.setUniformMatrix("vWCtoIDX",n);const i=r.getActiveCamera(),[o,s]=i.getClippingRange(),c=i.getDistance();i.setClippingRange(c,c+.1);const u=t.openGLCamera.getKeyMatrices(r);a._E.invert(t.projectionToWorld,u.wcpc),i.setClippingRange(o,s),t.openGLCamera.getKeyMatrices(r),l.setUniformMatrix("PCWCMatrix",t.projectionToWorld);const d=e.getRenderTargetSize();l.setUniformf("vpWidth",d[0]),l.setUniformf("vpHeight",d[1]);const p=e.getRenderTargetOffset();l.setUniformf("vpOffsetX",p[0]/d[0]),l.setUniformf("vpOffsetY",p[1]/d[1])}if(a._E.invert(t.projectionToView,o.vcpc),l.setUniformMatrix("PCVCMatrix",t.projectionToView),0===t.lightComplexity)return;let D=0;const A=[],P=[],O=[];if(r.getLights().forEach(e=>{if(e.getSwitch()>0){const t=e.getColor(),n=e.getIntensity();A[0+3*D]=t[0]*n,A[1+3*D]=t[1]*n,A[2+3*D]=t[2]*n;const r=e.getDirection();a.R3.set(S,r[0],r[1],r[2]),a.R3.transformMat3(S,S,o.normalMatrix),a.R3.normalize(S,S),P[0+3*D]=S[0],P[1+3*D]=S[1],P[2+3*D]=S[2],O[0+3*D]=-.5*S[0],O[1+3*D]=-.5*S[1],O[2+3*D]=-.5*(S[2]-1),D++}}),l.setUniformi("twoSidedLighting",r.getTwoSidedLighting()),l.setUniformi("lightNum",D),l.setUniform3fv("lightColor",A),l.setUniform3fv("lightDirectionVC",P),l.setUniform3fv("lightHalfAngleVC",O),3===t.lightComplexity){D=0;const e=[],n=[],i=[],o=[],s=[];r.getLights().forEach(r=>{if(r.getSwitch()>0){const l=r.getAttenuationValues();n[0+3*D]=l[0],n[1+3*D]=l[1],n[2+3*D]=l[2],o[D]=r.getExponent(),i[D]=r.getConeAngle(),s[D]=r.getPositional();const c=r.getTransformedPosition();a.R3.transformMat4(c,c,t.modelToView),e[0+3*D]=c[0],e[1+3*D]=c[1],e[2+3*D]=c[2],D+=1}}),l.setUniform3fv("lightPositionVC",e),l.setUniform3fv("lightAttenuation",n),l.setUniformfv("lightConeAngle",i),l.setUniformfv("lightExponent",o),l.setUniformiv("lightPositional",s)}if(t.renderable.getVolumetricScatteringBlending()>0&&(l.setUniformf("giReach",t.renderable.getGlobalIlluminationReach()),l.setUniformf("volumetricScatteringBlending",t.renderable.getVolumetricScatteringBlending()),l.setUniformf("volumeShadowSamplingDistFactor",t.renderable.getVolumeShadowSamplingDistFactor()),l.setUniformf("anisotropy",t.renderable.getAnisotropy()),l.setUniformf("anisotropy2",t.renderable.getAnisotropy()**2)),t.renderable.getLocalAmbientOcclusion()&&i.getProperty().getAmbient()>0){const e=t.renderable.getLAOKernelSize();l.setUniformi("kernelSize",e);const n=[];for(let t=0;t<e;t++)n[2*t]=.5*Math.random(),n[2*t+1]=.5*Math.random();l.setUniform2fv("kernelSample",n),l.setUniformi("kernelRadius",t.renderable.getLAOKernelRadius())}},e.setPropertyShaderParameters=(n,r,i)=>{const o=n.getProgram();o.setUniformi("ctexture",t.colorTexture.getTextureUnit()),o.setUniformi("otexture",t.opacityTexture.getTextureUnit()),o.setUniformi("jtexture",t.jitterTexture.getTextureUnit()),o.setUniformi("ttexture",t.labelOutlineThicknessTexture.getTextureUnit());const a=t.scalarTexture.getVolumeInfo(),s=i.getProperty(),l=t.scalarTexture.getComponents(),c=e.useIndependentComponents(s);if(c)for(let e=0;e<l;e++)o.setUniformf(`mix${e}`,i.getProperty().getComponentWeight(e));for(let e=0;e<l;e++){const t=c?e:0,n=a.scale[e],r=s.getScalarOpacity(t).getRange(),i=n/(r[1]-r[0]),l=(a.offset[e]-r[0])/(r[1]-r[0]);o.setUniformf(`oshift${e}`,l),o.setUniformf(`oscale${e}`,i);const u=s.getRGBTransferFunction(t).getRange(),d=(a.offset[e]-u[0])/(u[1]-u[0]),p=n/(u[1]-u[0]);o.setUniformf(`cshift${e}`,d),o.setUniformf(`cscale${e}`,p)}if(t.gopacity)if(c)for(let e=0;e<l;++e){const t=a.scale[e];if(s.getUseGradientOpacity(e)){const n=s.getGradientOpacityMinimumOpacity(e),r=s.getGradientOpacityMaximumOpacity(e);o.setUniformf(`gomin${e}`,n),o.setUniformf(`gomax${e}`,r);const i=[s.getGradientOpacityMinimumValue(e),s.getGradientOpacityMaximumValue(e)];o.setUniformf(`goscale${e}`,t*(r-n)/(i[1]-i[0])),o.setUniformf(`goshift${e}`,-i[0]*(r-n)/(i[1]-i[0])+n)}else o.setUniformf(`gomin${e}`,1),o.setUniformf(`gomax${e}`,1),o.setUniformf(`goscale${e}`,0),o.setUniformf(`goshift${e}`,1)}else{const e=a.scale[l-1],t=s.getGradientOpacityMinimumOpacity(0),n=s.getGradientOpacityMaximumOpacity(0);o.setUniformf("gomin0",t),o.setUniformf("gomax0",n);const r=[s.getGradientOpacityMinimumValue(0),s.getGradientOpacityMaximumValue(0)];o.setUniformf("goscale0",e*(n-t)/(r[1]-r[0])),o.setUniformf("goshift0",-r[0]*(n-t)/(r[1]-r[0])+t)}if(!0===i.getProperty().getUseLabelOutline()){const e=i.getProperty().getLabelOutlineOpacity();o.setUniformf("outlineOpacity",e)}t.lightComplexity>0&&(o.setUniformf("vAmbient",s.getAmbient()),o.setUniformf("vDiffuse",s.getDiffuse()),o.setUniformf("vSpecular",s.getSpecular()),o.setUniformf("vSpecularPower",s.getSpecularPower()))},e.getClippingPlaneShaderParameters=(e,n,r)=>{if(t.renderable.getClippingPlanes().length>0){const r=t.openGLCamera.getKeyMatrices(n),i=[],o=[],s=[],l=t.renderable.getClippingPlanes(),c=l.length;for(let e=0;e<c;++e){const t=l[e].getNormal(),n=l[e].getOrigin();a.R3.transformMat3(t,t,r.normalMatrix),a.R3.transformMat4(n,n,r.wcvc);const c=-1*a.R3.dot(n,t);i.push(t[0]),i.push(t[1]),i.push(t[2]),o.push(c),s.push(n[0]),s.push(n[1]),s.push(n[2])}const u=e.getProgram();u.setUniform3fv("vClipPlaneNormals",i),u.setUniformfv("vClipPlaneDistances",o),u.setUniform3fv("vClipPlaneOrigins",s),u.setUniformi("clip_numPlanes",c)}},e.delete=(0,r.h)(()=>{t._animationRateSubscription&&(t._animationRateSubscription.unsubscribe(),t._animationRateSubscription=null)},e.delete),e.getRenderTargetSize=()=>{if(t._useSmallViewport)return[t._smallViewportWidth,t._smallViewportHeight];const{usize:e,vsize:n}=t._openGLRenderer.getTiledSizeAndOrigin();return[e,n]},e.getRenderTargetOffset=()=>{const{lowerLeftU:e,lowerLeftV:n}=t._openGLRenderer.getTiledSizeAndOrigin();return[e,n]},e.getCurrentSampleDistance=e=>{const n=e.getVTKWindow().getInteractor(),r=t.renderable.getSampleDistance();if(n.isAnimating()){return r*t.renderable.getInteractionSampleDistanceFactor()}return r},e.renderPieceStart=(n,r)=>{const i=n.getVTKWindow().getInteractor();if(t._lastScale||(t._lastScale=t.renderable.getInitialInteractionScale()),t._useSmallViewport=!1,i.isAnimating()&&t._lastScale>1.5&&(t._useSmallViewport=!0),t._animationRateSubscription||(t._animationRateSubscription=i.onAnimationFrameRateUpdate(()=>{if(t.renderable.getAutoAdjustSampleDistances()){const e=i.getRecentAnimationFrameRate(),n=i.getDesiredUpdateRate()/e;(n>1.15||n<.85)&&(t._lastScale*=n),t._lastScale>400&&(t._lastScale=400),t._lastScale<1.5&&(t._lastScale=1.5)}else t._lastScale=t.renderable.getImageSampleDistance()*t.renderable.getImageSampleDistance()})),t._useSmallViewport){const e=t._openGLRenderWindow.getFramebufferSize(),n=1/Math.sqrt(t._lastScale);if(t._smallViewportWidth=Math.ceil(n*e[0]),t._smallViewportHeight=Math.ceil(n*e[1]),t._smallViewportHeight>e[1]&&(t._smallViewportHeight=e[1]),t._smallViewportWidth>e[0]&&(t._smallViewportWidth=e[0]),t.framebuffer.saveCurrentBindingsAndBuffers(),null===t.framebuffer.getGLFramebuffer())t.framebuffer.create(e[0],e[1]),t.framebuffer.populateFramebuffer();else{const n=t.framebuffer.getSize();n&&n[0]===e[0]&&n[1]===e[1]||(t.framebuffer.create(e[0],e[1]),t.framebuffer.populateFramebuffer())}t.framebuffer.bind();const r=t.context;r.clearColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clear(r.COLOR_BUFFER_BIT),r.viewport(0,0,t._smallViewportWidth,t._smallViewportHeight),t.fvp=[t._smallViewportWidth/e[0],t._smallViewportHeight/e[1]]}t.context.disable(t.context.DEPTH_TEST),e.updateBufferObjects(n,r);r.getProperty().getInterpolationType()===b.ZG.NEAREST?(t.scalarTexture.setMinificationFilter(y.w.NEAREST),t.scalarTexture.setMagnificationFilter(y.w.NEAREST)):(t.scalarTexture.setMinificationFilter(y.w.LINEAR),t.scalarTexture.setMagnificationFilter(y.w.LINEAR)),null!==t.zBufferTexture&&t.zBufferTexture.activate()},e.renderPieceDraw=(n,r)=>{const i=t.context;t.scalarTexture.activate(),t.opacityTexture.activate(),t.labelOutlineThicknessTexture.activate(),t.colorTexture.activate(),t.jitterTexture.activate(),e.updateShaders(t.tris,n,r),i.drawArrays(i.TRIANGLES,0,t.tris.getCABO().getElementCount()),t.tris.getVAO().release(),t.scalarTexture.deactivate(),t.colorTexture.deactivate(),t.opacityTexture.deactivate(),t.labelOutlineThicknessTexture.deactivate(),t.jitterTexture.deactivate()},e.renderPieceFinish=(e,n)=>{if(null!==t.zBufferTexture&&t.zBufferTexture.deactivate(),t._useSmallViewport){if(t.framebuffer.restorePreviousBindingsAndBuffers(),null===t.copyShader){t.copyShader=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join("\n"),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join("\n"),"");const e=t.copyShader;t.copyVAO=m.ZP.newInstance(),t.copyVAO.setOpenGLRenderWindow(t._openGLRenderWindow),t.tris.getCABO().bind(),t.copyVAO.addAttributeArray(e,t.tris.getCABO(),"vertexDC",t.tris.getCABO().getVertexOffset(),t.tris.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||T("Error setting vertexDC in copy shader VAO.")}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(t.copyShader);const e=t._openGLRenderWindow.getFramebufferSize();t.context.viewport(0,0,e[0],e[1]);const n=t.framebuffer.getColorTexture();n.activate(),t.copyShader.setUniformi("texture",n.getTextureUnit()),t.copyShader.setUniform2f("tfactor",t.fvp[0],t.fvp[1]);const r=t.context;r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),t.context.drawArrays(t.context.TRIANGLES,0,t.tris.getCABO().getElementCount()),n.deactivate(),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)}},e.renderPiece=(n,r)=>{e.invokeEvent({type:"StartEvent"}),t.renderable.update(),t.currentInput=t.renderable.getInputData(),e.invokeEvent({type:"EndEvent"}),t.currentInput?(e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r)):T("No input!")},e.computeBounds=(n,r)=>{e.getInput()?t.bounds=e.getInput().getBounds():(0,u.u)(t.Bounds)},e.updateBufferObjects=(t,n)=>{e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=(n,r)=>t.VBOBuildTime.getMTime()<e.getMTime()||t.VBOBuildTime.getMTime()<r.getMTime()||t.VBOBuildTime.getMTime()<t.renderable.getMTime()||t.VBOBuildTime.getMTime()<r.getProperty().getMTime()||t.VBOBuildTime.getMTime()<t.currentInput.getMTime(),e.buildBufferObjects=(n,r)=>{const i=t.currentInput;if(!i)return;const o=i.getPointData()&&i.getPointData().getScalars();if(!o)return;t._scalars!==o&&(t._openGLRenderWindow.releaseGraphicsResourcesForObject(t._scalars),t._scalars=o);const a=r.getProperty();if(!t.jitterTexture.getHandle()){const e=new Uint8Array(1024);for(let t=0;t<1024;++t)e[t]=255*Math.random();t.jitterTexture.setMinificationFilter(y.w.LINEAR),t.jitterTexture.setMagnificationFilter(y.w.LINEAR),t.jitterTexture.create2DFromRaw(32,32,1,l.Tu.UNSIGNED_CHAR,e)}const c=o.getNumberOfComponents(),u=e.useIndependentComponents(a),d=u?c:1,p=a.getScalarOpacity(),h=t._openGLRenderWindow.getGraphicsResourceForObject(p);let f=x(p,u,d);if(!h.vtkObj||h.hash!==f||t.opacityTextureString!==f){const r=1024,i=2*r*d,o=new Float32Array(i),s=new Float32Array(r);for(let t=0;t<d;++t){const i=a.getScalarOpacity(t),l=e.getCurrentSampleDistance(n)/a.getScalarOpacityUnitDistance(t),c=i.getRange();i.getTable(c[0],c[1],r,s,1);for(let e=0;e<r;++e)o[t*r*2+e]=1-(1-s[e])**l,o[t*r*2+e+r]=o[t*r*2+e]}if(t.opacityTexture.releaseGraphicsResources(t._openGLRenderWindow),t.opacityTexture.resetFormatAndType(),t.opacityTexture.setMinificationFilter(y.w.LINEAR),t.opacityTexture.setMagnificationFilter(y.w.LINEAR),t._openGLRenderWindow.getWebgl2()||t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear"))t.opacityTexture.create2DFromRaw(r,2*d,1,l.Tu.FLOAT,o);else{const e=new Uint8ClampedArray(i);for(let t=0;t<i;++t)e[t]=255*o[t];t.opacityTexture.create2DFromRaw(r,2*d,1,l.Tu.UNSIGNED_CHAR,e)}t.opacityTextureString=f,p&&t._openGLRenderWindow.setGraphicsResourceForObject(p,t.opacityTexture,t.opacityTextureString)}else t.opacityTexture=h.vtkObj,t.opacityTextureString=h.hash;const m=a.getRGBTransferFunction();f=x(m,u,d);const g=t._openGLRenderWindow.getGraphicsResourceForObject(m);if(!g?.vtkObj||g?.hash!==f||t.colorTextureString!==f){const e=1024,n=new Uint8ClampedArray(2*e*d*3),r=new Float32Array(3*e);for(let t=0;t<d;++t){const i=a.getRGBTransferFunction(t),o=i.getRange();i.getTable(o[0],o[1],e,r,1);for(let i=0;i<3*e;++i)n[t*e*6+i]=255*r[i],n[t*e*6+i+3*e]=255*r[i]}t.colorTexture.releaseGraphicsResources(t._openGLRenderWindow),t.colorTexture.resetFormatAndType(),t.colorTexture.setMinificationFilter(y.w.LINEAR),t.colorTexture.setMagnificationFilter(y.w.LINEAR),t.colorTexture.create2DFromRaw(e,2*d,3,l.Tu.UNSIGNED_CHAR,n),t.colorTextureString=f,m&&t._openGLRenderWindow.setGraphicsResourceForObject(m,t.colorTexture,t.colorTextureString)}else t.colorTexture=g.vtkObj,t.colorTextureString=g.hash;e.updateLabelOutlineThicknessTexture(r);const b=t._openGLRenderWindow.getGraphicsResourceForObject(o);f=`${i.getMTime()}A${o.getMTime()}`;if(!b?.vtkObj||b?.hash!==f){const e=i.getDimensions();t.scalarTexture.setOglNorm16Ext(t.context.getExtension("EXT_texture_norm16")),t.scalarTexture.releaseGraphicsResources(t._openGLRenderWindow),t.scalarTexture.resetFormatAndType(),t.scalarTexture.create3DFilterableFromDataArray(e[0],e[1],e[2],o,t.renderable.getPreferSizeOverAccuracy()),o&&t._openGLRenderWindow.setGraphicsResourceForObject(o,t.scalarTexture,f)}else t.scalarTexture=b.vtkObj;if(!t.tris.getCABO().getElementCount()){const e=new Float32Array(12);for(let t=0;t<4;t++)e[3*t]=t%2*2-1,e[3*t+1]=t>1?1:-1,e[3*t+2]=-1;const n=new Uint16Array(8);n[0]=3,n[1]=0,n[2]=1,n[3]=3,n[4]=3,n[5]=0,n[6]=3,n[7]=2;const r=s.default.newInstance({numberOfComponents:3,values:e});r.setName("points");const i=s.default.newInstance({numberOfComponents:1,values:n});t.tris.getCABO().createVBO(i,"polys",v.hX.SURFACE,{points:r,cellOffset:0})}t.VBOBuildTime.modified()},e.updateLabelOutlineThicknessTexture=e=>{const n=e.getProperty().getLabelOutlineThickness(),r=t._openGLRenderWindow.getGraphicsResourceForObject(n),i=`${n.join("-")}`;if(!r?.vtkObj||r?.hash!==i||t.labelOutlineThicknessTextureString!==i){const e=1024,r=1,o=new Uint8Array(e*r);for(let t=0;t<e;++t){const e=void 0!==n[t]?n[t]:n[0];o[t]=e}t.labelOutlineThicknessTexture.releaseGraphicsResources(t._openGLRenderWindow),t.labelOutlineThicknessTexture.resetFormatAndType(),t.labelOutlineThicknessTexture.setMinificationFilter(y.w.NEAREST),t.labelOutlineThicknessTexture.setMagnificationFilter(y.w.NEAREST),t.labelOutlineThicknessTexture.create2DFromRaw(e,r,1,l.Tu.UNSIGNED_CHAR,o),t.labelOutlineThicknessTextureString=i,n&&t._openGLRenderWindow.setGraphicsResourceForObject(n,t.labelOutlineThicknessTexture,t.labelOutlineThicknessTextureString)}else t.labelOutlineThicknessTexture=r.vtkObj,t.labelOutlineThicknessTextureString=r.hash}}const S={context:null,VBOBuildTime:null,scalarTexture:null,scalarTextureString:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0,_scalars:null};function I(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,S,n),g.Z.extend(e,t,n),h.Z.implementBuildShadersWithReplacements(e,t,n),t.VBOBuildTime={},(0,r.o)(t.VBOBuildTime,{mtime:0}),t.tris=c.default.newInstance(),t.scalarTexture=p.default.newInstance(),t.opacityTexture=p.default.newInstance(),t.colorTexture=p.default.newInstance(),t.jitterTexture=p.default.newInstance(),t.jitterTexture.setWrapS(y.E.REPEAT),t.jitterTexture.setWrapT(y.E.REPEAT),t.labelOutlineThicknessTexture=p.default.newInstance(),t.framebuffer=d.ZP.newInstance(),t.idxToView=a._E.identity(new Float64Array(16)),t.idxNormalMatrix=a.wO.identity(new Float64Array(9)),t.modelToView=a._E.identity(new Float64Array(16)),t.projectionToView=a._E.identity(new Float64Array(16)),t.projectionToWorld=a._E.identity(new Float64Array(16)),(0,r.e)(e,t,["context"]),_(e,t)}const D=(0,r.n)(I,"vtkOpenGLVolumeMapper");var A={newInstance:D,extend:I};(0,w.vw)("vtkVolumeMapper",D)},25460:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});var r="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyDataFS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n// Template for the polydata mappers fragment shader\n\nuniform int PrimitiveIDOffset;\n\n// VC position of this fragment\n//VTK::PositionVC::Dec\n\n// optional color passed in from the vertex shader, vertexColor\n//VTK::Color::Dec\n\n// optional surface normal declaration\n//VTK::Normal::Dec\n\n// extra lighting parameters\n//VTK::Light::Dec\n\n// define vtkImageLabelOutlineOn\n//VTK::ImageLabelOutlineOn\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// picking support\n//VTK::Picking::Dec\n\n// Depth Peeling Support\n//VTK::DepthPeeling::Dec\n\n// clipping plane vars\n//VTK::Clip::Dec\n\n// label outline \n//VTK::LabelOutline::Dec\n\n// the output of this shader\n//VTK::Output::Dec\n\n// Apple Bug\n//VTK::PrimID::Dec\n\n// handle coincident offsets\n//VTK::Coincident::Dec\n\n//VTK::ZBuffer::Dec\n\n//VTK::LabelOutlineHelperFunction\n\nvoid main()\n{\n  // VC position of this fragment. This should not branch/return/discard.\n  //VTK::PositionVC::Impl\n\n  // Place any calls that require uniform flow (e.g. dFdx) here.\n  //VTK::UniformFlow::Impl\n\n  // Set gl_FragDepth here (gl_FragCoord.z by default)\n  //VTK::Depth::Impl\n\n  // Early depth peeling abort:\n  //VTK::DepthPeeling::PreColor\n\n  // Apple Bug\n  //VTK::PrimID::Impl\n\n  //VTK::Clip::Impl\n\n  //VTK::Color::Impl\n\n  // Generate the normal if we are not passed in one\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Light::Impl\n\n  if (gl_FragData[0].a <= 0.0)\n    {\n    discard;\n    }\n\n  //VTK::DepthPeeling::Impl\n\n  //VTK::Picking::Impl\n\n  // handle coincident offsets\n  //VTK::Coincident::Impl\n\n  //VTK::ZBuffer::Impl\n\n  //VTK::RenderPassFragmentShader::Impl\n}\n"},81270:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});var r="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkPolyDataVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n\nattribute vec4 vertexMC;\n\n// frag position in VC\n//VTK::PositionVC::Dec\n\n// optional normal declaration\n//VTK::Normal::Dec\n\n// extra lighting parameters\n//VTK::Light::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// material property values\n//VTK::Color::Dec\n\n// clipping plane vars\n//VTK::Clip::Dec\n\n// camera and actor matrix values\n//VTK::Camera::Dec\n\n// Apple Bug\n//VTK::PrimID::Dec\n\n// picking support\n//VTK::Picking::Dec\n\nvoid main()\n{\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Clip::Impl\n\n  //VTK::PrimID::Impl\n\n  //VTK::PositionVC::Impl\n\n  //VTK::Light::Impl\n\n  //VTK::Picking::Impl\n}\n"},15e3:(e,t,n)=>{"use strict";n(34349),n(6872);var r=n(68470),i=n(72076),o=n(17197),a=n(46576);const{vtkErrorMacro:s}=r.m;class l{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const t=e[0],n=e[e.length-1];if(t===n||e.length<2)return;const r=this.segmentMapping[t],i=this.segmentMapping[n];if(void 0!==r&&void 0!==i)if(Math.abs(r)===Math.abs(i)){const o=r<i?i:r,a=this.segments[o];if(r>0)for(let t=1;t<e.length-1;t++)a.push(e[t]);else for(let t=1;t<e.length-1;t++)a.unshift(e[e.length-1-t]);this.faces.push(a),this.segments[o]=null,this.segmentMapping[t]=void 0,this.segmentMapping[n]=void 0}else{const t=Math.abs(r),n=Math.abs(i),o=this.segments[t],a=this.segments[n];this.segments[t]=null,this.segments[n]=null,this.segmentMapping[o[0]]=void 0,this.segmentMapping[a[0]]=void 0,this.segmentMapping[o[o.length-1]]=void 0,this.segmentMapping[a[a.length-1]]=void 0,this.addSegment(e),this.addSegment(o),this.addSegment(a)}else if(void 0!==r){if(r>0){const t=this.segments[r];for(let n=1;n<e.length;n++)t.push(e[n]);this.segmentMapping[n]=r}else{const t=this.segments[-r];this.segmentMapping[n]=r;for(let n=1;n<e.length;n++)t.unshift(e[n])}this.segmentMapping[t]=void 0}else if(void 0!==i){if(i>0){const n=this.segments[i];for(let t=1;t<e.length;t++)n.push(e[e.length-1-t]);this.segmentMapping[t]=i}else{const n=this.segments[-i];this.segmentMapping[t]=i;for(let t=1;t<e.length;t++)n.unshift(e[e.length-t-1])}this.segmentMapping[n]=void 0}else{const r=this.segments.length;this.segments.push(e),this.segmentMapping[t]=-r,this.segmentMapping[n]=r}}}const c={};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),r.m.obj(e,t),r.m.algo(e,t,1,1),function(e,t){t.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),e.requestData=(e,t)=>{const n=e[0];if(!n)return void s("Invalid or missing input");const r=a.ZP.newInstance();r.shallowCopy(n);const i=new l,c=n.getLines().getData();let u=0;for(;u<c.length;){const e=c[u++],t=[];for(let n=0;n<e;n++)t.push(c[u+n]);i.addSegment(t),u+=e}const{faces:d}=i;let p=d.length;for(let e=0;e<d.length;e++)p+=d[e].length;const h=new Uint16Array(p);u=0;for(let e=0;e<d.length;e++){const t=d[e];h[u++]=t.length;for(let e=0;e<t.length;e++)h[u++]=t[e]}r.setPolys(o.ZP.newInstance({values:h,name:"faces"})),t[0]=r}}(e,t)}var d={newInstance:r.m.newInstance(u,"vtkClosedPolyLineToSurfaceFilter"),extend:u},p=n(2755),h=n(54131),f=n(59269),m=n(97442);const{vtkErrorMacro:g}=r.m;const v={};function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,v,n),r.m.obj(e,t),r.m.algo(e,t,1,1),t._cubeSource=m.ZP.newInstance(),r.m.moveToProtected(e,t,["cubeSource","tmpOut"]),function(e,t){t.classHierarchy.push("vtkImageDataOutlineFilter");const n={...e};e.requestData=(e,n)=>{const r=e[0];if(!r||!r.isA("vtkImageData"))return void g("Invalid or missing input");const i=r.getSpatialExtent();i?(t._cubeSource.setBounds(i),t._cubeSource.setMatrix(r.getIndexToWorld()),n[0]=t._cubeSource.getOutputData()):g("Unable to fetch spatial extents of input image.")},e.getMTime=()=>Math.max(n.getMTime(),t._cubeSource.getMTime()),e.setGenerateFaces=t._cubeSource.setGenerateFaces,e.setGenerateLines=t._cubeSource.setGenerateLines,e.getGenerateFaces=t._cubeSource.getGenerateFaces,e.getGenerateLines=t._cubeSource.getGenerateLines}(e,t)}var b={newInstance:r.m.newInstance(y,"vtkImageDataOutlineFilter"),extend:y},C=n(59474),w=n(41247),E=n(3969),T=n(51815),x=n(53118);let _;const S={preMultiplyFlag:!1,matrix:[...n(40286).Wd]};function I(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,S,n),r.m.obj(e,t),r.m.setGet(e,t,["preMultiplyFlag"]),r.m.setGetArray(e,t,["matrix"],16),function(e,t){t.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),e.transformPoint=(e,n)=>(i.R3.transformMat4(n,e,t.matrix),n),e.transformPoints=(e,n)=>{const r=new Float64Array(3),o=new Float64Array(3);for(let a=0;a<e.length;a+=3)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],i.R3.transformMat4(o,r,t.matrix),n[a]=o[0],n[a+1]=o[1],n[a+2]=o[2];return n},e.preMultiply=()=>{e.setPreMultiplyFlag(!0)},e.postMultiply=()=>{e.setPreMultiplyFlag(!1)},e.transformMatrix=(e,n)=>(t.preMultiplyFlag?i._E.multiply(n,t.matrix,e):i._E.multiply(n,e,t.matrix),n),e.transformMatrices=(e,n)=>{const r=new Float64Array(16),o=new Float64Array(16),a=t.preMultiplyFlag?()=>i._E.multiply(o,t.matrix,r):()=>i._E.multiply(o,r,t.matrix);for(let t=0;t<e.length;t+=16){for(let n=0;n<16;++n)r[n]=e[t+n];a();for(let e=0;e<16;++e)n[t+e]=o[e]}return n},e.getInverse=()=>_({matrix:C.f.invertMatrix(Array.from(t.matrix),[],4),preMultiplyFlag:t.preMultiplyFlag})}(e,t)}_=r.m.newInstance(I,"vtkTransform");var D={newInstance:_,extend:I},A=n(6814),P=n(87730),O=n(39648),R=n(42695),M=n(89262),N=n(11145);const{vtkErrorMacro:L}=r.c;function k(e,t,n){if(t){const r=e.getIndependentComponents();return`${t.getMTime()}-${r}-${n}`}return"0"}function F(e,t,n){return t.identity(n),e.reduce((e,n,r)=>0===r?n?t.copy(e,n):t.identity(e):n?t.multiply(e,e,n):e,n)}function V(e,t){t.classHierarchy.push("vtkOpenGLImageResliceMapper"),e.buildPass=n=>{if(n){t.currentRenderPass=null,t._openGLImageSlice=e.getFirstAncestorOfType("vtkOpenGLImageSlice"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer");const n=t._openGLRenderer.getRenderable();t._openGLCamera=t._openGLRenderer.getViewNodeFor(n.getActiveCamera()),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.context=t._openGLRenderWindow.getContext(),t.tris.setOpenGLRenderWindow(t._openGLRenderWindow)}},e.translucentPass=(n,r)=>{n&&(t.currentRenderPass=r,e.render())},e.zBufferPass=n=>{n&&(t.haveSeenDepthRequest=!0,t.renderDepth=!0,e.render(),t.renderDepth=!1)},e.opaqueZBufferPass=t=>e.zBufferPass(t),e.opaquePass=t=>{t&&e.render()},e.getCoincidentParameters=(e,n)=>t.renderable.getResolveCoincidentTopology()?t.renderable.getCoincidentTopologyPolygonOffsetParameters():null,e.render=()=>{const n=t._openGLImageSlice.getRenderable(),r=t._openGLRenderer.getRenderable();e.renderPiece(r,n)},e.renderPiece=(n,r)=>{e.invokeEvent({type:"StartEvent"}),t.renderable.update(),t.currentInput=t.renderable.getInputData(),t.currentInput?(e.updateResliceGeometry(),e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r),e.invokeEvent({type:"EndEvent"})):L("No input!")},e.renderPieceStart=(n,r)=>{e.updateBufferObjects(n,r);r.getProperty().getInterpolationType()===O.Z.NEAREST?(t.openGLTexture.setMinificationFilter(P.w.NEAREST),t.openGLTexture.setMagnificationFilter(P.w.NEAREST),t.colorTexture.setMinificationFilter(P.w.NEAREST),t.colorTexture.setMagnificationFilter(P.w.NEAREST),t.pwfTexture.setMinificationFilter(P.w.NEAREST),t.pwfTexture.setMagnificationFilter(P.w.NEAREST)):(t.openGLTexture.setMinificationFilter(P.w.LINEAR),t.openGLTexture.setMagnificationFilter(P.w.LINEAR),t.colorTexture.setMinificationFilter(P.w.LINEAR),t.colorTexture.setMagnificationFilter(P.w.LINEAR),t.pwfTexture.setMinificationFilter(P.w.LINEAR),t.pwfTexture.setMagnificationFilter(P.w.LINEAR)),t.lastBoundBO=null},e.renderPieceDraw=(n,r)=>{const i=t.context;t.openGLTexture.activate(),t.colorTexture.activate(),t.pwfTexture.activate(),e.updateShaders(t.tris,n,r),i.drawArrays(i.TRIANGLES,0,t.tris.getCABO().getElementCount()),t.tris.getVAO().release(),t.openGLTexture.deactivate(),t.colorTexture.deactivate(),t.pwfTexture.deactivate()},e.renderPieceFinish=(e,t)=>{},e.updateBufferObjects=(t,n)=>{e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=(n,r)=>t.VBOBuildTime.getMTime()<e.getMTime()||t.VBOBuildTime.getMTime()<r.getMTime()||t.VBOBuildTime.getMTime()<t.renderable.getMTime()||t.VBOBuildTime.getMTime()<r.getProperty().getMTime()||t.VBOBuildTime.getMTime()<t.currentInput.getMTime()||t.VBOBuildTime.getMTime()<t.resliceGeom.getMTime(),e.buildBufferObjects=(e,n)=>{const r=t.currentInput;if(!r)return;const i=r.getPointData()?.getScalars();if(!i)return;t._scalars!==i&&(t._openGLRenderWindow.releaseGraphicsResourcesForObject(t._scalars),t._scalars=i);const o=i.getNumberOfComponents();let a=`${r.getMTime()}A${i.getMTime()}`;const s=t._openGLRenderWindow.getGraphicsResourceForObject(i);if(!s?.vtkObj||s?.hash!==a||t.openGLTextureString!==a){t.openGLTexture||(t.openGLTexture=w.default.newInstance(),t.openGLTexture.setOpenGLRenderWindow(t._openGLRenderWindow));const e=r.getDimensions();t.openGLTexture.setOglNorm16Ext(t.context.getExtension("EXT_texture_norm16")),t.openGLTexture.releaseGraphicsResources(t._openGLRenderWindow),t.openGLTexture.resetFormatAndType(),t.openGLTexture.create3DFilterableFromDataArray(e[0],e[1],e[2],i),t.openGLTextureString=a,i&&t._openGLRenderWindow.setGraphicsResourceForObject(i,t.openGLTexture,t.openGLTextureString)}else t.openGLTexture=s.vtkObj,t.openGLTextureString=s.hash;const l=n.getProperty(),c=l.getIndependentComponents(),u=c?o:1,d=c?2*u:1,p=l.getRGBTransferFunction();a=k(l,p,u);const f=t._openGLRenderWindow.getGraphicsResourceForObject(p);if(!f?.vtkObj||f?.hash!==a||t.colorTextureString!==a){const e=1024,n=new Uint8ClampedArray(e*d*3);if(t.colorTexture||(t.colorTexture=w.default.newInstance(),t.colorTexture.setOpenGLRenderWindow(t._openGLRenderWindow)),p){const r=new Float32Array(3*e);for(let t=0;t<u;t++){const i=l.getRGBTransferFunction(t),o=i.getRange();if(i.getTable(o[0],o[1],e,r,1),c)for(let i=0;i<3*e;i++)n[t*e*6+i]=255*r[i],n[t*e*6+i+3*e]=255*r[i];else for(let i=0;i<3*e;i++)n[t*e*6+i]=255*r[i]}t.colorTexture.releaseGraphicsResources(t._openGLRenderWindow),t.colorTexture.resetFormatAndType(),t.colorTexture.create2DFromRaw(e,d,3,M.Tu.UNSIGNED_CHAR,n)}else{for(let t=0;t<3*e;++t)n[t]=255*t/(3*(e-1)),n[t+1]=255*t/(3*(e-1)),n[t+2]=255*t/(3*(e-1));t.colorTexture.releaseGraphicsResources(t._openGLRenderWindow),t.colorTexture.resetFormatAndType(),t.colorTexture.create2DFromRaw(e,1,3,M.Tu.UNSIGNED_CHAR,n)}t.colorTextureString=a,p&&t._openGLRenderWindow.setGraphicsResourceForObject(p,t.colorTexture,t.colorTextureString)}else t.colorTexture=f.vtkObj,t.colorTextureString=f.hash;const m=l.getPiecewiseFunction();a=k(l,m,u);const g=t._openGLRenderWindow.getGraphicsResourceForObject(m);if(!g?.vtkObj||g?.hash!==a||t.pwfTextureString!==a){const e=1024,n=e*d,r=new Uint8ClampedArray(n);if(t.pwfTexture||(t.pwfTexture=w.default.newInstance(),t.pwfTexture.setOpenGLRenderWindow(t._openGLRenderWindow)),m){const r=new Float32Array(n),i=new Float32Array(e);for(let t=0;t<u;++t){const n=l.getPiecewiseFunction(t);if(null===n)r.fill(1);else{const o=n.getRange();if(n.getTable(o[0],o[1],e,i,1),c)for(let n=0;n<e;n++)r[t*e*2+n]=i[n],r[t*e*2+n+e]=i[n];else for(let n=0;n<e;n++)r[t*e*2+n]=i[n]}}t.pwfTexture.releaseGraphicsResources(t._openGLRenderWindow),t.pwfTexture.resetFormatAndType(),t.pwfTexture.create2DFromRaw(e,d,1,M.Tu.FLOAT,r)}else r.fill(255),t.pwfTexture.releaseGraphicsResources(t._openGLRenderWindow),t.pwfTexture.resetFormatAndType(),t.pwfTexture.create2DFromRaw(e,1,1,M.Tu.UNSIGNED_CHAR,r);t.pwfTextureString=a,m&&t._openGLRenderWindow.setGraphicsResourceForObject(m,t.pwfTexture,t.pwfTextureString)}else t.pwfTexture=g.vtkObj,t.pwfTextureString=g.hash;const v=`${t.resliceGeom.getMTime()}A${t.renderable.getSlabThickness()}`;if(!t.tris.getCABO().getElementCount()||t.VBOBuildString!==v){const e=h.default.newInstance({numberOfComponents:3,values:t.resliceGeom.getPoints().getData()});e.setName("points");const n=h.default.newInstance({numberOfComponents:1,values:t.resliceGeom.getPolys().getData()}),r={points:e,cellOffset:0};if(t.renderable.getSlabThickness()>0){const e=t.resliceGeom.getPointData().getNormals();e?r.normals=e:L("Slab mode requested without normals")}t.tris.getCABO().createVBO(n,"polys",R.hX.SURFACE,r)}t.VBOBuildString=v,t.VBOBuildTime.modified()},e.updateShaders=(n,r,i)=>{if(t.lastBoundBO=n,e.getNeedToRebuildShaders(n,r,i)){const o={Vertex:null,Fragment:null,Geometry:null};e.buildShaders(o,r,i);const a=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==n.getProgram()&&(n.setProgram(a),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),e.setMapperShaderParameters(n,r,i),e.setCameraShaderParameters(n,r,i),e.setPropertyShaderParameters(n,r,i)},e.setMapperShaderParameters=(n,r,o)=>{const a=n.getProgram();if(n.getCABO().getElementCount()&&(t.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){a.isUniformUsed("texture1")&&a.setUniformi("texture1",t.openGLTexture.getTextureUnit()),a.isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(a,n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||L("Error setting vertexWC in shader VAO.")),a.isAttributeUsed("normalWC")&&(n.getVAO().addAttributeArray(a,n.getCABO(),"normalWC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),t.context.FLOAT,3,t.context.FALSE)||L("Error setting normalWC in shader VAO.")),a.isUniformUsed("slabThickness")&&a.setUniformf("slabThickness",t.renderable.getSlabThickness()),a.isUniformUsed("spacing")&&a.setUniform3fv("spacing",t.currentInput.getSpacing()),a.isUniformUsed("slabType")&&a.setUniformi("slabType",t.renderable.getSlabType()),a.isUniformUsed("slabType")&&a.setUniformi("slabType",t.renderable.getSlabType()),a.isUniformUsed("slabTrapezoid")&&a.setUniformi("slabTrapezoid",t.renderable.getSlabTrapezoidIntegration());const e=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null;if(a.isUniformUsed("WCTCMatrix")){const n=t.currentInput,r=n.getDimensions();i._E.copy(t.tmpMat4,n.getIndexToWorld()),i._E.scale(t.tmpMat4,t.tmpMat4,r),i._E.invert(t.tmpMat4,t.tmpMat4),e&&i._E.multiply(t.tmpMat4,t.tmpMat4,e),a.setUniformMatrix("WCTCMatrix",t.tmpMat4)}a.isUniformUsed("vboScaling")&&a.setUniform3fv("vboScaling",n.getCABO().getCoordScale()),n.getAttributeUpdateTime().modified()}if(t.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",t.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const t=e.getCoincidentParameters(r,o);n.getProgram().setUniformf("coffset",t.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",t.factor)}},e.setCameraShaderParameters=(e,n,r)=>{const o=t._openGLCamera.getKeyMatrices(n),a=t._openGLImageSlice.getKeyMatrices(),s=e.getCABO().getCoordShiftAndScaleEnabled()?e.getCABO().getInverseShiftAndScaleMatrix():null,l=e.getProgram();l.isUniformUsed("MCPCMatrix")&&(i._E.identity(t.tmpMat4),l.setUniformMatrix("MCPCMatrix",F([o.wcpc,a.mcwc,s],i._E,t.tmpMat4))),l.isUniformUsed("MCVCMatrix")&&(i._E.identity(t.tmpMat4),l.setUniformMatrix("MCVCMatrix",F([o.wcvc,a.mcwc,s],i._E,t.tmpMat4)))},e.setPropertyShaderParameters=(e,n,r)=>{const i=e.getProgram(),o=r.getProperty(),a=o.getOpacity();i.setUniformf("opacity",a);const s=t.openGLTexture.getComponents(),l=o.getIndependentComponents();if(l)for(let e=0;e<s;++e)i.setUniformf(`mix${e}`,o.getComponentWeight(e));const c=t.openGLTexture.getVolumeInfo();for(let e=0;e<s;e++){let t=o.getColorWindow(),n=o.getColorLevel();const r=l?e:0,a=o.getRGBTransferFunction(r);if(a&&o.getUseLookupTableScalarRange()){const e=a.getRange();t=e[1]-e[0],n=.5*(e[1]+e[0])}const s=c.scale[e]/t,u=(c.offset[e]-n)/t+.5;i.setUniformf(`cshift${e}`,u),i.setUniformf(`cscale${e}`,s)}const u=t.colorTexture.getTextureUnit();i.setUniformi("colorTexture1",u);for(let e=0;e<s;e++){let t=1,n=0;const r=l?e:0,a=o.getPiecewiseFunction(r);if(a){const r=a.getRange(),i=r[1]-r[0],o=.5*(r[0]+r[1]);t=c.scale[e]/i,n=(c.offset[e]-o)/i+.5}i.setUniformf(`pwfshift${e}`,n),i.setUniformf(`pwfscale${e}`,t)}const d=t.pwfTexture.getTextureUnit();i.setUniformi("pwfTexture1",d),i.setUniform4fv("backgroundColor",t.renderable.getBackgroundColor())},e.getNeedToRebuildShaders=(e,n,r)=>{const i=t.openGLTexture.getComponents(),o=r.getProperty().getIndependentComponents(),a=t.renderable.getSlabThickness(),s=t.renderable.getSlabType(),l=t.renderable.getSlabTrapezoidIntegration();let c=!1;return(!t.currentRenderPass&&t.lastRenderPassShaderReplacement||t.currentRenderPass&&t.currentRenderPass.getShaderReplacement()!==t.lastRenderPassShaderReplacement)&&(c=!0),!(!c&&t.lastHaveSeenDepthRequest===t.haveSeenDepthRequest&&0!==e.getProgram()?.getHandle()&&t.lastTextureComponents===i&&t.lastIndependentComponents===o&&t.lastSlabThickness===a&&t.lastSlabType===s&&t.lastSlabTrapezoidIntegration===l)&&(t.lastHaveSeenDepthRequest=t.haveSeenDepthRequest,t.lastTextureComponents=i,t.lastIndependentComponents=o,t.lastSlabThickness=a,t.lastSlabType=s,t.lastSlabTrapezoidIntegration=l,!0)},e.getShaderTemplate=(e,t,n)=>{e.Vertex="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkImageResliceMapperVS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n\n// all variables that represent positions or directions have a suffix\n// indicating the coordinate system they are in. The possible values are\n// MC - Model coordinates\n// WC - World coordinates\n// VC - View coordinates\n// DC - Display coordinates\n// TC - Texture coordinates\n\n// frag position in VC\n//VTK::PositionVC::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// picking support\n//VTK::Picking::Dec\n\n// camera and actor matrix values\n//VTK::Camera::Dec\n\nvoid main()\n{\n  //VTK::PositionVC::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Picking::Impl\n}\n",e.Fragment="//VTK::System::Dec\n\n/*=========================================================================\n\n  Program:   Visualization Toolkit\n  Module:    vtkImageResliceMapperFS.glsl\n\n  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen\n  All rights reserved.\n  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.\n\n     This software is distributed WITHOUT ANY WARRANTY; without even\n     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n     PURPOSE.  See the above copyright notice for more information.\n\n=========================================================================*/\n// Template for the gpu image mapper fragment shader\n\n// VC position of this fragment\n//VTK::PositionVC::Dec\n\n// Texture coordinates\n//VTK::TCoord::Dec\n\n// picking support\n//VTK::Picking::Dec\n\n// handle coincident offsets\n//VTK::Coincident::Dec\n\n//VTK::ZBuffer::Dec\n\n// the output of this shader\n//VTK::Output::Dec\n\nvoid main()\n{\n  // VC position of this fragment. This should not branch/return/discard.\n  //VTK::PositionVC::Impl\n\n  // Place any calls that require uniform flow (e.g. dFdx) here.\n  //VTK::UniformFlow::Impl\n\n  // Set gl_FragDepth here (gl_FragCoord.z by default)\n  //VTK::Depth::Impl\n\n  // Early depth peeling abort:\n  //VTK::DepthPeeling::PreColor\n\n  //VTK::TCoord::Impl\n\n  if (gl_FragData[0].a <= 0.0)\n    {\n    discard;\n    }\n\n  //VTK::DepthPeeling::Impl\n\n  //VTK::Picking::Impl\n\n  // handle coincident offsets\n  //VTK::Coincident::Impl\n\n  //VTK::ZBuffer::Impl\n\n  //VTK::RenderPassFragmentShader::Impl\n}\n",e.Geometry=""},e.replaceShaderValues=(n,r,i)=>{if(e.replaceShaderTCoord(n,r,i),e.replaceShaderPositionVC(n,r,i),t.haveSeenDepthRequest){let e=n.Fragment;e=x.Z.substitute(e,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,e=x.Z.substitute(e,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=e}e.replaceShaderCoincidentOffset(n,r,i)},e.replaceShaderTCoord=(e,n,r)=>{let i=e.Vertex;const o=e.Geometry;let a=e.Fragment;const s=t.renderable.getSlabThickness();i=x.Z.substitute(i,"//VTK::TCoord::Dec",["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"]).result;i=x.Z.substitute(i,"//VTK::TCoord::Impl",["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"]).result;const l=t.openGLTexture.getComponents(),c=r.getProperty().getIndependentComponents();let u=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(c){for(let e=1;e<l;e++)u=u.concat([`uniform float cshift${e};`,`uniform float cscale${e};`,`uniform float pwfshift${e};`,`uniform float pwfscale${e};`]);switch(l){case 1:u=u.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:u=u.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:u=u.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:u=u.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:L("Unsupported number of independent coordinates.")}}s>0&&(u=u.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),u=u.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),a=x.Z.substitute(a,"//VTK::TCoord::Dec",u).result;let d=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(s>0&&(d=d.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),c){const e=["r","g","b","a"];for(let t=0;t<l;++t)d=d.concat([`vec3 tcolor${t} = mix${t} * texture2D(colorTexture1, vec2(tvalue.${e[t]} * cscale${t} + cshift${t}, height${t})).rgb;`,`float compWeight${t} = mix${t} * texture2D(pwfTexture1, vec2(tvalue.${e[t]} * pwfscale${t} + pwfshift${t}, height${t})).r;`]);switch(l){case 1:d=d.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:d=d.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:L("Unsupported number of independent coordinates.")}}else switch(l){case 1:d=d.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:d=d.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:d=d.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:d=d.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}a=x.Z.substitute(a,"//VTK::TCoord::Impl",d).result,e.Vertex=i,e.Fragment=a,e.Geometry=o},e.replaceShaderPositionVC=(n,r,i)=>{let o=n.Vertex;const a=n.Geometry;let s=n.Fragment;const l=t.renderable.getSlabThickness();let c=["attribute vec4 vertexWC;"];c=c.concat([`//${e.getMTime()}${t.resliceGeomUpdateString}`]),l>0&&(c=c.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),o=x.Z.substitute(o,"//VTK::PositionVC::Dec",c).result;let u=["gl_Position = MCPCMatrix * vertexWC;"];l>0&&(u=u.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),o=x.Z.substitute(o,"//VTK::PositionVC::Impl",u).result,o=x.Z.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let d=[];l>0&&(d=d.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),s=x.Z.substitute(s,"//VTK::PositionVC::Dec",d).result,n.Vertex=o,n.Geometry=a,n.Fragment=s},e.updateResliceGeometry=()=>{let e="";const n=t.currentInput,r=n?.getBounds();let o=!0,s=2;const l=t.renderable.getSlicePolyData(),c=t.renderable.getSlicePlane();if(l)e=e.concat(`PolyData${l.getMTime()}`);else if(c){e=e.concat(`Plane${c.getMTime()}`),n&&(e=e.concat(`Image${n.getMTime()}`));const t=i.wO.fromValues(n?.getDirection());i.wO.invert(t,t);const r=[...c.getNormal()];i.R3.transformMat3(r,r,t),[o,s]=function(e){C.f.normalize(e);const t=[0,0,0];for(let n=0;n<3;++n){i.R3.zero(t),t[n]=1;const r=C.f.dot(e,t);if(r<-.999||r>.999)return[!0,n]}return[!1,2]}(r)}else{const i=E.ZP.newInstance();i.setNormal(0,0,1);let o=[0,1,0,1,0,1];n&&(o=r),i.setOrigin(o[0],o[2],.5*(o[5]+o[4])),t.renderable.setSlicePlane(i),e=e.concat(`Plane${c?.getMTime()}`),n&&(e=e.concat(`Image${n.getMTime()}`))}if(!t.resliceGeom||t.resliceGeomUpdateString!==e){if(l)t.resliceGeom||(t.resliceGeom=a.ZP.newInstance()),t.resliceGeom.getPoints().setData(l.getPoints().getData(),3),t.resliceGeom.getPolys().setData(l.getPolys().getData(),1),t.resliceGeom.getPointData().setNormals(l.getPointData().getNormals());else if(c)if(o){const e=new Float32Array(12),r=n.worldToIndex(c.getOrigin(),[0,0,0]),i=[(s+1)%3,(s+2)%3].sort(),o=n.getDimensions(),l=[0,o[0]-1,0,o[1]-1,0,o[2]-1];let u=0;for(let t=0;t<2;++t)for(let n=0;n<2;++n)e[u+s]=r[s],e[u+i[0]]=l[2*i[0]+n],e[u+i[1]]=l[2*i[1]+t],u+=3;t.transform.setMatrix(n.getIndexToWorld()),t.transform.transformPoints(e,e);const d=new Uint16Array(8);d[0]=3,d[1]=0,d[2]=1,d[3]=3,d[4]=3,d[5]=0,d[6]=3,d[7]=2;const p=c.getNormal();C.f.normalize(p);const f=new Float32Array(12);for(let e=0;e<4;++e)f[3*e]=p[0],f[3*e+1]=p[1],f[3*e+2]=p[2];t.resliceGeom||(t.resliceGeom=a.ZP.newInstance()),t.resliceGeom.getPoints().setData(e,3),t.resliceGeom.getPolys().setData(d,1);const m=h.default.newInstance({numberOfComponents:3,values:f,name:"Normals"});t.resliceGeom.getPointData().setNormals(m)}else{t.outlineFilter.setInputData(n),t.cutter.setInputConnection(t.outlineFilter.getOutputPort()),t.cutter.setCutFunction(c),t.lineToSurfaceFilter.setInputConnection(t.cutter.getOutputPort()),t.lineToSurfaceFilter.update(),t.resliceGeom||(t.resliceGeom=a.ZP.newInstance());const e=t.lineToSurfaceFilter.getOutputData();t.resliceGeom.getPoints().setData(e.getPoints().getData(),3),t.resliceGeom.getPolys().setData(e.getPolys().getData(),1),t.resliceGeom.getPointData().setNormals(e.getPointData().getNormals());const r=c.getNormal(),i=t.resliceGeom.getNumberOfPoints();C.f.normalize(r);const o=new Float32Array(3*i);for(let e=0;e<i;++e)o[3*e]=r[0],o[3*e+1]=r[1],o[3*e+2]=r[2];const s=h.default.newInstance({numberOfComponents:3,values:o,name:"Normals"});t.resliceGeom.getPointData().setNormals(s)}else L("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");t.resliceGeomUpdateString=e,t.resliceGeom?.modified()}},e.setOpenGLTexture=e=>{e&&(t.openGLTexture=e,t._externalOpenGLTexture=!0)}}const U={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,openGLTextureString:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1,_scalars:null};function B(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,U,n),A.Z.extend(e,t,n),T.Z.implementReplaceShaderCoincidentOffset(e,t,n),T.Z.implementBuildShadersWithReplacements(e,t,n),t.tris=f.default.newInstance(),t.openGLTexture=null,t.colorTexture=null,t.pwfTexture=null,t.VBOBuildTime={},(0,r.o)(t.VBOBuildTime),t.tmpMat4=i._E.identity(new Float64Array(16)),t.outlineFilter=b.newInstance(),t.outlineFilter.setGenerateFaces(!0),t.outlineFilter.setGenerateLines(!1),t.cubePolyData=a.ZP.newInstance(),t.cutter=p.ZP.newInstance(),t.lineToSurfaceFilter=d.newInstance(),t.transform=D.newInstance(),(0,r.g)(e,t,["openGLTexture"]),V(e,t)}const G=(0,r.n)(B,"vtkOpenGLImageResliceMapper");(0,N.vw)("vtkImageResliceMapper",G);n(80129);const W={MAX:0,MIN:1,AVERAGE:2};var z=n(81270),H=n(25460);const{vtkErrorMacro:j}=r.m;function Z(e,t,n){if(t.apply(e)){const t=e.getIndependentComponents();return`${e.getMTime()}-${t}-${n}`}return"0"}const K={currentRenderPass:null,volumeTexture:null,volumeTextureTime:0,colorTexture:null,colorTextureString:null,pwfTexture:null,pwfTextureString:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function $(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,K,n),A.Z.extend(e,t,n),T.Z.implementReplaceShaderCoincidentOffset(e,t,n),r.m.algo(e,t,2,0),t.tris=f.default.newInstance(),t.volumeTexture=w.default.newInstance(),t.colorTexture=w.default.newInstance(),t.pwfTexture=w.default.newInstance(),t.imagemat=i._E.identity(new Float64Array(16)),t.imagematinv=i._E.identity(new Float64Array(16)),t.VBOBuildTime={},r.m.obj(t.VBOBuildTime,{mtime:0}),function(e,t){t.classHierarchy.push("vtkOpenGLImageCPRMapper"),e.buildPass=n=>{n&&(t.currentRenderPass=null,t.openGLImageSlice=e.getFirstAncestorOfType("vtkOpenGLImageSlice"),t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent(),t.context=t._openGLRenderWindow.getContext(),t.openGLCamera=t._openGLRenderer.getViewNodeFor(t._openGLRenderer.getRenderable().getActiveCamera()),t.tris.setOpenGLRenderWindow(t._openGLRenderWindow),t.volumeTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.colorTexture.setOpenGLRenderWindow(t._openGLRenderWindow),t.pwfTexture.setOpenGLRenderWindow(t._openGLRenderWindow))},e.opaquePass=(n,r)=>{n&&(t.currentRenderPass=r,e.render())},e.opaqueZBufferPass=n=>{n&&(t.haveSeenDepthRequest=!0,t.renderDepth=!0,e.render(),t.renderDepth=!1)},e.getCoincidentParameters=(e,n)=>t.renderable.getResolveCoincidentTopology()?t.renderable.getCoincidentTopologyPolygonOffsetParameters():null,e.render=()=>{const n=t.openGLImageSlice.getRenderable(),r=t._openGLRenderer.getRenderable();e.renderPiece(r,n)},e.renderPiece=(n,r)=>{e.invokeEvent({type:"StartEvent"}),t.renderable.update(),e.invokeEvent({type:"EndEvent"}),t.renderable.preRenderCheck()&&(t.currentImageDataInput=t.renderable.getInputData(0),t.currentCenterlineInput=t.renderable.getOrientedCenterline(),e.renderPieceStart(n,r),e.renderPieceDraw(n,r),e.renderPieceFinish(n,r))},e.renderPieceStart=(t,n)=>{e.updateBufferObjects(t,n)},e.renderPieceDraw=(n,r)=>{const i=t.context;t.volumeTexture.activate(),t.colorTexture.activate(),t.pwfTexture.activate(),t.tris.getCABO().getElementCount()&&(e.updateShaders(t.tris,n,r),i.drawArrays(i.TRIANGLES,0,t.tris.getCABO().getElementCount()),t.tris.getVAO().release()),t.volumeTexture.deactivate(),t.colorTexture.deactivate(),t.pwfTexture.deactivate()},e.renderPieceFinish=(e,t)=>{},e.updateBufferObjects=(t,n)=>{e.getNeedToRebuildBufferObjects(t,n)&&e.buildBufferObjects(t,n)},e.getNeedToRebuildBufferObjects=(n,r)=>{const i=t.VBOBuildTime.getMTime();return i<e.getMTime()||i<t.renderable.getMTime()||i<r.getMTime()||i<t.currentImageDataInput.getMTime()||i<t.currentCenterlineInput.getMTime()},e.buildBufferObjects=(e,n)=>{const r=t.currentImageDataInput,i=t.currentCenterlineInput;n.getProperty().getInterpolationType()===O.Z.NEAREST?(t.volumeTexture.setMinificationFilter(P.w.NEAREST),t.volumeTexture.setMagnificationFilter(P.w.NEAREST),t.colorTexture.setMinificationFilter(P.w.NEAREST),t.colorTexture.setMagnificationFilter(P.w.NEAREST),t.pwfTexture.setMinificationFilter(P.w.NEAREST),t.pwfTexture.setMagnificationFilter(P.w.NEAREST)):(t.volumeTexture.setMinificationFilter(P.w.LINEAR),t.volumeTexture.setMagnificationFilter(P.w.LINEAR),t.colorTexture.setMinificationFilter(P.w.LINEAR),t.colorTexture.setMagnificationFilter(P.w.LINEAR),t.pwfTexture.setMinificationFilter(P.w.LINEAR),t.pwfTexture.setMagnificationFilter(P.w.LINEAR));const o=r.getMTime();if(t.volumeTextureTime!==o){const e=r.getDimensions(),n=r.getPointData().getScalars();if(!n)return;t.volumeTexture.setOglNorm16Ext(t.context.getExtension("EXT_texture_norm16")),t.volumeTexture.releaseGraphicsResources(t._openGLRenderWindow),t.volumeTexture.resetFormatAndType(),t.volumeTexture.create3DFilterableFromRaw(e[0],e[1],e[2],n.getNumberOfComponents(),n.getDataType(),n.getData(),t.renderable.getPreferSizeOverAccuracy()),t.volumeTextureTime=o}const a=r.getPointData()&&r.getPointData().getScalars();if(!a)return;const s=a.getNumberOfComponents(),l=n.getProperty(),c=l.getIndependentComponents(),u=c?s:1,d=c?2*u:1,p=Z(l,l.getRGBTransferFunction,u);if(t.colorTextureString!==p){const e=1024,n=new Uint8ClampedArray(e*d*3);let r=l.getRGBTransferFunction();if(r){const i=new Float32Array(3*e);for(let t=0;t<u;t++){r=l.getRGBTransferFunction(t);const o=r.getRange();if(r.getTable(o[0],o[1],e,i,1),c)for(let r=0;r<3*e;r++)n[t*e*6+r]=255*i[r],n[t*e*6+r+3*e]=255*i[r];else for(let r=0;r<3*e;r++)n[t*e*6+r]=255*i[r]}t.colorTexture.releaseGraphicsResources(t._openGLRenderWindow),t.colorTexture.resetFormatAndType(),t.colorTexture.create2DFromRaw(e,d,3,M.Tu.UNSIGNED_CHAR,n)}else{for(let t=0;t<3*e;++t)n[t]=255*t/(3*(e-1)),n[t+1]=255*t/(3*(e-1)),n[t+2]=255*t/(3*(e-1));t.colorTexture.create2DFromRaw(e,1,3,M.Tu.UNSIGNED_CHAR,n)}t.colorTextureString=p}const f=Z(l,l.getPiecewiseFunction,u);if(t.pwfTextureString!==f){const e=1024,n=e*d,r=new Uint8ClampedArray(n);let i=l.getPiecewiseFunction();if(t.pwfTexture.releaseGraphicsResources(t._openGLRenderWindow),t.pwfTexture.resetFormatAndType(),i){const r=new Float32Array(n),o=new Float32Array(e);for(let t=0;t<u;++t)if(i=l.getPiecewiseFunction(t),null===i)r.fill(1);else{const n=i.getRange();if(i.getTable(n[0],n[1],e,o,1),c)for(let n=0;n<e;n++)r[t*e*2+n]=o[n],r[t*e*2+n+e]=o[n];else for(let n=0;n<e;n++)r[t*e*2+n]=o[n]}t.pwfTexture.create2DFromRaw(e,d,1,M.Tu.FLOAT,r)}else r.fill(255),t.pwfTexture.create2DFromRaw(e,1,1,M.Tu.UNSIGNED_CHAR,r);t.pwfTextureString=f}if(t.VBOBuildTime.getMTime()<t.renderable.getMTime()||t.VBOBuildTime.getMTime()<i.getMTime()){const e=i.getNumberOfPoints(),n=e<=1?0:e-1,r=i.getDistancesToFirstPoint(),o=t.renderable.getHeight(),a=4*n,s=new Float32Array(3*a),l=t.renderable.getWidth();for(let e=0,t=0;e<n;++e)s.set([0,o-r[e],0],t),t+=3,s.set([l,o-r[e],0],t),t+=3,s.set([l,o-r[e+1],0],t),t+=3,s.set([0,o-r[e+1],0],t),t+=3;const c=h.default.newInstance({numberOfComponents:3,values:s});c.setName("points");const u=new Uint16Array(5*n);for(let e=0,t=0,r=0;e<n;++e)u.set([4,r+3,r+2,r+1,r],t),t+=5,r+=4;const d=h.default.newInstance({numberOfComponents:1,values:u}),p=i.getPoints(),f=new Float32Array(3*a),m=new Array(3),g=new Array(3);for(let e=0,t=0;e<n;++e)p.getPoint(e,m),p.getPoint(e+1,g),f.set(m,t),t+=3,f.set(m,t),t+=3,f.set(g,t),t+=3,f.set(g,t),t+=3;const v=h.default.newInstance({numberOfComponents:3,values:f,name:"centerlinePosition"}),y=new Float32Array(a);for(let e=0,t=0;e<n;++e)y.set([0,1,3,2],t),t+=4;const b=[v,h.default.newInstance({numberOfComponents:1,values:y,name:"quadIndex"})];if(!t.renderable.getUseUniformOrientation()){const e=t.renderable.getOrientedCenterline().getOrientations()??[],r=new Float32Array(4*a),i=new Float32Array(4*a);for(let t=0;t<n;++t){const n=e[t],o=e[t+1];for(let e=0;e<4;++e){const a=4*(e+4*t);r.set(n,a),i.set(o,a)}}const o=h.default.newInstance({numberOfComponents:4,values:r,name:"centerlineTopOrientation"}),s=h.default.newInstance({numberOfComponents:4,values:i,name:"centerlineBotOrientation"});b.push(o,s)}t.tris.getCABO().createVBO(d,"polys",R.hX.SURFACE,{points:c,customAttributes:b}),t.VBOBuildTime.modified()}},e.getNeedToRebuildShaders=(e,n,r)=>{const i=t.volumeTexture.getComponents(),o=r.getProperty().getIndependentComponents(),a=!!t.renderable.getCenterPoint(),s=t.renderable.getUseUniformOrientation(),l=t.renderable.isProjectionEnabled()&&t.renderable.getProjectionMode();return(0===e.getProgram()||t.lastUseCenterPoint!==a||t.lastUseUniformOrientation!==s||t.lastProjectionMode!==l||t.lastHaveSeenDepthRequest!==t.haveSeenDepthRequest||t.lastTextureComponents!==i||t.lastIndependentComponents!==o)&&(t.lastUseCenterPoint=a,t.lastUseUniformOrientation=s,t.lastProjectionMode=l,t.lastHaveSeenDepthRequest=t.haveSeenDepthRequest,t.lastTextureComponents=i,t.lastIndependentComponents=o,!0)},e.buildShaders=(t,n,r)=>{e.getShaderTemplate(t,n,r),e.replaceShaderValues(t,n,r)},e.replaceShaderValues=(n,r,i)=>{let o=n.Vertex,a=n.Fragment;const s=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];o=x.Z.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=x.Z.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],c=t.renderable.isProjectionEnabled(),u=t.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...s),c&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),o=x.Z.substitute(o,"//VTK::Color::Dec",l).result;const d=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(d.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),c&&d.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):d.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),o=x.Z.substitute(o,"//VTK::Color::Impl",d).result;const p=t.volumeTexture.getComponents(),h=i.getProperty().getIndependentComponents();let f=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];c&&f.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(f.push("in vec3 samplingDirVSOutput;"),c&&f.push("in vec3 projectionDirVSOutput;")):(f.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...s),c&&f.push("uniform vec3 bitangentDirection;"));const m=t.renderable.getCenterPoint();if(m&&f.push("uniform vec3 globalCenterPoint;"),h){for(let e=1;e<p;e++)f=f.concat([`uniform float cshift${e};`,`uniform float cscale${e};`,`uniform float pwfshift${e};`,`uniform float pwfscale${e};`]);switch(p){case 1:f=f.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:f=f.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:j("Unsupported number of independent coordinates.")}}a=x.Z.substitute(a,"//VTK::TCoord::Dec",f).result;let g=[];if(u?(g.push("vec3 samplingDirection = samplingDirVSOutput;"),c&&g.push("vec3 projectionDirection = projectionDirVSOutput;")):(g.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),c&&g.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),m?g.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):g.push("float horizontalOffset = quadOffsetVSOutput.x;"),g.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),c){const e=t.renderable.getProjectionMode();switch(e===W.MIN?g.push("const vec4 initialProjectionTextureValue = vec4(1.0);"):g.push("const vec4 initialProjectionTextureValue = vec4(0.0);"),g.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),e){case W.MAX:g.push("  tvalue = max(tvalue, sampledTextureValue);");break;case W.MIN:g.push("  tvalue = min(tvalue, sampledTextureValue);");break;default:g.push("  tvalue = tvalue + sampledTextureValue;")}g.push("}"),e===W.AVERAGE&&g.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else g.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(h){const e=["r","g","b","a"];for(let t=0;t<p;++t)g=g.concat([`vec3 tcolor${t} = mix${t} * texture2D(colorTexture1, vec2(tvalue.${e[t]} * cscale${t} + cshift${t}, height${t})).rgb;`,`float compWeight${t} = mix${t} * texture2D(pwfTexture1, vec2(tvalue.${e[t]} * pwfscale${t} + pwfshift${t}, height${t})).r;`]);switch(p){case 1:g=g.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:g=g.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:g=g.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:g=g.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:j("Unsupported number of independent coordinates.")}}else switch(p){case 1:g=g.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:g=g.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:g=g.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:g=g.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}a=x.Z.substitute(a,"//VTK::TCoord::Impl",g).result,t.haveSeenDepthRequest&&(a=x.Z.substitute(a,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,a=x.Z.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=o,n.Fragment=a,e.replaceShaderClip(n,r,i),e.replaceShaderCoincidentOffset(n,r,i)},e.replaceShaderClip=(e,n,i)=>{let o=e.Vertex,a=e.Fragment;if(t.renderable.getNumberOfClippingPlanes()){let e=t.renderable.getNumberOfClippingPlanes();e>6&&(r.m.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),e=6),o=x.Z.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=x.Z.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,a=x.Z.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,a=x.Z.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}e.Vertex=o,e.Fragment=a},e.getShaderTemplate=(e,t,n)=>{e.Vertex=z.v,e.Fragment=H.v,e.Geometry=""},e.setMapperShaderParameters=(n,o,a)=>{const s=n.getProgram(),l=n.getCABO();l.getElementCount()&&(t.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(s,l,"vertexMC",l.getVertexOffset(),l.getStride(),t.context.FLOAT,3,t.context.FALSE)||j("Error setting vertexMC in shader VAO.")),n.getCABO().getCustomData().forEach(e=>{e&&s.isAttributeUsed(e.name)&&!n.getVAO().addAttributeArray(s,l,e.name,e.offset,l.getStride(),t.context.FLOAT,e.components,t.context.FALSE)&&j(`Error setting ${e.name} in shader VAO.`)}),n.getAttributeUpdateTime().modified());const c=t.volumeTexture.getTextureUnit();if(s.setUniformi("volumeTexture",c),s.setUniformf("width",t.renderable.getWidth()),n.getProgram().setUniform4fv("backgroundColor",t.renderable.getBackgroundColor()),s.isUniformUsed("tangentDirection")){const e=t.renderable.getTangentDirection();n.getProgram().setUniform3fArray("tangentDirection",e)}if(s.isUniformUsed("bitangentDirection")){const e=t.renderable.getBitangentDirection();n.getProgram().setUniform3fArray("bitangentDirection",e)}if(s.isUniformUsed("centerlineOrientation")){const e=t.renderable.getUniformOrientation();n.getProgram().setUniform4fv("centerlineOrientation",e)}if(s.isUniformUsed("globalCenterPoint")){const e=t.renderable.getCenterPoint();s.setUniform3fArray("globalCenterPoint",e)}if(t.renderable.isProjectionEnabled()){const e=t.currentImageDataInput,n=e.getSpacing(),r=e.getDimensions(),o=t.renderable.getProjectionSlabThickness(),a=t.renderable.getProjectionSlabNumberOfSamples(),l=i.R3.mul([],n,r);s.setUniform3fArray("volumeSizeMC",l),s.setUniformi("projectionSlabNumberOfSamples",a);const c=-.5*o;s.setUniformf("projectionConstantOffset",c);const u=o/(a-1);s.setUniformf("projectionStepLength",u)}const u=t.currentImageDataInput,d=u.getWorldToIndex(),p=i._E.fromScaling(new Float32Array(16),i.R3.inverse([],u.getDimensions())),h=i._E.mul(p,p,d);if(s.setUniformMatrix("MCTCMatrix",h),t.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",t.renderDepth?1:0),t.renderable.getNumberOfClippingPlanes()){let e=t.renderable.getNumberOfClippingPlanes();e>6&&(r.m.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),e=6);const n=l.getCoordShiftAndScaleEnabled()?l.getInverseShiftAndScaleMatrix():null,o=n?i._E.copy(t.imagematinv,a.getMatrix()):a.getMatrix();n&&(i._E.transpose(o,o),i._E.multiply(o,o,n),i._E.transpose(o,o)),i._E.transpose(t.imagemat,t.currentImageDataInput.getIndexToWorld()),i._E.multiply(t.imagematinv,o,t.imagemat);const c=[];for(let n=0;n<e;n++){const e=[];t.renderable.getClippingPlaneInDataCoords(t.imagematinv,n,e);for(let t=0;t<4;t++)c.push(e[t])}s.setUniformi("numClipPlanes",e),s.setUniform4fv("clipPlanes",c)}if(s.isUniformUsed("coffset")){const t=e.getCoincidentParameters(o,a);s.setUniformf("coffset",t.offset),s.isUniformUsed("cfactor")&&s.setUniformf("cfactor",t.factor)}},e.setCameraShaderParameters=(e,n,r)=>{const o=t.openGLImageSlice.getKeyMatrices().mcwc,a=t.openGLCamera.getKeyMatrices(n).wcpc;if(i._E.multiply(t.imagemat,a,o),e.getCABO().getCoordShiftAndScaleEnabled()){const n=e.getCABO().getInverseShiftAndScaleMatrix();i._E.multiply(t.imagemat,t.imagemat,n)}e.getProgram().setUniformMatrix("MCPCMatrix",t.imagemat)},e.setPropertyShaderParameters=(e,n,r)=>{const i=e.getProgram(),o=r.getProperty(),a=o.getOpacity();i.setUniformf("opacity",a);const s=t.volumeTexture.getComponents(),l=o.getIndependentComponents();if(l)for(let e=0;e<s;++e)i.setUniformf(`mix${e}`,o.getComponentWeight(e));const c=t.volumeTexture.getVolumeInfo();for(let e=0;e<s;e++){let t=o.getColorWindow(),n=o.getColorLevel();const r=l?e:0,a=o.getRGBTransferFunction(r);if(a&&o.getUseLookupTableScalarRange()){const e=a.getRange();t=e[1]-e[0],n=.5*(e[1]+e[0])}const s=c.scale[e]/t,u=(c.offset[e]-n)/t+.5;i.setUniformf(`cshift${e}`,u),i.setUniformf(`cscale${e}`,s)}const u=t.colorTexture.getTextureUnit();i.setUniformi("colorTexture1",u);for(let e=0;e<s;e++){let t=1,n=0;const r=l?e:0,a=o.getPiecewiseFunction(r);if(a){const r=a.getRange(),i=r[1]-r[0],o=.5*(r[0]+r[1]);t=c.scale[e]/i,n=(c.offset[e]-o)/i+.5}i.setUniformf(`pwfshift${e}`,n),i.setUniformf(`pwfscale${e}`,t)}const d=t.pwfTexture.getTextureUnit();i.setUniformi("pwfTexture1",d)},e.updateShaders=(n,r,i)=>{if(e.getNeedToRebuildShaders(n,r,i)){const o={Vertex:null,Fragment:null,Geometry:null};e.buildShaders(o,r,i);const a=t._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==n.getProgram()&&(n.setProgram(a),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else t._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),e.setMapperShaderParameters(n,r,i),e.setCameraShaderParameters(n,r,i),e.setPropertyShaderParameters(n,r,i)}}(e,t)}const q=r.m.newInstance($,"vtkOpenGLImageCPRMapper");(0,N.vw)("vtkImageCPRMapper",q);n(43634),n(10905),n(9170),n(1385),n(97521),n(66672);var X=n(72795),Y=n(19974),J=n(12041),Q=n(85232),ee=n(2144),te=n(32639);const{SlicingMode:ne}=X.default;const re=new Float64Array(16),ie=new Float64Array(16),oe=new Float64Array(16),ae=new Float64Array(4),se=new Float64Array(4);const le={rowLength:1024};function ce(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,le,n),J.ZP.extend(e,t,n),e.setFragmentShaderTemplate("\n//VTK::Renderer::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::Image::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output: fragmentOutput;\n\n  //VTK::Image::Sample\n\n  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);\n\n//VTK::RenderEncoder::Impl\n\n  return output;\n}\n"),t.UBO=Q.ZP.newInstance({label:"mapperUBO"}),t.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),t.UBO.addEntry("Origin","vec4<f32>"),t.UBO.addEntry("Axis2","vec4<f32>"),t.UBO.addEntry("Axis1","vec4<f32>"),t.UBO.addEntry("cScale","vec4<f32>"),t.UBO.addEntry("cShift","vec4<f32>"),t.lutBuildTime={},(0,r.o)(t.lutBuildTime,{mtime:0}),t.imagemat=i._E.identity(new Float64Array(16)),t.imagematinv=i._E.identity(new Float64Array(16)),t.VBOBuildTime={},(0,r.o)(t.VBOBuildTime),function(e,t){t.classHierarchy.push("vtkWebGPUImageMapper"),e.buildPass=n=>{if(n){t.WebGPUImageSlice=e.getFirstAncestorOfType("vtkWebGPUImageSlice"),t.WebGPURenderer=t.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getParent(),t.device=t.WebGPURenderWindow.getDevice();const n=t.WebGPURenderer.getRenderable();t.renderable.getSliceAtFocalPoint()&&t.renderable.setSliceFromCamera(n.getActiveCamera())}},e.translucentPass=t=>{t&&e.render()},e.opaquePass=t=>{t&&e.render()},e.render=()=>{t.renderable.update(),t.currentInput=t.renderable.getInputData(),e.prepareToDraw(t.WebGPURenderer.getRenderEncoder()),t.renderEncoder.registerDrawCallback(t.pipeline,e.draw)},e.computePipelineHash=()=>{const e=t.currentInput.getExtent();e[0]===e[1]||e[2]===e[3]||e[4]===e[5]?(t.dimensions=2,t.pipelineHash="img2"):(t.dimensions=3,t.pipelineHash="img3")},e.updateUBO=()=>{const n=t.UBO.getSendTime(),r=t.WebGPUImageSlice.getRenderable(),o=r.getMapper();if(e.getMTime()>n||t.renderable.getMTime()>n||r.getProperty().getMTime()>n){const e=o.getInputData(),n=t.WebGPURenderer.getStabilizedCenterByReference();i._E.identity(re),i._E.translate(re,re,n);const a=r.getMatrix();i._E.transpose(ie,a),i._E.invert(ie,ie),i._E.multiply(re,ie,re);const s=e.getWorldToIndex();i._E.multiply(re,s,re),i._E.invert(oe,re),i._E.fromTranslation(ie,[.5,.5,.5]),i._E.multiply(re,ie,re);const l=e.getDimensions();i._E.identity(ie),i._E.scale(ie,ie,[1/l[0],1/l[1],1/l[2]]),i._E.multiply(re,ie,re),t.UBO.setArray("SCTCMatrix",re);const c=t.currentInput.getExtent(),{ijkMode:u}=t.renderable.getClosestIJKAxis();let d=t.renderable.getSlice();u!==t.renderable.getSlicingMode()&&(d=t.renderable.getSliceAtPosition(d));let p=2,h=0,f=1;u===ne.I?(p=0,h=1,f=2):u===ne.J&&(p=1,h=2,f=0),ae[p]=d,ae[h]=c[2*h]-.5,ae[f]=c[2*f]-.5,ae[3]=1,i.vh.transformMat4(ae,ae,oe),t.UBO.setArray("Origin",ae),se[p]=d,se[h]=c[2*h+1]+.5,se[f]=c[2*f]-.5,se[3]=1,i.vh.transformMat4(se,se,oe),i.vh.subtract(se,se,ae),se[3]=1,t.UBO.setArray("Axis1",se),se[p]=d,se[h]=c[2*h]-.5,se[f]=c[2*f+1]+.5,se[3]=1,i.vh.transformMat4(se,se,oe),i.vh.subtract(se,se,ae),se[3]=1,t.UBO.setArray("Axis2",se);const m=[1,1,1,1],g=[0,0,0,0],v=t.textureViews[0],y=v.getTexture().getScale(),b=v.getTexture().getNumberOfComponents();for(let e=0;e<b;e++){let t=r.getProperty().getColorWindow(),n=r.getProperty().getColorLevel();const i=0,o=r.getProperty().getRGBTransferFunction(i);if(o){const e=o.getRange();t=e[1]-e[0],n=.5*(e[1]+e[0])}m[e]=y/t,g[e]=-n/t+.5}t.UBO.setArray("cScale",m),t.UBO.setArray("cShift",g),t.UBO.sendIfNeeded(t.device)}},e.updateLUTImage=()=>{const n=t.WebGPUImageSlice.getRenderable().getProperty();e.getTextureViews()[0].getTexture().getNumberOfComponents();const r=function(e,t,n){if(t.apply(e)){const t=e.getIndependentComponents();return`${e.getMTime()}-${t}-${n}`}return"0"}(n,n.getRGBTransferFunction,1);if(t.colorTextureString!==r){t.numRows=1;const e=new Uint8ClampedArray(2*t.numRows*t.rowLength*4);let i=n.getRGBTransferFunction();if(i){const r=new Float32Array(3*t.rowLength);for(let o=0;o<1;o++){i=n.getRGBTransferFunction(o);const a=i.getRange();i.getTable(a[0],a[1],t.rowLength,r,1);for(let n=0;n<t.rowLength;n++){const i=o*t.rowLength*8+4*n;e[i]=255*r[3*n],e[i+1]=255*r[3*n+1],e[i+2]=255*r[3*n+2],e[i+3]=255;for(let n=0;n<4;n++)e[i+4*t.rowLength+n]=e[i+n]}}}else for(let n=0;n<t.rowLength;++n){const r=255*n/(t.rowLength-1);e[4*n]=r,e[4*n+1]=r,e[4*n+2]=r,e[4*n+3]=255;for(let r=0;r<4;r++)e[4*n+4*t.rowLength+r]=e[4*n+r]}{const n={nativeArray:e,width:t.rowLength,height:2*t.numRows,depth:1,format:"rgba8unorm"},r=t.device.getTextureManager().getTexture(n).createView("tfunTexture");t.textureViews[1]=r}t.colorTextureString=r}};const n=e.updateBuffers;e.updateBuffers=()=>{n();const r=t.device.getTextureManager().getTextureForImageData(t.currentInput),i=t.textureViews;if(!i[0]||i[0].getTexture()!==r){const e=r.createView("imgTexture");i[0]=e}e.updateLUTImage(),e.updateUBO();const o=t.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===O.Z.NEAREST?"nearest":"linear";t.clampSampler&&o===t.clampSampler.getOptions().minFilter||(t.clampSampler=ee.ZP.newInstance({label:"clampSampler"}),t.clampSampler.create(t.device,{minFilter:o,magFilter:o}),t.additionalBindables=[t.clampSampler])};const r=e.getShaderReplacements();e.replaceShaderPosition=(e,n,r)=>{const i=n.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let o=i.getCode();const a=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];2===t.dimensions?a.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):a.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),a.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),o=Y.ZP.substitute(o,"//VTK::Position::Impl",a).result,i.setCode(o)},r.set("replaceShaderPosition",e.replaceShaderPosition),e.replaceShaderTCoord=(e,n,r)=>{const i=n.getShaderDescription("vertex");2===t.dimensions?i.addOutput("vec2<f32>","tcoordVS"):i.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",e.replaceShaderTCoord),e.replaceShaderImage=(e,n,r)=>{const i=n.getShaderDescription("fragment");let o=i.getCode();t.dimensions,o=Y.ZP.substitute(o,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,o=Y.ZP.substitute(o,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,i.setCode(o)},r.set("replaceShaderImage",e.replaceShaderImage)}(e,t)}const ue=(0,r.n)(ce,"vtkWebGPUImageMapper");(0,te.vw)("vtkImageMapper",ue);const de={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function pe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,de,n),A.Z.extend(e,t,n),t.keyMatricesTime={},(0,r.o)(t.keyMatricesTime,{mtime:0}),t.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},t.keyMatrixTime={},(0,r.o)(t.keyMatrixTime,{mtime:0}),t.keyMatrices={mcwc:i._E.identity(new Float64Array(16))},t.bufferShift=[0,0,0,0],(0,r.g)(e,t,["propID","keyMatricesTime"]),function(e,t){t.classHierarchy.push("vtkWebGPUImageSlice"),e.buildPass=n=>{if(t.renderable&&t.renderable.getVisibility()&&n){if(!t.renderable)return;t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),void 0===t.propID&&(t.propID=t.WebGPURenderWindow.getUniquePropID()),e.prepareNodes(),e.addMissingNode(t.renderable.getMapper()),e.removeUnusedNodes()}},e.traverseOpaquePass=n=>{t.renderable&&t.renderable.getNestedVisibility()&&t.renderable.getIsOpaque()&&(!t.WebGPURenderer.getSelector()||t.renderable.getNestedPickable())&&(e.apply(n,!0),t.children.forEach(e=>{e.traverse(n)}),e.apply(n,!1))},e.traverseTranslucentPass=n=>{!t.renderable||!t.renderable.getNestedVisibility()||t.renderable.getIsOpaque()||t.WebGPURenderer.getSelector()&&!t.renderable.getNestedPickable()||(e.apply(n,!0),t.children.forEach(e=>{e.traverse(n)}),e.apply(n,!1))},e.queryPass=(e,n)=>{if(e){if(!t.renderable||!t.renderable.getVisibility())return;t.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},e.getBufferShift=n=>(e.getKeyMatrices(n),t.bufferShift),e.getKeyMatrices=e=>{if(Math.max(t.renderable.getMTime(),e.getStabilizedTime())>t.keyMatricesTime.getMTime()){t.renderable.computeMatrix();const n=t.renderable.getMatrix(),r=e.getStabilizedCenterByReference();t.bufferShift[0]=n[3]-r[0],t.bufferShift[1]=n[7]-r[1],t.bufferShift[2]=n[11]-r[2],i._E.transpose(t.keyMatrices.bcwc,n),t.renderable.getIsIdentity()?i._E.identity(t.keyMatrices.normalMatrix):(i._E.copy(t.keyMatrices.normalMatrix,t.keyMatrices.bcwc),t.keyMatrices.normalMatrix[3]=0,t.keyMatrices.normalMatrix[7]=0,t.keyMatrices.normalMatrix[11]=0,i._E.invert(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),i._E.transpose(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix)),i._E.translate(t.keyMatrices.bcwc,t.keyMatrices.bcwc,[-t.bufferShift[0],-t.bufferShift[1],-t.bufferShift[2]]),i._E.translate(t.keyMatrices.bcsc,t.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]),t.keyMatricesTime.modified()}return t.keyMatrices}}(e,t)}const he=(0,r.n)(pe,"vtkWebGPUImageSlice");(0,te.vw)("vtkImageSlice",he);const fe={propID:void 0,keyMatricesTime:null};function me(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,fe,n),A.Z.extend(e,t,n),t.keyMatricesTime={},r.m.obj(t.keyMatricesTime,{mtime:0}),t.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},r.m.get(e,t,["propID","keyMatricesTime"]),function(e,t){t.classHierarchy.push("vtkWebGPUVolume"),e.buildPass=n=>{t.renderable&&t.renderable.getVisibility()&&n&&(t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),void 0===t.propID&&(t.propID=t.WebGPURenderWindow.getUniquePropID()),t.renderable.getMapper().update())},e.queryPass=(n,r)=>{if(n){if(!t.renderable||!t.renderable.getVisibility())return;const n=t.renderable.getMapper().getBounds();if(!n||6!==n.length||n[0]>n[1])return;r.addVolume(e)}};const n=new Float64Array(3),r=new Float64Array(3);e.getBoundingCubePoints=(e,i)=>{const o=t.renderable.getMapper().getInputData();if(!o)return;const a=o.getExtent(),s=t.renderable.getMatrix();let l=0;for(let t=4;t<6;t++){n[2]=a[t];for(let t=2;t<4;t++){n[1]=a[t];for(let t=0;t<2;t++){n[0]=a[t],o.indexToWorld(n,r);let c=i+3*l;e[c++]=s[0]*r[0]+s[1]*r[1]+s[2]*r[2]+s[3],e[c++]=s[4]*r[0]+s[5]*r[1]+s[6]*r[2]+s[7],e[c++]=s[8]*r[0]+s[9]*r[1]+s[10]*r[2]+s[11],l++}}}},e.getKeyMatrices=e=>{if(Math.max(t.renderable.getMTime(),e.getStabilizedTime())>t.keyMatricesTime.getMTime()){t.renderable.computeMatrix();const n=t.renderable.getMatrix(),r=e.getStabilizedCenterByReference();i._E.transpose(t.keyMatrices.bcwc,n),i._E.translate(t.keyMatrices.bcsc,t.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]),t.keyMatricesTime.modified()}return t.keyMatrices}}(e,t)}const ge=r.m.newInstance(me,"vtkWebGPUVolume");(0,te.vw)("vtkVolume",ge);n(28378)},6814:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(68470);const{vtkErrorMacro:i}=r.m;const o={renderable:null,myFactory:null,children:[],visited:!1};function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,o,n),r.m.obj(e,t),r.m.event(e,t,"event"),t._renderableChildMap=new Map,r.m.get(e,t,["visited"]),r.m.setGet(e,t,["_parent","renderable","myFactory"]),r.m.getArray(e,t,["children"]),r.m.moveToProtected(e,t,["parent"]),function(e,t){t.classHierarchy.push("vtkViewNode"),e.build=e=>{},e.render=e=>{},e.traverse=n=>{const r=n.getTraverseOperation(),i=e[r];if(i)i(n);else{e.apply(n,!0);for(let e=0;e<t.children.length;e++)t.children[e].traverse(n);e.apply(n,!1)}},e.apply=(t,n)=>{const r=e[t.getOperation()];r&&r(n,t)},e.getViewNodeFor=n=>{if(t.renderable===n)return e;for(let e=0;e<t.children.length;++e){const r=t.children[e].getViewNodeFor(n);if(r)return r}},e.getFirstAncestorOfType=e=>t._parent?t._parent.isA(e)?t._parent:t._parent.getFirstAncestorOfType(e):null,e.getLastAncestorOfType=e=>{if(!t._parent)return null;return t._parent.getLastAncestorOfType(e)||(t._parent.isA(e)?t._parent:null)},e.addMissingNode=n=>{if(!n)return;const r=t._renderableChildMap.get(n);if(void 0!==r)return r.setVisited(!0),r;const i=e.createViewNode(n);return i?(i.setParent(e),i.setVisited(!0),t._renderableChildMap.set(n,i),t.children.push(i),i):void 0},e.addMissingNodes=t=>{if(t&&t.length)for(let n=0;n<t.length;++n){const r=t[n];e.addMissingNode(r)}},e.addMissingChildren=n=>{if(n&&n.length)for(let r=0;r<n.length;++r){const i=n[r];if(-1===t.children.indexOf(i)){i.setParent(e),t.children.push(i);const n=i.getRenderable();n&&t._renderableChildMap.set(n,i)}i.setVisited(!0)}},e.prepareNodes=()=>{for(let e=0;e<t.children.length;++e)t.children[e].setVisited(!1)},e.setVisited=e=>{t.visited=e},e.removeUnusedNodes=()=>{let e=0;for(let n=0;n<t.children.length;++n){const r=t.children[n];if(r.getVisited())t.children[e++]=r,r.setVisited(!1);else{const e=r.getRenderable();e&&t._renderableChildMap.delete(e),r.delete()}}t.children.length=e},e.createViewNode=e=>{if(!t.myFactory)return i("Cannot create view nodes without my own factory"),null;const n=t.myFactory.createNode(e);return n&&n.setRenderable(e),n};const n=e.delete;e.delete=()=>{for(let e=0;e<t.children.length;e++)t.children[e].delete();n()}}(e,t)}var s={newInstance:r.m.newInstance(a,"vtkViewNode"),extend:a,PASS_TYPES:["Build","Render"]}},79410:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>a});var r=n(68470);const i={};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,i,n),r.m.obj(e,t),function(e,t){t.overrides||(t.overrides={}),t.classHierarchy.push("vtkViewNodeFactory"),e.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),o=!1;const a=Object.keys(t.overrides);for(;i&&!o;)-1!==a.indexOf(i)?o=!0:i=n.getClassName(r++);if(!o)return null;const s=t.overrides[i]();return s.setMyFactory(e),s}}(e,t)}var a={newInstance:r.m.newInstance(o,"vtkViewNodeFactory"),extend:o}},92764:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>a});var r=n(68470);const i={device:null,handle:null,label:null};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,i,n),r.m.obj(e,t),t.bindables=[],t.bindGroupTime={},r.m.obj(t.bindGroupTime,{mtime:0}),r.m.get(e,t,["bindGroupTime","handle","sizeInBytes","usage"]),r.m.setGet(e,t,["label","device","arrayInformation"]),function(e,t){t.classHierarchy.push("vtkWebGPUBindGroup"),e.setBindables=n=>{if(t.bindables.length===n.length){let e=!0;for(let r=0;r<t.bindables.length;r++)t.bindables[r]!==n[r]&&(e=!1);if(e)return}t.bindables=n,e.modified()},e.getBindGroupLayout=e=>{const n=[];for(let e=0;e<t.bindables.length;e++){const r=t.bindables[e].getBindGroupLayoutEntry();r.binding=e,n.push(r)}return e.getBindGroupLayout({entries:n})},e.getBindGroup=n=>{let r=e.getMTime();for(let e=0;e<t.bindables.length;e++){const n=t.bindables[e].getBindGroupTime().getMTime();r=n>r?n:r}if(r<t.bindGroupTime.getMTime())return t.bindGroup;const i=[];for(let e=0;e<t.bindables.length;e++){const n=t.bindables[e].getBindGroupEntry();n.binding=e,i.push(n)}return t.bindGroup=n.getHandle().createBindGroup({layout:e.getBindGroupLayout(n),entries:i,label:t.label}),t.bindGroupTime.modified(),t.bindGroup},e.getShaderCode=e=>{const n=[],r=e.getBindGroupLayoutCount(t.label);for(let e=0;e<t.bindables.length;e++)n.push(t.bindables[e].getShaderCode(e,r));return n.join("\n")}}(e,t)}var a={newInstance:r.m.newInstance(o),extend:o}},7220:(e,t,n)=>{"use strict";n.d(t,{default:()=>F});var r=n(68470),i=n(59474),o=n(54131);var a={BufferUsage:{Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},PrimitiveTypes:{Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6}};const s=["getMappedRange","mapAsync","unmap"];function l(e,t){t.classHierarchy.push("vtkWebGPUBuffer"),e.create=(e,n)=>{t.handle=t.device.getHandle().createBuffer({size:e,usage:n,label:t.label}),t.sizeInBytes=e,t.usage=n},e.write=e=>{!function(e,t,n,r){const i=r.byteLength,o=e.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),a=o.getMappedRange(0,i);new Uint8Array(a).set(new Uint8Array(r)),o.unmap();const s=e.createCommandEncoder();s.copyBufferToBuffer(o,0,t,n,i);const l=s.finish();e.queue.submit([l]),o.destroy()}(t.device.getHandle(),t.handle,0,e.buffer)},e.createAndWrite=(e,n)=>{t.handle=t.device.getHandle().createBuffer({size:e.byteLength,usage:n,mappedAtCreation:!0,label:t.label}),t.sizeInBytes=e.byteLength,t.usage=n,new Uint8Array(t.handle.getMappedRange()).set(new Uint8Array(e.buffer)),t.handle.unmap()};for(let n=0;n<s.length;n++)e[s[n]]=function(){return t.handle[s[n]](...arguments)}}const c={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),r.m.obj(e,t),r.m.get(e,t,["handle","sizeInBytes","usage"]),r.m.setGet(e,t,["strideInBytes","device","arrayInformation","label","sourceTime"]),l(e,t)}var d={newInstance:r.m.newInstance(u),extend:u,...a},p=n(98589);const{Representation:h}=p.default,{PrimitiveTypes:f}=a;class m{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let t=0;t<this.count;t++)if(this.keys[t]===e)return!0}get(e){for(let t=0;t<this.count;t++)if(this.keys[t]===e)return this.values[t]}set(e,t){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=t)}}function g(e,t,n){let r=e.pointIdToFlatId[t];return r<0&&(r=e.flatId,e.pointIdToFlatId[t]=r,e.flatIdToPointId[e.flatId]=t,e.flatIdToCellId[e.flatId]=n,e.flatId++),r}function v(e,t,n){const r=e.length;for(let i=0;i<r;i++){let o=e[i];if(n.cellProvokedMap.has(o)){n.ibo[n.iboId++]=n.cellProvokedMap.get(o);for(let a=i+1;a<i+r;a++){o=e[a%r];const i=g(n,o,t);n.ibo[n.iboId++]=i}return}}for(let i=0;i<r;i++){let o=e[i];if(!n.provokedPointIds[o]){let a=g(n,o,t);n.provokedPointIds[o]=1,n.cellProvokedMap.set(o,a),n.flatIdToCellId[a]=t,n.ibo[n.iboId++]=a;for(let s=i+1;s<i+r;s++)o=e[s%r],a=g(n,o,t),n.ibo[n.iboId++]=a;return}}let i=e[0],o=n.flatId;n.cellProvokedMap.set(i,o),n.flatIdToPointId[n.flatId]=i,n.flatIdToCellId[n.flatId]=t,n.flatId++,n.ibo[n.iboId++]=o;for(let a=1;a<r;a++)i=e[a],o=g(n,i,t),n.ibo[n.iboId++]=o}function y(e,t,n){const r=e.length;n.iboSize+=r;for(let t=0;t<r;t++){const r=e[t];if(n.cellProvokedMap.has(r))return}for(let t=0;t<r;t++){const r=e[t];if(!n.provokedPointIds[r])return n.provokedPointIds[r]=1,void n.cellProvokedMap.set(r,1)}n.cellProvokedMap.set(e[0],1),n.extraPoints++}let b;const C=new Uint32Array(1),w=new Uint32Array(2),E=new Uint32Array(3),T={anythingToPoints(e,t,n,r,i){for(let o=0;o<e;++o)C[0]=t[n+o],b(C,r,i)},linesToWireframe(e,t,n,r,i){for(let o=0;o<e-1;++o)w[0]=t[n+o],w[1]=t[n+o+1],b(w,r,i)},polysToWireframe(e,t,n,r,i){if(e>2)for(let o=0;o<e;++o)w[0]=t[n+o],w[1]=t[n+(o+1)%e],b(w,r,i)},stripsToWireframe(e,t,n,r,i){if(e>2){for(let o=0;o<e-1;++o)w[0]=t[n+o],w[1]=t[n+o+1],b(w,r,i);for(let o=0;o<e-2;o++)w[0]=t[n+o],w[1]=t[n+o+2],b(w,r,i)}},polysToSurface(e,t,n,r,i){for(let o=0;o<e-2;o++)E[0]=t[n],E[1]=t[n+o+1],E[2]=t[n+o+2],b(E,r,i)},stripsToSurface(e,t,n,r,i){for(let o=0;o<e-2;o++)E[0]=t[n+o],E[1]=t[n+o+1+o%2],E[2]=t[n+o+1+(o+1)%2],b(E,r,i)}};function x(e,t){t.classHierarchy.push("vtkWebGPUIndexBuffer"),e.buildIndexBuffer=e=>{const n=e.cells,r=e.primitiveType,i=e.representation,o=e.cellOffset,a=n.getData(),s=a.length,l=function(e){switch(e){case f.Points:return"points";case f.Lines:return"lines";case f.Triangles:case f.TriangleEdges:return"polys";case f.TriangleStripEdges:case f.TriangleStrips:return"strips";default:return""}}(r),c=e.numberOfPoints,u={provokedPointIds:new Uint8Array(c),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new m};let d=null;d=i===h.POINTS||r===f.Points?T.anythingToPoints:i===h.WIREFRAME||r===f.Lines?T[`${l}ToWireframe`]:T[`${l}ToSurface`],b=y;let p=o||0;for(let e=0;e<s;)u.cellProvokedMap.clear(),d(a[e],a,e+1,p,u),e+=a[e]+1,p++;u.flatIdToPointId=c<=65535?new Uint16Array(c+u.extraPoints):new Uint32Array(c+u.extraPoints),c+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(c):u.pointIdToFlatId=new Int32Array(c),c+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),e.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),e.format="uint32"),u.flatIdToCellId=p<=65535?new Uint16Array(c+u.extraPoints):new Uint32Array(c+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),b=v,p=o||0;for(let e=0;e<s;)u.cellProvokedMap.clear(),d(a[e],a,e+1,p,u),e+=a[e]+1,p++;delete u.provokedPointIds,delete u.pointIdToFlatId,e.nativeArray=u.ibo,t.flatIdToPointId=u.flatIdToPointId,t.flatIdToCellId=u.flatIdToCellId,t.flatSize=u.flatId,t.indexCount=u.iboId}}const _={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,_,n),d.extend(e,t,n),r.m.setGet(e,t,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),x(e,t)}var I={newInstance:r.m.newInstance(S),extend:S,...a},D=n(35498);const{BufferUsage:A}=a,{vtkErrorMacro:P}=r.c,{VtkDataTypes:O}=o.default;function R(e,t,n,i,o){const a={},s=e.getFlatSize();if(!s)return a;let l=[0,0,0,0];o.shift&&(o.shift.length?l=o.shift:l.fill(o.shift));let c=[1,1,1,1];o.scale&&(o.scale.length?c=o.scale:c.fill(o.scale));const u=!!Object.prototype.hasOwnProperty.call(o,"packExtra")&&o.packExtra;let d,p=0;const h=n+(u?1:0),f=(0,r.a)(i,s*h);let m=e.getFlatIdToPointId();o.cellData&&(m=e.getFlatIdToCellId()),1===n?d=function(e){f[p++]=c[0]*t[e]+l[0]}:2===n?d=function(e){f[p++]=c[0]*t[e]+l[0],f[p++]=c[1]*t[e+1]+l[1]}:3!==n||u?3===n&&u?d=function(e){f[p++]=c[0]*t[e]+l[0],f[p++]=c[1]*t[e+1]+l[1],f[p++]=c[2]*t[e+2]+l[2],f[p++]=1*c[3]+l[3]}:4===n&&(d=function(e){f[p++]=c[0]*t[e]+l[0],f[p++]=c[1]*t[e+1]+l[1],f[p++]=c[2]*t[e+2]+l[2],f[p++]=c[3]*t[e+3]+l[3]}):d=function(e){f[p++]=c[0]*t[e]+l[0],f[p++]=c[1]*t[e+1]+l[1],f[p++]=c[2]*t[e+2]+l[2]};for(let e=0;e<s;e++){d(n*m[e])}return a.nativeArray=f,a}function M(e,t,n,r){const o=[e[3*r]-e[3*n],e[3*r+1]-e[3*n+1],e[3*r+2]-e[3*n+2]],a=[e[3*t]-e[3*n],e[3*t+1]-e[3*n+1],e[3*t+2]-e[3*n+2]],s=[];return(0,i.j)(o,a,s),(0,i.l)(s),s}function N(e,t){function n(e){let n,r;if(e.dataArray&&!e.nativeArray&&(e.nativeArray=e.dataArray.getData()),e.usage===A.Index&&(n=I.newInstance({label:e.label}),n.setDevice(t.device),r=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,n.buildIndexBuffer(e),n.createAndWrite(e.nativeArray,r),n.setArrayInformation([{format:e.format}])),n||(n=d.newInstance({label:e.label}),n.setDevice(t.device)),e.usage===A.UniformArray&&(r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,n.createAndWrite(e.nativeArray,r)),e.usage===A.Storage&&(r=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,n.createAndWrite(e.nativeArray,r)),e.usage===A.Texture&&(r=GPUBufferUsage.COPY_SRC,n.createAndWrite(e.nativeArray,r)),e.usage===A.PointArray){r=GPUBufferUsage.VERTEX;const t=D.Z.getNativeTypeFromBufferFormat(e.format),i=R(e.indexBuffer,e.dataArray.getData(),e.dataArray.getNumberOfComponents(),t,{packExtra:e.packExtra,shift:e.shift,scale:e.scale,cellData:e.cellData,cellOffset:e.cellOffset});n.createAndWrite(i.nativeArray,r),n.setStrideInBytes(D.Z.getByteStrideFromBufferFormat(e.format)),n.setArrayInformation([{offset:0,format:e.format,interpolation:e.cellData?"flat":"perspective"}])}if(e.usage===A.NormalsFromPoints){r=GPUBufferUsage.VERTEX;const t=D.Z.getNativeTypeFromBufferFormat(e.format),i=function(e,t){const n=t.getData(),r=e.getData();if(!r||!n)return null;const i=new Int8Array(4*e.getNumberOfCells()),o=r.length;let a=0;for(let e=0;e<o;){const t=M(n,r[e+1],r[e+2],r[e+3]);i[a++]=127*t[0],i[a++]=127*t[1],i[a++]=127*t[2],i[a++]=127,e+=r[e]+1}return i}(e.cells,e.dataArray),o=R(e.indexBuffer,i,4,t,{cellData:!0});n.createAndWrite(o.nativeArray,r),n.setStrideInBytes(D.Z.getByteStrideFromBufferFormat(e.format)),n.setArrayInformation([{offset:0,format:e.format,interpolation:"flat"}])}return e.usage===A.RawVertex&&(r=GPUBufferUsage.VERTEX,n.createAndWrite(e.nativeArray,r),n.setStrideInBytes(D.Z.getByteStrideFromBufferFormat(e.format)),n.setArrayInformation([{offset:0,format:e.format}])),n.setSourceTime(e.time),n}t.classHierarchy.push("vtkWebGPUBufferManager"),e.hasBuffer=e=>t.device.hasCachedObject(e),e.getBuffer=e=>e.hash?t.device.getCachedObject(e.hash,n,e):n(e),e.getBufferForPointArray=(t,n)=>{const r=function(e){let t;switch(e.getDataType()){case O.UNSIGNED_CHAR:t="uint8";break;case O.FLOAT:t="float32";break;case O.UNSIGNED_INT:t="uint32";break;case O.INT:t="sint32";break;case O.DOUBLE:t="float32";break;case O.UNSIGNED_SHORT:t="uint16";break;case O.SHORT:t="sin16";break;default:t="float32"}switch(e.getNumberOfComponents()){case 2:t+="x2";break;case 3:t.includes("32")||P(`unsupported x3 type for ${t}`),t+="x3";break;case 4:t+="x4"}return t}(t),i={hash:`${t.getMTime()}I${n.getMTime()}${r}`,usage:A.PointArray,format:r,dataArray:t,indexBuffer:n};return e.getBuffer(i)},e.getFullScreenQuadBuffer=()=>{if(t.fullScreenQuadBuffer)return t.fullScreenQuadBuffer;t.fullScreenQuadBuffer=d.newInstance(),t.fullScreenQuadBuffer.setDevice(t.device);const e=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return t.fullScreenQuadBuffer.createAndWrite(e,GPUBufferUsage.VERTEX),t.fullScreenQuadBuffer.setStrideInBytes(12),t.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),t.fullScreenQuadBuffer}}const L={device:null,fullScreenQuadBuffer:null};function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,L,n),(0,r.o)(e,t),(0,r.e)(e,t,["device"]),N(e,t)}var F={newInstance:(0,r.n)(k),extend:k,...a}},97521:(e,t,n)=>{"use strict";var r=n(72076),i=n(68470),o=n(6814),a=n(32639);const s={keyMatrixTime:null,keyMatrices:null};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),o.Z.extend(e,t,n),t.keyMatrixTime={},i.m.obj(t.keyMatrixTime),t.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},i.m.setGet(e,t,["keyMatrixTime"]),function(e,t){t.classHierarchy.push("vtkWebGPUCamera"),e.getProjectionMatrix=(e,n,i,o)=>{if(r._E.identity(e),t.renderable.getParallelProjection()){const r=t.renderable.getParallelScale(),a=r*n,s=r,l=(o[0]-1)*a,c=(o[0]+1)*a,u=(o[1]-1)*s,d=(o[1]+1)*s,p=1/(c-l),h=1/(d-u);e[0]=2*p,e[5]=2*h,e[10]=1/(i[1]-i[0]),e[12]=(c+l)*p,e[13]=(d+u)*h,e[14]=i[1]/(i[1]-i[0])}else{const r=Math.tan(Math.PI*t.renderable.getViewAngle()/360);let a,s;!0===t.renderable.getUseHorizontalViewAngle()?(a=i[0]*r,s=i[0]*r/n):(a=i[0]*r*n,s=i[0]*r);const l=(o[0]-1)*a,c=(o[0]+1)*a,u=(o[1]-1)*s,d=(o[1]+1)*s;e[0]=2*i[0]/(c-l),e[5]=2*i[0]/(d-u),e[12]=(l+c)/(c-l),e[13]=(u+d)/(d-u),e[10]=0,e[14]=i[0],e[11]=-1,e[15]=0}},e.convertToOpenGLDepth=e=>{if(t.renderable.getParallelProjection())return 1-e;const n=t.renderable.getClippingRangeByReference();let r=-n[0]/e;return r=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(r*(n[1]-n[0])),.5*r+.5},e.getKeyMatrices=n=>{const i=n.getRenderable(),o=n.getParent();if(Math.max(o.getMTime(),e.getMTime(),i.getMTime(),t.renderable.getMTime(),n.getStabilizedTime())>t.keyMatrixTime.getMTime()){const i=t.renderable.getViewMatrix();r._E.copy(t.keyMatrices.normalMatrix,i),t.keyMatrices.normalMatrix[3]=0,t.keyMatrices.normalMatrix[7]=0,t.keyMatrices.normalMatrix[11]=0,r._E.invert(t.keyMatrices.normalMatrix,t.keyMatrices.normalMatrix),r._E.transpose(t.keyMatrices.wcvc,i);const o=n.getStabilizedCenterByReference();r._E.translate(t.keyMatrices.scvc,t.keyMatrices.wcvc,o);const a=n.getAspectRatio(),s=t.renderable.getClippingRangeByReference();e.getProjectionMatrix(t.keyMatrices.vcpc,a,s,t.renderable.getWindowCenterByReference()),r._E.multiply(t.keyMatrices.scpc,t.keyMatrices.vcpc,t.keyMatrices.scvc),r._E.invert(t.keyMatrices.pcsc,t.keyMatrices.scpc),t.keyMatrixTime.modified()}return t.keyMatrices}}(e,t)}const c=i.m.newInstance(l);(0,a.vw)("vtkCamera",c)},12041:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>l});var r=n(68470),i=n(19974),o=n(84770);const a={};function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),o.ZP.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkWebGPUFullScreenQuad"),e.replaceShaderPosition=(e,t,n)=>{const r=t.getShaderDescription("vertex");r.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),r.addOutput("vec4<f32>","vertexVC");let o=r.getCode();o=i.ZP.substitute(o,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,r.setCode(o)},t.shaderReplacements.set("replaceShaderPosition",e.replaceShaderPosition),e.updateBuffers=()=>{const e=t.device.getBufferManager().getFullScreenQuadBuffer();t.vertexInput.addBuffer(e,["vertexBC"]),t.numberOfVertices=6}}(e,t)}var l={newInstance:r.m.newInstance(s,"vtkWebGPUFullScreenQuad"),extend:s}},28378:(e,t,n)=>{"use strict";var r=n(68470),i=n(6814),o=n(32639);const a={};function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),i.Z.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),e.opaquePass=(n,r)=>{t.WebGPURenderer=e.getFirstAncestorOfType("vtkWebGPURenderer"),t.WebGPURenderWindow=t.WebGPURenderer.getParent();const i=t.WebGPURenderer.getAspectRatio(),o=t.WebGPURenderer?t.WebGPURenderer.getRenderable().getActiveCamera():null,a=t.WebGPURenderer.getTiledSizeAndOrigin();t.renderable.getUseZValues(),t.renderable.invokeCallback(t.renderable.getInputData(),o,i,a,null)}}(e,t)}const l=r.m.newInstance(s,"vtkWebGPUPixelSpaceCallbackMapper");(0,o.vw)("vtkPixelSpaceCallbackMapper",l)},66672:(e,t,n)=>{"use strict";var r=n(72076),i=n(68470),o=n(59474),a=n(6814),s=n(92764),l=n(12041),c=n(7220),u=n(35498);const{BufferUsage:d}=c.default,{vtkErrorMacro:p}=i.m;const h={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,h,n),i.m.obj(e,t),t._bufferEntryNames=new Map,t.bufferEntries=[],t._sendTime={},i.m.obj(t._sendTime,{mtime:0}),t.bindGroupTime={},i.m.obj(t.bindGroupTime,{mtime:0}),t.bindGroupLayoutEntry=t.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},i.m.get(e,t,["bindGroupTime"]),i.m.setGet(e,t,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),function(e,t){t.classHierarchy.push("vtkWebGPUStorageBuffer"),e.addEntry=(e,n)=>{if(t._bufferEntryNames.has(e))return void p(`entry named ${e} already exists`);t._bufferEntryNames.set(e,t.bufferEntries.length);const r=u.Z.getByteStrideFromShaderFormat(n);t.bufferEntries.push({name:e,type:n,sizeInBytes:r,offset:t.sizeInBytes,nativeType:u.Z.getNativeTypeFromShaderFormat(n)}),t.sizeInBytes+=r},e.send=e=>{if(!t._buffer){const n={nativeArray:t.Float32Array,usage:d.Storage,label:t.label};return t._buffer=e.getBufferManager().getBuffer(n),t.bindGroupTime.modified(),void t._sendTime.modified()}e.getHandle().queue.writeBuffer(t._buffer.getHandle(),0,t.arrayBuffer,0,t.sizeInBytes*t.numberOfInstances),t._sendTime.modified()},e.createView=e=>{e in t==0&&(t.arrayBuffer||(t.arrayBuffer=new ArrayBuffer(t.sizeInBytes*t.numberOfInstances)),t[e]=i.m.newTypedArray(e,t.arrayBuffer))},e.setValue=(n,r,i)=>{const o=t._bufferEntryNames.get(n);if(void 0===o)return void p(`entry named ${n} not found in UBO`);const a=t.bufferEntries[o];e.createView(a.nativeType);const s=t[a.nativeType];s[(a.offset+r*t.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},e.setArray=(n,r,i)=>{const o=t._bufferEntryNames.get(n);if(void 0===o)return void p(`entry named ${n} not found in UBO`);const a=t.bufferEntries[o];e.createView(a.nativeType);const s=t[a.nativeType],l=(a.offset+r*t.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let e=0;e<i.length;e++)s[l+e]=i[e]},e.setAllInstancesFromArray=(n,r)=>{const i=t._bufferEntryNames.get(n);if(void 0===i)return void p(`entry named ${n} not found in UBO`);const o=t.bufferEntries[i];e.createView(o.nativeType);const a=t[o.nativeType],s=r.length/t.numberOfInstances;for(let e=0;e<t.numberOfInstances;e++){const n=(o.offset+e*t.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let t=0;t<s;t++)a[n+t]=r[e*s+t]}},e.setAllInstancesFromArrayColorToFloat=(n,r)=>{const i=t._bufferEntryNames.get(n);if(void 0===i)return void p(`entry named ${n} not found in UBO`);const o=t.bufferEntries[i];e.createView(o.nativeType);const a=t[o.nativeType],s=r.length/t.numberOfInstances;for(let e=0;e<t.numberOfInstances;e++){const n=(o.offset+e*t.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let t=0;t<s;t++)a[n+t]=r[e*s+t]/255}},e.setAllInstancesFromArray3x3To4x4=(n,r)=>{const i=t._bufferEntryNames.get(n);if(void 0===i)return void p(`entry named ${n} not found in UBO`);const o=t.bufferEntries[i];e.createView(o.nativeType);const a=t[o.nativeType];for(let e=0;e<t.numberOfInstances;e++){const n=(o.offset+e*t.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let t=0;t<3;t++)for(let i=0;i<3;i++)a[n+4*t+i]=r[9*e+3*t+i]}},e.getSendTime=()=>t._sendTime.getMTime(),e.getShaderCode=(e,n)=>{const r=[`struct ${t.label}StructEntry\n{`];for(let e=0;e<t.bufferEntries.length;e++){const n=t.bufferEntries[e];r.push(`  ${n.name}: ${n.type},`)}return r.push(`\n};\nstruct ${t.label}Struct\n{\n  values: array<${t.label}StructEntry>,\n};\n@binding(${e}) @group(${n}) var<storage, read> ${t.label}: ${t.label}Struct;\n`),r.join("\n")},e.getBindGroupEntry=()=>({resource:{buffer:t._buffer.getHandle()}}),e.clearData=()=>{t.numberOfInstances=0,t.sizeInBytes=0,t.bufferEntries=[],t._bufferEntryNames=new Map,t._buffer=null,delete t.arrayBuffer,delete t.Float32Array}}(e,t)}var m={newInstance:i.m.newInstance(f,"vtkWebGPUStorageBuffer"),extend:f},g=n(85232),v=n(32639);const{vtkDebugMacro:y}=i.c,b="\n//VTK::Renderer::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output: fragmentOutput;\n\n  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;\n\n  //VTK::RenderEncoder::Impl\n  return output;\n}\n",C=new Float64Array(16),w=new Float64Array(16);function E(e){return e.getPositional()?e.getConeAngle()>=90?0:2:1}const T={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function x(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,T,n),a.Z.extend(e,t,n),t.UBO=g.ZP.newInstance({label:"rendererUBO"}),t.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),t.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),t.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),t.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),t.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),t.UBO.addEntry("WCVCNormals","mat4x4<f32>"),t.UBO.addEntry("viewportSize","vec2<f32>"),t.UBO.addEntry("LightCount","i32"),t.UBO.addEntry("MaxEnvironmentMipLevel","f32"),t.UBO.addEntry("BackgroundDiffuseStrength","f32"),t.UBO.addEntry("BackgroundSpecularStrength","f32"),t.UBO.addEntry("cameraParallel","u32"),t.SSBO=m.newInstance({label:"rendererLightSSBO"}),t.lightTimeString="",t.bindGroup=s.ZP.newInstance({label:"rendererBG"}),t.bindGroup.setBindables([t.UBO,t.SSBO]),t.tmpMat4=r._E.identity(new Float64Array(16)),t.stabilizedTime={},(0,i.o)(t.stabilizedTime,{mtime:0}),(0,i.g)(e,t,["bindGroup","stabilizedTime"]),(0,i.k)(e,t,["stabilizedCenter"]),(0,i.e)(e,t,["renderEncoder","selector","suppressClear","UBO"]),function(e,t){t.classHierarchy.push("vtkWebGPURenderer"),e.buildPass=n=>{if(n){if(!t.renderable)return;t.camera=t.renderable.getActiveCamera(),e.updateLights(),e.prepareNodes(),e.addMissingNode(t.camera),e.addMissingNodes(t.renderable.getViewPropsWithNestedProps()),e.removeUnusedNodes(),t.webgpuCamera=e.getViewNodeFor(t.camera),e.updateStabilizedMatrix()}},e.updateStabilizedMatrix=()=>{const e=t.camera.getClippingRange(),n=t.camera.getPositionByReference(),i=t.camera.getDirectionOfProjectionByReference(),o=[],a=[];r.R3.scale(a,i,.5*(e[0]+e[1])),r.R3.add(o,n,a),r.R3.sub(a,o,t.stabilizedCenter),r.R3.len(a)/(e[1]-e[0])>t.recenterThreshold&&(t.stabilizedCenter=o,t.stabilizedTime.modified())},e.updateLights=()=>{let e=0;const n=t.renderable.getLightsByReference();for(let t=0;t<n.length;++t)n[t].getSwitch()>0&&e++;return e||(y("No lights are on, creating one."),t.renderable.createLight()),e},e.updateUBO=()=>{const n=t.UBO.getSendTime();if(t._parent.getMTime()>n||e.getMTime()>n||t.camera.getMTime()>n||t.renderable.getMTime()>n){const n=t.webgpuCamera.getKeyMatrices(e);t.UBO.setArray("WCVCMatrix",n.wcvc),t.UBO.setArray("SCPCMatrix",n.scpc),t.UBO.setArray("PCSCMatrix",n.pcsc),t.UBO.setArray("SCVCMatrix",n.scvc),t.UBO.setArray("VCPCMatrix",n.vcpc),t.UBO.setArray("WCVCNormals",n.normalMatrix),t.UBO.setValue("LightCount",t.renderable.getLights().length),t.UBO.setValue("MaxEnvironmentMipLevel",t.renderable.getEnvironmentTexture()?.getMipLevel()),t.UBO.setValue("BackgroundDiffuseStrength",t.renderable.getEnvironmentTextureDiffuseStrength()),t.UBO.setValue("BackgroundSpecularStrength",t.renderable.getEnvironmentTextureSpecularStrength());const r=e.getYInvertedTiledSizeAndOrigin();t.UBO.setArray("viewportSize",[r.usize,r.vsize]),t.UBO.setValue("cameraParallel",t.camera.getParallelProjection());const i=t._parent.getDevice();t.UBO.sendIfNeeded(i)}},e.updateSSBO=()=>{const n=t.renderable.getLights(),i=t.webgpuCamera.getKeyMatrices(e);let a=`${t.renderable.getMTime()}`;for(let e=0;e<n.length;e++)a+=n[e].getMTime();if(a!==t.lightTimeString){const e=new Float32Array(4*n.length),a=new Float32Array(4*n.length),s=new Float32Array(4*n.length),l=new Float32Array(4*n.length);for(let t=0;t<n.length;t++){const c=4*t,u=n[t].getPosition();r.R3.transformMat4(u,u,i.wcvc),e[c]=u[0],e[c+1]=u[1],e[c+2]=u[2],e[c+3]=0,a[c]=-n[t].getDirection()[0],a[c+1]=-n[t].getDirection()[1],a[c+2]=-n[t].getDirection()[2],a[c+3]=0,s[c]=n[t].getColor()[0],s[c+1]=n[t].getColor()[1],s[c+2]=n[t].getColor()[2],s[c+3]=5*n[t].getIntensity(),l[c]=E(n[t]),l[c+1]=Math.cos((0,o.r)(n[t].getConeAngle())),l[c+2]=Math.cos((0,o.r)(n[t].getConeAngle()+n[t].getConeFalloff())),l[c+3]=0}t.SSBO.clearData(),t.SSBO.setNumberOfInstances(n.length),t.SSBO.addEntry("LightPos","vec4<f32>"),t.SSBO.addEntry("LightDir","vec4<f32>"),t.SSBO.addEntry("LightColor","vec4<f32>"),t.SSBO.addEntry("LightData","vec4<f32>"),t.SSBO.setAllInstancesFromArray("LightPos",e),t.SSBO.setAllInstancesFromArray("LightDir",a),t.SSBO.setAllInstancesFromArray("LightColor",s),t.SSBO.setAllInstancesFromArray("LightData",l);const c=t._parent.getDevice();t.SSBO.send(c)}t.lightTimeString=a},e.scissorAndViewport=t=>{const n=e.getYInvertedTiledSizeAndOrigin();t.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),t.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},e.bindUBO=e=>{e.activateBindGroup(t.bindGroup)},e.opaquePass=n=>{n?(t.renderEncoder.begin(t._parent.getCommandEncoder()),e.updateUBO(),e.updateSSBO()):(e.scissorAndViewport(t.renderEncoder),e.clear(),t.renderEncoder.end())},e.clear=()=>{if(t.renderable.getTransparent()||t.suppressClear)return;const n=t._parent.getDevice();if(!t.clearFSQ){t.clearFSQ=l.ZP.newInstance(),t.clearFSQ.setDevice(n),t.clearFSQ.setPipelineHash("clearfsq"),t.clearFSQ.setFragmentShaderTemplate(b);const e=g.ZP.newInstance({label:"mapperUBO"});e.addEntry("FSQMatrix","mat4x4<f32>"),e.addEntry("BackgroundColor","vec4<f32>"),t.clearFSQ.setUBO(e),t.backgroundTex=t.renderable.getEnvironmentTexture()}if("clearfsqwithtexture"!==t.clearFSQ.getPipelineHash()&&t.renderable.getUseEnvironmentTextureAsBackground()&&t.backgroundTex?.getImageLoaded()){t.clearFSQ.setFragmentShaderTemplate("\nfn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {\n  var tau: f32 = 6.28318530718;\n  var pi: f32 = 3.14159265359;\n  var out: vec2<f32> = vec2<f32>(0.0);\n\n  out.x = atan2(dir.z, dir.x) / tau;\n  out.x += 0.5;\n\n  var phix: f32 = length(vec2(dir.x, dir.z));\n  out.y = atan2(dir.y, phix) / pi + 0.5;\n\n  return out;\n}\n\n//VTK::Renderer::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output: fragmentOutput;\n\n  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);\n  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);\n  // textureSampleLevel gets rid of some ugly artifacts\n  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);\n  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);\n\n  //VTK::RenderEncoder::Impl\n  return output;\n}\n");const e=g.ZP.newInstance({label:"mapperUBO"});e.addEntry("FSQMatrix","mat4x4<f32>"),e.addEntry("BackgroundColor","vec4<f32>"),t.clearFSQ.setUBO(e);const r=n.getTextureManager().getTextureForVTKTexture(t.backgroundTex);if(r.getReady()){const e=r.createView("EnvironmentTexture");t.clearFSQ.setTextureViews([e]),t.backgroundTexLoaded=!0;const i=t.backgroundTex.getInterpolate()?"linear":"nearest";e.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:i,magFilter:i,mipmapFilter:"linear"})}t.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if("clearfsqwithtexture"===t.clearFSQ.getPipelineHash()&&!t.renderable.getUseEnvironmentTextureAsBackground()){t.clearFSQ=l.ZP.newInstance(),t.clearFSQ.setDevice(n),t.clearFSQ.setPipelineHash("clearfsq"),t.clearFSQ.setFragmentShaderTemplate(b);const e=g.ZP.newInstance({label:"mapperUBO"});e.addEntry("FSQMatrix","mat4x4<f32>"),e.addEntry("BackgroundColor","vec4<f32>"),t.clearFSQ.setUBO(e)}const i=t.webgpuCamera.getKeyMatrices(e),o=t.renderable.getBackgroundByReference();t.clearFSQ.getUBO().setArray("BackgroundColor",o),r._E.transpose(w,i.normalMatrix),r._E.mul(C,i.scvc,i.pcsc),r._E.mul(C,w,C),t.clearFSQ.getUBO().setArray("FSQMatrix",C),t.clearFSQ.getUBO().sendIfNeeded(n),t.clearFSQ.prepareAndDraw(t.renderEncoder)},e.translucentPass=n=>{n?t.renderEncoder.begin(t._parent.getCommandEncoder()):(e.scissorAndViewport(t.renderEncoder),t.renderEncoder.end())},e.volumeDepthRangePass=n=>{n?t.renderEncoder.begin(t._parent.getCommandEncoder()):(e.scissorAndViewport(t.renderEncoder),t.renderEncoder.end())},e.getAspectRatio=()=>{const e=t._parent.getSizeByReference(),n=t.renderable.getViewportByReference();return e[0]*(n[2]-n[0])/((n[3]-n[1])*e[1])},e.convertToOpenGLDepth=e=>t.webgpuCamera.convertToOpenGLDepth(e),e.getYInvertedTiledSizeAndOrigin=()=>{const n=e.getTiledSizeAndOrigin(),r=t._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},e.getTiledSizeAndOrigin=()=>{const e=t.renderable.getViewportByReference(),n=[0,0,1,1],r=e[0]-n[0],i=e[1]-n[1],o=t._parent.normalizedDisplayToDisplay(r,i),a=Math.round(o[0]),s=Math.round(o[1]),l=e[2]-n[0],c=e[3]-n[1],u=t._parent.normalizedDisplayToDisplay(l,c);let d=Math.round(u[0])-a,p=Math.round(u[1])-s;return d<0&&(d=0),p<0&&(p=0),{usize:d,vsize:p,lowerLeftU:a,lowerLeftV:s}},e.getPropFromID=e=>{for(let n=0;n<t.children.length;n++)if((t.children[n].getPropID?t.children[n].getPropID():-1)===e)return t.children[n];return null},e.getStabilizedTime=()=>t.stabilizedTime.getMTime(),e.releaseGraphicsResources=()=>{null!==t.selector&&t.selector.releaseGraphicsResources()}}(e,t)}const _=(0,i.n)(x,"vtkWebGPURenderer");(0,v.vw)("vtkRenderer",_)},2144:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>a});var r=n(68470);const i={device:null,handle:null,label:null,options:null};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,i,n),r.m.obj(e,t),t.options={},t.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},t.bindGroupTime={},r.m.obj(t.bindGroupTime,{mtime:0}),r.m.get(e,t,["bindGroupTime","handle","options"]),r.m.setGet(e,t,["bindGroupLayoutEntry","device","label"]),function(e,t){t.classHierarchy.push("vtkWebGPUSampler"),e.create=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.device=e,t.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",t.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",t.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",t.options.magFilter=n.magFilter?n.magFilter:"nearest",t.options.minFilter=n.minFilter?n.minFilter:"nearest",t.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",t.options.label=t.label,t.handle=t.device.getHandle().createSampler(t.options),t.bindGroupTime.modified()},e.getShaderCode=(e,n)=>`@binding(${e}) @group(${n}) var ${t.label}: sampler;`,e.getBindGroupEntry=()=>({resource:t.handle})}(e,t)}var a={newInstance:r.m.newInstance(o),extend:o}},19974:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var r=n(68470);const i={device:null,handle:null};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,i,n),r.m.obj(e,t),r.m.get(e,t,["lastCameraMTime"]),r.m.setGet(e,t,["device","handle"]),function(e,t){t.classHierarchy.push("vtkWebGPUShaderModule"),e.initialize=(e,n)=>{t.device=e,t.handle=t.device.getHandle().createShaderModule({code:n.getCode()})}}(e,t)}var a={newInstance:r.m.newInstance(o,"vtkWebGPUShaderModule"),extend:o};const s={shaderModules:null,device:null,window:null};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),t._shaderModules=new Map,r.m.obj(e,t),r.m.setGet(e,t,["device","window"]),function(e,t){t.classHierarchy.push("vtkWebGPUShaderCache"),e.getShaderModule=e=>{const n=e.getType(),r=e.getHash(),i=t._shaderModules.keys();for(let e=0;e<i.length;e++){const o=i[e];if(o.getHash()===r&&o.getType()===n)return t._shaderModules.get(o)}const o=a.newInstance();return o.initialize(t.device,e),t._shaderModules.set(e,o),o}}(e,t)}var c={newInstance:r.m.newInstance(l,"vtkWebGPUShaderCache"),extend:l,substitute:function(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=Array.isArray(n)?n.join("\n"):n;let o=!1;-1!==e.search(t)&&(o=!0);let a="";r&&(a="g");const s=new RegExp(t,a);return{replace:o,result:e.replace(s,i)}}}},84770:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>C});var r=n(68470),i=n(6814),o=n(92764);const a={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),(0,r.o)(e,t),t.layouts=[],t.shaderDescriptions=[],(0,r.g)(e,t,["handle","pipelineDescription"]),(0,r.e)(e,t,["device","renderEncoder","topology","vertexState"]),function(e,t){t.classHierarchy.push("vtkWebGPUPipeline"),e.getShaderDescriptions=()=>t.shaderDescriptions,e.initialize=(e,n)=>{t.pipelineDescription=t.renderEncoder.getPipelineSettings(),t.pipelineDescription.primitive.topology=t.topology,t.pipelineDescription.vertex=t.vertexState,t.pipelineDescription.label=n;const r=[];for(let e=0;e<t.layouts.length;e++)r.push(t.layouts[e].layout);t.pipelineLayout=e.getHandle().createPipelineLayout({bindGroupLayouts:r}),t.pipelineDescription.layout=t.pipelineLayout;for(let n=0;n<t.shaderDescriptions.length;n++){const r=t.shaderDescriptions[n],i=e.getShaderModule(r);"vertex"===r.getType()&&(t.pipelineDescription.vertex.module=i.getHandle(),t.pipelineDescription.vertex.entryPoint="main"),"fragment"===r.getType()&&(t.pipelineDescription.fragment.module=i.getHandle(),t.pipelineDescription.fragment.entryPoint="main")}t.handle=e.getHandle().createRenderPipeline(t.pipelineDescription)},e.getShaderDescription=e=>{for(let n=0;n<t.shaderDescriptions.length;n++)if(t.shaderDescriptions[n].getType()===e)return t.shaderDescriptions[n];return null},e.addBindGroupLayout=e=>{e&&t.layouts.push({layout:e.getBindGroupLayout(t.device),label:e.getLabel()})},e.getBindGroupLayout=e=>t.layouts[e].layout,e.getBindGroupLayoutCount=e=>{for(let n=0;n<t.layouts.length;n++)if(t.layouts[n].label===e)return n;return 0},e.bindVertexInput=(e,t)=>{t.bindBuffers(e)}}(e,t)}var l={newInstance:(0,r.n)(s,"vtkWebGPUPipeline"),extend:s},c=n(19974);const u={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,u,n),t.outputNames=[],t.outputTypes=[],t.outputInterpolations=[],t.builtinOutputNames=[],t.builtinOutputTypes=[],t.builtinInputNames=[],t.builtinInputTypes=[],r.m.obj(e,t),r.m.setGet(e,t,["type","hash","code"]),r.m.getArray(e,t,["outputTypes","outputNames","outputInterpolations"]),function(e,t){t.classHierarchy.push("vtkWebGPUShaderDescription"),e.hasOutput=e=>t.outputNames.includes(e),e.addOutput=function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;t.outputTypes.push(e),t.outputNames.push(n),t.outputInterpolations.push(r)},e.addBuiltinOutput=(e,n)=>{t.builtinOutputTypes.push(e),t.builtinOutputNames.push(n)},e.addBuiltinInput=(e,n)=>{t.builtinInputTypes.push(e),t.builtinInputNames.push(n)},e.replaceShaderCode=(e,n)=>{const r=[];let i=[];if(n&&r.push(n.getShaderCode()),e||t.builtinInputNames.length){const n=[];if(n.push(`struct ${t.type}Input\n{`),e){const t=e.getOutputNamesByReference(),r=e.getOutputTypesByReference(),i=e.getOutputInterpolationsByReference();for(let e=0;e<t.length;e++)void 0!==i[e]?n.push(`  @location(${e}) @interpolate(${i[e]}) ${t[e]} : ${r[e]},`):n.push(`  @location(${e}) ${t[e]} : ${r[e]},`)}for(let e=0;e<t.builtinInputNames.length;e++)n.push(`  ${t.builtinInputNames[e]} : ${t.builtinInputTypes[e]},`);n.length>1&&(n.push("};"),i=n,r[r.length-1]+=",",r.push(`input: ${t.type}Input`))}if(r.length&&(t.code=c.ZP.substitute(t.code,"//VTK::IOStructs::Input",r).result),t.outputNames.length+t.builtinOutputNames.length){const e=[`struct ${t.type}Output\n{`];for(let n=0;n<t.outputNames.length;n++)void 0!==t.outputInterpolations[n]?e.push(`  @location(${n}) @interpolate(${t.outputInterpolations[n]}) ${t.outputNames[n]} : ${t.outputTypes[n]},`):e.push(`  @location(${n}) ${t.outputNames[n]} : ${t.outputTypes[n]},`);for(let n=0;n<t.builtinOutputNames.length;n++)e.push(`  ${t.builtinOutputNames[n]} : ${t.builtinOutputTypes[n]},`);e.push("};"),i=i.concat(e),t.code=c.ZP.substitute(t.code,"//VTK::IOStructs::Output",[`-> ${t.type}Output`]).result}t.code=c.ZP.substitute(t.code,"//VTK::IOStructs::Dec",i).result}}(e,t)}var p={newInstance:r.m.newInstance(d,"vtkWebGPUShaderDescription"),extend:d},h=n(35498);function f(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!t.includes(e[n]))return!1;return!0}const m={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function g(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,m,n),(0,r.o)(e,t),t.bindingDescriptions=[],t.attributeDescriptions=[],t.inputs=[],(0,r.e)(e,t,["created","device","handle","indexBuffer"]),function(e,t){t.classHierarchy.push("vtkWebGPUVertexInput"),e.addBuffer=function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertex",i=n;Array.isArray(i)||(i=[i]);for(let n=0;n<t.inputs.length;n++)if(f(t.inputs[n].names,i)){if(t.inputs[n].buffer===e)return;return void(t.inputs[n].buffer=e)}t.inputs.push({buffer:e,stepMode:r,names:i}),t.inputs=t.inputs.sort((e,t)=>e.names[0]<t.names[0]?-1:e.names[0]>t.names[0]?1:0)},e.removeBufferIfPresent=e=>{for(let n=0;n<t.inputs.length;n++)t.inputs[n].names.includes(e)&&t.inputs.splice(n,1)},e.getBuffer=e=>{for(let n=0;n<t.inputs.length;n++)if(t.inputs[n].names.includes(e))return t.inputs[n].buffer;return null},e.hasAttribute=e=>{for(let n=0;n<t.inputs.length;n++)if(t.inputs[n].names.includes(e))return!0;return!1},e.getAttributeTime=e=>{for(let n=0;n<t.inputs.length;n++)if(t.inputs[n].names.includes(e))return t.inputs[n].buffer.getSourceTime();return 0},e.getShaderCode=()=>{let e="",n=0;for(let r=0;r<t.inputs.length;r++)for(let i=0;i<t.inputs[r].names.length;i++){const o=t.inputs[r].buffer.getArrayInformation()[i],a=h.Z.getShaderTypeFromBufferFormat(o.format);n>0&&(e+=",\n"),e=`${e}  @location(${n}) ${t.inputs[r].names[i]} : ${a}`,n++}return e},e.getVertexInputInformation=()=>{const e={};if(t.inputs.length){const n=[];let r=0;for(let e=0;e<t.inputs.length;e++){const i=t.inputs[e].buffer,o={arrayStride:i.getStrideInBytes(),stepMode:t.inputs[e].stepMode,attributes:[]},a=i.getArrayInformation();for(let n=0;n<t.inputs[e].names.length;n++)o.attributes.push({shaderLocation:r,offset:a[n].offset,format:a[n].format}),r++;n.push(o)}e.buffers=n}return e},e.bindBuffers=e=>{for(let n=0;n<t.inputs.length;n++)e.setVertexBuffer(n,t.inputs[n].buffer.getHandle());t.indexBuffer&&e.setIndexBuffer(t.indexBuffer.getHandle(),t.indexBuffer.getArrayInformation()[0].format)},e.getReady=()=>{},e.releaseGraphicsResources=()=>{t.created&&(t.inputs=[],t.bindingDescriptions=[],t.attributeDescriptions=[])}}(e,t)}var v={newInstance:(0,r.n)(g,"vtkWebGPUVertexInput"),extend:g};const y={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function b(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,y,n),i.Z.extend(e,t,n),t.textureViews=[],t.vertexInput=v.newInstance(),t.bindGroup=o.ZP.newInstance({label:"mapperBG"}),t.additionalBindables=[],t.fragmentShaderTemplate=t.fragmentShaderTemplate||"\n//VTK::Renderer::Dec\n\n//VTK::Color::Dec\n\n//VTK::Normal::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::Select::Dec\n\n//VTK::RenderEncoder::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::IOStructs::Dec\n\n@fragment\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output : fragmentOutput;\n\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::Light::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Select::Impl\n\n  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);\n\n  //VTK::RenderEncoder::Impl\n  return output;\n}\n",t.vertexShaderTemplate=t.vertexShaderTemplate||"\n//VTK::Renderer::Dec\n\n//VTK::Color::Dec\n\n//VTK::Normal::Dec\n\n//VTK::TCoord::Dec\n\n//VTK::Select::Dec\n\n//VTK::Mapper::Dec\n\n//VTK::IOStructs::Dec\n\n@vertex\nfn main(\n//VTK::IOStructs::Input\n)\n//VTK::IOStructs::Output\n{\n  var output : vertexOutput;\n\n  // var vertex: vec4<f32> = vertexBC;\n\n  //VTK::Color::Impl\n\n  //VTK::Normal::Impl\n\n  //VTK::TCoord::Impl\n\n  //VTK::Select::Impl\n\n  //VTK::Position::Impl\n\n  return output;\n}\n",t.shaderReplacements=new Map,r.m.get(e,t,["pipeline","vertexInput"]),r.m.setGet(e,t,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),function(e,t){t.classHierarchy.push("vtkWebGPUSimpleMapper"),e.generateShaderDescriptions=(n,r,i)=>{const o=p.newInstance({type:"vertex",hash:n,code:t.vertexShaderTemplate}),a=p.newInstance({type:"fragment",hash:n,code:t.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(o),s.push(a);const l=t.vertexShaderTemplate+t.fragmentShaderTemplate,c=new RegExp("//VTK::[^:]*::","g"),u=l.match(c).filter((e,t,n)=>n.indexOf(e)===t).map(e=>`replaceShader${e.substring(7,e.length-2)}`);for(let e=0;e<u.length;e++){const o=u[e];"replaceShaderIOStructs"!==o&&t.shaderReplacements.has(o)&&t.shaderReplacements.get(o)(n,r,i)}e.replaceShaderIOStructs(n,r,i)},e.replaceShaderIOStructs=(e,t,n)=>{const r=t.getShaderDescription("vertex");r.replaceShaderCode(null,n),t.getShaderDescription("fragment").replaceShaderCode(r)},e.replaceShaderRenderEncoder=(e,n,r)=>{t.renderEncoder.replaceShaderCode(n)},t.shaderReplacements.set("replaceShaderRenderEncoder",e.replaceShaderRenderEncoder),e.replaceShaderRenderer=(e,n,r)=>{if(!t.WebGPURenderer)return;const i=t.WebGPURenderer.getBindGroup().getShaderCode(n),o=n.getShaderDescription("vertex");let a=o.getCode();a=c.ZP.substitute(a,"//VTK::Renderer::Dec",[i]).result,o.setCode(a);const s=n.getShaderDescription("fragment");a=s.getCode(),a=c.ZP.substitute(a,"//VTK::Renderer::Dec",[i]).result,s.setCode(a)},t.shaderReplacements.set("replaceShaderRenderer",e.replaceShaderRenderer),e.replaceShaderMapper=(e,n,r)=>{const i=t.bindGroup.getShaderCode(n),o=n.getShaderDescription("vertex");let a=o.getCode();a=c.ZP.substitute(a,"//VTK::Mapper::Dec",[i]).result,o.setCode(a);const s=n.getShaderDescription("fragment");s.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),a=s.getCode(),a=c.ZP.substitute(a,"//VTK::Mapper::Dec",[i]).result,s.setCode(a)},t.shaderReplacements.set("replaceShaderMapper",e.replaceShaderMapper),e.replaceShaderPosition=(e,t,n)=>{const r=t.getShaderDescription("vertex");r.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let i=r.getCode();i=c.ZP.substitute(i,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,r.setCode(i)},t.shaderReplacements.set("replaceShaderPosition",e.replaceShaderPosition),e.replaceShaderTCoord=(e,t,n)=>{t.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},t.shaderReplacements.set("replaceShaderTCoord",e.replaceShaderTCoord),e.addTextureView=e=>{t.textureViews.includes(e)||t.textureViews.push(e)},e.prepareToDraw=n=>{t.renderEncoder=n,e.updateInput(),e.updateBuffers(),e.updateBindings(),e.updatePipeline()},e.updateInput=()=>{},e.updateBuffers=()=>{},e.updateBindings=()=>{t.bindGroup.setBindables(e.getBindables())},e.computePipelineHash=()=>{},e.registerDrawCallback=n=>{n.registerDrawCallback(t.pipeline,e.draw)},e.prepareAndDraw=n=>{e.prepareToDraw(n),n.setPipeline(t.pipeline),e.draw(n)},e.draw=e=>{const n=e.getBoundPipeline();e.activateBindGroup(t.bindGroup),t.WebGPURenderer&&t.WebGPURenderer.bindUBO(e),n.bindVertexInput(e,t.vertexInput);const r=t.vertexInput.getIndexBuffer();r?e.drawIndexed(r.getIndexCount(),t.numberOfInstances,0,0,0):e.draw(t.numberOfVertices,t.numberOfInstances,0,0)},e.getBindables=()=>{const e=[...t.additionalBindables];t.UBO&&e.push(t.UBO),t.SSBO&&e.push(t.SSBO);for(let n=0;n<t.textureViews.length;n++){e.push(t.textureViews[n]);const r=t.textureViews[n].getSampler();r&&e.push(r)}return e},e.updatePipeline=()=>{e.computePipelineHash(),t.pipeline=t.device.getPipeline(t.pipelineHash),t.pipeline||(t.pipeline=l.newInstance(),t.pipeline.setDevice(t.device),t.WebGPURenderer&&t.pipeline.addBindGroupLayout(t.WebGPURenderer.getBindGroup()),t.pipeline.addBindGroupLayout(t.bindGroup),e.generateShaderDescriptions(t.pipelineHash,t.pipeline,t.vertexInput),t.pipeline.setTopology(t.topology),t.pipeline.setRenderEncoder(t.renderEncoder),t.pipeline.setVertexState(t.vertexInput.getVertexInputInformation()),t.device.createPipeline(t.pipelineHash,t.pipeline))}}(e,t)}var C={newInstance:r.m.newInstance(b,"vtkWebGPUSimpleMapper"),extend:b}},35498:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(68470);const i={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};var o={getDetailsFromTextureFormat:function(e){return!e||e.length<6?0:e in i==!0?i[e]:((0,r.r)(`unknown format ${e}`),null)},getByteStrideFromBufferFormat:function(e){if(!e||e.length<5)return 0;let t=1;"x"===e[e.length-2]&&(t=Number(e[e.length-1]));const n=1===t?e.length-1:e.length-3,i=Number(e[n]);return Number.isNaN(i)?((0,r.r)(`unknown format ${e}`),0):t*(5-i/2)},getNumberOfComponentsFromBufferFormat:function(e){if(!e||e.length<5)return 0;let t=1;return"x"===e[e.length-2]&&(t=Number(e[e.length-1])),t},getNativeTypeFromBufferFormat:function(e){if(!e||e.length<5)return 0;let t;if("f"===e[0])t="Float";else if("s"===e[0])t="Int";else{if("u"!==e[0])return void(0,r.r)(`unknown format ${e}`);t="Uint"}const n=e.split("x")[0],i=Number(n[n.length-1]);if(!Number.isNaN(i))return t+=8*(5-i/2),t+="Array",t;(0,r.r)(`unknown format ${e}`)},getShaderTypeFromBufferFormat:function(e){let t;if("f"===e[0]||"n"===e[1])t="f32";else if("s"===e[0]&&"i"===e[1])t="i32";else{if("u"!==e[0]||"i"!==e[1])return void(0,r.r)(`unknown format ${e}`);t="u32"}let n=1;return"x"===e[e.length-2]&&(n=Number(e[e.length-1])),4===n?`vec4<${t}>`:3===n?`vec3<${t}>`:2===n?`vec2<${t}>`:t},getByteStrideFromShaderFormat:function(e){if(!e)return 0;let t=1;return"vec"===e.substring(0,3)?t=Number(e[3]):"mat"===e.substring(0,3)&&(t=e[3]*e[5]),4*t},getNativeTypeFromShaderFormat:function(e){if(e)return e.includes("f32")?"Float32Array":e.includes("i32")?"Int32Array":e.includes("u32")?"Uint32Array":void(0,r.r)(`unknown format ${e}`)}}},85232:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var r=n(68470),i=n(7220),o=n(35498);const{BufferUsage:a}=i.default,{vtkErrorMacro:s}=r.m;const l={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,l,n),r.m.obj(e,t),t._bufferEntryNames=new Map,t.bufferEntries=[],t.bindGroupLayoutEntry=t.bindGroupLayoutEntry||{buffer:{type:"uniform"}},t.sendTime={},r.m.obj(t.sendTime,{mtime:0}),t.bindGroupTime={},r.m.obj(t.bindGroupTime,{mtime:0}),t.sendDirty=!0,t.sortDirty=!0,r.m.get(e,t,["binding","bindGroupTime"]),r.m.setGet(e,t,["bindGroupLayoutEntry","device","label","sizeInBytes"]),function(e,t){t.classHierarchy.push("vtkWebGPUUniformBuffer"),e.addEntry=(e,n)=>{t._bufferEntryNames.has(e)?s(`entry named ${e} already exists`):(t.sortDirty=!0,t._bufferEntryNames.set(e,t.bufferEntries.length),t.bufferEntries.push({name:e,type:n,sizeInBytes:o.Z.getByteStrideFromShaderFormat(n),offset:-1,nativeType:o.Z.getNativeTypeFromShaderFormat(n),packed:!1}))},e.sortBufferEntries=()=>{if(!t.sortDirty)return;let e=0;const n=[];let r=4;for(let e=0;e<t.bufferEntries.length;e++){const n=t.bufferEntries[e];n.sizeInBytes%16==0&&(r=Math.max(16,r)),n.sizeInBytes%8==0&&(r=Math.max(8,r))}for(let r=0;r<t.bufferEntries.length;r++){const i=t.bufferEntries[r];!1===i.packed&&i.sizeInBytes%16==0&&(i.packed=!0,i.offset=e,n.push(i),e+=i.sizeInBytes)}for(let r=0;r<t.bufferEntries.length;r++){const i=t.bufferEntries[r];if(!1===i.packed&&12===i.sizeInBytes)for(let r=0;r<t.bufferEntries.length;r++){const o=t.bufferEntries[r];if(!1===o.packed&&4===o.sizeInBytes){i.packed=!0,i.offset=e,n.push(i),e+=i.sizeInBytes,o.packed=!0,o.offset=e,n.push(o),e+=o.sizeInBytes;break}}}for(let r=0;r<t.bufferEntries.length;r++){const i=t.bufferEntries[r];if(!i.packed&&i.sizeInBytes%8==0)for(let o=r+1;o<t.bufferEntries.length;o++){const r=t.bufferEntries[o];if(!r.packed&&r.sizeInBytes%8==0){i.packed=!0,i.offset=e,n.push(i),e+=i.sizeInBytes,r.packed=!0,r.offset=e,n.push(r),e+=r.sizeInBytes;break}}}for(let r=0;r<t.bufferEntries.length;r++){const i=t.bufferEntries[r];if(!i.packed&&i.sizeInBytes%8==0){let r=!1;for(let o=0;!r&&o<t.bufferEntries.length;o++){const a=t.bufferEntries[o];if(!a.packed&&4===a.sizeInBytes)for(let s=o+1;s<t.bufferEntries.length;s++){const o=t.bufferEntries[s];if(!o.packed&&4===o.sizeInBytes){i.packed=!0,i.offset=e,n.push(i),e+=i.sizeInBytes,a.packed=!0,a.offset=e,n.push(a),e+=a.sizeInBytes,o.packed=!0,o.offset=e,n.push(o),e+=o.sizeInBytes,r=!0;break}}}}}for(let r=0;r<t.bufferEntries.length;r++){const i=t.bufferEntries[r];!i.packed&&i.sizeInBytes>4&&(i.packed=!0,i.offset=e,n.push(i),e+=i.sizeInBytes)}for(let r=0;r<t.bufferEntries.length;r++){const i=t.bufferEntries[r];i.packed||(i.packed=!0,i.offset=e,n.push(i),e+=i.sizeInBytes)}t.bufferEntries=n,t._bufferEntryNames.clear();for(let e=0;e<t.bufferEntries.length;e++)t._bufferEntryNames.set(t.bufferEntries[e].name,e);t.sizeInBytes=e,t.sizeInBytes=r*Math.ceil(t.sizeInBytes/r),t.sortDirty=!1},e.sendIfNeeded=e=>{if(!t.UBO){const n={nativeArray:t.Float32Array,usage:a.UniformArray,label:t.label};t.UBO=e.getBufferManager().getBuffer(n),t.bindGroupTime.modified(),t.sendDirty=!1}t.sendDirty&&(e.getHandle().queue.writeBuffer(t.UBO.getHandle(),0,t.arrayBuffer,0,t.sizeInBytes),t.sendDirty=!1),t.sendTime.modified()},e.createView=e=>{e in t==0&&(t.arrayBuffer||(t.arrayBuffer=new ArrayBuffer(t.sizeInBytes)),t[e]=r.m.newTypedArray(e,t.arrayBuffer))},e.setValue=(n,r)=>{e.sortBufferEntries();const i=t._bufferEntryNames.get(n);if(void 0===i)return void s(`entry named ${n} not found in UBO`);const o=t.bufferEntries[i];e.createView(o.nativeType);const a=t[o.nativeType];o.lastValue!==r&&(a[o.offset/a.BYTES_PER_ELEMENT]=r,t.sendDirty=!0),o.lastValue=r},e.setArray=(n,r)=>{e.sortBufferEntries();const i=t._bufferEntryNames.get(n);if(void 0===i)return void s(`entry named ${n} not found in UBO`);const o=t.bufferEntries[i];e.createView(o.nativeType);const a=t[o.nativeType];let l=!1;for(let e=0;e<r.length;e++)o.lastValue&&o.lastValue[e]===r[e]||(a[o.offset/a.BYTES_PER_ELEMENT+e]=r[e],l=!0);l&&(t.sendDirty=!0,o.lastValue=[...r])},e.getBindGroupEntry=()=>({resource:{buffer:t.UBO.getHandle()}}),e.getSendTime=()=>t.sendTime.getMTime(),e.getShaderCode=(n,r)=>{e.sortBufferEntries();const i=[`struct ${t.label}Struct\n{`];for(let e=0;e<t.bufferEntries.length;e++){const n=t.bufferEntries[e];i.push(`  ${n.name}: ${n.type},`)}return i.push(`};\n@binding(${n}) @group(${r}) var<uniform> ${t.label}: ${t.label}Struct;`),i.join("\n")}}(e,t)}var u={newInstance:r.m.newInstance(c,"vtkWebGPUUniformBuffer"),extend:c}},32639:(e,t,n)=>{"use strict";n.d(t,{vw:()=>a});var r=n(68470),i=n(79410);const o=Object.create(null);function a(e,t){o[e]=t}const s={};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),t.overrides=o,i.ZP.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkWebGPUViewNodeFactory")}(0,t)}r.m.newInstance(l,"vtkWebGPUViewNodeFactory")},6685:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r.m});n(25686),n(99824),n(86096);var r=n(68470)},68470:(e,t,n)=>{"use strict";n.d(t,{a:()=>w,b:()=>E,c:()=>ae,d:()=>z,e:()=>V,g:()=>N,h:()=>K,i:()=>W,k:()=>U,l:()=>G,m:()=>oe,n:()=>Z,o:()=>R,r:()=>g,s:()=>F});var r=n(25686),i=n.n(r),o=n(99824),a=n(86096);let s=0;const l=Symbol("void");const c={};function u(){}["log","debug","info","warn","error","time","timeEnd","group","groupEnd"].forEach(e=>{c[e]=u}),o.I.console=console.hasOwnProperty("log")?console:c;const d={debug:u,error:o.I.console.error||u,info:o.I.console.info||u,log:o.I.console.log||u,warn:o.I.console.warn||u};function p(e,t){d[e]&&(d[e]=t||u)}function h(){d.log(...arguments)}function f(){d.info(...arguments)}function m(){d.debug(...arguments)}function g(){d.error(...arguments)}function v(){d.warn(...arguments)}const y={};function b(e){y[e]||(d.error(e),y[e]=!0)}const C=Object.create(null);C.Float32Array=Float32Array,C.Float64Array=Float64Array,C.Uint8Array=Uint8Array,C.Int8Array=Int8Array,C.Uint16Array=Uint16Array,C.Int16Array=Int16Array,C.Uint32Array=Uint32Array,C.Int32Array=Int32Array,C.Uint8ClampedArray=Uint8ClampedArray;try{C.BigInt64Array=BigInt64Array,C.BigUint64Array=BigUint64Array}catch{}function w(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new(C[e]||Float64Array)(...n)}function E(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return(C[e]||Float64Array).from(...n)}function T(e){return e.charAt(0).toUpperCase()+e.slice(1)}function x(e){return T("_"===e[0]?e.slice(1):e)}function _(e){return e.charAt(0).toLowerCase()+e.slice(1)}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let i=Number(e),o="B";for(;i>n;)i/=n,o=r.pop();return`${i.toFixed(t)} ${o}`}function I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";const n=[];let r=e;for(;r>1e3;)n.push(("000"+r%1e3).slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(t)}function D(e){Object.keys(e).forEach(t=>{Array.isArray(e[t])&&(e[t]=[].concat(e[t]))})}function A(e){return e&&e.isA?e.getState():e}function P(e){setTimeout(e,0)}function O(e,t){const n=performance.now();e.finally(()=>{const e=performance.now()-n;t(e)})}function R(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D(t);const n=[];if(Number.isInteger(t.mtime)||(t.mtime=++s),"classHierarchy"in t){if(!(t.classHierarchy instanceof a.Z)){const e=new a.Z;for(let n=0;n<t.classHierarchy.length;n++)e.push(t.classHierarchy[n]);t.classHierarchy=e}}else t.classHierarchy=new a.Z("vtkObject");function r(e){n[e]=null}return e.isDeleted=()=>!!t.deleted,e.modified=r=>{t.deleted?g("instance deleted - cannot call any method"):r&&r<e.getMTime()||(t.mtime=++s,n.forEach(t=>t&&t(e)))},e.onModified=e=>{if(t.deleted)return g("instance deleted - cannot call any method"),null;const i=n.length;return n.push(e),function(e){return Object.freeze({unsubscribe:function(){r(e)}})}(i)},e.getMTime=()=>t.mtime,e.isA=e=>{let n=t.classHierarchy.length;for(;n--;)if(t.classHierarchy[n]===e)return!0;return!1},e.getClassName=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.classHierarchy[t.classHierarchy.length-1-e]},e.set=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!1;return Object.keys(n).forEach(a=>{const s=i?null:e[`set${T(a)}`];s&&Array.isArray(n[a])&&s.length>1?o=s(...n[a])||o:s?o=s(n[a])||o:(-1!==["mtime"].indexOf(a)||r||v(`Warning: Set value to model directly ${a}, ${n[a]}`),o=t[a]!==n[a]||o,t[a]=n[a])}),o},e.get=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.length)return t;const i={};return n.forEach(e=>{i[e]=t[e]}),i},e.getReferenceByName=e=>t[e],e.delete=()=>{Object.keys(t).forEach(e=>delete t[e]),n.forEach((e,t)=>r(t)),t.deleted=!0},e.getState=()=>{if(t.deleted)return null;const n={...t,vtkClass:e.getClassName()};Object.keys(n).forEach(e=>{null===n[e]||void 0===n[e]||"_"===e[0]?delete n[e]:n[e].isA?n[e]=n[e].getState():Array.isArray(n[e])?n[e]=n[e].map(A):function(e){return Object.values(C).some(t=>e instanceof t)}(n[e])&&(n[e]=Array.from(n[e]))});const r={};return Object.keys(n).sort().forEach(e=>{r[e]=n[e]}),r.mtime&&delete r.mtime,r},e.shallowCopy=function(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n.getClassName()!==e.getClassName())throw new Error(`Cannot ShallowCopy ${n.getClassName()} into ${e.getClassName()}`);const i=n.get(),o=Object.keys(t).sort();Object.keys(i).sort().forEach(e=>{const n=o.indexOf(e);-1===n?r&&m(`add ${e} in shallowCopy`):o.splice(n,1),t[e]=i[e]}),o.length&&r&&m(`Untouched keys: ${o.join(", ")}`),e.modified()},e.toJSON=function(){return e.getState()},e}const M={object:(e,t,n)=>function(){return{...t[n.name]}}};function N(e,t,n){n.forEach(n=>{if("object"==typeof n){const r=M[n.type];e[`get${x(n.name)}`]=r?r(e,t,n):()=>t[n.name]}else e[`get${x(n)}`]=()=>t[n]})}const L={enum(e,t,n){const r=`_on${x(n.name)}Changed`;return i=>{if("string"==typeof i){if(void 0!==n.enum[i])return t[n.name]!==n.enum[i]&&(t[n.name]=n.enum[i],e.modified(),!0);throw g(`Set Enum with invalid argument ${n}, ${i}`),new RangeError("Set Enum with invalid string argument")}if("number"==typeof i){if(t[n.name]!==i){if(-1!==Object.keys(n.enum).map(e=>n.enum[e]).indexOf(i)){const o=t[n.name];return t[n.name]=i,t[r]?.(e,t,i,o),e.modified(),!0}throw g(`Set Enum outside numeric range ${n}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw g(`Set Enum with invalid argument (String/Number) ${n}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(e,t,n){const r=`_on${x(n.name)}Changed`;return o=>{if(!i()(t[n.name],o)){const i=t[n.name];return t[n.name]=o,t[r]?.(e,t,o,i),e.modified(),!0}return!1}}};function k(e){if("object"==typeof e){const t=L[e.type];if(t)return(n,r)=>t(n,r,e);throw g(`No setter for field ${e}`),new TypeError("No setter for field")}return function(t,n){const r=`_on${x(e)}Changed`;return function(i){if(n.deleted)return g("instance deleted - cannot call any method"),!1;if(n[e]!==i){const o=n[e.name];return n[e]=i,n[r]?.(t,n,i,o),t.modified(),!0}return!1}}}function F(e,t,n){n.forEach(n=>{"object"==typeof n?e[`set${x(n.name)}`]=k(n)(e,t):e[`set${x(n)}`]=k(n)(e,t)})}function V(e,t,n){N(e,t,n),F(e,t,n)}function U(e,t,n){n.forEach(n=>{e[`get${x(n)}`]=()=>t[n]?Array.from(t[n]):t[n],e[`get${x(n)}ByReference`]=()=>t[n]})}function B(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;n.forEach(n=>{if(t[n]&&r&&t[n].length!==r)throw new RangeError(`Invalid initial number of values for array (${n})`);const o=`_on${x(n)}Changed`;e[`set${x(n)}`]=function(){if(t.deleted)return g("instance deleted - cannot call any method"),!1;for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];let c,u=s,d=!1;if(1===u.length&&(null==u[0]||u[0].length>=0)&&(u=u[0],d=!0),null==u)c=t[n]!==u;else{if(r&&u.length!==r){if(!(u.length<r&&void 0!==i))throw new RangeError(`Invalid number of values for array setter (${n})`);for(u=Array.from(u),d=!1;u.length<r;)u.push(i)}c=null==t[n]||t[n].length!==u.length;for(let e=0;!c&&e<u.length;++e)c=t[n][e]!==u[e];c&&d&&(u=Array.from(u))}if(c){const r=t[n.name];t[n]=u,t[o]?.(e,t,u,r),e.modified()}return c},e[`set${x(n)}From`]=e=>{const r=t[n];e.forEach((e,t)=>{r[t]=e})}})}function G(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;U(e,t,n),B(e,t,n,r,i)}function W(e,t,n){for(let e=0;e<n.length;e++){const r=n[e];void 0!==t[r]&&(t[`_${r}`]=t[r],delete t[r])}}function z(e,t,n,r){function i(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.deleted?g("instance deleted - cannot call any method"):r>=t.numberOfInputs?g(`algorithm ${e.getClassName()} only has ${t.numberOfInputs} input ports. To add more input ports, use addInputData()`):(t.inputData[r]!==n||t.inputConnection[r])&&(t.inputData[r]=n,t.inputConnection[r]=null,e.modified&&e.modified())}function a(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t.deleted)g("instance deleted - cannot call any method");else{if(r>=t.numberOfInputs){let n=`algorithm ${e.getClassName()} only has `;return n+=`${t.numberOfInputs}`,n+=" input ports. To add more input ports, use addInputConnection()",void g(n)}t.inputData[r]=null,t.inputConnection[r]=n}}function s(){let e=t.numberOfInputs;for(;e&&!t.inputData[e-1]&&!t.inputConnection[e-1];)e--;return e===t.numberOfInputs&&t.numberOfInputs++,e}function l(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.deleted?(g("instance deleted - cannot call any method"),null):(e.shouldUpdate()&&e.update(),t.output[n])}if(t.inputData?t.inputData=t.inputData.map(o.Z):t.inputData=[],t.inputConnection?t.inputConnection=t.inputConnection.map(o.Z):t.inputConnection=[],t.output?t.output=t.output.map(o.Z):t.output=[],t.inputArrayToProcess?t.inputArrayToProcess=t.inputArrayToProcess.map(o.Z):t.inputArrayToProcess=[],t.numberOfInputs=n,e.shouldUpdate=()=>{const n=e.getMTime();let i=1/0,o=r;for(;o--;){if(!t.output[o]||t.output[o].isDeleted())return!0;const e=t.output[o].getMTime();if(e<n)return!0;e<i&&(i=e)}for(o=t.numberOfInputs;o--;)if(t.inputConnection[o]?.filter.shouldUpdate()||e.getInputData(o)?.getMTime()>i)return!0;return!1},t.numberOfInputs){let n=t.numberOfInputs;for(;n--;)t.inputData.push(null),t.inputConnection.push(null);e.setInputData=i,e.setInputConnection=a,e.addInputData=function(e){t.deleted?g("instance deleted - cannot call any method"):i(e,s())},e.addInputConnection=function(e){t.deleted?g("instance deleted - cannot call any method"):a(e,s())},e.getInputData=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.inputConnection[e]&&(t.inputData[e]=t.inputConnection[e]()),t.inputData[e]},e.getInputConnection=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.inputConnection[e]}}r&&(e.getOutputData=l,e.getOutputPort=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const n=()=>l(t);return n.filter=e,n}),e.update=()=>{const n=[];if(t.numberOfInputs){let r=0;for(;r<t.numberOfInputs;)n[r]=e.getInputData(r),r++}e.shouldUpdate()&&e.requestData&&e.requestData(n,t.output)},e.getNumberOfInputPorts=()=>t.numberOfInputs,e.getNumberOfOutputPorts=()=>r||t.output.length,e.getInputArrayToProcess=e=>{const n=t.inputArrayToProcess[e],r=t.inputData[e];return n&&r?r[`get${n.fieldAssociation}`]().getArray(n.arrayName):null},e.setInputArrayToProcess=function(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Scalars";for(;t.inputArrayToProcess.length<e;)t.inputArrayToProcess.push(null);t.inputArrayToProcess[e]={arrayName:n,fieldAssociation:r,attributeType:i}}}const H=Symbol("Event abort");function j(e,t,n){const r=[],i=e.delete;let o=1;function a(e){for(let t=0;t<r.length;++t){const[n]=r[t];if(n===e)return void r.splice(t,1)}}e[`invoke${x(n)}`]=function(){if(t.deleted)return void g("instance deleted - cannot call any method");const n=r.slice();for(let t=0;t<n.length;++t){const[,r,i]=n[t];if(r)if(i<0)setTimeout(()=>r.apply(e,arguments),1-i);else{if(r.apply(e,arguments)===H)break}}},e[`on${x(n)}`]=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.apply)return console.error(`Invalid callback for event ${n}`),null;if(t.deleted)return g("instance deleted - cannot call any method"),null;const s=o++;return r.push([s,e,i]),r.sort((e,t)=>t[2]-e[2]),function(e){return Object.freeze({unsubscribe:function(){a(e)}})}(s)},e.delete=()=>{i(),r.forEach(e=>{let[t]=e;return a(t)})}}function Z(e,t){const n=function(){const t={};return e(t,{},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Object.freeze(t)};return t&&o.Z.register(t,n),n}function K(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.filter(e=>!!e).map(e=>e(...n))}}function $(e){return e&&e.isA&&e.isA("vtkObject")}function q(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if($(e)){if(r.indexOf(e)>=0)return n;r.push(e);const i=t(e);void 0!==i&&n.push(i);const o=e.get();Object.keys(o).forEach(e=>{const i=o[e];Array.isArray(i)?i.forEach(e=>{q(e,t,n,r)}):q(i,t,n,r)})}return n}function X(e,t,n){var r=this;let i;const o=function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];const l=r,c=n&&!i;clearTimeout(i),i=setTimeout(()=>{i=null,n||e.apply(l,a)},t),c&&e.apply(l,a)};return o.cancel=()=>clearTimeout(i),o}function Y(e,t){let n=!1,r=null;function i(){n=!1,null!==r&&(o(...r),r=null)}function o(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];n?r=a:(n=!0,e(...a),setTimeout(i,t))}return o}function J(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.keystore=Object.assign(t.keystore||{},n),e.setKey=(e,n)=>{t.keystore[e]=n},e.getKey=e=>t.keystore[e],e.getAllKeys=()=>Object.keys(t.keystore),e.deleteKey=e=>delete t.keystore[e],e.clearKeystore=()=>e.getAllKeys().forEach(e=>delete t.keystore[e])}let Q=1;const ee="__root__";function te(e,t){J(e,t);const n=e.delete;t.proxyId=""+Q++,t.ui=JSON.parse(JSON.stringify(t.ui||[])),N(e,t,["proxyId","proxyGroup","proxyName"]),V(e,t,["proxyManager"]);const r={},i={};function o(e,t){i[t]||(i[t]=[]);const n=i[t];for(let t=0;t<e.length;t++)n.push(e[t].name),r[e[t].name]=e[t],e[t].children&&e[t].children.length&&o(e[t].children,e[t].name)}function a(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee;const r=[],o=t.proxyId,s=function(){return i[arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee]}(n)||[];for(let t=0;t<s.length;t++){const n=s[t],i=e[`get${x(n)}`],l={id:o,name:n,value:i?i():void 0},c=a(n);c.length&&(l.children=c),r.push(l)}return r}o(t.ui,ee),e.updateUI=n=>{t.ui=JSON.parse(JSON.stringify(n||[])),Object.keys(r).forEach(e=>delete r[e]),Object.keys(i).forEach(e=>delete i[e]),o(t.ui,ee),e.modified()},e.updateProxyProperty=(e,t)=>{const n=r[e];n?Object.assign(n,t):r[e]={...t}},e.activate=()=>{if(t.proxyManager){const n=`setActive${x(e.getProxyGroup().slice(0,-1))}`;t.proxyManager[n]&&t.proxyManager[n](e)}},t.propertyLinkSubscribers={},e.registerPropertyLinkForGC=(e,n)=>{n in t.propertyLinkSubscribers||(t.propertyLinkSubscribers[n]=[]),t.propertyLinkSubscribers[n].push(e)},e.gcPropertyLinks=n=>{const r=t.propertyLinkSubscribers[n]||[];for(;r.length;)r.pop().unbind(e)},t.propertyLinkMap={},e.getPropertyLink=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.propertyLinkMap[e])return t.propertyLinkMap[e];let r=null;const i=[];let o=0,a=!1;function s(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a)return null;const l=[];let c=null;for(o=i.length;o--;){const e=i[o];e.instance===n?c=e:l.push(e)}if(!c)return null;const u=c.instance[`get${x(c.propertyName)}`]();if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1}(u,r)||s){for(r=u,a=!0;l.length;){const e=l.pop();e.instance.set({[e.propertyName]:r})}a=!1}return t.propertyLinkMap[e].persistent&&(t.propertyLinkMap[e].value=u),u}function l(e,t){const n=[];for(o=i.length;o--;){const r=i[o];r.instance!==e||r.propertyName!==t&&void 0!==t||(r.subscription.unsubscribe(),n.push(o))}for(;n.length;)i.splice(n.pop(),1)}const c={bind:function(n,r){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=n.onModified(s),c=i[0];return i.push({instance:n,propertyName:r,subscription:a}),o&&(t.propertyLinkMap[e].persistent&&void 0!==t.propertyLinkMap[e].value?n.set({[r]:t.propertyLinkMap[e].value}):c&&s(c.instance,!0)),{unsubscribe:()=>l(n,r)}},unbind:l,unsubscribe:function(){for(;i.length;)i.pop().subscription.unsubscribe()},persistent:n};return t.propertyLinkMap[e]=c,c},e.listPropertyNames=()=>a().map(e=>e.name),e.getPropertyByName=e=>a().find(t=>t.name===e),e.getPropertyDomainByName=e=>(r[e]||{}).domain,e.getProxySection=()=>({id:t.proxyId,name:t.proxyGroup,ui:t.ui,properties:a()}),e.delete=()=>{const r=Object.keys(t.propertyLinkMap);let i=r.length;for(;i--;)t.propertyLinkMap[r[i]].unsubscribe();Object.keys(t.propertyLinkSubscribers).forEach(e.gcPropertyLinks),n()},e.getState=()=>null,P(function(){if(t.links)for(let n=0;n<t.links.length;n++){const{link:r,property:i,persistent:o,updateOnBind:a,type:s}=t.links[n];if("application"===s){const n=t.proxyManager.getPropertyLink(r,o);e.registerPropertyLinkForGC(n,"application"),n.bind(e,i,a)}}})}function ne(e,t,n){const r=e.delete,i=[],o=Object.keys(n);let a=o.length;for(;a--;){const r=o[a],{modelKey:s,property:l,modified:c=!0}=n[r],u=x(l),d=x(r);e[`get${d}`]=t[s][`get${u}`],e[`set${d}`]=t[s][`set${u}`],c&&i.push(t[s].onModified(e.modified))}e.delete=()=>{for(;i.length;)i.pop().unsubscribe();r()}}function re(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};function i(e){const n=Object.keys(e);let r=n.length;for(;r--;){const i=n[r];t[i].set(e[i])}}t.this=e;const o=Object.keys(r);let a=o.length;for(;a--;){const s=o[a];t[s]=r[s];const l=n[s];e[`set${x(s)}`]=n=>{if(n!==t[s]){t[s]=n;i(l[n]),e.modified()}}}o.length&&N(e,t,o)}function ie(e){let t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1===e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:n||t,pixelX:r,pixelY:i||r}}var oe={algo:z,capitalize:T,chain:K,debounce:X,enumToString:function(e,t){return Object.keys(e).find(n=>e[n]===t)},event:j,EVENT_ABORT:H,formatBytesToProperUnit:S,formatNumbersWithThousandSeparator:I,get:N,getArray:U,getCurrentGlobalMTime:function(){return s},getStateArrayMapFunc:A,isVtkObject:$,keystore:J,measurePromiseExecution:O,moveToProtected:W,newInstance:Z,newTypedArray:w,newTypedArrayFrom:E,normalizeWheel:ie,obj:R,proxy:te,proxyPropertyMapping:ne,proxyPropertyState:re,safeArrays:D,set:F,setArray:B,setGet:V,setGetArray:G,setImmediate:P,setLoggerFunction:p,throttle:Y,traverseInstanceTree:q,TYPED_ARRAYS:C,uncapitalize:_,VOID:l,vtkDebugMacro:m,vtkErrorMacro:g,vtkInfoMacro:f,vtkLogMacro:h,vtkOnceErrorMacro:b,vtkWarningMacro:v},ae=Object.freeze({__proto__:null,VOID:l,setLoggerFunction:p,vtkLogMacro:h,vtkInfoMacro:f,vtkDebugMacro:m,vtkErrorMacro:g,vtkWarningMacro:v,vtkOnceErrorMacro:b,TYPED_ARRAYS:C,newTypedArray:w,newTypedArrayFrom:E,capitalize:T,_capitalize:x,uncapitalize:_,formatBytesToProperUnit:S,formatNumbersWithThousandSeparator:I,setImmediateVTK:P,measurePromiseExecution:O,obj:R,get:N,set:F,setGet:V,getArray:U,setArray:B,setGetArray:G,moveToProtected:W,algo:z,EVENT_ABORT:H,event:j,newInstance:Z,chain:K,isVtkObject:$,traverseInstanceTree:q,debounce:X,throttle:Y,keystore:J,proxy:te,proxyPropertyMapping:ne,proxyPropertyState:re,normalizeWheel:ie,default:oe})},99824:(e,t,n)=>{"use strict";n.d(t,{I:()=>i,Z:()=>a});var r=n(7218);const i=n.n(r)()(),o={vtkObject:()=>null};function a(e){if(null==e)return e;if(e.isA)return e;if(!e.vtkClass)return i.console&&i.console.error&&i.console.error("Invalid VTK object"),null;const t=o[e.vtkClass];if(!t)return i.console&&i.console.error&&i.console.error(`No vtk class found for Object of type ${e.vtkClass}`),null;const n={...e};Object.keys(n).forEach(e=>{n[e]&&"object"==typeof n[e]&&n[e].vtkClass&&(n[e]=a(n[e]))});const r=t(n);return r&&r.modified&&r.modified(),r}a.register=function(e,t){o[e]=t}},25686:e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!==i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!==i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=r;0!==i--;){var a=o[i];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n}},30654:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ANGLE_ORDER:()=>a,ARRAY_TYPE:()=>i,EPSILON:()=>r,RANDOM:()=>o,equals:()=>h,round:()=>s,setMatrixArrayType:()=>l,toDegree:()=>p,toRadian:()=>d});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random,a="zyx";function s(e){return e>=0?Math.round(e):e%.5==0?Math.floor(e):Math.round(e)}function l(e){i=e}var c=Math.PI/180,u=180/Math.PI;function d(e){return e*c}function p(e){return e*u}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;return Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))}},72076:(e,t,n)=>{"use strict";n.d(t,{DV:()=>i,wO:()=>o,_E:()=>a,gf:()=>s,K4:()=>r,R3:()=>te,vh:()=>ne});var r={};n.r(r),n.d(r,{add:()=>h,angle:()=>B,ceil:()=>v,clone:()=>c,copy:()=>d,create:()=>l,cross:()=>R,dist:()=>Y,distance:()=>x,div:()=>X,divide:()=>g,dot:()=>O,equals:()=>j,exactEquals:()=>H,floor:()=>y,forEach:()=>ee,fromValues:()=>u,inverse:()=>A,len:()=>K,length:()=>S,lerp:()=>M,max:()=>C,min:()=>b,mul:()=>q,multiply:()=>m,negate:()=>D,normalize:()=>P,random:()=>N,rotate:()=>U,round:()=>w,scale:()=>E,scaleAndAdd:()=>T,set:()=>p,signedAngle:()=>G,sqrDist:()=>J,sqrLen:()=>Q,squaredDistance:()=>_,squaredLength:()=>I,str:()=>z,sub:()=>$,subtract:()=>f,transformMat2:()=>L,transformMat2d:()=>k,transformMat3:()=>F,transformMat4:()=>V,zero:()=>W});var i=n(30654),o=(n(43618),n(97681),n(48689)),a=n(54592),s=n(75771);n(53687);function l(){var e=new i.ARRAY_TYPE(2);return i.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function c(e){var t=new i.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t}function u(e,t){var n=new i.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n}function d(e,t){return e[0]=t[0],e[1]=t[1],e}function p(e,t,n){return e[0]=t,e[1]=n,e}function h(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function m(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function g(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function v(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function y(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function b(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function C(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function w(e,t){return e[0]=i.round(t[0]),e[1]=i.round(t[1]),e}function E(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function T(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function x(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function _(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function S(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function I(e){var t=e[0],n=e[1];return t*t+n*n}function D(e,t){return e[0]=-t[0],e[1]=-t[1],e}function A(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function P(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function O(e,t){return e[0]*t[0]+e[1]*t[1]}function R(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function M(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}function N(e,t){t=void 0===t?1:t;var n=2*i.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function L(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e}function k(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e}function F(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}function V(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}function U(e,t,n,r){var i=t[0]-n[0],o=t[1]-n[1],a=Math.sin(r),s=Math.cos(r);return e[0]=i*s-o*a+n[0],e[1]=i*a+o*s+n[1],e}function B(e,t){var n=e[0],r=e[1],i=t[0],o=t[1];return Math.abs(Math.atan2(r*i-n*o,n*i+r*o))}function G(e,t){var n=e[0],r=e[1],i=t[0],o=t[1];return Math.atan2(n*o-r*i,n*i+r*o)}function W(e){return e[0]=0,e[1]=0,e}function z(e){return"vec2("+e[0]+", "+e[1]+")"}function H(e,t){return e[0]===t[0]&&e[1]===t[1]}function j(e,t){var n=e[0],r=e[1],o=t[0],a=t[1];return Math.abs(n-o)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))}var Z,K=S,$=f,q=m,X=g,Y=x,J=_,Q=I,ee=(Z=l(),function(e,t,n,r,i,o){var a,s;for(t||(t=2),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)Z[0]=e[a],Z[1]=e[a+1],i(Z,Z,o),e[a]=Z[0],e[a+1]=Z[1];return e}),te=n(66477),ne=n(74572)},48689:(e,t,n)=>{"use strict";n.r(t),n.d(t,{add:()=>D,adjoint:()=>h,clone:()=>a,copy:()=>s,create:()=>i,determinant:()=>f,equals:()=>M,exactEquals:()=>R,frob:()=>I,fromMat2d:()=>E,fromMat4:()=>o,fromQuat:()=>T,fromRotation:()=>C,fromScaling:()=>w,fromTranslation:()=>b,fromValues:()=>l,identity:()=>u,invert:()=>p,mul:()=>N,multiply:()=>m,multiplyScalar:()=>P,multiplyScalarAndAdd:()=>O,normalFromMat4:()=>x,projection:()=>_,rotate:()=>v,scale:()=>y,set:()=>c,str:()=>S,sub:()=>L,subtract:()=>A,translate:()=>g,transpose:()=>d});var r=n(30654);function i(){var e=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function a(e){var t=new r.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function l(e,t,n,i,o,a,s,l,c){var u=new r.ARRAY_TYPE(9);return u[0]=e,u[1]=t,u[2]=n,u[3]=i,u[4]=o,u[5]=a,u[6]=s,u[7]=l,u[8]=c,u}function c(e,t,n,r,i,o,a,s,l,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e}function u(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function d(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function p(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=u*a-s*c,p=-u*o+s*l,h=c*o-a*l,f=n*d+r*p+i*h;return f?(f=1/f,e[0]=d*f,e[1]=(-u*r+i*c)*f,e[2]=(s*r-i*a)*f,e[3]=p*f,e[4]=(u*n-i*l)*f,e[5]=(-s*n+i*o)*f,e[6]=h*f,e[7]=(-c*n+r*l)*f,e[8]=(a*n-r*o)*f,e):null}function h(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-s*c,e[1]=i*c-r*u,e[2]=r*s-i*a,e[3]=s*l-o*u,e[4]=n*u-i*l,e[5]=i*o-n*s,e[6]=o*c-a*l,e[7]=r*l-n*c,e[8]=n*a-r*o,e}function f(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*(c*o-a*l)+n*(-c*i+a*s)+r*(l*i-o*s)}function m(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=n[0],h=n[1],f=n[2],m=n[3],g=n[4],v=n[5],y=n[6],b=n[7],C=n[8];return e[0]=p*r+h*a+f*c,e[1]=p*i+h*s+f*u,e[2]=p*o+h*l+f*d,e[3]=m*r+g*a+v*c,e[4]=m*i+g*s+v*u,e[5]=m*o+g*l+v*d,e[6]=y*r+b*a+C*c,e[7]=y*i+b*s+C*u,e[8]=y*o+b*l+C*d,e}function g(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=n[0],h=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=p*r+h*a+c,e[7]=p*i+h*s+u,e[8]=p*o+h*l+d,e}function v(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=Math.sin(n),h=Math.cos(n);return e[0]=h*r+p*a,e[1]=h*i+p*s,e[2]=h*o+p*l,e[3]=h*a-p*r,e[4]=h*s-p*i,e[5]=h*l-p*o,e[6]=c,e[7]=u,e[8]=d,e}function y(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function b(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function C(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function w(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function E(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function T(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,l=i+i,c=n*a,u=r*a,d=r*s,p=i*a,h=i*s,f=i*l,m=o*a,g=o*s,v=o*l;return e[0]=1-d-f,e[3]=u-v,e[6]=p+g,e[1]=u+v,e[4]=1-c-f,e[7]=h-m,e[2]=p-g,e[5]=h+m,e[8]=1-c-d,e}function x(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=n*s-r*a,b=n*l-i*a,C=n*c-o*a,w=r*l-i*s,E=r*c-o*s,T=i*c-o*l,x=u*m-d*f,_=u*g-p*f,S=u*v-h*f,I=d*g-p*m,D=d*v-h*m,A=p*v-h*g,P=y*A-b*D+C*I+w*S-E*_+T*x;return P?(P=1/P,e[0]=(s*A-l*D+c*I)*P,e[1]=(l*S-a*A-c*_)*P,e[2]=(a*D-s*S+c*x)*P,e[3]=(i*D-r*A-o*I)*P,e[4]=(n*A-i*S+o*_)*P,e[5]=(r*S-n*D-o*x)*P,e[6]=(m*T-g*E+v*w)*P,e[7]=(g*C-f*T-v*b)*P,e[8]=(f*E-m*C+v*y)*P,e):null}function _(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function S(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function I(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8])}function D(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function A(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function P(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function O(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function R(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function M(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=t[0],h=t[1],f=t[2],m=t[3],g=t[4],v=t[5],y=t[6],b=t[7],C=t[8];return Math.abs(n-p)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(i-h)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-g)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-v)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-y)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-b)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-C)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))}var N=m,L=A},75771:(e,t,n)=>{"use strict";n.r(t),n.d(t,{add:()=>O,calculateW:()=>g,clone:()=>I,conjugate:()=>T,copy:()=>A,create:()=>s,dot:()=>N,equals:()=>W,exactEquals:()=>G,exp:()=>v,fromEuler:()=>_,fromMat3:()=>x,fromValues:()=>D,getAngle:()=>d,getAxisAngle:()=>u,identity:()=>l,invert:()=>E,len:()=>F,length:()=>k,lerp:()=>L,ln:()=>y,mul:()=>R,multiply:()=>p,normalize:()=>B,pow:()=>b,random:()=>w,rotateX:()=>h,rotateY:()=>f,rotateZ:()=>m,rotationTo:()=>q,scale:()=>M,set:()=>P,setAxes:()=>Y,setAxisAngle:()=>c,slerp:()=>C,sqlerp:()=>X,sqrLen:()=>U,squaredLength:()=>V,str:()=>S});var r=n(30654),i=n(48689),o=n(66477),a=n(74572);function s(){var e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function l(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function c(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function u(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>r.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function d(e,t){var n=N(e,t);return Math.acos(2*n*n-1)}function p(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*u+a*s+i*c-o*l,e[1]=i*u+a*l+o*s-r*c,e[2]=o*u+a*c+r*l-i*s,e[3]=a*u-r*s-i*l-o*c,e}function h(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+a*s,e[1]=i*l+o*s,e[2]=o*l-i*s,e[3]=a*l-r*s,e}function f(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l-o*s,e[1]=i*l+a*s,e[2]=o*l+r*s,e[3]=a*l-i*s,e}function m(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*s,e[1]=i*l-r*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e}function g(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}function v(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=Math.sqrt(n*n+r*r+i*i),s=Math.exp(o),l=a>0?s*Math.sin(a)/a:0;return e[0]=n*l,e[1]=r*l,e[2]=i*l,e[3]=s*Math.cos(a),e}function y(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=Math.sqrt(n*n+r*r+i*i),s=a>0?Math.atan2(a,o)/a:0;return e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=.5*Math.log(n*n+r*r+i*i+o*o),e}function b(e,t,n){return y(e,t),M(e,e,n),v(e,e),e}function C(e,t,n,i){var o,a,s,l,c,u=t[0],d=t[1],p=t[2],h=t[3],f=n[0],m=n[1],g=n[2],v=n[3];return(a=u*f+d*m+p*g+h*v)<0&&(a=-a,f=-f,m=-m,g=-g,v=-v),1-a>r.EPSILON?(o=Math.acos(a),s=Math.sin(o),l=Math.sin((1-i)*o)/s,c=Math.sin(i*o)/s):(l=1-i,c=i),e[0]=l*u+c*f,e[1]=l*d+c*m,e[2]=l*p+c*g,e[3]=l*h+c*v,e}function w(e){var t=r.RANDOM(),n=r.RANDOM(),i=r.RANDOM(),o=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=o*Math.sin(2*Math.PI*n),e[1]=o*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e}function E(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e}function T(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function x(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*o+a]-t[3*a+o])*n,e[o]=(t[3*o+i]+t[3*i+o])*n,e[a]=(t[3*a+i]+t[3*i+a])*n}return e}function _(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.ANGLE_ORDER,a=Math.PI/360;t*=a,i*=a,n*=a;var s=Math.sin(t),l=Math.cos(t),c=Math.sin(n),u=Math.cos(n),d=Math.sin(i),p=Math.cos(i);switch(o){case"xyz":e[0]=s*u*p+l*c*d,e[1]=l*c*p-s*u*d,e[2]=l*u*d+s*c*p,e[3]=l*u*p-s*c*d;break;case"xzy":e[0]=s*u*p-l*c*d,e[1]=l*c*p-s*u*d,e[2]=l*u*d+s*c*p,e[3]=l*u*p+s*c*d;break;case"yxz":e[0]=s*u*p+l*c*d,e[1]=l*c*p-s*u*d,e[2]=l*u*d-s*c*p,e[3]=l*u*p+s*c*d;break;case"yzx":e[0]=s*u*p+l*c*d,e[1]=l*c*p+s*u*d,e[2]=l*u*d-s*c*p,e[3]=l*u*p-s*c*d;break;case"zxy":e[0]=s*u*p-l*c*d,e[1]=l*c*p+s*u*d,e[2]=l*u*d+s*c*p,e[3]=l*u*p-s*c*d;break;case"zyx":e[0]=s*u*p-l*c*d,e[1]=l*c*p+s*u*d,e[2]=l*u*d-s*c*p,e[3]=l*u*p+s*c*d;break;default:throw new Error("Unknown angle order "+o)}return e}function S(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var I=a.clone,D=a.fromValues,A=a.copy,P=a.set,O=a.add,R=p,M=a.scale,N=a.dot,L=a.lerp,k=a.length,F=k,V=a.squaredLength,U=V,B=a.normalize,G=a.exactEquals;function W(e,t){return Math.abs(a.dot(e,t))>=1-r.EPSILON}var z,H,j,Z,K,$,q=(z=o.create(),H=o.fromValues(1,0,0),j=o.fromValues(0,1,0),function(e,t,n){var r=o.dot(t,n);return r<-.999999?(o.cross(z,H,t),o.len(z)<1e-6&&o.cross(z,j,t),o.normalize(z,z),c(e,z,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.cross(z,t,n),e[0]=z[0],e[1]=z[1],e[2]=z[2],e[3]=1+r,B(e,e))}),X=(Z=s(),K=s(),function(e,t,n,r,i,o){return C(Z,t,i,o),C(K,n,r,o),C(e,Z,K,2*o*(1-o)),e}),Y=($=i.create(),function(e,t,n,r){return $[0]=n[0],$[3]=n[1],$[6]=n[2],$[1]=r[0],$[4]=r[1],$[7]=r[2],$[2]=-t[0],$[5]=-t[1],$[8]=-t[2],B(e,x(e,$))})},74572:(e,t,n)=>{"use strict";n.r(t),n.d(t,{add:()=>c,ceil:()=>h,clone:()=>o,copy:()=>s,create:()=>i,cross:()=>D,dist:()=>G,distance:()=>C,div:()=>B,divide:()=>p,dot:()=>I,equals:()=>k,exactEquals:()=>L,floor:()=>f,forEach:()=>j,fromValues:()=>a,inverse:()=>_,len:()=>z,length:()=>E,lerp:()=>A,max:()=>g,min:()=>m,mul:()=>U,multiply:()=>d,negate:()=>x,normalize:()=>S,random:()=>P,round:()=>v,scale:()=>y,scaleAndAdd:()=>b,set:()=>l,sqrDist:()=>W,sqrLen:()=>H,squaredDistance:()=>w,squaredLength:()=>T,str:()=>N,sub:()=>V,subtract:()=>u,transformMat4:()=>O,transformQuat:()=>R,zero:()=>M});var r=n(30654);function i(){var e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function o(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,n,i){var o=new r.ARRAY_TYPE(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function l(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function u(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function d(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function p(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function h(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function f(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function m(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function g(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function v(e,t){return e[0]=r.round(t[0]),e[1]=r.round(t[1]),e[2]=r.round(t[2]),e[3]=r.round(t[3]),e}function y(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function b(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function C(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+o*o)}function w(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function E(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function T(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function x(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function _(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function S(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a,e}function I(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function D(e,t,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],l=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],u=t[0],d=t[1],p=t[2],h=t[3];return e[0]=d*c-p*l+h*s,e[1]=-u*c+p*a-h*o,e[2]=u*l-d*a+h*i,e[3]=-u*s+d*o-p*i,e}function A(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e[3]=s+r*(n[3]-s),e}function P(e,t){var n,i,o,a,s,l,c;t=void 0===t?1:t,s=(n=2*(c=r.RANDOM())-1)*n+(i=(4*r.RANDOM()-2)*Math.sqrt(c*-c+c))*i,l=(o=2*(c=r.RANDOM())-1)*o+(a=(4*r.RANDOM()-2)*Math.sqrt(c*-c+c))*a;var u=Math.sqrt((1-s)/l);return e[0]=t*n,e[1]=t*i,e[2]=t*o*u,e[3]=t*a*u,e}function O(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}function R(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],l=t[1],c=t[2],u=i*c-o*l,d=o*s-r*c,p=r*l-i*s;return u+=u,d+=d,p+=p,e[0]=s+a*u+i*p-o*d,e[1]=l+a*d+o*u-r*p,e[2]=c+a*p+r*d-i*u,e[3]=t[3],e}function M(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function N(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function L(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function k(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))}var F,V=u,U=d,B=p,G=C,W=w,z=E,H=T,j=(F=i(),function(e,t,n,r,i,o){var a,s;for(t||(t=4),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)F[0]=e[a],F[1]=e[a+1],F[2]=e[a+2],F[3]=e[a+3],i(F,F,o),e[a]=F[0],e[a+1]=F[1],e[a+2]=F[2],e[a+3]=F[3];return e})},11677:(e,t,n)=>{e=n.nmd(e);var r="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",a="[object Boolean]",s="[object Date]",l="[object Function]",c="[object GeneratorFunction]",u="[object Map]",d="[object Number]",p="[object Object]",h="[object Promise]",f="[object RegExp]",m="[object Set]",g="[object String]",v="[object Symbol]",y="[object WeakMap]",b="[object ArrayBuffer]",C="[object DataView]",w="[object Float32Array]",E="[object Float64Array]",T="[object Int8Array]",x="[object Int16Array]",_="[object Int32Array]",S="[object Uint8Array]",I="[object Uint8ClampedArray]",D="[object Uint16Array]",A="[object Uint32Array]",P=/\w*$/,O=/^\[object .+?Constructor\]$/,R=/^(?:0|[1-9]\d*)$/,M={};M[o]=M["[object Array]"]=M[b]=M[C]=M[a]=M[s]=M[w]=M[E]=M[T]=M[x]=M[_]=M[u]=M[d]=M[p]=M[f]=M[m]=M[g]=M[v]=M[S]=M[I]=M[D]=M[A]=!0,M["[object Error]"]=M[l]=M[y]=!1;var N="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,L="object"==typeof self&&self&&self.Object===Object&&self,k=N||L||Function("return this")(),F=t&&!t.nodeType&&t,V=F&&e&&!e.nodeType&&e,U=V&&V.exports===F;function B(e,t){return e.set(t[0],t[1]),e}function G(e,t){return e.add(t),e}function W(e,t,n,r){var i=-1,o=e?e.length:0;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function z(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function H(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function j(e,t){return function(n){return e(t(n))}}function Z(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var K,$=Array.prototype,q=Function.prototype,X=Object.prototype,Y=k["__core-js_shared__"],J=(K=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",Q=q.toString,ee=X.hasOwnProperty,te=X.toString,ne=RegExp("^"+Q.call(ee).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),re=U?k.Buffer:void 0,ie=k.Symbol,oe=k.Uint8Array,ae=j(Object.getPrototypeOf,Object),se=Object.create,le=X.propertyIsEnumerable,ce=$.splice,ue=Object.getOwnPropertySymbols,de=re?re.isBuffer:void 0,pe=j(Object.keys,Object),he=Ve(k,"DataView"),fe=Ve(k,"Map"),me=Ve(k,"Promise"),ge=Ve(k,"Set"),ve=Ve(k,"WeakMap"),ye=Ve(Object,"create"),be=ze(he),Ce=ze(fe),we=ze(me),Ee=ze(ge),Te=ze(ve),xe=ie?ie.prototype:void 0,_e=xe?xe.valueOf:void 0;function Se(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function De(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ae(e){this.__data__=new Ie(e)}function Pe(e,t){var n=je(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ze(e)}(e)&&ee.call(e,"callee")&&(!le.call(e,"callee")||te.call(e)==o)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,i=!!r;for(var a in e)!t&&!ee.call(e,a)||i&&("length"==a||Ge(a,r))||n.push(a);return n}function Oe(e,t,n){var r=e[t];ee.call(e,t)&&He(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function Re(e,t){for(var n=e.length;n--;)if(He(e[n][0],t))return n;return-1}function Me(e,t,n,r,i,h,y){var O;if(r&&(O=h?r(e,i,h,y):r(e)),void 0!==O)return O;if(!qe(e))return e;var R=je(e);if(R){if(O=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&ee.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,O)}else{var N=Be(e),L=N==l||N==c;if(Ke(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(N==p||N==o||L&&!h){if(z(e))return h?e:{};if(O=function(e){return"function"!=typeof e.constructor||We(e)?{}:(t=ae(e),qe(t)?se(t):{});var t}(L?{}:e),!t)return function(e,t){return ke(e,Ue(e),t)}(e,function(e,t){return e&&ke(t,Xe(t),e)}(O,e))}else{if(!M[N])return h?e:{};O=function(e,t,n,r){var i=e.constructor;switch(t){case b:return Le(e);case a:case s:return new i(+e);case C:return function(e,t){var n=t?Le(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case w:case E:case T:case x:case _:case S:case I:case D:case A:return function(e,t){var n=t?Le(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case u:return function(e,t,n){var r=t?n(H(e),!0):H(e);return W(r,B,new e.constructor)}(e,r,n);case d:case g:return new i(e);case f:return function(e){var t=new e.constructor(e.source,P.exec(e));return t.lastIndex=e.lastIndex,t}(e);case m:return function(e,t,n){var r=t?n(Z(e),!0):Z(e);return W(r,G,new e.constructor)}(e,r,n);case v:return o=e,_e?Object(_e.call(o)):{}}var o}(e,N,Me,t)}}y||(y=new Ae);var k=y.get(e);if(k)return k;if(y.set(e,O),!R)var F=n?function(e){return function(e,t,n){var r=t(e);return je(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,Xe,Ue)}(e):Xe(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(F||e,function(i,o){F&&(i=e[o=i]),Oe(O,o,Me(i,t,n,r,o,e,y))}),O}function Ne(e){return!(!qe(e)||(t=e,J&&J in t))&&($e(e)||z(e)?ne:O).test(ze(e));var t}function Le(e){var t=new e.constructor(e.byteLength);return new oe(t).set(new oe(e)),t}function ke(e,t,n,r){n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],s=r?r(n[a],e[a],a,n,e):void 0;Oe(n,a,void 0===s?e[a]:s)}return n}function Fe(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Ve(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Ne(n)?n:void 0}Se.prototype.clear=function(){this.__data__=ye?ye(null):{}},Se.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Se.prototype.get=function(e){var t=this.__data__;if(ye){var n=t[e];return n===r?void 0:n}return ee.call(t,e)?t[e]:void 0},Se.prototype.has=function(e){var t=this.__data__;return ye?void 0!==t[e]:ee.call(t,e)},Se.prototype.set=function(e,t){return this.__data__[e]=ye&&void 0===t?r:t,this},Ie.prototype.clear=function(){this.__data__=[]},Ie.prototype.delete=function(e){var t=this.__data__,n=Re(t,e);return!(n<0)&&(n==t.length-1?t.pop():ce.call(t,n,1),!0)},Ie.prototype.get=function(e){var t=this.__data__,n=Re(t,e);return n<0?void 0:t[n][1]},Ie.prototype.has=function(e){return Re(this.__data__,e)>-1},Ie.prototype.set=function(e,t){var n=this.__data__,r=Re(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},De.prototype.clear=function(){this.__data__={hash:new Se,map:new(fe||Ie),string:new Se}},De.prototype.delete=function(e){return Fe(this,e).delete(e)},De.prototype.get=function(e){return Fe(this,e).get(e)},De.prototype.has=function(e){return Fe(this,e).has(e)},De.prototype.set=function(e,t){return Fe(this,e).set(e,t),this},Ae.prototype.clear=function(){this.__data__=new Ie},Ae.prototype.delete=function(e){return this.__data__.delete(e)},Ae.prototype.get=function(e){return this.__data__.get(e)},Ae.prototype.has=function(e){return this.__data__.has(e)},Ae.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ie){var r=n.__data__;if(!fe||r.length<199)return r.push([e,t]),this;n=this.__data__=new De(r)}return n.set(e,t),this};var Ue=ue?j(ue,Object):function(){return[]},Be=function(e){return te.call(e)};function Ge(e,t){return!!(t=null==t?i:t)&&("number"==typeof e||R.test(e))&&e>-1&&e%1==0&&e<t}function We(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||X)}function ze(e){if(null!=e){try{return Q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function He(e,t){return e===t||e!=e&&t!=t}(he&&Be(new he(new ArrayBuffer(1)))!=C||fe&&Be(new fe)!=u||me&&Be(me.resolve())!=h||ge&&Be(new ge)!=m||ve&&Be(new ve)!=y)&&(Be=function(e){var t=te.call(e),n=t==p?e.constructor:void 0,r=n?ze(n):void 0;if(r)switch(r){case be:return C;case Ce:return u;case we:return h;case Ee:return m;case Te:return y}return t});var je=Array.isArray;function Ze(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}(e.length)&&!$e(e)}var Ke=de||function(){return!1};function $e(e){var t=qe(e)?te.call(e):"";return t==l||t==c}function qe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Xe(e){return Ze(e)?Pe(e):function(e){if(!We(e))return pe(e);var t=[];for(var n in Object(e))ee.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}e.exports=function(e){return Me(e,!0,!0)}},53775:(e,t,n)=>{var r=n(99438),i=n(85494),o=n(13106),a=n(67516),s=n(89155),l=n(8121),c=n(15570);c.alea=r,c.xor128=i,c.xorwow=o,c.xorshift7=a,c.xor4096=s,c.tychei=l,e.exports=c},20840:e=>{e.exports=function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[0]-680876936|0)<<7|n>>>25)+r|0)&r|~n&i)+t[1]-389564586|0)<<12|o>>>20)+n|0)&n|~o&r)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&n)+t[3]-1044525330|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[4]-176418897|0)<<7|n>>>25)+r|0)&r|~n&i)+t[5]+1200080426|0)<<12|o>>>20)+n|0)&n|~o&r)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&n)+t[7]-45705983|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[8]+1770035416|0)<<7|n>>>25)+r|0)&r|~n&i)+t[9]-1958414417|0)<<12|o>>>20)+n|0)&n|~o&r)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&n)+t[11]-1990404162|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&i|~r&o)+t[12]+1804603682|0)<<7|n>>>25)+r|0)&r|~n&i)+t[13]-40341101|0)<<12|o>>>20)+n|0)&n|~o&r)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&n)+t[15]+1236535329|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[1]-165796510|0)<<5|n>>>27)+r|0)&i|r&~i)+t[6]-1069501632|0)<<9|o>>>23)+n|0)&r|n&~r)+t[11]+643717713|0)<<14|i>>>18)+o|0)&n|o&~n)+t[0]-373897302|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[5]-701558691|0)<<5|n>>>27)+r|0)&i|r&~i)+t[10]+38016083|0)<<9|o>>>23)+n|0)&r|n&~r)+t[15]-660478335|0)<<14|i>>>18)+o|0)&n|o&~n)+t[4]-405537848|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[9]+568446438|0)<<5|n>>>27)+r|0)&i|r&~i)+t[14]-1019803690|0)<<9|o>>>23)+n|0)&r|n&~r)+t[3]-187363961|0)<<14|i>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r&o|i&~o)+t[13]-1444681467|0)<<5|n>>>27)+r|0)&i|r&~i)+t[2]-51403784|0)<<9|o>>>23)+n|0)&r|n&~r)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[5]-378558|0)<<4|n>>>28)+r|0)^r^i)+t[8]-2022574463|0)<<11|o>>>21)+n|0)^n^r)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^n)+t[14]-35309556|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[1]-1530992060|0)<<4|n>>>28)+r|0)^r^i)+t[4]+1272893353|0)<<11|o>>>21)+n|0)^n^r)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^n)+t[10]-1094730640|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[13]+681279174|0)<<4|n>>>28)+r|0)^r^i)+t[0]-358537222|0)<<11|o>>>21)+n|0)^n^r)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^n)+t[6]+76029189|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((o=((o+=((n=((n+=(r^i^o)+t[9]-640364487|0)<<4|n>>>28)+r|0)^r^i)+t[12]-421815835|0)<<11|o>>>21)+n|0)^n^r)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^n)+t[2]-995338651|0)<<23|r>>>9)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[0]-198630844|0)<<6|n>>>26)+r|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~n))+t[5]-57434055|0)<<21|r>>>11)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[12]+1700485571|0)<<6|n>>>26)+r|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~n))+t[1]-2054922799|0)<<21|r>>>11)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[8]+1873313359|0)<<6|n>>>26)+r|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~n))+t[13]+1309151649|0)<<21|r>>>11)+i|0,r=((r+=((o=((o+=(r^((n=((n+=(i^(r|~o))+t[4]-145523070|0)<<6|n>>>26)+r|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~r))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function i(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function o(e){var t,i,o,a,s,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(u,r(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(u,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,n(u,o),u}function a(e){var t,r,o,a,s,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(u,i(e.subarray(t-64,t)));for(r=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(u,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,o[14]=s,o[15]=l,n(u,o),u}function s(e){var n,r="";for(n=0;n<4;n+=1)r+=t[e>>8*n+4&15]+t[e>>8*n&15];return r}function l(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function c(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e,t){var n,r=e.length,i=new ArrayBuffer(r),o=new Uint8Array(i);for(n=0;n<r;n+=1)o[n]=e.charCodeAt(n);return t?o:i}function d(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function p(e,t,n){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),n?r:r.buffer}function h(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function f(){this.reset()}return l(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,r){var i,o,a,s,l=this.byteLength,c=t(n,l),u=l;return r!==e&&(u=t(r,l)),c>u?new ArrayBuffer(0):(i=u-c,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,c,i),a.set(s),o)}}(),f.prototype.append=function(e){return this.appendBinary(c(e)),this},f.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)n(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},f.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),n=l(this._hash),e&&(n=h(n)),this.reset(),n},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},f.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(e,t){var r,i,o,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(n(this._hash,e),a=0;a<16;a+=1)e[a]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=i,e[15]=o,n(this._hash,e)},f.hash=function(e,t){return f.hashBinary(c(e),t)},f.hashBinary=function(e,t){var n=l(o(e));return t?h(n):n},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(e){var t,r=p(this._buff.buffer,e,!0),o=r.length;for(this._length+=e.byteLength,t=64;t<=o;t+=64)n(this._hash,i(r.subarray(t-64,t)));return this._buff=t-64<o?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,i),n=l(this._hash),e&&(n=h(n)),this.reset(),n},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var e=f.prototype.getState.call(this);return e.buff=d(e.buff),e},f.ArrayBuffer.prototype.setState=function(e){return e.buff=u(e.buff,!0),f.prototype.setState.call(this,e)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(e,t){var n=l(a(new Uint8Array(e)));return t?h(n):n},f}()},39053:function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=184)}([function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(240)),r(n(251)),r(n(175)),r(n(107)),r(n(29)),r(n(73)),r(n(106)),r(n(30)),r(n(252)),r(n(52)),r(n(97)),r(n(253)),r(n(37)),r(n(51)),r(n(173)),r(n(176)),r(n(172)),r(n(108)),r(n(254)),r(n(255)),r(n(256)),r(n(72)),r(n(177)),r(n(105)),r(n(17)),r(n(257)),r(n(12)),r(n(174))},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(212);t.FixedSizeSet=i.FixedSizeSet;var o=n(213);t.ObjectCache=o.ObjectCache;var a=n(214);t.CompareCache=a.CompareCache;var s=n(215);t.Lazy=s.Lazy;var l=n(216);function c(e,t,n){if(m(e))e.forEach(function(e,r){return t.call(n,r,e)});else for(var r in e)e.hasOwnProperty(r)&&t.call(n,r,e[r])}function u(e){var t,n;if(d(e))return e;if(h(e)){var i=[];try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var s=a.value;i.push(u(s))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}if(p(e)){for(var l in i={},e)if(e.hasOwnProperty(l)){var c=e[l];i[l]=u(c)}return i}return e}function d(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)}function p(e){var t=typeof e;return!!e&&("function"===t||"object"===t)}function h(e){return Array.isArray(e)}function f(e){return e instanceof Set}function m(e){return e instanceof Map}function g(e){if(p(e)){var t=Object.getPrototypeOf(e),n=t.constructor;return t&&n&&"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)}return!1}t.StringWalker=l.StringWalker,t.applyMixin=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];Object.getOwnPropertyNames(t.prototype).forEach(function(r){if("constructor"!==r){if(-1!==n.indexOf(r)){var i=Object.getOwnPropertyDescriptor(e.prototype,r);i&&Object.defineProperty(e.prototype,"_"+r,i)}var o=Object.getOwnPropertyDescriptor(t.prototype,r);o&&Object.defineProperty(e.prototype,r,o)}})},t.applyDefaults=function e(t,n,r){void 0===r&&(r=!1);var i=u(t||{});return c(n,function(t,n){g(n)?i[t]=e(i[t],n,r):(r||void 0===i[t])&&(i[t]=n)}),i},t.forEachArray=function(e,t,n){e.forEach(t,n)},t.forEachObject=c,t.arrayLength=function(e){return f(e)?e.size:e.length},t.objectLength=function(e){return m(e)?e.size:Object.keys(e).length},t.getObjectValue=function(e,t){return m(e)?e.get(t):e[t]},t.removeObjectValue=function(e,t){m(e)?e.delete(t):delete e[t]},t.clone=u,t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isFunction=d,t.isObject=p,t.isArray=h,t.isSet=f,t.isMap=m,t.isEmpty=function(e){if(h(e))return!e.length;if(f(e))return!e.size;if(m(e))return!e.size;if(p(e)){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},t.isPlainObject=g,t.isIterable=function(e){return e&&"function"==typeof e[Symbol.iterator]},t.getValue=function(e){return d(e.valueOf)?e.valueOf():e},t.utf8Encode=function(e){for(var t=new Uint8Array(4*e.length),n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i<128)t[n++]=i;else{if(i<2048)t[n++]=i>>6|192;else{if(i>55295&&i<56320){if(++r>=e.length)throw new Error("Incomplete surrogate pair.");var o=e.charCodeAt(r);if(o<56320||o>57343)throw new Error("Invalid surrogate character.");i=65536+((1023&i)<<10)+(1023&o),t[n++]=i>>18|240,t[n++]=i>>12&63|128}else t[n++]=i>>12|224;t[n++]=i>>6&63|128}t[n++]=63&i|128}}return t.subarray(0,n)},t.utf8Decode=function(e){for(var t="",n=0;n<e.length;){var r=e[n++];if(r>127)if(r>191&&r<224){if(n>=e.length)throw new Error("Incomplete 2-byte sequence.");r=(31&r)<<6|63&e[n++]}else if(r>223&&r<240){if(n+1>=e.length)throw new Error("Incomplete 3-byte sequence.");r=(15&r)<<12|(63&e[n++])<<6|63&e[n++]}else{if(!(r>239&&r<248))throw new Error("Unknown multi-byte start.");if(n+2>=e.length)throw new Error("Incomplete 4-byte sequence.");r=(7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++]}if(r<=65535)t+=String.fromCharCode(r);else{if(!(r<=1114111))throw new Error("Code point exceeds UTF-16 limit.");r-=65536,t+=String.fromCharCode(r>>10|55296),t+=String.fromCharCode(1023&r|56320)}}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Before=0]="Before",e[e.Equal=1]="Equal",e[e.After=2]="After"}(t.BoundaryPosition||(t.BoundaryPosition={})),function(e){e[e.None=0]="None",e[e.Capturing=1]="Capturing",e[e.AtTarget=2]="AtTarget",e[e.Bubbling=3]="Bubbling"}(t.EventPhase||(t.EventPhase={})),function(e){e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=3]="Text",e[e.CData=4]="CData",e[e.EntityReference=5]="EntityReference",e[e.Entity=6]="Entity",e[e.ProcessingInstruction=7]="ProcessingInstruction",e[e.Comment=8]="Comment",e[e.Document=9]="Document",e[e.DocumentType=10]="DocumentType",e[e.DocumentFragment=11]="DocumentFragment",e[e.Notation=12]="Notation"}(t.NodeType||(t.NodeType={})),function(e){e[e.Disconnected=1]="Disconnected",e[e.Preceding=2]="Preceding",e[e.Following=4]="Following",e[e.Contains=8]="Contains",e[e.ContainedBy=16]="ContainedBy",e[e.ImplementationSpecific=32]="ImplementationSpecific"}(t.Position||(t.Position={})),function(e){e[e.Accept=1]="Accept",e[e.Reject=2]="Reject",e[e.Skip=3]="Skip"}(t.FilterResult||(t.FilterResult={})),function(e){e[e.All=4294967295]="All",e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=4]="Text",e[e.CDataSection=8]="CDataSection",e[e.EntityReference=16]="EntityReference",e[e.Entity=32]="Entity",e[e.ProcessingInstruction=64]="ProcessingInstruction",e[e.Comment=128]="Comment",e[e.Document=256]="Document",e[e.DocumentType=512]="DocumentType",e[e.DocumentFragment=1024]="DocumentFragment",e[e.Notation=2048]="Notation"}(t.WhatToShow||(t.WhatToShow={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToEnd=2]="EndToEnd",e[e.EndToStart=3]="EndToStart"}(t.HowToCompare||(t.HowToCompare={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(241);t.Cast=r.Cast;var i=n(150);t.Guard=i.Guard;var o=n(242);t.EmptySet=o.EmptySet},function(e,t,n){var r=n(11),i=n(55).f,o=n(21),a=n(25),s=n(80),l=n(119),c=n(123);e.exports=function(e,t){var n,u,d,p,h,f=e.target,m=e.global,g=e.stat;if(n=m?r:g?r[f]||s(f,{}):(r[f]||{}).prototype)for(u in t){if(p=t[u],d=e.noTargetGet?(h=i(n,u))&&h.value:n[u],!c(m?u:f+(g?".":"#")+u,e.forced)&&void 0!==d){if(typeof p==typeof d)continue;l(p,d)}(e.sham||d&&d.sham)&&o(p,"sham",!0),a(n,u,p,e)}}},function(e,t,n){var r=n(11),i=n(81),o=n(14),a=n(58),s=n(86),l=n(124),c=i("wks"),u=r.Symbol,d=l?u:u&&u.withoutSetter||a;e.exports=function(e){return o(c,e)||(s&&o(u,e)?c[e]=u[e]:c[e]=d("Symbol."+e)),c[e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(29),o=function(){function e(){this._features={mutationObservers:!0,customElements:!0,slots:!0,steps:!0},this._window=null,this._compareCache=new r.CompareCache,this._rangeList=new r.FixedSizeSet}return e.prototype.setFeatures=function(e){if(void 0===e&&(e=!0),r.isObject(e))for(var t in e)this._features[t]=e[t]||!1;else for(var t in this._features)this._features[t]=e},Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"window",{get:function(){return null===this._window&&(this._window=i.create_window()),this._window},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compareCache",{get:function(){return this._compareCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeList",{get:function(){return this._rangeList},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}();t.dom=o.instance},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(228));t.base64=i;var o=r(n(146));t.byte=o;var a=r(n(147));t.byteSequence=a;var s=r(n(96));t.codePoint=s;var l=r(n(232));t.json=l;var c=r(n(233));t.list=c;var u=r(n(234));t.map=u;var d=r(n(235));t.namespace=d;var p=r(n(236));t.queue=p;var h=r(n(237));t.set=h;var f=r(n(238));t.stack=f;var m=r(n(239));t.string=m},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){void 0===n&&(n="");var r=e.call(this,n)||this;return r.name=t,r}return i(t,e),t}(Error);t.DOMException=o;var a=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"DOMStringSizeError",t)||this}return i(t,e),t}(o);t.DOMStringSizeError=a;var s=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"WrongDocumentError","The object is in the wrong document. "+t)||this}return i(t,e),t}(o);t.WrongDocumentError=s;var l=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NoDataAllowedError",t)||this}return i(t,e),t}(o);t.NoDataAllowedError=l;var c=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NoModificationAllowedError","The object can not be modified. "+t)||this}return i(t,e),t}(o);t.NoModificationAllowedError=c;var u=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NotSupportedError","The operation is not supported. "+t)||this}return i(t,e),t}(o);t.NotSupportedError=u;var d=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InUseAttributeError",t)||this}return i(t,e),t}(o);t.InUseAttributeError=d;var p=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidStateError","The object is in an invalid state. "+t)||this}return i(t,e),t}(o);t.InvalidStateError=p;var h=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidModificationError","The object can not be modified in this way. "+t)||this}return i(t,e),t}(o);t.InvalidModificationError=h;var f=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NamespaceError","The operation is not allowed by Namespaces in XML. [XMLNS] "+t)||this}return i(t,e),t}(o);t.NamespaceError=f;var m=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidAccessError","The object does not support the operation or argument. "+t)||this}return i(t,e),t}(o);t.InvalidAccessError=m;var g=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"ValidationError",t)||this}return i(t,e),t}(o);t.ValidationError=g;var v=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"TypeMismatchError",t)||this}return i(t,e),t}(o);t.TypeMismatchError=v;var y=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"SecurityError","The operation is insecure. "+t)||this}return i(t,e),t}(o);t.SecurityError=y;var b=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NetworkError","A network error occurred. "+t)||this}return i(t,e),t}(o);t.NetworkError=b;var C=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"AbortError","The operation was aborted. "+t)||this}return i(t,e),t}(o);t.AbortError=C;var w=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"URLMismatchError","The given URL does not match another URL. "+t)||this}return i(t,e),t}(o);t.URLMismatchError=w;var E=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"QuotaExceededError","The quota has been exceeded. "+t)||this}return i(t,e),t}(o);t.QuotaExceededError=E;var T=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"TimeoutError","The operation timed out. "+t)||this}return i(t,e),t}(o);t.TimeoutError=T;var x=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidNodeTypeError","The supplied node is incorrect or has an incorrect ancestor for this operation. "+t)||this}return i(t,e),t}(o);t.InvalidNodeTypeError=x;var _=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"DataCloneError","The object can not be cloned. "+t)||this}return i(t,e),t}(o);t.DataCloneError=_;var S=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NotImplementedError","The DOM method is not implemented by this module. "+t)||this}return i(t,e),t}(o);t.NotImplementedError=S;var I=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"HierarchyRequestError","The operation would yield an incorrect node tree. "+t)||this}return i(t,e),t}(o);t.HierarchyRequestError=I;var D=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"NotFoundError","The object can not be found here. "+t)||this}return i(t,e),t}(o);t.NotFoundError=D;var A=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"IndexSizeError","The index is not in the allowed range. "+t)||this}return i(t,e),t}(o);t.IndexSizeError=A;var P=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"SyntaxError","The string did not match the expected pattern. "+t)||this}return i(t,e),t}(o);t.SyntaxError=P;var O=function(e){function t(t){return void 0===t&&(t=""),e.call(this,"InvalidCharacterError","The string contains invalid characters. "+t)||this}return i(t,e),t}(o);t.InvalidCharacterError=O},function(e,t,n){"use strict";var r=n(53),i=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],o=["scalar","sequence","mapping"];e.exports=function(e,t){var n,a;if(t=t||{},Object.keys(t).forEach(function(t){if(-1===i.indexOf(t))throw new r('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.defaultStyle=t.defaultStyle||null,this.styleAliases=(n=t.styleAliases||null,a={},null!==n&&Object.keys(n).forEach(function(e){n[e].forEach(function(t){a[String(t)]=e})}),a),-1===o.indexOf(this.kind))throw new r('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}},function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")()}).call(this,n(78))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.idl_defineConst=function(e,t,n){Object.defineProperty(e,t,{writable:!1,enumerable:!0,configurable:!1,value:n})}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(16),i=n(115),o=n(18),a=n(56),s=Object.defineProperty;t.f=r?s:function(e,t,n){if(o(e),t=a(t,!0),o(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(8);e.exports=!r(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(2);function a(e,t,n){if(void 0===n&&(n=!1),n&&i.Guard.isElementNode(t)&&i.Guard.isShadowRoot(t.shadowRoot)&&t.shadowRoot._firstChild)return t.shadowRoot._firstChild;if(t._firstChild)return t._firstChild;if(t===e)return null;if(t._nextSibling)return t._nextSibling;for(var r=t._parent;r&&r!==e;){if(r._nextSibling)return r._nextSibling;r=r._parent}return null}function s(){var e;return(e={})[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:null}}}},e}function l(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);for(var i=t?e:a(e,e,n);i&&r&&!r(i);)i=a(e,i,n);return i}function c(e,t,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=!1);for(var o=a(e,t,r);o&&i&&!i(o);)o=a(e,o,r);return o}function u(e,t,n,r){var i;return void 0===t&&(t=!1),void 0===n&&(n=!1),t||0!==e._children.size?((i={})[Symbol.iterator]=function(){var i=t?e:a(e,e,n);return{next:function(){for(;i&&r&&!r(i);)i=a(e,i,n);if(null===i)return{done:!0,value:null};var t={done:!1,value:i};return i=a(e,i,n),t}}},i):s()}function d(e,t,n){void 0===t&&(t=!1);for(var r=t?e:e._parent;r&&n&&!n(r);)r=r._parent;return r}function p(e,t,n,r){void 0===n&&(n=!1);for(var i=t._parent;i&&r&&!r(i);)i=i._parent;return i}function h(e){return i.Guard.isDocumentTypeNode(e)?0:i.Guard.isCharacterDataNode(e)?e._data.length:e._children.size}function f(e,t){if(void 0===t&&(t=!1),t){var n=f(e,!1);return i.Guard.isShadowRoot(n)?f(n._host,!0):n}return e._parent?f(e._parent):e}function m(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);for(var o=n?e:r&&i.Guard.isShadowRoot(e)?e._host:e._parent;null!==o;){if(o===t)return!0;o=r&&i.Guard.isShadowRoot(o)?o._host:o._parent}return!1}function g(e){for(var t=f(e),n=0,r=l(t);null!==r;){if(n++,r===e)return n;r=c(t,r)}return-1}t.tree_getFirstDescendantNode=l,t.tree_getNextDescendantNode=c,t.tree_getDescendantNodes=u,t.tree_getDescendantElements=function(e,t,n,r){var o;return void 0===t&&(t=!1),void 0===n&&(n=!1),t||0!==e._children.size?((o={})[Symbol.iterator]=function(){var o=u(e,t,n,function(e){return i.Guard.isElementNode(e)})[Symbol.iterator](),a=o.next().value;return{next:function(){for(;a&&r&&!r(a);)a=o.next().value;if(null===a)return{done:!0,value:null};var e={done:!1,value:a};return a=o.next().value,e}}},o):s()},t.tree_getSiblingNodes=function(e,t,n){var r;return void 0===t&&(t=!1),e._parent&&0!==e._parent._children.size?((r={})[Symbol.iterator]=function(){var r=e._parent?e._parent._firstChild:null;return{next:function(){for(;r&&(n&&!n(r)||!t&&r===e);)r=r._nextSibling;if(null===r)return{done:!0,value:null};var i={done:!1,value:r};return r=r._nextSibling,i}}},r):s()},t.tree_getFirstAncestorNode=d,t.tree_getNextAncestorNode=p,t.tree_getAncestorNodes=function(e,t,n){var r;return void 0===t&&(t=!1),t||e._parent?((r={})[Symbol.iterator]=function(){var r=d(e,t,n);return{next:function(){if(null===r)return{done:!0,value:null};var e={done:!1,value:r};return r=p(0,r,t,n),e}}},r):s()},t.tree_getCommonAncestor=function(e,t){if(e===t)return e._parent;for(var n=[],r=[],i=d(e,!0);null!==i;)n.push(i),i=p(0,i,!0);for(var o=d(t,!0);null!==o;)r.push(o),o=p(0,o,!0);for(var a=n.length,s=r.length,l=null,c=Math.min(a,s);c>0;c--){var u=n[--a];if(u!==r[--s])break;l=u}return l},t.tree_getFollowingNode=function(e,t){if(t._firstChild)return t._firstChild;if(t._nextSibling)return t._nextSibling;for(;;){var n=t._parent;if(null===n||n===e)return null;if(n._nextSibling)return n._nextSibling;t=n}},t.tree_getPrecedingNode=function(e,t){return t===e?null:t._previousSibling?(t=t._previousSibling)._lastChild?t._lastChild:t:t._parent},t.tree_isConstrained=function e(t){var n,i,a,s,l,c;switch(t._nodeType){case o.NodeType.Document:var u=!1,d=!1;try{for(var p=r(t._children),h=p.next();!h.done;h=p.next())switch(h.value._nodeType){case o.NodeType.ProcessingInstruction:case o.NodeType.Comment:break;case o.NodeType.DocumentType:if(u||d)return!1;u=!0;break;case o.NodeType.Element:if(d)return!1;d=!0;break;default:return!1}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}break;case o.NodeType.DocumentFragment:case o.NodeType.Element:try{for(var f=r(t._children),m=f.next();!m.done;m=f.next())switch(m.value._nodeType){case o.NodeType.Element:case o.NodeType.Text:case o.NodeType.ProcessingInstruction:case o.NodeType.CData:case o.NodeType.Comment:break;default:return!1}}catch(e){a={error:e}}finally{try{m&&!m.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}break;case o.NodeType.DocumentType:case o.NodeType.Text:case o.NodeType.ProcessingInstruction:case o.NodeType.CData:case o.NodeType.Comment:return!t.hasChildNodes()}try{for(var g=r(t._children),v=g.next();!v.done;v=g.next())if(!e(v.value))return!1}catch(e){l={error:e}}finally{try{v&&!v.done&&(c=g.return)&&c.call(g)}finally{if(l)throw l.error}}return!0},t.tree_nodeLength=h,t.tree_isEmpty=function(e){return 0===h(e)},t.tree_rootNode=f,t.tree_isDescendantOf=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);for(var i=l(e,n,r);null!==i;){if(i===t)return!0;i=c(e,i,n,r)}return!1},t.tree_isAncestorOf=m,t.tree_isHostIncludingAncestorOf=function e(t,n,r){if(void 0===r&&(r=!1),m(t,n,r))return!0;var o=f(t);return!(!i.Guard.isDocumentFragmentNode(o)||null===o._host||!e(o._host,n,r))},t.tree_isSiblingOf=function(e,t,n){return void 0===n&&(n=!1),e!==t?null!==e._parent&&e._parent===t._parent:!!n},t.tree_isPreceding=function(e,t){var n=g(e),r=g(t);return-1!==n&&-1!==r&&f(e)===f(t)&&r<n},t.tree_isFollowing=function(e,t){var n=g(e),r=g(t);return-1!==n&&-1!==r&&f(e)===f(t)&&r>n},t.tree_isParentOf=function(e,t){return e._parent===t},t.tree_isChildOf=function(e,t){return t._parent===e},t.tree_previousSibling=function(e){return e._previousSibling},t.tree_nextSibling=function(e){return e._nextSibling},t.tree_firstChild=function(e){return e._firstChild},t.tree_lastChild=function(e){return e._lastChild},t.tree_treePosition=g,t.tree_index=function(e){for(var t=0;null!==e._previousSibling;)t++,e=e._previousSibling;return t},t.tree_retarget=function(e,t){for(;;){if(!e||!i.Guard.isNode(e))return e;var n=f(e);if(!i.Guard.isShadowRoot(n))return e;if(t&&i.Guard.isNode(t)&&m(n,t,!0,!0))return e;e=n.host}}},function(e,t,n){var r=n(13);e.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,n){"use strict";var r=n(24),i=n(130),o=n(49),a=n(43),s=n(88),l=a.set,c=a.getterFor("Array Iterator");e.exports=s(Array,"Array",function(e,t){l(this,{type:"Array Iterator",target:r(e),index:0,kind:t})},function(){var e=c(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t,n){var r=n(90),i=n(25),o=n(202);r||i(Object.prototype,"toString",o,{unsafe:!0})},function(e,t,n){var r=n(16),i=n(15),o=n(40);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";var r=n(137).charAt,i=n(43),o=n(88),a=i.set,s=i.getterFor("String Iterator");o(String,"String",function(e){a(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=s(this),n=t.string,i=t.index;return i>=n.length?{value:void 0,done:!0}:(e=r(n,i),t.index+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(11),i=n(203),o=n(19),a=n(21),s=n(5),l=s("iterator"),c=s("toStringTag"),u=o.values;for(var d in i){var p=r[d],h=p&&p.prototype;if(h){if(h[l]!==u)try{a(h,l,u)}catch(e){h[l]=u}if(h[c]||a(h,c,d),i[d])for(var f in o)if(h[f]!==o[f])try{a(h,f,o[f])}catch(e){h[f]=o[f]}}}},function(e,t,n){var r=n(41),i=n(35);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(11),i=n(21),o=n(14),a=n(80),s=n(117),l=n(43),c=l.get,u=l.enforce,d=String(String).split("String");(e.exports=function(e,t,n,s){var l=!!s&&!!s.unsafe,c=!!s&&!!s.enumerable,p=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof t||o(n,"name")||i(n,"name",t),u(n).source=d.join("string"==typeof t?t:"")),e!==r?(l?!p&&e[t]&&(c=!0):delete e[t],c?e[t]=n:i(e,t,n)):c?e[t]=n:a(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&c(this).source||s(this)})},function(e,t,n){var r=n(47),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(35);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(16),i=n(8),o=n(14),a=Object.defineProperty,s={},l=function(e){throw e};e.exports=function(e,t){if(o(s,e))return s[e];t||(t={});var n=[][e],c=!!o(t,"ACCESSORS")&&t.ACCESSORS,u=o(t,0)?t[0]:l,d=o(t,1)?t[1]:void 0;return s[e]=!!n&&!i(function(){if(c&&!r)return!0;var e={length:-1};c?a(e,1,{enumerable:!0,get:l}):e[1]=1,n.call(e,u,d)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(148),i=n(149),o=n(151),a=n(98),s=n(153),l=n(154),c=n(155),u=n(99),d=n(100),p=n(156),h=n(157),f=n(101),m=n(158),g=n(159),v=n(160),y=n(161),b=n(162),C=n(163),w=n(164),E=n(165),T=n(166),x=n(167),_=n(168),S=n(169),I=n(170);t.create_domImplementation=function(e){return r.DOMImplementationImpl._create(e)},t.create_window=function(){return i.WindowImpl._create()},t.create_xmlDocument=function(){return new o.XMLDocumentImpl},t.create_document=function(){return new a.DocumentImpl},t.create_abortController=function(){return new s.AbortControllerImpl},t.create_abortSignal=function(){return l.AbortSignalImpl._create()},t.create_documentType=function(e,t,n,r){return c.DocumentTypeImpl._create(e,t,n,r)},t.create_element=function(e,t,n,r){return u.ElementImpl._create(e,t,n,r)},t.create_htmlElement=function(e,t,n,r){return u.ElementImpl._create(e,t,n,r)},t.create_htmlUnknownElement=function(e,t,n,r){return u.ElementImpl._create(e,t,n,r)},t.create_documentFragment=function(e){return d.DocumentFragmentImpl._create(e)},t.create_shadowRoot=function(e,t){return p.ShadowRootImpl._create(e,t)},t.create_attr=function(e,t){return h.AttrImpl._create(e,t)},t.create_text=function(e,t){return f.TextImpl._create(e,t)},t.create_cdataSection=function(e,t){return m.CDATASectionImpl._create(e,t)},t.create_comment=function(e,t){return g.CommentImpl._create(e,t)},t.create_processingInstruction=function(e,t,n){return v.ProcessingInstructionImpl._create(e,t,n)},t.create_htmlCollection=function(e,t){return void 0===t&&(t=function(){return!0}),y.HTMLCollectionImpl._create(e,t)},t.create_nodeList=function(e){return b.NodeListImpl._create(e)},t.create_nodeListStatic=function(e,t){return C.NodeListStaticImpl._create(e,t)},t.create_namedNodeMap=function(e){return w.NamedNodeMapImpl._create(e)},t.create_range=function(e,t){return E.RangeImpl._create(e,t)},t.create_nodeIterator=function(e,t,n){return T.NodeIteratorImpl._create(e,t,n)},t.create_treeWalker=function(e,t){return x.TreeWalkerImpl._create(e,t)},t.create_nodeFilter=function(){return _.NodeFilterImpl._create()},t.create_mutationRecord=function(e,t,n,r,i,o,a,s,l){return S.MutationRecordImpl._create(e,t,n,r,i,o,a,s,l)},t.create_domTokenList=function(e,t){return I.DOMTokenListImpl._create(e,t)}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(17),a=n(3),s=n(72),l=new Map;function c(e,t){if(t!==e._root&&o.tree_isAncestorOf(e._reference,t,!0)){if(e._pointerBeforeReference)for(;;){var n=o.tree_getFollowingNode(e._root,t);if(null!==n&&o.tree_isDescendantOf(e._root,n,!0)&&!o.tree_isDescendantOf(t,n,!0))return void(e._reference=n);if(null===n)return void(e._pointerBeforeReference=!1)}if(null===t._previousSibling)null!==t._parent&&(e._reference=t._parent);else{for(var r=t._previousSibling,i=o.tree_getFirstDescendantNode(t._previousSibling,!0,!1);null!==i;)null!==i&&(r=i),i=o.tree_getNextDescendantNode(t._previousSibling,i,!0,!1);e._reference=r}}}function u(e,t,n,r,i){if(a.Guard.isSlot(e)&&"name"===t&&null===i){if(r===n)return;if(null===r&&""===n)return;if(""===r&&null===n)return;e._name=null===r||""===r?"":r,s.shadowTree_assignSlotablesForATree(o.tree_rootNode(e))}}function d(e,t,n,r,i){if(a.Guard.isSlotable(e)&&"slot"===t&&null===i){if(r===n)return;if(null===r&&""===n)return;if(""===r&&null===n)return;e._name=null===r||""===r?"":r,s.shadowTree_isAssigned(e)&&s.shadowTree_assignSlotables(e._assignedSlot),s.shadowTree_assignASlot(e)}}function p(e,t,n,r){"id"===t&&null===r&&(e._uniqueIdentifier=n||void 0)}t.dom_runRemovingSteps=function(e,t){},t.dom_runCloningSteps=function(e,t,n,r){},t.dom_runAdoptingSteps=function(e,t){},t.dom_runAttributeChangeSteps=function(e,t,n,o,a){var s,l;i.dom.features.slots&&(d.call(e,e,t,n,o,a),u.call(e,e,t,n,o,a)),p.call(e,e,t,o,a);try{for(var c=r(e._attributeChangeSteps),h=c.next();!h.done;h=c.next())h.value.call(e,e,t,n,o,a)}catch(e){s={error:e}}finally{try{h&&!h.done&&(l=c.return)&&l.call(c)}finally{if(s)throw s.error}}},t.dom_runInsertionSteps=function(e){},t.dom_runNodeIteratorPreRemovingSteps=function(e,t){c.call(e,e,t)},t.dom_hasSupportedTokens=function(e){return l.has(e)},t.dom_getSupportedTokens=function(e){return l.get(e)||new Set},t.dom_runEventConstructingSteps=function(e){},t.dom_runChildTextContentChangeSteps=function(e){}},function(e,t,n){"use strict";var r=n(4),i=n(11),o=n(46),a=n(44),s=n(16),l=n(86),c=n(124),u=n(8),d=n(14),p=n(59),h=n(13),f=n(18),m=n(27),g=n(24),v=n(56),y=n(40),b=n(60),C=n(61),w=n(82),E=n(190),T=n(85),x=n(55),_=n(15),S=n(79),I=n(21),D=n(25),A=n(81),P=n(57),O=n(45),R=n(58),M=n(5),N=n(125),L=n(126),k=n(62),F=n(43),V=n(36).forEach,U=P("hidden"),B=M("toPrimitive"),G=F.set,W=F.getterFor("Symbol"),z=Object.prototype,H=i.Symbol,j=o("JSON","stringify"),Z=x.f,K=_.f,$=E.f,q=S.f,X=A("symbols"),Y=A("op-symbols"),J=A("string-to-symbol-registry"),Q=A("symbol-to-string-registry"),ee=A("wks"),te=i.QObject,ne=!te||!te.prototype||!te.prototype.findChild,re=s&&u(function(){return 7!=b(K({},"a",{get:function(){return K(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=Z(z,t);r&&delete z[t],K(e,t,n),r&&e!==z&&K(z,t,r)}:K,ie=function(e,t){var n=X[e]=b(H.prototype);return G(n,{type:"Symbol",tag:e,description:t}),s||(n.description=t),n},oe=c?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof H},ae=function(e,t,n){e===z&&ae(Y,t,n),f(e);var r=v(t,!0);return f(n),d(X,r)?(n.enumerable?(d(e,U)&&e[U][r]&&(e[U][r]=!1),n=b(n,{enumerable:y(0,!1)})):(d(e,U)||K(e,U,y(1,{})),e[U][r]=!0),re(e,r,n)):K(e,r,n)},se=function(e,t){f(e);var n=g(t),r=C(n).concat(de(n));return V(r,function(t){s&&!le.call(n,t)||ae(e,t,n[t])}),e},le=function(e){var t=v(e,!0),n=q.call(this,t);return!(this===z&&d(X,t)&&!d(Y,t))&&(!(n||!d(this,t)||!d(X,t)||d(this,U)&&this[U][t])||n)},ce=function(e,t){var n=g(e),r=v(t,!0);if(n!==z||!d(X,r)||d(Y,r)){var i=Z(n,r);return!i||!d(X,r)||d(n,U)&&n[U][r]||(i.enumerable=!0),i}},ue=function(e){var t=$(g(e)),n=[];return V(t,function(e){d(X,e)||d(O,e)||n.push(e)}),n},de=function(e){var t=e===z,n=$(t?Y:g(e)),r=[];return V(n,function(e){!d(X,e)||t&&!d(z,e)||r.push(X[e])}),r};l||(D((H=function(){if(this instanceof H)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=R(e),n=function(e){this===z&&n.call(Y,e),d(this,U)&&d(this[U],t)&&(this[U][t]=!1),re(this,t,y(1,e))};return s&&ne&&re(z,t,{configurable:!0,set:n}),ie(t,e)}).prototype,"toString",function(){return W(this).tag}),D(H,"withoutSetter",function(e){return ie(R(e),e)}),S.f=le,_.f=ae,x.f=ce,w.f=E.f=ue,T.f=de,N.f=function(e){return ie(M(e),e)},s&&(K(H.prototype,"description",{configurable:!0,get:function(){return W(this).description}}),a||D(z,"propertyIsEnumerable",le,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!l,sham:!l},{Symbol:H}),V(C(ee),function(e){L(e)}),r({target:"Symbol",stat:!0,forced:!l},{for:function(e){var t=String(e);if(d(J,t))return J[t];var n=H(t);return J[t]=n,Q[n]=t,n},keyFor:function(e){if(!oe(e))throw TypeError(e+" is not a symbol");if(d(Q,e))return Q[e]},useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),r({target:"Object",stat:!0,forced:!l,sham:!s},{create:function(e,t){return void 0===t?b(e):se(b(e),t)},defineProperty:ae,defineProperties:se,getOwnPropertyDescriptor:ce}),r({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:ue,getOwnPropertySymbols:de}),r({target:"Object",stat:!0,forced:u(function(){T.f(1)})},{getOwnPropertySymbols:function(e){return T.f(m(e))}}),j&&r({target:"JSON",stat:!0,forced:!l||u(function(){var e=H();return"[null]"!=j([e])||"{}"!=j({a:e})||"{}"!=j(Object(e))})},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(h(t)||void 0!==e)&&!oe(e))return p(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!oe(t))return t}),i[1]=t,j.apply(null,i)}}),H.prototype[B]||I(H.prototype,B,H.prototype.valueOf),k(H,"Symbol"),O[U]=!0},function(e,t,n){"use strict";var r=n(4),i=n(16),o=n(11),a=n(14),s=n(13),l=n(15).f,c=n(119),u=o.Symbol;if(i&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var d={},p=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof p?new u(e):void 0===e?u():u(e);return""===e&&(d[t]=!0),t};c(p,u);var h=p.prototype=u.prototype;h.constructor=p;var f=h.toString,m="Symbol(test)"==String(u("test")),g=/^Symbol\((.*)\)[^)]+$/;l(h,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=f.call(e);if(a(d,e))return"";var n=m?t.slice(7,-1):t.replace(g,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:p})}},function(e,t,n){n(126)("iterator")},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(2),l=n(70),c=n(3),u=n(9),d=n(0),p=n(152),h=n(12),f=function(e){function t(){var t=e.call(this)||this;return t._parent=null,t._firstChild=null,t._lastChild=null,t._previousSibling=null,t._nextSibling=null,t}return i(t,e),Object.defineProperty(t.prototype,"_childNodes",{get:function(){return this.__childNodes||(this.__childNodes=d.create_nodeList(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverride||a.dom.window._associatedDocument},set:function(e){this._nodeDocumentOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_registeredObserverList",{get:function(){return this.__registeredObserverList||(this.__registeredObserverList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeName",{get:function(){return c.Guard.isElementNode(this)?this._htmlUppercasedQualifiedName:c.Guard.isAttrNode(this)?this._qualifiedName:c.Guard.isExclusiveTextNode(this)?"#text":c.Guard.isCDATASectionNode(this)?"#cdata-section":c.Guard.isProcessingInstructionNode(this)?this._target:c.Guard.isCommentNode(this)?"#comment":c.Guard.isDocumentNode(this)?"#document":c.Guard.isDocumentTypeNode(this)?this._name:c.Guard.isDocumentFragmentNode(this)?"#document-fragment":""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseURI",{get:function(){return p.urlSerializer(this._nodeDocument._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isConnected",{get:function(){return c.Guard.isElementNode(this)&&d.shadowTree_isConnected(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ownerDocument",{get:function(){return this._nodeType===s.NodeType.Document?null:this._nodeDocument},enumerable:!0,configurable:!0}),t.prototype.getRootNode=function(e){return d.tree_rootNode(this,!!e&&e.composed)},Object.defineProperty(t.prototype,"parentNode",{get:function(){return this._nodeType===s.NodeType.Attribute?null:this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentElement",{get:function(){return this._parent&&c.Guard.isElementNode(this._parent)?this._parent:null},enumerable:!0,configurable:!0}),t.prototype.hasChildNodes=function(){return null!==this._firstChild},Object.defineProperty(t.prototype,"childNodes",{get:function(){return this._childNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._firstChild},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return c.Guard.isAttrNode(this)?this._value:c.Guard.isCharacterDataNode(this)?this._data:null},set:function(e){null===e&&(e=""),c.Guard.isAttrNode(this)?d.attr_setAnExistingAttributeValue(this,e):c.Guard.isCharacterDataNode(this)&&d.characterData_replaceData(this,0,this._data.length,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textContent",{get:function(){return c.Guard.isDocumentFragmentNode(this)||c.Guard.isElementNode(this)?d.text_descendantTextContent(this):c.Guard.isAttrNode(this)?this._value:c.Guard.isCharacterDataNode(this)?this._data:null},set:function(e){null===e&&(e=""),c.Guard.isDocumentFragmentNode(this)||c.Guard.isElementNode(this)?d.node_stringReplaceAll(e,this):c.Guard.isAttrNode(this)?d.attr_setAnExistingAttributeValue(this,e):c.Guard.isCharacterDataNode(this)&&d.characterData_replaceData(this,0,d.tree_nodeLength(this),e)},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){for(var e,t,n,r,i=[],s=d.tree_getFirstDescendantNode(this,!1,!1,function(e){return c.Guard.isExclusiveTextNode(e)});null!==s;)i.push(s),s=d.tree_getNextDescendantNode(this,s,!1,!1,function(e){return c.Guard.isExclusiveTextNode(e)});for(var l=0;l<i.length;l++){var u=i[l];if(null!==u._parent){var p=d.tree_nodeLength(u);if(0!==p){var h=[],f="";try{for(var m=(e=void 0,o(d.text_contiguousExclusiveTextNodes(u))),g=m.next();!g.done;g=m.next()){var v=g.value;h.push(v),f+=v._data}}catch(t){e={error:t}}finally{try{g&&!g.done&&(t=m.return)&&t.call(m)}finally{if(e)throw e.error}}if(d.characterData_replaceData(u,p,0,f),0!==a.dom.rangeList.size)for(var y=u._nextSibling;null!==y&&c.Guard.isExclusiveTextNode(y);){var b=y,C=d.tree_index(b);try{for(var w=(n=void 0,o(a.dom.rangeList)),E=w.next();!E.done;E=w.next()){var T=E.value;T._start[0]===b&&(T._start[0]=u,T._start[1]+=p),T._end[0]===b&&(T._end[0]=u,T._end[1]+=p),T._start[0]===b._parent&&T._start[1]===C&&(T._start[0]=u,T._start[1]=p),T._end[0]===b._parent&&T._end[1]===C&&(T._end[0]=u,T._end[1]=p)}}catch(e){n={error:e}}finally{try{E&&!E.done&&(r=w.return)&&r.call(w)}finally{if(n)throw n.error}}p+=d.tree_nodeLength(y),y=y._nextSibling}for(var x=0;x<h.length;x++)null!==(v=h[x])._parent&&d.mutation_remove(v,v._parent)}else d.mutation_remove(u,u._parent)}}},t.prototype.cloneNode=function(e){if(void 0===e&&(e=!1),c.Guard.isShadowRoot(this))throw new u.NotSupportedError;return d.node_clone(this,null,e)},t.prototype.isEqualNode=function(e){return void 0===e&&(e=null),null!==e&&d.node_equals(this,e)},t.prototype.isSameNode=function(e){return void 0===e&&(e=null),this===e},t.prototype.compareDocumentPosition=function(e){if(e===this)return 0;var t=e,n=this,r=null,i=null;if(c.Guard.isAttrNode(t)&&(t=(r=t)._element),c.Guard.isAttrNode(n)&&(n=(i=n)._element,r&&t&&t===n))for(var o=0;o<n._attributeList.length;o++){var l=n._attributeList[o];if(d.node_equals(l,r))return s.Position.ImplementationSpecific|s.Position.Preceding;if(d.node_equals(l,i))return s.Position.ImplementationSpecific|s.Position.Following}return null===t||null===n||d.tree_rootNode(t)!==d.tree_rootNode(n)?s.Position.Disconnected|s.Position.ImplementationSpecific|(a.dom.compareCache.check(this,e)?s.Position.Preceding:s.Position.Following):!r&&d.tree_isAncestorOf(n,t)||i&&t===n?s.Position.Contains|s.Position.Preceding:!i&&d.tree_isDescendantOf(n,t)||r&&t===n?s.Position.ContainedBy|s.Position.Following:d.tree_isPreceding(n,t)?s.Position.Preceding:s.Position.Following},t.prototype.contains=function(e){return null!==e&&d.tree_isDescendantOf(this,e,!0)},t.prototype.lookupPrefix=function(e){return e?c.Guard.isElementNode(this)?d.node_locateANamespacePrefix(this,e):c.Guard.isDocumentNode(this)?null===this.documentElement?null:d.node_locateANamespacePrefix(this.documentElement,e):c.Guard.isDocumentTypeNode(this)||c.Guard.isDocumentFragmentNode(this)?null:c.Guard.isAttrNode(this)?null===this._element?null:d.node_locateANamespacePrefix(this._element,e):null!==this._parent&&c.Guard.isElementNode(this._parent)?d.node_locateANamespacePrefix(this._parent,e):null:null},t.prototype.lookupNamespaceURI=function(e){return d.node_locateANamespace(this,e||null)},t.prototype.isDefaultNamespace=function(e){return e||(e=null),d.node_locateANamespace(this,null)===e},t.prototype.insertBefore=function(e,t){return d.mutation_preInsert(e,this,t)},t.prototype.appendChild=function(e){return d.mutation_append(e,this)},t.prototype.replaceChild=function(e,t){return d.mutation_replace(t,e,this)},t.prototype.removeChild=function(e){return d.mutation_preRemove(e,this)},t.prototype._getTheParent=function(e){return c.Guard.isSlotable(this)&&d.shadowTree_isAssigned(this)?this._assignedSlot:this._parent},t.ELEMENT_NODE=1,t.ATTRIBUTE_NODE=2,t.TEXT_NODE=3,t.CDATA_SECTION_NODE=4,t.ENTITY_REFERENCE_NODE=5,t.ENTITY_NODE=6,t.PROCESSING_INSTRUCTION_NODE=7,t.COMMENT_NODE=8,t.DOCUMENT_NODE=9,t.DOCUMENT_TYPE_NODE=10,t.DOCUMENT_FRAGMENT_NODE=11,t.NOTATION_NODE=12,t.DOCUMENT_POSITION_DISCONNECTED=1,t.DOCUMENT_POSITION_PRECEDING=2,t.DOCUMENT_POSITION_FOLLOWING=4,t.DOCUMENT_POSITION_CONTAINS=8,t.DOCUMENT_POSITION_CONTAINED_BY=16,t.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,t}(l.EventTargetImpl);t.NodeImpl=f,f.prototype._children=new c.EmptySet,h.idl_defineConst(f.prototype,"ELEMENT_NODE",1),h.idl_defineConst(f.prototype,"ATTRIBUTE_NODE",2),h.idl_defineConst(f.prototype,"TEXT_NODE",3),h.idl_defineConst(f.prototype,"CDATA_SECTION_NODE",4),h.idl_defineConst(f.prototype,"ENTITY_REFERENCE_NODE",5),h.idl_defineConst(f.prototype,"ENTITY_NODE",6),h.idl_defineConst(f.prototype,"PROCESSING_INSTRUCTION_NODE",7),h.idl_defineConst(f.prototype,"COMMENT_NODE",8),h.idl_defineConst(f.prototype,"DOCUMENT_NODE",9),h.idl_defineConst(f.prototype,"DOCUMENT_TYPE_NODE",10),h.idl_defineConst(f.prototype,"DOCUMENT_FRAGMENT_NODE",11),h.idl_defineConst(f.prototype,"NOTATION_NODE",12),h.idl_defineConst(f.prototype,"DOCUMENT_POSITION_DISCONNECTED",1),h.idl_defineConst(f.prototype,"DOCUMENT_POSITION_PRECEDING",2),h.idl_defineConst(f.prototype,"DOCUMENT_POSITION_FOLLOWING",4),h.idl_defineConst(f.prototype,"DOCUMENT_POSITION_CONTAINS",8),h.idl_defineConst(f.prototype,"DOCUMENT_POSITION_CONTAINED_BY",16),h.idl_defineConst(f.prototype,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32)},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var r=n(87),i=n(41),o=n(27),a=n(26),s=n(128),l=[].push,c=function(e){var t=1==e,n=2==e,c=3==e,u=4==e,d=6==e,p=5==e||d;return function(h,f,m,g){for(var v,y,b=o(h),C=i(b),w=r(f,m,3),E=a(C.length),T=0,x=g||s,_=t?x(h,E):n?x(h,0):void 0;E>T;T++)if((p||T in C)&&(y=w(v=C[T],T,b),e))if(t)_[T]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return T;case 2:l.call(_,v)}else if(u)return!1;return d?-1:c||u?u:_}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6)}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(9),l=n(2),c=n(3),u=n(1),d=n(7),p=n(73),h=n(17),f=n(172),m=n(72),g=n(51),v=n(30),y=n(106);function b(e,t,n){var i,o,a,c,u,d,p,f,m=t._nodeType,g=e._nodeType,v=n?n._nodeType:null;if(m!==l.NodeType.Document&&m!==l.NodeType.DocumentFragment&&m!==l.NodeType.Element)throw new s.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+t.nodeName+".");if(h.tree_isHostIncludingAncestorOf(t,e,!0))throw new s.HierarchyRequestError("The node to be inserted cannot be an inclusive ancestor of parent node. Node is "+e.nodeName+", parent node is "+t.nodeName+".");if(null!==n&&n._parent!==t)throw new s.NotFoundError("The reference child node cannot be found under parent node. Child node is "+n.nodeName+", parent node is "+t.nodeName+".");if(g!==l.NodeType.DocumentFragment&&g!==l.NodeType.DocumentType&&g!==l.NodeType.Element&&g!==l.NodeType.Text&&g!==l.NodeType.ProcessingInstruction&&g!==l.NodeType.CData&&g!==l.NodeType.Comment)throw new s.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+e.nodeName+".");if(g===l.NodeType.Text&&m===l.NodeType.Document)throw new s.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+e.nodeName+".");if(g===l.NodeType.DocumentType&&m!==l.NodeType.Document)throw new s.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+t.nodeName+".");if(m===l.NodeType.Document)if(g===l.NodeType.DocumentFragment){var y=0;try{for(var b=r(e._children),C=b.next();!C.done;C=b.next()){var w=C.value;if(w._nodeType===l.NodeType.Element)y++;else if(w._nodeType===l.NodeType.Text)throw new s.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+w.nodeName+".")}}catch(e){i={error:e}}finally{try{C&&!C.done&&(o=b.return)&&o.call(b)}finally{if(i)throw i.error}}if(y>1)throw new s.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+y+" element nodes.");if(1===y){try{for(var E=r(t._children),T=E.next();!T.done;T=E.next())if(T.value._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("The document node already has a document element node.")}catch(e){a={error:e}}finally{try{T&&!T.done&&(c=E.return)&&c.call(E)}finally{if(a)throw a.error}}if(n){if(v===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node.");for(var x=n._nextSibling;x;){if(x._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node.");x=x._nextSibling}}}}else if(g===l.NodeType.Element){try{for(var _=r(t._children),S=_.next();!S.done;S=_.next())if(S.value._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Document already has a document element node. Node is "+e.nodeName+".")}catch(e){u={error:e}}finally{try{S&&!S.done&&(d=_.return)&&d.call(_)}finally{if(u)throw u.error}}if(n){if(v===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+e.nodeName+".");for(x=n._nextSibling;x;){if(x._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+e.nodeName+".");x=x._nextSibling}}}else if(g===l.NodeType.DocumentType){try{for(var I=r(t._children),D=I.next();!D.done;D=I.next())if(D.value._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Document already has a document type node. Node is "+e.nodeName+".")}catch(e){p={error:e}}finally{try{D&&!D.done&&(f=I.return)&&f.call(I)}finally{if(p)throw p.error}}if(n)for(var A=n._previousSibling;A;){if(A._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+e.nodeName+".");A=A._previousSibling}else for(A=t._firstChild;A;){if(A._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+e.nodeName+".");A=A._nextSibling}}}function C(e,t,n){b(e,t,n);var r=n;return r===e&&(r=e._nextSibling),y.document_adopt(e,t._nodeDocument),w(e,t,r),e}function w(e,t,n,i){var s,f;if(null!==n||e._nodeType===l.NodeType.DocumentFragment){var y=e._nodeType===l.NodeType.DocumentFragment?e._children.size:1;if(null!==n&&0!==a.dom.rangeList.size){var b=h.tree_index(n);try{for(var C=r(a.dom.rangeList),w=C.next();!w.done;w=C.next()){var T=w.value;T._start[0]===t&&T._start[1]>b&&(T._start[1]+=y),T._end[0]===t&&T._end[1]>b&&(T._end[1]+=y)}}catch(e){s={error:e}}finally{try{w&&!w.done&&(f=C.return)&&f.call(C)}finally{if(s)throw s.error}}}var x=e._nodeType===l.NodeType.DocumentFragment?new(Array.bind.apply(Array,o([void 0],e._children))):[e];if(e._nodeType===l.NodeType.DocumentFragment)for(;e._firstChild;)E(e._firstChild,e,!0);a.dom.features.mutationObservers&&e._nodeType===l.NodeType.DocumentFragment&&g.observer_queueTreeMutationRecord(e,[],x,null,null);for(var _=n?n._previousSibling:t._lastChild,S=null===n?-1:h.tree_index(n),I=0;I<x.length;I++){var D=x[I];if(c.Guard.isElementNode(D)&&(c.Guard.isDocumentNode(t)&&(t._documentElement=D),D._nodeDocument._hasNamespaces||null===D._namespace&&null===D._namespacePrefix||(D._nodeDocument._hasNamespaces=!0)),D._parent=t,null===n?d.set.append(t._children,D):(d.set.insert(t._children,D,S),S++),null===t._firstChild)D._previousSibling=null,D._nextSibling=null,t._firstChild=D,t._lastChild=D;else{var A=n?n._previousSibling:t._lastChild,P=n||null;D._previousSibling=A,D._nextSibling=P,A&&(A._nextSibling=D),P&&(P._previousSibling=D),A||(t._firstChild=D),P||(t._lastChild=D)}a.dom.features.slots&&null!==t._shadowRoot&&c.Guard.isSlotable(D)&&m.shadowTree_assignASlot(D),a.dom.features.steps&&c.Guard.isTextNode(D)&&v.dom_runChildTextContentChangeSteps(t),a.dom.features.slots&&c.Guard.isShadowRoot(h.tree_rootNode(t))&&c.Guard.isSlot(t)&&u.isEmpty(t._assignedNodes)&&m.shadowTree_signalASlotChange(t),a.dom.features.slots&&m.shadowTree_assignSlotablesForATree(h.tree_rootNode(D));for(var O=h.tree_getFirstDescendantNode(D,!0,!0);null!==O;)a.dom.features.steps&&v.dom_runInsertionSteps(O),a.dom.features.customElements&&c.Guard.isElementNode(O)&&m.shadowTree_isConnected(O)&&(c.Guard.isCustomElementNode(O)?p.customElement_enqueueACustomElementCallbackReaction(O,"connectedCallback",[]):p.customElement_tryToUpgrade(O)),O=h.tree_getNextDescendantNode(D,O,!0,!0)}a.dom.features.mutationObservers&&(i||g.observer_queueTreeMutationRecord(t,x,[],_,n))}else!function(e,t,n){var r=t._lastChild;if(c.Guard.isElementNode(e)&&(c.Guard.isDocumentNode(t)&&(t._documentElement=e),e._nodeDocument._hasNamespaces||null===e._namespace&&null===e._namespacePrefix||(e._nodeDocument._hasNamespaces=!0)),e._parent=t,t._children.add(e),null===t._firstChild)e._previousSibling=null,e._nextSibling=null,t._firstChild=e,t._lastChild=e;else{var i=t._lastChild;e._previousSibling=i,e._nextSibling=null,i&&(i._nextSibling=e),i||(t._firstChild=e),t._lastChild=e}a.dom.features.slots&&null!==t._shadowRoot&&c.Guard.isSlotable(e)&&m.shadowTree_assignASlot(e),a.dom.features.steps&&c.Guard.isTextNode(e)&&v.dom_runChildTextContentChangeSteps(t),a.dom.features.slots&&c.Guard.isShadowRoot(h.tree_rootNode(t))&&c.Guard.isSlot(t)&&u.isEmpty(t._assignedNodes)&&m.shadowTree_signalASlotChange(t),a.dom.features.slots&&m.shadowTree_assignSlotablesForATree(h.tree_rootNode(e)),a.dom.features.steps&&v.dom_runInsertionSteps(e),a.dom.features.customElements&&c.Guard.isElementNode(e)&&m.shadowTree_isConnected(e)&&(c.Guard.isCustomElementNode(e)?p.customElement_enqueueACustomElementCallbackReaction(e,"connectedCallback",[]):p.customElement_tryToUpgrade(e)),a.dom.features.mutationObservers&&(n||g.observer_queueTreeMutationRecord(t,[e],[],r,null))}(e,t,i)}function E(e,t,n){var i,o,s,l,d,y,b,C;if(0!==a.dom.rangeList.size){var w=h.tree_index(e);try{for(var E=r(a.dom.rangeList),T=E.next();!T.done;T=E.next()){var x=T.value;h.tree_isDescendantOf(e,x._start[0],!0)&&(x._start=[t,w]),h.tree_isDescendantOf(e,x._end[0],!0)&&(x._end=[t,w]),x._start[0]===t&&x._start[1]>w&&x._start[1]--,x._end[0]===t&&x._end[1]>w&&x._end[1]--}}catch(e){i={error:e}}finally{try{T&&!T.done&&(o=E.return)&&o.call(E)}finally{if(i)throw i.error}}try{for(var _=r(a.dom.rangeList),S=_.next();!S.done;S=_.next())(x=S.value)._start[0]===t&&x._start[1]>w&&(x._start[1]-=1),x._end[0]===t&&x._end[1]>w&&(x._end[1]-=1)}catch(e){s={error:e}}finally{try{S&&!S.done&&(l=_.return)&&l.call(_)}finally{if(s)throw s.error}}}if(a.dom.features.steps)try{for(var I=r(f.nodeIterator_iteratorList()),D=I.next();!D.done;D=I.next()){var A=D.value;A._root._nodeDocument===e._nodeDocument&&v.dom_runNodeIteratorPreRemovingSteps(A,e)}}catch(e){d={error:e}}finally{try{D&&!D.done&&(y=I.return)&&y.call(I)}finally{if(d)throw d.error}}var P=e._previousSibling,O=e._nextSibling;c.Guard.isDocumentNode(t)&&c.Guard.isElementNode(e)&&(t._documentElement=null),e._parent=null,t._children.delete(e);var R=e._previousSibling,M=e._nextSibling;e._previousSibling=null,e._nextSibling=null,R&&(R._nextSibling=M),M&&(M._previousSibling=R),R||(t._firstChild=M),M||(t._lastChild=R),a.dom.features.slots&&c.Guard.isSlotable(e)&&null!==e._assignedSlot&&m.shadowTree_isAssigned(e)&&m.shadowTree_assignSlotables(e._assignedSlot),a.dom.features.slots&&c.Guard.isShadowRoot(h.tree_rootNode(t))&&c.Guard.isSlot(t)&&u.isEmpty(t._assignedNodes)&&m.shadowTree_signalASlotChange(t),a.dom.features.slots&&null!==h.tree_getFirstDescendantNode(e,!0,!1,function(e){return c.Guard.isSlot(e)})&&(m.shadowTree_assignSlotablesForATree(h.tree_rootNode(t)),m.shadowTree_assignSlotablesForATree(e)),a.dom.features.steps&&v.dom_runRemovingSteps(e,t),a.dom.features.customElements&&c.Guard.isCustomElementNode(e)&&p.customElement_enqueueACustomElementCallbackReaction(e,"disconnectedCallback",[]);for(var N=h.tree_getFirstDescendantNode(e,!1,!0);null!==N;)a.dom.features.steps&&v.dom_runRemovingSteps(N,e),a.dom.features.customElements&&c.Guard.isCustomElementNode(N)&&p.customElement_enqueueACustomElementCallbackReaction(N,"disconnectedCallback",[]),N=h.tree_getNextDescendantNode(e,N,!1,!0);if(a.dom.features.mutationObservers)for(var L=h.tree_getFirstAncestorNode(t,!0);null!==L;){try{for(var k=(b=void 0,r(L._registeredObserverList)),F=k.next();!F.done;F=k.next()){var V=F.value;V.options.subtree&&e._registeredObserverList.push({observer:V.observer,options:V.options,source:V})}}catch(e){b={error:e}}finally{try{F&&!F.done&&(C=k.return)&&C.call(k)}finally{if(b)throw b.error}}L=h.tree_getNextAncestorNode(t,L,!0)}a.dom.features.mutationObservers&&(n||g.observer_queueTreeMutationRecord(t,[],[e],P,O)),a.dom.features.steps&&c.Guard.isTextNode(e)&&v.dom_runChildTextContentChangeSteps(t)}t.mutation_ensurePreInsertionValidity=b,t.mutation_preInsert=C,t.mutation_insert=w,t.mutation_append=function(e,t){return C(e,t,null)},t.mutation_replace=function(e,t,n){var i,o,c,u,d,p,f,m;if(n._nodeType!==l.NodeType.Document&&n._nodeType!==l.NodeType.DocumentFragment&&n._nodeType!==l.NodeType.Element)throw new s.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+n.nodeName+".");if(h.tree_isHostIncludingAncestorOf(n,t,!0))throw new s.HierarchyRequestError("The node to be inserted cannot be an ancestor of parent node. Node is "+t.nodeName+", parent node is "+n.nodeName+".");if(e._parent!==n)throw new s.NotFoundError("The reference child node cannot be found under parent node. Child node is "+e.nodeName+", parent node is "+n.nodeName+".");if(t._nodeType!==l.NodeType.DocumentFragment&&t._nodeType!==l.NodeType.DocumentType&&t._nodeType!==l.NodeType.Element&&t._nodeType!==l.NodeType.Text&&t._nodeType!==l.NodeType.ProcessingInstruction&&t._nodeType!==l.NodeType.CData&&t._nodeType!==l.NodeType.Comment)throw new s.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+t.nodeName+".");if(t._nodeType===l.NodeType.Text&&n._nodeType===l.NodeType.Document)throw new s.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+t.nodeName+".");if(t._nodeType===l.NodeType.DocumentType&&n._nodeType!==l.NodeType.Document)throw new s.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+n.nodeName+".");if(n._nodeType===l.NodeType.Document)if(t._nodeType===l.NodeType.DocumentFragment){var v=0;try{for(var b=r(t._children),C=b.next();!C.done;C=b.next()){var T=C.value;if(T._nodeType===l.NodeType.Element)v++;else if(T._nodeType===l.NodeType.Text)throw new s.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+T.nodeName+".")}}catch(e){i={error:e}}finally{try{C&&!C.done&&(o=b.return)&&o.call(b)}finally{if(i)throw i.error}}if(v>1)throw new s.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+v+" element nodes.");if(1===v){try{for(var x=r(n._children),_=x.next();!_.done;_=x.next())if((O=_.value)._nodeType===l.NodeType.Element&&O!==e)throw new s.HierarchyRequestError("The document node already has a document element node.")}catch(e){c={error:e}}finally{try{_&&!_.done&&(u=x.return)&&u.call(x)}finally{if(c)throw c.error}}for(var S=e._nextSibling;S;){if(S._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node.");S=S._nextSibling}}}else if(t._nodeType===l.NodeType.Element){try{for(var I=r(n._children),D=I.next();!D.done;D=I.next())if((O=D.value)._nodeType===l.NodeType.Element&&O!==e)throw new s.HierarchyRequestError("Document already has a document element node. Node is "+t.nodeName+".")}catch(e){d={error:e}}finally{try{D&&!D.done&&(p=I.return)&&p.call(I)}finally{if(d)throw d.error}}for(S=e._nextSibling;S;){if(S._nodeType===l.NodeType.DocumentType)throw new s.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+t.nodeName+".");S=S._nextSibling}}else if(t._nodeType===l.NodeType.DocumentType){try{for(var A=r(n._children),P=A.next();!P.done;P=A.next()){var O;if((O=P.value)._nodeType===l.NodeType.DocumentType&&O!==e)throw new s.HierarchyRequestError("Document already has a document type node. Node is "+t.nodeName+".")}}catch(e){f={error:e}}finally{try{P&&!P.done&&(m=A.return)&&m.call(A)}finally{if(f)throw f.error}}for(var R=e._previousSibling;R;){if(R._nodeType===l.NodeType.Element)throw new s.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+t.nodeName+".");R=R._previousSibling}}var M=e._nextSibling;M===t&&(M=t._nextSibling);var N=e._previousSibling;y.document_adopt(t,n._nodeDocument);var L=[];null!==e._parent&&(L.push(e),E(e,e._parent,!0));var k=[];return t._nodeType===l.NodeType.DocumentFragment?k=Array.from(t._children):k.push(t),w(t,n,M,!0),a.dom.features.mutationObservers&&g.observer_queueTreeMutationRecord(n,k,L,N,M),e},t.mutation_replaceAll=function(e,t){var n,i;null!==e&&y.document_adopt(e,t._nodeDocument);var o=Array.from(t._children),s=[];e&&e._nodeType===l.NodeType.DocumentFragment?s=Array.from(e._children):null!==e&&s.push(e);try{for(var c=r(o),u=c.next();!u.done;u=c.next())E(u.value,t,!0)}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}null!==e&&w(e,t,null,!0),a.dom.features.mutationObservers&&g.observer_queueTreeMutationRecord(t,s,o,null,null)},t.mutation_preRemove=function(e,t){if(e._parent!==t)throw new s.NotFoundError("The child node cannot be found under parent node. Child node is "+e.nodeName+", parent node is "+t.nodeName+".");return E(e,t),e},t.mutation_remove=E},function(e,t,n){"use strict";function r(e){return null==e}e.exports.isNothing=r,e.exports.isObject=function(e){return"object"==typeof e&&null!==e},e.exports.toArray=function(e){return Array.isArray(e)?e:r(e)?[]:[e]},e.exports.repeat=function(e,t){var n,r="";for(n=0;n<t;n+=1)r+=e;return r},e.exports.isNegativeZero=function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},e.exports.extend=function(e,t){var n,r,i,o;if(t)for(n=0,r=(o=Object.keys(t)).length;n<r;n+=1)e[i=o[n]]=t[i];return e}},function(e,t,n){"use strict";var r=n(38),i=n(53),o=n(10);function a(e,t,n){var r=[];return e.include.forEach(function(e){n=a(e,t,n)}),e[t].forEach(function(e){n.forEach(function(t,n){t.tag===e.tag&&t.kind===e.kind&&r.push(n)}),n.push(e)}),n.filter(function(e,t){return-1===r.indexOf(t)})}function s(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach(function(e){if(e.loadKind&&"scalar"!==e.loadKind)throw new i("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=a(this,"implicit",[]),this.compiledExplicit=a(this,"explicit",[]),this.compiledTypeMap=function(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{}};function r(e){n[e.kind][e.tag]=n.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}(this.compiledImplicit,this.compiledExplicit)}s.DEFAULT=null,s.create=function(){var e,t;switch(arguments.length){case 1:e=s.DEFAULT,t=arguments[0];break;case 2:e=arguments[0],t=arguments[1];break;default:throw new i("Wrong number of arguments for Schema.create function")}if(e=r.toArray(e),t=r.toArray(t),!e.every(function(e){return e instanceof s}))throw new i("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!t.every(function(e){return e instanceof o}))throw new i("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new s({include:e,explicit:t})},e.exports=s},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(8),i=n(42),o="".split;e.exports=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==i(e)?o.call(e,""):Object(e)}:Object},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r,i,o,a=n(186),s=n(11),l=n(13),c=n(21),u=n(14),d=n(57),p=n(45),h=s.WeakMap;if(a){var f=new h,m=f.get,g=f.has,v=f.set;r=function(e,t){return v.call(f,e,t),t},i=function(e){return m.call(f,e)||{}},o=function(e){return g.call(f,e)}}else{var y=d("state");p[y]=!0,r=function(e,t){return c(e,y,t),t},i=function(e){return u(e,y)?e[y]:{}},o=function(e){return u(e,y)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t){e.exports=!1},function(e,t){e.exports={}},function(e,t,n){var r=n(120),i=n(11),o=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?o(r[e])||o(i[e]):r[e]&&r[e][t]||i[e]&&i[e][t]}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){"use strict";var r=n(8);e.exports=function(e,t){var n=[][e];return!!n&&r(function(){n.call(null,t||function(){throw 1},1)})}},function(e,t){e.exports={}},function(e,t,n){"use strict";n(31),n(32),n(33),n(220),n(64),n(19),n(65),n(20),n(68),n(66),n(92),n(144),n(22),n(94),n(23);var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(69),l=n(95),c=n(7),u=n(0),d=function(){function e(e){this.level=0,this._builderOptions=e}return e.prototype.declaration=function(e,t,n){},e.prototype.docType=function(e,t,n){},e.prototype.comment=function(e){},e.prototype.text=function(e){},e.prototype.instruction=function(e,t){},e.prototype.cdata=function(e){},e.prototype.openTagBegin=function(e){},e.prototype.openTagEnd=function(e,t,n){},e.prototype.closeTag=function(e){},e.prototype.attributes=function(e){var t,n;try{for(var i=r(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.attribute(null===a[1]?a[2]:a[1]+":"+a[2],a[3])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.attribute=function(e,t){},e.prototype.beginElement=function(e){},e.prototype.endElement=function(e){},e.prototype.serializeNode=function(e,t){var n=void 0!==e._nodeDocument&&e._nodeDocument._hasNamespaces;if(this.level=0,this.currentNode=e,n){var r=new l.NamespacePrefixMap;r.set("xml",c.namespace.XML),this._serializeNodeNS(e,null,r,{value:1},t)}else this._serializeNode(e,t)},e.prototype._serializeNodeNS=function(e,t,n,r,i){switch(this.currentNode=e,e.nodeType){case a.NodeType.Element:this._serializeElementNS(e,t,n,r,i);break;case a.NodeType.Document:this._serializeDocumentNS(e,t,n,r,i);break;case a.NodeType.Comment:this._serializeComment(e,i);break;case a.NodeType.Text:this._serializeText(e,i);break;case a.NodeType.DocumentFragment:this._serializeDocumentFragmentNS(e,t,n,r,i);break;case a.NodeType.DocumentType:this._serializeDocumentType(e,i);break;case a.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(e,i);break;case a.NodeType.CData:this._serializeCData(e,i);break;default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeNode=function(e,t){switch(this.currentNode=e,e.nodeType){case a.NodeType.Element:this._serializeElement(e,t);break;case a.NodeType.Document:this._serializeDocument(e,t);break;case a.NodeType.Comment:this._serializeComment(e,t);break;case a.NodeType.Text:this._serializeText(e,t);break;case a.NodeType.DocumentFragment:this._serializeDocumentFragment(e,t);break;case a.NodeType.DocumentType:this._serializeDocumentType(e,t);break;case a.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(e,t);break;case a.NodeType.CData:this._serializeCData(e,t);break;default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeElementNS=function(t,n,i,a,s){var l,d,p=[];if(s&&(-1!==t.localName.indexOf(":")||!u.xml_isName(t.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var h="",f=!1,m=!1,g=i.copy(),v={},y=this._recordNamespaceInformation(t,g,v),b=n,C=t.namespaceURI;if(b===C)null!==y&&(m=!0),h=C===c.namespace.XML?"xml:"+t.localName:t.localName,this.beginElement(h),this.openTagBegin(h);else{var w=t.prefix,E=null;if(null===w&&C===y||(E=g.get(w,C)),"xmlns"===w){if(s)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");E=w}null!==E?(h=E+":"+t.localName,null!==y&&y!==c.namespace.XML&&(b=y||null),this.beginElement(h),this.openTagBegin(h)):null!==w?(w in v&&(w=this._generatePrefix(C,g,a)),g.set(w,C),h+=w+":"+t.localName,this.beginElement(h),this.openTagBegin(h),p.push([null,"xmlns",w,this._serializeAttributeValue(C,s)]),null!==y&&(b=y||null)):null===y||null!==y&&y!==C?(m=!0,h+=t.localName,b=C,this.beginElement(h),this.openTagBegin(h),p.push([null,null,"xmlns",this._serializeAttributeValue(C,s)])):(h+=t.localName,b=C,this.beginElement(h),this.openTagBegin(h))}p.push.apply(p,o(this._serializeAttributesNS(t,g,a,v,m,s))),this.attributes(p);var T=C===c.namespace.HTML;if(T&&0===t.childNodes.length&&e._VoidElementNames.has(t.localName)?(this.openTagEnd(h,!0,!0),this.endElement(h),f=!0):T||0!==t.childNodes.length?this.openTagEnd(h,!1,!1):(this.openTagEnd(h,!0,!1),this.endElement(h),f=!0),!f){if(T&&"template"===t.localName);else try{for(var x=r(t.childNodes),_=x.next();!_.done;_=x.next()){var S=_.value;this.level++,this._serializeNodeNS(S,b,g,a,s),this.level--}}catch(e){l={error:e}}finally{try{_&&!_.done&&(d=x.return)&&d.call(x)}finally{if(l)throw l.error}}this.closeTag(h),this.endElement(h)}},e.prototype._serializeElement=function(e,t){var n,i;if(t&&(-1!==e.localName.indexOf(":")||!u.xml_isName(e.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var o=!1,a=e.localName;this.beginElement(a),this.openTagBegin(a);var s=this._serializeAttributes(e,t);if(this.attributes(s),e.hasChildNodes()?this.openTagEnd(a,!1,!1):(this.openTagEnd(a,!0,!1),this.endElement(a),o=!0),!o){try{for(var l=r(e._children),c=l.next();!c.done;c=l.next()){var d=c.value;this.level++,this._serializeNode(d,t),this.level--}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}this.closeTag(a),this.endElement(a)}},e.prototype._serializeDocumentNS=function(e,t,n,i,o){var a,s;if(o&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");try{for(var l=r(e.childNodes),c=l.next();!c.done;c=l.next()){var u=c.value;this._serializeNodeNS(u,t,n,i,o)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(a)throw a.error}}},e.prototype._serializeDocument=function(e,t){var n,i;if(t&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");try{for(var o=r(e._children),a=o.next();!a.done;a=o.next()){var s=a.value;this._serializeNode(s,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e.prototype._serializeComment=function(e,t){if(t&&(!u.xml_isLegalChar(e.data)||-1!==e.data.indexOf("--")||e.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");this.comment(e.data)},e.prototype._serializeText=function(e,t){if(t&&!u.xml_isLegalChar(e.data))throw new Error("Text data contains invalid characters (well-formed required).");var n=e.data.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");this.text(n)},e.prototype._serializeDocumentFragmentNS=function(e,t,n,i,o){var a,s;try{for(var l=r(e.childNodes),c=l.next();!c.done;c=l.next()){var u=c.value;this._serializeNodeNS(u,t,n,i,o)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(a)throw a.error}}},e.prototype._serializeDocumentFragment=function(e,t){var n,i;try{for(var o=r(e._children),a=o.next();!a.done;a=o.next()){var s=a.value;this._serializeNode(s,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e.prototype._serializeDocumentType=function(e,t){if(t&&!u.xml_isPubidChar(e.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(t&&(!u.xml_isLegalChar(e.systemId)||-1!==e.systemId.indexOf('"')&&-1!==e.systemId.indexOf("'")))throw new Error("DocType system identifier contains invalid characters (well-formed required).");this.docType(e.name,e.publicId,e.systemId)},e.prototype._serializeProcessingInstruction=function(e,t){if(t&&(-1!==e.target.indexOf(":")||/^xml$/i.test(e.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(t&&(!u.xml_isLegalChar(e.data)||-1!==e.data.indexOf("?>")))throw new Error("Processing instruction data contains invalid characters (well-formed required).");this.instruction(e.target,e.data)},e.prototype._serializeCData=function(e,t){if(t&&-1!==e.data.indexOf("]]>"))throw new Error("CDATA contains invalid characters (well-formed required).");this.cdata(e.data)},e.prototype._serializeAttributesNS=function(e,t,n,i,o,a){var l,d,p=[],h=a?new s.LocalNameSet:void 0;try{for(var f=r(e.attributes),m=f.next();!m.done;m=f.next()){var g=m.value;if(a||o||null!==g.namespaceURI){if(a&&h&&h.has(g.namespaceURI,g.localName))throw new Error("Element contains duplicate attributes (well-formed required).");a&&h&&h.set(g.namespaceURI,g.localName);var v=g.namespaceURI,y=null;if(null!==v)if(y=t.get(g.prefix,v),v===c.namespace.XMLNS){if(g.value===c.namespace.XML||null===g.prefix&&o||null!==g.prefix&&(!(g.localName in i)||i[g.localName]!==g.value)&&t.has(g.localName,g.value))continue;if(a&&g.value===c.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(a&&""===g.value)throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");"xmlns"===g.prefix&&(y="xmlns")}else null===y&&(y=null===g.prefix||t.hasPrefix(g.prefix)&&!t.has(g.prefix,v)?this._generatePrefix(v,t,n):g.prefix,p.push([null,"xmlns",y,this._serializeAttributeValue(v,a)]));if(a&&(-1!==g.localName.indexOf(":")||!u.xml_isName(g.localName)||"xmlns"===g.localName&&null===v))throw new Error("Attribute local name contains invalid characters (well-formed required).");p.push([v,y,g.localName,this._serializeAttributeValue(g.value,a)])}else p.push([null,null,g.localName,this._serializeAttributeValue(g.value,a)])}}catch(e){l={error:e}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}return p},e.prototype._serializeAttributes=function(e,t){var n,i,o=[],a=t?{}:void 0;try{for(var s=r(e.attributes),l=s.next();!l.done;l=s.next()){var c=l.value;if(t){if(t&&a&&c.localName in a)throw new Error("Element contains duplicate attributes (well-formed required).");if(t&&a&&(a[c.localName]=!0),t&&(-1!==c.localName.indexOf(":")||!u.xml_isName(c.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");o.push([null,null,c.localName,this._serializeAttributeValue(c.value,t)])}else o.push([null,null,c.localName,this._serializeAttributeValue(c.value,t)])}}catch(e){n={error:e}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},e.prototype._recordNamespaceInformation=function(e,t,n){var i,o,a=null;try{for(var s=r(e.attributes),l=s.next();!l.done;l=s.next()){var u=l.value,d=u.namespaceURI,p=u.prefix;if(d===c.namespace.XMLNS){if(null===p){a=u.value;continue}var h=u.localName,f=u.value;if(f===c.namespace.XML)continue;if(""===f&&(f=null),t.has(h,f))continue;t.set(h,f),n[h]=f||""}}}catch(e){i={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a},e.prototype._generatePrefix=function(e,t,n){var r="ns"+n.value.toString();return n.value++,t.set(r,e),r},e.prototype._serializeAttributeValue=function(e,t){if(t&&null!==e&&!u.xml_isLegalChar(e))throw new Error("Invalid characters in attribute value.");return null===e?"":e.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),e}();t.BaseWriter=d},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(3),s=n(7),l=n(29),c=n(17),u=n(97);function d(){var e=o.dom.window;e._mutationObserverMicrotaskQueued||(e._mutationObserverMicrotaskQueued=!0,Promise.resolve().then(function(){p()}))}function p(){var e,t,n,i,l=o.dom.window;l._mutationObserverMicrotaskQueued=!1;var c=s.set.clone(l._mutationObservers),d=s.set.clone(l._signalSlots);s.set.empty(l._signalSlots);var p=function(e){var t=s.list.clone(e._recordQueue);s.list.empty(e._recordQueue);for(var n=0;n<e._nodeList.length;n++){var r=e._nodeList[n];s.list.remove(r._registeredObserverList,function(t){return a.Guard.isTransientRegisteredObserver(t)&&t.observer===e})}if(!s.list.isEmpty(t))try{e._callback.call(e,t,e)}catch(e){}};try{for(var h=r(c),f=h.next();!f.done;f=h.next())p(f.value)}catch(t){e={error:t}}finally{try{f&&!f.done&&(t=h.return)&&t.call(h)}finally{if(e)throw e.error}}if(o.dom.features.slots)try{for(var m=r(d),g=m.next();!g.done;g=m.next()){var v=g.value;u.event_fireAnEvent("slotchange",v,void 0,{bubbles:!0})}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}}function h(e,t,n,o,a,s,u,p,h){for(var f,m,g=new Map,v=c.tree_getFirstAncestorNode(t,!0);null!==v;){for(var y=0;y<v._registeredObserverList.length;y++){var b=v._registeredObserverList[y],C=b.options;if((v===t||C.subtree)&&("attributes"!==e||C.attributes)&&("attributes"!==e||!C.attributeFilter||C.attributeFilter.indexOf(n||"")&&null===o)&&("characterData"!==e||C.characterData)&&("childList"!==e||C.childList)){var w=b.observer;g.has(w)||g.set(w,null),("attributes"===e&&C.attributeOldValue||"characterData"===e&&C.characterDataOldValue)&&g.set(w,a)}}v=c.tree_getNextAncestorNode(t,v,!0)}try{for(var E=r(g),T=E.next();!T.done;T=E.next()){var x=i(T.value,2),_=x[0],S=x[1],I=l.create_mutationRecord(e,t,l.create_nodeListStatic(t,s),l.create_nodeListStatic(t,u),p,h,n,o,S);_._recordQueue.push(I)}}catch(e){f={error:e}}finally{try{T&&!T.done&&(m=E.return)&&m.call(E)}finally{if(f)throw f.error}}d()}t.observer_queueAMutationObserverMicrotask=d,t.observer_notifyMutationObservers=p,t.observer_queueMutationRecord=h,t.observer_queueTreeMutationRecord=function(e,t,n,r,i){h("childList",e,null,null,null,t,n,r,i)},t.observer_queueAttributeMutationRecord=function(e,t,n,r){h("attributes",e,t,n,r,[],[],null,null)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(7),o=n(3),a=n(9),s=n(29),l=n(73),c=n(51),u=n(30),d=n(37),p=n(106);function h(e,t,n){r.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(t,e._localName,e._namespace,e._value),r.dom.features.customElements&&o.Guard.isCustomElementNode(t)&&l.customElement_enqueueACustomElementCallbackReaction(t,"attributeChangedCallback",[e._localName,e._value,n,e._namespace]),r.dom.features.steps&&u.dom_runAttributeChangeSteps(t,e._localName,e._value,n,e._namespace),e._value=n}function f(e,t){r.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(t,e._localName,e._namespace,null),r.dom.features.customElements&&o.Guard.isCustomElementNode(t)&&l.customElement_enqueueACustomElementCallbackReaction(t,"attributeChangedCallback",[e._localName,null,e._value,e._namespace]),r.dom.features.steps&&u.dom_runAttributeChangeSteps(t,e._localName,null,e._value,e._namespace),t._attributeList._asArray().push(e),e._element=t,t._nodeDocument._hasNamespaces||null===e._namespace&&null===e._namespacePrefix&&"xmlns"!==e._localName||(t._nodeDocument._hasNamespaces=!0)}function m(e,t){r.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(t,e._localName,e._namespace,e._value),r.dom.features.customElements&&o.Guard.isCustomElementNode(t)&&l.customElement_enqueueACustomElementCallbackReaction(t,"attributeChangedCallback",[e._localName,e._value,null,e._namespace]),r.dom.features.steps&&u.dom_runAttributeChangeSteps(t,e._localName,e._value,null,e._namespace);var n=t._attributeList._asArray().indexOf(e);t._attributeList._asArray().splice(n,1),e._element=null}function g(e,t,n){r.dom.features.mutationObservers&&c.observer_queueAttributeMutationRecord(n,e._localName,e._namespace,e._value),r.dom.features.customElements&&o.Guard.isCustomElementNode(n)&&l.customElement_enqueueACustomElementCallbackReaction(n,"attributeChangedCallback",[e._localName,e._value,t._value,e._namespace]),r.dom.features.steps&&u.dom_runAttributeChangeSteps(n,e._localName,e._value,t._value,e._namespace);var i=n._attributeList._asArray().indexOf(e);-1!==i&&(n._attributeList._asArray()[i]=t),e._element=null,t._element=n,n._nodeDocument._hasNamespaces||null===t._namespace&&null===t._namespacePrefix&&"xmlns"!==t._localName||(n._nodeDocument._hasNamespaces=!0)}function v(e,t){return t._namespace===i.namespace.HTML&&"html"===t._nodeDocument._type&&(e=e.toLowerCase()),t._attributeList._asArray().find(function(t){return t._qualifiedName===e})||null}function y(e,t,n){var r=e||null;return n._attributeList._asArray().find(function(e){return e._namespace===r&&e._localName===t})||null}t.element_has=function(e,t){return-1!==t._attributeList._asArray().indexOf(e)},t.element_change=h,t.element_append=f,t.element_remove=m,t.element_replace=g,t.element_getAnAttributeByName=v,t.element_getAnAttributeByNamespaceAndLocalName=y,t.element_getAnAttributeValue=function(e,t,n){void 0===n&&(n="");var r=y(n,t,e);return null===r?"":r._value},t.element_setAnAttribute=function(e,t){if(null!==e._element&&e._element!==t)throw new a.InUseAttributeError("This attribute already exists in the document: "+e._qualifiedName+" as a child of "+e._element._qualifiedName+".");var n=y(e._namespace||"",e._localName,t);return n===e?e:(null!==n?g(n,e,t):f(e,t),n)},t.element_setAnAttributeValue=function(e,t,n,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var o=y(i||"",t,e);if(null===o){var a=s.create_attr(e._nodeDocument,t);return a._namespace=i,a._namespacePrefix=r,a._value=n,void f(a,e)}h(o,e,n)},t.element_removeAnAttributeByName=function(e,t){var n=v(e,t);return null!==n&&m(n,t),n},t.element_removeAnAttributeByNamespaceAndLocalName=function(e,t,n){var r=y(e,t,n);return null!==r&&m(r,n),r},t.element_createAnElement=function(e,t,n,o,c,u){void 0===o&&(o=null),void 0===c&&(c=null),void 0===u&&(u=!1);var d=null;if(!r.dom.features.customElements)return(d=s.create_element(e,t,n,o))._customElementState="uncustomized",d._customElementDefinition=null,d._is=c,d;var h=l.customElement_lookUpACustomElementDefinition(e,n,t,c);if(null!==h&&h.name!==h.localName)(d=new(p.document_elementInterface(t,i.namespace.HTML)))._localName=t,d._namespace=i.namespace.HTML,d._namespacePrefix=o,d._customElementState="undefined",d._customElementDefinition=null,d._is=c,d._nodeDocument=e,u?l.customElement_upgrade(h,d):l.customElement_enqueueACustomElementUpgradeReaction(d,h);else if(null!==h)if(u)try{var f=new(0,h.constructor);if(console.assert(void 0!==f._customElementState),console.assert(void 0!==f._customElementDefinition),console.assert(f._namespace===i.namespace.HTML),0!==f._attributeList.length)throw new a.NotSupportedError("Custom element already has attributes.");if(0!==f._children.size)throw new a.NotSupportedError("Custom element already has child nodes.");if(null!==f._parent)throw new a.NotSupportedError("Custom element already has a parent node.");if(f._nodeDocument!==e)throw new a.NotSupportedError("Custom element is already in a document.");if(f._localName!==t)throw new a.NotSupportedError("Custom element has a different local name.");f._namespacePrefix=o,f._is=null}catch(n){(d=s.create_htmlUnknownElement(e,t,i.namespace.HTML,o))._customElementState="failed",d._customElementDefinition=null,d._is=null}else(d=s.create_htmlElement(e,t,i.namespace.HTML,o))._customElementState="undefined",d._customElementDefinition=null,d._is=null,l.customElement_enqueueACustomElementUpgradeReaction(d,h);else(d=new(p.document_elementInterface(t,n)))._localName=t,d._namespace=n,d._namespacePrefix=o,d._customElementState="uncustomized",d._customElementDefinition=null,d._is=c,d._nodeDocument=e,n!==i.namespace.HTML||null===c&&!l.customElement_isValidCustomElementName(t)||(d._customElementState="undefined");if(null===d)throw new Error("Unable to create element.");return d},t.element_insertAdjacent=function(e,t,n){switch(t.toLowerCase()){case"beforebegin":return null===e._parent?null:d.mutation_preInsert(n,e._parent,e);case"afterbegin":return d.mutation_preInsert(n,e,e._firstChild);case"beforeend":return d.mutation_preInsert(n,e,null);case"afterend":return null===e._parent?null:d.mutation_preInsert(n,e._parent,e._nextSibling);default:throw new a.SyntaxError('Invalid \'where\' argument. "beforebegin", "afterbegin", "beforeend" or "afterend" expected')}}},function(e,t,n){"use strict";function r(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.toString=function(e){var t=this.name+": ";return t+=this.reason||"(unknown reason)",!e&&this.mark&&(t+=" "+this.mark.toString()),t},e.exports=r},function(e,t,n){"use strict";var r=n(39);e.exports=new r({include:[n(181)],implicit:[n(293),n(294)],explicit:[n(295),n(296),n(297),n(298)]})},function(e,t,n){var r=n(16),i=n(79),o=n(40),a=n(24),s=n(56),l=n(14),c=n(115),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=a(e),t=s(t,!0),c)try{return u(e,t)}catch(e){}if(l(e,t))return o(!i.f.call(e,t),e[t])}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(81),i=n(58),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+r).toString(36)}},function(e,t,n){var r=n(42);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r,i=n(18),o=n(188),a=n(84),s=n(45),l=n(189),c=n(116),u=n(57)("IE_PROTO"),d=function(){},p=function(e){return"<script>"+e+"<\/script>"},h=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;h=r?function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t}(r):((t=c("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F);for(var n=a.length;n--;)delete h.prototype[a[n]];return h()};s[u]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(d.prototype=i(e),n=new d,d.prototype=null,n[u]=e):n=h(),void 0===t?n:o(n,t)}},function(e,t,n){var r=n(121),i=n(84);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(15).f,i=n(14),o=n(5)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){var r=n(8),i=n(5),o=n(129),a=i("species");e.exports=function(e){return o>=51||!r(function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo})}},function(e,t,n){"use strict";var r=n(4),i=n(122).indexOf,o=n(48),a=n(28),s=[].indexOf,l=!!s&&1/[1].indexOf(1,-0)<0,c=o("indexOf"),u=a("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:l||!c||!u},{indexOf:function(e){return l?s.apply(this,arguments)||0:i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(16),i=n(15).f,o=Function.prototype,a=o.toString,s=/^\s*function ([^ (]*)/;r&&!("name"in o)&&i(o,"name",{configurable:!0,get:function(){try{return a.call(this).match(s)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r=n(25),i=n(18),o=n(8),a=n(136),s=RegExp.prototype,l=s.toString,c=o(function(){return"/a/b"!=l.call({source:"a",flags:"b"})}),u="toString"!=l.name;(c||u)&&r(RegExp.prototype,"toString",function(){var e=i(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in s)?a.call(e):n)},{unsafe:!0})},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(138),n(20),n(66),n(22),n(23);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(2),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r._writerOptions=a.applyDefaults(n,{format:"object",wellFormed:!1,group:!1,verbose:!1}),r}return i(t,e),t.prototype.serialize=function(e){return this._currentList=[],this._currentIndex=0,this._listRegister=[this._currentList],this.serializeNode(e,this._writerOptions.wellFormed),this._process(this._currentList,this._writerOptions)},t.prototype._process=function(e,t){var n,r,i,o,l,c,u;if(0===e.length)return{};for(var d={},p=!1,h=0,f=0,m=0,g=0,v=0;v<e.length;v++){var y=e[v];switch(N=Object.keys(y)[0]){case"@":continue;case"#":h++;break;case"!":f++;break;case"?":m++;break;case"$":g++;break;default:d[N]?p=!0:d[N]=!0}}var b=this._getAttrKey(),C=this._getNodeKey(s.NodeType.Text),w=this._getNodeKey(s.NodeType.Comment),E=this._getNodeKey(s.NodeType.ProcessingInstruction),T=this._getNodeKey(s.NodeType.CData);if(1===h&&1===e.length&&a.isString(e[0]["#"]))return e[0]["#"];if(p){var x={};for(v=0;v<e.length;v++)if(y=e[v],"@"===(N=Object.keys(y)[0])){var _=y["@"];1===(L=Object.keys(_)).length?x[b+L[0]]=_[L[0]]:x[b]=y["@"]}var S=[];for(v=0;v<e.length;v++)switch(y=e[v],N=Object.keys(y)[0]){case"@":break;case"#":S.push(((n={})[C]=y["#"],n));break;case"!":S.push(((r={})[w]=y["!"],r));break;case"?":S.push(((i={})[E]=y["?"],i));break;case"$":S.push(((o={})[T]=y.$,o));break;default:if(0!==(F=y)[N].length&&a.isArray(F[N][0])){for(var I=[],D=F[N],A=0;A<D.length;A++)I.push(this._process(D[A],t));S.push(((l={})[N]=I,l))}else t.verbose?S.push(((c={})[N]=[this._process(F[N],t)],c)):S.push(((u={})[N]=this._process(F[N],t),u))}return x[C]=S,x}var P=1,O=1,R=1,M=1;for(x={},v=0;v<e.length;v++){var N;switch(y=e[v],N=Object.keys(y)[0]){case"@":_=y["@"];var L=Object.keys(_);if(t.group&&1!==L.length)x[b]=_;else for(var k in _)x[b+k]=_[k];break;case"#":P=this._processSpecItem(y["#"],x,t.group,C,h,P);break;case"!":O=this._processSpecItem(y["!"],x,t.group,w,f,O);break;case"?":R=this._processSpecItem(y["?"],x,t.group,E,m,R);break;case"$":M=this._processSpecItem(y.$,x,t.group,T,g,M);break;default:var F;if(0!==(F=y)[N].length&&a.isArray(F[N][0])){I=[],D=F[N];for(var V=0;V<D.length;V++)I.push(this._process(D[V],t));x[N]=I}else t.verbose?x[N]=[this._process(F[N],t)]:x[N]=this._process(F[N],t)}}return x},t.prototype._processSpecItem=function(e,t,n,r,i,s){var l,c;if(!n&&a.isArray(e)&&i+e.length>2)try{for(var u=o(e),d=u.next();!d.done;d=u.next()){var p=d.value;t[r+(s++).toString()]=p}}catch(e){l={error:e}}finally{try{d&&!d.done&&(c=u.return)&&c.call(u)}finally{if(l)throw l.error}}else t[i>1?r+(s++).toString():r]=e;return s},t.prototype.beginElement=function(e){var t,n,r=[];if(0===this._currentList.length)this._currentList.push(((t={})[e]=r,t));else{var i=this._currentList[this._currentList.length-1];this._isElementNode(i,e)?0!==i[e].length&&a.isArray(i[e][0])?i[e].push(r):i[e]=[i[e],r]:this._currentList.push(((n={})[e]=r,n))}this._currentIndex++,this._listRegister.length>this._currentIndex?this._listRegister[this._currentIndex]=r:this._listRegister.push(r),this._currentList=r},t.prototype.endElement=function(){this._currentList=this._listRegister[--this._currentIndex]},t.prototype.attribute=function(e,t){var n,r;if(0===this._currentList.length)this._currentList.push({"@":(n={},n[e]=t,n)});else{var i=this._currentList[this._currentList.length-1];this._isAttrNode(i)?i["@"][e]=t:this._currentList.push({"@":(r={},r[e]=t,r)})}},t.prototype.comment=function(e){if(0===this._currentList.length)this._currentList.push({"!":e});else{var t=this._currentList[this._currentList.length-1];this._isCommentNode(t)?a.isArray(t["!"])?t["!"].push(e):t["!"]=[t["!"],e]:this._currentList.push({"!":e})}},t.prototype.text=function(e){if(0===this._currentList.length)this._currentList.push({"#":e});else{var t=this._currentList[this._currentList.length-1];this._isTextNode(t)?a.isArray(t["#"])?t["#"].push(e):t["#"]=[t["#"],e]:this._currentList.push({"#":e})}},t.prototype.instruction=function(e,t){var n=""===t?e:e+" "+t;if(0===this._currentList.length)this._currentList.push({"?":n});else{var r=this._currentList[this._currentList.length-1];this._isInstructionNode(r)?a.isArray(r["?"])?r["?"].push(n):r["?"]=[r["?"],n]:this._currentList.push({"?":n})}},t.prototype.cdata=function(e){if(0===this._currentList.length)this._currentList.push({$:e});else{var t=this._currentList[this._currentList.length-1];this._isCDATANode(t)?a.isArray(t.$)?t.$.push(e):t.$=[t.$,e]:this._currentList.push({$:e})}},t.prototype._isAttrNode=function(e){return"@"in e},t.prototype._isTextNode=function(e){return"#"in e},t.prototype._isCommentNode=function(e){return"!"in e},t.prototype._isInstructionNode=function(e){return"?"in e},t.prototype._isCDATANode=function(e){return"$"in e},t.prototype._isElementNode=function(e,t){return t in e},t.prototype._getAttrKey=function(){return this._builderOptions.convert.att},t.prototype._getNodeKey=function(e){switch(e){case s.NodeType.Comment:return this._builderOptions.convert.comment;case s.NodeType.Text:return this._builderOptions.convert.text;case s.NodeType.ProcessingInstruction:return this._builderOptions.convert.ins;case s.NodeType.CData:return this._builderOptions.convert.cdata;default:throw new Error("Invalid node type.")}},t}(n(50).BaseWriter);t.ObjectWriter=l},function(e,t,n){"use strict";var r=n(4),i=n(93);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._items={},this._nullItems={}}return e.prototype.set=function(e,t){null===e?this._nullItems[t]=!0:(this._items[e]||(this._items[e]={}),this._items[e][t]=!0)},e.prototype.has=function(e,t){return null===e?!0===this._nullItems[t]:!!this._items[e]&&!0===this._items[e][t]},e}();t.LocalNameSet=r},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),o=n(3),a=n(0),s=function(){function e(){}return Object.defineProperty(e.prototype,"_eventListenerList",{get:function(){return this.__eventListenerList||(this.__eventListenerList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_eventHandlerMap",{get:function(){return this.__eventHandlerMap||(this.__eventHandlerMap={})},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t,n){void 0===n&&(n={passive:!1,once:!1,capture:!1});var i,s=r(a.eventTarget_flattenMore(n),3),l=s[0],c=s[1],u=s[2];t&&(i=o.Guard.isEventListener(t)?t:{handleEvent:t},a.eventTarget_addEventListener(this,{type:e,callback:i,capture:l,passive:c,once:u,removed:!1}))},e.prototype.removeEventListener=function(e,t,n){void 0===n&&(n={capture:!1});var r=a.eventTarget_flatten(n);if(t)for(var i=0;i<this._eventListenerList.length;i++){var s=this._eventListenerList[i];if(s.type===e&&s.capture===r){if(o.Guard.isEventListener(t)&&s.callback===t){a.eventTarget_removeEventListener(this,s,i);break}if(t&&s.callback.handleEvent===t){a.eventTarget_removeEventListener(this,s,i);break}}}},e.prototype.dispatchEvent=function(e){if(e._dispatchFlag||!e._initializedFlag)throw new i.InvalidStateError;return e._isTrusted=!1,a.event_dispatch(e,this)},e.prototype._getTheParent=function(e){return null},e}();t.EventTargetImpl=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(34),a=n(0),s=function(e){function t(t){var n=e.call(this)||this;return n._data=t,n}return i(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){a.characterData_replaceData(this,0,this._data.length,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),t.prototype.substringData=function(e,t){return a.characterData_substringData(this,e,t)},t.prototype.appendData=function(e){return a.characterData_replaceData(this,this._data.length,0,e)},t.prototype.insertData=function(e,t){a.characterData_replaceData(this,e,0,t)},t.prototype.deleteData=function(e,t){a.characterData_replaceData(this,e,t,"")},t.prototype.replaceData=function(e,t,n){a.characterData_replaceData(this,e,t,n)},Object.defineProperty(t.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},t}(o.NodeImpl);t.CharacterDataImpl=s},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(3),l=n(1),c=n(17),u=n(51);function d(e){a.dom.window._signalSlots.add(e),u.observer_queueAMutationObserverMicrotask()}function p(e,t){void 0===t&&(t=!1);var n=s.Cast.asNode(e)._parent;if(null===n)return null;var r=n._shadowRoot||null;if(null===r)return null;if(t&&"open"!==r._mode)return null;for(var i=c.tree_getFirstDescendantNode(r,!1,!0,function(e){return s.Guard.isSlot(e)});null!==i;){if(i._name===e._name)return i;i=c.tree_getNextDescendantNode(r,i,!1,!0,function(e){return s.Guard.isSlot(e)})}return null}function h(e){var t,n,i=[],o=c.tree_rootNode(e);if(!s.Guard.isShadowRoot(o))return i;var a=o._host;try{for(var l=r(a._children),u=l.next();!u.done;u=l.next()){var d=u.value;s.Guard.isSlotable(d)&&p(d)===e&&i.push(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return i}function f(e){var t,n,i=h(e);if(i.length===e._assignedNodes.length){for(var o=!0,a=0;a<i.length;a++)if(i[a]!==e._assignedNodes[a]){o=!1;break}o||d(e)}e._assignedNodes=i;try{for(var s=r(i),l=s.next();!l.done;l=s.next())l.value._assignedSlot=e}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}}t.shadowTree_signalASlotChange=d,t.shadowTree_isConnected=function(e){return s.Guard.isDocumentNode(c.tree_rootNode(e,!0))},t.shadowTree_isAssigned=function(e){return null!==e._assignedSlot},t.shadowTree_findASlot=p,t.shadowTree_findSlotables=h,t.shadowTree_findFlattenedSlotables=function e(t){var n,i,a,u,d=[],p=c.tree_rootNode(t);if(!s.Guard.isShadowRoot(p))return d;var f=h(t);if(l.isEmpty(f))try{for(var m=r(t._children),g=m.next();!g.done;g=m.next()){var v=g.value;s.Guard.isSlotable(v)&&f.push(v)}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}try{for(var y=r(f),b=y.next();!b.done;b=y.next()){var C=b.value;if(s.Guard.isSlot(C)&&s.Guard.isShadowRoot(c.tree_rootNode(C))){var w=e(C);d.push.apply(d,o(w))}else d.push(C)}}catch(e){a={error:e}}finally{try{b&&!b.done&&(u=y.return)&&u.call(y)}finally{if(a)throw a.error}}return d},t.shadowTree_assignSlotables=f,t.shadowTree_assignSlotablesForATree=function(e){for(var t=c.tree_getFirstDescendantNode(e,!0,!1,function(e){return s.Guard.isSlot(e)});null!==t;)f(t),t=c.tree_getNextDescendantNode(e,t,!0,!1,function(e){return s.Guard.isSlot(e)})},t.shadowTree_assignASlot=function(e){var t=p(e);null!==t&&f(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=/[a-z]([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*/,i=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]),o=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),a=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),s=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);t.customElement_isValidCustomElementName=function(e){return!!r.test(e)&&!i.has(e)},t.customElement_isValidElementName=function(e){return o.has(e)},t.customElement_isVoidElementName=function(e){return a.has(e)},t.customElement_isValidShadowHostName=function(e){return s.has(e)},t.customElement_enqueueACustomElementUpgradeReaction=function(e,t){},t.customElement_enqueueACustomElementCallbackReaction=function(e,t,n){},t.customElement_upgrade=function(e,t){},t.customElement_tryToUpgrade=function(e){},t.customElement_lookUpACustomElementDefinition=function(e,t,n,r){return null}},function(e,t,n){n(4)({target:"String",proto:!0},{repeat:n(259)})},function(e,t,n){"use strict";n(278),n(68),n(179),n(94),Object.defineProperty(t,"__esModule",{value:!0});var r=n(109),i=function(){function e(e){this._builderOptions=e,e.parser&&Object.assign(this,e.parser)}return e.prototype._docType=function(e,t,n,r){return e.dtd({name:t,pubID:n,sysID:r})},e.prototype._comment=function(e,t){return e.com(t)},e.prototype._text=function(e,t){return e.txt(t)},e.prototype._instruction=function(e,t,n){return e.ins(t,n)},e.prototype._cdata=function(e,t){return e.dat(t)},e.prototype._element=function(e,t,n){return void 0===t?e.ele(n):e.ele(t,n)},e.prototype._attribute=function(e,t,n,r){return void 0===t?e.att(n,r):e.att(t,n,r)},e.prototype._sanitize=function(e){return r.sanitizeInput(e,this._builderOptions.invalidCharReplacement)},e.prototype._decodeText=function(t){return null==t?t:t.replace(/&(quot|amp|apos|lt|gt);/g,function(t,n){return e._entityTable[n]}).replace(/&#(?:x([a-fA-F0-9]+)|([0-9]+));/g,function(e,t,n){return String.fromCodePoint(parseInt(t||n,t?16:10))})},e.prototype._decodeAttributeValue=function(e){return this._decodeText(e)},e.prototype.parse=function(e,t){return this._parse(e,t)},e.prototype.docType=function(e,t,n,r){return this._docType(e,t,n,r)},e.prototype.comment=function(e,t){return this._comment(e,t)},e.prototype.text=function(e,t){return this._text(e,t)},e.prototype.instruction=function(e,t,n){return this._instruction(e,t,n)},e.prototype.cdata=function(e,t){return this._cdata(e,t)},e.prototype.element=function(e,t,n){return this._element(e,t,n)},e.prototype.attribute=function(e,t,n,r){return this._attribute(e,t,n,r)},e.prototype.sanitize=function(e){return this._sanitize(e)},e._entityTable={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},e}();t.BaseReader=i},function(e,t,n){"use strict";var r=n(39);e.exports=r.DEFAULT=new r({include:[n(54)],explicit:[n(299),n(300),n(301)]})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(185);t.XMLBuilderImpl=r.XMLBuilderImpl;var i=n(304);t.XMLBuilderCBImpl=i.XMLBuilderCBImpl;var o=n(183);t.builder=o.builder,t.create=o.create,t.fragment=o.fragment,t.convert=o.convert;var a=n(309);t.createCB=a.createCB,t.fragmentCB=a.fragmentCB},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!r.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},function(e,t,n){var r=n(11),i=n(21);e.exports=function(e,t){try{i(r,e,t)}catch(n){r[e]=t}return t}},function(e,t,n){var r=n(44),i=n(118);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:r?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(121),i=n(84).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(47),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(8);e.exports=!!Object.getOwnPropertySymbols&&!r(function(){return!String(Symbol())})},function(e,t,n){var r=n(127);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";var r=n(4),i=n(195),o=n(132),a=n(133),s=n(62),l=n(21),c=n(25),u=n(5),d=n(44),p=n(49),h=n(131),f=h.IteratorPrototype,m=h.BUGGY_SAFARI_ITERATORS,g=u("iterator"),v=function(){return this};e.exports=function(e,t,n,u,h,y,b){i(n,t,u);var C,w,E,T=function(e){if(e===h&&D)return D;if(!m&&e in S)return S[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},x=t+" Iterator",_=!1,S=e.prototype,I=S[g]||S["@@iterator"]||h&&S[h],D=!m&&I||T(h),A="Array"==t&&S.entries||I;if(A&&(C=o(A.call(new e)),f!==Object.prototype&&C.next&&(d||o(C)===f||(a?a(C,f):"function"!=typeof C[g]&&l(C,g,v)),s(C,x,!0,!0),d&&(p[x]=v))),"values"==h&&I&&"values"!==I.name&&(_=!0,D=function(){return I.call(this)}),d&&!b||S[g]===D||l(S,g,D),p[t]=D,h)if(w={values:T("values"),keys:y?D:T("keys"),entries:T("entries")},b)for(E in w)(m||_||!(E in S))&&c(S,E,w[E]);else r({target:t,proto:!0,forced:m||_},w);return w}},function(e,t,n){"use strict";var r=n(4),i=n(13),o=n(59),a=n(83),s=n(26),l=n(24),c=n(134),u=n(5),d=n(63),p=n(28),h=d("slice"),f=p("slice",{ACCESSORS:!0,0:0,1:2}),m=u("species"),g=[].slice,v=Math.max;r({target:"Array",proto:!0,forced:!h||!f},{slice:function(e,t){var n,r,u,d=l(this),p=s(d.length),h=a(e,p),f=a(void 0===t?p:t,p);if(o(d)&&("function"!=typeof(n=d.constructor)||n!==Array&&!o(n.prototype)?i(n)&&null===(n=n[m])&&(n=void 0):n=void 0,n===Array||void 0===n))return g.call(d,h,f);for(r=new(void 0===n?Array:n)(v(f-h,0)),u=0;h<f;h++,u++)h in d&&c(r,u,d[h]);return r.length=u,r}})},function(e,t,n){var r={};r[n(5)("toStringTag")]="z",e.exports="[object z]"===String(r)},function(e,t,n){"use strict";n(19),n(138),n(20),n(92),n(22),n(23),Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultBuilderOptions={version:"1.0",encoding:void 0,standalone:void 0,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},invalidCharReplacement:void 0,parser:void 0},t.XMLBuilderOptionKeys=new Set(Object.keys(t.DefaultBuilderOptions)),t.DefaultXMLBuilderCBOptions={format:"xml",wellFormed:!1,prettyPrint:!1,indent:"  ",newline:"\n",offset:0,width:0,allowEmptyTags:!1,spaceBeforeSlash:!1,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}}},function(e,t,n){"use strict";var r=n(139),i=n(143);e.exports=r("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},i)},function(e,t,n){"use strict";var r,i,o=n(136),a=n(221),s=RegExp.prototype.exec,l=String.prototype.replace,c=s,u=(r=/a/,i=/b*/g,s.call(r,"a"),s.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),d=a.UNSUPPORTED_Y||a.BROKEN_CARET,p=void 0!==/()??/.exec("")[1];(u||p||d)&&(c=function(e){var t,n,r,i,a=this,c=d&&a.sticky,h=o.call(a),f=a.source,m=0,g=e;return c&&(-1===(h=h.replace("y","")).indexOf("g")&&(h+="g"),g=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(f="(?: "+f+")",g=" "+g,m++),n=new RegExp("^(?:"+f+")",h)),p&&(n=new RegExp("^"+f+"$(?!\\s)",h)),u&&(t=a.lastIndex),r=s.call(c?n:a,g),c?r?(r.input=r.input.slice(m),r[0]=r[0].slice(m),r.index=a.lastIndex,a.lastIndex+=r[0].length):a.lastIndex=0:u&&r&&(a.lastIndex=a.global?r.index+r[0].length:t),p&&r&&r.length>1&&l.call(r[0],n,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r}),e.exports=c},function(e,t,n){"use strict";var r=n(225),i=n(18),o=n(27),a=n(26),s=n(47),l=n(35),c=n(226),u=n(227),d=Math.max,p=Math.min,h=Math.floor,f=/\$([$&'`]|\d\d?|<[^>]*>)/g,m=/\$([$&'`]|\d\d?)/g;r("replace",2,function(e,t,n,r){var g=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,v=r.REPLACE_KEEPS_$0,y=g?"$":"$0";return[function(n,r){var i=l(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!g&&v||"string"==typeof r&&-1===r.indexOf(y)){var o=n(t,e,this,r);if(o.done)return o.value}var l=i(e),h=String(this),f="function"==typeof r;f||(r=String(r));var m=l.global;if(m){var C=l.unicode;l.lastIndex=0}for(var w=[];;){var E=u(l,h);if(null===E)break;if(w.push(E),!m)break;""===String(E[0])&&(l.lastIndex=c(h,a(l.lastIndex),C))}for(var T,x="",_=0,S=0;S<w.length;S++){E=w[S];for(var I=String(E[0]),D=d(p(s(E.index),h.length),0),A=[],P=1;P<E.length;P++)A.push(void 0===(T=E[P])?T:String(T));var O=E.groups;if(f){var R=[I].concat(A,D,h);void 0!==O&&R.push(O);var M=String(r.apply(void 0,R))}else M=b(I,h,D,A,O,r);D>=_&&(x+=h.slice(_,D)+M,_=D+I.length)}return x+h.slice(_)}];function b(e,n,r,i,a,s){var l=r+e.length,c=i.length,u=m;return void 0!==a&&(a=o(a),u=f),t.call(s,u,function(t,o){var s;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(l);case"<":s=a[o.slice(1,-1)];break;default:var u=+o;if(0===u)return t;if(u>c){var d=h(u/10);return 0===d?t:d<=c?void 0===i[d-1]?o.charAt(1):i[d-1]+o.charAt(1):t}s=i[u-1]}return void 0===s?"":s})}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._items={},this._nullItems=[]}return e.prototype.copy=function(){var t=new e;for(var n in this._items)t._items[n]=this._items[n].slice(0);return t._nullItems=this._nullItems.slice(0),t},e.prototype.get=function(e,t){var n=null===t?this._nullItems:this._items[t]||null;if(null===n)return null;for(var r=null,i=0;i<n.length;i++)if((r=n[i])===e)return r;return r},e.prototype.has=function(e,t){var n=null===t?this._nullItems:this._items[t]||null;return null!==n&&-1!==n.indexOf(e)},e.prototype.hasPrefix=function(e){if(-1!==this._nullItems.indexOf(e))return!0;for(var t in this._items)if(-1!==this._items[t].indexOf(e))return!0;return!1},e.prototype.set=function(e,t){var n=null===t?this._nullItems:this._items[t]||null;null!==t&&null===n?this._items[t]=[e]:n.push(e)},e}();t.NamespacePrefixMap=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Surrogate=/[\uD800-\uDFFF]/,t.ScalarValue=/[\uD800-\uDFFF]/,t.NonCharacter=/[\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]/,t.ASCIICodePoint=/[\u0000-\u007F]/,t.ASCIITabOrNewLine=/[\t\n\r]/,t.ASCIIWhiteSpace=/[\t\n\f\r ]/,t.C0Control=/[\u0000-\u001F]/,t.C0ControlOrSpace=/[\u0000-\u001F ]/,t.Control=/[\u0000-\u001F\u007F-\u009F]/,t.ASCIIDigit=/[0-9]/,t.ASCIIUpperHexDigit=/[0-9A-F]/,t.ASCIILowerHexDigit=/[0-9a-f]/,t.ASCIIHexDigit=/[0-9A-Fa-f]/,t.ASCIIUpperAlpha=/[A-Z]/,t.ASCIILowerAlpha=/[a-z]/,t.ASCIIAlpha=/[A-Za-z]/,t.ASCIIAlphanumeric=/[0-9A-Za-z]/},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(2),l=n(3),c=n(171),u=n(104),d=n(9),p=n(17),h=n(72),f=n(30);function m(e,t){void 0===t&&(t=void 0),void 0===t&&(t=null);var n=g(e,t,new Date,{});return n._isTrusted=!0,n}function g(e,t,n,r){var i=new e("");return i._initializedFlag=!0,i._timeStamp=n.getTime(),Object.assign(i,r),a.dom.features.steps&&f.dom_runEventConstructingSteps(i),i}function v(e,t,n,i){var o,a,c,u;void 0===n&&(n=!1),void 0===i&&(i={value:!1});var d=!1;e._dispatchFlag=!0;var f=t;if(n){var m=t._associatedDocument;l.Guard.isDocumentNode(m)&&(f=m)}var g=null,v=p.tree_retarget(e._relatedTarget,t);if(t!==v||t===e._relatedTarget){var C=[];try{for(var w=r(e._touchTargetList),E=w.next();!E.done;E=w.next()){var T=E.value;C.push(p.tree_retarget(T,t))}}catch(e){o={error:e}}finally{try{E&&!E.done&&(a=w.return)&&a.call(w)}finally{if(o)throw o.error}}y(e,t,f,v,C,!1);var x=l.Guard.isMouseEvent(e)&&"click"===e._type;x&&void 0!==t._activationBehavior&&(g=t);for(var _=l.Guard.isSlotable(t)&&h.shadowTree_isAssigned(t)?t:null,S=!1,I=t._getTheParent(e);null!==I&&l.Guard.isNode(I);){if(null!==_){if(!l.Guard.isSlot(I))throw new Error("Parent node of a slotable should be a slot.");_=null;var D=p.tree_rootNode(I,!0);l.Guard.isShadowRoot(D)&&"closed"===D._mode&&(S=!0)}l.Guard.isSlotable(I)&&h.shadowTree_isAssigned(I)&&(_=I),v=p.tree_retarget(e._relatedTarget,I),C=[];try{for(var A=(c=void 0,r(e._touchTargetList)),P=A.next();!P.done;P=A.next())T=P.value,C.push(p.tree_retarget(T,I))}catch(e){c={error:e}}finally{try{P&&!P.done&&(u=A.return)&&u.call(A)}finally{if(c)throw c.error}}l.Guard.isWindow(I)||l.Guard.isNode(I)&&l.Guard.isNode(t)&&p.tree_isAncestorOf(p.tree_rootNode(t,!0),I,!0,!0)?(x&&e._bubbles&&null===g&&I._activationBehavior&&(g=I),y(e,I,null,v,C,S)):I===v?I=null:(t=I,x&&null===g&&t._activationBehavior&&(g=t),y(e,I,t,v,C,S)),null!==I&&(I=I._getTheParent(e)),S=!1}for(var O=null,R=e._path,M=R.length-1;M>=0;M--)if(null!==(L=R[M]).shadowAdjustedTarget){O=L;break}if(null!==O)if(l.Guard.isNode(O.shadowAdjustedTarget)&&l.Guard.isShadowRoot(p.tree_rootNode(O.shadowAdjustedTarget,!0)))d=!0;else if(l.Guard.isNode(O.relatedTarget)&&l.Guard.isShadowRoot(p.tree_rootNode(O.relatedTarget,!0)))d=!0;else for(var N=0;N<O.touchTargetList.length;N++){var L=O.touchTargetList[N];if(l.Guard.isNode(L)&&l.Guard.isShadowRoot(p.tree_rootNode(L,!0))){d=!0;break}}for(null!==g&&void 0!==g._legacyPreActivationBehavior&&g._legacyPreActivationBehavior(e),M=R.length-1;M>=0;M--)null!==(L=R[M]).shadowAdjustedTarget?e._eventPhase=s.EventPhase.AtTarget:e._eventPhase=s.EventPhase.Capturing,b(L,e,"capturing",i);for(M=0;M<R.length;M++){if(null!==(L=R[M]).shadowAdjustedTarget)e._eventPhase=s.EventPhase.AtTarget;else{if(!e._bubbles)continue;e._eventPhase=s.EventPhase.Bubbling}b(L,e,"bubbling",i)}}return e._eventPhase=s.EventPhase.None,e._currentTarget=null,e._path=[],e._dispatchFlag=!1,e._stopPropagationFlag=!1,e._stopImmediatePropagationFlag=!1,d&&(e._target=null,e._relatedTarget=null,e._touchTargetList=[]),null!==g&&(e._canceledFlag||void 0===g._activationBehavior?void 0!==g._legacyCanceledActivationBehavior&&g._legacyCanceledActivationBehavior(e):g._activationBehavior(e)),!e._canceledFlag}function y(e,t,n,r,i,o){var a=!1;l.Guard.isNode(t)&&l.Guard.isShadowRoot(p.tree_rootNode(t))&&(a=!0);var s=!1;l.Guard.isShadowRoot(t)&&"closed"===t._mode&&(s=!0),e._path.push({invocationTarget:t,invocationTargetInShadowTree:a,shadowAdjustedTarget:n,relatedTarget:r,touchTargetList:i,rootOfClosedTree:s,slotInClosedTree:o})}function b(e,t,n,r){void 0===r&&(r={value:!1});for(var i=t._path,a=-1,s=0;s<i.length;s++)if(i[s]===e){a=s;break}if(-1!==a){var l=i[a];(null!==l.shadowAdjustedTarget||a>0&&null!==(l=i[a-1]).shadowAdjustedTarget)&&(t._target=l.shadowAdjustedTarget)}if(t._relatedTarget=e.relatedTarget,t._touchTargetList=e.touchTargetList,!t._stopPropagationFlag){t._currentTarget=e.invocationTarget;var c=t._currentTarget._eventListenerList,u=new(Array.bind.apply(Array,o([void 0],c)));if(!C(t,u,n,e,r)&&t._isTrusted){var d=t._type;"animationend"===d?t._type="webkitAnimationEnd":"animationiteration"===d?t._type="webkitAnimationIteration":"animationstart"===d?t._type="webkitAnimationStart":"transitionend"===d&&(t._type="webkitTransitionEnd"),C(t,u,n,e,r),t._type=d}}}function C(e,t,n,r,i){void 0===i&&(i={value:!1});for(var o=!1,a=0;a<t.length;a++){var s=t[a];if(!s.removed){if(e._type!==s.type)continue;if(o=!0,"capturing"===n&&!s.capture)continue;if("bubbling"===n&&s.capture)continue;if(s.once&&null!==e._currentTarget){for(var c=e._currentTarget,u=-1,d=0;d<c._eventListenerList.length;d++)if(c._eventListenerList[d]===s){u=d;break}-1!==u&&c._eventListenerList.splice(u,1)}var p=void 0,h=void 0;l.Guard.isWindow(p)&&(h=p._currentEvent,!1===r.invocationTargetInShadowTree&&(p._currentEvent=e)),s.passive&&(e._inPassiveListenerFlag=!0);try{s.callback.handleEvent.call(e._currentTarget,e)}catch(e){i.value=!0}if(s.passive&&(e._inPassiveListenerFlag=!1),l.Guard.isWindow(p)&&(p._currentEvent=h),e._stopImmediatePropagationFlag)return o}}return o}function w(e,t){return null}function E(e,t){return null}function T(e,t){}function x(e,t){}t.event_setTheCanceledFlag=function(e){e._cancelable&&!e._inPassiveListenerFlag&&(e._canceledFlag=!0)},t.event_initialize=function(e,t,n,r){e._initializedFlag=!0,e._stopPropagationFlag=!1,e._stopImmediatePropagationFlag=!1,e._canceledFlag=!1,e._isTrusted=!1,e._target=null,e._type=t,e._bubbles=n,e._cancelable=r},t.event_createAnEvent=m,t.event_innerEventCreationSteps=g,t.event_dispatch=v,t.event_appendToAnEventPath=y,t.event_invoke=b,t.event_innerInvoke=C,t.event_fireAnEvent=function(e,t,n,r,i){void 0===n&&(n=u.EventImpl);var o=m(n);if(o._type=e,r)for(var a in r)o[a]=r[a];return v(o,t,i)},t.event_createLegacyEvent=function(e){var t=null;switch(e.toLowerCase()){case"beforeunloadevent":case"compositionevent":case"devicemotionevent":case"deviceorientationevent":case"dragevent":break;case"customevent":t=c.CustomEventImpl;break;case"event":case"events":t=u.EventImpl}if(null===t)throw new d.NotSupportedError("Event constructor not found for interface "+e+".");var n=new t("");return n._type="",n._timeStamp=(new Date).getTime(),n._isTrusted=!1,n._initializedFlag=!1,n},t.event_getterEventHandlerIDLAttribute=function(e,t){return null},t.event_setterEventHandlerIDLAttribute=function(e,t,n){},t.event_determineTheTargetOfAnEventHandler=w,t.event_getTheCurrentValueOfAnEventHandler=E,t.event_activateAnEventHandler=T,t.event_deactivateAnEventHandler=x},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),l=n(2),c=n(9),u=n(34),d=n(3),p=n(1),h=n(7),f=n(152),m=n(0),g=n(12),v=function(e){function t(){var t=e.call(this)||this;return t._children=new Set,t._encoding={name:"UTF-8",labels:["unicode-1-1-utf-8","utf-8","utf8"]},t._contentType="application/xml",t._URL={scheme:"about",username:"",password:"",host:null,port:null,path:["blank"],query:null,fragment:null,_cannotBeABaseURLFlag:!0,_blobURLEntry:null},t._origin=null,t._type="xml",t._mode="no-quirks",t._documentElement=null,t._hasNamespaces=!1,t._nodeDocumentOverwrite=null,t}return i(t,e),Object.defineProperty(t.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverwrite||this},set:function(e){this._nodeDocumentOverwrite=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"implementation",{get:function(){return this._implementation||(this._implementation=m.create_domImplementation(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"URL",{get:function(){return f.urlSerializer(this._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"documentURI",{get:function(){return this.URL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return"null"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"compatMode",{get:function(){return"quirks"===this._mode?"BackCompat":"CSS1Compat"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"characterSet",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"charset",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputEncoding",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"doctype",{get:function(){var e,t;try{for(var n=o(this._children),r=n.next();!r.done;r=n.next()){var i=r.value;if(d.Guard.isDocumentTypeNode(i))return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"documentElement",{get:function(){return this._documentElement},enumerable:!0,configurable:!0}),t.prototype.getElementsByTagName=function(e){return m.node_listOfElementsWithQualifiedName(e,this)},t.prototype.getElementsByTagNameNS=function(e,t){return m.node_listOfElementsWithNamespace(e,t,this)},t.prototype.getElementsByClassName=function(e){return m.node_listOfElementsWithClassNames(e,this)},t.prototype.createElement=function(e,t){if(!m.xml_isName(e))throw new c.InvalidCharacterError;"html"===this._type&&(e=e.toLowerCase());var n=null;void 0!==t&&(n=p.isString(t)?t:t.is);var r="html"===this._type||"application/xhtml+xml"===this._contentType?h.namespace.HTML:null;return m.element_createAnElement(this,e,r,null,n,!0)},t.prototype.createElementNS=function(e,t,n){return m.document_internalCreateElementNS(this,e,t,n)},t.prototype.createDocumentFragment=function(){return m.create_documentFragment(this)},t.prototype.createTextNode=function(e){return m.create_text(this,e)},t.prototype.createCDATASection=function(e){if("html"===this._type)throw new c.NotSupportedError;if(-1!==e.indexOf("]]>"))throw new c.InvalidCharacterError;return m.create_cdataSection(this,e)},t.prototype.createComment=function(e){return m.create_comment(this,e)},t.prototype.createProcessingInstruction=function(e,t){if(!m.xml_isName(e))throw new c.InvalidCharacterError;if(-1!==t.indexOf("?>"))throw new c.InvalidCharacterError;return m.create_processingInstruction(this,e,t)},t.prototype.importNode=function(e,t){if(void 0===t&&(t=!1),d.Guard.isDocumentNode(e)||d.Guard.isShadowRoot(e))throw new c.NotSupportedError;return m.node_clone(e,this,t)},t.prototype.adoptNode=function(e){if(d.Guard.isDocumentNode(e))throw new c.NotSupportedError;if(d.Guard.isShadowRoot(e))throw new c.HierarchyRequestError;return m.document_adopt(e,this),e},t.prototype.createAttribute=function(e){if(!m.xml_isName(e))throw new c.InvalidCharacterError;return"html"===this._type&&(e=e.toLowerCase()),m.create_attr(this,e)},t.prototype.createAttributeNS=function(e,t){var n=a(m.namespace_validateAndExtract(e,t),3),r=n[0],i=n[1],o=n[2],s=m.create_attr(this,o);return s._namespace=r,s._namespacePrefix=i,s},t.prototype.createEvent=function(e){return m.event_createLegacyEvent(e)},t.prototype.createRange=function(){var e=m.create_range();return e._start=[this,0],e._end=[this,0],e},t.prototype.createNodeIterator=function(e,t,n){void 0===t&&(t=l.WhatToShow.All),void 0===n&&(n=null);var r=m.create_nodeIterator(e,e,!0);return r._whatToShow=t,r._iteratorCollection=m.create_nodeList(e),p.isFunction(n)?(r._filter=m.create_nodeFilter(),r._filter.acceptNode=n):r._filter=n,r},t.prototype.createTreeWalker=function(e,t,n){void 0===t&&(t=l.WhatToShow.All),void 0===n&&(n=null);var r=m.create_treeWalker(e,e);return r._whatToShow=t,p.isFunction(n)?(r._filter=m.create_nodeFilter(),r._filter.acceptNode=n):r._filter=n,r},t.prototype._getTheParent=function(e){return"load"===e._type?null:s.dom.window},t.prototype.getElementById=function(e){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(t.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelector=function(e){throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelectorAll=function(e){throw new Error("Mixin: ParentNode not implemented.")},t}(u.NodeImpl);t.DocumentImpl=v,g.idl_defineConst(v.prototype,"_nodeType",l.NodeType.Document)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),l=n(34),c=n(9),u=n(7),d=n(0),p=n(12),h=function(e){function t(){var t=e.call(this)||this;return t._children=new Set,t._namespace=null,t._namespacePrefix=null,t._localName="",t._customElementState="undefined",t._customElementDefinition=null,t._is=null,t._shadowRoot=null,t._attributeList=d.create_namedNodeMap(t),t._attributeChangeSteps=[],t._name="",t._assignedSlot=null,t}return i(t,e),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tagName",{get:function(){return this._htmlUppercasedQualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return d.element_getAnAttributeValue(this,"id")},set:function(e){d.element_setAnAttributeValue(this,"id",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return d.element_getAnAttributeValue(this,"class")},set:function(e){d.element_setAnAttributeValue(this,"class",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classList",{get:function(){var e=d.element_getAnAttributeByName("class",this);return null===e&&(e=d.create_attr(this._nodeDocument,"class")),d.create_domTokenList(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slot",{get:function(){return d.element_getAnAttributeValue(this,"slot")},set:function(e){d.element_setAnAttributeValue(this,"slot",e)},enumerable:!0,configurable:!0}),t.prototype.hasAttributes=function(){return 0!==this._attributeList.length},Object.defineProperty(t.prototype,"attributes",{get:function(){return this._attributeList},enumerable:!0,configurable:!0}),t.prototype.getAttributeNames=function(){var e,t,n=[];try{for(var r=o(this._attributeList),i=r.next();!i.done;i=r.next()){var a=i.value;n.push(a._qualifiedName)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},t.prototype.getAttribute=function(e){var t=d.element_getAnAttributeByName(e,this);return t?t._value:null},t.prototype.getAttributeNS=function(e,t){var n=d.element_getAnAttributeByNamespaceAndLocalName(e,t,this);return n?n._value:null},t.prototype.setAttribute=function(e,t){if(!d.xml_isName(e))throw new c.InvalidCharacterError;this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toLowerCase());for(var n=null,r=0;r<this._attributeList.length;r++){var i=this._attributeList[r];if(i._qualifiedName===e){n=i;break}}if(null===n)return(n=d.create_attr(this._nodeDocument,e))._value=t,void d.element_append(n,this);d.element_change(n,this,t)},t.prototype.setAttributeNS=function(e,t,n){var r=a(d.namespace_validateAndExtract(e,t),3),i=r[0],o=r[1],s=r[2];d.element_setAnAttributeValue(this,s,n,o,i)},t.prototype.removeAttribute=function(e){d.element_removeAnAttributeByName(e,this)},t.prototype.removeAttributeNS=function(e,t){d.element_removeAnAttributeByNamespaceAndLocalName(e,t,this)},t.prototype.hasAttribute=function(e){this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toLowerCase());for(var t=0;t<this._attributeList.length;t++)if(this._attributeList[t]._qualifiedName===e)return!0;return!1},t.prototype.toggleAttribute=function(e,t){if(!d.xml_isName(e))throw new c.InvalidCharacterError;this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toLowerCase());for(var n=null,r=0;r<this._attributeList.length;r++){var i=this._attributeList[r];if(i._qualifiedName===e){n=i;break}}return null===n?(void 0===t||!0===t)&&((n=d.create_attr(this._nodeDocument,e))._value="",d.element_append(n,this),!0):void 0!==t&&!1!==t||(d.element_removeAnAttributeByName(e,this),!1)},t.prototype.hasAttributeNS=function(e,t){for(var n=e||null,r=0;r<this._attributeList.length;r++){var i=this._attributeList[r];if(i._namespace===n&&i._localName===t)return!0}return!1},t.prototype.getAttributeNode=function(e){return d.element_getAnAttributeByName(e,this)},t.prototype.getAttributeNodeNS=function(e,t){return d.element_getAnAttributeByNamespaceAndLocalName(e,t,this)},t.prototype.setAttributeNode=function(e){return d.element_setAnAttribute(e,this)},t.prototype.setAttributeNodeNS=function(e){return d.element_setAnAttribute(e,this)},t.prototype.removeAttributeNode=function(e){for(var t=!1,n=0;n<this._attributeList.length;n++)if(this._attributeList[n]===e){t=!0;break}if(!t)throw new c.NotFoundError;return d.element_remove(e,this),e},t.prototype.attachShadow=function(e){if(this._namespace!==u.namespace.HTML)throw new c.NotSupportedError;if(!d.customElement_isValidCustomElementName(this._localName)&&!d.customElement_isValidShadowHostName(this._localName))throw new c.NotSupportedError;if(d.customElement_isValidCustomElementName(this._localName)||null!==this._is){var t=d.customElement_lookUpACustomElementDefinition(this._nodeDocument,this._namespace,this._localName,this._is);if(null!==t&&!0===t.disableShadow)throw new c.NotSupportedError}if(null!==this._shadowRoot)throw new c.NotSupportedError;var n=d.create_shadowRoot(this._nodeDocument,this);return n._mode=e.mode,this._shadowRoot=n,n},Object.defineProperty(t.prototype,"shadowRoot",{get:function(){var e=this._shadowRoot;return null===e||"closed"===e.mode?null:e},enumerable:!0,configurable:!0}),t.prototype.closest=function(e){throw new c.NotImplementedError},t.prototype.matches=function(e){throw new c.NotImplementedError},t.prototype.webkitMatchesSelector=function(e){return this.matches(e)},t.prototype.getElementsByTagName=function(e){return d.node_listOfElementsWithQualifiedName(e,this)},t.prototype.getElementsByTagNameNS=function(e,t){return d.node_listOfElementsWithNamespace(e,t,this)},t.prototype.getElementsByClassName=function(e){return d.node_listOfElementsWithClassNames(e,this)},t.prototype.insertAdjacentElement=function(e,t){return d.element_insertAdjacent(this,e,t)},t.prototype.insertAdjacentText=function(e,t){var n=d.create_text(this._nodeDocument,t);d.element_insertAdjacent(this,e,n)},Object.defineProperty(t.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_htmlUppercasedQualifiedName",{get:function(){var e=this._qualifiedName;return this._namespace===u.namespace.HTML&&"html"===this._nodeDocument._type&&(e=e.toUpperCase()),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelector=function(e){throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelectorAll=function(e){throw new Error("Mixin: ParentNode not implemented.")},Object.defineProperty(t.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},Object.defineProperty(t.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),t._create=function(e,n,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var o=new t;return o._localName=n,o._namespace=r,o._namespacePrefix=i,o._nodeDocument=e,o},t}(l.NodeImpl);t.ElementImpl=h,p.idl_defineConst(h.prototype,"_nodeType",s.NodeType.Element)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(34),s=n(12),l=function(e){function t(t){void 0===t&&(t=null);var n=e.call(this)||this;return n._children=new Set,n._host=t,n}return i(t,e),t.prototype.getElementById=function(e){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(t.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),t.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelector=function(e){throw new Error("Mixin: ParentNode not implemented.")},t.prototype.querySelectorAll=function(e){throw new Error("Mixin: ParentNode not implemented.")},t._create=function(e,n){void 0===n&&(n=null);var r=new t(n);return r._nodeDocument=e,r},t}(a.NodeImpl);t.DocumentFragmentImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.DocumentFragment)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(71),l=n(0),c=n(12),u=function(e){function t(t){void 0===t&&(t="");var n=e.call(this,t)||this;return n._name="",n._assignedSlot=null,n}return i(t,e),Object.defineProperty(t.prototype,"wholeText",{get:function(){var e,t,n="";try{for(var r=o(l.text_contiguousTextNodes(this,!0)),i=r.next();!i.done;i=r.next())n+=i.value._data}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),t.prototype.splitText=function(e){return l.text_split(this,e)},Object.defineProperty(t.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),t._create=function(e,n){void 0===n&&(n="");var r=new t(n);return r._nodeDocument=e,r},t}(s.CharacterDataImpl);t.TextImpl=u,c.idl_defineConst(u.prototype,"_nodeType",a.NodeType.Text)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return Object.defineProperty(e.prototype,"_startNode",{get:function(){return this._start[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_startOffset",{get:function(){return this._start[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_endNode",{get:function(){return this._end[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_endOffset",{get:function(){return this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_collapsed",{get:function(){return this._start[0]===this._end[0]&&this._start[1]===this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startContainer",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endContainer",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endOffset",{get:function(){return this._endOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collapsed",{get:function(){return this._collapsed},enumerable:!0,configurable:!0}),e}();t.AbstractRangeImpl=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(e){this._activeFlag=!1,this._root=e,this._whatToShow=r.WhatToShow.All,this._filter=null}return Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"whatToShow",{get:function(){return this._whatToShow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),e}();t.TraverserImpl=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(0),o=n(12),a=function(){function e(e,t){this._target=null,this._relatedTarget=null,this._touchTargetList=[],this._path=[],this._currentTarget=null,this._eventPhase=r.EventPhase.None,this._stopPropagationFlag=!1,this._stopImmediatePropagationFlag=!1,this._canceledFlag=!1,this._inPassiveListenerFlag=!1,this._composedFlag=!1,this._initializedFlag=!1,this._dispatchFlag=!1,this._isTrusted=!1,this._bubbles=!1,this._cancelable=!1,this._type=e,t&&(this._bubbles=t.bubbles||!1,this._cancelable=t.cancelable||!1,this._composedFlag=t.composed||!1),this._initializedFlag=!0,this._timeStamp=(new Date).getTime()}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"srcElement",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!0,configurable:!0}),e.prototype.composedPath=function(){var e=[],t=this._path;if(0===t.length)return e;var n=this._currentTarget;if(null===n)throw new Error("Event currentTarget is null.");e.push(n);for(var r=0,i=0,o=t.length-1;o>=0;){if(t[o].rootOfClosedTree&&i++,t[o].invocationTarget===n){r=o;break}t[o].slotInClosedTree&&i--,o--}var a=i,s=i;for(o=r-1;o>=0;)t[o].rootOfClosedTree&&a++,a<=s&&e.unshift(t[o].invocationTarget),t[o].slotInClosedTree&&--a<s&&(s=a),o--;for(a=i,s=i,o=r+1;o<t.length;)t[o].slotInClosedTree&&a++,a<=s&&e.push(t[o].invocationTarget),t[o].rootOfClosedTree&&--a<s&&(s=a),o++;return e},Object.defineProperty(e.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){this._stopPropagationFlag=!0},Object.defineProperty(e.prototype,"cancelBubble",{get:function(){return this._stopPropagationFlag},set:function(e){e&&this.stopPropagation()},enumerable:!0,configurable:!0}),e.prototype.stopImmediatePropagation=function(){this._stopPropagationFlag=!0,this._stopImmediatePropagationFlag=!0},Object.defineProperty(e.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"returnValue",{get:function(){return!this._canceledFlag},set:function(e){e||i.event_setTheCanceledFlag(this)},enumerable:!0,configurable:!0}),e.prototype.preventDefault=function(){i.event_setTheCanceledFlag(this)},Object.defineProperty(e.prototype,"defaultPrevented",{get:function(){return this._canceledFlag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"composed",{get:function(){return this._composedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTrusted",{get:function(){return this._isTrusted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),e.prototype.initEvent=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),this._dispatchFlag||i.event_initialize(this,e,t,n)},e.NONE=0,e.CAPTURING_PHASE=1,e.AT_TARGET=2,e.BUBBLING_PHASE=3,e}();t.EventImpl=a,o.idl_defineConst(a.prototype,"NONE",0),o.idl_defineConst(a.prototype,"CAPTURING_PHASE",1),o.idl_defineConst(a.prototype,"AT_TARGET",2),o.idl_defineConst(a.prototype,"BUBBLING_PHASE",3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(9);t.traversal_filter=function(e,t){if(e._activeFlag)throw new i.InvalidStateError;var n=1<<t._nodeType-1;if(0==(e.whatToShow&n))return r.FilterResult.Skip;if(!e.filter)return r.FilterResult.Accept;e._activeFlag=!0;var o=r.FilterResult.Reject;try{o=e.filter.acceptNode(t)}catch(t){throw e._activeFlag=!1,t}return e._activeFlag=!1,o}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(3),s=n(1),l=n(99),c=n(73),u=n(17),d=n(173),p=n(30),h=n(52),f=n(37);t.document_elementInterface=function(e,t){return l.ElementImpl},t.document_internalCreateElementNS=function(e,t,n,i){var o=r(d.namespace_validateAndExtract(t,n),3),a=o[0],l=o[1],c=o[2],u=null;return void 0!==i&&(u=s.isString(i)?i:i.is),h.element_createAnElement(e,c,a,l,u,!0)},t.document_adopt=function(e,t){var n,r;if(e._nodeDocument!==t||null!==e._parent){var s=e._nodeDocument;if(e._parent&&f.mutation_remove(e,e._parent),t!==s)for(var l=u.tree_getFirstDescendantNode(e,!0,!0);null!==l;){if(l._nodeDocument=t,a.Guard.isElementNode(l))try{for(var d=(n=void 0,i(l._attributeList._asArray())),h=d.next();!h.done;h=d.next())h.value._nodeDocument=t}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}o.dom.features.customElements&&a.Guard.isElementNode(l)&&"custom"===l._customElementState&&c.customElement_enqueueACustomElementCallbackReaction(l,"adoptedCallback",[s,t]),o.dom.features.steps&&p.dom_runAdoptingSteps(l,s),l=u.tree_getNextDescendantNode(e,l,!0,!0)}}}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(3),a=n(9),s=n(17),l=n(51),c=n(30);t.characterData_replaceData=function(e,t,n,u){var d,p,h=s.tree_nodeLength(e);if(t>h)throw new a.IndexSizeError("Offset exceeds character data length. Offset: "+t+", Length: "+h+", Node is "+e.nodeName+".");t+n>h&&(n=h-t),i.dom.features.mutationObservers&&l.observer_queueMutationRecord("characterData",e,null,null,e._data,[],[],null,null);var f=e._data.substring(0,t)+u+e._data.substring(t+n);e._data=f;try{for(var m=r(i.dom.rangeList),g=m.next();!g.done;g=m.next()){var v=g.value;v._start[0]===e&&v._start[1]>t&&v._start[1]<=t+n&&(v._start[1]=t),v._end[0]===e&&v._end[1]>t&&v._end[1]<=t+n&&(v._end[1]=t),v._start[0]===e&&v._start[1]>t+n&&(v._start[1]+=u.length-n),v._end[0]===e&&v._end[1]>t+n&&(v._end[1]+=u.length-n)}}catch(e){d={error:e}}finally{try{g&&!g.done&&(p=m.return)&&p.call(m)}finally{if(d)throw d.error}}i.dom.features.steps&&o.Guard.isTextNode(e)&&null!==e._parent&&c.dom_runChildTextContentChangeSteps(e._parent)},t.characterData_substringData=function(e,t,n){var r=s.tree_nodeLength(e);if(t>r)throw new a.IndexSizeError("Offset exceeds character data length. Offset: "+t+", Length: "+r+", Node is "+e.nodeName+".");return t+n>r?e._data.substr(t):e._data.substr(t,n)}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(7);function s(e){var t=a.string.splitAStringOnASCIIWhitespace(e);return new Set(t)}function l(e){return i(e).join(" ")}t.orderedSet_parse=s,t.orderedSet_serialize=l,t.orderedSet_sanitize=function(e){return l(s(e))},t.orderedSet_contains=function(e,t,n){var r,i,a,s;try{for(var l=o(t),c=l.next();!c.done;c=l.next()){var u=c.value,d=!1;try{for(var p=(a=void 0,o(e)),h=p.next();!h.done;h=p.next()){var f=h.value;if(n){if(f===u){d=!0;break}}else if(f.toUpperCase()===u.toUpperCase()){d=!0;break}}}catch(e){a={error:e}}finally{try{h&&!h.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}if(!d)return!1}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return!0}},function(e,t,n){"use strict";n(179),Object.defineProperty(t,"__esModule",{value:!0});var r=n(262),i=n(110),o=n(1);i.dom.setFeatures(!1),t.createDocument=function(){var e=(new r.DOMImplementation).createDocument(null,"root",null);return e.documentElement&&e.removeChild(e.documentElement),e},t.sanitizeInput=function(e,t){if(null==e)return e;if(void 0===t)return e+"";var n="";e+="";for(var r=0;r<e.length;r++){var i=e.charCodeAt(r);if(9===i||10===i||13===i||i>=32&&i<=55295||i>=57344&&i<=65533)n+=e.charAt(r);else if(i>=55296&&i<=56319&&r<e.length-1){var a=e.charCodeAt(r+1);a>=56320&&a<=57343?(i=1024*(i-55296)+a-56320+65536,n+=String.fromCodePoint(i),r++):n+=o.isString(t)?t:t(e.charAt(r),r,e)}else n+=o.isString(t)?t:t(e.charAt(r),r,e)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(153);t.AbortController=i.AbortControllerImpl;var o=n(154);t.AbortSignal=o.AbortSignalImpl;var a=n(102);t.AbstractRange=a.AbstractRangeImpl;var s=n(157);t.Attr=s.AttrImpl;var l=n(158);t.CDATASection=l.CDATASectionImpl;var c=n(71);t.CharacterData=c.CharacterDataImpl;var u=n(263),d=n(159);t.Comment=d.CommentImpl;var p=n(171);t.CustomEvent=p.CustomEventImpl;var h=n(100);t.DocumentFragment=h.DocumentFragmentImpl;var f=n(98);t.Document=f.DocumentImpl;var m=n(264),g=n(155);t.DocumentType=g.DocumentTypeImpl;var v=n(6);t.dom=v.dom;var y=n(148);t.DOMImplementation=y.DOMImplementationImpl;var b=n(170);t.DOMTokenList=b.DOMTokenListImpl;var C=n(99);t.Element=C.ElementImpl;var w=n(104);t.Event=w.EventImpl;var E=n(70);t.EventTarget=E.EventTargetImpl;var T=n(161);t.HTMLCollection=T.HTMLCollectionImpl;var x=n(265);t.MutationObserver=x.MutationObserverImpl;var _=n(169);t.MutationRecord=_.MutationRecordImpl;var S=n(164);t.NamedNodeMap=S.NamedNodeMapImpl;var I=n(168);t.NodeFilter=I.NodeFilterImpl;var D=n(34);t.Node=D.NodeImpl;var A=n(166);t.NodeIterator=A.NodeIteratorImpl;var P=n(162);t.NodeList=P.NodeListImpl;var O=n(163);t.NodeListStatic=O.NodeListStaticImpl;var R=n(266),M=n(267),N=n(268),L=n(160);t.ProcessingInstruction=L.ProcessingInstructionImpl;var k=n(165);t.Range=k.RangeImpl;var F=n(156);t.ShadowRoot=F.ShadowRootImpl;var V=n(269),U=n(270);t.StaticRange=U.StaticRangeImpl;var B=n(101);t.Text=B.TextImpl;var G=n(103);t.Traverser=G.TraverserImpl;var W=n(167);t.TreeWalker=W.TreeWalkerImpl;var z=n(149);t.Window=z.WindowImpl;var H=n(151);t.XMLDocument=H.XMLDocumentImpl,r.applyMixin(C.ElementImpl,u.ChildNodeImpl),r.applyMixin(c.CharacterDataImpl,u.ChildNodeImpl),r.applyMixin(g.DocumentTypeImpl,u.ChildNodeImpl),r.applyMixin(f.DocumentImpl,m.DocumentOrShadowRootImpl),r.applyMixin(F.ShadowRootImpl,m.DocumentOrShadowRootImpl),r.applyMixin(C.ElementImpl,R.NonDocumentTypeChildNodeImpl),r.applyMixin(c.CharacterDataImpl,R.NonDocumentTypeChildNodeImpl),r.applyMixin(f.DocumentImpl,M.NonElementParentNodeImpl),r.applyMixin(h.DocumentFragmentImpl,M.NonElementParentNodeImpl),r.applyMixin(f.DocumentImpl,N.ParentNodeImpl),r.applyMixin(h.DocumentFragmentImpl,N.ParentNodeImpl),r.applyMixin(C.ElementImpl,N.ParentNodeImpl),r.applyMixin(B.TextImpl,V.SlotableImpl),r.applyMixin(C.ElementImpl,V.SlotableImpl)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.EOF=0]="EOF",e[e.Declaration=1]="Declaration",e[e.DocType=2]="DocType",e[e.Element=3]="Element",e[e.Text=4]="Text",e[e.CDATA=5]="CDATA",e[e.PI=6]="PI",e[e.Comment=7]="Comment",e[e.ClosingTag=8]="ClosingTag"}(t.TokenType||(t.TokenType={}))},function(e,t,n){"use strict";n(64),n(20),n(66);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._parse=function(e,t){var n=this,r=this._builderOptions,i=null;return o.isFunction(t)?i=this.parse(e,t.apply(this)):o.isArray(t)||o.isSet(t)?o.forEachArray(t,function(t){return i=n.parse(e,t)},this):o.isMap(t)||o.isObject(t)?o.forEachObject(t,function(t,a){if(o.isFunction(a)&&(a=a.apply(n)),r.ignoreConverters||0!==t.indexOf(r.convert.att))if(r.ignoreConverters||0!==t.indexOf(r.convert.text))if(r.ignoreConverters||0!==t.indexOf(r.convert.cdata))if(r.ignoreConverters||0!==t.indexOf(r.convert.comment))if(r.ignoreConverters||0!==t.indexOf(r.convert.ins)){if((o.isArray(a)||o.isSet(a))&&o.isEmpty(a));else if((o.isMap(a)||o.isObject(a))&&o.isEmpty(a))i=n.element(e,void 0,n.sanitize(t))||i;else if(r.keepNullNodes||null!=a)if(o.isArray(a)||o.isSet(a))o.forEachArray(a,function(r){var o={};o[t]=r,i=n.parse(e,o)},n);else if(o.isMap(a)||o.isObject(a))(s=n.element(e,void 0,n.sanitize(t)))&&(i=s,n.parse(s,a));else if(null!=a&&""!==a){var s;(s=n.element(e,void 0,n.sanitize(t)))&&(i=s,n.text(s,n._decodeText(n.sanitize(a))))}else i=n.element(e,void 0,n.sanitize(t))||i}else if(o.isString(a)){var l=a.indexOf(" "),c=-1===l?a:a.substr(0,l),u=-1===l?"":a.substr(l+1);i=n.instruction(e,n.sanitize(c),n.sanitize(u))||i}else o.isArray(a)||o.isSet(a)?o.forEachArray(a,function(t){var r=t.indexOf(" "),o=-1===r?t:t.substr(0,r),a=-1===r?"":t.substr(r+1);i=n.instruction(e,n.sanitize(o),n.sanitize(a))||i},n):o.forEachObject(a,function(t,r){return i=n.instruction(e,n.sanitize(t),n.sanitize(r))||i},n);else o.isArray(a)||o.isSet(a)?o.forEachArray(a,function(t){return i=n.comment(e,n.sanitize(t))||i},n):i=n.comment(e,n.sanitize(a))||i;else o.isArray(a)||o.isSet(a)?o.forEachArray(a,function(t){return i=n.cdata(e,n.sanitize(t))||i},n):i=n.cdata(e,n.sanitize(a))||i;else i=o.isMap(a)||o.isObject(a)?n.parse(e,a):n.text(e,n._decodeText(n.sanitize(a)))||i;else if(t===r.convert.att){if(o.isArray(a)||o.isSet(a))throw new Error("Invalid attribute: "+a.toString()+". "+e._debugInfo());o.forEachObject(a,function(t,r){i=n.attribute(e,void 0,n.sanitize(t),n._decodeAttributeValue(n.sanitize(r)))||i})}else i=n.attribute(e,void 0,n.sanitize(t.substr(r.convert.att.length)),n._decodeAttributeValue(n.sanitize(a)))||i},this):(r.keepNullNodes||null!=t)&&(i=this.text(e,this._decodeText(this.sanitize(t)))||i),i||e},t}(n(75).BaseReader);t.ObjectReader=a},function(e,t,n){"use strict";var r=n(39);e.exports=new r({explicit:[n(286),n(287),n(288)]})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.level=0,this._builderOptions=e,this._writerOptions=e};t.BaseCBWriter=r},function(e,t,n){var r=n(16),i=n(8),o=n(116);e.exports=!r&&!i(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(11),i=n(13),o=r.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,n){var r=n(118),i=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(e){return i.call(e)}),e.exports=r.inspectSource},function(e,t,n){var r=n(11),i=n(80),o=r["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,n){var r=n(14),i=n(187),o=n(55),a=n(15);e.exports=function(e,t){for(var n=i(t),s=a.f,l=o.f,c=0;c<n.length;c++){var u=n[c];r(e,u)||s(e,u,l(t,u))}}},function(e,t,n){var r=n(11);e.exports=r},function(e,t,n){var r=n(14),i=n(24),o=n(122).indexOf,a=n(45);e.exports=function(e,t){var n,s=i(e),l=0,c=[];for(n in s)!r(a,n)&&r(s,n)&&c.push(n);for(;t.length>l;)r(s,n=t[l++])&&(~o(c,n)||c.push(n));return c}},function(e,t,n){var r=n(24),i=n(26),o=n(83),a=function(e){return function(t,n,a){var s,l=r(t),c=i(l.length),u=o(a,c);if(e&&n!=n){for(;c>u;)if((s=l[u++])!=s)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,n){var r=n(8),i=/#|\.prototype\./,o=function(e,t){var n=s[a(e)];return n==c||n!=l&&("function"==typeof t?r(t):!!t)},a=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},s=o.data={},l=o.NATIVE="N",c=o.POLYFILL="P";e.exports=o},function(e,t,n){var r=n(86);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var r=n(5);t.f=r},function(e,t,n){var r=n(120),i=n(14),o=n(125),a=n(15).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||a(t,e,{value:o.f(e)})}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,n){var r=n(13),i=n(59),o=n(5)("species");e.exports=function(e,t){var n;return i(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!i(n.prototype)?r(n)&&null===(n=n[o])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},function(e,t,n){var r,i,o=n(11),a=n(193),s=o.process,l=s&&s.versions,c=l&&l.v8;c?i=(r=c.split("."))[0]+r[1]:a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(i=r[1]),e.exports=i&&+i},function(e,t,n){var r=n(5),i=n(60),o=n(15),a=r("unscopables"),s=Array.prototype;null==s[a]&&o.f(s,a,{configurable:!0,value:i(null)}),e.exports=function(e){s[a][e]=!0}},function(e,t,n){"use strict";var r,i,o,a=n(132),s=n(21),l=n(14),c=n(5),u=n(44),d=c("iterator"),p=!1;[].keys&&("next"in(o=[].keys())?(i=a(a(o)))!==Object.prototype&&(r=i):p=!0),null==r&&(r={}),u||l(r,d)||s(r,d,function(){return this}),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:p}},function(e,t,n){var r=n(14),i=n(27),o=n(57),a=n(196),s=o("IE_PROTO"),l=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=i(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?l:null}},function(e,t,n){var r=n(18),i=n(197);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,o){return r(n),i(o),t?e.call(n,o):n.__proto__=o,n}}():void 0)},function(e,t,n){"use strict";var r=n(56),i=n(15),o=n(40);e.exports=function(e,t,n){var a=r(t);a in e?i.f(e,a,o(0,n)):e[a]=n}},function(e,t,n){var r=n(90),i=n(42),o=n(5)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=r?i:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?n:a?i(t):"Object"==(r=i(t))&&"function"==typeof t.callee?"Arguments":r}},function(e,t,n){"use strict";var r=n(18);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var r=n(47),i=n(35),o=function(e){return function(t,n){var o,a,s=String(i(t)),l=r(n),c=s.length;return l<0||l>=c?e?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===c||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):o:e?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}};e.exports={codeAt:o(!1),charAt:o(!0)}},function(e,t,n){var r=n(4),i=n(27),o=n(61);r({target:"Object",stat:!0,forced:n(8)(function(){o(1)})},{keys:function(e){return o(i(e))}})},function(e,t,n){"use strict";var r=n(4),i=n(11),o=n(123),a=n(25),s=n(140),l=n(141),c=n(142),u=n(13),d=n(8),p=n(208),h=n(62),f=n(209);e.exports=function(e,t,n){var m=-1!==e.indexOf("Map"),g=-1!==e.indexOf("Weak"),v=m?"set":"add",y=i[e],b=y&&y.prototype,C=y,w={},E=function(e){var t=b[e];a(b,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return g&&!u(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(g&&!u(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(o(e,"function"!=typeof y||!(g||b.forEach&&!d(function(){(new y).entries().next()}))))C=n.getConstructor(t,e,m,v),s.REQUIRED=!0;else if(o(e,!0)){var T=new C,x=T[v](g?{}:-0,1)!=T,_=d(function(){T.has(1)}),S=p(function(e){new y(e)}),I=!g&&d(function(){for(var e=new y,t=5;t--;)e[v](t,t);return!e.has(-0)});S||((C=t(function(t,n){c(t,C,e);var r=f(new y,t,C);return null!=n&&l(n,r[v],r,m),r})).prototype=b,b.constructor=C),(_||I)&&(E("delete"),E("has"),m&&E("get")),(I||x)&&E(v),g&&b.clear&&delete b.clear}return w[e]=C,r({global:!0,forced:C!=y},w),h(C,e),g||n.setStrong(C,e,m),C}},function(e,t,n){var r=n(45),i=n(13),o=n(14),a=n(15).f,s=n(58),l=n(204),c=s("meta"),u=0,d=Object.isExtensible||function(){return!0},p=function(e){a(e,c,{value:{objectID:"O"+ ++u,weakData:{}}})},h=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,c)){if(!d(e))return"F";if(!t)return"E";p(e)}return e[c].objectID},getWeakData:function(e,t){if(!o(e,c)){if(!d(e))return!0;if(!t)return!1;p(e)}return e[c].weakData},onFreeze:function(e){return l&&h.REQUIRED&&d(e)&&!o(e,c)&&p(e),e}};r[c]=!0},function(e,t,n){var r=n(18),i=n(205),o=n(26),a=n(87),s=n(206),l=n(207),c=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,t,n,u,d){var p,h,f,m,g,v,y,b=a(t,n,u?2:1);if(d)p=e;else{if("function"!=typeof(h=s(e)))throw TypeError("Target is not iterable");if(i(h)){for(f=0,m=o(e.length);m>f;f++)if((g=u?b(r(y=e[f])[0],y[1]):b(e[f]))&&g instanceof c)return g;return new c(!1)}p=h.call(e)}for(v=p.next;!(y=v.call(p)).done;)if("object"==typeof(g=l(p,b,y.value,u))&&g&&g instanceof c)return g;return new c(!1)}).stop=function(e){return new c(!0,e)}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t,n){"use strict";var r=n(15).f,i=n(60),o=n(210),a=n(87),s=n(142),l=n(141),c=n(88),u=n(211),d=n(16),p=n(140).fastKey,h=n(43),f=h.set,m=h.getterFor;e.exports={getConstructor:function(e,t,n,c){var u=e(function(e,r){s(e,u,t),f(e,{type:t,index:i(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=r&&l(r,e[c],e,n)}),h=m(t),g=function(e,t,n){var r,i,o=h(e),a=v(e,t);return a?a.value=n:(o.last=a={index:i=p(t,!0),key:t,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),d?o.size++:e.size++,"F"!==i&&(o.index[i]=a)),e},v=function(e,t){var n,r=h(e),i=p(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return o(u.prototype,{clear:function(){for(var e=h(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t=h(this),n=v(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),d?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=h(this),r=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!v(this,e)}}),o(u.prototype,n?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),d&&r(u.prototype,"size",{get:function(){return h(this).size}}),u},setStrong:function(e,t,n){var r=t+" Iterator",i=m(t),o=m(r);c(e,t,function(e,t){f(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),u(t)}}},function(e,t,n){"use strict";var r,i=n(4),o=n(55).f,a=n(26),s=n(222),l=n(35),c=n(224),u=n(44),d="".endsWith,p=Math.min,h=c("endsWith");i({target:"String",proto:!0,forced:!(!u&&!h&&(r=o(String.prototype,"endsWith"),r&&!r.writable)||h)},{endsWith:function(e){var t=String(l(this));s(e);var n=arguments.length>1?arguments[1]:void 0,r=a(t.length),i=void 0===n?r:p(a(n),r),o=String(e);return d?d.call(t,o,i):t.slice(i-o.length,i)===o}})},function(e,t,n){"use strict";(function(e){var r=n(229),i=n(230),o=n(231);function a(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=p(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|h(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):p(e,t);if("Buffer"===t.type&&o(t.data))return p(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(u(t),e=s(e,t<0?0:0|h(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|h(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function f(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return D(this,t,n);case"base64":return _(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var o,a=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var u=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var d=!0,p=0;p<l;p++)if(c(e,o+p)!==c(t,p)){d=!1;break}if(d)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function C(e,t,n,r){return W(B(t,e.length-n),e,n,r)}function w(e,t,n,r){return W(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return w(e,t,n,r)}function T(e,t,n,r){return W(G(t),e,n,r)}function x(e,t,n,r){return W(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function _(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,l,c=e[i],u=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(l=(15&c)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function D(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=U(e[o]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,r,i,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function N(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function L(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(e,t,n,r,o){return o||L(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function F(e,t,n,r,o){return o||L(e,0,n,8),i.write(e,t,n,r,52,8),n+8}t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return c(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,r){return u(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(r,i),u=e.slice(t,n),d=0;d<s;++d)if(c[d]!==u[d]){o=c[d],a=u[d];break}return o<a?-1:a<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},l.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;n=new l(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return k(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return k(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=l.isBuffer(e)?e:B(new l(e,r).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(78))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isASCIIByte=function(e){return e>=0&&e<=127}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.length=function(e){return e.length},t.byteLowercase=function(e){for(var t=0;t<e.length;t++){var n=e[t];n>=65&&n<=90&&(e[t]=n+32)}},t.byteUppercase=function(e){for(var t=0;t<e.length;t++){var n=e[t];n>=97&&n<=122&&(e[t]=n-32)}},t.byteCaseInsensitiveMatch=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(r>=65&&r<=90&&(r+=32),i>=65&&i<=90&&(i+=32),r!==i)return!1}return!0},t.startsWith=function(e,t){for(var n=0;;){if(n>=e.length)return!1;if(n>=t.length)return!0;if(e[n]!==t[n])return!1;n++}},t.byteLessThan=function(e,t){for(var n=0;;){if(n>=e.length)return!1;if(n>=t.length)return!0;var r=e[n],i=t[n];if(r<i)return!0;if(r>i)return!1;n++}},t.isomorphicDecode=function(e){return String.fromCodePoint.apply(String,i(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(7),o=n(0),a=n(12),s=function(){function e(e){this._associatedDocument=e||r.dom.window.document}return e.prototype.createDocumentType=function(e,t,n){return o.namespace_validate(e),o.create_documentType(this._associatedDocument,e,t,n)},e.prototype.createDocument=function(e,t,n){void 0===n&&(n=null);var r=o.create_xmlDocument(),a=null;return t&&(a=o.document_internalCreateElementNS(r,e,t)),n&&r.appendChild(n),a&&r.appendChild(a),r._origin=this._associatedDocument._origin,e===i.namespace.HTML?r._contentType="application/xhtml+xml":e===i.namespace.SVG?r._contentType="image/svg+xml":r._contentType="application/xml",r},e.prototype.createHTMLDocument=function(e){var t=o.create_document();t._type="html",t._contentType="text/html",t.appendChild(o.create_documentType(t,"html","",""));var n=o.element_createAnElement(t,"html",i.namespace.HTML);t.appendChild(n);var r=o.element_createAnElement(t,"head",i.namespace.HTML);if(n.appendChild(r),void 0!==e){var a=o.element_createAnElement(t,"title",i.namespace.HTML);r.appendChild(a);var s=o.create_text(t,e);a.appendChild(s)}var l=o.element_createAnElement(t,"body",i.namespace.HTML);return n.appendChild(l),t._origin=this._associatedDocument._origin,t},e.prototype.hasFeature=function(){return!0},e._create=function(t){return new e(t)},e}();t.DOMImplementationImpl=s,a.idl_defineConst(s.prototype,"_ID","@oozcitak/dom")},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(70),a=n(1),s=n(0),l=function(e){function t(){var t=e.call(this)||this;return t._signalSlots=new Set,t._mutationObserverMicrotaskQueued=!1,t._mutationObservers=new Set,t._iteratorList=new a.FixedSizeSet,t._associatedDocument=s.create_document(),t}return i(t,e),Object.defineProperty(t.prototype,"document",{get:function(){return this._associatedDocument},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"event",{get:function(){return this._currentEvent},enumerable:!0,configurable:!0}),t._create=function(){return new t},t}(o.EventTargetImpl);t.WindowImpl=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(){}return e.isNode=function(e){return!!e&&void 0!==e._nodeType},e.isDocumentNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.Document},e.isDocumentTypeNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.DocumentType},e.isDocumentFragmentNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.DocumentFragment},e.isAttrNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.Attribute},e.isCharacterDataNode=function(t){if(!e.isNode(t))return!1;var n=t._nodeType;return n===r.NodeType.Text||n===r.NodeType.ProcessingInstruction||n===r.NodeType.Comment||n===r.NodeType.CData},e.isTextNode=function(t){return e.isNode(t)&&(t._nodeType===r.NodeType.Text||t._nodeType===r.NodeType.CData)},e.isExclusiveTextNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.Text},e.isCDATASectionNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.CData},e.isCommentNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.Comment},e.isProcessingInstructionNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.ProcessingInstruction},e.isElementNode=function(t){return e.isNode(t)&&t._nodeType===r.NodeType.Element},e.isCustomElementNode=function(t){return e.isElementNode(t)&&"custom"===t._customElementState},e.isShadowRoot=function(e){return!!e&&void 0!==e.host},e.isMouseEvent=function(e){return!!e&&void 0!==e.screenX&&null!=e.screenY},e.isSlotable=function(t){return!!t&&void 0!==t._name&&void 0!==t._assignedSlot&&(e.isTextNode(t)||e.isElementNode(t))},e.isSlot=function(t){return!!t&&void 0!==t._name&&void 0!==t._assignedNodes&&e.isElementNode(t)},e.isWindow=function(e){return!!e&&void 0!==e.navigator},e.isEventListener=function(e){return!!e&&void 0!==e.handleEvent},e.isRegisteredObserver=function(e){return!!e&&void 0!==e.observer&&void 0!==e.options},e.isTransientRegisteredObserver=function(t){return!!t&&void 0!==t.source&&e.isRegisteredObserver(t)},e}();t.Guard=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return i(t,e),t}(n(98).DocumentImpl);t.XMLDocumentImpl=o},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(1),s=n(243),l=n(7),c=n(244),u={ftp:21,file:null,http:80,https:443,ws:80,wss:443},d=/[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,p=/[ "<>`]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,h=/[ "<>`#?{}]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,f=/[ "<>`#?{}/:;=@\[\]\\\^\|]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,m=/[0-9A-Za-z!\$&-\/:;=\?@_~\xA0-\uD7FF\uE000-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uD83E\uD840-\uD87E\uD880-\uD8BE\uD8C0-\uD8FE\uD900-\uD93E\uD940-\uD97E\uD980-\uD9BE\uD9C0-\uD9FE\uDA00-\uDA3E\uDA40-\uDA7E\uDA80-\uDABE\uDAC0-\uDAFE\uDB00-\uDB3E\uDB40-\uDB7E\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDC00-\uDFFD]/,g=/[\0\t\f\r #%/:?@\[\\\]]/;function v(e){void 0!==o&&o.call(null,"Validation Error: "+e)}function y(){return{scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null}}function b(e){return e in u}function C(e){return b(e.scheme)}function w(e){return u[e]||null}function E(e){return""!==e.username||""!==e.password}function T(e,t){var n,i;void 0===t&&(t=!1);var o=e.scheme+":";if(null!==e.host?(o+="//",E(e)&&(o+=e.username,""!==e.password&&(o+=":"+e.password),o+="@"),o+=x(e.host),null!==e.port&&(o+=":"+e.port)):null===e.host&&"file"===e.scheme&&(o+="//"),e._cannotBeABaseURLFlag)o+=e.path[0];else try{for(var a=r(e.path),s=a.next();!s.done;s=a.next())o+="/"+s.value}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return null!==e.query&&(o+="?"+e.query),t||null===e.fragment||(o+="#"+e.fragment),o}function x(e){return a.isNumber(e)?_(e):a.isArray(e)?"["+S(e)+"]":e}function _(e){for(var t="",n=e,r=1;r<=4;r++)t=(n%256).toString()+t,4!==r&&(t="."+t),n=Math.floor(n/256);return t}function S(e){for(var t="",n=null,r=-1,i=0,o=0,a=0;a<8;a++)if(0===e[a]){i=1;for(var s=a+1;s<8&&0===e[s];s++)i++;i>o&&(o=i,r=a)}o>1&&(n=r);for(var l=!1,c=0;c<8;c++)l&&0===e[c]||(l&&(l=!1),n!==c?(t+=e[c].toString(16),7!==c&&(t+=":")):(t+=0===c?"::":":",l=!0));return t}function I(e,t,n,i,o){var c,u,g,y;if(void 0===i){i={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null};var T=/^[\u0000-\u001F\u0020]+/,x=/[\u0000-\u001F\u0020]+$/;(T.test(e)||x.test(e))&&v("Input string contains leading or trailing control characters or space."),e=(e=e.replace(T,"")).replace(x,"")}var _=/[\u0009\u000A\u000D]/g;_.test(e)&&v("Input string contains tab or newline characters."),e=e.replace(_,"");var S=void 0===o?s.ParserState.SchemeStart:o;void 0===t&&(t=null);for(var I=void 0===n||"replacement"===n||"UTF-16BE"===n||"UTF-16LE"===n?"UTF-8":n,L="",k=!1,F=!1,V=!1,U=new a.StringWalker(e);;){switch(S){case s.ParserState.SchemeStart:if(l.codePoint.ASCIIAlpha.test(U.c()))L+=U.c().toLowerCase(),S=s.ParserState.Scheme;else{if(void 0!==o)return v("Invalid scheme start character."),null;S=s.ParserState.NoScheme,U.pointer--}break;case s.ParserState.Scheme:if(l.codePoint.ASCIIAlphanumeric.test(U.c())||"+"===U.c()||"-"===U.c()||"."===U.c())L+=U.c().toLowerCase();else{if(":"!==U.c()){if(void 0===o){L="",S=s.ParserState.NoScheme,U.pointer=0;continue}return v("Invalid input string."),null}if(void 0!==o){if(b(i.scheme)&&!b(L))return i;if(!b(i.scheme)&&b(L))return i;if((E(i)||null!==i.port)&&"file"===L)return i;if("file"===i.scheme&&(""===i.host||null===i.host))return i}if(i.scheme=L,void 0!==o)return i.port===w(i.scheme)&&(i.port=null),i;L="","file"===i.scheme?(U.remaining().startsWith("//")||v("Invalid file URL scheme, '//' expected."),S=s.ParserState.File):C(i)&&null!==t&&t.scheme===i.scheme?S=s.ParserState.SpecialRelativeOrAuthority:C(i)?S=s.ParserState.SpecialAuthoritySlashes:U.remaining().startsWith("/")?(S=s.ParserState.PathOrAuthority,U.pointer++):(i._cannotBeABaseURLFlag=!0,i.path.push(""),S=s.ParserState.CannotBeABaseURLPath)}break;case s.ParserState.NoScheme:if(null===t||t._cannotBeABaseURLFlag&&"#"!==U.c())return v("Invalid input string."),null;t._cannotBeABaseURLFlag&&"#"===U.c()?(i.scheme=t.scheme,i.path=l.list.clone(t.path),i.query=t.query,i.fragment="",i._cannotBeABaseURLFlag=!0,S=s.ParserState.Fragment):"file"!==t.scheme?(S=s.ParserState.Relative,U.pointer--):(S=s.ParserState.File,U.pointer--);break;case s.ParserState.SpecialRelativeOrAuthority:"/"===U.c()&&U.remaining().startsWith("/")?(S=s.ParserState.SpecialAuthorityIgnoreSlashes,U.pointer++):(v("Invalid input string."),S=s.ParserState.Relative,U.pointer--);break;case s.ParserState.PathOrAuthority:"/"===U.c()?S=s.ParserState.Authority:(S=s.ParserState.Path,U.pointer--);break;case s.ParserState.Relative:if(null===t)throw new Error("Invalid parser state. Base URL is null.");switch(i.scheme=t.scheme,U.c()){case"":i.username=t.username,i.password=t.password,i.host=t.host,i.port=t.port,i.path=l.list.clone(t.path),i.query=t.query;break;case"/":S=s.ParserState.RelativeSlash;break;case"?":i.username=t.username,i.password=t.password,i.host=t.host,i.port=t.port,i.path=l.list.clone(t.path),i.query="",S=s.ParserState.Query;break;case"#":i.username=t.username,i.password=t.password,i.host=t.host,i.port=t.port,i.path=l.list.clone(t.path),i.query=t.query,i.fragment="",S=s.ParserState.Fragment;break;default:C(i)&&"\\"===U.c()?(v("Invalid input string."),S=s.ParserState.RelativeSlash):(i.username=t.username,i.password=t.password,i.host=t.host,i.port=t.port,i.path=l.list.clone(t.path),0!==i.path.length&&i.path.splice(i.path.length-1,1),S=s.ParserState.Path,U.pointer--)}break;case s.ParserState.RelativeSlash:if(!C(i)||"/"!==U.c()&&"\\"!==U.c())if("/"===U.c())S=s.ParserState.Authority;else{if(null===t)throw new Error("Invalid parser state. Base URL is null.");i.username=t.username,i.password=t.password,i.host=t.host,i.port=t.port,S=s.ParserState.Path,U.pointer--}else"\\"===U.c()&&v("Invalid input string."),S=s.ParserState.SpecialAuthorityIgnoreSlashes;break;case s.ParserState.SpecialAuthoritySlashes:"/"===U.c()&&U.remaining().startsWith("/")?(S=s.ParserState.SpecialAuthorityIgnoreSlashes,U.pointer++):(v("Expected '//'."),S=s.ParserState.SpecialAuthorityIgnoreSlashes,U.pointer--);break;case s.ParserState.SpecialAuthorityIgnoreSlashes:"/"!==U.c()&&"\\"!==U.c()?(S=s.ParserState.Authority,U.pointer--):v("Unexpected '/' or '\\'.");break;case s.ParserState.Authority:if("@"===U.c()){v("Unexpected '@'."),k&&(L="%40"+L),k=!0;try{for(var G=(c=void 0,r(L)),W=G.next();!W.done;W=G.next()){var H=W.value;if(":"!==H||V){var j=z(H,f);V?i.password+=j:i.username+=j}else V=!0}}catch(e){c={error:e}}finally{try{W&&!W.done&&(u=G.return)&&u.call(G)}finally{if(c)throw c.error}}L=""}else if(""===U.c()||"/"===U.c()||"?"===U.c()||"#"===U.c()||C(i)&&"\\"===U.c()){if(k&&""===L)return v("Invalid input string."),null;U.pointer-=L.length+1,L="",S=s.ParserState.Host}else L+=U.c();break;case s.ParserState.Host:case s.ParserState.Hostname:if(void 0!==o&&"file"===i.scheme)U.pointer--,S=s.ParserState.FileHost;else if(":"!==U.c()||F)if(""===U.c()||"/"===U.c()||"?"===U.c()||"#"===U.c()||C(i)&&"\\"===U.c()){if(U.pointer--,C(i)&&""===L)return v("Invalid input string."),null;if(void 0!==o&&""===L&&(E(i)||null!==i.port))return v("Invalid input string."),i;if(null===(K=N(L,!C(i))))return null;if(i.host=K,L="",S=s.ParserState.PathStart,void 0!==o)return i}else"["===U.c()&&(F=!0),"]"===U.c()&&(F=!1),L+=U.c();else{if(""===L)return v("Invalid input string."),null;if(null===(K=N(L,!C(i))))return null;if(i.host=K,L="",S=s.ParserState.Port,o===s.ParserState.Hostname)return i}break;case s.ParserState.Port:if(l.codePoint.ASCIIDigit.test(U.c()))L+=U.c();else{if(!(""===U.c()||"/"===U.c()||"?"===U.c()||"#"===U.c()||C(i)&&"\\"===U.c()||o))return v("Invalid input string."),null;if(""!==L&&""!==L){var Z=parseInt(L,10);if(Z>Math.pow(2,16)-1)return v("Invalid port number."),null;i.port=Z===w(i.scheme)?null:Z,L=""}if(void 0!==o)return i;S=s.ParserState.PathStart,U.pointer--}break;case s.ParserState.File:if(i.scheme="file","/"===U.c()||"\\"===U.c())"\\"===U.c()&&v("Invalid input string."),S=s.ParserState.FileSlash;else if(null!==t&&"file"===t.scheme)switch(U.c()){case"":i.host=t.host,i.path=l.list.clone(t.path),i.query=t.query;break;case"?":i.host=t.host,i.path=l.list.clone(t.path),i.query="",S=s.ParserState.Query;break;case"#":i.host=t.host,i.path=l.list.clone(t.path),i.query=t.query,i.fragment="",S=s.ParserState.Fragment;break;default:M(U.substring())?v("Unexpected windows drive letter in input string."):(i.host=t.host,i.path=l.list.clone(t.path),P(i)),S=s.ParserState.Path,U.pointer--}else S=s.ParserState.Path,U.pointer--;break;case s.ParserState.FileSlash:"/"===U.c()||"\\"===U.c()?("\\"===U.c()&&v("Invalid input string."),S=s.ParserState.FileHost):(null===t||"file"!==t.scheme||M(U.substring())||(O(t.path[0])?i.path.push(t.path[0]):i.host=t.host),S=s.ParserState.Path,U.pointer--);break;case s.ParserState.FileHost:if(""===U.c()||"/"===U.c()||"\\"===U.c()||"?"===U.c()||"#"===U.c())if(U.pointer--,void 0===o&&R(L))v("Unexpected windows drive letter in input string."),S=s.ParserState.Path;else if(""===L){if(i.host="",void 0!==o)return i;S=s.ParserState.PathStart}else{var K;if(null===(K=N(L,!C(i))))return null;if("localhost"===K&&(K=""),i.host=K,void 0!==o)return i;L="",S=s.ParserState.PathStart}else L+=U.c();break;case s.ParserState.PathStart:C(i)?("\\"===U.c()&&v("Invalid input string."),S=s.ParserState.Path,"/"!==U.c()&&"\\"!==U.c()&&U.pointer--):void 0===o&&"?"===U.c()?(i.query="",S=s.ParserState.Query):void 0===o&&"#"===U.c()?(i.fragment="",S=s.ParserState.Fragment):""!==U.c()&&(S=s.ParserState.Path,"/"!==U.c()&&U.pointer--);break;case s.ParserState.Path:if(""===U.c()||"/"===U.c()||C(i)&&"\\"===U.c()||void 0===o&&("?"===U.c()||"#"===U.c())){if(C(i)&&"\\"===U.c()&&v("Invalid input string."),A(L))P(i),"/"===U.c()||C(i)&&"\\"===U.c()||i.path.push("");else if(!D(L)||"/"===U.c()||C(i)&&"\\"===U.c()){if(!D(L)){if("file"===i.scheme&&0===i.path.length&&R(L)){null!==i.host&&""!==i.host&&(v("Invalid input string."),i.host="");var $=Array.from(L);L=$.slice(0,1)+":"+$.slice(2)}i.path.push(L)}}else i.path.push("");if(L="","file"===i.scheme&&(""===U.c()||"?"===U.c()||"#"===U.c()))for(;i.path.length>1&&""===i.path[0];)v("Invalid input string."),i.path.splice(0,1);"?"===U.c()&&(i.query="",S=s.ParserState.Query),"#"===U.c()&&(i.fragment="",S=s.ParserState.Fragment)}else m.test(U.c())||"%"===U.c()||v("Character is not a URL code point or a percent encoded character."),"%"!==U.c()||/^[0-9a-fA-F][0-9a-fA-F]/.test(U.remaining())||v("Percent encoded character must be followed by two hex digits."),L+=z(U.c(),h);break;case s.ParserState.CannotBeABaseURLPath:"?"===U.c()?(i.query="",S=s.ParserState.Query):"#"===U.c()?(i.fragment="",S=s.ParserState.Fragment):(""===U.c()||m.test(U.c())||"%"===U.c()||v("Character is not a URL code point or a percent encoded character."),"%"!==U.c()||/^[0-9a-fA-F][0-9a-fA-F]/.test(U.remaining())||v("Percent encoded character must be followed by two hex digits."),""!==U.c()&&(i.path[0]+=z(U.c(),d)));break;case s.ParserState.Query:if("UTF-8"===I||C(i)&&"ws"!==i.scheme&&"wss"!==i.scheme||(I="UTF-8"),void 0===o&&"#"===U.c())i.fragment="",S=s.ParserState.Fragment;else if(""!==U.c()){if(m.test(U.c())||"%"===U.c()||v("Character is not a URL code point or a percent encoded character."),"%"!==U.c()||/^[0-9a-fA-F][0-9a-fA-F]/.test(U.remaining())||v("Percent encoded character must be followed by two hex digits."),"UTF-8"!==I.toUpperCase())throw new Error("Only UTF-8 encoding is supported.");var q=a.utf8Encode(U.c());if(q.length>=3&&38===q[0]&&35===q[1]&&59===q[q.length-1])q=q.subarray(2,q.length-1),i.query+="%26%23"+l.byteSequence.isomorphicDecode(q)+"%3B";else try{for(var X=(g=void 0,r(q)),Y=X.next();!Y.done;Y=X.next()){var J=Y.value;J<33||J>126||34===J||35===J||60===J||62===J||39===J&&C(i)?i.query+=B(J):i.query+=String.fromCharCode(J)}}catch(e){g={error:e}}finally{try{Y&&!Y.done&&(y=X.return)&&y.call(X)}finally{if(g)throw g.error}}}break;case s.ParserState.Fragment:""===U.c()||("\0"===U.c()?v("NULL character in input string."):(m.test(U.c())||"%"===U.c()||v("Unexpected character in fragment string."),"%"!==U.c()||/^[A-Za-z0-9][A-Za-z0-9]/.test(U.remaining())||v("Unexpected character in fragment string."),i.fragment+=z(U.c(),p)))}if(U.eof)break;U.pointer++}return i}function D(e){return"."===e||"%2e"===e.toLowerCase()}function A(e){var t=e.toLowerCase();return".."===t||".%2e"===t||"%2e."===t||"%2e%2e"===t}function P(e){var t=e.path;0!==t.length&&("file"===e.scheme&&1===t.length&&O(t[0])||e.path.splice(e.path.length-1,1))}function O(e){return e.length>=2&&l.codePoint.ASCIIAlpha.test(e[0])&&":"===e[1]}function R(e){return e.length>=2&&l.codePoint.ASCIIAlpha.test(e[0])&&(":"===e[1]||"|"===e[1])}function M(e){return e.length>=2&&R(e)&&(2===e.length||"/"===e[2]||"\\"===e[2]||"?"===e[2]||"#"===e[2])}function N(e,t){if(void 0===t&&(t=!1),e.startsWith("["))return e.endsWith("]")?F(e.substring(1,e.length-1)):(v("Expected ']' after '['."),null);if(t)return V(e);var n=Z(a.utf8Decode(W(e)));if(null===n)return v("Invalid domain."),null;if(g.test(n))return v("Invalid domain."),null;var r=k(n);return null===r||a.isNumber(r)?r:n}function L(e,t){void 0===t&&(t={value:!1});var n=10;return e.startsWith("0x")||e.startsWith("0X")?(t.value=!0,e=e.substr(2),n=16):e.length>=2&&"0"===e[0]&&(t.value=!0,e=e.substr(1),n=8),""===e?0:(10===n?/^[0-9]+$/:16===n?/^[0-9A-Fa-f]+$/:/^[0-7]+$/).test(e)?parseInt(e,n):null}function k(e){var t,n,i,o,a={value:!1},s=e.split(".");if(""===s[s.length-1]&&(a.value=!0,s.length>1&&s.pop()),s.length>4)return e;var l=[];try{for(var c=r(s),u=c.next();!u.done;u=c.next()){var d=u.value;if(""===d)return e;if(null===(y=L(d,a)))return e;l.push(y)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}a.value&&v("Invalid IP v4 address.");for(var p=0;p<l.length;p++)if(l[p]>255&&(v("Invalid IP v4 address."),p<l.length-1))return null;if(l[l.length-1]>=Math.pow(256,5-l.length))return v("Invalid IP v4 address."),null;var h=l[l.length-1];l.pop();var f=0;try{for(var m=r(l),g=m.next();!g.done;g=m.next()){var y;h+=(y=g.value)*Math.pow(256,3-f),f++}}catch(e){i={error:e}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}return h}function F(e){var t,n=[0,0,0,0,0,0,0,0],r=0,o=null,s=new a.StringWalker(e);if(":"===s.c()){if(!s.remaining().startsWith(":"))return v("Invalid IP v6 address."),null;s.pointer+=2,o=r+=1}for(;""!==s.c();){if(8===r)return v("Invalid IP v6 address."),null;if(":"!==s.c()){for(var c=0,u=0;u<4&&l.codePoint.ASCIIHexDigit.test(s.c());)c=16*c+parseInt(s.c(),16),s.pointer++,u++;if("."===s.c()){if(0===u)return v("Invalid IP v6 address."),null;if(s.pointer-=u,r>6)return v("Invalid IP v6 address."),null;for(var d=0;""!==s.c();){var p=null;if(d>0){if(!("."===s.c()&&d<4))return v("Invalid IP v6 address."),null;s.pointer++}if(!l.codePoint.ASCIIDigit.test(s.c()))return v("Invalid IP v6 address."),null;for(;l.codePoint.ASCIIDigit.test(s.c());){var h=parseInt(s.c(),10);if(null===p)p=h;else{if(0===p)return v("Invalid IP v6 address."),null;p=10*p+h}if(p>255)return v("Invalid IP v6 address."),null;s.pointer++}if(null===p)return v("Invalid IP v6 address."),null;n[r]=256*n[r]+p,2!==++d&&4!==d||r++}if(4!==d)return v("Invalid IP v6 address."),null;break}if(":"===s.c()){if(s.pointer++,""===s.c())return v("Invalid IP v6 address."),null}else if(""!==s.c())return v("Invalid IP v6 address."),null;n[r]=c,r++}else{if(null!==o)return v("Invalid IP v6 address."),null;s.pointer++,o=++r}}if(null!==o){var f=r-o;for(r=7;0!==r&&f>0;)t=i([n[o+f-1],n[r]],2),n[r]=t[0],n[o+f-1]=t[1],r--,f--}else if(null===o&&8!==r)return v("Invalid IP v6 address."),null;return n}function V(e){var t,n;if(/[\x00\t\f\r #/:?@\[\\\]]/.test(e))return v("Invalid host string."),null;var i="";try{for(var o=r(e),a=o.next();!a.done;a=o.next())i+=z(a.value,d)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}function U(e){return null}function B(e){return"%"+("00"+e.toString(16).toUpperCase()).slice(-2)}function G(e){for(var t=function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},n=new Uint8Array(e.length),r=0,i=0;i<e.length;i++){var o=e[i];if(37!==o)n[r]=o,r++;else if(37===o&&i>=e.length-2)n[r]=o,r++;else if(37!==o||t(e[i+1])&&t(e[i+2])){var s=parseInt(a.utf8Decode(Uint8Array.of(e[i+1],e[i+2])),16);n[r]=s,r++,i+=2}else n[r]=o,r++}return n.subarray(0,r)}function W(e){return G(a.utf8Encode(e))}function z(e,t){var n,i;if(!t.test(e))return e;var o=a.utf8Encode(e),s="";try{for(var l=r(o),c=l.next();!c.done;c=l.next())s+=B(c.value)}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return s}function H(e){var t,n,i,o,s=[],l=[];try{for(var c=r(e),u=c.next();!u.done;u=c.next()){var d=u.value;38===d?(s.push(Uint8Array.from(l)),l=[]):l.push(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}0!==l.length&&s.push(Uint8Array.from(l));var p=[];try{for(var h=r(s),f=h.next();!f.done;f=h.next()){var m=f.value;if(0!==m.length){for(var g=m.indexOf(61),v=-1!==g?m.slice(0,g):m,y=-1!==g?m.slice(g+1):new Uint8Array,b=0;b<v.length;b++)43===v[b]&&(v[b]=32);for(b=0;b<y.length;b++)43===y[b]&&(y[b]=32);var C=a.utf8Decode(v),w=a.utf8Decode(y);p.push([C,w])}}}catch(e){i={error:e}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return p}function j(e){var t,n,i="";try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var s=a.value;i+=32===s?"+":42===s||45===s||46===s||s>=48&&s<=57||s>=65&&s<=90||95===s||s>=97&&s<=122?String.fromCodePoint(s):B(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}function Z(e,t){void 0===t&&(t=!1);var n=c.domainToASCII(e);return""===n?(v("Invalid domain name."),null):n}t.setValidationErrorCallback=function(e){o=e},t.newURL=y,t.isSpecialScheme=b,t.isSpecial=C,t.defaultPort=w,t.includesCredentials=E,t.cannotHaveAUsernamePasswordPort=function(e){return null===e.host||""===e.host||e._cannotBeABaseURLFlag||"file"===e.scheme},t.urlSerializer=T,t.hostSerializer=x,t.iPv4Serializer=_,t.iPv6Serializer=S,t.urlParser=function(e,t,n){var r=I(e,t,n);return null===r?null:("blob"!==r.scheme||(r._blobURLEntry=null),r)},t.basicURLParser=I,t.setTheUsername=function(e,t){var n,i,o="";try{for(var a=r(t),s=a.next();!s.done;s=a.next())o+=z(s.value,f)}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}e.username=o},t.setThePassword=function(e,t){var n,i,o="";try{for(var a=r(t),s=a.next();!s.done;s=a.next())o+=z(s.value,f)}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}e.password=o},t.isSingleDotPathSegment=D,t.isDoubleDotPathSegment=A,t.shorten=P,t.isNormalizedWindowsDriveLetter=O,t.isWindowsDriveLetter=R,t.startsWithAWindowsDriveLetter=M,t.hostParser=N,t.iPv4NumberParser=L,t.iPv4Parser=k,t.iPv6Parser=F,t.opaqueHostParser=V,t.resolveABlobURL=U,t.percentEncode=B,t.percentDecode=G,t.stringPercentDecode=W,t.utf8PercentEncode=z,t.hostEquals=function(e,t){return e===t},t.urlEquals=function(e,t,n){return void 0===n&&(n=!1),T(e,n)===T(t,n)},t.urlEncodedStringParser=function(e){return H(a.utf8Encode(e))},t.urlEncodedParser=H,t.urlEncodedByteSerializer=j,t.urlEncodedSerializer=function(e,t){var n,i;if("UTF-8"!==(void 0===t||"replacement"===t||"UTF-16BE"===t||"UTF-16LE"===t?"UTF-8":t).toUpperCase())throw new Error("Only UTF-8 encoding is supported.");var o="";try{for(var s=r(e),l=s.next();!l.done;l=s.next()){var c=l.value,u=j(a.utf8Encode(c[0])),d=c[1];d=j(a.utf8Encode(d)),""!==o&&(o+="&"),o+=u+"="+d}}catch(e){n={error:e}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},t.origin=function e(t){switch(t.scheme){case"blob":t._blobURLEntry;var n=I(t.path[0]);return null===n?s.OpaqueOrigin:e(n);case"ftp":case"http":case"https":case"ws":case"wss":return[t.scheme,null===t.host?"":t.host,t.port,null];default:return s.OpaqueOrigin}},t.domainToASCII=Z,t.domainToUnicode=function(e,t){void 0===t&&(t=!1);var n=c.domainToUnicode(e);return""===n&&v("Invalid domain name."),n},t.asciiSerializationOfAnOrigin=function(e){if(""===e[0]&&""===e[1]&&null===e[2]&&null===e[3])return"null";var t=e[0]+"://"+x(e[1]);return null!==e[2]&&(t+=":"+e[2].toString()),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){this._signal=r.create_abortSignal()}return Object.defineProperty(e.prototype,"signal",{get:function(){return this._signal},enumerable:!0,configurable:!0}),e.prototype.abort=function(){r.abort_signalAbort(this._signal)},e}();t.AbortControllerImpl=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(70),a=n(0),s=function(e){function t(){var t=e.call(this)||this;return t._abortedFlag=!1,t._abortAlgorithms=new Set,t}return i(t,e),Object.defineProperty(t.prototype,"aborted",{get:function(){return this._abortedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onabort",{get:function(){return a.event_getterEventHandlerIDLAttribute(this,"onabort")},set:function(e){a.event_setterEventHandlerIDLAttribute(this,"onabort",e)},enumerable:!0,configurable:!0}),t._create=function(){return new t},t}(o.EventTargetImpl);t.AbortSignalImpl=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(34),s=n(12),l=function(e){function t(t,n,r){var i=e.call(this)||this;return i._name="",i._publicId="",i._systemId="",i._name=t,i._publicId=n,i._systemId=r,i}return i(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"publicId",{get:function(){return this._publicId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"systemId",{get:function(){return this._systemId},enumerable:!0,configurable:!0}),t.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Mixin: ChildNode not implemented.")},t.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},t._create=function(e,n,r,i){void 0===r&&(r=""),void 0===i&&(i="");var o=new t(n,r,i);return o._nodeDocument=e,o},t}(a.NodeImpl);t.DocumentTypeImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.DocumentType)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(100),a=n(1),s=n(0),l=function(e){function t(t,n){var r=e.call(this)||this;return r._host=t,r._mode=n,r}return i(t,e),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),t.prototype._getTheParent=function(e){return e._composedFlag||a.isEmpty(e._path)||s.tree_rootNode(e._path[0].invocationTarget)!==this?this._host:null},t._create=function(e,n){return new t(n,"closed")},t}(o.DocumentFragmentImpl);t.ShadowRootImpl=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(34),s=n(0),l=n(12),c=function(e){function t(t){var n=e.call(this)||this;return n._namespace=null,n._namespacePrefix=null,n._element=null,n._value="",n._localName=t,n}return i(t,e),Object.defineProperty(t.prototype,"ownerElement",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._qualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){s.attr_setAnExistingAttributeValue(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_qualifiedName",{get:function(){return null!==this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),t._create=function(e,n){var r=new t(n);return r._nodeDocument=e,r},t}(a.NodeImpl);t.AttrImpl=c,l.idl_defineConst(c.prototype,"_nodeType",o.NodeType.Attribute),l.idl_defineConst(c.prototype,"specified",!0)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(101),a=n(2),s=n(12),l=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t._create=function(e,n){void 0===n&&(n="");var r=new t(n);return r._nodeDocument=e,r},t}(o.TextImpl);t.CDATASectionImpl=l,s.idl_defineConst(l.prototype,"_nodeType",a.NodeType.CData)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(71),s=n(12),l=function(e){function t(t){return void 0===t&&(t=""),e.call(this,t)||this}return i(t,e),t._create=function(e,n){void 0===n&&(n="");var r=new t(n);return r._nodeDocument=e,r},t}(a.CharacterDataImpl);t.CommentImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.Comment)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(71),s=n(12),l=function(e){function t(t,n){var r=e.call(this,n)||this;return r._target=t,r}return i(t,e),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),t._create=function(e,n,r){var i=new t(n,r);return i._nodeDocument=e,i},t}(a.CharacterDataImpl);t.ProcessingInstructionImpl=l,s.idl_defineConst(l.prototype,"_nodeType",o.NodeType.ProcessingInstruction)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(0),o=n(3),a=n(1),s=function(){function e(e,t){return this._live=!0,this._root=e,this._filter=t,new Proxy(this,this)}return Object.defineProperty(e.prototype,"length",{get:function(){for(var e=this,t=0,n=i.tree_getFirstDescendantNode(this._root,!1,!1,function(t){return o.Guard.isElementNode(t)&&e._filter(t)});null!==n;)t++,n=i.tree_getNextDescendantNode(this._root,n,!1,!1,function(t){return o.Guard.isElementNode(t)&&e._filter(t)});return t},enumerable:!0,configurable:!0}),e.prototype.item=function(e){for(var t=this,n=0,r=i.tree_getFirstDescendantNode(this._root,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)});null!==r;){if(n===e)return r;n++,r=i.tree_getNextDescendantNode(this._root,r,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)})}return null},e.prototype.namedItem=function(e){var t=this;if(""===e)return null;for(var n=i.tree_getFirstDescendantNode(this._root,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)});null!=n;){if(n._uniqueIdentifier===e)return n;if(n._namespace===r.namespace.HTML)for(var a=0;a<n._attributeList.length;a++){var s=n._attributeList[a];if("name"===s._localName&&null===s._namespace&&null===s._namespacePrefix&&s._value===e)return n}n=i.tree_getNextDescendantNode(this._root,n,!1,!1,function(e){return o.Guard.isElementNode(e)&&t._filter(e)})}return null},e.prototype[Symbol.iterator]=function(){var e=this._root,t=this._filter,n=i.tree_getFirstDescendantNode(e,!1,!1,function(e){return o.Guard.isElementNode(e)&&t(e)});return{next:function(){if(null===n)return{done:!0,value:null};var r={done:!1,value:n};return n=i.tree_getNextDescendantNode(e,n,!1,!1,function(e){return o.Guard.isElementNode(e)&&t(e)}),r}}},e.prototype.get=function(t,n,r){if(!a.isString(n)||-1!==e.reservedNames.indexOf(n))return Reflect.get(t,n,r);var i=Number(n);return isNaN(i)?t.namedItem(n)||void 0:t.item(i)||void 0},e.prototype.set=function(t,n,r,o){if(!a.isString(n)||-1!==e.reservedNames.indexOf(n))return Reflect.set(t,n,r,o);var s=Number(n),l=isNaN(s)?t.namedItem(n)||void 0:t.item(s)||void 0;return!(!l||!l._parent||(i.mutation_replace(l,r,l._parent),0))},e._create=function(t,n){return void 0===n&&(n=function(){return!0}),new e(t,n)},e.reservedNames=["_root","_live","_filter","length","item","namedItem","get","set"],e}();t.HTMLCollectionImpl=s},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(1),a=n(0),s=function(){function e(e){return this._live=!0,this._filter=null,this._length=0,this._root=e,new Proxy(this,this)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._root._children.size},enumerable:!0,configurable:!0}),e.prototype.item=function(e){if(e<0||e>this.length-1)return null;if(e<this.length/2){for(var t=0,n=this._root._firstChild;null!==n&&t!==e;)n=n._nextSibling,t++;return n}for(t=this.length-1,n=this._root._lastChild;null!==n&&t!==e;)n=n._previousSibling,t--;return n},e.prototype.keys=function(){var e;return(e={})[Symbol.iterator]=function(){var e=0;return{next:function(){return e===this.length?{done:!0,value:null}:{done:!1,value:e++}}.bind(this)}}.bind(this),e},e.prototype.values=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator]();return{next:function(){return e.next()}}}.bind(this),e},e.prototype.entries=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator](),t=0;return{next:function(){var n=e.next();return n.done?{done:!0,value:null}:{done:!1,value:[t++,n.value]}}}}.bind(this),e},e.prototype[Symbol.iterator]=function(){return this._root._children[Symbol.iterator]()},e.prototype.forEach=function(e,t){var n,o;void 0===t&&(t=i.dom.window);var a=0;try{for(var s=r(this._root._children),l=s.next();!l.done;l=s.next()){var c=l.value;e.call(t,c,a++,this)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},e.prototype.get=function(e,t,n){if(!o.isString(t))return Reflect.get(e,t,n);var r=Number(t);return isNaN(r)?Reflect.get(e,t,n):e.item(r)||void 0},e.prototype.set=function(e,t,n,r){if(!o.isString(t))return Reflect.set(e,t,n,r);var i=Number(t);if(isNaN(i))return Reflect.set(e,t,n,r);var s=e.item(i)||void 0;return!!s&&!!s._parent&&(a.mutation_replace(s,n,s._parent),!0)},e._create=function(t){return new e(t)},e}();t.NodeListImpl=s},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(1),a=function(){function e(e){return this._live=!1,this._items=[],this._length=0,this._root=e,this._items=[],this._filter=function(e){return!0},new Proxy(this,this)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),e.prototype.item=function(e){return e<0||e>this.length-1?null:this._items[e]},e.prototype.keys=function(){var e;return(e={})[Symbol.iterator]=function(){var e=0;return{next:function(){return e===this.length?{done:!0,value:null}:{done:!1,value:e++}}.bind(this)}}.bind(this),e},e.prototype.values=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator]();return{next:function(){return e.next()}}}.bind(this),e},e.prototype.entries=function(){var e;return(e={})[Symbol.iterator]=function(){var e=this[Symbol.iterator](),t=0;return{next:function(){var n=e.next();return n.done?{done:!0,value:null}:{done:!1,value:[t++,n.value]}}}}.bind(this),e},e.prototype[Symbol.iterator]=function(){var e=this._items[Symbol.iterator]();return{next:function(){return e.next()}}},e.prototype.forEach=function(e,t){var n,o;void 0===t&&(t=i.dom.window);var a=0;try{for(var s=r(this._items),l=s.next();!l.done;l=s.next()){var c=l.value;e.call(t,c,a++,this)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},e.prototype.get=function(e,t,n){if(!o.isString(t))return Reflect.get(e,t,n);var r=Number(t);return isNaN(r)?Reflect.get(e,t,n):e._items[r]||void 0},e.prototype.set=function(e,t,n,r){if(!o.isString(t))return Reflect.set(e,t,n,r);var i=Number(t);return isNaN(i)?Reflect.set(e,t,n,r):i>=0&&i<e._items.length&&(e._items[i]=n,!0)},e._create=function(t,n){var r=new e(t);return r._items=n,r},e}();t.NodeListStaticImpl=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(0),s=function(e){function t(n){var r=e.call(this)||this;return r._element=n,Object.setPrototypeOf(r,t.prototype),r}return i(t,e),t.prototype._asArray=function(){return this},t.prototype.item=function(e){return this[e]||null},t.prototype.getNamedItem=function(e){return a.element_getAnAttributeByName(e,this._element)},t.prototype.getNamedItemNS=function(e,t){return a.element_getAnAttributeByNamespaceAndLocalName(e||"",t,this._element)},t.prototype.setNamedItem=function(e){return a.element_setAnAttribute(e,this._element)},t.prototype.setNamedItemNS=function(e){return a.element_setAnAttribute(e,this._element)},t.prototype.removeNamedItem=function(e){var t=a.element_removeAnAttributeByName(e,this._element);if(null===t)throw new o.NotFoundError;return t},t.prototype.removeNamedItemNS=function(e,t){var n=a.element_removeAnAttributeByNamespaceAndLocalName(e||"",t,this._element);if(null===n)throw new o.NotFoundError;return n},t._create=function(e){return new t(e)},t}(Array);t.NamedNodeMapImpl=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(2),l=n(102),c=n(9),u=n(0),d=n(12),p=n(3),h=function(e){function t(){var t=e.call(this)||this,n=a.dom.window._associatedDocument;return t._start=[n,0],t._end=[n,0],a.dom.rangeList.add(t),t}return i(t,e),Object.defineProperty(t.prototype,"commonAncestorContainer",{get:function(){for(var e=this._start[0];!u.tree_isAncestorOf(this._end[0],e,!0);){if(null===e._parent)throw new Error("Parent node  is null.");e=e._parent}return e},enumerable:!0,configurable:!0}),t.prototype.setStart=function(e,t){u.range_setTheStart(this,e,t)},t.prototype.setEnd=function(e,t){u.range_setTheEnd(this,e,t)},t.prototype.setStartBefore=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheStart(this,t,u.tree_index(e))},t.prototype.setStartAfter=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheStart(this,t,u.tree_index(e)+1)},t.prototype.setEndBefore=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheEnd(this,t,u.tree_index(e))},t.prototype.setEndAfter=function(e){var t=e._parent;if(null===t)throw new c.InvalidNodeTypeError;u.range_setTheEnd(this,t,u.tree_index(e)+1)},t.prototype.collapse=function(e){e?this._end=this._start:this._start=this._end},t.prototype.selectNode=function(e){u.range_select(e,this)},t.prototype.selectNodeContents=function(e){if(p.Guard.isDocumentTypeNode(e))throw new c.InvalidNodeTypeError;var t=u.tree_nodeLength(e);this._start=[e,0],this._end=[e,t]},t.prototype.compareBoundaryPoints=function(e,t){if(e!==s.HowToCompare.StartToStart&&e!==s.HowToCompare.StartToEnd&&e!==s.HowToCompare.EndToEnd&&e!==s.HowToCompare.EndToStart)throw new c.NotSupportedError;if(u.range_root(this)!==u.range_root(t))throw new c.WrongDocumentError;var n,r;switch(e){case s.HowToCompare.StartToStart:n=this._start,r=t._start;break;case s.HowToCompare.StartToEnd:n=this._end,r=t._start;break;case s.HowToCompare.EndToEnd:n=this._end,r=t._end;break;case s.HowToCompare.EndToStart:n=this._start,r=t._end;break;default:throw new c.NotSupportedError}var i=u.boundaryPoint_position(n,r);return i===s.BoundaryPosition.Before?-1:i===s.BoundaryPosition.After?1:0},t.prototype.deleteContents=function(){var e,t,n,r;if(!u.range_collapsed(this)){var i=this._startNode,a=this._startOffset,s=this._endNode,l=this._endOffset;if(i===s&&p.Guard.isCharacterDataNode(i))u.characterData_replaceData(i,a,l-a,"");else{var c,d,h=[];try{for(var f=o(u.range_getContainedNodes(this)),m=f.next();!m.done;m=f.next()){var g=(C=m.value)._parent;null!==g&&u.range_isContained(g,this)||h.push(C)}}catch(t){e={error:t}}finally{try{m&&!m.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(u.tree_isAncestorOf(s,i,!0))c=i,d=a;else{for(var v=i;null!==v._parent&&!u.tree_isAncestorOf(s,v._parent,!0);)v=v._parent;if(null===v._parent)throw new Error("Parent node is null.");c=v._parent,d=u.tree_index(v)+1}p.Guard.isCharacterDataNode(i)&&u.characterData_replaceData(i,a,u.tree_nodeLength(i)-a,"");try{for(var y=o(h),b=y.next();!b.done;b=y.next()){var C;(C=b.value)._parent&&u.mutation_remove(C,C._parent)}}catch(e){n={error:e}}finally{try{b&&!b.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}p.Guard.isCharacterDataNode(s)&&u.characterData_replaceData(s,0,l,""),this._start=[c,d],this._end=[c,d]}}},t.prototype.extractContents=function(){return u.range_extract(this)},t.prototype.cloneContents=function(){return u.range_cloneTheContents(this)},t.prototype.insertNode=function(e){return u.range_insert(e,this)},t.prototype.surroundContents=function(e){var t,n;try{for(var r=o(u.range_getPartiallyContainedNodes(this)),i=r.next();!i.done;i=r.next()){var a=i.value;if(!p.Guard.isTextNode(a))throw new c.InvalidStateError}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}if(p.Guard.isDocumentNode(e)||p.Guard.isDocumentTypeNode(e)||p.Guard.isDocumentFragmentNode(e))throw new c.InvalidNodeTypeError;var s=u.range_extract(this);0!==e._children.size&&u.mutation_replaceAll(null,e),u.range_insert(e,this),u.mutation_append(s,e),u.range_select(e,this)},t.prototype.cloneRange=function(){return u.create_range(this._start,this._end)},t.prototype.detach=function(){a.dom.rangeList.delete(this)},t.prototype.isPointInRange=function(e,t){if(u.tree_rootNode(e)!==u.range_root(this))return!1;if(p.Guard.isDocumentTypeNode(e))throw new c.InvalidNodeTypeError;if(t>u.tree_nodeLength(e))throw new c.IndexSizeError;var n=[e,t];return u.boundaryPoint_position(n,this._start)!==s.BoundaryPosition.Before&&u.boundaryPoint_position(n,this._end)!==s.BoundaryPosition.After},t.prototype.comparePoint=function(e,t){if(u.tree_rootNode(e)!==u.range_root(this))throw new c.WrongDocumentError;if(p.Guard.isDocumentTypeNode(e))throw new c.InvalidNodeTypeError;if(t>u.tree_nodeLength(e))throw new c.IndexSizeError;var n=[e,t];return u.boundaryPoint_position(n,this._start)===s.BoundaryPosition.Before?-1:u.boundaryPoint_position(n,this._end)===s.BoundaryPosition.After?1:0},t.prototype.intersectsNode=function(e){if(u.tree_rootNode(e)!==u.range_root(this))return!1;var t=e._parent;if(null===t)return!0;var n=u.tree_index(e);return u.boundaryPoint_position([t,n],this._end)===s.BoundaryPosition.Before&&u.boundaryPoint_position([t,n+1],this._start)===s.BoundaryPosition.After},t.prototype.toString=function(){var e,t,n="";if(this._startNode===this._endNode&&p.Guard.isTextNode(this._startNode))return this._startNode._data.substring(this._startOffset,this._endOffset);p.Guard.isTextNode(this._startNode)&&(n+=this._startNode._data.substring(this._startOffset));try{for(var r=o(u.range_getContainedNodes(this)),i=r.next();!i.done;i=r.next()){var a=i.value;p.Guard.isTextNode(a)&&(n+=a._data)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return p.Guard.isTextNode(this._endNode)&&(n+=this._endNode._data.substring(0,this._endOffset)),n},t._create=function(e,n){var r=new t;return e&&(r._start=e),n&&(r._end=n),r},t.START_TO_START=0,t.START_TO_END=1,t.END_TO_END=2,t.END_TO_START=3,t}(l.AbstractRangeImpl);t.RangeImpl=h,d.idl_defineConst(h.prototype,"START_TO_START",0),d.idl_defineConst(h.prototype,"START_TO_END",1),d.idl_defineConst(h.prototype,"END_TO_END",2),d.idl_defineConst(h.prototype,"END_TO_START",3)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(103),a=n(0),s=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i._iteratorCollection=void 0,i._reference=n,i._pointerBeforeReference=r,a.nodeIterator_iteratorList().add(i),i}return i(t,e),Object.defineProperty(t.prototype,"referenceNode",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerBeforeReferenceNode",{get:function(){return this._pointerBeforeReference},enumerable:!0,configurable:!0}),t.prototype.nextNode=function(){return a.nodeIterator_traverse(this,!0)},t.prototype.previousNode=function(){return a.nodeIterator_traverse(this,!1)},t.prototype.detach=function(){a.nodeIterator_iteratorList().delete(this)},t._create=function(e,n,r){return new t(e,n,r)},t}(o.TraverserImpl);t.NodeIteratorImpl=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(103),s=n(0),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r._current=n,r}return i(t,e),Object.defineProperty(t.prototype,"currentNode",{get:function(){return this._current},set:function(e){this._current=e},enumerable:!0,configurable:!0}),t.prototype.parentNode=function(){for(var e=this._current;null!==e&&e!==this._root;)if(null!==(e=e._parent)&&s.traversal_filter(this,e)===o.FilterResult.Accept)return this._current=e,e;return null},t.prototype.firstChild=function(){return s.treeWalker_traverseChildren(this,!0)},t.prototype.lastChild=function(){return s.treeWalker_traverseChildren(this,!1)},t.prototype.nextSibling=function(){return s.treeWalker_traverseSiblings(this,!0)},t.prototype.previousNode=function(){for(var e=this._current;e!==this._root;){for(var t=e._previousSibling;t;){e=t;for(var n=s.traversal_filter(this,e);n!==o.FilterResult.Reject&&e._lastChild;)e=e._lastChild,n=s.traversal_filter(this,e);if(n===o.FilterResult.Accept)return this._current=e,e;t=e._previousSibling}if(e===this._root||null===e._parent)return null;if(e=e._parent,s.traversal_filter(this,e)===o.FilterResult.Accept)return this._current=e,e}return null},t.prototype.previousSibling=function(){return s.treeWalker_traverseSiblings(this,!1)},t.prototype.nextNode=function(){for(var e=this._current,t=o.FilterResult.Accept;;){for(;t!==o.FilterResult.Reject&&e._firstChild;)if(e=e._firstChild,(t=s.traversal_filter(this,e))===o.FilterResult.Accept)return this._current=e,e;for(var n=null,r=e;null!==r;){if(r===this._root)return null;if(null!==(n=r._nextSibling)){e=n;break}r=r._parent}if((t=s.traversal_filter(this,e))===o.FilterResult.Accept)return this._current=e,e}},t._create=function(e,n){return new t(e,n)},t}(a.TraverserImpl);t.TreeWalkerImpl=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(12),o=function(){function e(){}return e.prototype.acceptNode=function(e){return r.FilterResult.Accept},e._create=function(){return new e},e.FILTER_ACCEPT=1,e.FILTER_REJECT=2,e.FILTER_SKIP=3,e.SHOW_ALL=4294967295,e.SHOW_ELEMENT=1,e.SHOW_ATTRIBUTE=2,e.SHOW_TEXT=4,e.SHOW_CDATA_SECTION=8,e.SHOW_ENTITY_REFERENCE=16,e.SHOW_ENTITY=32,e.SHOW_PROCESSING_INSTRUCTION=64,e.SHOW_COMMENT=128,e.SHOW_DOCUMENT=256,e.SHOW_DOCUMENT_TYPE=512,e.SHOW_DOCUMENT_FRAGMENT=1024,e.SHOW_NOTATION=2048,e}();t.NodeFilterImpl=o,i.idl_defineConst(o.prototype,"FILTER_ACCEPT",1),i.idl_defineConst(o.prototype,"FILTER_REJECT",2),i.idl_defineConst(o.prototype,"FILTER_SKIP",3),i.idl_defineConst(o.prototype,"SHOW_ALL",4294967295),i.idl_defineConst(o.prototype,"SHOW_ELEMENT",1),i.idl_defineConst(o.prototype,"SHOW_ATTRIBUTE",2),i.idl_defineConst(o.prototype,"SHOW_TEXT",4),i.idl_defineConst(o.prototype,"SHOW_CDATA_SECTION",8),i.idl_defineConst(o.prototype,"SHOW_ENTITY_REFERENCE",16),i.idl_defineConst(o.prototype,"SHOW_ENTITY",32),i.idl_defineConst(o.prototype,"SHOW_PROCESSING_INSTRUCTION",64),i.idl_defineConst(o.prototype,"SHOW_COMMENT",128),i.idl_defineConst(o.prototype,"SHOW_DOCUMENT",256),i.idl_defineConst(o.prototype,"SHOW_DOCUMENT_TYPE",512),i.idl_defineConst(o.prototype,"SHOW_DOCUMENT_FRAGMENT",1024),i.idl_defineConst(o.prototype,"SHOW_NOTATION",2048)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r,i,o,a,s,l){this._type=e,this._target=t,this._addedNodes=n,this._removedNodes=r,this._previousSibling=i,this._nextSibling=o,this._attributeName=a,this._attributeNamespace=s,this._oldValue=l}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addedNodes",{get:function(){return this._addedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"removedNodes",{get:function(){return this._removedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributeName",{get:function(){return this._attributeName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributeNamespace",{get:function(){return this._attributeNamespace},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!0,configurable:!0}),e._create=function(t,n,r,i,o,a,s,l,c){return new e(t,n,r,i,o,a,s,l,c)},e}();t.MutationRecordImpl=r},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(9),a=n(7),s=n(0),l=function(){function e(e,t){this._element=e,this._attribute=t,this._tokenSet=new Set;var n=t._localName,r=s.element_getAnAttributeValue(e,n),o=this;this._element._attributeChangeSteps.push(function(e,t,n,r,i){t===o._attribute._localName&&null===i&&(r?o._tokenSet=s.orderedSet_parse(r):o._tokenSet.clear())}),i.dom.features.steps&&s.dom_runAttributeChangeSteps(e,n,r,r,null)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tokenSet.size},enumerable:!0,configurable:!0}),e.prototype.item=function(e){var t,n,i=0;try{for(var o=r(this._tokenSet),a=o.next();!a.done;a=o.next()){var s=a.value;if(i===e)return s;i++}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return null},e.prototype.contains=function(e){return this._tokenSet.has(e)},e.prototype.add=function(){for(var e,t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];try{for(var l=r(n),c=l.next();!c.done;c=l.next()){var u=c.value;if(""===u)throw new o.SyntaxError("Cannot add an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(u))throw new o.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.add(u)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}s.tokenList_updateSteps(this)},e.prototype.remove=function(){for(var e,t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];try{for(var l=r(n),c=l.next();!c.done;c=l.next()){var u=c.value;if(""===u)throw new o.SyntaxError("Cannot remove an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(u))throw new o.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.delete(u)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}s.tokenList_updateSteps(this)},e.prototype.toggle=function(e,t){if(void 0===t&&(t=void 0),""===e)throw new o.SyntaxError("Cannot toggle an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(e))throw new o.InvalidCharacterError("Token cannot contain whitespace.");return this._tokenSet.has(e)?void 0!==t&&!1!==t||(this._tokenSet.delete(e),s.tokenList_updateSteps(this),!1):(void 0===t||!0===t)&&(this._tokenSet.add(e),s.tokenList_updateSteps(this),!0)},e.prototype.replace=function(e,t){if(""===e||""===t)throw new o.SyntaxError("Cannot replace an empty token.");if(a.codePoint.ASCIIWhiteSpace.test(e)||a.codePoint.ASCIIWhiteSpace.test(t))throw new o.InvalidCharacterError("Token cannot contain whitespace.");return!!this._tokenSet.has(e)&&(a.set.replace(this._tokenSet,e,t),s.tokenList_updateSteps(this),!0)},e.prototype.supports=function(e){return s.tokenList_validationSteps(this,e)},Object.defineProperty(e.prototype,"value",{get:function(){return s.tokenList_serializeSteps(this)},set:function(e){s.element_setAnAttributeValue(this._element,this._attribute._localName,e)},enumerable:!0,configurable:!0}),e.prototype[Symbol.iterator]=function(){var e=this._tokenSet[Symbol.iterator]();return{next:function(){return e.next()}}},e._create=function(t,n){return new e(t,n)},e}();t.DOMTokenListImpl=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(104),a=n(0),s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._detail=null,r._detail=n&&n.detail||null,r}return i(t,e),Object.defineProperty(t.prototype,"detail",{get:function(){return this._detail},enumerable:!0,configurable:!0}),t.prototype.initCustomEvent=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=null),this._dispatchFlag||(a.event_initialize(this,e,t,n),this._detail=r)},t}(o.EventImpl);t.CustomEventImpl=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(2),o=n(105),a=n(17);t.nodeIterator_traverse=function(e,t){for(var n=e._reference,r=e._pointerBeforeReference;;){if(t)if(r)r=!1;else{var s=a.tree_getFollowingNode(e._root,n);if(!s)return null;n=s}else if(r){var l=a.tree_getPrecedingNode(e.root,n);if(!l)return null;n=l}else r=!0;if(o.traversal_filter(e,n)===i.FilterResult.Accept)break}return e._reference=n,e._pointerBeforeReference=r,n},t.nodeIterator_iteratorList=function(){return r.dom.window._iteratorList}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(7),o=n(174);function a(e){if(!o.xml_isName(e))throw new r.InvalidCharacterError("Invalid XML name: "+e);if(!o.xml_isQName(e))throw new r.InvalidCharacterError("Invalid XML qualified name: "+e+".")}t.namespace_validate=a,t.namespace_validateAndExtract=function(e,t){e||(e=null),a(t);var n=t.split(":"),o=2===n.length?n[0]:null,s=2===n.length?n[1]:t;if(o&&null===e)throw new r.NamespaceError("Qualified name includes a prefix but the namespace is null.");if("xml"===o&&e!==i.namespace.XML)throw new r.NamespaceError('Qualified name includes the "xml" prefix but the namespace is not the XML namespace.');if(e!==i.namespace.XMLNS&&("xmlns"===o||"xmlns"===t))throw new r.NamespaceError('Qualified name includes the "xmlns" prefix but the namespace is not the XMLNS namespace.');if(e===i.namespace.XMLNS&&"xmlns"!==o&&"xmlns"!==t)throw new r.NamespaceError('Qualified name does not include the "xmlns" prefix but the namespace is the XMLNS namespace.');return[e,o,s]},t.namespace_extractQName=function(e){a(e);var t=e.split(":");return[2===t.length?t[0]:null,2===t.length?t[1]:e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xml_isName=function(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(!(n>=97&&n<=122||n>=65&&n<=90||58===n||95===n||n>=192&&n<=214||n>=216&&n<=246||n>=248&&n<=767||n>=880&&n<=893||n>=895&&n<=8191||n>=8204&&n<=8205||n>=8304&&n<=8591||n>=11264&&n<=12271||n>=12289&&n<=55295||n>=63744&&n<=64975||n>=65008&&n<=65533||0!==t&&(45===n||46===n||n>=48&&n<=57||183===n||n>=768&&n<=879||n>=8255&&n<=8256))){if(n>=55296&&n<=56319&&t<e.length-1){var r=e.charCodeAt(t+1);if(r>=56320&&r<=57343&&(t++,(n=1024*(n-55296)+r-56320+65536)>=65536&&n<=983039))continue}return!1}}return!0},t.xml_isQName=function(e){for(var t=!1,n=0;n<e.length;n++){var r=e.charCodeAt(n);if(!(r>=97&&r<=122||r>=65&&r<=90||95===r||r>=192&&r<=214||r>=216&&r<=246||r>=248&&r<=767||r>=880&&r<=893||r>=895&&r<=8191||r>=8204&&r<=8205||r>=8304&&r<=8591||r>=11264&&r<=12271||r>=12289&&r<=55295||r>=63744&&r<=64975||r>=65008&&r<=65533||0!==n&&(45===r||46===r||r>=48&&r<=57||183===r||r>=768&&r<=879||r>=8255&&r<=8256))){if(0===n||58!==r){if(r>=55296&&r<=56319&&n<e.length-1){var i=e.charCodeAt(n+1);if(i>=56320&&i<=57343&&(n++,(r=1024*(r-55296)+i-56320+65536)>=65536&&r<=983039))continue}return!1}if(t)return!1;if(n===e.length-1)return!1;t=!0}}return!0},t.xml_isLegalChar=function(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(!(9===n||10===n||13===n||n>=32&&n<=55295||n>=57344&&n<=65533)){if(n>=55296&&n<=56319&&t<e.length-1){var r=e.charCodeAt(t+1);if(r>=56320&&r<=57343&&(t++,(n=1024*(n-55296)+r-56320+65536)>=65536&&n<=1114111))continue}return!1}}return!0},t.xml_isPubidChar=function(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(!(n>=97&&n<=122||n>=65&&n<=90||n>=39&&n<=59||32===n||13===n||10===n||n>=35&&n<=37||33===n||61===n||63===n||64===n||95===n))return!1}return!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(17);t.boundaryPoint_position=function e(t,n){var o=t[0],a=t[1],s=n[0],l=n[1];if(console.assert(i.tree_rootNode(o)===i.tree_rootNode(s),"Boundary points must share the same root node."),o===s)return a===l?r.BoundaryPosition.Equal:a<l?r.BoundaryPosition.Before:r.BoundaryPosition.After;if(i.tree_isFollowing(s,o)){var c=e([s,l],[o,a]);if(c===r.BoundaryPosition.Before)return r.BoundaryPosition.After;if(c===r.BoundaryPosition.After)return r.BoundaryPosition.Before}if(i.tree_isAncestorOf(s,o)){for(var u=s;!i.tree_isChildOf(o,u);)null!==u._parent&&(u=u._parent);if(i.tree_index(u)<a)return r.BoundaryPosition.After}return r.BoundaryPosition.Before}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(3),a=n(7),s=n(29),l=n(108),c=n(30),u=n(37),d=n(52);t.node_stringReplaceAll=function(e,t){var n=null;""!==e&&(n=s.create_text(t._nodeDocument,e)),u.mutation_replaceAll(n,t)},t.node_clone=function e(t,n,a){var l,p,h,f,m;if(void 0===n&&(n=null),void 0===a&&(a=!1),null===n&&(n=t._nodeDocument),o.Guard.isElementNode(t)){m=d.element_createAnElement(n,t._localName,t._namespace,t._namespacePrefix,t._is,!1);try{for(var g=r(t._attributeList),v=g.next();!v.done;v=g.next()){var y=e(v.value,n);d.element_append(y,m)}}catch(e){l={error:e}}finally{try{v&&!v.done&&(p=g.return)&&p.call(g)}finally{if(l)throw l.error}}}else if(o.Guard.isDocumentNode(t)){var b=s.create_document();b._encoding=t._encoding,b._contentType=t._contentType,b._URL=t._URL,b._origin=t._origin,b._type=t._type,b._mode=t._mode,m=b}else if(o.Guard.isDocumentTypeNode(t))m=s.create_documentType(n,t._name,t._publicId,t._systemId);else if(o.Guard.isAttrNode(t)){var C=s.create_attr(n,t.localName);C._namespace=t._namespace,C._namespacePrefix=t._namespacePrefix,C._value=t._value,m=C}else m=o.Guard.isExclusiveTextNode(t)?s.create_text(n,t._data):o.Guard.isCDATASectionNode(t)?s.create_cdataSection(n,t._data):o.Guard.isCommentNode(t)?s.create_comment(n,t._data):o.Guard.isProcessingInstructionNode(t)?s.create_processingInstruction(n,t._target,t._data):o.Guard.isDocumentFragmentNode(t)?s.create_documentFragment(n):Object.create(t);if(o.Guard.isDocumentNode(m)?(m._nodeDocument=m,n=m):m._nodeDocument=n,i.dom.features.steps&&c.dom_runCloningSteps(m,t,n,a),a)try{for(var w=r(t._children),E=w.next();!E.done;E=w.next()){var T=e(E.value,n,!0);u.mutation_append(T,m)}}catch(e){h={error:e}}finally{try{E&&!E.done&&(f=w.return)&&f.call(w)}finally{if(h)throw h.error}}return m},t.node_equals=function e(t,n){var i,a,s,l;if(t._nodeType!==n._nodeType)return!1;if(o.Guard.isDocumentTypeNode(t)&&o.Guard.isDocumentTypeNode(n)){if(t._name!==n._name||t._publicId!==n._publicId||t._systemId!==n._systemId)return!1}else if(o.Guard.isElementNode(t)&&o.Guard.isElementNode(n)){if(t._namespace!==n._namespace||t._namespacePrefix!==n._namespacePrefix||t._localName!==n._localName||t._attributeList.length!==n._attributeList.length)return!1}else if(o.Guard.isAttrNode(t)&&o.Guard.isAttrNode(n)){if(t._namespace!==n._namespace||t._localName!==n._localName||t._value!==n._value)return!1}else if(o.Guard.isProcessingInstructionNode(t)&&o.Guard.isProcessingInstructionNode(n)){if(t._target!==n._target||t._data!==n._data)return!1}else if(o.Guard.isCharacterDataNode(t)&&o.Guard.isCharacterDataNode(n)&&t._data!==n._data)return!1;if(o.Guard.isElementNode(t)&&o.Guard.isElementNode(n)){var c={};try{for(var u=r(t._attributeList),d=u.next();!d.done;d=u.next())c[(f=d.value)._localName]=f}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}try{for(var p=r(n._attributeList),h=p.next();!h.done;h=p.next()){var f,m=h.value;if(!(f=c[m._localName]))return!1;if(!e(f,m))return!1}}catch(e){s={error:e}}finally{try{h&&!h.done&&(l=p.return)&&l.call(p)}finally{if(s)throw s.error}}}if(t._children.size!==n._children.size)return!1;for(var g=t._children[Symbol.iterator](),v=n._children[Symbol.iterator](),y=g.next(),b=v.next();!y.done&&!b.done;){if(!e(y.value,b.value))return!1;y=g.next(),b=v.next()}return!0},t.node_listOfElementsWithQualifiedName=function(e,t){return"*"===e?s.create_htmlCollection(t):"html"===t._nodeDocument._type?s.create_htmlCollection(t,function(t){return t._namespace===a.namespace.HTML&&t._qualifiedName===e.toLowerCase()||t._namespace!==a.namespace.HTML&&t._qualifiedName===e}):s.create_htmlCollection(t,function(t){return t._qualifiedName===e})},t.node_listOfElementsWithNamespace=function(e,t,n){return""===e&&(e=null),"*"===e&&"*"===t?s.create_htmlCollection(n):"*"===e?s.create_htmlCollection(n,function(e){return e._localName===t}):"*"===t?s.create_htmlCollection(n,function(t){return t._namespace===e}):s.create_htmlCollection(n,function(n){return n._localName===t&&n._namespace===e})},t.node_listOfElementsWithClassNames=function(e,t){var n=l.orderedSet_parse(e);if(0===n.size)return s.create_htmlCollection(t,function(){return!1});var r="quirks"!==t._nodeDocument._mode;return s.create_htmlCollection(t,function(e){var t=e.classList;return l.orderedSet_contains(t._tokenSet,n,r)})},t.node_locateANamespacePrefix=function e(t,n){if(t._namespace===n&&null!==t._namespacePrefix)return t._namespacePrefix;for(var r=0;r<t._attributeList.length;r++){var i=t._attributeList[r];if("xmlns"===i._namespacePrefix&&i._value===n)return i._localName}return t._parent&&o.Guard.isElementNode(t._parent)?e(t._parent,n):null},t.node_locateANamespace=function e(t,n){if(o.Guard.isElementNode(t)){if(null!==t._namespace&&t._namespacePrefix===n)return t._namespace;for(var r=0;r<t._attributeList.length;r++){var i=t._attributeList[r];if(i._namespace===a.namespace.XMLNS&&"xmlns"===i._namespacePrefix&&i._localName===n)return i._value||null;if(null===n&&i._namespace===a.namespace.XMLNS&&null===i._namespacePrefix&&"xmlns"===i._localName)return i._value||null}return null===t.parentElement?null:e(t.parentElement,n)}return o.Guard.isDocumentNode(t)?null===t.documentElement?null:e(t.documentElement,n):o.Guard.isDocumentTypeNode(t)||o.Guard.isDocumentFragmentNode(t)?null:o.Guard.isAttrNode(t)?null===t._element?null:e(t._element,n):t._parent&&o.Guard.isElementNode(t._parent)?e(t._parent,n):null}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(3),a=n(9),s=n(29),l=n(17),c=n(107),u=n(37);t.text_contiguousTextNodes=function(e,t){var n;return void 0===t&&(t=!1),(n={})[Symbol.iterator]=function(){for(var n=e;n&&o.Guard.isTextNode(n._previousSibling);)n=n._previousSibling;return{next:function(){if(n&&!t&&n===e&&(n=o.Guard.isTextNode(n._nextSibling)?n._nextSibling:null),null===n)return{done:!0,value:null};var r={done:!1,value:n};return n=o.Guard.isTextNode(n._nextSibling)?n._nextSibling:null,r}}},n},t.text_contiguousExclusiveTextNodes=function(e,t){var n;return void 0===t&&(t=!1),(n={})[Symbol.iterator]=function(){for(var n=e;n&&o.Guard.isExclusiveTextNode(n._previousSibling);)n=n._previousSibling;return{next:function(){if(n&&!t&&n===e&&(n=o.Guard.isExclusiveTextNode(n._nextSibling)?n._nextSibling:null),null===n)return{done:!0,value:null};var r={done:!1,value:n};return n=o.Guard.isExclusiveTextNode(n._nextSibling)?n._nextSibling:null,r}}},n},t.text_descendantTextContent=function(e){for(var t="",n=l.tree_getFirstDescendantNode(e,!1,!1,function(e){return o.Guard.isTextNode(e)});null!==n;)t+=n._data,n=l.tree_getNextDescendantNode(e,n,!1,!1,function(e){return o.Guard.isTextNode(e)});return t},t.text_split=function(e,t){var n,o,d=e._data.length;if(t>d)throw new a.IndexSizeError;var p=d-t,h=c.characterData_substringData(e,t,p),f=s.create_text(e._nodeDocument,h),m=e._parent;if(null!==m){u.mutation_insert(f,m,e._nextSibling);try{for(var g=r(i.dom.rangeList),v=g.next();!v.done;v=g.next()){var y=v.value;y._start[0]===e&&y._start[1]>t&&(y._start[0]=f,y._start[1]-=t),y._end[0]===e&&y._end[1]>t&&(y._end[0]=f,y._end[1]-=t);var b=l.tree_index(e);y._start[0]===m&&y._start[1]===b+1&&y._start[1]++,y._end[0]===m&&y._end[1]===b+1&&y._end[1]++}}catch(e){n={error:e}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(n)throw n.error}}}return c.characterData_replaceData(e,t,p,""),f}},function(e,t,n){"use strict";var r=n(4),i=n(41),o=n(24),a=n(48),s=[].join,l=i!=Object,c=a("join",",");r({target:"Array",proto:!0,forced:l||!c},{join:function(e){return s.call(o(this),void 0===e?",":e)}})},function(e,t,n){var r=n(4),i=n(83),o=String.fromCharCode,a=String.fromCodePoint;r({target:"String",stat:!0,forced:!!a&&1!=a.length},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,a=0;r>a;){if(t=+arguments[a++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?o(t):o(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(111),o=function(){function e(e,t){this._options={skipWhitespaceOnlyText:!1},this.err={line:-1,col:-1,index:-1,str:""},this._str=e,this._index=0,this._length=e.length,t&&(this._options.skipWhitespaceOnlyText=t.skipWhitespaceOnlyText||!1)}return e.prototype.nextToken=function(){if(this.eof())return{type:i.TokenType.EOF};var t=this.skipIfStartsWith("<")?this.openBracket():this.text();return this._options.skipWhitespaceOnlyText&&t.type===i.TokenType.Text&&e.isWhiteSpaceToken(t)&&(t=this.nextToken()),t},e.prototype.openBracket=function(){return this.skipIfStartsWith("?")?this.skipIfStartsWith("xml")?e.isSpace(this._str[this._index])?this.declaration():(this.seek(-3),this.pi()):this.pi():this.skipIfStartsWith("!")?this.skipIfStartsWith("--")?this.comment():this.skipIfStartsWith("[CDATA[")?this.cdata():this.skipIfStartsWith("DOCTYPE")?this.doctype():void this.throwError("Invalid '!' in opening tag."):this.skipIfStartsWith("/")?this.closeTag():this.openTag()},e.prototype.declaration=function(){for(var e="",t="",n="";!this.eof();){if(this.skipSpace(),this.skipIfStartsWith("?>"))return{type:i.TokenType.Declaration,version:e,encoding:t,standalone:n};var o=r(this.attribute(),2),a=o[0],s=o[1];"version"===a?e=s:"encoding"===a?t=s:"standalone"===a?n=s:this.throwError("Invalid attribute name: "+a)}this.throwError("Missing declaration end symbol `?>`")},e.prototype.doctype=function(){var e="",t="";this.skipSpace();var n=this.takeUntil2("[",">",!0);return this.skipSpace(),this.skipIfStartsWith("PUBLIC")?(e=this.quotedString(),t=this.quotedString()):this.skipIfStartsWith("SYSTEM")&&(t=this.quotedString()),this.skipSpace(),this.skipIfStartsWith("[")&&(this.skipUntil("]"),this.skipIfStartsWith("]")||this.throwError("Missing end bracket of DTD internal subset")),this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing doctype end symbol `>`"),{type:i.TokenType.DocType,name:n,pubId:e,sysId:t}},e.prototype.pi=function(){var e=this.takeUntilStartsWith("?>",!0);if(this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.skipSpace(),this.skipIfStartsWith("?>"))return{type:i.TokenType.PI,target:e,data:""};var t=this.takeUntilStartsWith("?>");return this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.seek(2),{type:i.TokenType.PI,target:e,data:t}},e.prototype.text=function(){var e=this.takeUntil("<");return{type:i.TokenType.Text,data:e}},e.prototype.comment=function(){var e=this.takeUntilStartsWith("--\x3e");return this.eof()&&this.throwError("Missing comment end symbol `--\x3e`"),this.seek(3),{type:i.TokenType.Comment,data:e}},e.prototype.cdata=function(){var e=this.takeUntilStartsWith("]]>");return this.eof()&&this.throwError("Missing CDATA end symbol `]>`"),this.seek(3),{type:i.TokenType.CDATA,data:e}},e.prototype.openTag=function(){this.skipSpace();var e=this.takeUntil2(">","/",!0);if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:i.TokenType.Element,name:e,attributes:[],selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:i.TokenType.Element,name:e,attributes:[],selfClosing:!0};for(var t=[];!this.eof();){if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:i.TokenType.Element,name:e,attributes:t,selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:i.TokenType.Element,name:e,attributes:t,selfClosing:!0};var n=this.attribute();t.push(n)}this.throwError("Missing opening element tag end symbol `>`")},e.prototype.closeTag=function(){this.skipSpace();var e=this.takeUntil(">",!0);return this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing closing element tag end symbol `>`"),{type:i.TokenType.ClosingTag,name:e}},e.prototype.attribute=function(){this.skipSpace();var e=this.takeUntil("=",!0);return this.skipSpace(),this.skipIfStartsWith("=")||this.throwError("Missing equals sign before attribute value"),[e,this.quotedString()]},e.prototype.quotedString=function(){this.skipSpace();var t=this.take(1);e.isQuote(t)||this.throwError("Missing start quote character before quoted value");var n=this.takeUntil(t);return this.skipIfStartsWith(t)||this.throwError("Missing end quote character after quoted value"),n},e.prototype.eof=function(){return this._index>=this._length},e.prototype.skipIfStartsWith=function(e){var t=e.length;if(1===t)return this._str[this._index]===e&&(this._index++,!0);for(var n=0;n<t;n++)if(this._str[this._index+n]!==e[n])return!1;return this._index+=t,!0},e.prototype.seek=function(e){this._index+=e,this._index<0&&(this._index=0),this._index>this._length&&(this._index=this._length)},e.prototype.skipSpace=function(){for(;!this.eof()&&e.isSpace(this._str[this._index]);)this._index++},e.prototype.take=function(e){if(1===e)return this._str[this._index++];var t=this._index;return this.seek(e),this._str.slice(t,this._index)},e.prototype.takeUntil=function(t,n){void 0===n&&(n=!1);for(var r=this._index;this._index<this._length;){var i=this._str[this._index];if(i===t||n&&e.isSpace(i))break;this._index++}return this._str.slice(r,this._index)},e.prototype.takeUntil2=function(t,n,r){void 0===r&&(r=!1);for(var i=this._index;this._index<this._length;){var o=this._str[this._index];if(o===t||o===n||r&&e.isSpace(o))break;this._index++}return this._str.slice(i,this._index)},e.prototype.takeUntilStartsWith=function(t,n){void 0===n&&(n=!1);for(var r=this._index,i=t.length;this._index<this._length;){for(var o=!0,a=0;a<i;a++){var s=this._str[this._index+a],l=t[a];if(n&&e.isSpace(s))return this._str.slice(r,this._index);if(s!==l){this._index++,o=!1;break}}if(o)return this._str.slice(r,this._index)}return this._index=this._length,this._str.slice(r)},e.prototype.skipUntil=function(e){for(;this._index<this._length&&this._str[this._index]!==e;)this._index++},e.isWhiteSpaceToken=function(e){for(var t=e.data,n=0;n<t.length;n++){var r=t[n];if(" "!==r&&"\n"!==r&&"\r"!==r&&"\t"!==r&&"\f"!==r)return!1}return!0},e.isSpace=function(e){return" "===e||"\n"===e||"\r"===e||"\t"===e},e.isQuote=function(e){return'"'===e||"'"===e},e.prototype.throwError=function(e){for(var t=/\r\n|\r|\n/g,n=null,r=0,i=0,o=this._str.length;null!==(n=t.exec(this._str))&&null!==n;)if(r++,n.index<this._index&&(i=t.lastIndex),n.index>this._index){o=n.index;break}throw this.err={line:r,col:this._index-i,index:this._index,str:this._str.substring(i,o)},new Error(e+"\nIndex: "+this.err.index+"\nLn: "+this.err.line+", Col: "+this.err.col+"\nInput: "+this.err.str)},e.prototype[Symbol.iterator]=function(){return this._index=0,{next:function(){var e=this.nextToken();return e.type===i.TokenType.EOF?{done:!0,value:null}:{done:!1,value:e}}.bind(this)}},e}();t.XMLStringLexer=o},function(e,t,n){"use strict";var r=n(39);e.exports=new r({include:[n(182)]})},function(e,t,n){"use strict";var r=n(39);e.exports=new r({include:[n(113)],implicit:[n(289),n(290),n(291),n(292)]})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(91),i=n(1),o=n(3),a=n(77),s=n(109);function l(e,t){var n=u(void 0===e||c(e)?e:r.DefaultBuilderOptions),i=c(e)?t:e,o=s.createDocument();d(o,n);var l=new a.XMLBuilderImpl(o);return void 0!==i&&l.ele(i),l}function c(e){if(!i.isPlainObject(e))return!1;for(var t in e)if(e.hasOwnProperty(t)&&!r.XMLBuilderOptionKeys.has(t))return!1;return!0}function u(e){void 0===e&&(e={});var t=i.applyDefaults(e,r.DefaultBuilderOptions);if(0===t.convert.att.length||0===t.convert.ins.length||0===t.convert.text.length||0===t.convert.cdata.length||0===t.convert.comment.length)throw new Error("JS object converter strings cannot be zero length.");return t}function d(e,t,n){var r=e;r._xmlBuilderOptions=t,r._isFragment=n}t.builder=function(e,t){var n=u(c(e)?e:r.DefaultBuilderOptions),s=o.Guard.isNode(e)||i.isArray(e)?e:t;if(void 0===s)throw new Error("Invalid arguments.");if(i.isArray(s)){for(var l=[],d=0;d<s.length;d++){var p=new a.XMLBuilderImpl(s[d]);p.set(n),l.push(p)}return l}var h=new a.XMLBuilderImpl(s);return h.set(n),h},t.create=l,t.fragment=function(e,t){var n=u(void 0===e||c(e)?e:r.DefaultBuilderOptions),i=c(e)?t:e,o=s.createDocument();d(o,n,!0);var l=new a.XMLBuilderImpl(o.createDocumentFragment());return void 0!==i&&l.ele(i),l},t.convert=function(e,t,n){var i,o,a;return c(e)&&void 0!==t?(i=e,o=t,a=n):(i=r.DefaultBuilderOptions,o=e,a=t||void 0),l(i,o).end(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77);t.builder=r.builder,t.create=r.create,t.fragment=r.fragment,t.convert=r.convert,t.createCB=r.createCB,t.fragmentCB=r.fragmentCB},function(e,t,n){"use strict";n(31),n(32),n(33),n(191),n(192),n(194),n(64),n(19),n(198),n(199),n(89),n(201),n(65),n(20),n(66),n(22),n(23);var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(91),a=n(1),s=n(217),l=n(2),c=n(3),u=n(0),d=n(109),p=n(7),h=n(276),f=function(){function e(e){this._domNode=e}return Object.defineProperty(e.prototype,"node",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),e.prototype.set=function(e){return this._options=a.applyDefaults(a.applyDefaults(this._options,e,!0),o.DefaultBuilderOptions),this},e.prototype.ele=function(t,n,i){var o,s,l,c,p,f;if(a.isObject(t))return new h.ObjectReader(this._options).parse(this,t);if(null!==t&&/^\s*</.test(t))return new h.XMLReader(this._options).parse(this,t);if(null!==t&&/^\s*[\{\[]/.test(t))return new h.JSONReader(this._options).parse(this,t);if(null!==t&&/^(\s*|(#.*)|(%.*))*---/.test(t))return new h.YAMLReader(this._options).parse(this,t);if((null===t||a.isString(t))&&a.isString(n))c=(o=r([t,n,i],3))[0],p=o[1],f=o[2];else{if(null===t)throw new Error("Element name cannot be null. "+this._debugInfo());c=(s=r([void 0,t,a.isObject(n)?n:void 0],3))[0],p=s[1],f=s[2]}if(f&&(f=a.getValue(f)),c=(l=r(this._extractNamespace(d.sanitizeInput(c,this._options.invalidCharReplacement),d.sanitizeInput(p,this._options.invalidCharReplacement),!0),2))[0],p=l[1],void 0===c){var m=r(u.namespace_extractQName(p),1)[0];c=this.node.lookupNamespaceURI(m)}var g=null!=c?this._doc.createElementNS(c,p):this._doc.createElement(p);this.node.appendChild(g);var v=new e(g),y=this._doc.doctype;if(g===this._doc.documentElement&&null!==y){var b=this._doc.implementation.createDocumentType(this._doc.documentElement.tagName,y.publicId,y.systemId);this._doc.replaceChild(b,y)}return f&&!a.isEmpty(f)&&v.att(f),v},e.prototype.remove=function(){var e=this.up();return e.node.removeChild(this.node),e},e.prototype.att=function(e,t,n){var i,o,s,l,h,f,m=this;if(a.isMap(e)||a.isObject(e))return a.forEachObject(e,function(e,t){return m.att(e,t)},this),this;if(null!=e&&(e=a.getValue(e+"")),null!=t&&(t=a.getValue(t+"")),null!=n&&(n=a.getValue(n+"")),null!==e&&!a.isString(e)||!a.isString(t)||null!==n&&!a.isString(n)){if(!a.isString(e)||null!=t&&!a.isString(t))throw new Error("Attribute name and value not specified. "+this._debugInfo());l=(o=r([void 0,e,t],3))[0],h=o[1],f=o[2]}else l=(i=r([e,t,n],3))[0],h=i[1],f=i[2];if(this._options.keepNullAttributes&&null==f)f="";else if(null==f)return this;if(!c.Guard.isElementNode(this.node))throw new Error("An attribute can only be assigned to an element node.");var g=this.node;l=(s=r(this._extractNamespace(l,h,!1),2))[0],h=s[1],h=d.sanitizeInput(h,this._options.invalidCharReplacement),l=d.sanitizeInput(l,this._options.invalidCharReplacement),f=d.sanitizeInput(f,this._options.invalidCharReplacement);var v=r(u.namespace_extractQName(h),2),y=v[0],b=v[1],C=r(u.namespace_extractQName(g.prefix?g.prefix+":"+g.localName:g.localName),1)[0],w=null;return"xmlns"===y?(l=p.namespace.XMLNS,null===g.namespaceURI&&C===b&&(w=f)):null===y&&"xmlns"===b&&null===C&&(l=p.namespace.XMLNS,w=f),null!==w&&(this._updateNamespace(w),g=this.node),void 0!==l?g.setAttributeNS(l,h,f):g.setAttribute(h,f),this},e.prototype.removeAtt=function(e,t){var n,r,i=this;if(!c.Guard.isElementNode(this.node))throw new Error("An attribute can only be removed from an element node.");if(e=a.getValue(e),void 0!==t&&(t=a.getValue(t)),null!==e&&void 0===t)r=e;else{if(null!==e&&!a.isString(e)||void 0===t)throw new Error("Attribute namespace must be a string. "+this._debugInfo());n=e,r=t}return a.isArray(r)||a.isSet(r)?a.forEachArray(r,function(e){return void 0===n?i.removeAtt(e):i.removeAtt(n,e)},this):void 0!==n?(r=d.sanitizeInput(r,this._options.invalidCharReplacement),n=d.sanitizeInput(n,this._options.invalidCharReplacement),this.node.removeAttributeNS(n,r)):(r=d.sanitizeInput(r,this._options.invalidCharReplacement),this.node.removeAttribute(r)),this},e.prototype.txt=function(e){if(null==e){if(!this._options.keepNullNodes)return this;e=""}var t=this._doc.createTextNode(d.sanitizeInput(e,this._options.invalidCharReplacement));return this.node.appendChild(t),this},e.prototype.com=function(e){if(null==e){if(!this._options.keepNullNodes)return this;e=""}var t=this._doc.createComment(d.sanitizeInput(e,this._options.invalidCharReplacement));return this.node.appendChild(t),this},e.prototype.dat=function(e){if(null==e){if(!this._options.keepNullNodes)return this;e=""}var t=this._doc.createCDATASection(d.sanitizeInput(e,this._options.invalidCharReplacement));return this.node.appendChild(t),this},e.prototype.ins=function(e,t){var n=this;if(void 0===t&&(t=""),null==t){if(!this._options.keepNullNodes)return this;t=""}if(a.isArray(e)||a.isSet(e))a.forEachArray(e,function(e){var t=(e+="").indexOf(" "),r=-1===t?e:e.substr(0,t),i=-1===t?"":e.substr(t+1);n.ins(r,i)},this);else if(a.isMap(e)||a.isObject(e))a.forEachObject(e,function(e,t){return n.ins(e,t)},this);else{var r=this._doc.createProcessingInstruction(d.sanitizeInput(e,this._options.invalidCharReplacement),d.sanitizeInput(t,this._options.invalidCharReplacement));this.node.appendChild(r)}return this},e.prototype.dec=function(e){return this._options.version=e.version||"1.0",this._options.encoding=e.encoding,this._options.standalone=e.standalone,this},e.prototype.dtd=function(e){var t=d.sanitizeInput(e&&e.name||(this._doc.documentElement?this._doc.documentElement.tagName:"ROOT"),this._options.invalidCharReplacement),n=d.sanitizeInput(e&&e.pubID||"",this._options.invalidCharReplacement),r=d.sanitizeInput(e&&e.sysID||"",this._options.invalidCharReplacement);if(null!==this._doc.documentElement&&t!==this._doc.documentElement.tagName)throw new Error("DocType name does not match document element name.");var i=this._doc.implementation.createDocumentType(t,n,r);return null!==this._doc.doctype?this._doc.replaceChild(i,this._doc.doctype):this._doc.insertBefore(i,this._doc.documentElement),this},e.prototype.import=function(t){var n,o,a=this._domNode,s=this._doc,l=t.node;if(c.Guard.isDocumentNode(l)){var d=l.documentElement;if(null===d)throw new Error("Imported document has no document element node. "+this._debugInfo());var p=s.importNode(d,!0);a.appendChild(p);var h=r(u.namespace_extractQName(p.prefix?p.prefix+":"+p.localName:p.localName),1)[0],f=a.lookupNamespaceURI(h);new e(p)._updateNamespace(f)}else if(c.Guard.isDocumentFragmentNode(l))try{for(var m=i(l.childNodes),g=m.next();!g.done;g=m.next()){var v=g.value;p=s.importNode(v,!0),a.appendChild(p),c.Guard.isElementNode(p)&&(h=r(u.namespace_extractQName(p.prefix?p.prefix+":"+p.localName:p.localName),1)[0],f=a.lookupNamespaceURI(h),new e(p)._updateNamespace(f))}}catch(e){n={error:e}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(n)throw n.error}}else p=s.importNode(l,!0),a.appendChild(p),c.Guard.isElementNode(p)&&(h=r(u.namespace_extractQName(p.prefix?p.prefix+":"+p.localName:p.localName),1)[0],f=a.lookupNamespaceURI(h),new e(p)._updateNamespace(f));return this},e.prototype.doc=function(){if(this._doc._isFragment){for(var t=this.node;t&&t.nodeType!==l.NodeType.DocumentFragment;)t=t.parentNode;if(null===t)throw new Error("Node has no parent node while searching for document fragment ancestor. "+this._debugInfo());return new e(t)}return new e(this._doc)},e.prototype.root=function(){var t=this._doc.documentElement;if(!t)throw new Error("Document root element is null. "+this._debugInfo());return new e(t)},e.prototype.up=function(){var t=this._domNode.parentNode;if(!t)throw new Error("Parent node is null. "+this._debugInfo());return new e(t)},e.prototype.prev=function(){var t=this._domNode.previousSibling;if(!t)throw new Error("Previous sibling node is null. "+this._debugInfo());return new e(t)},e.prototype.next=function(){var t=this._domNode.nextSibling;if(!t)throw new Error("Next sibling node is null. "+this._debugInfo());return new e(t)},e.prototype.first=function(){var t=this._domNode.firstChild;if(!t)throw new Error("First child node is null. "+this._debugInfo());return new e(t)},e.prototype.last=function(){var t=this._domNode.lastChild;if(!t)throw new Error("Last child node is null. "+this._debugInfo());return new e(t)},e.prototype.each=function(t,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,r);o[0];){var a=this._getNextDescendantNode(this._domNode,o[0],r,o[1],o[2]);t.call(i,new e(o[0]),o[1],o[2]),o=a}return this},e.prototype.map=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=[];return this.each(function(t,n,o){return i.push(e.call(r,t,n,o))},t,n),i},e.prototype.reduce=function(e,t,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=!1);var o=t;return this.each(function(t,n,r){return o=e.call(i,o,t,n,r)},n,r),o},e.prototype.find=function(t,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,r);o[0];){var a=new e(o[0]);if(t.call(i,a,o[1],o[2]))return a;o=this._getNextDescendantNode(this._domNode,o[0],r,o[1],o[2])}},e.prototype.filter=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=[];return this.each(function(t,n,o){e.call(r,t,n,o)&&i.push(t)},t,n),i},e.prototype.every=function(t,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,r);o[0];){var a=new e(o[0]);if(!t.call(i,a,o[1],o[2]))return!1;o=this._getNextDescendantNode(this._domNode,o[0],r,o[1],o[2])}return!0},e.prototype.some=function(t,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=!1);for(var o=this._getFirstDescendantNode(this._domNode,n,r);o[0];){var a=new e(o[0]);if(t.call(i,a,o[1],o[2]))return!0;o=this._getNextDescendantNode(this._domNode,o[0],r,o[1],o[2])}return!1},e.prototype.toArray=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=[];return this.each(function(e){return n.push(e)},e,t),n},e.prototype.toString=function(e){return void 0===(e=e||{}).format&&(e.format="xml"),this._serialize(e)},e.prototype.toObject=function(e){return void 0===(e=e||{}).format&&(e.format="object"),this._serialize(e)},e.prototype.end=function(e){return void 0===(e=e||{}).format&&(e.format="xml"),this.doc()._serialize(e)},e.prototype._getFirstDescendantNode=function(e,t,n){return t?[this._domNode,0,0]:n?this._getNextDescendantNode(e,e,n,0,0):[this._domNode.firstChild,0,1]},e.prototype._getNextDescendantNode=function(e,t,n,r,i){if(!n)return e===t?[t.firstChild,0,i+1]:[t.nextSibling,r+1,i];if(t.firstChild)return[t.firstChild,0,i+1];if(t===e)return[null,-1,-1];if(t.nextSibling)return[t.nextSibling,r+1,i];for(var o=t.parentNode;o&&o!==e;){if(o.nextSibling)return[o.nextSibling,u.tree_index(o.nextSibling),i-1];o=o.parentNode,i--}return[null,-1,-1]},e.prototype._serialize=function(e){if("xml"===e.format)return new s.XMLWriter(this._options,e).serialize(this.node);if("map"===e.format)return new s.MapWriter(this._options,e).serialize(this.node);if("object"===e.format)return new s.ObjectWriter(this._options,e).serialize(this.node);if("json"===e.format)return new s.JSONWriter(this._options,e).serialize(this.node);if("yaml"===e.format)return new s.YAMLWriter(this._options,e).serialize(this.node);throw new Error("Invalid writer format: "+e.format+". "+this._debugInfo())},e.prototype._extractNamespace=function(e,t,n){var r=t.indexOf("@");if(r>0&&(void 0===e&&(e=t.slice(r+1)),t=t.slice(0,r)),void 0===e)e=n?this._options.defaultNamespace.ele:this._options.defaultNamespace.att;else if(null!==e&&"@"===e[0]){var i=e.slice(1);if(void 0===(e=this._options.namespaceAlias[i]))throw new Error("Namespace alias `"+i+"` is not defined. "+this._debugInfo())}return[e,t]},e.prototype._updateNamespace=function(t){var n,o,a,s,l=this._domNode;if(c.Guard.isElementNode(l)&&null!==t&&l.namespaceURI!==t){var d=r(u.namespace_extractQName(l.prefix?l.prefix+":"+l.localName:l.localName),2),p=d[0],h=d[1],f=u.create_element(this._doc,h,t,p);try{for(var m=i(l.attributes),g=m.next();!g.done;g=m.next()){var v=g.value,y=v.prefix?v.prefix+":"+v.localName:v.localName,b=r(u.namespace_extractQName(y),1)[0],C=v.namespaceURI;null===C&&null!==b&&(C=l.lookupNamespaceURI(b)),null===C?f.setAttribute(y,v.value):f.setAttributeNS(C,y,v.value)}}catch(e){n={error:e}}finally{try{g&&!g.done&&(o=m.return)&&o.call(m)}finally{if(n)throw n.error}}var w=l.parentNode;if(null===w)throw new Error("Parent node is null."+this._debugInfo());w.replaceChild(f,l),this._domNode=f;try{for(var E=i(l.childNodes),T=E.next();!T.done;T=E.next()){var x=T.value.cloneNode(!0);if(f.appendChild(x),c.Guard.isElementNode(x)){var _=r(u.namespace_extractQName(x.prefix?x.prefix+":"+x.localName:x.localName),1)[0],S=f.lookupNamespaceURI(_);new e(x)._updateNamespace(S)}}}catch(e){a={error:e}}finally{try{T&&!T.done&&(s=E.return)&&s.call(E)}finally{if(a)throw a.error}}}},Object.defineProperty(e.prototype,"_doc",{get:function(){var e=this.node;if(c.Guard.isDocumentNode(e))return e;var t=e.ownerDocument;if(!t)throw new Error("Owner document is null. "+this._debugInfo());return t},enumerable:!0,configurable:!0}),e.prototype._debugInfo=function(e){var t=this.node,n=t.parentNode;e=e||t.nodeName;var r=n?n.nodeName:"";return r?"node: <"+e+">, parent: <"+r+">":"node: <"+e+">"},Object.defineProperty(e.prototype,"_options",{get:function(){var e=this._doc;if(void 0===e._xmlBuilderOptions)throw new Error("Builder options is not set.");return e._xmlBuilderOptions},set:function(e){this._doc._xmlBuilderOptions=e},enumerable:!0,configurable:!0}),e}();t.XMLBuilderImpl=f},function(e,t,n){var r=n(11),i=n(117),o=r.WeakMap;e.exports="function"==typeof o&&/native code/.test(i(o))},function(e,t,n){var r=n(46),i=n(82),o=n(85),a=n(18);e.exports=r("Reflect","ownKeys")||function(e){var t=i.f(a(e)),n=o.f;return n?t.concat(n(e)):t}},function(e,t,n){var r=n(16),i=n(15),o=n(18),a=n(61);e.exports=r?Object.defineProperties:function(e,t){o(e);for(var n,r=a(t),s=r.length,l=0;s>l;)i.f(e,n=r[l++],t[n]);return e}},function(e,t,n){var r=n(46);e.exports=r("document","documentElement")},function(e,t,n){var r=n(24),i=n(82).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},function(e,t,n){"use strict";var r=n(4),i=n(36).every,o=n(48),a=n(28),s=o("every"),l=a("every");r({target:"Array",proto:!0,forced:!s||!l},{every:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(4),i=n(36).filter,o=n(63),a=n(28),s=o("filter"),l=a("filter");r({target:"Array",proto:!0,forced:!s||!l},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(46);e.exports=r("navigator","userAgent")||""},function(e,t,n){"use strict";var r=n(4),i=n(36).find,o=n(130),a=n(28),s=!0,l=a("find");"find"in[]&&Array(1).find(function(){s=!1}),r({target:"Array",proto:!0,forced:s||!l},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("find")},function(e,t,n){"use strict";var r=n(131).IteratorPrototype,i=n(60),o=n(40),a=n(62),s=n(49),l=function(){return this};e.exports=function(e,t,n){var c=t+" Iterator";return e.prototype=i(r,{next:o(1,n)}),a(e,c,!1,!0),s[c]=l,e}},function(e,t,n){var r=n(8);e.exports=!r(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},function(e,t,n){var r=n(13);e.exports=function(e){if(!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){"use strict";var r=n(4),i=n(36).map,o=n(63),a=n(28),s=o("map"),l=a("map");r({target:"Array",proto:!0,forced:!s||!l},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(4),i=n(200).left,o=n(48),a=n(28),s=o("reduce"),l=a("reduce",{1:0});r({target:"Array",proto:!0,forced:!s||!l},{reduce:function(e){return i(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(127),i=n(27),o=n(41),a=n(26),s=function(e){return function(t,n,s,l){r(n);var c=i(t),u=o(c),d=a(c.length),p=e?d-1:0,h=e?-1:1;if(s<2)for(;;){if(p in u){l=u[p],p+=h;break}if(p+=h,e?p<0:d<=p)throw TypeError("Reduce of empty array with no initial value")}for(;e?p>=0:d>p;p+=h)p in u&&(l=n(l,u[p],p,c));return l}};e.exports={left:s(!1),right:s(!0)}},function(e,t,n){"use strict";var r=n(4),i=n(36).some,o=n(48),a=n(28),s=o("some"),l=a("some");r({target:"Array",proto:!0,forced:!s||!l},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(90),i=n(135);e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){var r=n(8);e.exports=!r(function(){return Object.isExtensible(Object.preventExtensions({}))})},function(e,t,n){var r=n(5),i=n(49),o=r("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[o]===e)}},function(e,t,n){var r=n(135),i=n(49),o=n(5)("iterator");e.exports=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[r(e)]}},function(e,t,n){var r=n(18);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t,n){var r=n(5)("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[r]=function(){return this},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o={};o[r]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch(e){}return n}},function(e,t,n){var r=n(13),i=n(133);e.exports=function(e,t,n){var o,a;return i&&"function"==typeof(o=t.constructor)&&o!==n&&r(a=o.prototype)&&a!==n.prototype&&i(e,a),e}},function(e,t,n){var r=n(25);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t,n){"use strict";var r=n(46),i=n(15),o=n(5),a=n(16),s=o("species");e.exports=function(e){var t=r(e),n=i.f;a&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){void 0===e&&(e=1e3),this._items=new Set,this._limit=e}return e.prototype.add=function(e){if(this._items.add(e),this._items.size>this._limit){var t=this._items.values().next();t.done||this._items.delete(t.value)}return this},e.prototype.delete=function(e){return this._items.delete(e)},e.prototype.has=function(e){return this._items.has(e)},e.prototype.clear=function(){this._items.clear()},Object.defineProperty(e.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e,t){var n=this;this._items.forEach(function(r){return e.call(t,r,r,n)})},e.prototype.keys=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items.keys())];case 1:return e.sent(),[2]}})},e.prototype.values=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items.values())];case 1:return e.sent(),[2]}})},e.prototype.entries=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items.entries())];case 1:return e.sent(),[2]}})},e.prototype[Symbol.iterator]=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items)];case 1:return e.sent(),[2]}})},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"FixedSizeSet"},enumerable:!0,configurable:!0}),e}();t.FixedSizeSet=o},function(e,t,n){"use strict";var r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){void 0===e&&(e=1e3),this._items=new Map,this._limit=e}return e.prototype.get=function(e){return this._items.get(e)},e.prototype.set=function(e,t){if(this._items.set(e,t),this._items.size>this._limit){var n=this._items.keys().next();n.done||this._items.delete(n.value)}},e.prototype.delete=function(e){return this._items.delete(e)},e.prototype.has=function(e){return this._items.has(e)},e.prototype.clear=function(){this._items.clear()},Object.defineProperty(e.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e,t){this._items.forEach(function(n,r){return e.call(t,r,n)})},e.prototype.keys=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items.keys())];case 1:return e.sent(),[2]}})},e.prototype.values=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items.values())];case 1:return e.sent(),[2]}})},e.prototype.entries=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items.entries())];case 1:return e.sent(),[2]}})},e.prototype[Symbol.iterator]=function(){return r(this,function(e){switch(e.label){case 0:return[5,i(this._items)];case 1:return e.sent(),[2]}})},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"ObjectCache"},enumerable:!0,configurable:!0}),e}();t.ObjectCache=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=1e3),this._items=new Map,this._limit=e}return e.prototype.check=function(e,t){if(this._items.get(e)===t)return!0;if(this._items.get(t)===e)return!1;var n=Math.random()<.5;if(n?this._items.set(e,t):this._items.set(t,e),this._items.size>this._limit){var r=this._items.keys().next();r.done||this._items.delete(r.value)}return n},e}();t.CompareCache=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._initialized=!1,this._value=void 0,this._initFunc=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._initialized||(this._value=this._initFunc(),this._initialized=!0),this._value},enumerable:!0,configurable:!0}),e}();t.Lazy=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._pointer=0,this._chars=Array.from(e),this._length=this._chars.length}return Object.defineProperty(e.prototype,"eof",{get:function(){return this._pointer>=this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.codePoint=function(){if(void 0===this._codePoint)if(this.eof)this._codePoint=-1;else{var e=this._chars[this._pointer].codePointAt(0);this._codePoint=void 0!==e?e:-1}return this._codePoint},e.prototype.c=function(){return void 0===this._c&&(this._c=this.eof?"":this._chars[this._pointer]),this._c},e.prototype.remaining=function(){return void 0===this._remaining&&(this._remaining=this.eof?"":this._chars.slice(this._pointer+1).join("")),this._remaining},e.prototype.substring=function(){return void 0===this._substring&&(this._substring=this.eof?"":this._chars.slice(this._pointer).join("")),this._substring},Object.defineProperty(e.prototype,"pointer",{get:function(){return this._pointer},set:function(e){e!==this._pointer&&(this._pointer=e,this._codePoint=void 0,this._c=void 0,this._remaining=void 0,this._substring=void 0)},enumerable:!0,configurable:!0}),e}();t.StringWalker=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(218);t.MapWriter=r.MapWriter;var i=n(258);t.XMLWriter=i.XMLWriter;var o=n(67);t.ObjectWriter=o.ObjectWriter;var a=n(260);t.JSONWriter=a.JSONWriter;var s=n(261);t.YAMLWriter=s.YAMLWriter},function(e,t,n){"use strict";n(19),n(219),n(20),n(22),n(23);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(67),s=function(e){function t(t,n){var r=e.call(this,t)||this;return r._writerOptions=o.applyDefaults(n,{format:"map",wellFormed:!1,group:!1,verbose:!1}),r}return i(t,e),t.prototype.serialize=function(e){var t=o.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1,verbose:!1}),n=new a.ObjectWriter(this._builderOptions,t).serialize(e);return this._convertObject(n)},t.prototype._convertObject=function(e){if(o.isArray(e)){for(var t=0;t<e.length;t++)e[t]=this._convertObject(e[t]);return e}if(o.isObject(e)){var n=new Map;for(var r in e)n.set(r,this._convertObject(e[r]));return n}return e},t}(n(50).BaseWriter);t.MapWriter=s},function(e,t,n){"use strict";var r=n(139),i=n(143);e.exports=r("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},i)},function(e,t,n){"use strict";var r=n(4),i=n(8),o=n(59),a=n(13),s=n(27),l=n(26),c=n(134),u=n(128),d=n(63),p=n(5),h=n(129),f=p("isConcatSpreadable"),m=h>=51||!i(function(){var e=[];return e[f]=!1,e.concat()[0]!==e}),g=d("concat"),v=function(e){if(!a(e))return!1;var t=e[f];return void 0!==t?!!t:o(e)};r({target:"Array",proto:!0,forced:!m||!g},{concat:function(e){var t,n,r,i,o,a=s(this),d=u(a,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(v(o=-1===t?a:arguments[t])){if(p+(i=l(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,p++)n in o&&c(d,p,o[n])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");c(d,p++,o)}return d.length=p,d}})},function(e,t,n){"use strict";var r=n(8);function i(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=r(function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),t.BROKEN_CARET=r(function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")})},function(e,t,n){var r=n(223);e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},function(e,t,n){var r=n(13),i=n(42),o=n(5)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(5)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},function(e,t,n){"use strict";n(68);var r=n(25),i=n(8),o=n(5),a=n(93),s=n(21),l=o("species"),c=!i(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),u="$0"==="a".replace(/./,"$0"),d=o("replace"),p=!!/./[d]&&""===/./[d]("a","$0"),h=!i(function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]});e.exports=function(e,t,n,d){var f=o(e),m=!i(function(){var t={};return t[f]=function(){return 7},7!=""[e](t)}),g=m&&!i(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[l]=function(){return n},n.flags="",n[f]=/./[f]),n.exec=function(){return t=!0,null},n[f](""),!t});if(!m||!g||"replace"===e&&(!c||!u||p)||"split"===e&&!h){var v=/./[f],y=n(f,""[e],function(e,t,n,r,i){return t.exec===a?m&&!i?{done:!0,value:v.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}},{REPLACE_KEEPS_$0:u,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:p}),b=y[0],C=y[1];r(String.prototype,e,b),r(RegExp.prototype,f,2==t?function(e,t){return C.call(e,this,t)}:function(e){return C.call(e,this)})}d&&s(RegExp.prototype[f],"sham",!0)}},function(e,t,n){"use strict";var r=n(137).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},function(e,t,n){var r=n(42),i=n(93);e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var o=n.call(e,t);if("object"!=typeof o)throw TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==r(e))throw TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(96);t.forgivingBase64Encode=function(t){return e.from(t).toString("base64")},t.forgivingBase64Decode=function(t){return""===t?"":((t=t.replace(r.ASCIIWhiteSpace,"")).length%4==0&&(t.endsWith("==")?t=t.substr(0,t.length-2):t.endsWith("=")&&(t=t.substr(0,t.length-1))),t.length%4==1?null:/[0-9A-Za-z+/]/.test(t)?e.from(t,"base64").toString("utf8"):null)}}).call(this,n(145).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),a=r[0],s=r[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),u=0,d=s>0?a-4:a;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,l[u++]=255&t),1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(u(e,a,a+16383>s?s:a+16383));return 1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=a.length;s<l;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var i,o,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?i-1:0,p=n?-1:1,h=e[t+d];for(d+=p,o=h&(1<<-u)-1,h>>=-u,u+=s;u>0;o=256*o+e[t+d],d+=p,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;u>0;a=256*a+e[t+d],d+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,r),o-=c}return(h?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,d=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(a++,l/=2),a+d>=u?(s=0,a=u):a+d>=1?(s=(t*l-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+h]=255&s,h+=f,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[n+h]=255&a,h+=f,a/=256,c-=8);e[n+h-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);function o(e){var t,n;if(null===e||i.isString(e)||i.isNumber(e))return e;if(i.isArray(e)){var a=new Array;try{for(var s=r(e),l=s.next();!l.done;l=s.next()){var c=l.value;a.push(o(c))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a}if(i.isObject(e)){for(var u in a=new Map,e)if(e.hasOwnProperty(u)){var d=e[u];a.set(u,o(d))}return a}return e}t.parseJSONFromBytes=function(e){var t=i.utf8Decode(e);return JSON.parse.call(void 0,t)},t.serializeJSONToBytes=function(e){var t=JSON.stringify.call(void 0,e);return i.utf8Encode(t)},t.parseJSONIntoInfraValues=function(e){return o(JSON.parse.call(void 0,e))},t.convertAJSONDerivedJavaScriptValueToAnInfraValue=o},function(e,t,n){"use strict";var r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);t.append=function(e,t){e.push(t)},t.extend=function(e,t){e.push.apply(e,o(t))},t.prepend=function(e,t){e.unshift(t)},t.replace=function(e,t,n){var r,i,o=0;try{for(var l=a(e),c=l.next();!c.done;c=l.next()){var u=c.value;if(s.isFunction(t))t.call(null,u)&&(e[o]=n);else if(u===t)return void(e[o]=n);o++}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}},t.insert=function(e,t,n){e.splice(n,0,t)},t.remove=function(e,t){for(var n=e.length;n--;){var r=e[n];if(s.isFunction(t))t.call(null,r)&&e.splice(n,1);else if(r===t)return void e.splice(n,1)}},t.empty=function(e){e.length=0},t.contains=function(e,t){var n,r;try{for(var i=a(e),o=i.next();!o.done;o=i.next()){var l=o.value;if(s.isFunction(t)){if(t.call(null,l))return!0}else if(l===t)return!0}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return!1},t.size=function(e,t){var n,r;if(void 0===t)return e.length;var i=0;try{for(var o=a(e),s=o.next();!s.done;s=o.next()){var l=s.value;t.call(null,l)&&i++}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},t.isEmpty=function(e){return 0===e.length},t.forEach=function(e,t){var n,i,o,s,l,c;return r(this,function(r){switch(r.label){case 0:return void 0!==t?[3,2]:[5,a(e)];case 1:return r.sent(),[3,9];case 2:r.trys.push([2,7,8,9]),n=a(e),i=n.next(),r.label=3;case 3:return i.done?[3,6]:(o=i.value,t.call(null,o)?[4,o]:[3,5]);case 4:r.sent(),r.label=5;case 5:return i=n.next(),[3,3];case 6:return[3,9];case 7:return s=r.sent(),l={error:s},[3,9];case 8:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 9:return[2]}})},t.clone=function(e){return new(Array.bind.apply(Array,o([void 0],e)))},t.sortInAscendingOrder=function(e,t){return e.sort(function(e,n){return t.call(null,e,n)?-1:1})},t.sortInDescendingOrder=function(e,t){return e.sort(function(e,n){return t.call(null,e,n)?1:-1})}},function(e,t,n){"use strict";var r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);t.get=function(e,t){return e.get(t)},t.set=function(e,t,n){e.set(t,n)},t.remove=function(e,t){var n,r,o,a;if(s.isFunction(t)){var l=[];try{for(var c=i(e),u=c.next();!u.done;u=c.next()){var d=u.value;t.call(null,d)&&l.push(d[0])}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var p=i(l),h=p.next();!h.done;h=p.next()){var f=h.value;e.delete(f)}}catch(e){o={error:e}}finally{try{h&&!h.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}}else e.delete(t)},t.contains=function(e,t){var n,r;if(s.isFunction(t)){try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var l=a.value;if(t.call(null,l))return!0}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return!1}return e.has(t)},t.keys=function(e){return new Set(e.keys())},t.values=function(e){return a(e.values())},t.size=function(e,t){var n,r;if(void 0===t)return e.size;var o=0;try{for(var a=i(e),s=a.next();!s.done;s=a.next()){var l=s.value;t.call(null,l)&&o++}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},t.isEmpty=function(e){return 0===e.size},t.forEach=function(e,t){var n,o,a,s,l,c;return r(this,function(r){switch(r.label){case 0:return void 0!==t?[3,2]:[5,i(e)];case 1:return r.sent(),[3,9];case 2:r.trys.push([2,7,8,9]),n=i(e),o=n.next(),r.label=3;case 3:return o.done?[3,6]:(a=o.value,t.call(null,a)?[4,a]:[3,5]);case 4:r.sent(),r.label=5;case 5:return o=n.next(),[3,3];case 6:return[3,9];case 7:return s=r.sent(),l={error:s},[3,9];case 8:try{o&&!o.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 9:return[2]}})},t.clone=function(e){return new Map(e)},t.sortInAscendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?-1:1}),new Map(n)},t.sortInDescendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?1:-1}),new Map(n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTML="http://www.w3.org/1999/xhtml",t.XML="http://www.w3.org/XML/1998/namespace",t.XMLNS="http://www.w3.org/2000/xmlns/",t.MathML="http://www.w3.org/1998/Math/MathML",t.SVG="http://www.w3.org/2000/svg",t.XLink="http://www.w3.org/1999/xlink"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enqueue=function(e,t){e.push(t)},t.dequeue=function(e){return e.shift()||null}},function(e,t,n){"use strict";var r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);function l(e,t){var n,r;try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(!t.has(s))return!1}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return!0}t.append=function(e,t){e.add(t)},t.extend=function(e,t){t.forEach(e.add,e)},t.prepend=function(e,t){var n=new Set(e);e.clear(),e.add(t),n.forEach(e.add,e)},t.replace=function(e,t,n){var r,o,a=new Set;try{for(var l=i(e),c=l.next();!c.done;c=l.next()){var u=c.value;s.isFunction(t)?t.call(null,u)?a.add(n):a.add(u):u===t?a.add(n):a.add(u)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}e.clear(),a.forEach(e.add,e)},t.insert=function(e,t,n){var r,o,a=new Set,s=0;try{for(var l=i(e),c=l.next();!c.done;c=l.next()){var u=c.value;s===n&&a.add(t),a.add(u),s++}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}e.clear(),a.forEach(e.add,e)},t.remove=function(e,t){var n,r,o,a;if(s.isFunction(t)){var l=[];try{for(var c=i(e),u=c.next();!u.done;u=c.next()){var d=u.value;t.call(null,d)&&l.push(d)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var p=i(l),h=p.next();!h.done;h=p.next()){var f=h.value;e.delete(f)}}catch(e){o={error:e}}finally{try{h&&!h.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}}else e.delete(t)},t.empty=function(e){e.clear()},t.contains=function(e,t){var n,r;if(!s.isFunction(t))return e.has(t);try{for(var o=i(e),a=o.next();!a.done;a=o.next()){var l=a.value;if(t.call(null,l))return!0}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return!1},t.size=function(e,t){var n,r;if(void 0===t)return e.size;var o=0;try{for(var a=i(e),s=a.next();!s.done;s=a.next()){var l=s.value;t.call(null,l)&&o++}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},t.isEmpty=function(e){return 0===e.size},t.forEach=function(e,t){var n,o,a,s,l,c;return r(this,function(r){switch(r.label){case 0:return void 0!==t?[3,2]:[5,i(e)];case 1:return r.sent(),[3,9];case 2:r.trys.push([2,7,8,9]),n=i(e),o=n.next(),r.label=3;case 3:return o.done?[3,6]:(a=o.value,t.call(null,a)?[4,a]:[3,5]);case 4:r.sent(),r.label=5;case 5:return o=n.next(),[3,3];case 6:return[3,9];case 7:return s=r.sent(),l={error:s},[3,9];case 8:try{o&&!o.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}return[7];case 9:return[2]}})},t.clone=function(e){return new Set(e)},t.sortInAscendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?-1:1}),new Set(n)},t.sortInDescendingOrder=function(e,t){var n=new(Array.bind.apply(Array,a([void 0],e)));return n.sort(function(e,n){return t.call(null,e,n)?1:-1}),new Set(n)},t.isSubsetOf=l,t.isSupersetOf=function(e,t){return l(t,e)},t.intersection=function(e,t){var n,r,o=new Set;try{for(var a=i(e),s=a.next();!s.done;s=a.next()){var l=s.value;t.has(l)&&o.add(l)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},t.union=function(e,t){var n=new Set(e);return t.forEach(n.add,n),n},t.range=function(e,t){for(var n=new Set,r=e;r<=t;r++)n.add(r);return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.push=function(e,t){e.push(t)},t.pop=function(e){return e.pop()||null}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(96),o=n(147),a=n(146),s=n(1);function l(e,t){for(var n=0;;){var r=n<e.length?e.charCodeAt(n):null,i=n<t.length?t.charCodeAt(n):null;if(null===r)return!0;if(r!==i)return!1;n++}}function c(e){var t,n,i=Array.from(e),o=new Uint8Array(i.length),a=0;try{for(var s=r(e),l=s.next();!l.done;l=s.next()){var c=l.value.codePointAt(0);console.assert(void 0!==c&&c<=255,"isomorphicEncode requires string bytes to be less than or equal to 0x00FF."),void 0!==c&&c<=255&&(o[a++]=c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o}function u(e){return/^[\u0000-\u007F]*$/.test(e)}function d(e){var t,n,i="";try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.codePointAt(0);i+=void 0!==l&&l>=65&&l<=90?String.fromCodePoint(l+32):s}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}function p(e){return e.replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,"")}function h(e,t,n){if(!s.isArray(t))return h(e,Array.from(t),n);for(var r="";n.position<t.length&&e.call(null,t[n.position]);)r+=t[n.position],n.position++;return r}function f(e,t){h(function(e){return i.ASCIIWhiteSpace.test(e)},e,t)}t.isCodeUnitPrefix=l,t.isCodeUnitLessThan=function(e,t){if(l(t,e))return!1;if(l(e,t))return!0;for(var n=0;n<Math.min(e.length,t.length);n++){var r=e.charCodeAt(n),i=t.charCodeAt(n);if(r!==i)return r<i}return!1},t.isomorphicEncode=c,t.isASCIIString=u,t.asciiLowercase=d,t.asciiUppercase=function(e){var t,n,i="";try{for(var o=r(e),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.codePointAt(0);i+=void 0!==l&&l>=97&&l<=122?String.fromCodePoint(l-32):s}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},t.asciiCaseInsensitiveMatch=function(e,t){return d(e)===d(t)},t.asciiEncode=function(e){return console.assert(u(e),"asciiEncode requires an ASCII string."),c(e)},t.asciiDecode=function(e){var t,n;try{for(var i=r(e),s=i.next();!s.done;s=i.next()){var l=s.value;console.assert(a.isASCIIByte(l),"asciiDecode requires an ASCII byte sequence.")}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o.isomorphicDecode(e)},t.stripNewlines=function(e){return e.replace(/[\n\r]/g,"")},t.normalizeNewlines=function(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")},t.stripLeadingAndTrailingASCIIWhitespace=p,t.stripAndCollapseASCIIWhitespace=function(e){return p(e.replace(/[\t\n\f\r ]{2,}/g," "))},t.collectASequenceOfCodePoints=h,t.skipASCIIWhitespace=f,t.strictlySplit=function e(t,n){if(!s.isArray(t))return e(Array.from(t),n);var r={position:0},i=[],o=h(function(e){return n!==e},t,r);for(i.push(o);r.position<t.length;)console.assert(t[r.position]===n,"strictlySplit found no delimiter in input string."),r.position++,o=h(function(e){return n!==e},t,r),i.push(o);return i},t.splitAStringOnASCIIWhitespace=function e(t){if(!s.isArray(t))return e(Array.from(t));var n={position:0},r=[];for(f(t,n);n.position<t.length;){var o=h(function(e){return!i.ASCIIWhiteSpace.test(e)},t,n);r.push(o),f(t,n)}return r},t.splitAStringOnCommas=function e(t){if(!s.isArray(t))return e(Array.from(t));for(var n={position:0},r=[];n.position<t.length;){var i=h(function(e){return","!==e},t,n);r.push(p(i)),n.position<t.length&&(console.assert(","===t[n.position],"splitAStringOnCommas found no delimiter in input string."),n.position++)}return r},t.concatenate=function(e,t){return void 0===t&&(t=""),0===e.length?"":e.join(t)}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(97);t.abort_add=function(e,t){t._abortedFlag||t._abortAlgorithms.add(e)},t.abort_remove=function(e,t){t._abortAlgorithms.delete(e)},t.abort_signalAbort=function(e){var t,n;if(!e._abortedFlag){e._abortedFlag=!0;try{for(var o=r(e._abortAlgorithms),a=o.next();!a.done;a=o.next())a.value.call(e)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}e._abortAlgorithms.clear(),i.event_fireAnEvent("abort",e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(150),i=function(){function e(){}return e.asNode=function(e){if(r.Guard.isNode(e))return e;throw new Error("Invalid object. Node expected.")},e}();t.Cast=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return Object.defineProperty(e.prototype,"size",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.add=function(e){throw new Error("Cannot add to an empty set.")},e.prototype.clear=function(){},e.prototype.delete=function(e){return!1},e.prototype.forEach=function(e,t){},e.prototype.has=function(e){return!1},e.prototype[Symbol.iterator]=function(){return new i},e.prototype.entries=function(){return new i},e.prototype.keys=function(){return new i},e.prototype.values=function(){return new i},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return"EmptySet"},enumerable:!0,configurable:!0}),e}();t.EmptySet=r;var i=function(){function e(){}return e.prototype[Symbol.iterator]=function(){return this},e.prototype.next=function(){return{done:!0,value:null}},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SchemeStart=0]="SchemeStart",e[e.Scheme=1]="Scheme",e[e.NoScheme=2]="NoScheme",e[e.SpecialRelativeOrAuthority=3]="SpecialRelativeOrAuthority",e[e.PathOrAuthority=4]="PathOrAuthority",e[e.Relative=5]="Relative",e[e.RelativeSlash=6]="RelativeSlash",e[e.SpecialAuthoritySlashes=7]="SpecialAuthoritySlashes",e[e.SpecialAuthorityIgnoreSlashes=8]="SpecialAuthorityIgnoreSlashes",e[e.Authority=9]="Authority",e[e.Host=10]="Host",e[e.Hostname=11]="Hostname",e[e.Port=12]="Port",e[e.File=13]="File",e[e.FileSlash=14]="FileSlash",e[e.FileHost=15]="FileHost",e[e.PathStart=16]="PathStart",e[e.Path=17]="Path",e[e.CannotBeABaseURLPath=18]="CannotBeABaseURLPath",e[e.Query=19]="Query",e[e.Fragment=20]="Fragment"}(t.ParserState||(t.ParserState={})),t.OpaqueOrigin=["","",null,null]},function(e,t,n){"use strict";var r=n(245),i=n(247);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=b,t.resolve=function(e,t){return b(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},t.format=function(e){return i.isString(e)&&(e=b(e)),e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),p=["/","?","#"],h=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n(248);function b(e,t,n){if(e&&i.isObject(e)&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}o.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(s);if(b=b.trim(),!n&&1===e.split("#").length){var C=l.exec(b);if(C)return this.path=b,this.href=b,this.pathname=C[1],C[2]?(this.search=C[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=a.exec(b);if(w){var E=(w=w[0]).toLowerCase();this.protocol=E,b=b.substr(w.length)}if(n||w||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===b.substr(0,2);!T||w&&g[w]||(b=b.substr(2),this.slashes=!0)}if(!g[w]&&(T||w&&!v[w])){for(var x,_,S=-1,I=0;I<p.length;I++)-1!==(D=b.indexOf(p[I]))&&(-1===S||D<S)&&(S=D);for(-1!==(_=-1===S?b.lastIndexOf("@"):b.lastIndexOf("@",S))&&(x=b.slice(0,_),b=b.slice(_+1),this.auth=decodeURIComponent(x)),S=-1,I=0;I<d.length;I++){var D;-1!==(D=b.indexOf(d[I]))&&(-1===S||D<S)&&(S=D)}-1===S&&(S=b.length),this.host=b.slice(0,S),b=b.slice(S),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var P=this.hostname.split(/\./),O=(I=0,P.length);I<O;I++){var R=P[I];if(R&&!R.match(h)){for(var M="",N=0,L=R.length;N<L;N++)R.charCodeAt(N)>127?M+="x":M+=R[N];if(!M.match(h)){var k=P.slice(0,I),F=P.slice(I+1),V=R.match(f);V&&(k.push(V[1]),F.unshift(V[2])),F.length&&(b="/"+F.join(".")+b),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=r.toASCII(this.hostname));var U=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+U,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[E])for(I=0,O=u.length;I<O;I++){var G=u[I];if(-1!==b.indexOf(G)){var W=encodeURIComponent(G);W===G&&(W=escape(G)),b=b.split(G).join(W)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var H=b.indexOf("?");if(-1!==H?(this.search=b.substr(H),this.query=b.substr(H+1),t&&(this.query=y.parse(this.query)),b=b.slice(0,H)):t&&(this.search="",this.query={}),b&&(this.pathname=b),v[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var j=this.search||"";this.path=U+j}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=y.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(n[u]=e[u])}return v[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!v[e.protocol]){for(var d=Object.keys(e),p=0;p<d.length;p++){var h=d[p];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",y=n.search||"";n.path=m+y}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),C=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=C||b||n.host&&e.pathname,E=w,T=n.pathname&&n.pathname.split("/")||[],x=(f=e.pathname&&e.pathname.split("/")||[],n.protocol&&!v[n.protocol]);if(x&&(n.hostname="",n.port=null,n.host&&(""===T[0]?T[0]=n.host:T.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),w=w&&(""===f[0]||""===T[0])),C)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,T=f;else if(f.length)T||(T=[]),T.pop(),T=T.concat(f),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search))return x&&(n.hostname=n.host=T.shift(),(A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=A.shift(),n.host=n.hostname=A.shift())),n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!T.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var _=T.slice(-1)[0],S=(n.host||e.host||T.length>1)&&("."===_||".."===_)||""===_,I=0,D=T.length;D>=0;D--)"."===(_=T[D])?T.splice(D,1):".."===_?(T.splice(D,1),I++):I&&(T.splice(D,1),I--);if(!w&&!E)for(;I--;I)T.unshift("..");!w||""===T[0]||T[0]&&"/"===T[0].charAt(0)||T.unshift(""),S&&"/"!==T.join("/").substr(-1)&&T.push("");var A,P=""===T[0]||T[0]&&"/"===T[0].charAt(0);return x&&(n.hostname=n.host=P?"":T.length?T.shift():"",(A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=A.shift(),n.host=n.hostname=A.shift())),(w=w||n.host&&T.length)&&!P&&T.unshift(""),T.length?n.pathname=T.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,r){var i;!function(){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof r&&r;o.global!==o&&o.window!==o&&o.self;var a,s=2147483647,l=/^xn--/,c=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,h=String.fromCharCode;function f(e){throw new RangeError(d[e])}function m(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function g(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+m((e=e.replace(u,".")).split("."),t).join(".")}function v(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function y(e){return m(e,function(e){var t="";return e>65535&&(t+=h((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+h(e)}).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function C(e,t,n){var r=0;for(e=n?p(e/700):e>>1,e+=p(e/t);e>455;r+=36)e=p(e/35);return p(r+36*e/(e+38))}function w(e){var t,n,r,i,o,a,l,c,u,d,h,m=[],g=e.length,v=0,b=128,w=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&f("not-basic"),m.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<g;){for(o=v,a=1,l=36;i>=g&&f("invalid-input"),((c=(h=e.charCodeAt(i++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:36)>=36||c>p((s-v)/a))&&f("overflow"),v+=c*a,!(c<(u=l<=w?1:l>=w+26?26:l-w));l+=36)a>p(s/(d=36-u))&&f("overflow"),a*=d;w=C(v-o,t=m.length+1,0==o),p(v/t)>s-b&&f("overflow"),b+=p(v/t),v%=t,m.splice(v++,0,b)}return y(m)}function E(e){var t,n,r,i,o,a,l,c,u,d,m,g,y,w,E,T=[];for(g=(e=v(e)).length,t=128,n=0,o=72,a=0;a<g;++a)(m=e[a])<128&&T.push(h(m));for(r=i=T.length,i&&T.push("-");r<g;){for(l=s,a=0;a<g;++a)(m=e[a])>=t&&m<l&&(l=m);for(l-t>p((s-n)/(y=r+1))&&f("overflow"),n+=(l-t)*y,t=l,a=0;a<g;++a)if((m=e[a])<t&&++n>s&&f("overflow"),m==t){for(c=n,u=36;!(c<(d=u<=o?1:u>=o+26?26:u-o));u+=36)E=c-d,w=36-d,T.push(h(b(d+E%w,0))),c=p(E/w);T.push(h(b(c,0))),o=C(n,y,r==i),n=0,++r}++n,++t}return T.join("")}a={version:"1.4.1",ucs2:{decode:v,encode:y},decode:w,encode:E,toASCII:function(e){return g(e,function(e){return c.test(e)?"xn--"+E(e):e})},toUnicode:function(e){return g(e,function(e){return l.test(e)?w(e.slice(4).toLowerCase()):e})}},void 0===(i=function(){return a}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(246)(e),n(78))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(249),t.encode=t.stringify=n(250)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var c=e.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var d,p,h,f,m=e[u].replace(s,"%20"),g=m.indexOf(n);g>=0?(d=m.substr(0,g),p=m.substr(g+1)):(d=m,p=""),h=decodeURIComponent(d),f=decodeURIComponent(p),r(a,h)?i(a[h])?a[h].push(f):a[h]=[a[h],f]:a[h]=f}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(a(e),function(a){var s=encodeURIComponent(r(a))+n;return i(e[a])?o(e[a],function(e){return s+encodeURIComponent(r(e))}).join(t):s+encodeURIComponent(r(e[a]))}).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(52);t.attr_setAnExistingAttributeValue=function(e,t){null===e._element?e._value=t:r.element_change(e,e._element,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(108),i=n(30),o=n(52);t.tokenList_validationSteps=function(e,t){if(!i.dom_hasSupportedTokens(e._attribute._localName))throw new TypeError("There are no supported tokens defined for attribute name: '"+e._attribute._localName+"'.");return i.dom_getSupportedTokens(e._attribute._localName).has(t.toLowerCase())},t.tokenList_updateSteps=function(e){(e._element.hasAttribute(e._attribute._localName)||0!==e._tokenSet.size)&&o.element_setAnAttributeValue(e._element,e._attribute._localName,r.orderedSet_serialize(e._tokenSet))},t.tokenList_serializeSteps=function(e){return o.element_getAnAttributeValue(e._element,e._attribute._localName)}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);function o(e){return i.isBoolean(e)?e:e.capture||!1}t.eventTarget_flatten=o,t.eventTarget_flattenMore=function(e){var t=o(e),n=!1,r=!1;return i.isBoolean(e)||(n=e.once||!1,r=e.passive||!1),[t,r,n]},t.eventTarget_addEventListener=function(e,t){if(null!==t.callback){for(var n=0;n<e._eventListenerList.length;n++){var r=e._eventListenerList[n];if(r.type===t.type&&r.callback.handleEvent===t.callback.handleEvent&&r.capture===t.capture)return}e._eventListenerList.push(t)}},t.eventTarget_removeEventListener=function(e,t,n){t.removed=!0,e._eventListenerList.splice(n,1)},t.eventTarget_removeAllEventListeners=function(e){var t,n;try{for(var i=r(e._eventListenerList),o=i.next();!o.done;o=i.next())o.value.removed=!0}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e._eventListenerList.length=0}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(29);t.parentNode_convertNodesIntoANode=function(e,t){for(var n,a,s=null,l=0;l<e.length;l++){var c=e[l];if(i.isString(c)){var u=o.create_text(t,c);e[l]=u}}if(1===e.length)s=e[0];else{var d=s=o.create_documentFragment(t);try{for(var p=r(e),h=p.next();!h.done;h=p.next())c=h.value,d.appendChild(c)}catch(e){n={error:e}}finally{try{h&&!h.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}}return s}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(9),l=n(3),c=n(29),u=n(17),d=n(175),p=n(107),h=n(176),f=n(37),m=n(177);function g(e){return e._startNode===e._endNode&&e._startOffset===e._endOffset}function v(e){return u.tree_rootNode(e._startNode)}function y(e,t){return u.tree_rootNode(e)===v(t)&&d.boundaryPoint_position([e,0],t._start)===a.BoundaryPosition.After&&d.boundaryPoint_position([e,u.tree_nodeLength(e)],t._end)===a.BoundaryPosition.Before}function b(e,t){var n=u.tree_isAncestorOf(t._startNode,e,!0),r=u.tree_isAncestorOf(t._endNode,e,!0);return n&&!r||!n&&r}function C(e){var t,n,i,a,d,m,v=c.create_documentFragment(e._startNode._nodeDocument);if(g(e))return v;var w=e._startNode,E=e._startOffset,T=e._endNode,x=e._endOffset;if(w===T&&l.Guard.isCharacterDataNode(w))return(U=h.node_clone(w))._data=p.characterData_substringData(w,E,x-E),f.mutation_append(U,v),p.characterData_replaceData(w,E,x-E,""),v;for(var _=w;!u.tree_isAncestorOf(T,_,!0);){if(null===_._parent)throw new Error("Parent node  is null.");_=_._parent}var S=null;if(!u.tree_isAncestorOf(T,w,!0))try{for(var I=r(_._children),D=I.next();!D.done;D=I.next())if(b(R=D.value,e)){S=R;break}}catch(e){t={error:e}}finally{try{D&&!D.done&&(n=I.return)&&n.call(I)}finally{if(t)throw t.error}}var A=null;if(!u.tree_isAncestorOf(w,T,!0))for(var P=o(_._children),O=P.length-1;O>0;O--){var R;if(b(R=P[O],e)){A=R;break}}var M,N,L=[];try{for(var k=r(_._children),F=k.next();!F.done;F=k.next())if(y(z=F.value,e)){if(l.Guard.isDocumentTypeNode(z))throw new s.HierarchyRequestError;L.push(z)}}catch(e){i={error:e}}finally{try{F&&!F.done&&(a=k.return)&&a.call(k)}finally{if(i)throw i.error}}if(u.tree_isAncestorOf(T,w,!0))M=w,N=E;else{for(var V=w;null!==V._parent&&!u.tree_isAncestorOf(T,V._parent);)V=V._parent;if(null===V._parent)throw new Error("Parent node is null.");M=V._parent,N=1+u.tree_index(V)}if(l.Guard.isCharacterDataNode(S))(U=h.node_clone(w))._data=p.characterData_substringData(w,E,u.tree_nodeLength(w)-E),f.mutation_append(U,v),p.characterData_replaceData(w,E,u.tree_nodeLength(w)-E,"");else if(null!==S){var U=h.node_clone(S);f.mutation_append(U,v);var B=C(c.create_range([w,E],[S,u.tree_nodeLength(S)]));f.mutation_append(B,U)}try{for(var G=r(L),W=G.next();!W.done;W=G.next()){var z=W.value;f.mutation_append(z,v)}}catch(e){d={error:e}}finally{try{W&&!W.done&&(m=G.return)&&m.call(G)}finally{if(d)throw d.error}}return l.Guard.isCharacterDataNode(A)?((U=h.node_clone(T))._data=p.characterData_substringData(T,0,x),f.mutation_append(U,v),p.characterData_replaceData(T,0,x,"")):null!==A&&(U=h.node_clone(A),f.mutation_append(U,v),B=C(c.create_range([A,0],[T,x])),f.mutation_append(B,U)),e._start=[M,N],e._end=[M,N],v}t.range_collapsed=g,t.range_root=v,t.range_isContained=y,t.range_isPartiallyContained=b,t.range_setTheStart=function(e,t,n){if(l.Guard.isDocumentTypeNode(t))throw new s.InvalidNodeTypeError;if(n>u.tree_nodeLength(t))throw new s.IndexSizeError;var r=[t,n];v(e)===u.tree_rootNode(t)&&d.boundaryPoint_position(r,e._end)!==a.BoundaryPosition.After||(e._end=r),e._start=r},t.range_setTheEnd=function(e,t,n){if(l.Guard.isDocumentTypeNode(t))throw new s.InvalidNodeTypeError;if(n>u.tree_nodeLength(t))throw new s.IndexSizeError;var r=[t,n];v(e)===u.tree_rootNode(t)&&d.boundaryPoint_position(r,e._start)!==a.BoundaryPosition.Before||(e._start=r),e._end=r},t.range_select=function(e,t){var n=e._parent;if(null===n)throw new s.InvalidNodeTypeError;var r=u.tree_index(e);t._start=[n,r],t._end=[n,r+1]},t.range_extract=C,t.range_cloneTheContents=function e(t){var n,i,a,d,m,v,w=c.create_documentFragment(t._startNode._nodeDocument);if(g(t))return w;var E=t._startNode,T=t._startOffset,x=t._endNode,_=t._endOffset;E===x&&l.Guard.isCharacterDataNode(E)&&((F=h.node_clone(E))._data=p.characterData_substringData(E,T,_-T),f.mutation_append(F,w));for(var S=E;!u.tree_isAncestorOf(x,S,!0);){if(null===S._parent)throw new Error("Parent node  is null.");S=S._parent}var I=null;if(!u.tree_isAncestorOf(x,E,!0))try{for(var D=r(S._children),A=D.next();!A.done;A=D.next())if(b(M=A.value,t)){I=M;break}}catch(e){n={error:e}}finally{try{A&&!A.done&&(i=D.return)&&i.call(D)}finally{if(n)throw n.error}}var P=null;if(!u.tree_isAncestorOf(E,x,!0))for(var O=o(S._children),R=O.length-1;R>0;R--){var M;if(b(M=O[R],t)){P=M;break}}var N=[];try{for(var L=r(S._children),k=L.next();!k.done;k=L.next())if(y(G=k.value,t)){if(l.Guard.isDocumentTypeNode(G))throw new s.HierarchyRequestError;N.push(G)}}catch(e){a={error:e}}finally{try{k&&!k.done&&(d=L.return)&&d.call(L)}finally{if(a)throw a.error}}if(l.Guard.isCharacterDataNode(I))(F=h.node_clone(E))._data=p.characterData_substringData(E,T,u.tree_nodeLength(E)-T),f.mutation_append(F,w);else if(null!==I){var F=h.node_clone(I);f.mutation_append(F,w);var V=e(c.create_range([E,T],[I,u.tree_nodeLength(I)]));f.mutation_append(V,F)}try{for(var U=r(N),B=U.next();!B.done;B=U.next()){var G=B.value;F=h.node_clone(G),f.mutation_append(F,w)}}catch(e){m={error:e}}finally{try{B&&!B.done&&(v=U.return)&&v.call(U)}finally{if(m)throw m.error}}return l.Guard.isCharacterDataNode(P)?((F=h.node_clone(x))._data=p.characterData_substringData(x,0,_),f.mutation_append(F,w)):null!==P&&(F=h.node_clone(P),w.append(F),V=C(c.create_range([P,0],[x,_])),f.mutation_append(V,F)),w},t.range_insert=function(e,t){var n,i;if(l.Guard.isProcessingInstructionNode(t._startNode)||l.Guard.isCommentNode(t._startNode)||l.Guard.isTextNode(t._startNode)&&null===t._startNode._parent||t._startNode===e)throw new s.HierarchyRequestError;var o,a=null;if(l.Guard.isTextNode(t._startNode))a=t._startNode;else{var c=0;try{for(var d=r(t._startNode._children),p=d.next();!p.done;p=d.next()){var h=p.value;if(c===t._startOffset){a=h;break}c++}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(null===a)o=t._startNode;else{if(null===a._parent)throw new Error("Parent node is null.");o=a._parent}f.mutation_ensurePreInsertionValidity(e,o,a),l.Guard.isTextNode(t._startNode)&&(a=m.text_split(t._startNode,t._startOffset)),e===a&&(a=e._nextSibling),null!==e._parent&&f.mutation_remove(e,e._parent);var v=null===a?u.tree_nodeLength(o):u.tree_index(a);l.Guard.isDocumentFragmentNode(e)?v+=u.tree_nodeLength(e):v++,f.mutation_preInsert(e,o,a),g(t)&&(t._end=[o,v])},t.range_getContainedNodes=function(e){var t;return(t={})[Symbol.iterator]=function(){var t=e.commonAncestorContainer,n=u.tree_getFirstDescendantNode(t);return{next:function(){for(;n&&!y(n,e);)n=u.tree_getNextDescendantNode(t,n);if(null===n)return{done:!0,value:null};var r={done:!1,value:n};return n=u.tree_getNextDescendantNode(t,n),r}}},t},t.range_getPartiallyContainedNodes=function(e){var t;return(t={})[Symbol.iterator]=function(){var t=e.commonAncestorContainer,n=u.tree_getFirstDescendantNode(t);return{next:function(){for(;n&&!b(n,e);)n=u.tree_getNextDescendantNode(t,n);if(null===n)return{done:!0,value:null};var r={done:!1,value:n};return n=u.tree_getNextDescendantNode(t,n),r}}},t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9);t.selectors_scopeMatchASelectorsString=function(e,t){throw new r.NotSupportedError}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(105);t.treeWalker_traverseChildren=function(e,t){for(var n=t?e._current._firstChild:e._current._lastChild;null!==n;){var o=i.traversal_filter(e,n);if(o===r.FilterResult.Accept)return e._current=n,n;if(o===r.FilterResult.Skip){var a=t?n._firstChild:n._lastChild;if(null!==a){n=a;continue}}for(;null!==n;){var s=t?n._nextSibling:n._previousSibling;if(null!==s){n=s;break}var l=n._parent;if(null===l||l===e._root||l===e._current)return null;n=l}}return null},t.treeWalker_traverseSiblings=function(e,t){var n=e._current;if(n===e._root)return null;for(;;){for(var o=t?n._nextSibling:n._previousSibling;null!==o;){n=o;var a=i.traversal_filter(e,n);if(a===r.FilterResult.Accept)return e._current=n,n;o=t?n._firstChild:n._lastChild,a!==r.FilterResult.Reject&&null!==o||(o=t?n._nextSibling:n._previousSibling)}if(null===(n=n._parent)||n===e._root)return null;if(i.traversal_filter(e,n)===r.FilterResult.Accept)return null}}},function(e,t,n){"use strict";n(89),n(74);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(2),s=n(50),l=n(3),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r._indentation={},r._lengthToLastNewline=0,r._writerOptions=o.applyDefaults(n,{wellFormed:!1,headless:!1,prettyPrint:!1,indent:"  ",newline:"\n",offset:0,width:0,allowEmptyTags:!1,indentTextOnlyNodes:!1,spaceBeforeSlash:!1}),r}return i(t,e),t.prototype.serialize=function(e){return this._refs={suppressPretty:!1,emptyNode:!1,markup:""},e.nodeType!==a.NodeType.Document||this._writerOptions.headless||this.declaration(this._builderOptions.version,this._builderOptions.encoding,this._builderOptions.standalone),this.serializeNode(e,this._writerOptions.wellFormed),this._writerOptions.prettyPrint&&this._refs.markup.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(this._refs.markup=this._refs.markup.slice(0,-this._writerOptions.newline.length)),this._refs.markup},t.prototype.declaration=function(e,t,n){this._beginLine(),this._refs.markup+='<?xml version="'+e+'"',void 0!==t&&(this._refs.markup+=' encoding="'+t+'"'),void 0!==n&&(this._refs.markup+=' standalone="'+(n?"yes":"no")+'"'),this._refs.markup+="?>",this._endLine()},t.prototype.docType=function(e,t,n){this._beginLine(),this._refs.markup+=t&&n?"<!DOCTYPE "+e+' PUBLIC "'+t+'" "'+n+'">':t?"<!DOCTYPE "+e+' PUBLIC "'+t+'">':n?"<!DOCTYPE "+e+' SYSTEM "'+n+'">':"<!DOCTYPE "+e+">",this._endLine()},t.prototype.openTagBegin=function(e){this._beginLine(),this._refs.markup+="<"+e},t.prototype.openTagEnd=function(e,t,n){if(this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._writerOptions.prettyPrint&&!t&&!n){for(var r=!0,i=!0,o=this.currentNode.firstChild,a=0,s=0;o;){if(l.Guard.isExclusiveTextNode(o))s++;else{if(!l.Guard.isCDATASectionNode(o)){r=!1,i=!1;break}a++}""!==o.data&&(i=!1),o=o.nextSibling}this._refs.suppressPretty=!this._writerOptions.indentTextOnlyNodes&&r&&(a<=1&&0===s||0===a),this._refs.emptyNode=i}(n||t||this._refs.emptyNode)&&this._writerOptions.allowEmptyTags?this._refs.markup+="></"+e+">":this._refs.markup+=n?" />":t||this._refs.emptyNode?this._writerOptions.spaceBeforeSlash?" />":"/>":">",this._endLine()},t.prototype.closeTag=function(e){this._refs.emptyNode||(this._beginLine(),this._refs.markup+="</"+e+">"),this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._endLine()},t.prototype.attribute=function(e,t){var n=e+'="'+t+'"';this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._refs.markup.length-this._lengthToLastNewline+1+n.length>this._writerOptions.width?(this._endLine(),this._beginLine(),this._refs.markup+=this._indent(1)+n):this._refs.markup+=" "+n},t.prototype.text=function(e){""!==e&&(this._beginLine(),this._refs.markup+=e,this._endLine())},t.prototype.cdata=function(e){""!==e&&(this._beginLine(),this._refs.markup+="<![CDATA["+e+"]]>",this._endLine())},t.prototype.comment=function(e){this._beginLine(),this._refs.markup+="\x3c!--"+e+"--\x3e",this._endLine()},t.prototype.instruction=function(e,t){this._beginLine(),this._refs.markup+="<?"+(""===t?e:e+" "+t)+"?>",this._endLine()},t.prototype._beginLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._indent(this._writerOptions.offset+this.level))},t.prototype._endLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._writerOptions.newline,this._lengthToLastNewline=this._refs.markup.length)},t.prototype._indent=function(e){if(e<=0)return"";if(void 0!==this._indentation[e])return this._indentation[e];var t=this._writerOptions.indent.repeat(e);return this._indentation[e]=t,t},t}(s.BaseWriter);t.XMLWriter=c},function(e,t,n){"use strict";var r=n(47),i=n(35);e.exports="".repeat||function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(178),n(20),n(22),n(23);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(67),s=n(1),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r._writerOptions=s.applyDefaults(n,{wellFormed:!1,prettyPrint:!1,indent:"  ",newline:"\n",offset:0,group:!1,verbose:!1}),r}return i(t,e),t.prototype.serialize=function(e){var t=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),n=new a.ObjectWriter(this._builderOptions,t).serialize(e);return this._beginLine(this._writerOptions,0)+this._convertObject(n,this._writerOptions)},t.prototype._convertObject=function(e,t,n){var r,i,a=this;void 0===n&&(n=0);var l="",c=this._isLeafNode(e);if(s.isArray(e)){l+="[";var u=e.length,d=0;try{for(var p=o(e),h=p.next();!h.done;h=p.next()){var f=h.value;l+=this._endLine(t,n+1)+this._beginLine(t,n+1)+this._convertObject(f,t,n+1),d<u-1&&(l+=","),d++}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}l+=this._endLine(t,n)+this._beginLine(t,n),l+="]"}else if(s.isObject(e)){l+="{";var m=s.objectLength(e),g=0;s.forEachObject(e,function(e,r){c&&t.prettyPrint?l+=" ":l+=a._endLine(t,n+1)+a._beginLine(t,n+1),l+=a._key(e),t.prettyPrint&&(l+=" "),l+=a._convertObject(r,t,n+1),g<m-1&&(l+=","),g++},this),c&&t.prettyPrint?l+=" ":l+=this._endLine(t,n)+this._beginLine(t,n),l+="}"}else l+=this._val(e);return l},t.prototype._beginLine=function(e,t){if(!e.prettyPrint)return"";var n=e.offset+t+1;return n>0?new Array(n).join(e.indent):""},t.prototype._endLine=function(e,t){return e.prettyPrint?e.newline:""},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t.prototype._isLeafNode=function(e){return this._descendantCount(e)<=1},t.prototype._descendantCount=function(e,t){var n=this;return void 0===t&&(t=0),s.isArray(e)?s.forEachArray(e,function(e){return t+=n._descendantCount(e,t)},this):s.isObject(e)?s.forEachObject(e,function(e,r){return t+=n._descendantCount(r,t)},this):t++,t},t}(n(50).BaseWriter);t.JSONWriter=l},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(178),n(89),n(20),n(22),n(23);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var a=n(67),s=n(1),l=function(e){function t(t,n){var r=e.call(this,t)||this;if(r._writerOptions=s.applyDefaults(n,{wellFormed:!1,indent:"  ",newline:"\n",offset:0,group:!1,verbose:!1}),r._writerOptions.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(r._writerOptions.offset<0)throw new Error("YAML offset should be zero or a positive number.");return r}return i(t,e),t.prototype.serialize=function(e){var t=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),n=new a.ObjectWriter(this._builderOptions,t).serialize(e),r=this._beginLine(this._writerOptions,0)+"---"+this._endLine(this._writerOptions)+this._convertObject(n,this._writerOptions,0);return r.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(r=r.slice(0,-this._writerOptions.newline.length)),r},t.prototype._convertObject=function(e,t,n,r){var i,a,l=this;void 0===r&&(r=!1);var c="";if(s.isArray(e))try{for(var u=o(e),d=u.next();!d.done;d=u.next()){var p=d.value;c+=this._beginLine(t,n,!0),s.isObject(p)?s.isEmpty(p)?c+='""'+this._endLine(t):c+=this._convertObject(p,t,n,!0):c+=this._val(p)+this._endLine(t)}}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}else s.forEachObject(e,function(e,i){r?(c+=l._key(e),r=!1):c+=l._beginLine(t,n)+l._key(e),s.isObject(i)?s.isEmpty(i)?c+=' ""'+l._endLine(t):c+=l._endLine(t)+l._convertObject(i,t,n+1):c+=" "+l._val(i)+l._endLine(t)},this);return c},t.prototype._beginLine=function(e,t,n){void 0===n&&(n=!1);var r=e.offset+t+1,i=new Array(r).join(e.indent);return n?i.substr(0,i.length-2)+"-"+i.substr(-1,1):i},t.prototype._endLine=function(e){return e.newline},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t}(n(50).BaseWriter);t.YAMLWriter=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(110).dom.setFeatures(!0);var r=n(110);t.DOMImplementation=r.DOMImplementation;var i=n(271);t.DOMParser=i.DOMParser;var o=n(274);t.XMLSerializer=o.XMLSerializer},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(0),o=function(){function e(){}return e.prototype.before=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r.Cast.asNode(this),o=n._parent;if(null!==o){for(var a=n._previousSibling,s=!0;s&&a;){s=!1;for(var l=0;l<e.length;l++)if(e[l]===a){a=a._previousSibling,s=!0;break}}var c=i.parentNode_convertNodesIntoANode(e,n._nodeDocument);a=null===a?o._firstChild:a._nextSibling,i.mutation_preInsert(c,o,a)}},e.prototype.after=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r.Cast.asNode(this),o=n._parent;if(o){for(var a=n._nextSibling,s=!0;s&&a;){s=!1;for(var l=0;l<e.length;l++)if(e[l]===a){a=a._nextSibling,s=!0;break}}var c=i.parentNode_convertNodesIntoANode(e,n._nodeDocument);i.mutation_preInsert(c,o,a)}},e.prototype.replaceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=r.Cast.asNode(this),o=n._parent;if(o){for(var a=n._nextSibling,s=!0;s&&a;){s=!1;for(var l=0;l<e.length;l++)if(e[l]===a){a=a._nextSibling,s=!0;break}}var c=i.parentNode_convertNodesIntoANode(e,n._nodeDocument);n._parent===o?i.mutation_replace(n,c,o):i.mutation_preInsert(c,o,a)}},e.prototype.remove=function(){var e=r.Cast.asNode(this),t=e._parent;t&&i.mutation_remove(e,t)},e}();t.ChildNodeImpl=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.DocumentOrShadowRootImpl=r},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(3),a=n(7),s=function(){function e(e){this._nodeList=[],this._recordQueue=[],this._callback=e;var t=i.dom.window;a.set.append(t._mutationObservers,this)}return e.prototype.observe=function(e,t){var n,i;if(void 0===(t=t||{childList:!1,subtree:!1}).attributeOldValue&&void 0===t.attributeFilter||void 0!==t.attributes||(t.attributes=!0),void 0!==t.characterDataOldValue&&void 0===t.characterData&&(t.characterData=!0),!t.childList&&!t.attributes&&!t.characterData)throw new TypeError;if(t.attributeOldValue&&!t.attributes)throw new TypeError;if(void 0!==t.attributeFilter&&!t.attributes)throw new TypeError;if(t.characterDataOldValue&&!t.characterData)throw new TypeError;var s=!1,l=t,c=function(e){var t,n;if(e.observer===u){s=!0;try{for(var i=(t=void 0,r(u._nodeList)),c=i.next();!c.done;c=i.next()){var d=c.value;a.list.remove(d._registeredObserverList,function(t){return o.Guard.isTransientRegisteredObserver(t)&&t.source===e})}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.options=l}},u=this;try{for(var d=r(e._registeredObserverList),p=d.next();!p.done;p=d.next())c(p.value)}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}s||(e._registeredObserverList.push({observer:this,options:t}),this._nodeList.push(e))},e.prototype.disconnect=function(){var e,t,n=this;try{for(var i=r(this._nodeList),o=i.next();!o.done;o=i.next()){var s=o.value;a.list.remove(s._registeredObserverList,function(e){return e.observer===n})}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this._recordQueue=[]},e.prototype.takeRecords=function(){var e=this._recordQueue;return this._recordQueue=[],e},e}();t.MutationObserverImpl=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(){function e(){}return Object.defineProperty(e.prototype,"previousElementSibling",{get:function(){for(var e=r.Cast.asNode(this)._previousSibling;e;){if(r.Guard.isElementNode(e))return e;e=e._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextElementSibling",{get:function(){for(var e=r.Cast.asNode(this)._nextSibling;e;){if(r.Guard.isElementNode(e))return e;e=e._nextSibling}return null},enumerable:!0,configurable:!0}),e}();t.NonDocumentTypeChildNodeImpl=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(0),o=function(){function e(){}return e.prototype.getElementById=function(e){for(var t=i.tree_getFirstDescendantNode(r.Cast.asNode(this),!1,!1,function(e){return r.Guard.isElementNode(e)});null!==t;){if(t._uniqueIdentifier===e)return t;t=i.tree_getNextDescendantNode(r.Cast.asNode(this),t,!1,!1,function(e){return r.Guard.isElementNode(e)})}return null},e}();t.NonElementParentNodeImpl=o},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(0),a=function(){function e(){}return Object.defineProperty(e.prototype,"children",{get:function(){return o.create_htmlCollection(i.Cast.asNode(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstElementChild",{get:function(){for(var e=i.Cast.asNode(this)._firstChild;e;){if(i.Guard.isElementNode(e))return e;e=e._nextSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastElementChild",{get:function(){for(var e=i.Cast.asNode(this)._lastChild;e;){if(i.Guard.isElementNode(e))return e;e=e._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childElementCount",{get:function(){var e,t,n=0;try{for(var o=r(i.Cast.asNode(this)._children),a=o.next();!a.done;a=o.next()){var s=a.value;i.Guard.isElementNode(s)&&n++}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),e.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=i.Cast.asNode(this),r=o.parentNode_convertNodesIntoANode(e,n._nodeDocument);o.mutation_preInsert(r,n,n._firstChild)},e.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=i.Cast.asNode(this),r=o.parentNode_convertNodesIntoANode(e,n._nodeDocument);o.mutation_append(r,n)},e.prototype.querySelector=function(e){var t=i.Cast.asNode(this),n=o.selectors_scopeMatchASelectorsString(e,t);return 0===n.length?null:n[0]},e.prototype.querySelectorAll=function(e){var t=i.Cast.asNode(this),n=o.selectors_scopeMatchASelectorsString(e,t);return o.create_nodeListStatic(t,n)},e}();t.ParentNodeImpl=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){}return Object.defineProperty(e.prototype,"_name",{get:function(){return this.__name||""},set:function(e){this.__name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_assignedSlot",{get:function(){return this.__assignedSlot||null},set:function(e){this.__assignedSlot=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assignedSlot",{get:function(){return r.shadowTree_findASlot(this,!0)},enumerable:!0,configurable:!0}),e}();t.SlotableImpl=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(102),a=n(9),s=n(3),l=function(e){function t(t){var n=e.call(this)||this;if(s.Guard.isDocumentTypeNode(t.startContainer)||s.Guard.isAttrNode(t.startContainer)||s.Guard.isDocumentTypeNode(t.endContainer)||s.Guard.isAttrNode(t.endContainer))throw new a.InvalidNodeTypeError;return n._start=[t.startContainer,t.startOffset],n._end=[t.endContainer,t.endOffset],n}return i(t,e),t}(o.AbstractRangeImpl);t.StaticRangeImpl=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(272);t.DOMParser=r.DOMParserImpl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(273),o=function(){function e(){}return e.prototype.parseFromString=function(e,t){if("text/html"===t)throw new Error("HTML parser not implemented.");try{return(n=(new i.XMLParserImpl).parse(e))._contentType=t,n}catch(e){var n,o="http://www.mozilla.org/newlayout/xml/parsererror.xml",a=(n=r.create_xmlDocument()).createElementNS(o,"parsererror"),s=n.createElementNS(o,"error");return s.setAttribute("message",e.message),a.appendChild(s),n.appendChild(a),n}},e}();t.DOMParserImpl=o},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(180),a=n(111),s=n(7),l=n(0),c=n(69),u=function(){function e(){}return e.prototype.parse=function(e){for(var t,n,u,d,p=new o.XMLStringLexer(e,{skipWhitespaceOnlyText:!0}),h=l.create_document(),f=h,m=p.nextToken();m.type!==a.TokenType.EOF;){switch(m.type){case a.TokenType.Declaration:var g=m;if("1.0"!==g.version)throw new Error("Invalid xml version: "+g.version);break;case a.TokenType.DocType:var v=m;if(!l.xml_isPubidChar(v.pubId))throw new Error("DocType public identifier does not match PubidChar construct.");if(!l.xml_isLegalChar(v.sysId)||-1!==v.sysId.indexOf('"')&&-1!==v.sysId.indexOf("'"))throw new Error("DocType system identifier contains invalid characters.");f.appendChild(h.implementation.createDocumentType(v.name,v.pubId,v.sysId));break;case a.TokenType.CDATA:var y=m;if(!l.xml_isLegalChar(y.data)||-1!==y.data.indexOf("]]>"))throw new Error("CDATA contains invalid characters.");f.appendChild(h.createCDATASection(y.data));break;case a.TokenType.Comment:var b=m;if(!l.xml_isLegalChar(b.data)||-1!==b.data.indexOf("--")||b.data.endsWith("-"))throw new Error("Comment data contains invalid characters.");f.appendChild(h.createComment(b.data));break;case a.TokenType.PI:var C=m;if(-1!==C.target.indexOf(":")||/^xml$/i.test(C.target))throw new Error("Processing instruction target contains invalid characters.");if(!l.xml_isLegalChar(C.data)||-1!==C.data.indexOf("?>"))throw new Error("Processing instruction data contains invalid characters.");f.appendChild(h.createProcessingInstruction(C.target,C.data));break;case a.TokenType.Text:var w=m;if(!l.xml_isLegalChar(w.data))throw new Error("Text data contains invalid characters.");f.appendChild(h.createTextNode(this._decodeText(w.data)));break;case a.TokenType.Element:var E=m,T=r(l.namespace_extractQName(E.name),2),x=T[0],_=T[1];if(-1!==_.indexOf(":")||!l.xml_isName(_))throw new Error("Node local name contains invalid characters.");if("xmlns"===x)throw new Error("An element cannot have the 'xmlns' prefix.");var S=f.lookupNamespaceURI(x),I={};try{for(var D=(t=void 0,i(E.attributes)),A=D.next();!A.done;A=D.next()){var P=r(A.value,2),O=P[0],R=P[1];if("xmlns"===O)S=R;else{var M=r(l.namespace_extractQName(O),2),N=M[0],L=M[1];"xmlns"===N&&(L===x&&(S=R),I[L]=R)}}}catch(e){t={error:e}}finally{try{A&&!A.done&&(n=D.return)&&n.call(D)}finally{if(t)throw t.error}}var k=null!==S?h.createElementNS(S,E.name):h.createElement(E.name);f.appendChild(k);var F=new c.LocalNameSet;try{for(var V=(u=void 0,i(E.attributes)),U=V.next();!U.done;U=V.next()){var B=r(U.value,2),G=(O=B[0],R=B[1],r(l.namespace_extractQName(O),2)),W=(N=G[0],L=G[1],null);if("xmlns"===N||null===N&&"xmlns"===L?W=s.namespace.XMLNS:null!==(W=k.lookupNamespaceURI(N))&&k.isDefaultNamespace(W)?W=null:null===W&&null!==N&&(W=I[N]||null),F.has(W,L))throw new Error("Element contains duplicate attributes.");if(F.set(W,L),W===s.namespace.XMLNS&&R===s.namespace.XMLNS)throw new Error("XMLNS namespace is reserved.");if(-1!==L.indexOf(":")||!l.xml_isName(L))throw new Error("Attribute local name contains invalid characters.");if("xmlns"===N&&""===R)throw new Error("Empty XML namespace is not allowed.");null!==W?k.setAttributeNS(W,O,this._decodeAttributeValue(R)):k.setAttribute(O,this._decodeAttributeValue(R))}}catch(e){u={error:e}}finally{try{U&&!U.done&&(d=V.return)&&d.call(V)}finally{if(u)throw u.error}}E.selfClosing||(f=k);break;case a.TokenType.ClosingTag:if(m.name!==f.nodeName)throw new Error("Closing tag name does not match opening tag name.");f._parent&&(f=f._parent)}m=p.nextToken()}return h},e.prototype._decodeText=function(e){return null==e?e:e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},e.prototype._decodeAttributeValue=function(e){return null==e?e:e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},e}();t.XMLParserImpl=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(275);t.XMLSerializer=r.XMLSerializerImpl},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(69),a=n(95),s=n(9),l=n(7),c=n(0),u=function(){function e(){}return e.prototype.serializeToString=function(e){return this._xmlSerialization(e,!1)},e.prototype._xmlSerialization=function(e,t){if(void 0===e._nodeDocument||e._nodeDocument._hasNamespaces){var n=new a.NamespacePrefixMap;n.set("xml",l.namespace.XML);try{return this._serializeNodeNS(e,null,n,{value:1},t)}catch(e){throw new s.InvalidStateError}}else try{return this._serializeNode(e,t)}catch(e){throw new s.InvalidStateError}},e.prototype._serializeNodeNS=function(e,t,n,r,o){switch(e.nodeType){case i.NodeType.Element:return this._serializeElementNS(e,t,n,r,o);case i.NodeType.Document:return this._serializeDocumentNS(e,t,n,r,o);case i.NodeType.Comment:return this._serializeComment(e,o);case i.NodeType.Text:return this._serializeText(e,o);case i.NodeType.DocumentFragment:return this._serializeDocumentFragmentNS(e,t,n,r,o);case i.NodeType.DocumentType:return this._serializeDocumentType(e,o);case i.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(e,o);case i.NodeType.CData:return this._serializeCData(e,o);default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeNode=function(e,t){switch(e.nodeType){case i.NodeType.Element:return this._serializeElement(e,t);case i.NodeType.Document:return this._serializeDocument(e,t);case i.NodeType.Comment:return this._serializeComment(e,t);case i.NodeType.Text:return this._serializeText(e,t);case i.NodeType.DocumentFragment:return this._serializeDocumentFragment(e,t);case i.NodeType.DocumentType:return this._serializeDocumentType(e,t);case i.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(e,t);case i.NodeType.CData:return this._serializeCData(e,t);default:throw new Error("Unknown node type: "+e.nodeType)}},e.prototype._serializeElementNS=function(t,n,i,o,a){var s,u;if(a&&(-1!==t.localName.indexOf(":")||!c.xml_isName(t.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var d="<",p="",h=!1,f=!1,m=i.copy(),g={},v=this._recordNamespaceInformation(t,m,g),y=n,b=t.namespaceURI;if(y===b)null!==v&&(f=!0),d+=p=b===l.namespace.XML?"xml:"+t.localName:t.localName;else{var C=t.prefix,w=null;if(null===C&&b===v||(w=m.get(C,b)),"xmlns"===C){if(a)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");w=C}null!==w?(p=w+":"+t.localName,null!==v&&v!==l.namespace.XML&&(y=v||null),d+=p):null!==C?(C in g&&(C=this._generatePrefix(b,m,o)),m.set(C,b),d+=p+=C+":"+t.localName,d+=" xmlns:"+C+'="'+this._serializeAttributeValue(b,a)+'"',null!==v&&(y=v||null)):null===v||null!==v&&v!==b?(f=!0,y=b,d+=p+=t.localName,d+=' xmlns="'+this._serializeAttributeValue(b,a)+'"'):(y=b,d+=p+=t.localName)}d+=this._serializeAttributesNS(t,m,o,g,f,a);var E=b===l.namespace.HTML;if(E&&0===t.childNodes.length&&e._VoidElementNames.has(t.localName)?(d+=" /",h=!0):E||0!==t.childNodes.length||(d+="/",h=!0),d+=">",h)return d;if(E&&"template"===t.localName);else try{for(var T=r(t._children||t.childNodes),x=T.next();!x.done;x=T.next()){var _=x.value;d+=this._serializeNodeNS(_,y,m,o,a)}}catch(e){s={error:e}}finally{try{x&&!x.done&&(u=T.return)&&u.call(T)}finally{if(s)throw s.error}}return d+"</"+p+">"},e.prototype._serializeDocumentNS=function(e,t,n,i,o){var a,s;if(o&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");var l="";try{for(var c=r(e._children||e.childNodes),u=c.next();!u.done;u=c.next()){var d=u.value;l+=this._serializeNodeNS(d,t,n,i,o)}}catch(e){a={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}return l},e.prototype._serializeComment=function(e,t){if(t&&(!c.xml_isLegalChar(e.data)||-1!==e.data.indexOf("--")||e.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");return"\x3c!--"+e.data+"--\x3e"},e.prototype._serializeText=function(e,t){if(t&&!c.xml_isLegalChar(e.data))throw new Error("Text data contains invalid characters (well-formed required).");for(var n="",r=0;r<e.data.length;r++){var i=e.data[r];n+="&"===i?"&amp;":"<"===i?"&lt;":">"===i?"&gt;":i}return n},e.prototype._serializeDocumentFragmentNS=function(e,t,n,i,o){var a,s,l="";try{for(var c=r(e._children||e.childNodes),u=c.next();!u.done;u=c.next()){var d=u.value;l+=this._serializeNodeNS(d,t,n,i,o)}}catch(e){a={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}return l},e.prototype._serializeDocumentType=function(e,t){if(t&&!c.xml_isPubidChar(e.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(t&&(!c.xml_isLegalChar(e.systemId)||-1!==e.systemId.indexOf('"')&&-1!==e.systemId.indexOf("'")))throw new Error("DocType system identifier contains invalid characters (well-formed required).");return e.publicId&&e.systemId?"<!DOCTYPE "+e.name+' PUBLIC "'+e.publicId+'" "'+e.systemId+'">':e.publicId?"<!DOCTYPE "+e.name+' PUBLIC "'+e.publicId+'">':e.systemId?"<!DOCTYPE "+e.name+' SYSTEM "'+e.systemId+'">':"<!DOCTYPE "+e.name+">"},e.prototype._serializeProcessingInstruction=function(e,t){if(t&&(-1!==e.target.indexOf(":")||/^xml$/i.test(e.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(t&&(!c.xml_isLegalChar(e.data)||-1!==e.data.indexOf("?>")))throw new Error("Processing instruction data contains invalid characters (well-formed required).");return"<?"+(""===e.data?e.target:e.target+" "+e.data)+"?>"},e.prototype._serializeCData=function(e,t){if(t&&-1!==e.data.indexOf("]]>"))throw new Error("CDATA contains invalid characters (well-formed required).");return"<![CDATA["+e.data+"]]>"},e.prototype._serializeAttributesNS=function(e,t,n,i,a,s){var u,d,p="",h=s?new o.LocalNameSet:void 0;try{for(var f=r(e.attributes),m=f.next();!m.done;m=f.next()){var g=m.value;if(a||s||null!==g.namespaceURI){if(s&&h&&h.has(g.namespaceURI,g.localName))throw new Error("Element contains duplicate attributes (well-formed required).");s&&h&&h.set(g.namespaceURI,g.localName);var v=g.namespaceURI,y=null;if(null!==v)if(y=t.get(g.prefix,v),v===l.namespace.XMLNS){if(g.value===l.namespace.XML||null===g.prefix&&a||null!==g.prefix&&(!(g.localName in i)||i[g.localName]!==g.value)&&t.has(g.localName,g.value))continue;if(s&&g.value===l.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(s&&""===g.value)throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");"xmlns"===g.prefix&&(y="xmlns")}else null===y&&(p+=" xmlns:"+(y=null===g.prefix||t.hasPrefix(g.prefix)&&!t.has(g.prefix,v)?this._generatePrefix(v,t,n):g.prefix)+'="'+this._serializeAttributeValue(v,s)+'"');if(p+=" ",null!==y&&(p+=y+":"),s&&(-1!==g.localName.indexOf(":")||!c.xml_isName(g.localName)||"xmlns"===g.localName&&null===v))throw new Error("Attribute local name contains invalid characters (well-formed required).");p+=g.localName+'="'+this._serializeAttributeValue(g.value,s)+'"'}else p+=" "+g.localName+'="'+this._serializeAttributeValue(g.value,s)+'"'}}catch(e){u={error:e}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(u)throw u.error}}return p},e.prototype._recordNamespaceInformation=function(e,t,n){var i,o,a=null;try{for(var s=r(e.attributes),c=s.next();!c.done;c=s.next()){var u=c.value,d=u.namespaceURI,p=u.prefix;if(d===l.namespace.XMLNS){if(null===p){a=u.value;continue}var h=u.localName,f=u.value;if(f===l.namespace.XML)continue;if(""===f&&(f=null),t.has(h,f))continue;t.set(h,f),n[h]=f||""}}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a},e.prototype._generatePrefix=function(e,t,n){var r="ns"+n.value;return n.value++,t.set(r,e),r},e.prototype._serializeAttributeValue=function(e,t){if(t&&null!==e&&!c.xml_isLegalChar(e))throw new Error("Invalid characters in attribute value.");if(null===e)return"";for(var n="",r=0;r<e.length;r++){var i=e[r];n+='"'===i?"&quot;":"&"===i?"&amp;":"<"===i?"&lt;":">"===i?"&gt;":i}return n},e.prototype._serializeElement=function(e,t){var n,i;if(t&&(-1!==e.localName.indexOf(":")||!c.xml_isName(e.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var o=!1,a=e.localName,s="<"+a;if(s+=this._serializeAttributes(e,t),0===e._children.size&&(s+="/",o=!0),s+=">",o)return s;try{for(var l=r(e._children),u=l.next();!u.done;u=l.next()){var d=u.value;s+=this._serializeNode(d,t)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return s+"</"+a+">"},e.prototype._serializeDocument=function(e,t){var n,i;if(t&&null===e.documentElement)throw new Error("Missing document element (well-formed required).");var o="";try{for(var a=r(e._children),s=a.next();!s.done;s=a.next()){var l=s.value;o+=this._serializeNode(l,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},e.prototype._serializeDocumentFragment=function(e,t){var n,i,o="";try{for(var a=r(e._children),s=a.next();!s.done;s=a.next()){var l=s.value;o+=this._serializeNode(l,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},e.prototype._serializeAttributes=function(e,t){var n,i,o="",a=t?{}:void 0;try{for(var s=r(e.attributes),l=s.next();!l.done;l=s.next()){var u=l.value;if(t&&a&&u.localName in a)throw new Error("Element contains duplicate attributes (well-formed required).");if(t&&a&&(a[u.localName]=!0),t&&(-1!==u.localName.indexOf(":")||!c.xml_isName(u.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");o+=" "+u.localName+'="'+this._serializeAttributeValue(u.value,t)+'"'}}catch(e){n={error:e}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},e._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),e}();t.XMLSerializerImpl=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(277);t.XMLReader=r.XMLReader;var i=n(112);t.ObjectReader=i.ObjectReader;var o=n(280);t.JSONReader=o.JSONReader;var a=n(281);t.YAMLReader=a.YAMLReader},function(e,t,n){"use strict";n(31),n(32),n(33),n(19),n(65),n(20),n(22),n(23);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s=n(180),l=n(111),c=n(7),u=n(0),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._parse=function(e,t){for(var n,r,i,d,p=new s.XMLStringLexer(t,{skipWhitespaceOnlyText:!0}),h=e,f=e,m=p.nextToken();m.type!==l.TokenType.EOF;){switch(m.type){case l.TokenType.Declaration:var g=m,v=this.sanitize(g.version);if("1.0"!==v)throw new Error("Invalid xml version: "+v);var y={version:v};g.encoding&&(y.encoding=this.sanitize(g.encoding)),g.standalone&&(y.standalone="yes"===this.sanitize(g.standalone)),f.set(y);break;case l.TokenType.DocType:var b=m;f=this.docType(f,this.sanitize(b.name),this.sanitize(b.pubId),this.sanitize(b.sysId))||f;break;case l.TokenType.CDATA:var C=m;f=this.cdata(f,this.sanitize(C.data))||f;break;case l.TokenType.Comment:var w=m;f=this.comment(f,this.sanitize(w.data))||f;break;case l.TokenType.PI:var E=m;f=this.instruction(f,this.sanitize(E.target),this.sanitize(E.data))||f;break;case l.TokenType.Text:var T=m;f=this.text(f,this._decodeText(this.sanitize(T.data)))||f;break;case l.TokenType.Element:var x=m,_=this.sanitize(x.name),S=o(u.namespace_extractQName(_),1)[0],I=f.node.lookupNamespaceURI(S),D={};try{for(var A=(n=void 0,a(x.attributes)),P=A.next();!P.done;P=A.next()){var O=o(P.value,2),R=O[0],M=O[1];if(R=this.sanitize(R),M=this.sanitize(M),"xmlns"===R)I=M;else{var N=o(u.namespace_extractQName(R),2),L=N[0],k=N[1];"xmlns"===L&&(k===S&&(I=M),D[k]=M)}}}catch(e){n={error:e}}finally{try{P&&!P.done&&(r=A.return)&&r.call(A)}finally{if(n)throw n.error}}var F=null!==I?this.element(f,I,_):this.element(f,void 0,_);if(void 0===F)break;f.node===e.node&&(h=F);try{for(var V=(i=void 0,a(x.attributes)),U=V.next();!U.done;U=V.next()){var B=o(U.value,2);R=B[0],M=B[1],R=this.sanitize(R),M=this.sanitize(M);var G=o(u.namespace_extractQName(R),2),W=(L=G[0],k=G[1],null);"xmlns"===L||null===L&&"xmlns"===k?W=c.namespace.XMLNS:null!==(W=F.node.lookupNamespaceURI(L))&&F.node.isDefaultNamespace(W)?W=null:null===W&&null!==L&&(W=D[L]||null),null!==W?this.attribute(F,W,R,this._decodeAttributeValue(M)):this.attribute(F,void 0,R,this._decodeAttributeValue(M))}}catch(e){i={error:e}}finally{try{U&&!U.done&&(d=V.return)&&d.call(V)}finally{if(i)throw i.error}}x.selfClosing||(f=F);break;case l.TokenType.ClosingTag:f.node.parentNode&&(f=f.up())}m=p.nextToken()}return h},t}(n(75).BaseReader);t.XMLReader=d},function(e,t,n){var r=n(4),i=n(279);r({target:"Object",stat:!0,forced:Object.assign!==i},{assign:i})},function(e,t,n){"use strict";var r=n(16),i=n(8),o=n(61),a=n(85),s=n(79),l=n(27),c=n(41),u=Object.assign,d=Object.defineProperty;e.exports=!u||i(function(){if(r&&1!==u({b:1},u(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||"abcdefghijklmnopqrst"!=o(u({},t)).join("")})?function(e,t){for(var n=l(e),i=arguments.length,u=1,d=a.f,p=s.f;i>u;)for(var h,f=c(arguments[u++]),m=d?o(f).concat(d(f)):o(f),g=m.length,v=0;g>v;)h=m[v++],r&&!p.call(f,h)||(n[h]=f[h]);return n}:u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(112),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._parse=function(e,t){return new o.ObjectReader(this._builderOptions).parse(e,JSON.parse(t))},t}(n(75).BaseReader);t.JSONReader=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(112),a=n(75),s=n(282),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._parse=function(e,t){var n=s.safeLoad(t);if(void 0===n)throw new Error("Unable to parse YAML document.");return new o.ObjectReader(this._builderOptions).parse(e,n)},t}(a.BaseReader);t.YAMLReader=l},function(e,t,n){"use strict";var r=n(283);e.exports=r},function(e,t,n){"use strict";var r=n(284),i=n(303);function o(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}e.exports.Type=n(10),e.exports.Schema=n(39),e.exports.FAILSAFE_SCHEMA=n(113),e.exports.JSON_SCHEMA=n(182),e.exports.CORE_SCHEMA=n(181),e.exports.DEFAULT_SAFE_SCHEMA=n(54),e.exports.DEFAULT_FULL_SCHEMA=n(76),e.exports.load=r.load,e.exports.loadAll=r.loadAll,e.exports.safeLoad=r.safeLoad,e.exports.safeLoadAll=r.safeLoadAll,e.exports.dump=i.dump,e.exports.safeDump=i.safeDump,e.exports.YAMLException=n(53),e.exports.MINIMAL_SCHEMA=n(113),e.exports.SAFE_SCHEMA=n(54),e.exports.DEFAULT_SCHEMA=n(76),e.exports.scan=o("scan"),e.exports.parse=o("parse"),e.exports.compose=o("compose"),e.exports.addConstructor=o("addConstructor")},function(e,t,n){"use strict";var r=n(38),i=n(53),o=n(285),a=n(54),s=n(76),l=Object.prototype.hasOwnProperty,c=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,u=/[\x85\u2028\u2029]/,d=/[,\[\]\{\}]/,p=/^(?:!|!!|![a-z\-]+!)$/i,h=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function f(e){return Object.prototype.toString.call(e)}function m(e){return 10===e||13===e}function g(e){return 9===e||32===e}function v(e){return 9===e||32===e||10===e||13===e}function y(e){return 44===e||91===e||93===e||123===e||125===e}function b(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function C(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?"":76===e?"\u2028":80===e?"\u2029":""}function w(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var E=new Array(256),T=new Array(256),x=0;x<256;x++)E[x]=C(x)?1:0,T[x]=C(x);function _(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||s,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function S(e,t){return new i(t,new o(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function I(e,t){throw S(e,t)}function D(e,t){e.onWarning&&e.onWarning.call(null,S(e,t))}var A={YAML:function(e,t,n){var r,i,o;null!==e.version&&I(e,"duplication of %YAML directive"),1!==n.length&&I(e,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&I(e,"ill-formed argument of the YAML directive"),i=parseInt(r[1],10),o=parseInt(r[2],10),1!==i&&I(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=o<2,1!==o&&2!==o&&D(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var r,i;2!==n.length&&I(e,"TAG directive accepts exactly two arguments"),r=n[0],i=n[1],p.test(r)||I(e,"ill-formed tag handle (first argument) of the TAG directive"),l.call(e.tagMap,r)&&I(e,'there is a previously declared suffix for "'+r+'" tag handle'),h.test(i)||I(e,"ill-formed tag prefix (second argument) of the TAG directive"),e.tagMap[r]=i}};function P(e,t,n,r){var i,o,a,s;if(t<n){if(s=e.input.slice(t,n),r)for(i=0,o=s.length;i<o;i+=1)9===(a=s.charCodeAt(i))||32<=a&&a<=1114111||I(e,"expected valid JSON character");else c.test(s)&&I(e,"the stream contains non-printable characters");e.result+=s}}function O(e,t,n,i){var o,a,s,c;for(r.isObject(n)||I(e,"cannot merge mappings; the provided source object is unacceptable"),s=0,c=(o=Object.keys(n)).length;s<c;s+=1)a=o[s],l.call(t,a)||(t[a]=n[a],i[a]=!0)}function R(e,t,n,r,i,o,a,s){var c,u;if(Array.isArray(i))for(c=0,u=(i=Array.prototype.slice.call(i)).length;c<u;c+=1)Array.isArray(i[c])&&I(e,"nested arrays are not supported inside keys"),"object"==typeof i&&"[object Object]"===f(i[c])&&(i[c]="[object Object]");if("object"==typeof i&&"[object Object]"===f(i)&&(i="[object Object]"),i=String(i),null===t&&(t={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(o))for(c=0,u=o.length;c<u;c+=1)O(e,t,o[c],n);else O(e,t,o,n);else e.json||l.call(n,i)||!l.call(t,i)||(e.line=a||e.line,e.position=s||e.position,I(e,"duplicated mapping key")),t[i]=o,delete n[i];return t}function M(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):I(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function N(e,t,n){for(var r=0,i=e.input.charCodeAt(e.position);0!==i;){for(;g(i);)i=e.input.charCodeAt(++e.position);if(t&&35===i)do{i=e.input.charCodeAt(++e.position)}while(10!==i&&13!==i&&0!==i);if(!m(i))break;for(M(e),i=e.input.charCodeAt(e.position),r++,e.lineIndent=0;32===i;)e.lineIndent++,i=e.input.charCodeAt(++e.position)}return-1!==n&&0!==r&&e.lineIndent<n&&D(e,"deficient indentation"),r}function L(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!v(t)))}function k(e,t){1===t?e.result+=" ":t>1&&(e.result+=r.repeat("\n",t-1))}function F(e,t){var n,r,i=e.tag,o=e.anchor,a=[],s=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=a),r=e.input.charCodeAt(e.position);0!==r&&45===r&&v(e.input.charCodeAt(e.position+1));)if(s=!0,e.position++,N(e,!0,-1)&&e.lineIndent<=t)a.push(null),r=e.input.charCodeAt(e.position);else if(n=e.line,B(e,t,3,!1,!0),a.push(e.result),N(e,!0,-1),r=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==r)I(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!s&&(e.tag=i,e.anchor=o,e.kind="sequence",e.result=a,!0)}function V(e){var t,n,r,i,o=!1,a=!1;if(33!==(i=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&I(e,"duplication of a tag property"),60===(i=e.input.charCodeAt(++e.position))?(o=!0,i=e.input.charCodeAt(++e.position)):33===i?(a=!0,n="!!",i=e.input.charCodeAt(++e.position)):n="!",t=e.position,o){do{i=e.input.charCodeAt(++e.position)}while(0!==i&&62!==i);e.position<e.length?(r=e.input.slice(t,e.position),i=e.input.charCodeAt(++e.position)):I(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==i&&!v(i);)33===i&&(a?I(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),p.test(n)||I(e,"named tag handle cannot contain such characters"),a=!0,t=e.position+1)),i=e.input.charCodeAt(++e.position);r=e.input.slice(t,e.position),d.test(r)&&I(e,"tag suffix cannot contain flow indicator characters")}return r&&!h.test(r)&&I(e,"tag name cannot contain such characters: "+r),o?e.tag=r:l.call(e.tagMap,n)?e.tag=e.tagMap[n]+r:"!"===n?e.tag="!"+r:"!!"===n?e.tag="tag:yaml.org,2002:"+r:I(e,'undeclared tag handle "'+n+'"'),!0}function U(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&I(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!v(n)&&!y(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&I(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function B(e,t,n,i,o){var a,s,c,u,d,p,h,f,C=1,x=!1,_=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=s=c=4===n||3===n,i&&N(e,!0,-1)&&(x=!0,e.lineIndent>t?C=1:e.lineIndent===t?C=0:e.lineIndent<t&&(C=-1)),1===C)for(;V(e)||U(e);)N(e,!0,-1)?(x=!0,c=a,e.lineIndent>t?C=1:e.lineIndent===t?C=0:e.lineIndent<t&&(C=-1)):c=!1;if(c&&(c=x||o),1!==C&&4!==n||(h=1===n||2===n?t:t+1,f=e.position-e.lineStart,1===C?c&&(F(e,f)||function(e,t,n){var r,i,o,a,s,l=e.tag,c=e.anchor,u={},d={},p=null,h=null,f=null,m=!1,y=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=u),s=e.input.charCodeAt(e.position);0!==s;){if(r=e.input.charCodeAt(e.position+1),o=e.line,a=e.position,63!==s&&58!==s||!v(r)){if(!B(e,n,2,!1,!0))break;if(e.line===o){for(s=e.input.charCodeAt(e.position);g(s);)s=e.input.charCodeAt(++e.position);if(58===s)v(s=e.input.charCodeAt(++e.position))||I(e,"a whitespace character is expected after the key-value separator within a block mapping"),m&&(R(e,u,d,p,h,null),p=h=f=null),y=!0,m=!1,i=!1,p=e.tag,h=e.result;else{if(!y)return e.tag=l,e.anchor=c,!0;I(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return e.tag=l,e.anchor=c,!0;I(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===s?(m&&(R(e,u,d,p,h,null),p=h=f=null),y=!0,m=!0,i=!0):m?(m=!1,i=!0):I(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,s=r;if((e.line===o||e.lineIndent>t)&&(B(e,t,4,!0,i)&&(m?h=e.result:f=e.result),m||(R(e,u,d,p,h,f,o,a),p=h=f=null),N(e,!0,-1),s=e.input.charCodeAt(e.position)),e.lineIndent>t&&0!==s)I(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return m&&R(e,u,d,p,h,null),y&&(e.tag=l,e.anchor=c,e.kind="mapping",e.result=u),y}(e,f,h))||function(e,t){var n,r,i,o,a,s,l,c,u,d,p=!0,h=e.tag,f=e.anchor,m={};if(91===(d=e.input.charCodeAt(e.position)))i=93,s=!1,r=[];else{if(123!==d)return!1;i=125,s=!0,r={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=r),d=e.input.charCodeAt(++e.position);0!==d;){if(N(e,!0,t),(d=e.input.charCodeAt(e.position))===i)return e.position++,e.tag=h,e.anchor=f,e.kind=s?"mapping":"sequence",e.result=r,!0;p||I(e,"missed comma between flow collection entries"),u=null,o=a=!1,63===d&&v(e.input.charCodeAt(e.position+1))&&(o=a=!0,e.position++,N(e,!0,t)),n=e.line,B(e,t,1,!1,!0),c=e.tag,l=e.result,N(e,!0,t),d=e.input.charCodeAt(e.position),!a&&e.line!==n||58!==d||(o=!0,d=e.input.charCodeAt(++e.position),N(e,!0,t),B(e,t,1,!1,!0),u=e.result),s?R(e,r,m,c,l,u):o?r.push(R(e,null,m,c,l,u)):r.push(l),N(e,!0,t),44===(d=e.input.charCodeAt(e.position))?(p=!0,d=e.input.charCodeAt(++e.position)):p=!1}I(e,"unexpected end of the stream within a flow collection")}(e,h)?_=!0:(s&&function(e,t){var n,i,o,a,s,l=1,c=!1,u=!1,d=t,p=0,h=!1;if(124===(a=e.input.charCodeAt(e.position)))i=!1;else{if(62!==a)return!1;i=!0}for(e.kind="scalar",e.result="";0!==a;)if(43===(a=e.input.charCodeAt(++e.position))||45===a)1===l?l=43===a?3:2:I(e,"repeat of a chomping mode identifier");else{if(!((o=48<=(s=a)&&s<=57?s-48:-1)>=0))break;0===o?I(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?I(e,"repeat of an indentation width identifier"):(d=t+o-1,u=!0)}if(g(a)){do{a=e.input.charCodeAt(++e.position)}while(g(a));if(35===a)do{a=e.input.charCodeAt(++e.position)}while(!m(a)&&0!==a)}for(;0!==a;){for(M(e),e.lineIndent=0,a=e.input.charCodeAt(e.position);(!u||e.lineIndent<d)&&32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position);if(!u&&e.lineIndent>d&&(d=e.lineIndent),m(a))p++;else{if(e.lineIndent<d){3===l?e.result+=r.repeat("\n",c?1+p:p):1===l&&c&&(e.result+="\n");break}for(i?g(a)?(h=!0,e.result+=r.repeat("\n",c?1+p:p)):h?(h=!1,e.result+=r.repeat("\n",p+1)):0===p?c&&(e.result+=" "):e.result+=r.repeat("\n",p):e.result+=r.repeat("\n",c?1+p:p),c=!0,u=!0,p=0,n=e.position;!m(a)&&0!==a;)a=e.input.charCodeAt(++e.position);P(e,n,e.position,!1)}}return!0}(e,h)||function(e,t){var n,r,i;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=i=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(P(e,r,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;r=e.position,e.position++,i=e.position}else m(n)?(P(e,r,i,!0),k(e,N(e,!1,t)),r=i=e.position):e.position===e.lineStart&&L(e)?I(e,"unexpected end of the document within a single quoted scalar"):(e.position++,i=e.position);I(e,"unexpected end of the stream within a single quoted scalar")}(e,h)||function(e,t){var n,r,i,o,a,s,l;if(34!==(s=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=r=e.position;0!==(s=e.input.charCodeAt(e.position));){if(34===s)return P(e,n,e.position,!0),e.position++,!0;if(92===s){if(P(e,n,e.position,!0),m(s=e.input.charCodeAt(++e.position)))N(e,!1,t);else if(s<256&&E[s])e.result+=T[s],e.position++;else if((a=120===(l=s)?2:117===l?4:85===l?8:0)>0){for(i=a,o=0;i>0;i--)(a=b(s=e.input.charCodeAt(++e.position)))>=0?o=(o<<4)+a:I(e,"expected hexadecimal character");e.result+=w(o),e.position++}else I(e,"unknown escape sequence");n=r=e.position}else m(s)?(P(e,n,r,!0),k(e,N(e,!1,t)),n=r=e.position):e.position===e.lineStart&&L(e)?I(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}I(e,"unexpected end of the stream within a double quoted scalar")}(e,h)?_=!0:function(e){var t,n,r;if(42!==(r=e.input.charCodeAt(e.position)))return!1;for(r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!v(r)&&!y(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&I(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),e.anchorMap.hasOwnProperty(n)||I(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],N(e,!0,-1),!0}(e)?(_=!0,null===e.tag&&null===e.anchor||I(e,"alias node should not have any properties")):function(e,t,n){var r,i,o,a,s,l,c,u,d=e.kind,p=e.result;if(v(u=e.input.charCodeAt(e.position))||y(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(v(r=e.input.charCodeAt(e.position+1))||n&&y(r)))return!1;for(e.kind="scalar",e.result="",i=o=e.position,a=!1;0!==u;){if(58===u){if(v(r=e.input.charCodeAt(e.position+1))||n&&y(r))break}else if(35===u){if(v(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&L(e)||n&&y(u))break;if(m(u)){if(s=e.line,l=e.lineStart,c=e.lineIndent,N(e,!1,-1),e.lineIndent>=t){a=!0,u=e.input.charCodeAt(e.position);continue}e.position=o,e.line=s,e.lineStart=l,e.lineIndent=c;break}}a&&(P(e,i,o,!1),k(e,e.line-s),i=o=e.position,a=!1),g(u)||(o=e.position+1),u=e.input.charCodeAt(++e.position)}return P(e,i,o,!1),!!e.result||(e.kind=d,e.result=p,!1)}(e,h,1===n)&&(_=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===C&&(_=c&&F(e,f))),null!==e.tag&&"!"!==e.tag)if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&I(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),u=0,d=e.implicitTypes.length;u<d;u+=1)if((p=e.implicitTypes[u]).resolve(e.result)){e.result=p.construct(e.result),e.tag=p.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else l.call(e.typeMap[e.kind||"fallback"],e.tag)?(p=e.typeMap[e.kind||"fallback"][e.tag],null!==e.result&&p.kind!==e.kind&&I(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+p.kind+'", not "'+e.kind+'"'),p.resolve(e.result)?(e.result=p.construct(e.result),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):I(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):I(e,"unknown tag !<"+e.tag+">");return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||_}function G(e){var t,n,r,i,o=e.position,a=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};0!==(i=e.input.charCodeAt(e.position))&&(N(e,!0,-1),i=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==i));){for(a=!0,i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!v(i);)i=e.input.charCodeAt(++e.position);for(r=[],(n=e.input.slice(t,e.position)).length<1&&I(e,"directive name must not be less than one character in length");0!==i;){for(;g(i);)i=e.input.charCodeAt(++e.position);if(35===i){do{i=e.input.charCodeAt(++e.position)}while(0!==i&&!m(i));break}if(m(i))break;for(t=e.position;0!==i&&!v(i);)i=e.input.charCodeAt(++e.position);r.push(e.input.slice(t,e.position))}0!==i&&M(e),l.call(A,n)?A[n](e,n,r):D(e,'unknown document directive "'+n+'"')}N(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,N(e,!0,-1)):a&&I(e,"directives end mark is expected"),B(e,e.lineIndent-1,4,!1,!0),N(e,!0,-1),e.checkLineBreaks&&u.test(e.input.slice(o,e.position))&&D(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&L(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,N(e,!0,-1)):e.position<e.length-1&&I(e,"end of the stream or a document separator is expected")}function W(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new _(e,t),r=e.indexOf("\0");for(-1!==r&&(n.position=r,I(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)G(n);return n.documents}function z(e,t,n){null!==t&&"object"==typeof t&&void 0===n&&(n=t,t=null);var r=W(e,n);if("function"!=typeof t)return r;for(var i=0,o=r.length;i<o;i+=1)t(r[i])}function H(e,t){var n=W(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new i("expected a single document in the stream, but found more")}}e.exports.loadAll=z,e.exports.load=H,e.exports.safeLoadAll=function(e,t,n){return"object"==typeof t&&null!==t&&void 0===n&&(n=t,t=null),z(e,t,r.extend({schema:a},n))},e.exports.safeLoad=function(e,t){return H(e,r.extend({schema:a},t))}},function(e,t,n){"use strict";var r=n(38);function i(e,t,n,r,i){this.name=e,this.buffer=t,this.position=n,this.line=r,this.column=i}i.prototype.getSnippet=function(e,t){var n,i,o,a,s;if(!this.buffer)return null;for(e=e||4,t=t||75,n="",i=this.position;i>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(i-1));)if(i-=1,this.position-i>t/2-1){n=" ... ",i+=5;break}for(o="",a=this.position;a<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(a));)if((a+=1)-this.position>t/2-1){o=" ... ",a-=5;break}return s=this.buffer.slice(i,a),r.repeat(" ",e)+n+s+o+"\n"+r.repeat(" ",e+this.position-i+n.length)+"^"},i.prototype.toString=function(e){var t,n="";return this.name&&(n+='in "'+this.name+'" '),n+="at line "+(this.line+1)+", column "+(this.column+1),e||(t=this.getSnippet())&&(n+=":\n"+t),n},e.exports=i},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}})},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}})},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var r=n(38),i=n(10);function o(e){return 48<=e&&e<=55}function a(e){return 48<=e&&e<=57}e.exports=new i("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,r=e.length,i=0,s=!1;if(!r)return!1;if("-"!==(t=e[i])&&"+"!==t||(t=e[++i]),"0"===t){if(i+1===r)return!0;if("b"===(t=e[++i])){for(i++;i<r;i++)if("_"!==(t=e[i])){if("0"!==t&&"1"!==t)return!1;s=!0}return s&&"_"!==t}if("x"===t){for(i++;i<r;i++)if("_"!==(t=e[i])){if(!(48<=(n=e.charCodeAt(i))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;s=!0}return s&&"_"!==t}for(;i<r;i++)if("_"!==(t=e[i])){if(!o(e.charCodeAt(i)))return!1;s=!0}return s&&"_"!==t}if("_"===t)return!1;for(;i<r;i++)if("_"!==(t=e[i])){if(":"===t)break;if(!a(e.charCodeAt(i)))return!1;s=!0}return!(!s||"_"===t)&&(":"!==t||/^(:[0-5]?[0-9])+$/.test(e.slice(i)))},construct:function(e){var t,n,r=e,i=1,o=[];return-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(t=r[0])&&"+"!==t||("-"===t&&(i=-1),t=(r=r.slice(1))[0]),"0"===r?0:"0"===t?"b"===r[1]?i*parseInt(r.slice(2),2):"x"===r[1]?i*parseInt(r,16):i*parseInt(r,8):-1!==r.indexOf(":")?(r.split(":").forEach(function(e){o.unshift(parseInt(e,10))}),r=0,n=1,o.forEach(function(e){r+=e*n,n*=60}),i*r):i*parseInt(r,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!r.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0"+e.toString(8):"-0"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(e,t,n){"use strict";var r=n(38),i=n(10),o=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),a=/^[-+]?[0-9]+e/;e.exports=new i("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!o.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n,r,i;return n="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,i=[],"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:t.indexOf(":")>=0?(t.split(":").forEach(function(e){i.unshift(parseFloat(e,10))}),t=0,r=1,i.forEach(function(e){t+=e*r,r*=60}),n*t):n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||r.isNegativeZero(e))},represent:function(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(r.isNegativeZero(e))return"-0.0";return n=e.toString(10),a.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var r=n(10),i=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),o=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");e.exports=new r("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==i.exec(e)||null!==o.exec(e))},construct:function(e){var t,n,r,a,s,l,c,u,d=0,p=null;if(null===(t=i.exec(e))&&(t=o.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],r=+t[2]-1,a=+t[3],!t[4])return new Date(Date.UTC(n,r,a));if(s=+t[4],l=+t[5],c=+t[6],t[7]){for(d=t[7].slice(0,3);d.length<3;)d+="0";d=+d}return t[9]&&(p=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(p=-p)),u=new Date(Date.UTC(n,r,a,s,l,c,d)),p&&u.setTime(u.getTime()-p),u},instanceOf:Date,represent:function(e){return e.toISOString()}})},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}})},function(e,t,n){"use strict";var r;try{r=n(145).Buffer}catch(e){}var i=n(10),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";e.exports=new i("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,r=0,i=e.length,a=o;for(n=0;n<i;n++)if(!((t=a.indexOf(e.charAt(n)))>64)){if(t<0)return!1;r+=6}return r%8==0},construct:function(e){var t,n,i=e.replace(/[\r\n=]/g,""),a=i.length,s=o,l=0,c=[];for(t=0;t<a;t++)t%4==0&&t&&(c.push(l>>16&255),c.push(l>>8&255),c.push(255&l)),l=l<<6|s.indexOf(i.charAt(t));return 0==(n=a%4*6)?(c.push(l>>16&255),c.push(l>>8&255),c.push(255&l)):18===n?(c.push(l>>10&255),c.push(l>>2&255)):12===n&&c.push(l>>4&255),r?r.from?r.from(c):new r(c):c},predicate:function(e){return r&&r.isBuffer(e)},represent:function(e){var t,n,r="",i=0,a=e.length,s=o;for(t=0;t<a;t++)t%3==0&&t&&(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]),i=(i<<8)+e[t];return 0==(n=a%3)?(r+=s[i>>18&63],r+=s[i>>12&63],r+=s[i>>6&63],r+=s[63&i]):2===n?(r+=s[i>>10&63],r+=s[i>>4&63],r+=s[i<<2&63],r+=s[64]):1===n&&(r+=s[i>>2&63],r+=s[i<<4&63],r+=s[64],r+=s[64]),r}})},function(e,t,n){"use strict";var r=n(10),i=Object.prototype.hasOwnProperty,o=Object.prototype.toString;e.exports=new r("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,r,a,s,l=[],c=e;for(t=0,n=c.length;t<n;t+=1){if(r=c[t],s=!1,"[object Object]"!==o.call(r))return!1;for(a in r)if(i.call(r,a)){if(s)return!1;s=!0}if(!s)return!1;if(-1!==l.indexOf(a))return!1;l.push(a)}return!0},construct:function(e){return null!==e?e:[]}})},function(e,t,n){"use strict";var r=n(10),i=Object.prototype.toString;e.exports=new r("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,r,o,a,s=e;for(a=new Array(s.length),t=0,n=s.length;t<n;t+=1){if(r=s[t],"[object Object]"!==i.call(r))return!1;if(1!==(o=Object.keys(r)).length)return!1;a[t]=[o[0],r[o[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,r,i,o,a=e;for(o=new Array(a.length),t=0,n=a.length;t<n;t+=1)r=a[t],i=Object.keys(r),o[t]=[i[0],r[i[0]]];return o}})},function(e,t,n){"use strict";var r=n(10),i=Object.prototype.hasOwnProperty;e.exports=new r("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(i.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}})},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(e){return void 0===e},represent:function(){return""}})},function(e,t,n){"use strict";var r=n(10);e.exports=new r("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(e){if(null===e)return!1;if(0===e.length)return!1;var t=e,n=/\/([gim]*)$/.exec(e),r="";if("/"===t[0]){if(n&&(r=n[1]),r.length>3)return!1;if("/"!==t[t.length-r.length-1])return!1}return!0},construct:function(e){var t=e,n=/\/([gim]*)$/.exec(e),r="";return"/"===t[0]&&(n&&(r=n[1]),t=t.slice(1,t.length-r.length-1)),new RegExp(t,r)},predicate:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},represent:function(e){var t="/"+e.source+"/";return e.global&&(t+="g"),e.multiline&&(t+="m"),e.ignoreCase&&(t+="i"),t}})},function(e,t,n){"use strict";var r;try{r=n(302)}catch(e){"undefined"!=typeof window&&(r=window.esprima)}var i=n(10);e.exports=new i("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(e){if(null===e)return!1;try{var t="("+e+")",n=r.parse(t,{range:!0});return"Program"===n.type&&1===n.body.length&&"ExpressionStatement"===n.body[0].type&&("ArrowFunctionExpression"===n.body[0].expression.type||"FunctionExpression"===n.body[0].expression.type)}catch(e){return!1}},construct:function(e){var t,n="("+e+")",i=r.parse(n,{range:!0}),o=[];if("Program"!==i.type||1!==i.body.length||"ExpressionStatement"!==i.body[0].type||"ArrowFunctionExpression"!==i.body[0].expression.type&&"FunctionExpression"!==i.body[0].expression.type)throw new Error("Failed to resolve function");return i.body[0].expression.params.forEach(function(e){o.push(e.name)}),t=i.body[0].expression.body.range,"BlockStatement"===i.body[0].expression.body.type?new Function(o,n.slice(t[0]+1,t[1]-1)):new Function(o,"return "+n.slice(t[0],t[1]))},predicate:function(e){return"[object Function]"===Object.prototype.toString.call(e)},represent:function(e){return e.toString()}})},function(e,t,n){var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(3),o=n(8),a=n(15);function s(e,t,n){var a=null,s=function(e,t){n&&n(e,t),a&&a.visit(e,t)},l="function"==typeof n?s:null,c=!1;if(t){c="boolean"==typeof t.comment&&t.comment;var u="boolean"==typeof t.attachComment&&t.attachComment;(c||u)&&((a=new r.CommentHandler).attach=u,t.comment=!0,l=s)}var d,p=!1;t&&"string"==typeof t.sourceType&&(p="module"===t.sourceType),d=t&&"boolean"==typeof t.jsx&&t.jsx?new i.JSXParser(e,t,l):new o.Parser(e,t,l);var h=p?d.parseModule():d.parseScript();return c&&a&&(h.comments=a.comments),d.config.tokens&&(h.tokens=d.tokens),d.config.tolerant&&(h.errors=d.errorHandler.errors),h}t.parse=s,t.parseModule=function(e,t,n){var r=t||{};return r.sourceType="module",s(e,r,n)},t.parseScript=function(e,t,n){var r=t||{};return r.sourceType="script",s(e,r,n)},t.tokenize=function(e,t,n){var r,i=new a.Tokenizer(e,t);r=[];try{for(;;){var o=i.getNextToken();if(!o)break;n&&(o=n(o)),r.push(o)}}catch(e){i.errorHandler.tolerate(e)}return i.errorHandler.tolerant&&(r.errors=i.errors()),r};var l=n(2);t.Syntax=l.Syntax,t.version="4.0.1"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===r.Syntax.BlockStatement&&0===e.body.length){for(var n=[],i=this.leading.length-1;i>=0;--i){var o=this.leading[i];t.end.offset>=o.start&&(n.unshift(o.comment),this.leading.splice(i,1),this.trailing.splice(i,1))}n.length&&(e.innerComments=n)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){for(var n=this.trailing.length-1;n>=0;--n){var r=this.trailing[n];r.start>=e.end.offset&&t.unshift(r.comment)}return this.trailing.length=0,t}var i=this.stack[this.stack.length-1];if(i&&i.node.trailingComments){var o=i.node.trailingComments[0];o&&o.range[0]>=e.end.offset&&(t=i.node.trailingComments,delete i.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,n=[];this.stack.length>0&&(o=this.stack[this.stack.length-1])&&o.start>=e.start.offset;)t=o.node,this.stack.pop();if(t){for(var r=(t.leadingComments?t.leadingComments.length:0)-1;r>=0;--r){var i=t.leadingComments[r];i.range[1]<=e.start.offset&&(n.unshift(i),t.leadingComments.splice(r,1))}return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,n}for(r=this.leading.length-1;r>=0;--r){var o;(o=this.leading[r]).start<=e.start.offset&&(n.unshift(o.comment),this.leading.splice(r,1))}return n},e.prototype.visitNode=function(e,t){if(!(e.type===r.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var n=this.findTrailingComments(t),i=this.findLeadingComments(t);i.length>0&&(e.leadingComments=i),n.length>0&&(e.trailingComments=n),this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var n="L"===e.type[0]?"Line":"Block",r={type:n,value:e.value};if(e.range&&(r.range=e.range),e.loc&&(r.loc=e.loc),this.comments.push(r),this.attach){var i={comment:{type:n,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(i.comment.loc=e.loc),e.type=n,this.leading.push(i),this.trailing.push(i)}},e.prototype.visit=function(e,t){"LineComment"===e.type||"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(5),s=n(6),l=n(7),c=n(8),u=n(13),d=n(14);function p(e){var t;switch(e.type){case s.JSXSyntax.JSXIdentifier:t=e.name;break;case s.JSXSyntax.JSXNamespacedName:var n=e;t=p(n.namespace)+":"+p(n.name);break;case s.JSXSyntax.JSXMemberExpression:var r=e;t=p(r.object)+"."+p(r.property)}return t}u.TokenName[100]="JSXIdentifier",u.TokenName[101]="JSXText";var h=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return i(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){for(var t="&",n=!0,r=!1,i=!1,a=!1;!this.scanner.eof()&&n&&!r;){var s=this.scanner.source[this.scanner.index];if(s===e)break;if(r=";"===s,t+=s,++this.scanner.index,!r)switch(t.length){case 2:i="#"===s;break;case 3:i&&(n=(a="x"===s)||o.Character.isDecimalDigit(s.charCodeAt(0)),i=i&&!a);break;default:n=(n=n&&!(i&&!o.Character.isDecimalDigit(s.charCodeAt(0))))&&!(a&&!o.Character.isHexDigit(s.charCodeAt(0)))}}if(n&&r&&t.length>2){var l=t.substr(1,t.length-2);i&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):a&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):i||a||!d.XHTMLEntities[l]||(t=d.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:s=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){for(var t=this.scanner.index,n=this.scanner.source[this.scanner.index++],r="";!this.scanner.eof()&&(l=this.scanner.source[this.scanner.index++])!==n;)r+="&"===l?this.scanXHTMLEntity(n):l;return{type:8,value:r,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var i=this.scanner.source.charCodeAt(this.scanner.index+1),a=this.scanner.source.charCodeAt(this.scanner.index+2),s=46===i&&46===a?"...":".";return t=this.scanner.index,this.scanner.index+=s.length,{type:7,value:s,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(o.Character.isIdentifierStart(e)&&92!==e){for(t=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index);if(o.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var e=this.scanner.index,t="";!this.scanner.eof();){var n=this.scanner.source[this.scanner.index];if("{"===n||"<"===n)break;++this.scanner.index,t+=n,o.Character.isLineTerminator(n.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===n&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var r={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index};return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(r)),r},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new a.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier();if(this.matchJSX(":")){var n=t;this.expectJSX(":");var r=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXNamespacedName(n,r))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var i=t;this.expectJSX(".");var o=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXMemberExpression(i,o))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),n=this.parseJSXIdentifier();if(this.matchJSX(":")){var r=n;this.expectJSX(":");var i=this.parseJSXIdentifier();e=this.finalize(t,new a.JSXNamespacedName(r,i))}else e=n;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var n=this.getTokenRaw(t);return this.finalize(e,new l.Literal(t.value,n))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXExpressionContainer(t))},t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){var e=this.createJSXNode(),t=this.parseJSXAttributeName(),n=null;return this.matchJSX("=")&&(this.expectJSX("="),n=this.parseJSXAttributeValue()),this.finalize(e,new a.JSXAttribute(t,n))},t.prototype.parseJSXSpreadAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode();this.expectJSX("<");var t=this.parseJSXElementName(),n=this.parseJSXAttributes(),r=this.matchJSX("/");return r&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(t,r,n))},t.prototype.parseJSXBoundaryElement=function(){var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new a.JSXClosingElement(t))}var n=this.parseJSXElementName(),r=this.parseJSXAttributes(),i=this.matchJSX("/");return i&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(n,i,r))},t.prototype.parseJSXEmptyExpression=function(){var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(e,new a.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e,t=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(e=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),e=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(t,new a.JSXExpressionContainer(e))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),n=this.nextJSXText();if(n.start<n.end){var r=this.getTokenRaw(n),i=this.finalize(t,new a.JSXText(n.value,r));e.push(i)}if("{"!==this.scanner.source[this.scanner.index])break;var o=this.parseJSXExpressionContainer();e.push(o)}return e},t.prototype.parseComplexJSXElement=function(e){for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var n=this.createJSXChildNode(),r=this.parseJSXBoundaryElement();if(r.type===s.JSXSyntax.JSXOpeningElement){var i=r;if(i.selfClosing){var o=this.finalize(n,new a.JSXElement(i,[],null));e.children.push(o)}else t.push(e),e={node:n,opening:i,closing:null,children:[]}}if(r.type===s.JSXSyntax.JSXClosingElement){e.closing=r;var l=p(e.opening.name);if(l!==p(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;o=this.finalize(e.node,new a.JSXElement(e.opening,e.children,e.closing)),(e=t[t.length-1]).children.push(o),t.pop()}}return e},t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),n=[],r=null;if(!t.selfClosing){var i=this.parseComplexJSXElement({node:e,opening:t,closing:r,children:n});n=i.children,r=i.closing}return this.finalize(e,new a.JSXElement(t,n,r))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(c.Parser);t.JSXParser=h},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&n.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&n.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=function(e){this.type=r.JSXSyntax.JSXClosingElement,this.name=e};t.JSXClosingElement=i;var o=function(e,t,n){this.type=r.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=n};t.JSXElement=o;var a=function(){this.type=r.JSXSyntax.JSXEmptyExpression};t.JSXEmptyExpression=a;var s=function(e){this.type=r.JSXSyntax.JSXExpressionContainer,this.expression=e};t.JSXExpressionContainer=s;var l=function(e){this.type=r.JSXSyntax.JSXIdentifier,this.name=e};t.JSXIdentifier=l;var c=function(e,t){this.type=r.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t};t.JSXMemberExpression=c;var u=function(e,t){this.type=r.JSXSyntax.JSXAttribute,this.name=e,this.value=t};t.JSXAttribute=u;var d=function(e,t){this.type=r.JSXSyntax.JSXNamespacedName,this.namespace=e,this.name=t};t.JSXNamespacedName=d;var p=function(e,t,n){this.type=r.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=n};t.JSXOpeningElement=p;var h=function(e){this.type=r.JSXSyntax.JSXSpreadAttribute,this.argument=e};t.JSXSpreadAttribute=h;var f=function(e,t){this.type=r.JSXSyntax.JSXText,this.value=e,this.raw=t};t.JSXText=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(e){this.type=r.Syntax.ArrayExpression,this.elements=e};t.ArrayExpression=i;var o=function(e){this.type=r.Syntax.ArrayPattern,this.elements=e};t.ArrayPattern=o;var a=function(e,t,n){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!1};t.ArrowFunctionExpression=a;var s=function(e,t,n){this.type=r.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=n};t.AssignmentExpression=s;var l=function(e,t){this.type=r.Syntax.AssignmentPattern,this.left=e,this.right=t};t.AssignmentPattern=l;var c=function(e,t,n){this.type=r.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!0};t.AsyncArrowFunctionExpression=c;var u=function(e,t,n){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionDeclaration=u;var d=function(e,t,n){this.type=r.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionExpression=d;var p=function(e){this.type=r.Syntax.AwaitExpression,this.argument=e};t.AwaitExpression=p;var h=function(e,t,n){var i="||"===e||"&&"===e;this.type=i?r.Syntax.LogicalExpression:r.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=n};t.BinaryExpression=h;var f=function(e){this.type=r.Syntax.BlockStatement,this.body=e};t.BlockStatement=f;var m=function(e){this.type=r.Syntax.BreakStatement,this.label=e};t.BreakStatement=m;var g=function(e,t){this.type=r.Syntax.CallExpression,this.callee=e,this.arguments=t};t.CallExpression=g;var v=function(e,t){this.type=r.Syntax.CatchClause,this.param=e,this.body=t};t.CatchClause=v;var y=function(e){this.type=r.Syntax.ClassBody,this.body=e};t.ClassBody=y;var b=function(e,t,n){this.type=r.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=n};t.ClassDeclaration=b;var C=function(e,t,n){this.type=r.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=n};t.ClassExpression=C;var w=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t};t.ComputedMemberExpression=w;var E=function(e,t,n){this.type=r.Syntax.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n};t.ConditionalExpression=E;var T=function(e){this.type=r.Syntax.ContinueStatement,this.label=e};t.ContinueStatement=T;var x=function(){this.type=r.Syntax.DebuggerStatement};t.DebuggerStatement=x;var _=function(e,t){this.type=r.Syntax.ExpressionStatement,this.expression=e,this.directive=t};t.Directive=_;var S=function(e,t){this.type=r.Syntax.DoWhileStatement,this.body=e,this.test=t};t.DoWhileStatement=S;var I=function(){this.type=r.Syntax.EmptyStatement};t.EmptyStatement=I;var D=function(e){this.type=r.Syntax.ExportAllDeclaration,this.source=e};t.ExportAllDeclaration=D;var A=function(e){this.type=r.Syntax.ExportDefaultDeclaration,this.declaration=e};t.ExportDefaultDeclaration=A;var P=function(e,t,n){this.type=r.Syntax.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=n};t.ExportNamedDeclaration=P;var O=function(e,t){this.type=r.Syntax.ExportSpecifier,this.exported=t,this.local=e};t.ExportSpecifier=O;var R=function(e){this.type=r.Syntax.ExpressionStatement,this.expression=e};t.ExpressionStatement=R;var M=function(e,t,n){this.type=r.Syntax.ForInStatement,this.left=e,this.right=t,this.body=n,this.each=!1};t.ForInStatement=M;var N=function(e,t,n){this.type=r.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=n};t.ForOfStatement=N;var L=function(e,t,n,i){this.type=r.Syntax.ForStatement,this.init=e,this.test=t,this.update=n,this.body=i};t.ForStatement=L;var k=function(e,t,n,i){this.type=r.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=i,this.expression=!1,this.async=!1};t.FunctionDeclaration=k;var F=function(e,t,n,i){this.type=r.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=i,this.expression=!1,this.async=!1};t.FunctionExpression=F;var V=function(e){this.type=r.Syntax.Identifier,this.name=e};t.Identifier=V;var U=function(e,t,n){this.type=r.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=n};t.IfStatement=U;var B=function(e,t){this.type=r.Syntax.ImportDeclaration,this.specifiers=e,this.source=t};t.ImportDeclaration=B;var G=function(e){this.type=r.Syntax.ImportDefaultSpecifier,this.local=e};t.ImportDefaultSpecifier=G;var W=function(e){this.type=r.Syntax.ImportNamespaceSpecifier,this.local=e};t.ImportNamespaceSpecifier=W;var z=function(e,t){this.type=r.Syntax.ImportSpecifier,this.local=e,this.imported=t};t.ImportSpecifier=z;var H=function(e,t){this.type=r.Syntax.LabeledStatement,this.label=e,this.body=t};t.LabeledStatement=H;var j=function(e,t){this.type=r.Syntax.Literal,this.value=e,this.raw=t};t.Literal=j;var Z=function(e,t){this.type=r.Syntax.MetaProperty,this.meta=e,this.property=t};t.MetaProperty=Z;var K=function(e,t,n,i,o){this.type=r.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=n,this.kind=i,this.static=o};t.MethodDefinition=K;var $=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="module"};t.Module=$;var q=function(e,t){this.type=r.Syntax.NewExpression,this.callee=e,this.arguments=t};t.NewExpression=q;var X=function(e){this.type=r.Syntax.ObjectExpression,this.properties=e};t.ObjectExpression=X;var Y=function(e){this.type=r.Syntax.ObjectPattern,this.properties=e};t.ObjectPattern=Y;var J=function(e,t,n,i,o,a){this.type=r.Syntax.Property,this.key=t,this.computed=n,this.value=i,this.kind=e,this.method=o,this.shorthand=a};t.Property=J;var Q=function(e,t,n,i){this.type=r.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:n,flags:i}};t.RegexLiteral=Q;var ee=function(e){this.type=r.Syntax.RestElement,this.argument=e};t.RestElement=ee;var te=function(e){this.type=r.Syntax.ReturnStatement,this.argument=e};t.ReturnStatement=te;var ne=function(e){this.type=r.Syntax.Program,this.body=e,this.sourceType="script"};t.Script=ne;var re=function(e){this.type=r.Syntax.SequenceExpression,this.expressions=e};t.SequenceExpression=re;var ie=function(e){this.type=r.Syntax.SpreadElement,this.argument=e};t.SpreadElement=ie;var oe=function(e,t){this.type=r.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t};t.StaticMemberExpression=oe;var ae=function(){this.type=r.Syntax.Super};t.Super=ae;var se=function(e,t){this.type=r.Syntax.SwitchCase,this.test=e,this.consequent=t};t.SwitchCase=se;var le=function(e,t){this.type=r.Syntax.SwitchStatement,this.discriminant=e,this.cases=t};t.SwitchStatement=le;var ce=function(e,t){this.type=r.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t};t.TaggedTemplateExpression=ce;var ue=function(e,t){this.type=r.Syntax.TemplateElement,this.value=e,this.tail=t};t.TemplateElement=ue;var de=function(e,t){this.type=r.Syntax.TemplateLiteral,this.quasis=e,this.expressions=t};t.TemplateLiteral=de;var pe=function(){this.type=r.Syntax.ThisExpression};t.ThisExpression=pe;var he=function(e){this.type=r.Syntax.ThrowStatement,this.argument=e};t.ThrowStatement=he;var fe=function(e,t,n){this.type=r.Syntax.TryStatement,this.block=e,this.handler=t,this.finalizer=n};t.TryStatement=fe;var me=function(e,t){this.type=r.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0};t.UnaryExpression=me;var ge=function(e,t,n){this.type=r.Syntax.UpdateExpression,this.operator=e,this.argument=t,this.prefix=n};t.UpdateExpression=ge;var ve=function(e,t){this.type=r.Syntax.VariableDeclaration,this.declarations=e,this.kind=t};t.VariableDeclaration=ve;var ye=function(e,t){this.type=r.Syntax.VariableDeclarator,this.id=e,this.init=t};t.VariableDeclarator=ye;var be=function(e,t){this.type=r.Syntax.WhileStatement,this.test=e,this.body=t};t.WhileStatement=be;var Ce=function(e,t){this.type=r.Syntax.WithStatement,this.object=e,this.body=t};t.WithStatement=Ce;var we=function(e,t){this.type=r.Syntax.YieldExpression,this.argument=e,this.delegate=t};t.YieldExpression=we},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(10),o=n(11),a=n(7),s=n(12),l=n(2),c=n(13),u=function(){function e(e,t,n){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=n,this.errorHandler=new i.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new s.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,function(e,t){return r.assert(t<i.length,"Message reference must be in range"),i[t]}),a=this.lastMarker.index,s=this.lastMarker.line,l=this.lastMarker.column+1;throw this.errorHandler.createError(a,s,l,o)},e.prototype.tolerateError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,function(e,t){return r.assert(t<i.length,"Message reference must be in range"),i[t]}),a=this.lastMarker.index,s=this.scanner.lineNumber,l=this.lastMarker.column+1;this.errorHandler.tolerateError(a,s,l,o)},e.prototype.unexpectedTokenError=function(e,t){var n,r=t||o.Messages.UnexpectedToken;if(e?(t||(r=2===e.type?o.Messages.UnexpectedEOS:3===e.type?o.Messages.UnexpectedIdentifier:6===e.type?o.Messages.UnexpectedNumber:8===e.type?o.Messages.UnexpectedString:10===e.type?o.Messages.UnexpectedTemplate:o.Messages.UnexpectedToken,4===e.type&&(this.scanner.isFutureReservedWord(e.value)?r=o.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(r=o.Messages.StrictReservedWord))),n=e.value):n="ILLEGAL",r=r.replace("%0",n),e&&"number"==typeof e.lineNumber){var i=e.start,a=e.lineNumber,s=this.lastMarker.index-this.lastMarker.column,l=e.start-s+1;return this.errorHandler.createError(i,a,l,r)}return i=this.lastMarker.index,a=this.lastMarker.line,l=this.lastMarker.column+1,this.errorHandler.createError(i,a,l,r)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var n=e[t],r=void 0;r={type:n.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(n.slice[0],n.slice[1])},this.config.range&&(r.range=n.range),this.config.loc&&(r.loc=n.loc);var i={start:{line:n.loc.start.line,column:n.loc.start.column,offset:n.range[0]},end:{line:n.loc.end.line,column:n.loc.end.column,offset:n.range[1]}};this.delegate(r,i)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:c.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var n=e.pattern,r=e.flags;t.regex={pattern:n,flags:r}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments();var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var n=e.start-e.lineStart,r=e.lineNumber;return n<0&&(n+=t,r--),{index:e.start,line:r,column:n}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var n={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,n)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,o.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var i=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=n,this.context.firstCoverInitializedNameError=r,i},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,r=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var i=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&n,this.context.firstCoverInitializedNameError=r||this.context.firstCoverInitializedNameError,i},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,n,r=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(r,new a.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,o.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(r,new a.Literal(t.value,n));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(r,new a.Literal("true"===t.value,n));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(r,new a.Literal(null,n));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),n=this.getTokenRaw(t),e=this.finalize(r,new a.RegexLiteral(t.regex,n,t.pattern,t.flags));break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(r,new a.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),e=this.finalize(r,new a.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new a.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var n=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),t.push(n)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new a.ArrayExpression(t))},e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,n=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple;var r=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=n,r},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters(),r=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,r,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){var e=this.createNode(),t=this.context.allowYield,n=this.context.await;this.context.allowYield=!1,this.context.await=!0;var r=this.parseFormalParameters(),i=this.parsePropertyMethod(r);return this.context.allowYield=t,this.context.await=n,this.finalize(e,new a.AsyncFunctionExpression(null,r.params,i))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),n=this.nextToken();switch(n.type){case 8:case 6:this.context.strict&&n.octal&&this.tolerateUnexpectedToken(n,o.Messages.StrictOctalLiteral);var r=this.getTokenRaw(n);e=this.finalize(t,new a.Literal(n.value,r));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new a.Identifier(n.value));break;case 7:"["===n.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(n);break;default:e=this.throwUnexpectedToken(n)}return e},e.prototype.isPropertyKey=function(e,t){return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,n=this.createNode(),r=this.lookahead,i=null,s=null,l=!1,c=!1,u=!1,d=!1;if(3===r.type){var p=r.value;this.nextToken(),l=this.match("["),i=(d=!(this.hasLineTerminator||"async"!==p||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(n,new a.Identifier(p))}else this.match("*")?this.nextToken():(l=this.match("["),i=this.parseObjectPropertyKey());var h=this.qualifiedPropertyName(this.lookahead);if(3===r.type&&!d&&"get"===r.value&&h)t="get",l=this.match("["),i=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod();else if(3===r.type&&!d&&"set"===r.value&&h)t="set",l=this.match("["),i=this.parseObjectPropertyKey(),s=this.parseSetterMethod();else if(7===r.type&&"*"===r.value&&h)t="init",l=this.match("["),i=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),c=!0;else if(i||this.throwUnexpectedToken(this.lookahead),t="init",this.match(":")&&!d)!l&&this.isPropertyKey(i,"__proto__")&&(e.value&&this.tolerateError(o.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),s=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))s=d?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0;else if(3===r.type)if(p=this.finalize(n,new a.Identifier(r.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),u=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);s=this.finalize(n,new a.AssignmentPattern(p,f))}else u=!0,s=p;else this.throwUnexpectedToken(this.nextToken());return this.finalize(n,new a.Property(t,i,l,s,c,u))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],n={value:!1};!this.match("}");)t.push(this.parseObjectProperty(n)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new a.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){r.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),n=t.value,i=t.cooked;return this.finalize(e,new a.TemplateElement({raw:n,cooked:i},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),n=t.value,r=t.cooked;return this.finalize(e,new a.TemplateElement({raw:n,cooked:r},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],n=[],r=this.parseTemplateHead();for(n.push(r);!r.tail;)t.push(this.parseExpression()),r=this.parseTemplateElement(),n.push(r);return this.finalize(e,new a.TemplateLiteral(n,t))},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(var t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break;case l.Syntax.ObjectExpression:for(e.type=l.Syntax.ObjectPattern,t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var t=this.lookahead,n=[];if(this.match("..."))e=this.parseRestElement(n),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[e],async:!1};else{var r=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var i=[];for(this.context.isAssignmentTarget=!1,i.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var o=0;o<i.length;o++)this.reinterpretExpressionAsPattern(i[o]);r=!0,e={type:"ArrowParameterPlaceHolder",params:i,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),i.push(this.parseRestElement(n)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,o=0;o<i.length;o++)this.reinterpretExpressionAsPattern(i[o]);r=!0,e={type:"ArrowParameterPlaceHolder",params:i,async:!1}}else i.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(r)break}r||(e=this.finalize(this.startNode(t),new a.SequenceExpression(i)))}if(!r){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(r=!0,e={type:"ArrowParameterPlaceHolder",params:[e],async:!1}),!r)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),e.type===l.Syntax.SequenceExpression)for(o=0;o<e.expressions.length;o++)this.reinterpretExpressionAsPattern(e.expressions[o]);else this.reinterpretExpressionAsPattern(e);e={type:"ArrowParameterPlaceHolder",params:e.type===l.Syntax.SequenceExpression?e.expressions:[e],async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new a.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e,t=this.createNode(),n=this.parseIdentifierName();if(r.assert("new"===n.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var i=this.parseIdentifierName();e=new a.MetaProperty(n,i)}else this.throwUnexpectedToken(this.lookahead);else{var o=this.isolateCoverGrammar(this.parseLeftHandSideExpression),s=this.match("(")?this.parseArguments():[];e=new a.NewExpression(o,s),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(t,e)},e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e,t=this.lookahead,n=this.matchContextualKeyword("async"),r=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(e=this.createNode(),this.nextToken(),e=this.finalize(e,new a.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):e=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var i=this.parseIdentifierName();e=this.finalize(this.startNode(t),new a.StaticMemberExpression(e,i))}else if(this.match("(")){var o=n&&t.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var s=o?this.parseAsyncArguments():this.parseArguments();if(e=this.finalize(this.startNode(t),new a.CallExpression(e,s)),o&&this.match("=>")){for(var l=0;l<s.length;++l)this.reinterpretExpressionAsPattern(s[l]);e={type:"ArrowParameterPlaceHolder",params:s,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),i=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),e=this.finalize(this.startNode(t),new a.ComputedMemberExpression(e,i));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var c=this.parseTemplateLiteral();e=this.finalize(this.startNode(t),new a.TaggedTemplateExpression(e,c))}return this.context.allowIn=r,e},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new a.Super)},e.prototype.parseLeftHandSideExpression=function(){r.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var n=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new a.ComputedMemberExpression(t,n))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),n=this.parseIdentifierName(),t=this.finalize(e,new a.StaticMemberExpression(t,n));else{if(10!==this.lookahead.type||!this.lookahead.head)break;var i=this.parseTemplateLiteral();t=this.finalize(e,new a.TaggedTemplateExpression(t,i))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var n=this.startNode(t),r=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment);var i=!0;e=this.finalize(n,new a.UpdateExpression(r.value,e,i)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var s=this.nextToken().value;i=!1,e=this.finalize(this.startNode(t),new a.UpdateExpression(s,e,i))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new a.AwaitExpression(t))},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var t=this.startNode(this.lookahead),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new a.UnaryExpression(n.value,e)),this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(o.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var n=t,r=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new a.BinaryExpression("**",n,r))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),n=this.lookahead,r=this.binaryPrecedence(n);if(r>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var i=[e,this.lookahead],o=t,s=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[o,n.value,s],c=[r];!((r=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&r<=c[c.length-1];){s=l.pop();var u=l.pop();c.pop(),o=l.pop(),i.pop();var d=this.startNode(i[i.length-1]);l.push(this.finalize(d,new a.BinaryExpression(u,o,s)))}l.push(this.nextToken().value),c.push(r),i.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var p=l.length-1;t=l[p];for(var h=i.pop();p>1;){var f=i.pop(),m=h&&h.lineStart;d=this.startNode(f,m),u=l[p-1],t=this.finalize(d,new a.BinaryExpression(u,l[p-2],t)),p-=2,h=f}}return t},e.prototype.parseConditionalExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var n=this.context.allowIn;this.context.allowIn=!0;var r=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=n,this.expect(":");var i=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new a.ConditionalExpression(t,r,i)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(var n=0;n<t.elements.length;n++)null!==t.elements[n]&&this.checkPatternParam(e,t.elements[n]);break;case l.Syntax.ObjectPattern:for(n=0;n<t.properties.length;n++)this.checkPatternParam(e,t.properties[n].value)}e.simple=e.simple&&t instanceof a.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,n=[e],r=!1;switch(e.type){case l.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":n=e.params,r=e.async;break;default:return null}t={simple:!0,paramSet:{}};for(var i=0;i<n.length;++i)(a=n[i]).type===l.Syntax.AssignmentPattern?a.right.type===l.Syntax.YieldExpression&&(a.right.argument&&this.throwUnexpectedToken(this.lookahead),a.right.type=l.Syntax.Identifier,a.right.name="yield",delete a.right.argument,delete a.right.delegate):r&&a.type===l.Syntax.Identifier&&"await"===a.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,a),n[i]=a;if(this.context.strict||!this.context.allowYield)for(i=0;i<n.length;++i){var a;(a=n[i]).type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===o.Messages.StrictParamDupe){var s=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(s,t.message)}return{simple:t.simple,params:n,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{var t=this.lookahead,n=t;if(e=this.parseConditionalExpression(),3===n.type&&n.lineNumber===this.lookahead.lineNumber&&"async"===n.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var r=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(r),e={type:"ArrowParameterPlaceHolder",params:[r],async:!0}}if("ArrowParameterPlaceHolder"===e.type||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var i=e.async,s=this.reinterpretAsCoverFormalsList(e);if(s){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var c=this.context.strict,u=this.context.allowStrictDirective;this.context.allowStrictDirective=s.simple;var d=this.context.allowYield,p=this.context.await;this.context.allowYield=!0,this.context.await=i;var h=this.startNode(t);this.expect("=>");var f=void 0;if(this.match("{")){var m=this.context.allowIn;this.context.allowIn=!0,f=this.parseFunctionSourceElements(),this.context.allowIn=m}else f=this.isolateCoverGrammar(this.parseAssignmentExpression);var g=f.type!==l.Syntax.BlockStatement;this.context.strict&&s.firstRestricted&&this.throwUnexpectedToken(s.firstRestricted,s.message),this.context.strict&&s.stricted&&this.tolerateUnexpectedToken(s.stricted,s.message),e=i?this.finalize(h,new a.AsyncArrowFunctionExpression(s.params,f,g)):this.finalize(h,new a.ArrowFunctionExpression(s.params,f,g)),this.context.strict=c,this.context.allowStrictDirective=u,this.context.allowYield=d,this.context.await=p}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(n=this.nextToken()).value,b=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new a.AssignmentExpression(y,e,b)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var n=[];for(n.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),n.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new a.SequenceExpression(n))}return t},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new a.BlockStatement(t))},e.prototype.parseLexicalBinding=function(e,t){var n=this.createNode(),r=this.parsePattern([],e);this.context.strict&&r.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(o.Messages.StrictVarName);var i=null;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),i=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(o.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&r.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),i=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(n,new a.VariableDeclarator(r,i))},e.prototype.parseBindingList=function(e,t){for(var n=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),n.push(this.parseLexicalBinding(e,t));return n},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),n=this.nextToken().value;r.assert("let"===n||"const"===n,"Lexical declaration must be either let or const");var i=this.parseBindingList(n,e);return this.consumeSemicolon(),this.finalize(t,new a.VariableDeclaration(i,n))},e.prototype.parseBindingRestElement=function(e,t){var n=this.createNode();this.expect("...");var r=this.parsePattern(e,t);return this.finalize(n,new a.RestElement(r))},e.prototype.parseArrayPattern=function(e,t){var n=this.createNode();this.expect("[");for(var r=[];!this.match("]");)if(this.match(","))this.nextToken(),r.push(null);else{if(this.match("...")){r.push(this.parseBindingRestElement(e,t));break}r.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(n,new a.ArrayPattern(r))},e.prototype.parsePropertyPattern=function(e,t){var n,r,i=this.createNode(),o=!1,s=!1;if(3===this.lookahead.type){var l=this.lookahead;n=this.parseVariableIdentifier();var c=this.finalize(i,new a.Identifier(l.value));if(this.match("=")){e.push(l),s=!0,this.nextToken();var u=this.parseAssignmentExpression();r=this.finalize(this.startNode(l),new a.AssignmentPattern(c,u))}else this.match(":")?(this.expect(":"),r=this.parsePatternWithDefault(e,t)):(e.push(l),s=!0,r=c)}else o=this.match("["),n=this.parseObjectPropertyKey(),this.expect(":"),r=this.parsePatternWithDefault(e,t);return this.finalize(i,new a.Property("init",n,o,r,!1,s))},e.prototype.parseObjectPattern=function(e,t){var n=this.createNode(),r=[];for(this.expect("{");!this.match("}");)r.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(n,new a.ObjectPattern(r))},e.prototype.parsePattern=function(e,t){var n;return this.match("[")?n=this.parseArrayPattern(e,t):this.match("{")?n=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,o.Messages.LetInLexicalBinding),e.push(this.lookahead),n=this.parseVariableIdentifier(t)),n},e.prototype.parsePatternWithDefault=function(e,t){var n=this.lookahead,r=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var i=this.context.allowYield;this.context.allowYield=!0;var o=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=i,r=this.finalize(this.startNode(n),new a.AssignmentPattern(r,o))}return r},e.prototype.parseVariableIdentifier=function(e){var t=this.createNode(),n=this.nextToken();return 4===n.type&&"yield"===n.value?this.context.strict?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(n):3!==n.type?this.context.strict&&4===n.type&&this.scanner.isStrictModeReservedWord(n.value)?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):(this.context.strict||"let"!==n.value||"var"!==e)&&this.throwUnexpectedToken(n):(this.context.isModule||this.context.await)&&3===n.type&&"await"===n.value&&this.tolerateUnexpectedToken(n),this.finalize(t,new a.Identifier(n.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),n=this.parsePattern([],"var");this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(o.Messages.StrictVarName);var r=null;return this.match("=")?(this.nextToken(),r=this.isolateCoverGrammar(this.parseAssignmentExpression)):n.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new a.VariableDeclarator(n,r))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},n=[];for(n.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),n.push(this.parseVariableDeclaration(t));return n},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new a.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new a.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ExpressionStatement(t))},e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(o.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),n=null;this.expectKeyword("if"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),n=this.parseIfClause())),this.finalize(t,new a.IfStatement(r,e,n))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do");var t=this.context.inIteration;this.context.inIteration=!0;var n=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new a.DoWhileStatement(n,r))},e.prototype.parseWhileStatement=function(){var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var n=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var r=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=r}return this.finalize(t,new a.WhileStatement(n,e))},e.prototype.parseForStatement=function(){var e,t,n,r=null,i=null,s=null,c=!0,u=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){r=this.createNode(),this.nextToken();var d=this.context.allowIn;this.context.allowIn=!1;var p=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=d,1===p.length&&this.matchKeyword("in")){var h=p[0];h.init&&(h.id.type===l.Syntax.ArrayPattern||h.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(o.Messages.ForInOfLoopInitializer,"for-in"),r=this.finalize(r,new a.VariableDeclaration(p,"var")),this.nextToken(),e=r,t=this.parseExpression(),r=null}else 1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new a.VariableDeclaration(p,"var")),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,c=!1):(r=this.finalize(r,new a.VariableDeclaration(p,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){r=this.createNode();var f=this.nextToken().value;this.context.strict||"in"!==this.lookahead.value?(d=this.context.allowIn,this.context.allowIn=!1,p=this.parseBindingList(f,{inFor:!0}),this.context.allowIn=d,1===p.length&&null===p[0].init&&this.matchKeyword("in")?(r=this.finalize(r,new a.VariableDeclaration(p,f)),this.nextToken(),e=r,t=this.parseExpression(),r=null):1===p.length&&null===p[0].init&&this.matchContextualKeyword("of")?(r=this.finalize(r,new a.VariableDeclaration(p,f)),this.nextToken(),e=r,t=this.parseAssignmentExpression(),r=null,c=!1):(this.consumeSemicolon(),r=this.finalize(r,new a.VariableDeclaration(p,f)))):(r=this.finalize(r,new a.Identifier(f)),this.nextToken(),e=r,t=this.parseExpression(),r=null)}else{var m=this.lookahead;if(d=this.context.allowIn,this.context.allowIn=!1,r=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=d,this.matchKeyword("in"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(r),e=r,t=this.parseExpression(),r=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&r.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(r),e=r,t=this.parseAssignmentExpression(),r=null,c=!1;else{if(this.match(",")){for(var g=[r];this.match(",");)this.nextToken(),g.push(this.isolateCoverGrammar(this.parseAssignmentExpression));r=this.finalize(this.startNode(m),new a.SequenceExpression(g))}this.expect(";")}}if(void 0===e&&(this.match(";")||(i=this.parseExpression()),this.expect(";"),this.match(")")||(s=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),n=this.finalize(this.createNode(),new a.EmptyStatement);else{this.expect(")");var v=this.context.inIteration;this.context.inIteration=!0,n=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=v}return void 0===e?this.finalize(u,new a.ForStatement(r,i,s,n)):c?this.finalize(u,new a.ForInStatement(e,t,n)):this.finalize(u,new a.ForOfStatement(e,t,n))},e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier();t=n;var r="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(o.Messages.UnknownLabel,n.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(o.Messages.IllegalContinue),this.finalize(e,new a.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier(),r="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)||this.throwError(o.Messages.UnknownLabel,n.name),t=n}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(o.Messages.IllegalBreak),this.finalize(e,new a.BreakStatement(t))},e.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(o.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=(this.match(";")||this.match("}")||this.hasLineTerminator||2===this.lookahead.type)&&8!==this.lookahead.type&&10!==this.lookahead.type?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ReturnStatement(t))},e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(o.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var n=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new a.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new a.WithStatement(n,e))},e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":");for(var n=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)n.push(this.parseStatementListItem());return this.finalize(t,new a.SwitchCase(e,n))},e.prototype.parseSwitchStatement=function(){var e=this.createNode();this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var n=this.context.inSwitch;this.context.inSwitch=!0;var r=[],i=!1;for(this.expect("{");!this.match("}");){var s=this.parseSwitchCase();null===s.test&&(i&&this.throwError(o.Messages.MultipleDefaultsInSwitch),i=!0),r.push(s)}return this.expect("}"),this.context.inSwitch=n,this.finalize(e,new a.SwitchStatement(t,r))},e.prototype.parseLabelledStatement=function(){var e,t=this.createNode(),n=this.parseExpression();if(n.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var r=n,i="$"+r.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)&&this.throwError(o.Messages.Redeclaration,"Label",r.name),this.context.labelSet[i]=!0;var s=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),s=this.parseClassDeclaration();else if(this.matchKeyword("function")){var c=this.lookahead,u=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(c,o.Messages.StrictFunction):u.generator&&this.tolerateUnexpectedToken(c,o.Messages.GeneratorInLegacyContext),s=u}else s=this.parseStatement();delete this.context.labelSet[i],e=new a.LabeledStatement(r,s)}else this.consumeSemicolon(),e=new a.ExpressionStatement(n);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(o.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new a.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],n=this.parsePattern(t),r={},i=0;i<t.length;i++){var s="$"+t[i].value;Object.prototype.hasOwnProperty.call(r,s)&&this.tolerateError(o.Messages.DuplicateBinding,t[i].value),r[s]=!0}this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(o.Messages.StrictCatchVariable),this.expect(")");var c=this.parseBlock();return this.finalize(e,new a.CatchClause(n,c))},e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try");var t=this.parseBlock(),n=this.matchKeyword("catch")?this.parseCatchClause():null,r=this.matchKeyword("finally")?this.parseFinallyClause():null;return n||r||this.throwError(o.Messages.NoCatchOrFinally),this.finalize(e,new a.TryStatement(t,n,r))},e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new a.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.parseDirectivePrologues(),n=this.context.labelSet,r=this.context.inIteration,i=this.context.inSwitch,o=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=n,this.context.inIteration=r,this.context.inSwitch=i,this.context.inFunctionBody=o,this.finalize(e,new a.BlockStatement(t))},e.prototype.validateParam=function(e,t,n){var r="$"+n;this.context.strict?(this.scanner.isRestrictedWord(n)&&(e.stricted=t,e.message=o.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,r)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,r,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[r]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...");var n=this.parsePattern(e);return this.match("=")&&this.throwError(o.Messages.DefaultRestParameter),this.match(")")||this.throwError(o.Messages.ParameterAfterRestParameter),this.finalize(t,new a.RestElement(n))},e.prototype.parseFormalParameter=function(e){for(var t=[],n=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),r=0;r<t.length;r++)this.validateParam(e,t[r],t[r].value);e.simple=e.simple&&n instanceof a.Identifier,e.params.push(n)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var n=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===n.lineNumber&&4===n.type&&"function"===n.value}return e},e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),n=this.matchContextualKeyword("async");n&&this.nextToken(),this.expectKeyword("function");var r,i=!n&&this.match("*");i&&this.nextToken();var s=null,l=null;if(!e||!this.match("(")){var c=this.lookahead;s=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(l=c,r=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(l=c,r=o.Messages.StrictReservedWord)}var u=this.context.await,d=this.context.allowYield;this.context.await=n,this.context.allowYield=!i;var p=this.parseFormalParameters(l),h=p.params,f=p.stricted;l=p.firstRestricted,p.message&&(r=p.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=p.simple;var v=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,r),this.context.strict&&f&&this.tolerateUnexpectedToken(f,r),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=u,this.context.allowYield=d,n?this.finalize(t,new a.AsyncFunctionDeclaration(s,h,v)):this.finalize(t,new a.FunctionDeclaration(s,h,v,i))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async");t&&this.nextToken(),this.expectKeyword("function");var n,r=!t&&this.match("*");r&&this.nextToken();var i,s=null,l=this.context.await,c=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!r,!this.match("(")){var u=this.lookahead;s=this.context.strict||r||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(i=u,n=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(i=u,n=o.Messages.StrictReservedWord)}var d=this.parseFormalParameters(i),p=d.params,h=d.stricted;i=d.firstRestricted,d.message&&(n=d.message);var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=d.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&i&&this.throwUnexpectedToken(i,n),this.context.strict&&h&&this.tolerateUnexpectedToken(h,n),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=c,t?this.finalize(e,new a.AsyncFunctionExpression(s,p,g)):this.finalize(e,new a.FunctionExpression(s,p,g,r))},e.prototype.parseDirective=function(){var e=this.lookahead,t=this.createNode(),n=this.parseExpression(),r=n.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,r?new a.Directive(n,r):new a.ExpressionStatement(n))},e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var n=this.lookahead;if(8!==n.type)break;var r=this.parseDirective();t.push(r);var i=r.directive;if("string"!=typeof i)break;"use strict"===i?(this.context.strict=!0,e&&this.tolerateUnexpectedToken(e,o.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(n,o.Messages.IllegalLanguageModeDirective)):!e&&n.octal&&(e=n)}return t},e.prototype.qualifiedPropertyName=function(e){switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();n.params.length>0&&this.tolerateError(o.Messages.BadGetterArity);var r=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,r,!1))},e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();1!==n.params.length?this.tolerateError(o.Messages.BadSetterArity):n.params[0]instanceof a.RestElement&&this.tolerateError(o.Messages.BadSetterRestParameter);var r=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,r,!1))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();this.context.allowYield=!1;var r=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new a.FunctionExpression(null,n.params,r,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,n=!1;if(!this.hasLineTerminator){var r=this.context.allowYield;this.context.allowYield=!1,(n=this.match("*"))?(this.nextToken(),t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=r}return this.finalize(e,new a.YieldExpression(t,n))},e.prototype.parseClassElement=function(e){var t=this.lookahead,n=this.createNode(),r="",i=null,s=null,l=!1,c=!1,u=!1,d=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),"static"===(i=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,u=!0,l=this.match("["),this.match("*")?this.nextToken():i=this.parseObjectPropertyKey()),3===t.type&&!this.hasLineTerminator&&"async"===t.value){var p=this.lookahead.value;":"!==p&&"("!==p&&"*"!==p&&(d=!0,t=this.lookahead,i=this.parseObjectPropertyKey(),3===t.type&&"constructor"===t.value&&this.tolerateUnexpectedToken(t,o.Messages.ConstructorIsAsync))}var h=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&h?(r="get",l=this.match("["),i=this.parseObjectPropertyKey(),this.context.allowYield=!1,s=this.parseGetterMethod()):"set"===t.value&&h&&(r="set",l=this.match("["),i=this.parseObjectPropertyKey(),s=this.parseSetterMethod()):7===t.type&&"*"===t.value&&h&&(r="init",l=this.match("["),i=this.parseObjectPropertyKey(),s=this.parseGeneratorMethod(),c=!0),!r&&i&&this.match("(")&&(r="init",s=d?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0),r||this.throwUnexpectedToken(this.lookahead),"init"===r&&(r="method"),l||(u&&this.isPropertyKey(i,"prototype")&&this.throwUnexpectedToken(t,o.Messages.StaticPrototype),!u&&this.isPropertyKey(i,"constructor")&&(("method"!==r||!c||s&&s.generator)&&this.throwUnexpectedToken(t,o.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,o.Messages.DuplicateConstructor):e.value=!0,r="constructor")),this.finalize(n,new a.MethodDefinition(i,l,s,r,u))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new a.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),n=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var r=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),i=null;this.matchKeyword("extends")&&(this.nextToken(),i=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var o=this.parseClassBody();return this.context.strict=n,this.finalize(t,new a.ClassDeclaration(r,i,o))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var n=3===this.lookahead.type?this.parseVariableIdentifier():null,r=null;this.matchKeyword("extends")&&(this.nextToken(),r=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var i=this.parseClassBody();return this.context.strict=t,this.finalize(e,new a.ClassExpression(n,r,i))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Module(t))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new a.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode();8!==this.lookahead.type&&this.throwError(o.Messages.InvalidModuleSpecifier);var t=this.nextToken(),n=this.getTokenRaw(t);return this.finalize(e,new a.Literal(t.value,n))},e.prototype.parseImportSpecifier=function(){var e,t,n=this.createNode();return 3===this.lookahead.type?(t=e=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(t=e=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(n,new a.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new a.ImportDefaultSpecifier(t))},e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(o.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName();return this.finalize(e,new a.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalImportDeclaration);var e,t=this.createNode();this.expectKeyword("import");var n=[];if(8===this.lookahead.type)e=this.parseModuleSpecifier();else{if(this.match("{")?n=n.concat(this.parseNamedImports()):this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(n.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.match("{")?n=n.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken(),e=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(t,new a.ImportDeclaration(n,e))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),n=t;return this.matchContextualKeyword("as")&&(this.nextToken(),n=this.parseIdentifierName()),this.finalize(e,new a.ExportSpecifier(t,n))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalExportDeclaration);var e,t=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var n=this.parseFunctionDeclaration(!0);e=this.finalize(t,new a.ExportDefaultDeclaration(n))}else this.matchKeyword("class")?(n=this.parseClassDeclaration(!0),e=this.finalize(t,new a.ExportDefaultDeclaration(n))):this.matchContextualKeyword("async")?(n=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),e=this.finalize(t,new a.ExportDefaultDeclaration(n))):(this.matchContextualKeyword("from")&&this.throwError(o.Messages.UnexpectedToken,this.lookahead.value),n=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),e=this.finalize(t,new a.ExportDefaultDeclaration(n)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(r,this.lookahead.value)}this.nextToken();var i=this.parseModuleSpecifier();this.consumeSemicolon(),e=this.finalize(t,new a.ExportAllDeclaration(i))}else if(4===this.lookahead.type){switch(n=void 0,this.lookahead.value){case"let":case"const":n=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":n=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}e=this.finalize(t,new a.ExportNamedDeclaration(n,[],null))}else if(this.matchAsyncFunction())n=this.parseFunctionDeclaration(),e=this.finalize(t,new a.ExportNamedDeclaration(n,[],null));else{var s=[],l=null,c=!1;for(this.expect("{");!this.match("}");)c=c||this.matchKeyword("default"),s.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),l=this.parseModuleSpecifier(),this.consumeSemicolon()):c?(r=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause,this.throwError(r,this.lookahead.value)):this.consumeSemicolon(),e=this.finalize(t,new a.ExportNamedDeclaration(null,s,l))}return e},e}();t.Parser=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("ASSERT: "+t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var n=new Error(e);try{throw n}catch(e){Object.create&&Object.defineProperty&&(n=Object.create(e),Object.defineProperty(n,"column",{value:t}))}return n},e.prototype.createError=function(e,t,n,r){var i="Line "+t+": "+r,o=this.constructError(i,n);return o.index=e,o.lineNumber=t,o.description=r,o},e.prototype.throwError=function(e,t,n,r){throw this.createError(e,t,n,r)},e.prototype.tolerateError=function(e,t,n,r){var i=this.createError(e,t,n,r);if(!this.tolerant)throw i;this.recordError(i)},e}();t.ErrorHandler=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(4),o=n(11);function a(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function s(e){return"01234567".indexOf(e)}var l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=o.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,n,r=[];for(this.trackComment&&(r=[],t=this.index-e,n={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{}});!this.eof();){var o=this.source.charCodeAt(this.index);if(++this.index,i.Character.isLineTerminator(o)){if(this.trackComment){n.end={line:this.lineNumber,column:this.index-this.lineStart-1};var a={multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:n};r.push(a)}return 13===o&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,r}}return this.trackComment&&(n.end={line:this.lineNumber,column:this.index-this.lineStart},a={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:n},r.push(a)),r},e.prototype.skipMultiLineComment=function(){var e,t,n=[];for(this.trackComment&&(n=[],e=this.index-2,t={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var r=this.source.charCodeAt(this.index);if(i.Character.isLineTerminator(r))13===r&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===r){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var o={multiLine:!0,slice:[e+2,this.index-2],range:[e,this.index],loc:t};n.push(o)}return n}++this.index}else++this.index}return this.trackComment&&(t.end={line:this.lineNumber,column:this.index-this.lineStart},o={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t},n.push(o)),this.tolerateUnexpectedToken(),n},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var n=this.source.charCodeAt(this.index);if(i.Character.isWhiteSpace(n))++this.index;else if(i.Character.isLineTerminator(n))++this.index,13===n&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===n)if(47===(n=this.source.charCodeAt(this.index+1))){this.index+=2;var r=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(r)),t=!0}else{if(42!==n)break;this.index+=2,r=this.skipMultiLineComment(),this.trackComment&&(e=e.concat(r))}else if(t&&45===n){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3,r=this.skipSingleLineComment(3),this.trackComment&&(e=e.concat(r))}else{if(60!==n||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4,r=this.skipSingleLineComment(4),this.trackComment&&(e=e.concat(r))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){var n=this.source.charCodeAt(e+1);n>=56320&&n<=57343&&(t=1024*(t-55296)+n-56320+65536)}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,n=0,r=0;r<t;++r){if(this.eof()||!i.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;n=16*n+a(this.source[this.index++])}return String.fromCharCode(n)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],i.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+a(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),i.Character.fromCodePoint(t)},e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!i.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e,t=this.codePointAt(this.index),n=i.Character.fromCodePoint(t);for(this.index+=n.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&i.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken(),n=e);!this.eof()&&(t=this.codePointAt(this.index),i.Character.isIdentifierPart(t));)n+=e=i.Character.fromCodePoint(t),this.index+=e.length,92===t&&(n=n.substr(0,n.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&i.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken(),n+=e);return n},e.prototype.octalToDecimal=function(e){var t="0"!==e,n=s(e);return!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,n=8*n+s(this.source[this.index++]),"0123".indexOf(e)>=0&&!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(n=8*n+s(this.source[this.index++]))),{code:n,octal:t}},e.prototype.scanIdentifier=function(){var e,t=this.index,n=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!=(e=1===n.length?3:this.isKeyword(n)?4:"null"===n?5:"true"===n||"false"===n?1:3)&&t+n.length!==this.index){var r=this.index;this.index=t,this.tolerateUnexpectedToken(o.Messages.InvalidEscapedReservedWord),this.index=r}return{type:e,value:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){for(var t="";!this.eof()&&i.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),i.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){for(var t,n="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)n+=this.source[this.index++];return 0===n.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),(i.Character.isIdentifierStart(t)||i.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(n,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){var n="",r=!1;for(i.Character.isOctalDigit(e.charCodeAt(0))?(r=!0,n="0"+this.source[this.index++]):++this.index;!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];return r||0!==n.length||this.throwUnexpectedToken(),(i.Character.isIdentifierStart(this.source.charCodeAt(this.index))||i.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(n,8),octal:r,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1;if(!i.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e];r.assert(i.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var n="";if("."!==t){if(n=this.source[this.index++],t=this.source[this.index],"0"===n){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e);if(t&&i.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(n+=this.source[this.index++];i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(n+=this.source[this.index++],"+"!==(t=this.source[this.index])&&"-"!==t||(n+=this.source[this.index++]),i.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];else this.throwUnexpectedToken();return i.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){var e=this.index,t=this.source[e];r.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var n=!1,a="";!this.eof();){var s=this.source[this.index++];if(s===t){t="";break}if("\\"===s)if((s=this.source[this.index++])&&i.Character.isLineTerminator(s.charCodeAt(0)))++this.lineNumber,"\r"===s&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(s){case"u":if("{"===this.source[this.index])++this.index,a+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(s);null===l&&this.throwUnexpectedToken(),a+=l}break;case"x":var c=this.scanHexEscape(s);null===c&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),a+=c;break;case"n":a+="\n";break;case"r":a+="\r";break;case"t":a+="\t";break;case"b":a+="\b";break;case"f":a+="\f";break;case"v":a+="\v";break;case"8":case"9":a+=s,this.tolerateUnexpectedToken();break;default:if(s&&i.Character.isOctalDigit(s.charCodeAt(0))){var u=this.octalToDecimal(s);n=u.octal||n,a+=String.fromCharCode(u.code)}else a+=s}else{if(i.Character.isLineTerminator(s.charCodeAt(0)))break;a+=s}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:a,octal:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){var e="",t=!1,n=this.index,r="`"===this.source[n],a=!1,s=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){s=1,a=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=l}else if("\\"===l)if(l=this.source[this.index++],i.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var c=this.index,u=this.scanHexEscape(l);null!==u?e+=u:(this.index=c,e+=l)}break;case"x":var d=this.scanHexEscape(l);null===d&&this.throwUnexpectedToken(o.Messages.InvalidHexEscapeSequence),e+=d;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===l?(i.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral),e+="\0"):i.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(o.Messages.TemplateOctalLiteral):e+=l}else i.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),r||this.curlyStack.pop(),{type:10,value:this.source.slice(n+1,this.index-s),cooked:e,head:r,tail:a,lineNumber:this.lineNumber,lineStart:this.lineStart,start:n,end:this.index}},e.prototype.testRegExp=function(e,t){var n=e,r=this;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function(e,t,n){var i=parseInt(t||n,16);return i>1114111&&r.throwUnexpectedToken(o.Messages.InvalidRegExp),i<=65535?String.fromCharCode(i):""}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(n)}catch(e){this.throwUnexpectedToken(o.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index];r.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],n=!1,a=!1;!this.eof();)if(t+=e=this.source[this.index++],"\\"===e)e=this.source[this.index++],i.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t+=e;else if(i.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(o.Messages.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){a=!0;break}"["===e&&(n=!0)}return a||this.throwUnexpectedToken(o.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="";!this.eof();){var t=this.source[this.index];if(!i.Character.isIdentifierPart(t.charCodeAt(0)))break;if(++this.index,"\\"!==t||this.eof())e+=t;else if("u"===(t=this.source[this.index])){++this.index;var n=this.index,r=this.scanHexEscape("u");if(null!==r)for(e+=r;n<this.index;++n)this.source[n];else this.index=n,e+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return e},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),n=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:n,regex:this.testRegExp(t,n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index);return i.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?i.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():i.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&i.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},e}();t.Scanner=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(12),o=n(13),a=function(){function e(){this.values=[],this.curly=this.paren=-1}return e.prototype.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var n=this.values[this.paren-1];t="if"===n||"while"===n||"for"===n||"with"===n;break;case"}":if(t=!1,"function"===this.values[this.curly-3])t=!!(r=this.values[this.curly-4])&&!this.beforeFunctionExpression(r);else if("function"===this.values[this.curly-4]){var r;t=!(r=this.values[this.curly-5])||!this.beforeFunctionExpression(r)}}return t},e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),s=function(){function e(e,t){this.errorHandler=new r.ErrorHandler,this.errorHandler.tolerant=!!t&&"boolean"==typeof t.tolerant&&t.tolerant,this.scanner=new i.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&"boolean"==typeof t.comment&&t.comment,this.trackRange=!!t&&"boolean"==typeof t.range&&t.range,this.trackLoc=!!t&&"boolean"==typeof t.loc&&t.loc,this.buffer=[],this.reader=new a}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var n=e[t],r=this.scanner.source.slice(n.slice[0],n.slice[1]),i={type:n.multiLine?"BlockComment":"LineComment",value:r};this.trackRange&&(i.range=n.range),this.trackLoc&&(i.loc=n.loc),this.buffer.push(i)}if(!this.scanner.eof()){var a=void 0;this.trackLoc&&(a={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var s="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(s);var l={type:o.TokenName[s.type],value:this.scanner.source.slice(s.start,s.end)};if(this.trackRange&&(l.range=[s.start,s.end]),this.trackLoc&&(a.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=a),9===s.type){var c=s.pattern,u=s.flags;l.regex={pattern:c,flags:u}}this.buffer.push(l)}}return this.buffer.shift()},e}();t.Tokenizer=s}])},e.exports=r()},function(e,t,n){"use strict";var r=n(38),i=n(53),o=n(76),a=n(54),s=Object.prototype.toString,l=Object.prototype.hasOwnProperty,c={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},u=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function d(e){var t,n,o;if(t=e.toString(16).toUpperCase(),e<=255)n="x",o=2;else if(e<=65535)n="u",o=4;else{if(!(e<=4294967295))throw new i("code point within a string may not be greater than 0xFFFFFFFF");n="U",o=8}return"\\"+n+r.repeat("0",o-t.length)+t}function p(e){this.schema=e.schema||o,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=r.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var n,r,i,o,a,s,c;if(null===t)return{};for(n={},i=0,o=(r=Object.keys(t)).length;i<o;i+=1)a=r[i],s=String(t[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),(c=e.compiledTypeMap.fallback[a])&&l.call(c.styleAliases,s)&&(s=c.styleAliases[s]),n[a]=s;return n}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function h(e,t){for(var n,i=r.repeat(" ",t),o=0,a=-1,s="",l=e.length;o<l;)-1===(a=e.indexOf("\n",o))?(n=e.slice(o),o=l):(n=e.slice(o,a+1),o=a+1),n.length&&"\n"!==n&&(s+=i),s+=n;return s}function f(e,t){return"\n"+r.repeat(" ",e.indent*t)}function m(e){return 32===e||9===e}function g(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&65279!==e||65536<=e&&e<=1114111}function v(e,t){return g(e)&&65279!==e&&44!==e&&91!==e&&93!==e&&123!==e&&125!==e&&58!==e&&(35!==e||t&&function(e){return g(e)&&!m(e)&&65279!==e&&13!==e&&10!==e}(t))}function y(e){return/^\n* /.test(e)}function b(e,t,n,r,i){var o,a,s,l,c=!1,u=!1,d=-1!==r,p=-1,h=g(l=e.charCodeAt(0))&&65279!==l&&!m(l)&&45!==l&&63!==l&&58!==l&&44!==l&&91!==l&&93!==l&&123!==l&&125!==l&&35!==l&&38!==l&&42!==l&&33!==l&&124!==l&&61!==l&&62!==l&&39!==l&&34!==l&&37!==l&&64!==l&&96!==l&&!m(e.charCodeAt(e.length-1));if(t)for(o=0;o<e.length;o++){if(!g(a=e.charCodeAt(o)))return 5;s=o>0?e.charCodeAt(o-1):null,h=h&&v(a,s)}else{for(o=0;o<e.length;o++){if(10===(a=e.charCodeAt(o)))c=!0,d&&(u=u||o-p-1>r&&" "!==e[p+1],p=o);else if(!g(a))return 5;s=o>0?e.charCodeAt(o-1):null,h=h&&v(a,s)}u=u||d&&o-p-1>r&&" "!==e[p+1]}return c||u?n>9&&y(e)?5:u?4:3:h&&!i(e)?1:2}function C(e,t,n,r){e.dump=function(){if(0===t.length)return"''";if(!e.noCompatMode&&-1!==u.indexOf(t))return"'"+t+"'";var o=e.indent*Math.max(1,n),a=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-o),s=r||e.flowLevel>-1&&n>=e.flowLevel;switch(b(t,s,e.indent,a,function(t){return function(e,t){var n,r;for(n=0,r=e.implicitTypes.length;n<r;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}(e,t)})){case 1:return t;case 2:return"'"+t.replace(/'/g,"''")+"'";case 3:return"|"+w(t,e.indent)+E(h(t,o));case 4:return">"+w(t,e.indent)+E(h(function(e,t){for(var n,r,i,o=/(\n+)([^\n]*)/g,a=(i=-1!==(i=e.indexOf("\n"))?i:e.length,o.lastIndex=i,T(e.slice(0,i),t)),s="\n"===e[0]||" "===e[0];r=o.exec(e);){var l=r[1],c=r[2];n=" "===c[0],a+=l+(s||n||""===c?"":"\n")+T(c,t),s=n}return a}(t,a),o));case 5:return'"'+function(e){for(var t,n,r,i="",o=0;o<e.length;o++)(t=e.charCodeAt(o))>=55296&&t<=56319&&(n=e.charCodeAt(o+1))>=56320&&n<=57343?(i+=d(1024*(t-55296)+n-56320+65536),o++):i+=!(r=c[t])&&g(t)?e[o]:r||d(t);return i}(t)+'"';default:throw new i("impossible error: invalid scalar style")}}()}function w(e,t){var n=y(e)?String(t):"",r="\n"===e[e.length-1];return n+(!r||"\n"!==e[e.length-2]&&"\n"!==e?r?"":"-":"+")+"\n"}function E(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function T(e,t){if(""===e||" "===e[0])return e;for(var n,r,i=/ [^ ]/g,o=0,a=0,s=0,l="";n=i.exec(e);)(s=n.index)-o>t&&(r=a>o?a:s,l+="\n"+e.slice(o,r),o=r+1),a=s;return l+="\n",e.length-o>t&&a>o?l+=e.slice(o,a)+"\n"+e.slice(a+1):l+=e.slice(o),l.slice(1)}function x(e,t,n){var r,o,a,c,u,d;for(a=0,c=(o=n?e.explicitTypes:e.implicitTypes).length;a<c;a+=1)if(((u=o[a]).instanceOf||u.predicate)&&(!u.instanceOf||"object"==typeof t&&t instanceof u.instanceOf)&&(!u.predicate||u.predicate(t))){if(e.tag=n?u.tag:"?",u.represent){if(d=e.styleMap[u.tag]||u.defaultStyle,"[object Function]"===s.call(u.represent))r=u.represent(t,d);else{if(!l.call(u.represent,d))throw new i("!<"+u.tag+'> tag resolver accepts not "'+d+'" style');r=u.represent[d](t,d)}e.dump=r}return!0}return!1}function _(e,t,n,r,o,a){e.tag=null,e.dump=n,x(e,n,!1)||x(e,n,!0);var l=s.call(e.dump);r&&(r=e.flowLevel<0||e.flowLevel>t);var c,u,d="[object Object]"===l||"[object Array]"===l;if(d&&(u=-1!==(c=e.duplicates.indexOf(n))),(null!==e.tag&&"?"!==e.tag||u||2!==e.indent&&t>0)&&(o=!1),u&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(d&&u&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),"[object Object]"===l)r&&0!==Object.keys(e.dump).length?(function(e,t,n,r){var o,a,s,l,c,u,d="",p=e.tag,h=Object.keys(n);if(!0===e.sortKeys)h.sort();else if("function"==typeof e.sortKeys)h.sort(e.sortKeys);else if(e.sortKeys)throw new i("sortKeys must be a boolean or a function");for(o=0,a=h.length;o<a;o+=1)u="",r&&0===o||(u+=f(e,t)),l=n[s=h[o]],_(e,t+1,s,!0,!0,!0)&&((c=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&10===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,c&&(u+=f(e,t)),_(e,t+1,l,!0,c)&&(e.dump&&10===e.dump.charCodeAt(0)?u+=":":u+=": ",d+=u+=e.dump));e.tag=p,e.dump=d||"{}"}(e,t,e.dump,o),u&&(e.dump="&ref_"+c+e.dump)):(function(e,t,n){var r,i,o,a,s,l="",c=e.tag,u=Object.keys(n);for(r=0,i=u.length;r<i;r+=1)s="",0!==r&&(s+=", "),e.condenseFlow&&(s+='"'),a=n[o=u[r]],_(e,t,o,!1,!1)&&(e.dump.length>1024&&(s+="? "),s+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),_(e,t,a,!1,!1)&&(l+=s+=e.dump));e.tag=c,e.dump="{"+l+"}"}(e,t,e.dump),u&&(e.dump="&ref_"+c+" "+e.dump));else if("[object Array]"===l){var p=e.noArrayIndent&&t>0?t-1:t;r&&0!==e.dump.length?(function(e,t,n,r){var i,o,a="",s=e.tag;for(i=0,o=n.length;i<o;i+=1)_(e,t+1,n[i],!0,!0)&&(r&&0===i||(a+=f(e,t)),e.dump&&10===e.dump.charCodeAt(0)?a+="-":a+="- ",a+=e.dump);e.tag=s,e.dump=a||"[]"}(e,p,e.dump,o),u&&(e.dump="&ref_"+c+e.dump)):(function(e,t,n){var r,i,o="",a=e.tag;for(r=0,i=n.length;r<i;r+=1)_(e,t,n[r],!1,!1)&&(0!==r&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=a,e.dump="["+o+"]"}(e,p,e.dump),u&&(e.dump="&ref_"+c+" "+e.dump))}else{if("[object String]"!==l){if(e.skipInvalid)return!1;throw new i("unacceptable kind of an object to dump "+l)}"?"!==e.tag&&C(e,e.dump,t,a)}null!==e.tag&&"?"!==e.tag&&(e.dump="!<"+e.tag+"> "+e.dump)}return!0}function S(e,t){var n,r,i=[],o=[];for(function e(t,n,r){var i,o,a;if(null!==t&&"object"==typeof t)if(-1!==(o=n.indexOf(t)))-1===r.indexOf(o)&&r.push(o);else if(n.push(t),Array.isArray(t))for(o=0,a=t.length;o<a;o+=1)e(t[o],n,r);else for(o=0,a=(i=Object.keys(t)).length;o<a;o+=1)e(t[i[o]],n,r)}(e,i,o),n=0,r=o.length;n<r;n+=1)t.duplicates.push(i[o[n]]);t.usedDuplicates=new Array(r)}function I(e,t){var n=new p(t=t||{});return n.noRefs||S(e,n),_(n,0,e,!0,!0)?n.dump+"\n":""}e.exports.dump=I,e.exports.safeDump=function(e,t){return I(e,r.extend({schema:a},t))}},function(e,t,n){"use strict";n(31),n(32),n(33),n(64),n(19),n(65),n(20),n(68),n(92),n(144),n(22),n(94),n(23);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(91),l=n(1),c=n(183),u=n(0),d=n(7),p=n(95),h=n(69),f=n(3),m=n(305),g=n(306),v=n(307),y=function(e){function t(t,n){void 0===n&&(n=!1);var r=e.call(this)||this;return r._hasDeclaration=!1,r._docTypeName="",r._hasDocumentElement=!1,r._currentElementSerialized=!1,r._openTags=[],r._ended=!1,r._fragment=n,r._options=l.applyDefaults(t||{},s.DefaultXMLBuilderCBOptions),r._builderOptions={defaultNamespace:r._options.defaultNamespace,namespaceAlias:r._options.namespaceAlias},"json"===r._options.format?r._writer=new g.JSONCBWriter(r._options):"yaml"===r._options.format?r._writer=new v.YAMLCBWriter(r._options):r._writer=new m.XMLCBWriter(r._options),void 0!==r._options.data&&r.on("data",r._options.data),void 0!==r._options.end&&r.on("end",r._options.end),void 0!==r._options.error&&r.on("error",r._options.error),r._prefixMap=new p.NamespacePrefixMap,r._prefixMap.set("xml",d.namespace.XML),r._prefixIndex={value:1},r._push(r._writer.frontMatter()),r}return i(t,e),t.prototype.ele=function(e,t,n){var r,i;if(l.isObject(e)||l.isString(e)&&(/^\s*</.test(e)||/^\s*[\{\[]/.test(e)||/^(\s*|(#.*)|(%.*))*---/.test(e))){var a=c.fragment().set(this._options);try{a.ele(e)}catch(e){return this.emit("error",e),this}try{for(var s=o(a.node.childNodes),u=s.next();!u.done;u=s.next()){var d=u.value;this._fromNode(d)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return this}if(this._serializeOpenTag(!0),!this._fragment&&this._hasDocumentElement&&0===this._writer.level)return this.emit("error",new Error("Document cannot have multiple document element nodes.")),this;try{this._currentElement=c.fragment(this._builderOptions).ele(e,t,n)}catch(e){return this.emit("error",e),this}return this._fragment||this._hasDocumentElement||""===this._docTypeName||this._currentElement.node._qualifiedName===this._docTypeName?(this._currentElementSerialized=!1,this._fragment||(this._hasDocumentElement=!0),this):(this.emit("error",new Error("Document element name does not match DocType declaration name.")),this)},t.prototype.att=function(e,t,n){if(void 0===this._currentElement)return this.emit("error",new Error("Cannot insert an attribute node as child of a document node.")),this;try{this._currentElement.att(e,t,n)}catch(e){return this.emit("error",e),this}return this},t.prototype.com=function(e){var t;this._serializeOpenTag(!0);try{t=c.fragment(this._builderOptions).com(e).first().node}catch(e){return this.emit("error",e),this}return!this._options.wellFormed||u.xml_isLegalChar(t.data)&&-1===t.data.indexOf("--")&&!t.data.endsWith("-")?(this._push(this._writer.comment(t.data)),this):(this.emit("error",new Error("Comment data contains invalid characters (well-formed required).")),this)},t.prototype.txt=function(e){if(!this._fragment&&void 0===this._currentElement)return this.emit("error",new Error("Cannot insert a text node as child of a document node.")),this;var t;this._serializeOpenTag(!0);try{t=c.fragment(this._builderOptions).txt(e).first().node}catch(e){return this.emit("error",e),this}if(this._options.wellFormed&&!u.xml_isLegalChar(t.data))return this.emit("error",new Error("Text data contains invalid characters (well-formed required).")),this;var n=t.data.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this._push(this._writer.text(n)),this},t.prototype.ins=function(e,t){var n;void 0===t&&(t=""),this._serializeOpenTag(!0);try{n=c.fragment(this._builderOptions).ins(e,t).first().node}catch(e){return this.emit("error",e),this}return this._options.wellFormed&&(-1!==n.target.indexOf(":")||/^xml$/i.test(n.target))?(this.emit("error",new Error("Processing instruction target contains invalid characters (well-formed required).")),this):this._options.wellFormed&&!u.xml_isLegalChar(n.data)?(this.emit("error",Error("Processing instruction data contains invalid characters (well-formed required).")),this):(this._push(this._writer.instruction(n.target,n.data)),this)},t.prototype.dat=function(e){var t;this._serializeOpenTag(!0);try{t=c.fragment(this._builderOptions).dat(e).first().node}catch(e){return this.emit("error",e),this}return this._push(this._writer.cdata(t.data)),this},t.prototype.dec=function(e){return void 0===e&&(e={version:"1.0"}),this._fragment?(this.emit("error",Error("Cannot insert an XML declaration into a document fragment.")),this):this._hasDeclaration?(this.emit("error",Error("XML declaration is already inserted.")),this):(this._push(this._writer.declaration(e.version||"1.0",e.encoding,e.standalone)),this._hasDeclaration=!0,this)},t.prototype.dtd=function(e){if(this._fragment)return this.emit("error",Error("Cannot insert a DocType declaration into a document fragment.")),this;if(""!==this._docTypeName)return this.emit("error",new Error("DocType declaration is already inserted.")),this;if(this._hasDocumentElement)return this.emit("error",new Error("Cannot insert DocType declaration after document element.")),this;var t;try{t=c.create().dtd(e).first().node}catch(e){return this.emit("error",e),this}return this._options.wellFormed&&!u.xml_isPubidChar(t.publicId)?(this.emit("error",new Error("DocType public identifier does not match PubidChar construct (well-formed required).")),this):this._options.wellFormed&&(!u.xml_isLegalChar(t.systemId)||-1!==t.systemId.indexOf('"')&&-1!==t.systemId.indexOf("'"))?(this.emit("error",new Error("DocType system identifier contains invalid characters (well-formed required).")),this):(this._docTypeName=e.name,this._push(this._writer.docType(e.name,t.publicId,t.systemId)),this)},t.prototype.import=function(e){var t,n,r=c.fragment().set(this._options);try{r.import(e)}catch(e){return this.emit("error",e),this}try{for(var i=o(r.node.childNodes),a=i.next();!a.done;a=i.next()){var s=a.value;this._fromNode(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return this},t.prototype.up=function(){return this._serializeOpenTag(!1),this._serializeCloseTag(),this},t.prototype.end=function(){for(this._serializeOpenTag(!1);this._openTags.length>0;)this._serializeCloseTag();return this._push(null),this},t.prototype._serializeOpenTag=function(e){if(!this._currentElementSerialized&&void 0!==this._currentElement){var n=this._currentElement.node;if(!this._options.wellFormed||-1===n.localName.indexOf(":")&&u.xml_isName(n.localName)){var r="",i=!1,o=this._prefixMap.copy(),a={},s=this._recordNamespaceInformation(n,o,a),l=0===this._openTags.length?null:this._openTags[this._openTags.length-1][1],c=n.namespaceURI;if(null===c&&(c=l),l===c)null!==s&&(i=!0),r=c===d.namespace.XML?"xml:"+n.localName:n.localName,this._writer.beginElement(r),this._push(this._writer.openTagBegin(r));else{var p=n.prefix,h=null;if(null===p&&c===s||(h=o.get(p,c)),"xmlns"===p){if(this._options.wellFormed)return void this.emit("error",new Error("An element cannot have the 'xmlns' prefix (well-formed required)."));h=p}null!==h?(r=h+":"+n.localName,null!==s&&s!==d.namespace.XML&&(l=s||null),this._writer.beginElement(r),this._push(this._writer.openTagBegin(r))):null!==p?(p in a&&(p=this._generatePrefix(c,o,this._prefixIndex)),o.set(p,c),r+=p+":"+n.localName,this._writer.beginElement(r),this._push(this._writer.openTagBegin(r)),this._push(this._writer.attribute("xmlns:"+p,this._serializeAttributeValue(c,this._options.wellFormed))),null!==s&&(l=s||null)):null===s||null!==s&&s!==c?(i=!0,r+=n.localName,l=c,this._writer.beginElement(r),this._push(this._writer.openTagBegin(r)),this._push(this._writer.attribute("xmlns",this._serializeAttributeValue(c,this._options.wellFormed)))):(r+=n.localName,l=c,this._writer.beginElement(r),this._push(this._writer.openTagBegin(r)))}this._serializeAttributes(n,o,this._prefixIndex,a,i,this._options.wellFormed);var f=c===d.namespace.HTML;f&&!e&&t._VoidElementNames.has(n.localName)?(this._push(this._writer.openTagEnd(r,!0,!0)),this._writer.endElement(r)):f||e?this._push(this._writer.openTagEnd(r,!1,!1)):(this._push(this._writer.openTagEnd(r,!0,!1)),this._writer.endElement(r)),this._currentElementSerialized=!0,this._openTags.push([r,l,this._prefixMap,e]),this._isPrefixMapModified(this._prefixMap,o)&&(this._prefixMap=o),this._writer.level++}else this.emit("error",new Error("Node local name contains invalid characters (well-formed required)."))}},t.prototype._serializeCloseTag=function(){this._writer.level--;var e=this._openTags.pop();if(void 0!==e){var t=a(e,4),n=t[0],r=(t[1],t[2]),i=t[3];this._prefixMap=r,i&&(this._push(this._writer.closeTag(n)),this._writer.endElement(n))}else this.emit("error",new Error("Last element is undefined."))},t.prototype._push=function(e){null===e?(this._ended=!0,this.emit("end")):this._ended?this.emit("error",new Error("Cannot push to ended stream.")):0!==e.length&&(this._writer.hasData=!0,this.emit("data",e,this._writer.level))},t.prototype._fromNode=function(e){var t,n,r,i;if(f.Guard.isElementNode(e)){var a=e.prefix?e.prefix+":"+e.localName:e.localName;null!==e.namespaceURI?this.ele(e.namespaceURI,a):this.ele(a);try{for(var s=o(e.attributes),l=s.next();!l.done;l=s.next()){var c=l.value,u=c.prefix?c.prefix+":"+c.localName:c.localName;null!==c.namespaceURI?this.att(c.namespaceURI,u,c.value):this.att(u,c.value)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var d=o(e.childNodes),p=d.next();!p.done;p=d.next()){var h=p.value;this._fromNode(h)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}this.up()}else f.Guard.isExclusiveTextNode(e)&&e.data?this.txt(e.data):f.Guard.isCommentNode(e)?this.com(e.data):f.Guard.isCDATASectionNode(e)?this.dat(e.data):f.Guard.isProcessingInstructionNode(e)&&this.ins(e.target,e.data)},t.prototype._serializeAttributes=function(e,t,n,r,i,a){var s,l,c=a?new h.LocalNameSet:void 0;try{for(var p=o(e.attributes),f=p.next();!f.done;f=p.next()){var m=f.value;if(a||i||null!==m.namespaceURI){if(a&&c&&c.has(m.namespaceURI,m.localName))return void this.emit("error",new Error("Element contains duplicate attributes (well-formed required)."));a&&c&&c.set(m.namespaceURI,m.localName);var g=m.namespaceURI,v=null;if(null!==g)if(v=t.get(m.prefix,g),g===d.namespace.XMLNS){if(m.value===d.namespace.XML||null===m.prefix&&i||null!==m.prefix&&(!(m.localName in r)||r[m.localName]!==m.value)&&t.has(m.localName,m.value))continue;if(a&&m.value===d.namespace.XMLNS)return void this.emit("error",new Error("XMLNS namespace is reserved (well-formed required)."));if(a&&""===m.value)return void this.emit("error",new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required)."));"xmlns"===m.prefix&&(v="xmlns")}else null===v&&(v=null===m.prefix||t.hasPrefix(m.prefix)&&!t.has(m.prefix,g)?this._generatePrefix(g,t,n):m.prefix,this._push(this._writer.attribute("xmlns:"+v,this._serializeAttributeValue(g,this._options.wellFormed))));if(a&&(-1!==m.localName.indexOf(":")||!u.xml_isName(m.localName)||"xmlns"===m.localName&&null===g))return void this.emit("error",new Error("Attribute local name contains invalid characters (well-formed required)."));this._push(this._writer.attribute((null!==v?v+":":"")+m.localName,this._serializeAttributeValue(m.value,this._options.wellFormed)))}else this._push(this._writer.attribute(m.localName,this._serializeAttributeValue(m.value,this._options.wellFormed)))}}catch(e){s={error:e}}finally{try{f&&!f.done&&(l=p.return)&&l.call(p)}finally{if(s)throw s.error}}},t.prototype._serializeAttributeValue=function(e,t){return t&&null!==e&&!u.xml_isLegalChar(e)?(this.emit("error",new Error("Invalid characters in attribute value.")),""):null===e?"":e.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.prototype._recordNamespaceInformation=function(e,t,n){var r,i,a=null;try{for(var s=o(e.attributes),l=s.next();!l.done;l=s.next()){var c=l.value,u=c.namespaceURI,p=c.prefix;if(u===d.namespace.XMLNS){if(null===p){a=c.value;continue}var h=c.localName,f=c.value;if(f===d.namespace.XML)continue;if(""===f&&(f=null),t.has(h,f))continue;t.set(h,f),n[h]=f||""}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return a},t.prototype._generatePrefix=function(e,t,n){var r="ns"+n.value;return n.value++,t.set(r,e),r},t.prototype._isPrefixMapModified=function(e,t){var n=e._items,r=t._items,i=e._nullItems,o=t._nullItems;for(var a in r){var s=n[a];if(void 0===s)return!0;var l=r[a];if(s.length!==l.length)return!0;for(var c=0;c<s.length;c++)if(s[c]!==l[c])return!0}if(i.length!==o.length)return!0;for(c=0;c<i.length;c++)if(i[c]!==o[c])return!0;return!1},t._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),t}(n(308).EventEmitter);t.XMLBuilderCBImpl=y},function(e,t,n){"use strict";n(74);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;return n._lineLength=0,n}return i(t,e),t.prototype.frontMatter=function(){return""},t.prototype.declaration=function(e,t,n){var r=this._beginLine()+"<?xml";return r+=' version="'+e+'"',void 0!==t&&(r+=' encoding="'+t+'"'),void 0!==n&&(r+=' standalone="'+(n?"yes":"no")+'"'),r+"?>"},t.prototype.docType=function(e,t,n){return this._beginLine()+(t&&n?"<!DOCTYPE "+e+' PUBLIC "'+t+'" "'+n+'">':t?"<!DOCTYPE "+e+' PUBLIC "'+t+'">':n?"<!DOCTYPE "+e+' SYSTEM "'+n+'">':"<!DOCTYPE "+e+">")},t.prototype.comment=function(e){return this._beginLine()+"\x3c!--"+e+"--\x3e"},t.prototype.text=function(e){return this._beginLine()+e},t.prototype.instruction=function(e,t){return t?this._beginLine()+"<?"+e+" "+t+"?>":this._beginLine()+"<?"+e+"?>"},t.prototype.cdata=function(e){return this._beginLine()+"<![CDATA["+e+"]]>"},t.prototype.openTagBegin=function(e){return this._lineLength+=1+e.length,this._beginLine()+"<"+e},t.prototype.openTagEnd=function(e,t,n){return n?" />":t?this._writerOptions.allowEmptyTags?"></"+e+">":this._writerOptions.spaceBeforeSlash?" />":"/>":">"},t.prototype.closeTag=function(e){return this._beginLine()+"</"+e+">"},t.prototype.attribute=function(e,t){var n=e+'="'+t+'"';return this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._lineLength+1+n.length>this._writerOptions.width?(n=this._beginLine()+this._indent(1)+n,this._lineLength=n.length,n):(this._lineLength+=1+n.length," "+n)},t.prototype.beginElement=function(e){},t.prototype.endElement=function(e){},t.prototype._beginLine=function(){if(this._writerOptions.prettyPrint){var e=(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level);return this._lineLength=e.length,e}return""},t.prototype._indent=function(e){return e<=0?"":this._writerOptions.indent.repeat(e)},t}(n(114).BaseCBWriter);t.XMLCBWriter=o},function(e,t,n){"use strict";n(74);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;return n._hasChildren=[],n._additionalLevel=0,n}return i(t,e),t.prototype.frontMatter=function(){return""},t.prototype.declaration=function(e,t,n){return""},t.prototype.docType=function(e,t,n){return""},t.prototype.comment=function(e){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.comment)+this._sep()+this._val(e)+this._sep()+"}"},t.prototype.text=function(e){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.text)+this._sep()+this._val(e)+this._sep()+"}"},t.prototype.instruction=function(e,t){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.ins)+this._sep()+this._val(t?e+" "+t:e)+this._sep()+"}"},t.prototype.cdata=function(e){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.cdata)+this._sep()+this._val(e)+this._sep()+"}"},t.prototype.attribute=function(e,t){return this._comma()+this._beginLine(1)+"{"+this._sep()+this._key(this._builderOptions.convert.att+e)+this._sep()+this._val(t)+this._sep()+"}"},t.prototype.openTagBegin=function(e){var t=this._comma()+this._beginLine()+"{"+this._sep()+this._key(e)+this._sep()+"{";return this._additionalLevel++,this.hasData=!0,t+=this._beginLine()+this._key(this._builderOptions.convert.text)+this._sep()+"[",this._hasChildren.push(!1),t},t.prototype.openTagEnd=function(e,t,n){if(t){var r=this._sep()+"]";return this._additionalLevel--,r+(this._beginLine()+"}")+this._sep()+"}"}return""},t.prototype.closeTag=function(e){var t=this._beginLine()+"]";return this._additionalLevel--,t+(this._beginLine()+"}")+this._sep()+"}"},t.prototype.beginElement=function(e){},t.prototype.endElement=function(e){this._hasChildren.pop()},t.prototype._beginLine=function(e){return void 0===e&&(e=0),this._writerOptions.prettyPrint?(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level+e):""},t.prototype._indent=function(e){return e+this._additionalLevel<=0?"":this._writerOptions.indent.repeat(e+this._additionalLevel)},t.prototype._comma=function(){var e=this._hasChildren[this._hasChildren.length-1]?",":"";return this._hasChildren.length>0&&(this._hasChildren[this._hasChildren.length-1]=!0),e},t.prototype._sep=function(){return this._writerOptions.prettyPrint?" ":""},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t}(n(114).BaseCBWriter);t.JSONCBWriter=o},function(e,t,n){"use strict";n(74);var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;if(n._rootWritten=!1,n._additionalLevel=0,t.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(t.offset<0)throw new Error("YAML offset should be zero or a positive number.");return n}return i(t,e),t.prototype.frontMatter=function(){return this._beginLine()+"---"},t.prototype.declaration=function(e,t,n){return""},t.prototype.docType=function(e,t,n){return""},t.prototype.comment=function(e){return this._beginLine()+this._key(this._builderOptions.convert.comment)+" "+this._val(e)},t.prototype.text=function(e){return this._beginLine()+this._key(this._builderOptions.convert.text)+" "+this._val(e)},t.prototype.instruction=function(e,t){return this._beginLine()+this._key(this._builderOptions.convert.ins)+" "+this._val(t?e+" "+t:e)},t.prototype.cdata=function(e){return this._beginLine()+this._key(this._builderOptions.convert.cdata)+" "+this._val(e)},t.prototype.attribute=function(e,t){this._additionalLevel++;var n=this._beginLine()+this._key(this._builderOptions.convert.att+e)+" "+this._val(t);return this._additionalLevel--,n},t.prototype.openTagBegin=function(e){var t=this._beginLine()+this._key(e);return this._rootWritten||(this._rootWritten=!0),this.hasData=!0,this._additionalLevel++,t+(this._beginLine(!0)+this._key(this._builderOptions.convert.text))},t.prototype.openTagEnd=function(e,t,n){return t?" "+this._val(""):""},t.prototype.closeTag=function(e){return this._additionalLevel--,""},t.prototype.beginElement=function(e){},t.prototype.endElement=function(e){},t.prototype._beginLine=function(e){return void 0===e&&(e=!1),(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level,e)},t.prototype._indent=function(e,t){if(e+this._additionalLevel<=0)return"";var n=this._writerOptions.indent.repeat(e+this._additionalLevel);return!t&&this._rootWritten?n.substr(0,n.length-2)+"-"+n.substr(-1,1):n},t.prototype._key=function(e){return'"'+e+'":'},t.prototype._val=function(e){return JSON.stringify(e)},t}(n(114).BaseCBWriter);t.YAMLCBWriter=o},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,a,s;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=u(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s=l,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=p.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var c=l.length,u=g(l,c);for(n=0;n<c;++n)o(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77);t.createCB=function(e){return new r.XMLBuilderCBImpl(e)},t.fragmentCB=function(e){return new r.XMLBuilderCBImpl(e,!0)}}])},3848:(e,t,n)=>{"use strict";function r(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}n.d(t,{Z:()=>r})},85125:(e,t,n)=>{"use strict";function r(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}n.d(t,{Z:()=>r})},72018:(e,t,n)=>{"use strict";n.d(t,{b4:()=>s,YF:()=>i.Z,G9:()=>y,ly:()=>b,sd:()=>v,$R:()=>E});var r=n(3848),i=n(63021);const o=(0,i.Z)(r.Z),a=o.right,s=(o.left,(0,i.Z)(function(e){return null===e?NaN:+e}).center,a);l(d),l(function(e){const t=d(e);return(e,n,r,i,o)=>{t(e,n,(r<<=2)+0,(i<<=2)+0,o<<=2),t(e,n,r+1,i+1,o),t(e,n,r+2,i+2,o),t(e,n,r+3,i+3,o)}});function l(e){return function(t,n,r=n){if(!((n=+n)>=0))throw new RangeError("invalid rx");if(!((r=+r)>=0))throw new RangeError("invalid ry");let{data:i,width:o,height:a}=t;if(!((o=Math.floor(o))>=0))throw new RangeError("invalid width");if(!((a=Math.floor(void 0!==a?a:i.length/o))>=0))throw new RangeError("invalid height");if(!o||!a||!n&&!r)return t;const s=n&&e(n),l=r&&e(r),d=i.slice();return s&&l?(c(s,d,i,o,a),c(s,i,d,o,a),c(s,d,i,o,a),u(l,i,d,o,a),u(l,d,i,o,a),u(l,i,d,o,a)):s?(c(s,i,d,o,a),c(s,d,i,o,a),c(s,i,d,o,a)):l&&(u(l,i,d,o,a),u(l,d,i,o,a),u(l,i,d,o,a)),t}}function c(e,t,n,r,i){for(let o=0,a=r*i;o<a;)e(t,n,o,o+=r,1)}function u(e,t,n,r,i){for(let o=0,a=r*i;o<r;++o)e(t,n,o,o+a,r)}function d(e){const t=Math.floor(e);if(t===e)return function(e){const t=2*e+1;return(n,r,i,o,a)=>{if(!((o-=a)>=i))return;let s=e*r[i];const l=a*e;for(let e=i,t=i+l;e<t;e+=a)s+=r[Math.min(o,e)];for(let e=i,c=o;e<=c;e+=a)s+=r[Math.min(o,e+l)],n[e]=s/t,s-=r[Math.max(i,e-l)]}}(e);const n=e-t,r=2*e+1;return(e,i,o,a,s)=>{if(!((a-=s)>=o))return;let l=t*i[o];const c=s*t,u=c+s;for(let e=o,t=o+c;e<t;e+=s)l+=i[Math.min(a,e)];for(let t=o,d=a;t<=d;t+=s)l+=i[Math.min(a,t+c)],e[t]=(l+n*(i[Math.max(o,t-u)]+i[Math.min(a,t+u)]))/r,l-=i[Math.max(o,t-c)]}}n(85125);var p=Array.prototype;p.slice,p.map;const h=Math.sqrt(50),f=Math.sqrt(10),m=Math.sqrt(2);function g(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=h?10:o>=f?5:o>=m?2:1;let s,l,c;return i<0?(c=Math.pow(10,-i)/a,s=Math.round(e*c),l=Math.round(t*c),s/c<e&&++s,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*a,s=Math.round(e/c),l=Math.round(t/c),s*c<e&&++s,l*c>t&&--l),l<s&&.5<=n&&n<2?g(e,t,2*n):[s,l,c]}function v(e,t,n){if(!((n=+n)>0))return[];if((e=+e)===(t=+t))return[e];const r=t<e,[i,o,a]=r?g(t,e,n):g(e,t,n);if(!(o>=i))return[];const s=o-i+1,l=new Array(s);if(r)if(a<0)for(let e=0;e<s;++e)l[e]=(o-e)/-a;else for(let e=0;e<s;++e)l[e]=(o-e)*a;else if(a<0)for(let e=0;e<s;++e)l[e]=(i+e)/-a;else for(let e=0;e<s;++e)l[e]=(i+e)*a;return l}function y(e,t,n){return g(e=+e,t=+t,n=+n)[2]}function b(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?y(t,e,n):y(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}C=Math.random;var C;function w(e){return e.length}function E(){return function(e){if(!(i=e.length))return[];for(var t=-1,n=function(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}(e,w),r=new Array(n);++t<n;)for(var i,o=-1,a=r[t]=new Array(i);++o<i;)a[o]=e[o][t];return r}(arguments)}},37781:(e,t,n)=>{"use strict";function r(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function i(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function o(){}n.d(t,{$_:()=>w,K:()=>pe,Uc:()=>te,Ym:()=>N,B8:()=>_});var a=.7,s=1/a,l="\\s*([+-]?\\d+)\\s*",c="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",u="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",d=/^#([0-9a-f]{3,8})$/,p=new RegExp(`^rgb\\(${l},${l},${l}\\)$`),h=new RegExp(`^rgb\\(${u},${u},${u}\\)$`),f=new RegExp(`^rgba\\(${l},${l},${l},${c}\\)$`),m=new RegExp(`^rgba\\(${u},${u},${u},${c}\\)$`),g=new RegExp(`^hsl\\(${c},${u},${u}\\)$`),v=new RegExp(`^hsla\\(${c},${u},${u},${c}\\)$`),y={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function b(){return this.rgb().formatHex()}function C(){return this.rgb().formatRgb()}function w(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=d.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?E(t):3===n?new S(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?T(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?T(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=p.exec(e))?new S(t[1],t[2],t[3],1):(t=h.exec(e))?new S(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=f.exec(e))?T(t[1],t[2],t[3],t[4]):(t=m.exec(e))?T(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=g.exec(e))?R(t[1],t[2]/100,t[3]/100,1):(t=v.exec(e))?R(t[1],t[2]/100,t[3]/100,t[4]):y.hasOwnProperty(e)?E(y[e]):"transparent"===e?new S(NaN,NaN,NaN,0):null}function E(e){return new S(e>>16&255,e>>8&255,255&e,1)}function T(e,t,n,r){return r<=0&&(e=t=n=NaN),new S(e,t,n,r)}function x(e){return e instanceof o||(e=w(e)),e?new S((e=e.rgb()).r,e.g,e.b,e.opacity):new S}function _(e,t,n,r){return 1===arguments.length?x(e):new S(e,t,n,null==r?1:r)}function S(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function I(){return`#${O(this.r)}${O(this.g)}${O(this.b)}`}function D(){const e=A(this.opacity);return`${1===e?"rgb(":"rgba("}${P(this.r)}, ${P(this.g)}, ${P(this.b)}${1===e?")":`, ${e})`}`}function A(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function P(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function O(e){return((e=P(e))<16?"0":"")+e.toString(16)}function R(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new L(e,t,n,r)}function M(e){if(e instanceof L)return new L(e.h,e.s,e.l,e.opacity);if(e instanceof o||(e=w(e)),!e)return new L;if(e instanceof L)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,l=a-i,c=(a+i)/2;return l?(s=t===a?(n-r)/l+6*(n<r):n===a?(r-t)/l+2:(t-n)/l+4,l/=c<.5?a+i:2-a-i,s*=60):l=c>0&&c<1?0:s,new L(s,l,c,e.opacity)}function N(e,t,n,r){return 1===arguments.length?M(e):new L(e,t,n,null==r?1:r)}function L(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function k(e){return(e=(e||0)%360)<0?e+360:e}function F(e){return Math.max(0,Math.min(1,e||0))}function V(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}r(o,w,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:b,formatHex:b,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return M(this).formatHsl()},formatRgb:C,toString:C}),r(S,_,i(o,{brighter(e){return e=null==e?s:Math.pow(s,e),new S(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?a:Math.pow(a,e),new S(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new S(P(this.r),P(this.g),P(this.b),A(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:I,formatHex:I,formatHex8:function(){return`#${O(this.r)}${O(this.g)}${O(this.b)}${O(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:D,toString:D})),r(L,N,i(o,{brighter(e){return e=null==e?s:Math.pow(s,e),new L(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?a:Math.pow(a,e),new L(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new S(V(e>=240?e-240:e+120,i,r),V(e,i,r),V(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new L(k(this.h),F(this.s),F(this.l),A(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=A(this.opacity);return`${1===e?"hsl(":"hsla("}${k(this.h)}, ${100*F(this.s)}%, ${100*F(this.l)}%${1===e?")":`, ${e})`}`}}));const U=Math.PI/180,B=180/Math.PI,G=.96422,W=1,z=.82521,H=4/29,j=6/29,Z=3*j*j,K=j*j*j;function $(e){if(e instanceof q)return new q(e.l,e.a,e.b,e.opacity);if(e instanceof ne)return re(e);e instanceof S||(e=x(e));var t,n,r=Q(e.r),i=Q(e.g),o=Q(e.b),a=X((.2225045*r+.7168786*i+.0606169*o)/W);return r===i&&i===o?t=n=a:(t=X((.4360747*r+.3850649*i+.1430804*o)/G),n=X((.0139322*r+.0971045*i+.7141733*o)/z)),new q(116*a-16,500*(t-a),200*(a-n),e.opacity)}function q(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function X(e){return e>K?Math.pow(e,1/3):e/Z+H}function Y(e){return e>j?e*e*e:Z*(e-H)}function J(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Q(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ee(e){if(e instanceof ne)return new ne(e.h,e.c,e.l,e.opacity);if(e instanceof q||(e=$(e)),0===e.a&&0===e.b)return new ne(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*B;return new ne(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function te(e,t,n,r){return 1===arguments.length?ee(e):new ne(e,t,n,null==r?1:r)}function ne(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function re(e){if(isNaN(e.h))return new q(e.l,0,0,e.opacity);var t=e.h*U;return new q(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}r(q,function(e,t,n,r){return 1===arguments.length?$(e):new q(e,t,n,null==r?1:r)},i(o,{brighter(e){return new q(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker(e){return new q(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new S(J(3.1338561*(t=G*Y(t))-1.6168667*(e=W*Y(e))-.4906146*(n=z*Y(n))),J(-.9787684*t+1.9161415*e+.033454*n),J(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),r(ne,te,i(o,{brighter(e){return new ne(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker(e){return new ne(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb(){return re(this).rgb()}}));var ie=-.14861,oe=1.78277,ae=-.29227,se=-.90649,le=1.97294,ce=le*se,ue=le*oe,de=oe*ae-se*ie;function pe(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof he)return new he(e.h,e.s,e.l,e.opacity);e instanceof S||(e=x(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(de*r+ce*t-ue*n)/(de+ce-ue),o=r-i,a=(le*(n-i)-ae*o)/se,s=Math.sqrt(a*a+o*o)/(le*i*(1-i)),l=s?Math.atan2(a,o)*B-120:NaN;return new he(l<0?l+360:l,s,i,e.opacity)}(e):new he(e,t,n,null==r?1:r)}function he(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}r(he,pe,i(o,{brighter(e){return e=null==e?s:Math.pow(s,e),new he(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?a:Math.pow(a,e),new he(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*U,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new S(255*(t+n*(ie*r+oe*i)),255*(t+n*(ae*r+se*i)),255*(t+n*(le*r)),this.opacity)}}))},90583:(e,t,n)=>{"use strict";n.d(t,{sX:()=>w,nH:()=>o,k4:()=>g,uL:()=>E,q$:()=>R});var r=n(37781);function i(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}function o(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),o=e[r],a=e[r+1],s=r>0?e[r-1]:2*o-a,l=r<t-1?e[r+2]:2*a-o;return i((n-r/t)*t,s,o,a,l)}}const a=e=>()=>e;function s(e,t){return function(n){return e+n*t}}function l(e,t){var n=t-e;return n?s(e,n>180||n<-180?n-360*Math.round(n/360):n):a(isNaN(e)?t:e)}function c(e){return 1===(e=+e)?u:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):a(isNaN(t)?n:t)}}function u(e,t){var n=t-e;return n?s(e,n):a(isNaN(e)?t:e)}const d=function e(t){var n=c(t);function i(e,t){var i=n((e=(0,r.B8)(e)).r,(t=(0,r.B8)(t)).r),o=n(e.g,t.g),a=n(e.b,t.b),s=u(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=o(t),e.b=a(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function p(e){return function(t){var n,i,o=t.length,a=new Array(o),s=new Array(o),l=new Array(o);for(n=0;n<o;++n)i=(0,r.B8)(t[n]),a[n]=i.r||0,s[n]=i.g||0,l[n]=i.b||0;return a=e(a),s=e(s),l=e(l),i.opacity=1,function(e){return i.r=a(e),i.g=s(e),i.b=l(e),i+""}}}p(o),p(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),o=e[(r+t-1)%t],a=e[r%t],s=e[(r+1)%t],l=e[(r+2)%t];return i((n-r/t)*t,o,a,s,l)}});function h(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function f(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=w(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function m(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function g(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function v(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=w(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var y=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,b=new RegExp(y.source,"g");function C(e,t){var n,r,i,o=y.lastIndex=b.lastIndex=0,a=-1,s=[],l=[];for(e+="",t+="";(n=y.exec(e))&&(r=b.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,l.push({i:a,x:g(n,r)})),o=b.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function w(e,t){var n,i,o=typeof t;return null==t||"boolean"===o?a(t):("number"===o?g:"string"===o?(n=(0,r.$_)(t))?(t=n,d):C:t instanceof r.$_?d:t instanceof Date?m:(i=t,!ArrayBuffer.isView(i)||i instanceof DataView?Array.isArray(t)?f:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?v:g:h))(e,t)}function E(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var T,x=180/Math.PI,_={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function S(e,t,n,r,i,o){var a,s,l;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*x,skewX:Math.atan(l)*x,scaleX:a,scaleY:s}}function I(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(o,a){var s=[],l=[];return o=e(o),a=e(a),function(e,r,i,o,a,s){if(e!==i||r!==o){var l=a.push("translate(",null,t,null,n);s.push({i:l-4,x:g(e,i)},{i:l-2,x:g(r,o)})}else(i||o)&&a.push("translate("+i+t+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,l),function(e,t,n,o){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:g(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(o.rotate,a.rotate,s,l),function(e,t,n,o){e!==t?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:g(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(o.skewX,a.skewX,s,l),function(e,t,n,r,o,a){if(e!==n||t!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:g(e,n)},{i:s-2,x:g(t,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,l),o=a=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}I(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?_:S(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),I(function(e){return null==e?_:(T||(T=document.createElementNS("http://www.w3.org/2000/svg","g")),T.setAttribute("transform",e),(e=T.transform.baseVal.consolidate())?S((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):_)},", ",")",")");function D(e){return((e=Math.exp(e))+1/e)/2}(function e(t,n,r){function i(e,i){var o,a,s=e[0],l=e[1],c=e[2],u=i[0],d=i[1],p=i[2],h=u-s,f=d-l,m=h*h+f*f;if(m<1e-12)a=Math.log(p/c)/t,o=function(e){return[s+e*h,l+e*f,c*Math.exp(t*e*a)]};else{var g=Math.sqrt(m),v=(p*p-c*c+r*m)/(2*c*n*g),y=(p*p-c*c-r*m)/(2*p*n*g),b=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(y*y+1)-y);a=(C-b)/t,o=function(e){var r,i=e*a,o=D(b),u=c/(n*g)*(o*(r=t*i+b,((r=Math.exp(2*r))-1)/(r+1))-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+u*h,l+u*f,c*o/D(t*i+b)]}}return o.duration=1e3*a*t/Math.SQRT2,o}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i})(Math.SQRT2,2,4);function A(e){return function(t,n){var i=e((t=(0,r.Ym)(t)).h,(n=(0,r.Ym)(n)).h),o=u(t.s,n.s),a=u(t.l,n.l),s=u(t.opacity,n.opacity);return function(e){return t.h=i(e),t.s=o(e),t.l=a(e),t.opacity=s(e),t+""}}}A(l);A(u);function P(e){return function(t,n){var i=e((t=(0,r.Uc)(t)).h,(n=(0,r.Uc)(n)).h),o=u(t.c,n.c),a=u(t.l,n.l),s=u(t.opacity,n.opacity);return function(e){return t.h=i(e),t.c=o(e),t.l=a(e),t.opacity=s(e),t+""}}}P(l);P(u);function O(e){return function t(n){function i(t,i){var o=e((t=(0,r.K)(t)).h,(i=(0,r.K)(i)).h),a=u(t.s,i.s),s=u(t.l,i.l),l=u(t.opacity,i.opacity);return function(e){return t.h=o(e),t.s=a(e),t.l=s(Math.pow(e,n)),t.opacity=l(e),t+""}}return n=+n,i.gamma=t,i}(1)}O(l);O(u);function R(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}},81628:(e,t,n)=>{"use strict";n.d(t,{BY:()=>A});var r=n(72018);function i(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}Symbol("implicit");var o=n(90583);function a(e){return+e}var s=[0,1];function l(e){return e}function c(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function u(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=c(i,r),o=n(a,o)):(r=c(r,i),o=n(o,a)),function(e){return o(r(e))}}function d(e,t,n){var i=Math.min(e.length,t.length)-1,o=new Array(i),a=new Array(i),s=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<i;)o[s]=c(e[s],e[s+1]),a[s]=n(t[s],t[s+1]);return function(t){var n=(0,r.b4)(e,t,1,i)-1;return a[n](o[n](t))}}function p(){var e,t,n,r,i,c,p=s,h=s,f=o.sX,m=l;function g(){var e,t,n,o=Math.min(p.length,h.length);return m!==l&&(e=p[0],t=p[o-1],e>t&&(n=e,e=t,t=n),m=function(n){return Math.max(e,Math.min(t,n))}),r=o>2?d:u,i=c=null,v}function v(t){return null==t||isNaN(t=+t)?n:(i||(i=r(p.map(e),h,f)))(e(m(t)))}return v.invert=function(n){return m(t((c||(c=r(h,p.map(e),o.k4)))(n)))},v.domain=function(e){return arguments.length?(p=Array.from(e,a),g()):p.slice()},v.range=function(e){return arguments.length?(h=Array.from(e),g()):h.slice()},v.rangeRound=function(e){return h=Array.from(e),f=o.uL,g()},v.clamp=function(e){return arguments.length?(m=!!e||l,g()):m!==l},v.interpolate=function(e){return arguments.length?(f=e,g()):f},v.unknown=function(e){return arguments.length?(n=e,v):n},function(n,r){return e=n,t=r,g()}}function h(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function f(e){return(e=h(Math.abs(e)))?e[1]:NaN}var m,g=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function v(e){if(!(t=g.exec(e)))throw new Error("invalid format: "+e);var t;return new y({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function y(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function b(e,t){var n=h(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}v.prototype=y.prototype,y.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const C={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>b(100*e,t),r:b,s:function(e,t){var n=h(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(m=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+h(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function w(e){return e}var E,T,x,_=Array.prototype.map,S=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function I(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?w:(t=_.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),o.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?w:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(_.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=v(e)).fill,n=e.align,d=e.sign,p=e.symbol,h=e.zero,f=e.width,g=e.comma,y=e.precision,b=e.trim,w=e.type;"n"===w?(g=!0,w="g"):C[w]||(void 0===y&&(y=12),b=!0,w="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var E="$"===p?i:"#"===p&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",T="$"===p?o:/[%p]/.test(w)?l:"",x=C[w],_=/[defgprs%]/.test(w);function I(e){var i,o,l,p=E,v=T;if("c"===w)v=x(e)+v,e="";else{var C=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:x(Math.abs(e),y),b&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),C&&0===+e&&"+"!==d&&(C=!1),p=(C?"("===d?d:c:"-"===d||"("===d?"":d)+p,v=("s"===w?S[8+m/3]:"")+v+(C&&"("===d?")":""),_)for(i=-1,o=e.length;++i<o;)if(48>(l=e.charCodeAt(i))||l>57){v=(46===l?a+e.slice(i+1):e.slice(i))+v,e=e.slice(0,i);break}}g&&!h&&(e=r(e,1/0));var I=p.length+e.length+v.length,D=I<f?new Array(f-I+1).join(t):"";switch(g&&h&&(e=r(D+e,D.length?f-v.length:1/0),D=""),n){case"<":e=p+e+v+D;break;case"=":e=p+D+e+v;break;case"^":e=D.slice(0,I=D.length>>1)+p+e+v+D.slice(I);break;default:e=D+p+e+v}return s(e)}return y=void 0===y?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),I.toString=function(){return e+""},I}return{format:d,formatPrefix:function(e,t){var n=d(((e=v(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(f(t)/3))),i=Math.pow(10,-r),o=S[8+r/3];return function(e){return n(i*e)+o}}}}function D(e,t,n,i){var o,a=(0,r.ly)(e,t,n);switch((i=v(null==i?",f":i)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(o=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(f(t)/3)))-f(Math.abs(e)))}(a,s))||(i.precision=o),x(i,s);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(o=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,f(t)-f(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=o-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(o=function(e){return Math.max(0,-f(Math.abs(e)))}(a))||(i.precision=o-2*("%"===i.type))}return T(i)}function A(){var e=p()(l,l);return e.copy=function(){return t=e,A().domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown());var t},i.apply(e,arguments),function(e){var t=e.domain;return e.ticks=function(e){var n=t();return(0,r.sd)(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return D(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,o,a=t(),s=0,l=a.length-1,c=a[s],u=a[l],d=10;for(u<c&&(o=c,c=u,u=o,o=s,s=l,l=o);d-- >0;){if((o=(0,r.G9)(c,u,n))===i)return a[s]=c,a[l]=u,t(a);if(o>0)c=Math.floor(c/o)*o,u=Math.ceil(u/o)*o;else{if(!(o<0))break;c=Math.ceil(c*o)/o,u=Math.floor(u*o)/o}i=o}return e},e}(e)}E=I({thousands:",",grouping:[3],currency:["$",""]}),T=E.format,x=E.formatPrefix;const P=new Date,O=new Date;function R(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=t=>(e(t=new Date(+t)),t),i.ceil=n=>(e(n=new Date(n-1)),t(n,1),e(n),n),i.round=e=>{const t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=(e,n)=>(t(e=new Date(+e),null==n?1:Math.floor(n)),e),i.range=(n,r,o)=>{const a=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return a;let s;do{a.push(s=new Date(+n)),t(n,o),e(n)}while(s<n&&n<r);return a},i.filter=n=>R(t=>{if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},(e,r)=>{if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}),n&&(i.count=(t,r)=>(P.setTime(+t),O.setTime(+r),e(P),e(O),Math.floor(n(P,O))),i.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?t=>r(t)%e===0:t=>i.count(0,t)%e===0):i:null)),i}const M=R(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);M.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?R(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):M:null);M.range;const N=1e3,L=6e4,k=36e5,F=864e5,V=6048e5,U=2592e6,B=31536e6,G=R(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*N)},(e,t)=>(t-e)/N,e=>e.getUTCSeconds()),W=(G.range,R(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*N)},(e,t)=>{e.setTime(+e+t*L)},(e,t)=>(t-e)/L,e=>e.getMinutes())),z=(W.range,R(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*L)},(e,t)=>(t-e)/L,e=>e.getUTCMinutes())),H=(z.range,R(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*N-e.getMinutes()*L)},(e,t)=>{e.setTime(+e+t*k)},(e,t)=>(t-e)/k,e=>e.getHours())),j=(H.range,R(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*k)},(e,t)=>(t-e)/k,e=>e.getUTCHours())),Z=(j.range,R(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*L)/F,e=>e.getDate()-1)),K=(Z.range,R(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/F,e=>e.getUTCDate()-1)),$=(K.range,R(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/F,e=>Math.floor(e/F)));$.range;function q(e){return R(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*L)/V)}const X=q(0),Y=q(1),J=q(2),Q=q(3),ee=q(4),te=q(5),ne=q(6);X.range,Y.range,J.range,Q.range,ee.range,te.range,ne.range;function re(e){return R(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/V)}const ie=re(0),oe=re(1),ae=re(2),se=re(3),le=re(4),ce=re(5),ue=re(6),de=(ie.range,oe.range,ae.range,se.range,le.range,ce.range,ue.range,R(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth())),pe=(de.range,R(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth())),he=(pe.range,R(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear()));he.every=e=>isFinite(e=Math.floor(e))&&e>0?R(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}):null;he.range;const fe=R(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());fe.every=e=>isFinite(e=Math.floor(e))&&e>0?R(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null;fe.range;function me(e,t,n,i,o,a){const s=[[G,1,N],[G,5,5e3],[G,15,15e3],[G,30,3e4],[a,1,L],[a,5,3e5],[a,15,9e5],[a,30,18e5],[o,1,k],[o,3,108e5],[o,6,216e5],[o,12,432e5],[i,1,F],[i,2,1728e5],[n,1,V],[t,1,U],[t,3,7776e6],[e,1,B]];function l(t,n,i){const o=Math.abs(n-t)/i,a=(0,r.YF)(([,,e])=>e).right(s,o);if(a===s.length)return e.every((0,r.ly)(t/B,n/B,i));if(0===a)return M.every(Math.max((0,r.ly)(t,n,i),1));const[l,c]=s[o/s[a-1][2]<s[a][2]/o?a-1:a];return l.every(c)}return[function(e,t,n){const r=t<e;r&&([e,t]=[t,e]);const i=n&&"function"==typeof n.range?n:l(e,t,n),o=i?i.range(e,+t+1):[];return r?o.reverse():o},l]}const[ge,ve]=me(fe,pe,ie,$,j,z),[ye,be]=me(he,de,X,Z,H,W);function Ce(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function we(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ee(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var Te,xe,_e,Se={"-":"",_:" ",0:"0"},Ie=/^\s*\d+/,De=/^%/,Ae=/[\\^$*+?|[\]().{}]/g;function Pe(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function Oe(e){return e.replace(Ae,"\\$&")}function Re(e){return new RegExp("^(?:"+e.map(Oe).join("|")+")","i")}function Me(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function Ne(e,t,n){var r=Ie.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Le(e,t,n){var r=Ie.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function ke(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Fe(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Ve(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Ue(e,t,n){var r=Ie.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Be(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Ge(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function We(e,t,n){var r=Ie.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function ze(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function He(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function je(e,t,n){var r=Ie.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Ze(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Ke(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function $e(e,t,n){var r=Ie.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function qe(e,t,n){var r=Ie.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Xe(e,t,n){var r=Ie.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Ye(e,t,n){var r=De.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Je(e,t,n){var r=Ie.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Qe(e,t,n){var r=Ie.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function et(e,t){return Pe(e.getDate(),t,2)}function tt(e,t){return Pe(e.getHours(),t,2)}function nt(e,t){return Pe(e.getHours()%12||12,t,2)}function rt(e,t){return Pe(1+Z.count(he(e),e),t,3)}function it(e,t){return Pe(e.getMilliseconds(),t,3)}function ot(e,t){return it(e,t)+"000"}function at(e,t){return Pe(e.getMonth()+1,t,2)}function st(e,t){return Pe(e.getMinutes(),t,2)}function lt(e,t){return Pe(e.getSeconds(),t,2)}function ct(e){var t=e.getDay();return 0===t?7:t}function ut(e,t){return Pe(X.count(he(e)-1,e),t,2)}function dt(e){var t=e.getDay();return t>=4||0===t?ee(e):ee.ceil(e)}function pt(e,t){return e=dt(e),Pe(ee.count(he(e),e)+(4===he(e).getDay()),t,2)}function ht(e){return e.getDay()}function ft(e,t){return Pe(Y.count(he(e)-1,e),t,2)}function mt(e,t){return Pe(e.getFullYear()%100,t,2)}function gt(e,t){return Pe((e=dt(e)).getFullYear()%100,t,2)}function vt(e,t){return Pe(e.getFullYear()%1e4,t,4)}function yt(e,t){var n=e.getDay();return Pe((e=n>=4||0===n?ee(e):ee.ceil(e)).getFullYear()%1e4,t,4)}function bt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Pe(t/60|0,"0",2)+Pe(t%60,"0",2)}function Ct(e,t){return Pe(e.getUTCDate(),t,2)}function wt(e,t){return Pe(e.getUTCHours(),t,2)}function Et(e,t){return Pe(e.getUTCHours()%12||12,t,2)}function Tt(e,t){return Pe(1+K.count(fe(e),e),t,3)}function xt(e,t){return Pe(e.getUTCMilliseconds(),t,3)}function _t(e,t){return xt(e,t)+"000"}function St(e,t){return Pe(e.getUTCMonth()+1,t,2)}function It(e,t){return Pe(e.getUTCMinutes(),t,2)}function Dt(e,t){return Pe(e.getUTCSeconds(),t,2)}function At(e){var t=e.getUTCDay();return 0===t?7:t}function Pt(e,t){return Pe(ie.count(fe(e)-1,e),t,2)}function Ot(e){var t=e.getUTCDay();return t>=4||0===t?le(e):le.ceil(e)}function Rt(e,t){return e=Ot(e),Pe(le.count(fe(e),e)+(4===fe(e).getUTCDay()),t,2)}function Mt(e){return e.getUTCDay()}function Nt(e,t){return Pe(oe.count(fe(e)-1,e),t,2)}function Lt(e,t){return Pe(e.getUTCFullYear()%100,t,2)}function kt(e,t){return Pe((e=Ot(e)).getUTCFullYear()%100,t,2)}function Ft(e,t){return Pe(e.getUTCFullYear()%1e4,t,4)}function Vt(e,t){var n=e.getUTCDay();return Pe((e=n>=4||0===n?le(e):le.ceil(e)).getUTCFullYear()%1e4,t,4)}function Ut(){return"+0000"}function Bt(){return"%"}function Gt(e){return+e}function Wt(e){return Math.floor(+e/1e3)}!function(e){Te=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,l=e.shortMonths,c=Re(i),u=Me(i),d=Re(o),p=Me(o),h=Re(a),f=Me(a),m=Re(s),g=Me(s),v=Re(l),y=Me(l),b={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:et,e:et,f:ot,g:gt,G:yt,H:tt,I:nt,j:rt,L:it,m:at,M:st,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Gt,s:Wt,S:lt,u:ct,U:ut,V:pt,w:ht,W:ft,x:null,X:null,y:mt,Y:vt,Z:bt,"%":Bt},C={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:Ct,e:Ct,f:_t,g:kt,G:Vt,H:wt,I:Et,j:Tt,L:xt,m:St,M:It,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Gt,s:Wt,S:Dt,u:At,U:Pt,V:Rt,w:Mt,W:Nt,x:null,X:null,y:Lt,Y:Ft,Z:Ut,"%":Bt},w={a:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=f.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return x(e,t,n,r)},d:He,e:He,f:Xe,g:Be,G:Ue,H:Ze,I:Ze,j:je,L:qe,m:ze,M:Ke,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=u.get(r[0].toLowerCase()),n+r[0].length):-1},q:We,Q:Je,s:Qe,S:$e,u:Le,U:ke,V:Fe,w:Ne,W:Ve,x:function(e,t,r){return x(e,n,t,r)},X:function(e,t,n){return x(e,r,t,n)},y:Be,Y:Ue,Z:Ge,"%":Ye};function E(e,t){return function(n){var r,i,o,a=[],s=-1,l=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(a.push(e.slice(l,s)),null!=(i=Se[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),l=s+1);return a.push(e.slice(l,s)),a.join("")}}function T(e,t){return function(n){var r,i,o=Ee(1900,void 0,1);if(x(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=we(Ee(o.y,0,1))).getUTCDay(),r=i>4||0===i?oe.ceil(r):oe(r),r=K.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=Ce(Ee(o.y,0,1))).getDay(),r=i>4||0===i?Y.ceil(r):Y(r),r=Z.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?we(Ee(o.y,0,1)).getUTCDay():Ce(Ee(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,we(o)):Ce(o)}}function x(e,t,n,r){for(var i,o,a=0,s=t.length,l=n.length;a<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=w[i in Se?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=E(n,b),b.X=E(r,b),b.c=E(t,b),C.x=E(n,C),C.X=E(r,C),C.c=E(t,C),{format:function(e){var t=E(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=T(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=E(e+="",C);return t.toString=function(){return e},t},utcParse:function(e){var t=T(e+="",!0);return t.toString=function(){return e},t}}}(e),Te.format,Te.parse,xe=Te.utcFormat,_e=Te.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var zt="%Y-%m-%dT%H:%M:%S.%LZ";Date.prototype.toISOString||xe(zt);+new Date("2000-01-01T00:00:00.000Z")||_e(zt)}}]);
//# sourceMappingURL=1922.bundle.d88b4261c996ebe32198.js.map