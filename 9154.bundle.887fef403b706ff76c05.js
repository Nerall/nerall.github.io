/*! For license information please see 9154.bundle.887fef403b706ff76c05.js.LICENSE.txt */
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9154],{49001:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var o=n(72076),i=n(7187),a=n(30023),r=n(30742),s=n(11723),l=n(77614),c=n(25281),d=n(40046),u=n(82253);class g extends l.Z{static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}constructor(e){super({...e,canvas:e.canvas||(0,c.uy)(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),!1===this.isPlaying&&this.renderFrame(),!0),this.getNumberOfSlices=()=>{const e=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(e)?this.numberOfFrames:e},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const e=this.canvas,{clientWidth:t,clientHeight:n}=e;e.width===t&&e.height===n||(e.width=t,e.height=n),this.refreshRenderValues(),!1===this.isPlaying&&this.renderFrame()},this.canvasToWorld=(e,t=[0,0,0])=>{const n=this.videoCamera.panWorld,o=this.getWorldToCanvasRatio(),i=[n[0]*o,n[1]*o],a=[e[0]-i[0],e[1]-i[1]];return t.splice(0,2,a[0]/o,a[1]/o),t},this.worldToCanvas=e=>{const t=this.videoCamera.panWorld,n=this.getWorldToCanvasRatio();return[(e[0]+t[0])*n,(e[1]+t[1])*n]},this.getRotation=()=>0,this.canvasToIndex=e=>{const t=this.getTransform();return t.invert(),t.transformPoint(e.map(e=>e*devicePixelRatio))},this.indexToCanvas=e=>this.getTransform().transformPoint(e).map(e=>e/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{const e=this.getTransform().getMatrix(),t=this.canvasContext;t.resetTransform(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.drawImage(this.videoElement,0,0,this.videoWidth||1024,this.videoHeight||1024);for(const e of this.getActors())e.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),(0,s.triggerEvent)(this.element,i.Events.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(0,s.triggerEvent)(this.element,i.Events.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),this.initialRender?.();const n=this.getFrameNumber();this.isPlaying&&(n<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):n>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(i.Events.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const t="string"==typeof e?e:e.imageId,n=a.get(i.MetadataModules.IMAGE_PLANE,t);let r=n.rowCosines,s=n.columnCosines;null!=r&&null!=s||(r=[1,0,0],s=[0,1,0]);const l=o.R3.fromValues(r[0],r[1],r[2]),c=o.R3.fromValues(s[0],s[1],s[2]),{rows:d,columns:u}=n,g=o.R3.create();o.R3.cross(g,l,c);let h=n.imagePositionPatient;null==h&&(h=[0,0,0]);const m=n.columnPixelSpacing||1,f=n.rowPixelSpacing||1,p=n.columns,v=n.rows;return this.hasPixelSpacing=!!n.columnPixelSpacing,{bitsAllocated:8,numComps:3,origin:h,rows:d,columns:u,direction:[...l,...c,...g],dimensions:[p,v,1],spacing:[m,f,1],hasPixelSpacing:this.hasPixelSpacing,numVoxels:p*v*1,imagePlaneModule:n}}setDataIds(e,t){this.setVideo(e[0],t?.viewReference?.sliceIndex||1)}setVideo(e,t){this.imageId=Array.isArray(e)?e[0]:e;const n=a.get(i.MetadataModules.IMAGE_URL,e);if(!n?.rendered)throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:o}=n,r=a.get(i.MetadataModules.GENERAL_SERIES,e);this.modality=r?.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:s,numberOfFrames:l}=a.get(i.MetadataModules.CINE,e);return this.numberOfFrames=l,this.setVideoURL(o).then(()=>(l&&1!==l||(l=Math.round(this.videoElement.duration*(s||30))),s||(s=Math.round(l/this.videoElement.duration)),this.fps=s,this.numberOfFrames=l,this.setFrameRange([1,l]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(t||1)},new Promise(e=>{window.setTimeout(()=>{this.setFrameNumber(t||1),e(this)},25)})))}async setVideoURL(e){return new Promise(t=>{this.videoElement.src=e,this.videoElement.preload="auto";const n=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",n),this.refreshRenderValues(),t(!0)};this.videoElement.addEventListener("loadedmetadata",n)})}getImageIds(){const e=new Array(this.numberOfFrames),t=this.imageId.replace(/[0-9]+$/,"");for(let n=0;n<this.numberOfFrames;n++)e[n]=`${t}${n+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(await this.videoElement.play(),this.isPlaying=!0,this.renderWhilstPlaying())}catch(e){}}async pause(){try{await this.videoElement.pause(),this.isPlaying=!1}catch(e){}}async scroll(e=1){await this.pause();const t=this.videoElement,n=this.renderFrame,o=t.currentTime+e*this.scrollSpeed/this.fps;t.currentTime=o;const i=e=>{n(),t.removeEventListener("seeked",i)};t.addEventListener("seeked",i)}async start(){const e=this.videoElement,t=this.renderFrame;if(e.currentTime=0,e.paused){const n=o=>{t(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async end(){const e=this.videoElement,t=this.renderFrame;if(e.currentTime=e.duration,e.paused){const n=o=>{t(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async setTime(e){const t=this.videoElement,n=this.renderFrame;if(t.currentTime=e,t.paused){const e=o=>{n(),t.removeEventListener("seeked",e)};t.addEventListener("seeked",e)}}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){e?2===e.length&&e[0]!==e[1]&&(this.frameRange=[e[0],e[1]]):this.frameRange=[1,this.numberOfFrames]}getFrameRange(){return this.frameRange}setProperties(e){void 0!==e.loop&&(this.videoElement.loop=e.loop),void 0!==e.muted&&(this.videoElement.muted=e.muted),void 0!==e.playbackRate&&this.setPlaybackRate(e.playbackRate),void 0!==e.scrollSpeed&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){this.playbackRate=e,e<.0625?this.pause():this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,t=i.VideoEnums.SpeedUnit.FRAME){this.scrollSpeed=t===i.VideoEnums.SpeedUnit.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){if(this.scalarData?.frameNumber===this.getFrameNumber())return this.scalarData;const e=document.createElement("canvas");e.width=this.videoWidth,e.height=this.videoHeight;const t=e.getContext("2d");t.drawImage(this.videoElement,0,0);const n=t.getImageData(0,0,this.videoWidth,this.videoHeight).data;return n.getRange=()=>[0,255],n.frameNumber=this.getFrameNumber(),this.scalarData=n,n}getImageData(){const{metadata:e}=this,t=e.spacing,n={dimensions:e.dimensions,spacing:t,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality},getScalarData:()=>this.getScalarData(),imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:e=>{const t=this.worldToCanvas(e),n=this.canvasToIndex(t);return[n[0],n[1],0]},indexToWorld:(e,t)=>{const n=this.indexToCanvas([e[0],e[1]]);return this.canvasToWorld(n,t)}},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(n,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),n}hasImageURI(e){const t=e.match(g.frameRangeExtractor),n=t?e.substring(0,t.index):e;return-1!==this.imageId.indexOf(n)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,t=128){const n=t-e/2,o=t+e/2-1;this.setVOI({lower:n,upper:o}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite)return void(this.feFilter=null);const e=this.averageWhite||[255,255,255],t=Math.max(...e),n=e.map(e=>t/e),{lower:o=0,upper:i=255}=this.voiRange||{},a=(i-o+1)/255,r=o/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${n[0]*a} 0 0 0 ${r}           0 ${n[1]*a} 0 0 ${r}           0 0 ${n[2]*a} 0 ${r}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:t,focalPoint:n}=e;if(t&&(this.videoCamera.parallelScale=this.element.clientHeight/2/t),void 0!==n){const e=this.worldToCanvas(n),t=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(e[0]-t[0])/this.videoCamera.parallelScale,(e[1]-t[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),!1===this.isPlaying&&this.renderFrame()}getCurrentImageId(){return this.imageId.replace("/frames/1",this.isPlaying?`/frames/${this.frameRange[0]}-${this.frameRange[1]}`:`/frames/${this.getFrameNumber()}`)}getReferenceId(e={}){const{sliceIndex:t}=e;if(void 0===t)return`videoId:${this.getCurrentImageId()}`;if(Array.isArray(t))return`videoId:${this.imageId.substring(0,this.imageId.length-1)}${t[0]+1}-${t[1]+1}`;return`videoId:${this.imageId.replace("/frames/1",`/frames/${1+t}`)}`}isReferenceViewable(e,t={}){let{imageURI:n}=t;const{referencedImageId:o,sliceIndex:i}=e;if(!super.isReferenceViewable(e))return!1;const a=this.getCurrentImageId();if(!n){const e=a.indexOf(":");n=a.substring(e+1,a.length-1)}if(t.withNavigation)return!0;const r=this.getSliceIndex();if(Array.isArray(i))return r>=i[0]&&r<=i[1];if(void 0!==i)return r===i;if(!o)return!1;const s=o.match(g.frameRangeExtractor);if(!s||!s[2])return!0;const l=s[2].split("-").map(e=>Number(e)),c=r+1;return l[0]<=c&&c<=(l[1]??l[0])}getViewReference(e){let t=e?.sliceIndex;return t||(t=this.isPlaying?[this.frameRange[0]-1,this.frameRange[1]-1]:this.getCurrentImageIdIndex()),{...super.getViewReference(e),referencedImageId:this.getReferenceId(e),sliceIndex:t}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()}getCamera(){const{parallelScale:e}=this.videoCamera,t=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(t),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const t=Math.floor(this.videoWidth*e),n=Math.floor(this.videoHeight*e),o=(this.canvas.offsetWidth-t)/2/e,i=(this.canvas.offsetHeight-n)/2/e;this.videoCamera.panWorld=[o,i],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,t=window.devicePixelRatio||1,n=this.getWorldToCanvasRatio(),o=this.getCanvasToWorldRatio(),i=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],a=[i[0]*o,i[1]*o],s=new r.w;return s.scale(t,t),s.translate(i[0],i[1]),s.scale(n,n),s.translate(e[0],e[1]),s.translate(-a[0],-a[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const t=this.getActors();e.forEach(e=>{const n=u.ZP.getImage(e.imageId),o=this.createActorMapper(n);o&&(t.push({uid:e.actorUID,actor:o}),e.callback&&e.callback({imageActor:o,imageId:e.imageId}))}),this.setActors(t)}createActorMapper(e){return new d.Z(this,e)}}const h=g},68467:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const o=async function(e,t,n){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!n.addImages)return void console.warn(`Viewport with Id ${t} does not have addImages. Cannot add image segmentation to this viewport.`)}const o=n.map(async n=>e.getViewport(n).addImages(t));await Promise.all(o)}},87301:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(36205);const i=async function(e,t,n,i=!1,a=!1){for(const t of n){const n=e.getViewport(t);if(!n)throw new Error(`Viewport with Id ${t} does not exist`);if(!(n instanceof o.Z))return void console.warn(`Viewport with Id ${t} is not a BaseVolumeViewport. Cannot add volume to this viewport.`)}const r=n.map(async n=>{const o=e.getViewport(n);await o.addVolumes(t,i,a)});await Promise.all(r)}},43877:(e,t,n)=>{"use strict";n.d(t,{Wl:()=>o.Z,yP:()=>l});var o=n(51945),i=n(52813);const a=[0,0,0,0];function r(e,t){let n=0,o=e.length-1;for(;n<=o;){const i=n+Math.floor((o-n)/2),a=e[i];if(a===t)return i;t<a?o=i-1:n=i+1}return n}function s(e,t,n){let o;const i=[],a=[],s=[],l=[];for(n=null===n?1:n,o=0;o<t.length;o++){const n=t[o];i.push((e-1)*n[0]),a.push(n[1]),s.push(n[1])}const c=function(e,t,n){const o=(t-e)/((n=null===n?100:n)-1),i=[];for(;n-- >0;)i.push(e),e+=o;return i[i.length-1]=t,i}(0,1,e);for(o=0;o<e;o++)c[o]=(e-1)*Math.pow(c[o],n);const d=function(e,t){let n;const o=[],i=t.length;for(e.sort(function(e,t){return e-t}),n=0;n<i;n++)o[n]=r(e,t[n]);return o}(i,c);for(o=1;o<e-1;o++){const e=d[o],t=(c[o]-i[e-1])/(i[e]-i[e-1]),n=a[e]-s[e-1];l[o]=t*n+s[e-1]}return l[0]=s[0],l[e-1]=a[t.length-1],l}function l(e,t){let n=i.Z[e];n||(n=i.Z[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=function(e,t,n){let o;const i=[];n=null===n?1:n;const a=s(t=null===t?256:t,e.red,n),r=s(t,e.green,n),l=s(t,e.blue,n);for(o=0;o<t;o++){const e=[Math.round(255*a[o]),Math.round(255*r[o]),Math.round(255*l[o]),255];i.push(e)}return i}(n.segmentedData,n.numColors,n.gamma));return{getId:()=>e,getColorSchemeName:()=>n.name,setColorSchemeName(e){n.name=e},getNumberOfColors:()=>n.colors.length,setNumberOfColors(e){for(;n.colors.length<e;)n.colors.push(a);n.colors.length=e},getColor(e){return this.isValidIndex(e)?n.colors[e]:a},getColorRepeating(e){const t=n.colors.length;return e=t?e%t:0,this.getColor(e)},setColor(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor(e){n.colors.push(e)},insertColor(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors(){n.colors=[]},buildLookupTable(e){if(!e)return;const t=n.colors.length;e.setNumberOfTableValues(t);for(let o=0;o<t;o++)e.setTableValue(o,n.colors[o])},createLookupTable(){const e=new o.Z;return this.buildLookupTable(e),e},isValidIndex:e=>e>=0&&e<n.colors.length}}},14569:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var o=n(10065),i=n(64924),a=n(401),r=n(46673);function s(e,t){const n=e.image;if(!e.canvas||!e.image)return;const s=(0,o.Z)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let o=n.render;o||(o=e.viewport.colormap?r.J:n.color?i.C:a.L),o(e,t)}const l=(0,o.Z)()-s;n.stats.lastRenderTime=l,e.invalid=!1,e.needsRedraw=!1}},77327:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(30742);function i(e,t){const n=new o.w;if(!e.viewport.displayedArea)return n;n.translate(e.canvas.width/2,e.canvas.height/2);const i=e.viewport.rotation;0!==i&&n.rotate(i*Math.PI/180);let a=e.viewport.scale,r=e.viewport.scale;const s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);if("NONE"===e.viewport.displayedArea.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?a*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(r*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(a=e.viewport.displayedArea.columnPixelSpacing,r=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode){const t=e.canvas.height/(l*r),n=e.canvas.width/(s*a);a=r=Math.min(n,t),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?a*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(r*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing)}return n.scale(a,r),0!==i&&n.rotate(-i*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==i&&n.rotate(i*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},62705:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(55469);function i(e,t){const n=(0,o.Z)(e);return n.invert(),n.transformPoint(t)}},14419:(e,t,n)=>{"use strict";function o(e,t){const{hflip:n,vflip:o,rotation:i}=t;if(e.x*=n?-1:1,e.y*=o?-1:1,0!==i){const t=i*Math.PI/180,n=Math.cos(t),o=Math.sin(t),a=e.x*n-e.y*o,r=e.x*o+e.y*n;e.x=a,e.y=r}return e}n.d(t,{Z:()=>o})},94222:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(64647),i=n(37023);function a(e,t,n,a){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(void 0===t)return(0,o.Z)();const r=(0,i.Z)(e,t,0).scaleFactor;let s;return"PT"===n&&t.isPreScaled?s={windowWidth:5,windowCenter:2.5}:void 0!==t.windowWidth&&void 0!==t.windowCenter&&(s={windowWidth:Array.isArray(t.windowWidth)?t.windowWidth[0]:t.windowWidth,windowCenter:Array.isArray(t.windowCenter)?t.windowCenter[0]:t.windowCenter}),{scale:r,translation:{x:0,y:0},voi:s,invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,modality:n,voiLUT:t.voiLUT,colormap:void 0!==a?a:t.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},37023:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(6737),i=n(19369);function a(e,t,n=null){(0,o.T)(e,"getImageScale: parameter canvas must not be undefined"),(0,o.T)(t,"getImageScale: parameter image must not be undefined");const a=(0,i.Z)(t,n),r=t.rowPixelSpacing||1,s=t.columnPixelSpacing||1;let l=1,c=1;r<s?c=s/r:l=r/s;const d=e.height/a.height/l,u=e.width/a.width/c;return{verticalScale:d,horizontalScale:u,scaleFactor:Math.min(u,d)}}},19369:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(6737);function i(e,t=null){return(0,o.T)(e,"getImageSize: parameter image must not be undefined"),(0,o.T)(e.width,"getImageSize: parameter image must have width"),(0,o.T)(e.height,"getImageSize: parameter image must have height"),function(e){return!(null==e||0===e||180===e)}(t)?{height:e.width,width:e.height}:{width:e.width,height:e.height}}},55469:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(77327);function i(e){return(0,o.Z)(e)}},48467:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(55469);function i(e,t){return(0,o.Z)(e).transformPoint(t)}},22982:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(37023);function i(e,t=!0,n=!0){const{canvas:i,image:a,viewport:r}=e,s=(0,o.Z)(i,a,0).scaleFactor;r.vflip=!1,r.hflip=!1,t&&(r.translation.x=0,r.translation.y=0),n&&(r.displayedArea.tlhc.x=1,r.displayedArea.tlhc.y=1,r.displayedArea.brhc.x=a.columns,r.displayedArea.brhc.y=a.rows,r.scale=s)}},34343:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(37023);var i=n(19369);function a(e,t=!1){const n=e.canvas.width,a=e.canvas.height;!function(e){const{canvas:t}=e,{clientWidth:n,clientHeight:o}=t;t.width===n&&t.height===o||(t.width=n,t.height=o)}(e),void 0!==e.image&&(t||function(e,t,n){const o=e.viewport.scale,a=(0,i.Z)(e.image,e.viewport.rotation),r=Math.round(a.width*o),s=Math.round(a.height*o),l=e.viewport.translation.x,c=e.viewport.translation.y;return r===t&&s<=n||r<=t&&s===n&&0===l&&0===c}(e,n,a)?function(e){const{image:t}=e;e.viewport.scale=(0,o.Z)(e.canvas,t,e.viewport.rotation).scaleFactor,e.viewport.translation.x=0,e.viewport.translation.y=0}(e):function(e,t,n){const o=e.viewport.scale,i=e.canvas.width/t,a=e.canvas.height/n,r=Math.sqrt(i*a);e.viewport.scale=r*o}(e,n,a))}},28925:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var o=n(52601),i=n(18588),a=n(49046),r=n(11723),s=n(7187),l=n(98230);const c=async function(e,t,n,c=!1,d=!1){const{volumeId:u,callback:g,blendMode:h}=e,m=await(0,i.loadVolume)(u);if(!m)throw new Error(`imageVolume with id: ${m.volumeId} does not exist`);const{imageData:f,vtkOpenGLTexture:p}=m,v=(0,a.Z)(f,p);h&&v.setBlendMode(h);const w=o.ZP.newInstance();return w.setMapper(v),3===f.getPointData().getScalars().getNumberOfComponents()&&w.getProperty().setIndependentComponents(!1),await(0,l.Z)(w,m,d),g&&g({volumeActor:w,volumeId:u}),c||function(e,t,n,o){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:t,range:{lower:i[0],upper:i[1]},volumeId:o};(0,r.triggerEvent)(e,s.Events.VOI_MODIFIED,a)}(t,n,w,u),w}},98230:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var o=n(62990),i=n(30023),a=n(11723),r=n(7187),s=n(82253);const l=r.RequestType.Prefetch;const c=async function(e,t,n){let r=function(e){const{imageIds:t,metadata:n}=e;let o;if(t.length){const e=t[Math.floor(t.length/2)],n=i.get("voiLutModule",e);if(n&&n.windowWidth&&n.windowCenter){const{windowWidth:e,windowCenter:t}=n;o={windowWidth:Array.isArray(e)?e[0]:e,windowCenter:Array.isArray(t)?t[0]:t}}}else o=n?.voiLut?.[0];if(o){const{lower:e,upper:t}=a.windowLevel.toLowHighRange(Number(o.windowWidth),Number(o.windowCenter));return{lower:e,upper:t}}}(t);!r&&t?.imageIds?.length&&(r=await async function(e,t){const{imageIds:n}=e,r=e.getScalarData(),c=Math.floor(n.length/2),d=e.imageIds[c],u=i.get("generalSeriesModule",d)||{},{modality:g}=u,h=i.get("modalityLutModule",d)||{},m=n.length,f=r.byteLength/m,p=r.length/m,v=r.BYTES_PER_ELEMENT,w={rescaleSlope:h.rescaleSlope,rescaleIntercept:h.rescaleIntercept,modality:g};let I;if("PT"===g){const e=i.get("scalingModule",d);e&&(I={...w,suvbw:e.suvbw})}const y=c*f,E={targetBuffer:{type:t?void 0:"Float32Array"},priority:0,requestType:l,useNativeDataType:t,preScale:{enabled:!0,scalingParameters:I}};let x=s.ZP.getImage(d);e.referencedImageIds?.length||(x=await(0,o.loadAndCacheImage)(d,{...E,ignoreCache:!0}));const b=x?x.getPixelData():function(e,t,n,o){const{scalarData:i}=e,{buffer:a}=i;i.BYTES_PER_ELEMENT!==n&&(t*=i.BYTES_PER_ELEMENT/n);const r=i.constructor,s=new r(o),l=new r(a,t,o);return s.set(l),s}(e,y,v,p),{min:C,max:S}=(0,a.getMinMax)(b);return{lower:C,upper:S}}(t,n),r=function(e,t){const n=e.imageIds,o=Math.floor(n.length/2),a=n[o];if(function(e,t){if("PT"!==e||!t.isPreScaled)return!1;if(!t.scaling?.PT.suvbw)return!1;return!0}((i.get("generalSeriesModule",a)||{}).modality,e))return{lower:0,upper:5};return t}(t,r)),0===r?.lower&&0===r?.upper||void 0===r?.lower||void 0===r?.upper||e.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)}},51480:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>s});var o=n(6685),i=n(60337);const a={scalarTexture:null};function r(e,t,n={}){Object.assign(t,a,n),i.ZP.extend(e,t,n),o.ZP.setGet(e,t,["scalarTexture"]),function(e,t){t.classHierarchy.push("vtkSharedVolumeMapper");const n=e.delete;e.delete=()=>{t.scalarTexture=null,n()}}(e,t)}const s={newInstance:o.ZP.newInstance(r,"vtkSharedVolumeMapper"),extend:r}},90261:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});const o=Symbol("DefaultSettings"),i=Symbol("RuntimeSettings"),a=Symbol("ObjectSettingsMap"),r=Symbol("Dictionary");class s{constructor(e){const t=Object.create(e instanceof s&&r in e?e[r]:null);Object.seal(Object.defineProperty(this,r,{value:t}))}set(e,t){return c(this[r],e,t,null)}get(e){return function(e,t){return e[t]}(this[r],e)}unset(e){return function(e,t){if(t.endsWith(".")){let n=0;const o=t,i=o.slice(0,-1),a=0===i.length;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a||t.startsWith(o)||t===i)&&(delete e[t],++n);return n>0}return delete e[t]}(this[r],e+"")}forEach(e){l(this[r],e)}extend(){return new s(this)}import(e){d(e)&&Object.keys(e).forEach(t=>{c(this[r],t,e[t],null)})}dump(){const e={};return l(this[r],(t,n)=>{void 0!==n&&u(e,t,n)}),e}static assert(e){return e instanceof s?e:s.getRuntimeSettings()}static getDefaultSettings(e=null){let t=s[o];if(t instanceof s||(t=new s,s[o]=t),e){const n={};return t.forEach(o=>{if(o.startsWith(e)){const i=o.split(`${e}.`)[1];n[i]=t.get(o)}}),n}return t}static getRuntimeSettings(){let e=s[i];return e instanceof s||(e=new s(s.getDefaultSettings()),s[i]=e),e}static getObjectSettings(e,t){let n=null;if(e instanceof s)n=e;else if("object"==typeof e&&null!==e){let o=s[a];o instanceof WeakMap||(o=new WeakMap,s[a]=o),n=o.get(e),n instanceof s||(n=new s(s.assert(s.getObjectSettings(t))),o.set(e,n))}return n}static extendRuntimeSettings(){return s.getRuntimeSettings().extend()}}function l(e,t){for(const n in e)t(n,e[n])}function c(e,t,n,o){return!!function(e){let t,n,o;if("string"!=typeof e||(t=e.length-1)<0)return!1;o=-1;for(;(n=e.indexOf(".",o+1))>=0;){if(n-o<2||n===t)return!1;o=n}return!0}(t)&&(d(n)?function(e,t,n,o){let i;if(o.has(n))return c(e,t,null,o);o.add(n),i=0;for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(c(e,0===a.length?t:`${t}.${a}`,n[a],o)||++i);return o.delete(n),0===i}(e,t,n,o instanceof WeakSet?o:new WeakSet):(e[t]=n,!0))}function d(e){if("object"==typeof e&&null!==e){const t=Object.getPrototypeOf(e);if(t===Object.prototype||null===t)return!0}return!1}function u(e,t,n){const o=t.indexOf(".");if(o>=0){const i=t.slice(0,o);let a=e[i];if("object"!=typeof a||null===a){const t=a;a={},void 0!==t&&(a[""]=t),e[i]=a}u(a,t.slice(o+1,t.length),n)}else e[t]=n}s.getDefaultSettings().set("useCursors",!0)},5287:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var o=n(11723),i=n(74238),a=n(19546),r=n(84326);const s=1073741824;const l=new class{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageCacheSize=0,this._volumeCacheSize=0,this._maxCacheSize=3*s,this._maxInstanceSize=4294967288,this.setMaxCacheSize=e=>{if(!e||"number"!=typeof e){const e=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(e)}this._maxCacheSize=e},this.isCacheable=e=>{if(e>this._maxInstanceSize)return!1;return this.getBytesAvailable()+this._imageCacheSize>e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getMaxInstanceSize=()=>this._maxInstanceSize,this.getCacheSize=()=>this._imageCacheSize+this._volumeCacheSize,this._decacheImage=e=>{const{imageLoadObject:t}=this._imageCache.get(e);t.cancelFn&&t.cancelFn(),t.decache&&t.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const t=this._volumeCache.get(e),{volumeLoadObject:n,volume:o}=t;o.cancelLoading&&o.cancelLoading(),o.imageData&&o.imageData.delete(),this._restoreImagesFromBuffer(o),n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._volumeCache.delete(e)},this.purgeCache=()=>{const e=this._imageCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t})}this.purgeVolumeCache()},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeVolumeLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:t})}},this.getVolumeLoadObject=e=>{if(void 0===e)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.volumeLoadObject},this.getGeometry=e=>{if(null==e)throw new Error("getGeometry: geometryId must not be undefined");const t=this._geometryCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.geometry},this.getImage=e=>{if(void 0===e)throw new Error("getImage: imageId must not be undefined");const t=this._imageCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.image},this.getVolume=e=>{if(void 0===e)throw new Error("getVolume: volumeId must not be undefined");const t=this._volumeCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.volume},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(e=>e.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(t=>t.referencedVolumeId===e),this.removeImageLoadObject=e=>{if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(void 0===t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this.incrementImageCacheSize(-t.sizeInBytes);const n={image:t,imageId:e};(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,n),this._decacheImage(e)},this.removeVolumeLoadObject=e=>{if(void 0===e)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(void 0===t)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");this.incrementVolumeCacheSize(-t.sizeInBytes);const n={volume:t,volumeId:e};(0,o.triggerEvent)(i.Z,a.Z.VOLUME_CACHE_VOLUME_REMOVED,n),this._decacheVolume(e)},this.putGeometryLoadObject=(e,t)=>{if(null==e)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");const n={geometryId:e,geometryLoadObject:t,loaded:!1,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,n),t.promise.then(t=>{if(!this._geometryCache.has(e))return void console.warn("putGeometryLoadObject: geometryId was removed from geometryCache");if(Number.isNaN(t.sizeInBytes))throw new Error("putGeometryLoadObject: geometry.sizeInBytes is not a number");n.loaded=!0,n.geometry=t,n.sizeInBytes=t.sizeInBytes;const r={geometry:t,geometryId:e};(0,o.triggerEvent)(i.Z,a.Z.GEOMETRY_CACHE_GEOMETRY_ADDED,r)}).catch(t=>{throw this._geometryCache.delete(e),t})},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.incrementVolumeCacheSize=e=>{this._volumeCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.decrementVolumeCacheSize=e=>{this._volumeCacheSize-=e},this._geometryCache=new Map}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,t){let n=this.getBytesAvailable();if(n>=e)return n;let r=Array.from(this._imageCache.values());r.sort(function(e,t){return e.timeStamp>t.timeStamp?1:e.timeStamp<t.timeStamp?-1:0});let s=r.map(e=>e.imageId),l=s;t&&(l=s.filter(e=>!t.includes(e)));for(const t of l)if(this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n;r=Array.from(this._imageCache.values()),s=r.map(e=>e.imageId);for(const t of s)if(this.removeImageLoadObject(t),(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n}putImageLoadObject(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(this._imageCache.has(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,n),t.promise.then(t=>{if(!this._imageCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(void 0===t.sizeInBytes||Number.isNaN(t.sizeInBytes))throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");if(!this.isCacheable(t.sizeInBytes))throw new Error(a.Z.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes),n.loaded=!0,n.image=t,n.sizeInBytes=t.sizeInBytes,this.incrementImageCacheSize(n.sizeInBytes);const r={image:n};(0,o.triggerEvent)(i.Z,a.Z.IMAGE_CACHE_IMAGE_ADDED,r),n.sharedCacheKey=t.sharedCacheKey}).catch(t=>{throw this._imageCache.delete(e),t})}getImageLoadObject(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.imageLoadObject}isLoaded(e){const t=this._imageCache.get(e);return!!t&&t.loaded}getVolumeContainingImageId(e){const t=Array.from(this._volumeCache.keys()),n=(0,o.imageIdToURI)(e);for(const e of t){const t=this._volumeCache.get(e),{volume:o}=t;if(!o?.imageIds?.length)return;const i=o.getImageURIIndex(n);if(i>-1)return{volume:o,imageIdIndex:i}}}getCachedImageBasedOnImageURI(e){const t=(0,o.imageIdToURI)(e),n=Array.from(this._imageCache.keys()).find(e=>(0,o.imageIdToURI)(e)===t);if(n)return this._imageCache.get(n)}putVolumeLoadObject(e,t){if(void 0===e)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(void 0===t.promise)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const n={loaded:!1,volumeId:e,volumeLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,n),t.promise.then(t=>{if(!this._volumeCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(Number.isNaN(t.sizeInBytes))throw new Error("putVolumeLoadObject: volume.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putVolumeLoadObject: volume.sizeInBytes is not a number");this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes,t.imageIds),n.volume=t,n.sizeInBytes=t.sizeInBytes,this.incrementVolumeCacheSize(n.sizeInBytes);const r={volume:n};(0,o.triggerEvent)(i.Z,a.Z.VOLUME_CACHE_VOLUME_ADDED,r)}).catch(t=>{throw this._volumeCache.delete(e),t})}_restoreImagesFromBuffer(e){if(!(e instanceof r.J))return void console.warn("Volume is not an ImageVolume. Cannot restore images from buffer.");const t=e.getScalarData(),n=e.imageCacheOffsetMap;if(0!==n.size){for(const[e,{offset:o}]of n){const n=this.getImage(e);if(!n){console.warn(`Image with id ${e} not found in cache.`);continue}const i=n.getPixelData(),a=i.length,r=new i.constructor(t.buffer,o,a);n.getPixelData=()=>r,n.imageFrame&&(n.imageFrame.pixelData=r),delete n.bufferView,this.incrementImageCacheSize(n.sizeInBytes)}console.log(`Images restored from buffer for volume ${e.volumeId}.`)}}}},34061:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const o=.001},87525:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const o={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(o);const i=o},49334:(e,t,n)=>{"use strict";var o;n.d(t,{Z:()=>i}),function(e){e.Interaction="interaction",e.Thumbnail="thumbnail",e.Prefetch="prefetch",e.Compute="compute"}(o||(o={}));const i=o},84659:(e,t,n)=>{"use strict";var o;n.d(t,{Z:()=>i}),function(e){e.NO_DATA="noData",e.LOADING="loading",e.PRE_RENDER="preRender",e.RESIZE="resize",e.RENDERED="rendered"}(o||(o={}));const i=o},7187:(e,t,n)=>{"use strict";n.d(t,{BlendModes:()=>d,CalibrationTypes:()=>I,DynamicOperatorType:()=>v,Events:()=>o.Z,GeometryType:()=>m,ImageQualityStatus:()=>E.Z,InterpolationType:()=>r.Z,MetadataModules:()=>b.Z,OrientationAxis:()=>g.Z,RequestType:()=>i.Z,SharedArrayBufferModes:()=>h.Z,VOILUTFunctionType:()=>p.Z,VideoEnums:()=>x,ViewportStatus:()=>y.Z,ViewportType:()=>a.Z});var o=n(19546),i=n(49334),a=n(68032),r=n(75677),s=n(83336);const{BlendMode:l}=s.default;var c;!function(e){e[e.COMPOSITE=l.COMPOSITE_BLEND]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=l.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=l.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=l.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND"}(c||(c={}));const d=c;var u,g=n(96426),h=n(91799);!function(e){e.CONTOUR="contour",e.SURFACE="Surface"}(u||(u={}));const m=u;n(2689);var f,p=n(67751);!function(e){e.SUM="SUM",e.AVERAGE="AVERAGE",e.SUBTRACT="SUBTRACT"}(f||(f={}));const v=f;var w;!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated"}(w||(w={}));const I=w;var y=n(84659),E=n(83521),x=n(40373),b=n(636)},65279:(e,t,n)=>{"use strict";n.d(t,{O:()=>a,Yz:()=>r,ZP:()=>i,wN:()=>s});var o=n(9138);function i(e){if(!e)return;const{viewportUid:t,renderingEngineUid:n}=e.dataset;return a(t,n)}function a(e,t){if(!t||!e)return;const n=(0,o.ZP)(t);if(!n||n.hasBeenDestroyed)return;const i=n.getViewport(e);if(!i)return;const a=i.getFrameOfReferenceUID();return{viewport:i,renderingEngine:n,viewportId:e,renderingEngineId:t,FrameOfReferenceUID:a}}function r(e){const t=(0,o.Uu)();for(let n=0;n<t.length;n++){const o=t[n];if(o.getViewport(e))return a(e,o.id)}}function s(){const e=[];return(0,o.Uu)().forEach(t=>{t.getViewports().forEach(({element:t})=>{e.push(i(t))})}),e}},62990:(e,t,n)=>{"use strict";n.r(t),n.d(t,{cancelLoadAll:()=>x,cancelLoadImage:()=>y,cancelLoadImages:()=>E,createAndCacheDerivedImage:()=>v,createAndCacheDerivedImages:()=>w,createAndCacheDerivedSegmentationImage:()=>M,createAndCacheDerivedSegmentationImages:()=>T,createAndCacheLocalImage:()=>I,loadAndCacheImage:()=>f,loadAndCacheImages:()=>p,loadImage:()=>m,registerImageLoader:()=>b,registerUnknownImageLoader:()=>C,unregisterAllImageLoaders:()=>S});var o=n(5287),i=n(82253),a=n(19546),r=n(74238),s=n(11723),l=n(96506),c=n(62709);const d={};let u;function g(e,t){const n=e.indexOf(":"),o=e.substring(0,n),i=d[o];if(null==i){if(void 0!==u)return u(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}const l=i(e,t);return l.promise.then(function(e){(0,s.triggerEvent)(r.Z,a.Z.IMAGE_LOADED,{image:e})},function(t){const n={imageId:e,error:t};(0,s.triggerEvent)(r.Z,a.Z.IMAGE_LOAD_FAILED,n)}),l}function h(e,t){if(t.ignoreCache)return g(e,t);let n=o.Z.getImageLoadObject(e);if(void 0!==n)return n;const a=o.Z.getVolumeContainingImageId(e);if(a?.volume?.loadStatus?.loaded){const{volume:t,imageIdIndex:o}=a;return t instanceof i.JI&&(n=t.convertToCornerstoneImage(e,o)),n}const r=o.Z.getCachedImageBasedOnImageURI(e);return r?(n=r.imageLoadObject,n):(n=g(e,t),n)}function m(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return h(e,t).promise}function f(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=h(e,t);return o.Z.getImageLoadObject(e)||o.Z.putImageLoadObject(e,n).catch(e=>{console.warn(e)}),n.promise}function p(e,t={priority:0,requestType:"prefetch"}){if(!e||0===e.length)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return e.map(e=>f(e,t))}function v(e,t={},n=!1){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,s.uuidv4)()}`);const{imageId:i,skipCreateBuffer:a,onCacheAdd:r}=t,l=c.metaData.get("imagePlaneModule",e),d=l.rows*l.columns,{TypedArrayConstructor:u}=(0,s.getBufferConfiguration)(t.targetBufferType,d),g=new u(a?1:d),h=i;["imagePlaneModule","generalSeriesModule"].forEach(t=>{s.genericMetadataProvider.add(h,{type:t,metadata:c.metaData.get(t,e)})});const m=c.metaData.get("imagePixelModule",e);s.genericMetadataProvider.add(h,{type:"imagePixelModule",metadata:{...m,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const f=I({scalarData:g,onCacheAdd:r,skipCreateBuffer:a},i,!0),p={promise:Promise.resolve(f)};return n||o.Z.putImageLoadObject(h,p),p.promise}function w(e,t={}){if(0===e?.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[],o=e.map(e=>{const o={imageId:t.getDerivedImageId?.(e)||`derived:${(0,s.uuidv4)()}`,...t};return n.push(o.imageId),v(e,o)});return{imageIds:n,promises:o}}function I(e,t,n=!1){const i=c.metaData.get("imagePlaneModule",t),a=i.rows*i.columns,r={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:!1,numComps:1,slope:1,minPixelValue:0,maxPixelValue:255,voiLUTFunction:void 0,rows:i.rows,columns:i.columns,getCanvas:void 0,height:i.rows,width:i.columns,rgba:void 0,columnPixelSpacing:i.columnPixelSpacing,rowPixelSpacing:i.rowPixelSpacing,invert:!1};if(e.scalarData){const t=e.scalarData;if(!(t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array||t instanceof Int16Array))throw new Error("To use createLocalVolume you should pass scalarData of type Uint8Array, Uint16Array, Int16Array or Float32Array");r.sizeInBytes=t.byteLength,r.getPixelData=()=>t}else if(!0!==e.skipCreateBuffer){const{numBytes:t,TypedArrayConstructor:n}=(0,s.getBufferConfiguration)(e.targetBufferType,a),o=new n(a);r.sizeInBytes=t,r.getPixelData=()=>o}e.onCacheAdd?.(r);const l={promise:Promise.resolve(r)};return n||o.Z.putImageLoadObject(r.imageId,l),r}function y(e){l.Z.filterRequests(({additionalDetails:t})=>!t.imageId||t.imageId!==e);const t=o.Z.getImageLoadObject(e);t&&t.cancelFn()}function E(e){e.forEach(e=>y(e))}function x(){const e=l.Z.getRequestPool();Object.keys(e).forEach(t=>{const n=e[t];Object.keys(n).forEach(e=>{const t=n[e].pop().additionalDetails,{imageId:i,volumeId:a}=t;let r;i?r=o.Z.getImageLoadObject(i):a&&(r=o.Z.getVolumeLoadObject(a)),r&&r.cancel()}),l.Z.clearRequestStack(t)})}function b(e,t){d[e]=t}function C(e){const t=u;return u=e,t}function S(){Object.keys(d).forEach(e=>delete d[e]),u=void 0}function T(e,t={targetBufferType:"Uint8Array"}){return w(e,t)}function M(e,t={targetBufferType:"Uint8Array"}){return v(e,t)}},18588:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createAndCacheDerivedSegmentationVolume:()=>R,createAndCacheDerivedVolume:()=>E,createAndCacheVolume:()=>y,createAndCacheVolumeFromImages:()=>b,createLocalSegmentationVolume:()=>P,createLocalVolume:()=>x,getUnknownVolumeLoaderSchema:()=>M,getVolumeLoaderSchemes:()=>S,loadVolume:()=>I,registerUnknownVolumeLoader:()=>T,registerVolumeLoader:()=>C});n(15e3);var o=n(8455),i=n(54131),a=n(84326),r=n(5287),s=n(19546),l=n(74238),c=n(85041),d=n(11677),u=n.n(d),g=n(11723),h=n(28719),m=n(85654);function f(e){const{dimensions:t,metadata:n,spacing:a,direction:r,origin:s}=e,{PhotometricInterpretation:l}=n;let c=1;"RGB"===l&&(c=3);const d=o.ZP.newInstance(),u={numberOfComponents:c};if(d.setDimensions(t),d.setSpacing(a),d.setDirection(r),d.setOrigin(s),e.isDynamicVolume()){!function(e,t,n){t.forEach((t,o)=>{const a=i.default.newInstance({name:`timePoint-${o}`,values:t,...n});e.getPointData().addArray(a)}),e.getPointData().setActiveScalars("timePoint-0")}(d,e.getScalarDataArrays(),u)}else{!function(e,t,n){const o=i.default.newInstance({name:"Pixels",values:t,...n});e.getPointData().setScalars(o)}(d,e.getScalarData(),u)}return d}const p={};let v;function w(e,t){const n=e.indexOf(":"),o=e.substring(0,n);let i=p[o];if(null==i){if(null==v||"function"!=typeof v)throw new Error(`No volume loader for scheme ${o} has been registered`);i=v}const a=i(e,t);return(0,m.setupCacheOptimizationEventListener)(e),a.promise.then(function(e){(0,c.Z)(l.Z,s.Z.VOLUME_LOADED,{volume:e})},function(t){const n={volumeId:e,error:t};(0,c.Z)(l.Z,s.Z.VOLUME_LOADED_FAILED,n)}),a}function I(e,t={imageIds:[]}){if(void 0===e)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=r.Z.getVolumeLoadObject(e);return void 0!==n?n.promise:(n=w(e,t),n.promise.then(e=>(e.imageData=f(e),e)))}async function y(e,t){if(void 0===e)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=r.Z.getVolumeLoadObject(e);return void 0!==n||(n=w(e,t),n.promise.then(e=>{e.imageData=f(e)}),r.Z.putVolumeLoadObject(e,n).catch(e=>{throw e})),n.promise}async function E(e,t){const n=r.Z.getVolume(e);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${e} does not exist.`);let{volumeId:s}=t;const{targetBuffer:l}=t;void 0===s&&(s=(0,g.uuidv4)());const{metadata:c,dimensions:d,spacing:h,origin:m,direction:f}=n,p=n.getScalarData().length,{volumeScalarData:v,numBytes:w}=_(l,p),I=i.default.newInstance({name:"Pixels",numberOfComponents:1,values:v}),y=o.ZP.newInstance();y.setDimensions(d),y.setSpacing(h),y.setDirection(f),y.setOrigin(m),y.getPointData().setScalars(I);const E=new a.J({volumeId:s,metadata:u()(c),dimensions:[d[0],d[1],d[2]],spacing:h,origin:m,direction:f,imageData:y,scalarData:v,sizeInBytes:w,imageIds:[],referencedVolumeId:e}),x={promise:Promise.resolve(E)};return await r.Z.putVolumeLoadObject(s,x),E}function x(e,t,n=!1){const{metadata:l,dimensions:c,spacing:d,origin:h,direction:m,targetBuffer:f}=e;let{scalarData:p}=e;const v=["Uint8Array","Float32Array","Uint16Array","Int16Array"],w=c[0]*c[1]*c[2];if(!p||!v.includes(p.constructor.name)){if(!f?.type||!v.includes(f.type))throw new Error("createLocalVolume: parameter scalarData must be provided and must be either Uint8Array, Float32Array, Uint16Array or Int16Array");({volumeScalarData:p}=_(f,w))}void 0===t&&(t=(0,g.uuidv4)());const I=r.Z.getVolume(t);if(I)return I;const y=p?p.buffer.byteLength:4*w;if(!r.Z.isCacheable(y))throw new Error(s.Z.CACHE_SIZE_EXCEEDED);const E=i.default.newInstance({name:"Pixels",numberOfComponents:1,values:p}),x=o.ZP.newInstance();x.setDimensions(c),x.setSpacing(d),x.setDirection(m),x.setOrigin(h),x.getPointData().setScalars(E);const b=new a.J({volumeId:t,metadata:u()(l),dimensions:[c[0],c[1],c[2]],spacing:d,origin:h,direction:m,imageData:x,scalarData:p,sizeInBytes:y,referencedImageIds:e.referencedImageIds||[],referencedVolumeId:e.referencedVolumeId,imageIds:e.imageIds||[]});if(n)return b;const C={promise:Promise.resolve(b)};return r.Z.putVolumeLoadObject(t,C),b}async function b(e,t,n={}){const{preventCache:o=!1}=n;if(void 0===t)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(void 0===e)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const i=r.Z.getVolume(e);if(i)return Promise.resolve(i);const s=(0,g.generateVolumePropsFromImageIds)(t,e),l=s.imageIds.map((e,t)=>r.Z.getImageLoadObject(e).promise.then(e=>{const n=e.getPixelData(),o=t*e.rows*e.columns;s.scalarData.set(n,o)}));await Promise.all(l);const c=new a.J({...s,referencedImageIds:t,...n});(0,m.performCacheOptimizationForVolume)(c);const d={promise:Promise.resolve(c)};return o||r.Z.putVolumeLoadObject(e,d),d.promise}function C(e,t){p[e]=t}function S(){return Object.keys(p)}function T(e){const t=v;return v=e,t}function M(){return v.name}async function R(e,t={}){return E(e,{...t,targetBuffer:{type:"Uint8Array"}})}async function P(e,t,n=!1){return e.scalarData||(e.scalarData=new Uint8Array(e.dimensions[0]*e.dimensions[1]*e.dimensions[2])),x(e,t,n)}function _(e,t){const{useNorm16Texture:n}=(0,h.P_)().rendering,{TypedArrayConstructor:o,numBytes:i}=(0,g.getBufferConfiguration)(e?.type,t,{use16BitTexture:n,isVolumeBuffer:!0});if(!r.Z.isCacheable(i))throw new Error(s.Z.CACHE_SIZE_EXCEEDED);let a;if(e?.sharedArrayBuffer??(0,h.hG)())switch(e.type){case"Float32Array":a=(0,g.createFloat32SharedArray)(t);break;case"Uint8Array":a=(0,g.createUint8SharedArray)(t);break;case"Uint16Array":case"Int16Array":a=(0,g.createUint16SharedArray)(t);break;default:throw new Error("generateVolumeScalarData: SharedArrayBuffer is not supported for the specified target buffer type")}else a=new o(t);return{volumeScalarData:a,numBytes:i}}},96506:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(42961),i=n(49334);const a=new o.P("imageLoadPool");a.grabDelay=0,a.setMaxSimultaneousRequests(i.Z.Interaction,1e3),a.setMaxSimultaneousRequests(i.Z.Thumbnail,1e3),a.setMaxSimultaneousRequests(i.Z.Prefetch,1e3);const r=a},42961:(e,t,n)=>{"use strict";n.d(t,{P:()=>a});var o=n(49334),i=n(11723);class a{constructor(e){this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.id=e||(0,i.uuidv4)(),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]},compute:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={interaction:0,thumbnail:0,prefetch:0,compute:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5,compute:1e3}}setMaxSimultaneousRequests(e,t){this.maxNumRequests[e]=t}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,t,n,o=0){const i={requestFn:e,type:t,additionalDetails:n};void 0===this.requestPool[t][o]&&(this.requestPool[t][o]=[]),this.requestPool[t][o].push(i),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(t=>{const n=this.requestPool[t];Object.keys(n).forEach(t=>{n[t]=n[t].filter(t=>e(t))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const t=this.maxNumRequests[e]-this.numRequests[e];let n=0;for(let o=0;o<t;o++){const t=this.getNextRequest(e);if(null===t)return!1;if(t){let o;this.numRequests[e]++,this.awake=!0;try{o=t.requestFn()}catch(e){console.warn("sendRequest failed",e)}o?.finally?o.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,n++)}}return n&&this.startAgain(),!0}getNextRequest(e){const t=this.getSortedPriorityGroups(e);for(const n of t)if(this.requestPool[e][n].length)return this.requestPool[e][n].shift();return null}startGrabbing(){const e=this.sendRequests(o.Z.Interaction),t=this.sendRequests(o.Z.Thumbnail),n=this.sendRequests(o.Z.Prefetch),i=this.sendRequests(o.Z.Compute);e||t||n||i||(this.awake=!1)}startAgain(){this.awake&&(void 0!==this.grabDelay?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(t=>this.requestPool[e][t].length).sort((e,t)=>e-t)}getRequestPool(){return this.requestPool}}},85654:(e,t,n)=>{"use strict";n.r(t),n.d(t,{performCacheOptimizationForVolume:()=>l,setupCacheOptimizationEventListener:()=>s});var o=n(82253),i=n(7187),a=n(74238),r=n(28719);function s(e){const{enableCacheOptimization:t}=(0,r.P_)(),n=(0,r.hG)();t&&n&&a.Z.addEventListenerOnce(i.Events.IMAGE_VOLUME_LOADING_COMPLETED,t=>{if(t.detail.volumeId!==e)return;l(o.ZP.getVolume(e))})}function l(e){if(!(e instanceof o.JI))return;const t=e.getScalarData();e.imageCacheOffsetMap.size>0?function(e,t){e.imageCacheOffsetMap.forEach(({offset:e},n)=>{const i=o.ZP.getImage(n);i&&(c(i,t,e),o.ZP.decrementImageCacheSize(i.sizeInBytes))})}(e,t):function(e,t){let n=t;const i=e.imageIds.find(e=>o.ZP.getImage(e));if(!i)return;const a=o.ZP.getImage(i),r=a.imageFrame?.pixelData||a.getPixelData();t.constructor!==r.constructor&&(n=new r.constructor(t.length),n.set(t));e.imageIds.forEach(t=>{const i=o.ZP.getImage(t);if(!i)return;const a=e.getImageIdIndex(t)*i.getPixelData().byteLength;c(i,n,a),o.ZP.decrementImageCacheSize(i.sizeInBytes)})}(e,t)}function c(e,t,n){const o=e.imageFrame?e.imageFrame.pixelData:e.getPixelData(),i=new o.constructor(t.buffer,n,o.length);e.getPixelData=()=>i,e.imageFrame&&(e.imageFrame.pixelData=i),e.bufferView={buffer:t.buffer,offset:n}}},40589:(e,t,n)=>{"use strict";n.r(t),n.d(t,{findMatchingColormap:()=>d,getColormap:()=>l,getColormapNames:()=>c,registerColormap:()=>s});var o=n(31239),i=n(78001),a=n(1790);const r=new Map;function s(e){r.set(e.Name,e)}function l(e){return r.get(e)}function c(){return Array.from(r.keys())}function d(e,t){const n=o.Z.rgbPresetNames.map(e=>o.Z.getPresetByName(e)),r=c().map(e=>l(e)),s=n.concat(r).find(t=>{const{RGBPoints:n}=t;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=4)if(!(0,i.ZP)(n.slice(t+1,t+4),e.slice(t+1,t+4)))return!1;return!0});if(!s)return null;const d=[];if((0,a.m)(t,"vtkVolume")){const e=t.getProperty().getScalarOpacity(0).getDataPointer();if(!e)return{name:s.Name};for(let t=0;t<e.length;t+=2)d.push({value:e[t],opacity:e[t+1]})}return{name:s.Name,opacity:d}}},16159:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(5193);function i(e){const t=o.ZP.newInstance();let n=0,i=1024;return e&&void 0!==e.lower&&void 0!==e.upper&&(n=e.lower,i=e.upper),t.addRGBPoint(n,0,0,0),t.addRGBPoint(i,1,1,1),t}},94791:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MultiTargetEventListenerManager:()=>i.P,TargetEventListeners:()=>o.X});var o=n(66872),i=n(91225)},47326:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(64936),i=n(61054);const a=function(e){const t=e.getCamera(),{spacingInNormalDirection:n,imageVolume:a}=(0,i.Z)(e,t);if(!a)return;const{viewPlaneNormal:r,focalPoint:s}=t,l=e.getActors().find(e=>e.referenceId===a.volumeId||e.uid===a.volumeId);l||console.warn("No actor found for with actorUID of",a.volumeId);const c=l.actor,d=(0,o.Z)(c,r,s),{min:u,max:g,current:h}=d,m=Math.round((g-u)/n)+1;let f=(h-u)/(g-u)*m;return f=Math.floor(f),f>m-1?f=m-1:f<0&&(f=0),{numberOfSlices:m,imageIndex:f}}},54526:(e,t,n)=>{"use strict";function o(e){const t=e.getSize(),n=[];for(let o=0;o<t;o++){const t=[];e.getNodeValue(o,t),n.push(t)}return n}function i(e,t){t?.length&&(e.removeAllPoints(),t.forEach(t=>{e.addRGBPoint(...t)}))}n.r(t),n.d(t,{getTransferFunctionNodes:()=>o,setTransferFunctionNodes:()=>i})},96765:(e,t,n)=>{"use strict";function o(e,t){return e.worldToIndex(t).map(Math.round)}n.d(t,{Z:()=>o})},85041:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(74238);function i(e=o.Z,t,n=null){if(!t)throw new Error("Event type was not defined");const i=new CustomEvent(t,{detail:n,cancelable:!0});return e.dispatchEvent(i)}},15291:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(28635),i=n(7187),a=n(42961);const r=class{constructor(){this.workerRegistry={},this.workerPoolManager=new a.P("webworker")}registerWorker(e,t,n={}){const{maxWorkerInstances:i=1,overwrite:a=!1,autoTerminateOnIdle:r={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!a)return void console.warn(`Worker type '${e}' is already registered...`);a&&this.workerRegistry[e]?.idleCheckIntervalId&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:r.enabled,idleCheckIntervalId:null,idleTimeThreshold:r.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let e=0;e<i;e++){const e=t();s.instances.push(o.Ud(e)),s.nativeWorkers.push(e),s.workerFn=t}this.workerRegistry[e]=s}getNextWorkerAPI(e){const t=this.workerRegistry[e];if(!t)return console.error(`Worker type '${e}' is not registered.`),null;const n=t.instances.filter(e=>null!==e);let i=0,a=t.loadCounters[0]||0;for(let e=1;e<n.length;e++){const n=t.loadCounters[e]||0;n<a&&(i=e,a=n)}if(null===t.instances[i]){const e=t.workerFn();t.instances[i]=o.Ud(e),t.nativeWorkers[i]=e}return t.loadCounters[i]+=1,{api:t.instances[i],index:i}}executeTask(e,t,n={},{requestType:a=i.RequestType.Compute,priority:r=0,options:s={},callbacks:l=[]}={}){return new Promise((i,c)=>{this.workerPoolManager.addRequest(async()=>{const{api:a,index:r}=this.getNextWorkerAPI(e);if(!a){const t=new Error(`No available worker instance for '${e}'`);return console.error(t),void c(t)}try{let s=[];l.length&&(s=l.map(e=>o.sj(e)));const c=this.workerRegistry[e];c.processing=!0;const d=await a[t](n,...s);c.processing=!1,c.lastActiveTime[r]=Date.now(),c.autoTerminateOnIdle&&!c.idleCheckIntervalId&&c.idleTimeThreshold&&(c.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,c.idleTimeThreshold)},c.idleTimeThreshold)),i(d)}catch(n){console.error(`Error executing method '${t}' on worker '${e}':`,n),c(n)}finally{this.workerRegistry[e].loadCounters[r]--}},a,s,r)})}terminateIdleWorkers(e,t){const n=this.workerRegistry[e];if(n.processing)return;const o=Date.now();n.instances.forEach((i,a)=>{const r=n.lastActiveTime[a];!(null!==r&&n.loadCounters[a]>0)&&o-r>t&&this.terminateWorkerInstance(e,a)})}terminate(e){const t=this.workerRegistry[e];t?t.instances.forEach((t,n)=>{this.terminateWorkerInstance(e,n)}):console.error(`Worker type '${e}' is not registered.`)}terminateWorkerInstance(e,t){const n=this.workerRegistry[e],i=n.instances[t];null!==i&&(i[o.Yy](),n.nativeWorkers[t].terminate(),n.instances[t]=null,n.lastActiveTime[t]=null)}}},77267:(e,t,n)=>{"use strict";n.d(t,{Sz:()=>h,zu:()=>g});const o={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="{{color}}" d="M8 16L8 0"></path>\n    <path stroke="{{color}}" d="M16 8L0 8"></path>\n  '},i={x:127,y:60},a='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n',r='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>\n',s='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',l='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',c='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',d={Angle:u(o,{iconContent:'<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n    10l50 50q10 10 10 23z" />',viewBox:{x:1792,y:1792}}),ArrowAnnotate:u(o,{iconContent:'<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',viewBox:{x:24,y:24}}),Bidirectional:u(o,{iconContent:'<g fill="{{color}}" stroke-width="3" stroke="{{color}}">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',viewBox:{x:48,y:48}}),CobbAngle:u(o,{iconContent:'<g stroke="{{color}}" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',viewBox:{x:32,y:32}}),CircleROI:u(o,{iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:u(o,{iconContent:'<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z" />',viewBox:{x:32,y:32}}),FreehandROI:u(o,{iconContent:'<g fill="{{color}}" stroke="{{color}}" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',viewBox:{x:18,y:18}}),FreehandROISculptor:u(o,{iconContent:'<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n  </g>',viewBox:{x:18,y:18}}),Length:u(o,{iconContent:'<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',viewBox:{x:24,y:24}}),Probe:u(o,{iconContent:'<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z" />',viewBox:{x:1792,y:1792}}),RectangleROI:u(o,{iconContent:'<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),TextMarker:u(o,{iconContent:'<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />',viewBox:{x:1792,y:1792}}),Crosshairs:u(o,{iconContent:'<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />',viewBox:{x:1792,y:1792}}),Eraser:u(o,{iconContent:'<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n    0 69.5 20.5t47.5 54.5z" />',viewBox:{x:2048,y:1792}}),Magnify:u(o,{iconContent:'<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />',viewBox:{x:512,y:512}}),Pan:u(o,{iconContent:'<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />',viewBox:{x:1792,y:1792}}),Rotate:u(o,{iconContent:'<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n    39 17 39 59z" />',viewBox:{x:1792,y:1792}}),StackScroll:u(o,{iconContent:'<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />',viewBox:{x:24,y:28}}),WindowLevelRegion:u(o,{iconContent:'<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),WindowLevel:u(o,{iconContent:'\n    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />',viewBox:{x:18,y:18}}),Zoom:u(o,{iconContent:'\n  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />\n  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />',viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:u(o,{iconContent:`${s} ${a}`,viewBox:i}),SegmentationFreeHandFillInside:u(o,{iconContent:`${s} ${r}`,viewBox:i}),SegmentationFreeHandEraseOutside:u(o,{iconContent:`${s} ${a}`,viewBox:i}),SegmentationFreeHandFillOutside:u(o,{iconContent:`${s} ${r}`,viewBox:i}),SegmentationRectangleEraseInside:u(o,{iconContent:`${l} ${a}`,viewBox:i}),RectangleScissor:u(o,{iconContent:`${l} ${r}`,viewBox:i}),"RectangleScissor.FILL_INSIDE":u(o,{iconContent:`${l} ${r}`,viewBox:i}),"RectangleScissor.FILL_OUTSIDE":u(o,{iconContent:`${l} ${r}`,viewBox:i}),"RectangleScissor.ERASE_OUTSIDE":u(o,{iconContent:`${l} ${a}`,viewBox:i}),"RectangleScissor.ERASE_INSIDE":u(o,{iconContent:`${l} ${a}`,viewBox:i}),CircleScissor:u(o,{iconContent:`${c} ${r}`,viewBox:i}),"CircleScissor.FILL_INSIDE":u(o,{iconContent:`${c} ${r}`,viewBox:i}),"CircleScissor.ERASE_OUTSIDE":u(o,{iconContent:`${c} ${a}`,viewBox:i}),"CircleScissor.FILL_OUTSIDE":u(o,{iconContent:`${c} ${r}`,viewBox:i})};function u(e,t){return Object.assign(Object.create(e),t)}function g(e){return d[e]}const h=Object.keys(d)},10424:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var o=n(33232),i=n(62709);const a="viewport-element";function r(e,t){if(o.SB.svgNodeCache[e])return o.SB.svgNodeCache[e][t]?o.SB.svgNodeCache[e][t].domRef:void 0}function s(e,t,n,i){if(!o.SB.svgNodeCache[t])return null;o.SB.svgNodeCache[t][i]={touched:!0,domRef:n},e.appendChild(n)}function l(e,t){o.SB.svgNodeCache[e]&&o.SB.svgNodeCache[e][t]&&(o.SB.svgNodeCache[e][t].touched=!0)}function c(e,t){o.SB.svgNodeCache[t]&&Object.keys(o.SB.svgNodeCache[t]).forEach(n=>{const i=o.SB.svgNodeCache[t][n];!i.touched&&i.domRef&&(e.removeChild(i.domRef),delete o.SB.svgNodeCache[t][n])})}const d=function(e){const t=(0,i.getEnabledElement)(e),{viewportId:n,renderingEngineId:d}=t,u=`${n}:${d}`,g=function(e){const t=`.${a}`,n=e.querySelector(t);return n.querySelector(":scope > .svg-layer")}(e);return Object.keys(o.SB.svgNodeCache[u]).forEach(e=>{o.SB.svgNodeCache[u][e].touched=!1}),{svgLayerElement:g,svgNodeCacheForCanvas:o.SB.svgNodeCache,getSvgNode:r.bind(this,u),appendNode:s.bind(this,g,u),setNodeTouched:l.bind(this,u),clearUntouched:c.bind(this,g,u)}};const u=function(e,t){const n=d(e);t(n),n.clearUntouched()}},22712:(e,t,n)=>{"use strict";var o;n.d(t,{default:()=>i}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(o||(o={}));const i=o},93725:(e,t,n)=>{"use strict";n.d(t,{segmentation:()=>i,utilities:()=>o});n(49507),n(33232),n(69562),n(93423),n(86785);var o=n(79454),i=(n(60020),n(35106),n(88706),n(95482));n(27446),n(51948),n(68096)},64311:(e,t,n)=>{"use strict";n.d(t,{getState:()=>o.Z,style:()=>i.Z});var o=n(91744),i=(n(88048),n(53122))},88706:(e,t,n)=>{"use strict";n.d(t,{config:()=>o,state:()=>i});var o=n(64311),i=(n(11163),n(91398),n(86614));n(41836),n(85056),n(58119)},36048:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var o=n(33232),i=n(68096),a=n(20346),r=n.n(a),s=n(11677),l=n.n(s),c=n(62709),d=n(60020),u=n(23118);const{Active:g,Passive:h,Enabled:m,Disabled:f}=i.ToolModes,p=[{mouseButton:i.MouseBindings.Primary}];class v{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const t=this._toolInstances[e];if(t)return t;console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`)}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,t={}){const n=o.SB.tools[e],i=void 0!==e&&""!==e,a=this.toolOptions[e];if(!i)return void console.warn("Tool with configuration did not produce a toolName: ",t);if(!n)return void console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);if(a)return void console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);const{toolClass:r}=n,s=new r({name:e,toolGroupId:this.id,configuration:t});this._toolInstances[e]=s}addToolInstance(e,t,n={}){let i=o.SB.tools[e]?.toolClass;if(!i){const n=o.SB.tools[t].toolClass;class a extends n{}a.toolName=e,i=a,o.SB.tools[e]={toolClass:a}}this.addTool(i.toolName,n)}addViewport(e,t){if("string"!=typeof e)throw new Error("viewportId must be defined and be a string");const n=(0,c.getRenderingEngines)();if(!t&&n.length>1)throw new Error("You must specify a renderingEngineId when there are multiple rendering engines.");const o=t||n[0].id;this.viewportsInfo.some(({viewportId:t})=>t===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:o});const a=this.getActivePrimaryMouseButtonTool();c.Settings.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(a);const r={toolGroupId:this.id,viewportId:e,renderingEngineId:o};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOLGROUP_VIEWPORT_ADDED,r)}removeViewports(e,t){const n=[];if(this.viewportsInfo.forEach((o,i)=>{let a=!1;o.renderingEngineId===e&&(a=!0,t&&o.viewportId!==t&&(a=!1)),a&&n.push(i)}),n.length)for(let e=n.length-1;e>=0;e--)this.viewportsInfo.splice(n[e],1);const o={toolGroupId:this.id,viewportId:t,renderingEngineId:e};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOLGROUP_VIEWPORT_REMOVED,o)}setActiveStrategy(e,t){const n=this._toolInstances[e];void 0!==n?n.setActiveStrategy(t):console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`)}setToolMode(e,t,n={}){e?t!==i.ToolModes.Active?t!==i.ToolModes.Passive?t!==i.ToolModes.Enabled?t!==i.ToolModes.Disabled?console.warn("setToolMode: mode must be defined"):this.setToolDisabled(e):this.setToolEnabled(e):this.setToolPassive(e):this.setToolActive(e,n||this.restoreToolOptions[e]):console.warn("setToolMode: toolName must be defined")}setToolActive(e,t={}){const n=this._toolInstances[e];if(void 0===n)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);if(!n)return void console.warn(`'${e}' instance ${n} is not registered with this toolGroup, can't set tool mode.`);const o={bindings:[...this.toolOptions[e]?this.toolOptions[e].bindings:[],...t.bindings?t.bindings:[]].reduce((e,t)=>{const n=void 0!==t.numTouchPoints,o=void 0!==t.mouseButton;return e.some(e=>w(e,t))||!n&&!o||e.push(t),e},[]),mode:g};this.toolOptions[e]=o,this._toolInstances[e].mode=g;const a=c.Settings.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(t)&&a)this.setViewportsCursorByToolName(e);else{if(!this.getActivePrimaryMouseButtonTool()&&a){const e=d.MouseCursor.getDefinedCursor("default");this._setCursorForViewports(e)}}this._hasMousePrimaryButtonBinding(t)&&(null===this.prevActivePrimaryToolName?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),"function"==typeof n.onSetToolActive&&n.onSetToolActive(),this._renderViewports();const r={toolGroupId:this.id,toolName:e,toolBindingsOptions:t};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOL_ACTIVATED,r),this._triggerToolModeChangedEvent(e,g,t)}setToolPassive(e,t){const n=this._toolInstances[e];if(void 0===n)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const o=this.getToolOptions(e),i=Object.assign({bindings:o?o.bindings:[]},o,{mode:h}),a=Array.isArray(t?.removeAllBindings)?t.removeAllBindings:this.getDefaultPrimaryBindings();i.bindings=i.bindings.filter(e=>!0!==t?.removeAllBindings&&!a.some(t=>w(e,t)));let r=h;0!==i.bindings.length&&(r=g,i.mode=r),this.toolOptions[e]=i,n.mode=r,"function"==typeof n.onSetToolPassive&&n.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,h)}setToolEnabled(e){const t=this._toolInstances[e];if(void 0===t)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const n={bindings:[],mode:m};this.toolOptions[e]=n,t.mode=m,"function"==typeof t.onSetToolEnabled&&t.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,m)}setToolDisabled(e){const t=this._toolInstances[e];if(void 0===t)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const n={bindings:[],mode:f};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=n,t.mode=f,"function"==typeof t.onSetToolDisabled&&t.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,f)}getToolOptions(e){const t=this.toolOptions[e];if(void 0!==t)return t}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const t=this.toolOptions[e];return t.mode===g&&this._hasMousePrimaryButtonBinding(t)})}setViewportsCursorByToolName(e,t){const n=this._getCursor(e,t);this._setCursorForViewports(n)}_getCursor(e,t){let n,o;return t&&(n=`${e}.${t}`,o=d.SVGMouseCursor.getDefinedCursor(n,!0),o)?o:(n=`${e}`,o=d.SVGMouseCursor.getDefinedCursor(n,!0),o||(n=e,o=d.SVGMouseCursor.getDefinedCursor(n,!0),o||d.MouseCursor.getDefinedCursor("default")))}_setCursorForViewports(e){this.viewportsInfo.forEach(({renderingEngineId:t,viewportId:n})=>{const o=(0,c.getEnabledElementByIds)(n,t);if(!o)return;const{viewport:i}=o;(0,u.initElementCursor)(i.element,e)})}setToolConfiguration(e,t,n){const o=this._toolInstances[e];if(void 0===o)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let i;return i=n?t:Object.assign(o.configuration,t),o.configuration=i,"function"==typeof o.onSetToolConfiguration&&o.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return i.MouseBindings.Primary}getDefaultPrimaryBindings(){return p}getToolConfiguration(e,t){if(void 0===this._toolInstances[e])return void console.warn(`Tool ${e} not present, can't set tool configuration.`);const n=r()(this._toolInstances[e].configuration,t)||this._toolInstances[e].configuration;return l()(n)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}clone(e,t=null){let n=o.fT.getToolGroup(e);return n?(console.warn(`ToolGroup ${e} already exists`),n):(n=o.fT.createToolGroup(e),t=t??(()=>!0),Object.keys(this._toolInstances).filter(t).forEach(e=>{const t=this._toolInstances[e],o=this.toolOptions[e],i=t.mode;n.addTool(e),n.setToolMode(e,i,{bindings:o.bindings??[]})}),n)}_hasMousePrimaryButtonBinding(e){const t=this.getDefaultPrimaryBindings();return e?.bindings?.some(e=>t.some(t=>w(e,t)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:t})=>{(0,c.getRenderingEngine)(e).renderViewport(t)})}_triggerToolModeChangedEvent(e,t,n){const o={toolGroupId:this.id,toolName:e,mode:t,toolBindingsOptions:n};(0,c.triggerEvent)(c.eventTarget,i.Events.TOOL_MODE_CHANGED,o)}}function w(e,t){return e.mouseButton===t.mouseButton&&(e.numTouchPoints===t.numTouchPoints&&e.modifierKey===t.modifierKey)}const I=function(e){if(o.SB.toolGroups.some(t=>t.id===e))return void console.warn(`'${e}' already exists.`);const t=new v(e);return o.SB.toolGroups.push(t),t}},878:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(33232),i=n(85325);const a=function(){const e=[...o.SB.toolGroups];for(const t of e)(0,i.Z)(t.id);o.SB.toolGroups=[]}},85325:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(33232),i=n(95482),a=n(31131);const r=function(e){const t=o.SB.toolGroups.findIndex(t=>t.id===e);t>-1&&(a.ZW.removeToolGroup(e),(0,i.removeSegmentationsFromToolGroup)(e),o.SB.toolGroups.splice(t,1))}},20568:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(33232);const i=function(){return o.SB.toolGroups}},69160:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(33232);const i=function(e){return o.SB.toolGroups.find(t=>t.id===e)}},24321:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(33232),i=n(68096);const a=[i.ToolModes.Active,i.ToolModes.Passive,i.ToolModes.Enabled];const r=function(e){return o.SB.toolGroups.filter(({toolOptions:t})=>{const n=Object.keys(t);for(let o=0;o<n.length;o++)if(e===n[o]&&t[e]&&a.includes(t[e].mode))return!0;return!1})}},56611:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C});var o=n(72076),i=n(62709),a=n(39661),r=n(79454),s=n(93382),l=n(90685),c=n(86614),d=n(11163),u=n(41836),g=n(36705),h=n(86785),m=n(33232),f=n(68096),p=n(46966),v=n(79922),w=n(20724),I=n(23118),y=n(66878);const{transformWorldToIndex:E}=i.utilities;class x extends s.A8{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:b}}){super(e,t),this.isPointNearTool=(e,t,n,o)=>{const a=(0,i.getEnabledElement)(e),{viewport:r}=a,{data:s}=t,{points:l}=s.handles;let c=r.worldToCanvas(l[0]),d=r.worldToCanvas(l[1]),u={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},g=v.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]]);return g<=o||(c=r.worldToCanvas(l[2]),d=r.worldToCanvas(l[3]),u={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},g=v.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]]),g<=o)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const a=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:a,movingTextBox:!1},this._activateModify(o);const r=(0,i.getEnabledElement)(o),{renderingEngine:s}=r;(0,y.Z)(s,a),(0,I.hideElementCursor)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:a}=o,r=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=r.handles.points.findIndex(e=>e===n);const c=(0,p.getViewportIdsWithToolToRender)(a,this.getToolName());(0,I.hideElementCursor)(a),this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(a);const d=(0,i.getEnabledElement)(a),{renderingEngine:u}=d;(0,y.Z)(u,c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:a,viewportIdsToRender:r,newAnnotation:s,hasMoved:l}=this.editData,{data:d}=a;if(s&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,I.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=d.handles,t=o.R3.distance(e[0],e[1]);if(o.R3.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],i=[...e[1]],a=o.K4.create();o.K4.set(a,t[1][0]-t[0][0],t[1][1]-t[1][0]);const r=o.K4.create();o.K4.set(r,-a[1],a[0]);const s=o.K4.create();let l;o.K4.set(s,i[0]-n[0],i[1]-n[0]),l=o.K4.dot(s,r)>0?[n,i]:[i,n],d.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,c.removeAnnotation)(a.annotationUID),(0,y.Z)(u,r),s&&(0,g.F$)(a),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{renderingEngine:s,viewport:l}=r,{worldToCanvas:c}=l,{annotation:d,viewportIdsToRender:u,handleIndex:g}=this.editData,{data:h}=d,m=n.world;h.handles.points[g]=[...m];const f=h.handles.points.map(c),p={start:{x:f[0][0],y:f[0][1]},end:{x:f[1][0],y:f[1][1]}},v=(f[2][0],f[2][1],f[3][0],f[3][1],o.K4.distance(f[0],f[1])/3),w=p.start.x-p.end.x,I=p.start.y-p.end.y,E=Math.sqrt(w*w+I*I),x=w/E,b=I/E,C=(p.start.x+p.end.x)/2,S=(p.start.y+p.end.y)/2,T=C+v*b,M=S-v*x,R=C-v*b,P=S+v*x;h.handles.points[2]=l.canvasToWorld([T,M]),h.handles.points[3]=l.canvasToWorld([R,P]),d.invalidated=!0,(0,y.Z)(s,u),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,o=(0,i.getEnabledElement)(n),{renderingEngine:a}=o,{annotation:r,viewportIdsToRender:s,handleIndex:l,movingTextBox:c}=this.editData,{data:d}=r;if(c){const{deltaPoints:e}=t,n=e.world,{textBox:o}=d.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===l){const{deltaPoints:e}=t,n=e.world;d.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),r.invalidated=!0}else this._dragModifyHandle(e),r.invalidated=!0;(0,y.Z)(a,s)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{viewport:s}=r,{annotation:l,handleIndex:c}=this.editData,{data:d}=l,u=n.world,g=[s.worldToCanvas(d.handles.points[0]),s.worldToCanvas(d.handles.points[1]),s.worldToCanvas(d.handles.points[2]),s.worldToCanvas(d.handles.points[3])],h={start:{x:g[0][0],y:g[0][1]},end:{x:g[1][0],y:g[1][1]}},m={start:{x:g[2][0],y:g[2][1]},end:{x:g[3][0],y:g[3][1]}},f=[...u],p=s.worldToCanvas(f);if(0===c||1===c){const e=g[0===c?1:0],t=o.K4.set(o.K4.create(),p[0]-e[0],p[1]-e[1]),n=o.K4.set(o.K4.create(),g[c][0]-e[0],g[c][1]-e[1]);o.K4.normalize(t,t),o.K4.normalize(n,n);const i={start:{x:e[0],y:e[1]},end:{x:p[0],y:p[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(i,m))return;const a=e,r=this._getSignedAngle(n,t);let l=g[2][0],u=g[2][1],h=g[3][0],v=g[3][1];l-=a[0],u-=a[1],h-=a[0],v-=a[1];const w=l*Math.cos(r)-u*Math.sin(r),I=l*Math.sin(r)+u*Math.cos(r),y=h*Math.cos(r)-v*Math.sin(r),E=h*Math.sin(r)+v*Math.cos(r);l=w+a[0],u=I+a[1],h=y+a[0],v=E+a[1];const x=s.canvasToWorld([l,u]),b=s.canvasToWorld([h,v]);d.handles.points[c]=f,d.handles.points[2]=x,d.handles.points[3]=b}else{const e=2===c?3:2,t={longLineSegment:{start:h.start,end:h.end},shortLineSegment:{start:m.start,end:m.end}},n=o.K4.subtract(o.K4.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),i=o.K4.normalize(o.K4.create(),n),a=o.K4.subtract(o.K4.create(),[p[0],p[1]],[g[c][0],g[c][1]]),r=o.K4.length(a),l=this._getSignedAngle(i,a),u=Math.cos(l)*r,w=o.K4.scaleAndAdd(o.K4.create(),[g[e][0],g[e][1]],i,u);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:p[0],y:p[1]},end:{x:w[0],y:w[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!v.intersectLine([p[0],p[1]],[w[0],w[1]],[h.start.x,h.start.y],[h.end.x,h.end.y]))return;d.handles.points[e]=s.canvasToWorld(w),d.handles.points[c]=f}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,I.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:a}=t;t.highlighted=!1,a.handles.activeHandleIndex=null;const{renderingEngine:r}=(0,i.getEnabledElement)(e);return(0,y.Z)(r,n),o&&(0,g.F$)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{m.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{m.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{m.SB.isInteractingWithTool=!0,e.addEventListener(f.Events.MOUSE_UP,this._endCallback),e.addEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(f.Events.TOUCH_END,this._endCallback),e.addEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(f.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{m.SB.isInteractingWithTool=!1,e.removeEventListener(f.Events.MOUSE_UP,this._endCallback),e.removeEventListener(f.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(f.Events.TOUCH_END,this._endCallback),e.removeEventListener(f.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(f.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:o}=e,{element:i}=o;let a=(0,c.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),s=o.getRenderingEngine(),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const c=a[i],{annotationUID:g,data:m}=c,{points:f,activeHandleIndex:p}=m.handles,v=f.map(e=>o.worldToCanvas(e));l.annotationUID=g;const{color:I,lineWidth:y,lineDash:E,shadow:x}=this.getAnnotationStyle({annotation:c,styleSpecifier:l});if(m.cachedStats[r]&&null!=m.cachedStats[r].unit?c.invalidated&&this._throttledCalculateCachedStats(c,s,e):(m.cachedStats[r]={length:null,width:null,unit:null},this._calculateCachedStats(c,s,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let b;if(!(0,u.isAnnotationVisible)(g))continue;if((0,d.isAnnotationLocked)(c)||this.editData||null===p||(b=[v[p]]),b){const e="0";(0,h.drawHandles)(t,g,e,b,{color:I})}const C=`${g}-line-1`,S=`${g}-line-2`,T="0";(0,h.drawLine)(t,g,T,v[0],v[1],{color:I,lineDash:E,lineWidth:y,shadow:x},C);const M="1";(0,h.drawLine)(t,g,M,v[2],v[3],{color:I,lineDash:E,lineWidth:y,shadow:x},S),n=!0;const R=this.getLinkedTextBoxStyle(l,c);if(!R.visibility){m.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const P=this.configuration.getTextLines(m,r);if(!P||0===P.length)continue;let _;m.handles.textBox.hasMoved||(_=(0,w.getTextBoxCoordsCanvas)(v),m.handles.textBox.worldPosition=o.canvasToWorld(_));const A=o.worldToCanvas(m.handles.textBox.worldPosition),D="1",O=(0,h.drawLinkedTextBox)(t,g,D,P,A,v,{},R),{x:V,y:L,width:N,height:k}=O;m.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([V,L]),topRight:o.canvasToWorld([V+N,L]),bottomLeft:o.canvasToWorld([V,L+k]),bottomRight:o.canvasToWorld([V+N,L+k])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=o.K4.create();o.K4.set(n,t.end.x-t.start.x,t.end.y-t.start.y),o.K4.normalize(n,n);const i={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!v.intersectLine([i.start.x,i.start.y],[i.end.x,i.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:o}=e,{element:i}=n.viewport,r=o.handles.points[0],s=o.handles.points[1],l=o.handles.points[2],c=o.handles.points[3],{cachedStats:d}=o,u=Object.keys(d);for(let e=0;e<u.length;e++){const n=u[e],o=this.getTargetIdImage(n,t);if(!o)continue;const{imageData:i,dimensions:g}=o,h=E(i,r),m=E(i,s),f=E(i,l),p=E(i,c),v=[h,m],w=[f,p],{scale:I,units:y}=(0,a.mh)(o,v),{scale:x,units:b}=(0,a.mh)(o,w),C=this._calculateLength(r,s)/I,S=this._calculateLength(l,c)/x,T=C>S?C:S,M=C>S?S:C,R=C>S?y:b,P=C>S?b:y;this._isInsideVolume(h,m,f,p,g)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,d[n]={length:T,width:M,unit:y,lengthUnit:R,widthUnit:P}}return e.invalidated=!1,(0,g.hg)(e,i),d},this._isInsideVolume=(e,t,n,o,a)=>i.utilities.indexWithinDimensions(e,a)&&i.utilities.indexWithinDimensions(t,a)&&i.utilities.indexWithinDimensions(n,a)&&i.utilities.indexWithinDimensions(o,a),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,l.Z)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,r=(0,i.getEnabledElement)(o),{viewport:s,renderingEngine:l}=r;this.isDrawing=!0;const d=s.getCamera(),{viewPlaneNormal:u,viewUp:g}=d,h=this.getReferencedImageId(s,a,u,g),m=s.getFrameOfReferenceUID(),f={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...g],FrameOfReferenceUID:m,referencedImageId:h,...s.getViewReference({points:[a]})},data:{handles:{points:[[...a],[...a],[...a],[...a]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};(0,c.addAnnotation)(f,o);const v=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,I.hideElementCursor)(o),e.preventDefault(),(0,y.Z)(l,v),f}_calculateLength(e,t){const n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+o*o+i*i)}}function b(e,t){const{cachedStats:n,label:o}=e,{length:i,width:a,unit:s,lengthUnit:l,widthUnit:c}=n[t],d=[];return o&&d.push(o),void 0===i||d.push(`L: ${(0,r.roundNumber)(i)} ${l||s}`,`W: ${(0,r.roundNumber)(a)} ${c||s}`),d}x.toolName="Bidirectional";const C=x},22455:(e,t,n)=>{"use strict";n.d(t,{Z:()=>V});var o=n(62709),i=n(72076),a=n(39661),r=n(79454),s=n(60489),l=n(44037),c=n(90685),d=n(46966),u=n(66878),g=n(75698),h=n(89026),m=n(58391),f=n(21879),p=n(82571),v=n(54435),w=n(36705),I=n(86785),y=n(20724),E=n(42744),x=n(31955),b=n(20752),C=n(15607),S=n(51053),T=n(3042),M=n(22955),R=n(68096);const{pointCanProjectOnLine:P}=s.polyline,{EPSILON:_}=o.CONSTANTS,A=1-_;class D extends M.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:R.KeyboardBindings.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:O,statsCalculator:S.BasicStatsCalculator}}){super(e,t),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=e=>{const t=e.detail,{element:n}=t,i=(0,o.getEnabledElement)(n),{renderingEngine:a}=i,r=this.createAnnotation(e);this.addAnnotation(r,n);const s=(0,d.getViewportIdsWithToolToRender)(n,this.getToolName());return this.activateDraw(e,r,s),e.preventDefault(),(0,u.Z)(a,s),r},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,a=(0,d.getViewportIdsWithToolToRender)(i,this.getToolName());this.activateOpenContourEndEdit(e,t,a,n)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n,i=(0,d.getViewportIdsWithToolToRender)(o,this.getToolName());t.data.contour.closed?this.activateClosedContourEdit(e,t,i):this.activateOpenContourEdit(e,t,i),e.preventDefault()},this.isPointNearTool=(e,t,n,i)=>{const a=(0,o.getEnabledElement)(e),{viewport:r}=a,{polyline:s}=t.data.contour;let l=r.worldToCanvas(s[0]);for(let e=1;e<s.length;e++){const t=l,o=r.worldToCanvas(s[e]);if(P(n,t,o,i))return!0;l=o}if(!t.data.contour.closed)return!1;const c=r.worldToCanvas(s[0]),d=r.worldToCanvas(s[s.length-1]);return P(n,c,d,i)},this.cancel=e=>{const t=this.isDrawing,n=this.isEditingOpen,o=this.isEditingClosed;t?this.cancelDrawing(e):n?this.cancelOpenContourEdit(e):o&&this.cancelClosedContourEdit(e)},this._calculateCachedStats=(e,t,n,l)=>{const{data:c}=e,{cachedStats:d}=c,{polyline:u,closed:g}=c.contour,h=Object.keys(d);for(let l=0;l<h.length;l++){const m=h[l],f=this.getTargetIdImage(m,n);if(!f)continue;const{imageData:p,metadata:v}=f,w=u.map(e=>t.worldToCanvas(e)),I=w[0],y=t.canvasToWorld(I),S=t.canvasToWorld([I[0]+1,I[1]]),M=t.canvasToWorld([I[0],I[1]+1]),R=i.R3.distance(y,S),P=i.R3.distance(y,M),_=o.utilities.transformWorldToIndex(p,u[0]);_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]);let A=_[0],D=_[0],O=_[1],V=_[1],L=_[2],N=_[2];for(let e=1;e<u.length;e++){const t=o.utilities.transformWorldToIndex(p,u[e]);t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),A=Math.min(A,t[0]),D=Math.max(D,t[0]),O=Math.min(O,t[1]),V=Math.max(V,t[1]),L=Math.min(L,t[2]),N=Math.max(N,t[2])}const k=o.utilities.transformWorldToIndex(p,u[1]);k[0]=Math.floor(k[0]),k[1]=Math.floor(k[1]),k[2]=Math.floor(k[2]);const{scale:B,areaUnits:U}=(0,a.mh)(f,()=>{const e=c.contour.polyline,n=e.length,i=new Array(n);for(let o=0;o<n;o++)i[o]=t.worldToCanvas(e[o]);const{maxX:a,maxY:s,minX:l,minY:d}=r.math.polyline.getAABB(i),u=t.canvasToWorld([l,d]),g=o.utilities.transformWorldToIndex(p,u),h=t.canvasToWorld([a,s]);return[g,o.utilities.transformWorldToIndex(p,h)]});let Z=s.polyline.getArea(w)/B/B;Z*=R*P;const F=.01*(D-A),q=.01*(V-O),W=.01*(N-L);A=Math.floor(A-F),D=Math.ceil(D+F),O=Math.floor(O-q),V=Math.ceil(V+q),L=Math.floor(L-W),N=Math.ceil(N+W);const j=[[A,D],[O,V],[L,N]],z=p.indexToWorld([D,V,N]),G=t.worldToCanvas(z);let H=0,$=[],K=0;const X=(0,x.Z)(p,(e,n)=>{let o=!0;const i=t.worldToCanvas(e);return i[1]!=H&&(K=0,H=i[1],$=(0,E.getLineSegmentIntersectionsCoordinates)(w,i,[G[0],i[1]]),$.sort(function(e,t){return e[0]===t[0]?0:e[0]<t[0]?-1:1})),$.length&&i[0]>$[0][0]&&($.shift(),K++),K%2==0&&(o=!1),o},this.configuration.statsCalculator.statsCallback,j),J={isPreScaled:(0,b.P)(t,m),isSuvScaled:this.isSuvScaled(t,m,e.metadata.referencedImageId)},Y=(0,C.F)(v.Modality,e.metadata.referencedImageId,J),Q=this.configuration.statsCalculator.getStatistics();d[m]={Modality:v.Modality,area:Z,perimeter:(0,T.Z)(w,g),mean:Q.mean?.value,max:Q.max?.value,stdDev:Q.stdDev?.value,statsArray:Q.array,pointsInShape:X,areaUnit:U,modalityUnit:Y}}return(0,w.hg)(e,l.viewport.element,R.ChangeTypes.StatsUpdated),e.invalidated=!1,d},this._renderStats=(e,t,n,o)=>{const{data:i}=e,a=this.getTargetId(t),r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},s=this.getLinkedTextBoxStyle(r,e);if(!s.visibility)return;const l=this.configuration.getTextLines(i,a);if(!l||0===l.length)return;const c=i.contour.polyline.map(e=>t.worldToCanvas(e));if(!i.handles.textBox.hasMoved){const e=(0,y.getTextBoxCoordsCanvas)(c);i.handles.textBox.worldPosition=t.canvasToWorld(e)}const d=t.worldToCanvas(i.handles.textBox.worldPosition),u=(0,I.drawLinkedTextBox)(o,e.annotationUID??"","1",l,d,c,{},s),{x:g,y:h,width:m,height:f}=u;i.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([g,h]),topRight:t.canvasToWorld([g+m,h]),bottomLeft:t.canvasToWorld([g,h+f]),bottomRight:t.canvasToWorld([g+m,h+f])}},(0,g.Z)(this),(0,h.Z)(this),(0,m.Z)(this),(0,f.Z)(this),(0,p.Z)(this),(0,v.Z)(this),this._throttledCalculateCachedStats=(0,c.Z)(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,t){if(!t||!t.length)return;const n=(0,o.getEnabledElement)(e),{viewport:i}=n;let a;if(i instanceof o.VolumeViewport){const e=i.getCamera(),{spacingInNormalDirection:n}=o.utilities.getTargetVolumeAndSpacingInNormalDir(i,e);a=this.filterAnnotationsWithinSlice(t,e,n)}else a=(0,l.filterAnnotationsForDisplay)(i,t);return a}filterAnnotationsWithinSlice(e,t,n){const{viewPlaneNormal:o}=t,a=e.filter(e=>{const t=e.metadata.viewPlaneNormal,n=Math.abs(i.R3.dot(o,t))>A;return t&&n});if(!a.length)return[];const r=n/2,{focalPoint:s}=t,l=[];for(const e of a){const t=e.data.contour.polyline[0];if(!e.isVisible)continue;const n=i.R3.create();i.R3.sub(n,s,t);const a=i.R3.dot(n,o);Math.abs(a)<r&&l.push(e)}return l}isContourSegmentationTool(){return!1}createAnnotation(e){const t=e.detail.currentPoints.world,n=super.createAnnotation(e);return o.utilities.deepMerge(n,{data:{contour:{polyline:[[...t]]},label:"",cachedStats:{}},onInterpolationComplete:e=>{e.data.handles.points.length=0}})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:t,targetId:n,svgDrawingHelper:o}=e,i=e.annotation;let a=!1;const{viewport:r,renderingEngine:s}=t,l=this.isDrawing,c=this.isEditingOpen,d=this.isEditingClosed;if(l||c||d){const e=this.commonData.annotation.annotationUID;if(i.annotationUID===e)if(l)this.renderContourBeingDrawn(t,o,i);else if(d)this.renderClosedContourBeingEdited(t,o,i);else{if(!c)throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);this.renderOpenContourBeingEdited(t,o,i)}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(t,o,i):this.renderContour(t,o,i);a=!0}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(t,o,i):this.renderContour(t,o,i);if(this.configuration.calculateStats)return this._calculateStatsIfActive(i,n,r,s,t),this._renderStats(i,r,t,o),a}_calculateStatsIfActive(e,t,n,o,i){const a=this.commonData?.annotation.annotationUID;if((e.annotationUID!==a||this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:a}=e;a.cachedStats[t]&&null!=a.cachedStats[t].areaUnit?e.invalidated&&this._throttledCalculateCachedStats(e,n,o,i):(a.cachedStats[t]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(e,n,o,i))}}}function O(e,t){const n=e.cachedStats[t],{area:o,mean:i,stdDev:a,perimeter:s,max:l,isEmptyArea:c,areaUnit:d,modalityUnit:u}=n||{},g=[];if(o){const e=c?"Area: Oblique not supported":`Area: ${(0,r.roundNumber)(o)} ${d}`;g.push(e)}return i&&g.push(`Mean: ${(0,r.roundNumber)(i)} ${u}`),Number.isFinite(l)&&g.push(`Max: ${(0,r.roundNumber)(l)} ${u}`),a&&g.push(`Std Dev: ${(0,r.roundNumber)(a)} ${u}`),s&&g.push(`Perimeter: ${(0,r.roundNumber)(s)} ${u}`),g}D.toolName="PlanarFreehandROI";const V=D},66809:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var o=n(62709),i=n(72076),a=n(92622),r=n(11163),s=n(41836),l=n(86614),c=n(36705);class d extends a.Z{static createAnnotation(...e){let t={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const n of e)t=o.utilities.deepMerge(t,n);return t}static createAnnotationForViewport(e,...t){return this.createAnnotation({metadata:e.getViewReference()},...t)}static createAndAddAnnotation(e,...t){const n=this.createAnnotationForViewport(e,...t);(0,l.addAnnotation)(n,e.element),(0,c.hg)(n,e.element)}constructor(e,t){super(e,t),this.mouseMoveCallback=(e,t)=>{if(!t)return!1;const{element:n,currentPoints:o}=e.detail,i=o.canvas;let a=!1;for(const e of t){if((0,r.isAnnotationLocked)(e)||!(0,s.isAnnotationVisible)(e.annotationUID))continue;const{data:t}=e,o=t.handles?t.handles.activeHandleIndex:void 0,l=this._imagePointNearToolOrHandle(n,e,i,6),c=l&&!e.highlighted,d=!l&&e.highlighted;c||d?(e.highlighted=!e.highlighted,a=!0):t.handles&&t.handles.activeHandleIndex!==o&&(a=!0)}return a},e.configuration?.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),e.configuration?.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,t,n,a){const r=(0,o.getEnabledElement)(e),{viewport:s}=r,{data:l}=t,{isCanvasAnnotation:c}=l,{points:d,textBox:u}=l.handles;if(u){const{worldBoundingBox:e}=u;if(e){const t={topLeft:s.worldToCanvas(e.topLeft),topRight:s.worldToCanvas(e.topRight),bottomLeft:s.worldToCanvas(e.bottomLeft),bottomRight:s.worldToCanvas(e.bottomRight)};if(n[0]>=t.topLeft[0]&&n[0]<=t.bottomRight[0]&&n[1]>=t.topLeft[1]&&n[1]<=t.bottomRight[1])return l.handles.activeHandleIndex=null,u}}for(let e=0;e<d?.length;e++){const t=d[e],o=c?t.slice(0,2):s.worldToCanvas(t);if(!0===i.K4.distance(n,o)<a)return l.handles.activeHandleIndex=e,t}l.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,t){return{visibility:this.getStyle("textBoxVisibility",e,t),fontFamily:this.getStyle("textBoxFontFamily",e,t),fontSize:this.getStyle("textBoxFontSize",e,t),color:this.getStyle("textBoxColor",e,t),shadow:this.getStyle("textBoxShadow",e,t),background:this.getStyle("textBoxBackground",e,t),lineWidth:this.getStyle("textBoxLinkLineWidth",e,t),lineDash:this.getStyle("textBoxLinkLineDash",e,t)}}isSuvScaled(e,t,n){if(e instanceof o.BaseVolumeViewport){const e=o.utilities.getVolumeId(t),n=o.cache.getVolume(e);return void 0!==n?.scaling?.PT}const i=n&&o.metaData.get("scalingModule",n);return"number"==typeof i?.suvbw}getAnnotationStyle(e){const{annotation:t,styleSpecifier:n}=e,o=e=>this.getStyle(e,n,t),{annotationUID:i}=t,a=(0,s.isAnnotationVisible)(i),l=(0,r.isAnnotationLocked)(t),c=o("lineWidth"),d=o("lineDash"),u=o("color");return{visibility:a,locked:l,color:u,lineWidth:c,lineDash:d,lineOpacity:1,fillColor:u,fillOpacity:0,shadow:o("shadow"),textbox:this.getLinkedTextBoxStyle(n,t)}}_imagePointNearToolOrHandle(e,t,n,o){if(this.getHandleNearImagePoint(e,t,n,o))return!0;return!!this.isPointNearTool(e,t,n,o,"mouse")||void 0}}d.toolName="AnnotationTool";const u=d},35904:(e,t,n)=>{"use strict";n.d(t,{R:()=>i,Z:()=>a});const o={renderOutline:!0,outlineWidthActive:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.7,fillAlphaInactive:.65,outlineOpacity:1,outlineOpacityInactive:.85};function i(e){return e&&"boolean"==typeof e.renderOutline&&"number"==typeof e.outlineWidthActive&&"number"==typeof e.outlineWidthInactive&&"number"==typeof e.activeSegmentOutlineWidthDelta&&"boolean"==typeof e.renderFill&&"boolean"==typeof e.renderFillInactive&&"number"==typeof e.fillAlpha&&"number"==typeof e.fillAlphaInactive&&"number"==typeof e.outlineOpacity&&"number"==typeof e.outlineOpacityInactive}const a=function(){return o}},27446:(e,t,n)=>{"use strict";n.d(t,{tv:()=>i.Z,A8:()=>o.A8,PlanarFreehandContourSegmentationTool:()=>s.Z,Hx:()=>r.Z,Qt:()=>N,Cd:()=>_,xX:()=>y});var o=n(93382),i=(n(33908),n(78791),n(32e3),n(6090),n(61935),n(52826),n(13978),n(61495),n(95574),n(9260),n(25856),n(98386),n(34572)),a=(n(2235),n(51190),n(68049),n(69243),n(94021),n(36975),n(56611),n(3098),n(86479),n(41495),n(10279)),r=(n(71330),n(87248),n(60650),n(69316),n(22455)),s=n(51593),l=(n(36632),n(57720),n(45248),n(37442),n(35061),n(28073),n(7003),n(32839),n(62709)),c=n(74297),d=n(95482),u=n(39949),g=n(60721),h=n(27078),m=n(61958),f=n(44284),p=n(83456),v=n(33232);const w=s.Z.toolName;class I extends o.ml{constructor(e={},t={configuration:{}}){super(e,t),this.renderSegmentation=e=>{const t=(0,h.getToolGroup)(e);if(!t)return;const n=(0,g.getSegmentationRepresentations)(e);if(!n||0===n.length)return;const o=t.viewportsInfo.map(({renderingEngineId:e,viewportId:t})=>{const n=(0,l.getEnabledElementByIds)(t,e);if(n)return n.viewport}),i=n.map(t=>{const n=this._getMergedRepresentationsConfig(e),i=[],a={[c.default.Labelmap]:p.Pm,[c.default.Contour]:f.p,[c.default.Surface]:m.o};t.type===c.default.Contour&&this.addPlanarFreeHandToolIfAbsent(e);const r=a[t.type];for(const e of o){const o=r.render(e,t,n);i.push(o)}return i});Promise.allSettled(i).then(()=>{o.forEach(e=>{e.render()})})}}onSetToolEnabled(){const e=this.toolGroupId,t=(0,g.getSegmentationRepresentations)(e);t&&0!==t.length&&t.forEach(t=>{(0,u.setSegmentationVisibility)(e,t.segmentationRepresentationUID,!0)})}onSetToolDisabled(){const e=this.toolGroupId,t=(0,g.getSegmentationRepresentations)(e);t&&0!==t.length&&t.forEach(t=>{(0,u.setSegmentationVisibility)(e,t.segmentationRepresentationUID,!1)})}addPlanarFreeHandToolIfAbsent(e){w in v.SB.tools||(0,v.LK)(s.Z);const t=(0,h.getToolGroup)(e);t.hasTool(w)||(t.addTool(w),t.setToolPassive(w))}_getMergedRepresentationsConfig(e){const t=d.config.getToolGroupSpecificConfig(e),n=d.config.getGlobalConfig();return l.utilities.deepMerge(n,t)}}I.toolName="SegmentationDisplay";const y=I;n(38207),n(30809),n(30862);var E=n(50097),x=n(11163),b=n(86785),C=n(46966),S=n(23118),T=n(66878),M=n(41836),R=n(36705);class P extends a.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,l.getEnabledElement)(o),{viewport:r,renderingEngine:s}=a;this.isDrawing=!0;const c=r.getCamera(),{viewPlaneNormal:d,viewUp:u}=c,g=this.getTargetId(r);let h,m;if(r instanceof l.StackViewport)h=g.split("imageId:")[1];else{m=l.utilities.getVolumeId(g);const e=l.cache.getVolume(m);h=l.utilities.getClosestImageId(e,i,d)}const f=r.getFrameOfReferenceUID(),p={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:a,viewUp:[...u],FrameOfReferenceUID:f,referencedImageId:h,toolName:this.getToolName(),volumeId:m},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},segmentationId:null}};(0,E.ud)(p,o);const v=(0,C.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:v,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,S.hideElementCursor)(o),e.preventDefault(),(0,T.Z)(s,v),p},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,E.fy)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const s=a[e],{annotationUID:l,data:c}=s,{points:d,activeHandleIndex:u}=c.handles,g=d.map(e=>o.worldToCanvas(e));r.annotationUID=l;const h=this.getStyle("lineWidth",r,s),m=this.getStyle("lineDash",r,s),f="rgb(255, 255, 255)";if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let p;if((0,R.hg)(s,i),!(0,M.isAnnotationVisible)(l))continue;if((0,x.isAnnotationLocked)(s)||this.editData||null===u||(p=[g[u]]),p){const e="0";(0,b.drawHandles)(t,l,e,p,{color:f})}const v="0";(0,b.drawRect)(t,l,v,g[0],g[3],{color:f,lineDash:m,lineWidth:h}),n=!0}return n}}}P.toolName="RectangleROIThreshold";const _=P;var A=n(72076),D=n(90685),O=n(79454);const{transformWorldToIndex:V}=l.utilities;class L extends a.Z{constructor(e={},t={configuration:{numSlicesToPropagate:10,computePointsInsideVolume:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,l.getEnabledElement)(o),{viewport:r,renderingEngine:s}=a;this.isDrawing=!0;const c=r.getCamera(),{viewPlaneNormal:d,viewUp:u}=c;let g,h,m;if(r instanceof l.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(r);m=l.utilities.getVolumeId(e),h=l.cache.getVolume(m),g=l.utilities.getClosestImageId(h,i,d)}if(!g)throw new Error("This tool does not work on non-acquisition planes");const f=r.getCurrentImageIdIndex(),p=l.utilities.getSpacingInNormalDirection(h,d),v=this._getEndSliceIndex(h,i,p,d),w=r.getFrameOfReferenceUID(),I={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:a,viewUp:[...u],FrameOfReferenceUID:w,referencedImageId:g,toolName:this.getToolName(),volumeId:m,spacingInNormal:p},data:{label:"",startSlice:f,endSlice:v,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[g]},handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(I,h),(0,E.ud)(I,o);const y=(0,C.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:I,viewportIdsToRender:y,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,S.hideElementCursor)(o),e.preventDefault(),(0,T.Z)(s,y),I},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:r}=this.editData,{data:s}=o;if(a&&!r)return;s.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,S.resetElementCursor)(n);const c=(0,l.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,E._x)(o.annotationUID);const d=this.getTargetId(c.viewport),u=l.cache.getVolume(d.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(o,u,c),(0,T.Z)(c.renderingEngine,i),a&&(0,R.F$)(o)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,i=(0,E.fy)(this.getToolName(),o.element);if(!i?.length)return n;const a=o.getCurrentImageIdIndex(),r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let s=0;s<i.length;s++){const l=i[s],{annotationUID:c,data:d}=l,{startSlice:u,endSlice:g}=d,{points:h,activeHandleIndex:m}=d.handles,f=h.map(e=>o.worldToCanvas(e));r.annotationUID=c;const p=this.getStyle("lineWidth",r,l),v=this.getStyle("lineDash",r,l),w="rgb(255, 255, 255)";if(a<Math.min(u,g)||a>Math.max(u,g))continue;l.invalidated&&this._throttledCalculateCachedStats(l,e);let I,y=!1;if(a!==u&&a!==g||(y=!0),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,M.isAnnotationVisible)(c))continue;if((0,x.isAnnotationLocked)(l)||this.editData||null===m||!y||(I=[f[m]]),I){const e="0";(0,b.drawHandles)(t,c,e,I,{color:w})}let E=v;y||(E=2);const C="0";(0,b.drawRect)(t,c,C,f[0],f[3],{color:w,lineDash:E,lineWidth:p}),n=!0}return n},this._throttledCalculateCachedStats=(0,D.Z)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:o}=e,{viewPlaneNormal:i,spacingInNormal:a}=o,{imageData:r}=t,{startSlice:s,endSlice:c}=n,{points:d}=n.handles,u=V(r,d[0]);if(u[2]!==s)throw new Error("Start slice does not match");const g=A.R3.fromValues(u[0],u[1],c),h=A.R3.create();r.indexToWorldVec3(u,h);const m=A.R3.create();r.indexToWorldVec3(g,m);const f=A.R3.distance(h,m),p=[];for(let e=0;e<f;e+=a)p.push(d.map(t=>{const n=A.R3.create();return A.R3.scaleAndAdd(n,t,i,e),Array.from(n)}));n.cachedStats.projectionPoints=p;const v=[];for(const e of p){const n=l.utilities.getClosestImageId(t,e[0],i);v.push(n)}n.cachedStats.projectionPointsImageIds=v}_computePointsInsideVolume(e,t,n){const{data:o}=e,i=o.cachedStats.projectionPoints,a=[[]];for(let e=0;e<i.length;e++){if(!t)continue;const n=i[e][0],r=o.handles.points[0],s=o.handles.points[3],{dimensions:l,imageData:c}=t,d=V(c,r),u=V(c,n);d[0]=Math.floor(d[0]),d[1]=Math.floor(d[1]),d[2]=Math.floor(u[2]);const g=V(c,s);if(g[0]=Math.floor(g[0]),g[1]=Math.floor(g[1]),g[2]=Math.floor(u[2]),this._isInsideVolume(d,g,l)){this.isHandleOutsideImage=!1;const e=[[Math.min(d[0],g[0]),Math.max(d[0],g[0])],[Math.min(d[1],g[1]),Math.max(d[1],g[1])],[Math.min(d[2],g[2]),Math.max(d[2],g[2])]],t=(0,O.pointInShapeCallback)(c,()=>!0,null,e);a.push(t)}}o.cachedStats.pointsInVolume=a}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:o}=t,{cachedStats:i}=n,a=this.getTargetId(o),r=l.cache.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,r),e.invalidated=!1,(0,R.hg)(e,o.element),i}_getEndSliceIndex(e,t,n,o){const i=this.configuration.numSlicesToPropagate,a=A.R3.create();A.R3.scaleAndAdd(a,t,o,i*n);const r=n/2,{imageIds:s}=e;let c;for(let e=0;e<s.length;e++){const t=s[e],{imagePositionPatient:n}=l.metaData.get("imagePlaneModule",t),i=A.R3.create();A.R3.sub(i,a,n);const d=A.R3.dot(i,o);Math.abs(d)<r&&(c=e)}return c}}L.toolName="RectangleROIStartEndThreshold";const N=L;n(2023),n(95459),n(78566),n(23332),n(45986),n(99787)},13278:(e,t,n)=>{"use strict";n.d(t,{B:()=>l,M:()=>r});var o=n(62709),i=n(50097),a=n(72076);function r(e,t,n,a){const r=e.getViewReference(),{viewPlaneNormal:l,FrameOfReferenceUID:c}=r,d={annotationUID:a?.annotationUID||o.utilities.uuidv4(),data:{handles:{points:n}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:t,viewPlaneNormal:l,FrameOfReferenceUID:c,referencedImageId:s(e,n[0],l),...a}};return(0,i.ud)(d,e.element),d}function s(e,t,n){let i;if(e instanceof o.StackViewport)i=l(e,t,n);else{if(!(e instanceof o.BaseVolumeViewport))throw new Error("getReferencedImageId: viewport must be a StackViewport or BaseVolumeViewport");{const a=function(e){const t=e.getReferenceId?.();if(t)return t;if(e instanceof o.BaseVolumeViewport)return`volumeId:${function(e){const t=e.getActors();if(!t)return;return t.find(e=>"vtkVolume"===e.actor.getClassName())?.uid}(e)}`;throw new Error("getTargetId: viewport must have a getTargetId method")}(e),r=o.utilities.getVolumeId(a),s=o.cache.getVolume(r);i=o.utilities.getClosestImageId(s,t,n)}}return i}function l(e,t,n){const i=e.getImageIds();if(!i||!i.length)return;const r=i.map(e=>{const{imagePositionPatient:i}=o.metaData.get("imagePlaneModule",e),r=function(e,t,n){const o=a.R3.create();a.R3.sub(o,e,t);const i=a.R3.dot(o,n);return Math.abs(i)}(t,i,n);return{imageId:e,distance:r}});return r.sort((e,t)=>e.distance-t.distance),r[0].imageId}},93341:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const o=function(e,t){const n=e.findIndex(([e,t])=>e===t);if(-1===n)throw new Error("3D bounding boxes not supported in an oblique plane");return e[n][0]-=t,e[n][1]+=t,e}},64652:(e,t,n)=>{"use strict";n.d(t,{g:()=>r,o:()=>s});var o=n(62709);const{EPSILON:i}=o.CONSTANTS;function a(e,t,n=!1){let o=1/0,a=n?-1/0:0,r=1/0,s=n?-1/0:0,l=1/0,c=n?-1/0:0;const d=3===e[0]?.length;for(let t=0;t<e.length;t++){const n=e[t];o=Math.min(n[0],o),a=Math.max(n[0],a),r=Math.min(n[1],r),s=Math.max(n[1],s),d&&(l=Math.min(n[2]??l,l),c=Math.max(n[2]??c,c))}return t?(o=Math.max(n?t[0]+i:0,o),a=Math.min(n?t[0]-i:t[0]-1,a),r=Math.max(n?t[1]+i:0,r),s=Math.min(n?t[1]-i:t[1]-1,s),d&&3===t.length&&(l=Math.max(n?t[2]+i:0,l),c=Math.min(n?t[2]-i:t[2]-1,c))):n||(o=Math.max(0,o),a=Math.min(1/0,a),r=Math.max(0,r),s=Math.min(1/0,s),d&&(l=Math.max(0,l),c=Math.min(1/0,c))),d?[[o,a],[r,s],[l,c]]:[[o,a],[r,s],null]}function r(e,t){return a(e,t,!1)}function s(e,t){return a(e,t,!0)}},87758:(e,t,n)=>{"use strict";n.r(t),n.d(t,{extend2DBoundingBoxInViewAxis:()=>o.Z,getBoundingBoxAroundShape:()=>i.g,getBoundingBoxAroundShapeIJK:()=>i.g,getBoundingBoxAroundShapeWorld:()=>i.o});var o=n(93341),i=n(64652)},70232:(e,t,n)=>{"use strict";function o(e,t,n){return Math.min(Math.max(t,e),n)}n.d(t,{ZP:()=>i});const i=o},52577:(e,t,n)=>{"use strict";n.d(t,{D:()=>i});var o=n(60721);function i(e){if(e.parentAnnotationUID)return;if(!e.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,i=(0,o.getSegmentation)(t);i.representationData.CONTOUR||(i.representationData.CONTOUR={annotationUIDsMap:new Map});const{annotationUIDsMap:a}=i.representationData.CONTOUR;let r=a.get(n);r||(r=new Set,a.set(n,r)),a.set(n,r.add(e.annotationUID))}},59865:(e,t,n)=>{"use strict";function o(e,t){const{segmentation:n}=e.data,{segmentation:o}=t.data;return n.segmentationId===o.segmentationId&&n.segmentIndex===o.segmentIndex}function i(e){return!!e.data?.segmentation}n.r(t),n.d(t,{addContourSegmentationAnnotation:()=>a.D,areSameSegment:()=>o,isContourSegmentationAnnotation:()=>i,removeContourSegmentationAnnotation:()=>s});var a=n(52577),r=n(95482);function s(e){if(!e.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:t,segmentIndex:n}=e.data.segmentation,o=r.state.getSegmentation(t),{annotationUIDsMap:i}=o?.representationData.CONTOUR||{},a=i?.get(n);a&&(a.delete(e.annotationUID),a.size||i.delete(n))}},3042:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const o=function(e,t){let n=0;for(let t=0;t<e.length-1;t++){const o=e[t],i=e[t+1];n+=Math.sqrt(Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2))}if(t){const t=e[0],o=e[e.length-1];n+=Math.sqrt(Math.pow(o[0]-t[0],2)+Math.pow(o[1]-t[1],2))}return n}},66299:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(62709),i=n(72076);const{isEqual:a}=o.utilities;function r(e,t){const{polyline:n}=e.data.contour,{points:o}=e.data.handles,{length:r}=o;if(t===r)return n.length;if(t<0&&(t=(t+r)%r),0===t)return 0;const s=o[t],l=n.findIndex(e=>a(s,e));if(-1!==l)return l;let c=1/0;return n.reduce((e,t,n)=>{const o=i.R3.squaredDistance(t,s);return o<c?(c=o,n):e},-1)}},11203:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AnnotationToPointData:()=>E,acceptAutogeneratedInterpolations:()=>M,areCoplanarContours:()=>i,calculatePerimeter:()=>_.Z,contourFinder:()=>l,detectContourHoles:()=>d,findHandlePolylineIndex:()=>P.Z,generateContourSetsFromLabelmap:()=>v,getContourHolesDataCanvas:()=>C,getContourHolesDataWorld:()=>b,getDeduplicatedVTKPolyDataPoints:()=>c,interpolation:()=>R,updateContourPolyline:()=>S.Z});var o=n(72076);function i(e,t){const{viewPlaneNormal:n}=e.metadata,{viewPlaneNormal:i}=t.metadata,a=o.R3.dot(n,i);if(!o.DV.equals(1,Math.abs(a)))return!1;const{polyline:r}=e.data.contour,{polyline:s}=t.data.contour,l=o.R3.dot(n,r[0]),c=o.R3.dot(n,s[0]);return o.DV.equals(l,c)}function a(e,t,n){let o=-1;if(t.forEach((t,n)=>{o>=0||t.a==e.b&&(o=n)}),o>=0){const e=t[o];return t.splice(o,1),n.push(e.b),n[0]==e.b?{remainingLines:t,contourPoints:n,type:"CLOSED_PLANAR"}:a(e,t,n)}return{remainingLines:t,contourPoints:n,type:"OPEN_PLANAR"}}function r(e){if(0==e.length)return[];const t=[],n=e.shift();t.push(n.a),t.push(n.b);const o=a(n,e,t);if(0==o.remainingLines.length)return[{type:o.type,contourPoints:o.contourPoints}];{const e=r(o.remainingLines);return e.push({type:o.type,contourPoints:o.contourPoints}),e}}function s(e){return r(e)}const l={findContours:r,findContoursFromReducedSet:s};function c(e,t=!1){const n=e.getPoints(),o=e.getLines(),i=new Array(n.getNumberOfPoints()).fill(0).map((e,t)=>n.getPoint(t).slice()),a=new Array(o.getNumberOfCells()).fill(0).map((e,t)=>{const n=o.getCell(3*t).slice();return{a:n[0],b:n[1]}});if(t)return{points:i,lines:a};const r=[];for(const[e,t]of i.entries()){const n=r.findIndex(e=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]);if(n>=0)a.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t));else{const n=r.length;r.push(t),a.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t))}}return{points:r,lines:a.filter(e=>e.a!==e.b)}}const d={processContourHoles:function(e,t,n=!0){const o=e.filter(e=>"CLOSED_PLANAR"!==e.type),i=e.filter(e=>"CLOSED_PLANAR"===e.type),a=[];let r=[];return i.forEach((e,n)=>{const o=[];i.forEach((i,a)=>{n!=a&&function(e,t,n){const o=[];e.contourPoints.forEach(e=>{o.push([n[e][0],n[e][1]])});let i=0;return t.contourPoints.forEach(e=>{const t=((e,t)=>{const n=e[0],o=e[1];let i=!1;for(let e=0,a=t.length-1;e<t.length;a=e++){const r=t[e][0],s=t[e][1],l=t[a][0],c=t[a][1];s>o!=c>o&&n<(l-r)*(o-s)/(c-s)+r&&(i=!i)}return i})([n[e][0],n[e][1]],o);t||i++}),0===i}(e,i,t)&&o.push(a)}),o.length>0?a.push({contour:e,holes:o}):r.push(n)}),n&&(a.forEach(e=>{e.contour.type="CLOSEDPLANAR_XOR",o.push(e.contour),e.holes.forEach(e=>{i[e].type="CLOSEDPLANAR_XOR",o.push(i[e]),r=r.filter(t=>t!==e)})}),r.forEach(e=>{o.push(i[e])})),o}};var u=n(62709),g=n(60318),h=n(54131),m=n(8455),f=n(74297);const{Labelmap:p}=f.default;function v({segmentations:e}){const{representationData:t,segments:n=[0,1]}=e,{volumeId:o}=t[p],i=u.cache.getVolume(o);if(!i)return void console.warn(`No volume found for ${o}`);const a=i.dimensions[2],r=i.imageData.getPointData().getScalars().getData(),l=i.dimensions[0]*i.dimensions[1];for(let e=0;e<a;e++)for(let t=0;t<i.dimensions[1];t++){const n=t*i.dimensions[0]+e*l;r[n]=0,r[n+i.dimensions[0]-1]=0}const d=[],{FrameOfReferenceUID:f}=i.metadata,v=n.length;for(let e=0;e<v;e++){const t=n[e];if(!t)continue;const o=[],u=h.default.newInstance({name:"Scalars",numberOfComponents:1,size:l*a,dataType:"Uint8Array"}),{containedSegmentIndices:p}=t;for(let t=0;t<a;t++){if(w(t,r,l,e))continue;const n=t*l;try{for(let t=0;t<l;t++){const o=r[t+n];o===e||p?.has(o)?u.setValue(t+n,1):u.setValue(t,0)}const a=g.ZP.newInstance({slice:t}),d=m.ZP.newInstance();d.shallowCopy(i.imageData),d.getPointData().setScalars(u),a.setInputData(d);const h=[1];a.setContourValues(h),a.setMergePoints(!1);const v=c(a.getOutputData());if(v.points?.length){const e=s(v.lines);o.push({contours:e,polyData:v,FrameNumber:t+1,sliceIndex:t,FrameOfReferenceUID:f})}}catch(e){console.warn(t),console.warn(e)}}const v={FrameOfReferenceUID:f},I={label:t.label,color:t.color,metadata:v,sliceContours:o};d.push(I)}return d}function w(e,t,n,o){const i=e*n,a=i+n;for(let e=i;e<a;e++)if(t[e]===o)return!1;return!0}var I=n(94627);class y{static{this.TOOL_NAMES={}}constructor(){}static convert(e,t,n){!function(e){if(!e?.data)throw new Error("Tool data is empty");if(!e.metadata||e.metadata.referenceImageId)throw new Error("Tool data is not associated with any imageId")}(e);const{toolName:o}=e.metadata,i=y.TOOL_NAMES[o];if(!i)throw new Error(`Unknown tool type: ${o}, cannot convert to RTSSReport`);const a=i.getContourSequence(e,n);return{ReferencedROINumber:t+1,ROIDisplayColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],ContourSequence:a}}static register(e){y.TOOL_NAMES[e.toolName]=e}}y.register(I.Z);const E=y;var x=n(50097);function b(e){return(e.childAnnotationUIDs??[]).map(e=>(0,x.AR)(e).data.contour.polyline)}function C(e,t){const n=b(e),o=[];return n.forEach(e=>{const n=e.length,i=new Array(n);for(let o=0;o<n;o++)i[o]=t.worldToCanvas(e[o]);o.push(i)}),o}var S=n(48561),T=n(7966);function M(e,t){T.Z.acceptAutoGenerated(e,t)}var R=n(61065),P=n(66299),_=n(3042)},61065:(e,t,n)=>{"use strict";n.r(t),n.d(t,{InterpolationManager:()=>o.Z});var o=n(7966)},48561:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(62709),i=n(60489),a=n(50097);function r(e,t,n,r){const{canvasToWorld:s,worldToCanvas:l}=n,{data:c}=e,{targetWindingDirection:d}=t;let{points:u}=t;r?.decimate?.enabled&&(u=i.polyline.decimate(t.points,r?.decimate?.epsilon));let{closed:g}=t;const h=u.length,m=new Array(h),f=i.polyline.getWindingDirection(u),p=(0,a.VI)(e);if(void 0===g){let e=!1;if(u.length>3){const t=i.point.distanceToPointSquared(u[0],u[h-1]);e=o.utilities.isEqual(0,t)}g=e}let v=p?-1*p.data.contour.windingDirection:d;void 0===v&&(v=f),v!==f&&u.reverse();const w=c.handles.points.map(e=>l(e));if(w.length>2){i.polyline.getWindingDirection(w)!==v&&c.handles.points.reverse()}for(let e=0;e<h;e++)m[e]=s(u[e]);c.contour.polyline=m,c.contour.closed=g,c.contour.windingDirection=v,(0,a.X9)(e)}},82298:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(73609);const i=function(e,t,n){let i,a,r,s,l,c,d=0,u=!1,g=!1,h=!0;const m=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){const n=i,o=a;return i=a=void 0,d=t,s=e.apply(o,n),s}function p(e,t){return m?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){const n=e-c;return void 0===c||n>=t||n<0||g&&e-d>=r}function w(){const e=Date.now();if(v(e))return I(e);l=p(w,function(e){const n=e-d,o=t-(e-c);return g?Math.min(o,r-n):o}(e))}function I(e){return l=void 0,h&&i?f(e):(i=a=void 0,s)}function y(...e){const n=Date.now(),o=v(n);if(i=e,a=this,c=n,o){if(void 0===l)return function(e){return d=e,l=p(w,t),u?f(e):s}(c);if(g)return l=p(w,t),f(c)}return void 0===l&&(l=p(w,t)),s}return t=Number(t)||0,(0,o.Z)(n)&&(u=Boolean(n.leading),g="maxWait"in n,r=g?Math.max(Number(n.maxWait)||0,t):r,h="trailing"in n?Boolean(n.trailing):h),y.cancel=function(){void 0!==l&&function(e){if(m)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),d=0,i=c=a=l=void 0},y.flush=function(){return void 0===l?s:I(Date.now())},y.pending=function(){return void 0!==l},y}},20724:(e,t,n)=>{"use strict";function o(e){const t=function(e){const t=[e[0],e[1]].sort(r),n=[e[0],e[1]].sort(s),o=t[t.length-1],i=n[0],a=n[n.length-1];return{top:i,bottom:a,right:o};function r(e,t){return e[0]<t[0]?-1:1}function s(e,t){return e[1]<t[1]?-1:1}}(e),n=(t.top[1]+t.bottom[1])/2;return[t.right[0],n]}n.r(t),n.d(t,{getTextBoxCoordsCanvas:()=>o})},39661:(e,t,n)=>{"use strict";n.d(t,{G6:()=>h,Sh:()=>g,mh:()=>u});var o=n(62709);const{CalibrationTypes:i}=o.Enums,a="px",r=[1],s=["3,3"],l=["4,3"],c={3:"cm",4:"seconds"},d="",u=(e,t)=>{const{calibration:n,hasPixelSpacing:l}=e;let c=l?"mm":a,u=c+d,g=1,h="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{units:c,areaUnits:u,scale:g};if(n.type===i.UNCALIBRATED)return{units:a,areaUnits:a+d,scale:g};if(n.sequenceOfUltrasoundRegions){let e,i;if(Array.isArray(t)&&2===t.length)[e,i]=t;else if("function"==typeof t){const n=t();e=n[0],i=n[1]}let l=n.sequenceOfUltrasoundRegions.filter(t=>e[0]>=t.regionLocationMinX0&&e[0]<=t.regionLocationMaxX1&&e[1]>=t.regionLocationMinY0&&e[1]<=t.regionLocationMaxY1&&i[0]>=t.regionLocationMinX0&&i[0]<=t.regionLocationMaxX1&&i[1]>=t.regionLocationMinY0&&i[1]<=t.regionLocationMaxY1);if(!l?.length)return{units:c,areaUnits:u,scale:g};if(l=l.filter(e=>r.includes(e.regionDataType)&&s.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`)),!l.length)return{units:a,areaUnits:a+d,scale:g};const m=l[0],f=Math.abs(m.physicalDeltaX),p=Math.abs(m.physicalDeltaY);if(!o.utilities.isEqual(f,p,.001))return{units:a,areaUnits:a+d,scale:g};g=1/(10*f),h="US Region",c="mm",u="mm"}else n.scale&&(g=n.scale);return[i.ERMF,i.USER,i.ERROR,i.PROJECTION].includes(n?.type)&&(h=n.type),{units:c+(h?` ${h}`:""),areaUnits:u+(h?` ${h}`:""),scale:g}},g=(e,t)=>{const[n]=t,{calibration:o}=e;let i=["raw"],a=[null],s="";if(!o||!o.type&&!o.sequenceOfUltrasoundRegions)return{units:i,values:a};if(o.sequenceOfUltrasoundRegions){const e=o.sequenceOfUltrasoundRegions.filter(e=>r.includes(e.regionDataType)&&l.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`));if(!e?.length)return{units:i,values:a};const t=e.find(e=>n[0]>=e.regionLocationMinX0&&n[0]<=e.regionLocationMaxX1&&n[1]>=e.regionLocationMinY0&&n[1]<=e.regionLocationMaxY1);if(!t)return{units:i,values:a};const{referencePixelX0:d=0,referencePixelY0:u=0}=t,{physicalDeltaX:g,physicalDeltaY:h}=t,m=(n[1]-t.regionLocationMinY0-u)*h;s="US Region",a=[(n[0]-t.regionLocationMinX0-d)*g,m],i=[c[t.physicalUnitsXDirection],c[t.physicalUnitsYDirection]]}return{units:i,values:a,calibrationType:s}},h=e=>e.calibration?.aspect||1},28921:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});var o=n(62709),i=n(72076),a=n(87758);const{transformWorldToIndex:r}=o.utilities;function s(e,t,n){const[o,s]=e,l=i.R3.fromValues((o[0]+s[0])/2,(o[1]+s[1])/2,(o[2]+s[2])/2),c=i.R3.distance(o,s)/2;if(!n)throw new Error("viewport is required in order to calculate the sphere bounds");const{boundsIJK:d,topLeftWorld:u,bottomRightWorld:g}=function(e,t,n,o,s){const[l,c]=n,d=e.getDimensions(),u=t.getCamera(),g=i.R3.fromValues(u.viewUp[0],u.viewUp[1],u.viewUp[2]),h=i.R3.fromValues(u.viewPlaneNormal[0],u.viewPlaneNormal[1],u.viewPlaneNormal[2]),m=i.R3.create();i.R3.cross(m,g,h);const f=i.R3.create(),p=i.R3.create();i.R3.scaleAndAdd(f,c,h,s),i.R3.scaleAndAdd(p,l,h,-s),i.R3.scaleAndAdd(f,f,m,-s),i.R3.scaleAndAdd(p,p,m,s);const v=r(e,f),w=r(e,p),I=n.map(t=>r(e,t)),y=(0,a.getBoundingBoxAroundShapeIJK)([v,w,...I],d);return{boundsIJK:y,topLeftWorld:f,bottomRightWorld:p}}(t,n,e,0,c);return{boundsIJK:d,centerWorld:l,radiusWorld:c,topLeftWorld:u,bottomRightWorld:g}}},82220:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(22319);function i(e){const t=(0,o.Z)(e);return t.length?t[0]:void 0}},79454:(e,t,n)=>{"use strict";n.r(t),n.d(t,{annotationFrameRange:()=>A,annotationHydration:()=>U.M,boundingBox:()=>V,calibrateImageSpacing:()=>y,cine:()=>i,clip:()=>w.ZP,contourSegmentation:()=>Oe,contours:()=>Z,debounce:()=>f.Z,drawing:()=>q,dynamicVolume:()=>s,getAnnotationNearPoint:()=>g,getAnnotationNearPointOnEnabledElement:()=>h,getCalibratedAspect:()=>E.G6,getCalibratedLengthUnitsAndScale:()=>E.mh,getCalibratedProbeUnitsAndValue:()=>E.Sh,getClosestImageIdForStackViewport:()=>U.B,getSphereBoundsInfo:()=>M.v,getViewportForAnnotation:()=>B.Z,isObject:()=>v.Z,jumpToSlice:()=>S.Z,math:()=>W,orientation:()=>o,planar:()=>j,planarFreehandROITool:()=>a,pointInShapeCallback:()=>T.Z,pointInSurroundingSphereCallback:()=>N,pointToString:()=>P.s,polyDataUtils:()=>l,rectangleROITool:()=>r,roundNumber:()=>Ve,scroll:()=>R.Z,segmentation:()=>F,stackContextPrefetch:()=>be,stackPrefetch:()=>ve,throttle:()=>p.Z,touch:()=>Se,triggerAnnotationRender:()=>b.ZP,triggerAnnotationRenderForToolGroupIds:()=>C,triggerAnnotationRenderForViewportIds:()=>x.Z,triggerEvent:()=>c.triggerEvent,viewport:()=>Ce,viewportFilters:()=>z,voi:()=>De});var o={};n.r(o),n.d(o,{getOrientationStringLPS:()=>G,invertOrientationStringLPS:()=>H});var i={};n.r(i),n.d(i,{Events:()=>$,addToolState:()=>X,getToolState:()=>J,playClip:()=>ne,stopClip:()=>oe});var a={};n.r(a),n.d(a,{default:()=>le,smoothAnnotation:()=>se.Z});var r={};n.r(r),n.d(r,{getBoundsIJKFromRectangleAnnotations:()=>ce.Z,isAxisAlignedRectangle:()=>de.r});var s={};n.r(s),n.d(s,{generateImageFromTimeData:()=>Re,getDataInTime:()=>Me});var l={};n.r(l),n.d(l,{getPoint:()=>Pe,getPolyDataPointIndexes:()=>_e,getPolyDataPoints:()=>Ae});var c=n(62709),d=n(86614),u=n(27078);function g(e,t,n=5){const o=(0,c.getEnabledElement)(e);if(!o)throw new Error("getAnnotationNearPoint: enabledElement not found");return h(o,t,n)}function h(e,t,n){const{renderingEngineId:o,viewportId:i}=e,a=u.getToolGroupForViewport(i,o);if(!a)return null;const{_toolInstances:r}=a;for(const o in r){const i=m(r[o],e,t,n);if(i)return i}return null}function m(e,t,n,o){const{viewport:i}=t,a=(0,d.getAnnotations)(e.constructor.toolName,i?.element),r=i?.getCurrentImageId?.();if(a?.length){const{element:i}=t.viewport;for(const t of a){const a=t.metadata?.referencedImageId;if(!(r&&a&&r!==a||!e.isPointNearTool)&&(e.isPointNearTool(i,t,n,o,"")||e.getHandleNearImagePoint(i,t,n,o)))return t}}return null}var f=n(82298),p=n(90685),v=n(73609),w=n(70232);const{calibratedPixelSpacingMetadataProvider:I}=c.utilities;function y(e,t,n){"number"==typeof n&&(n={type:c.Enums.CalibrationTypes.USER,scale:n}),I.add(e,n);t.getStackViewports().forEach(t=>{t.getImageIds().includes(e)&&t.calibrateSpacing(e)})}var E=n(39661),x=n(66878),b=n(64307);const C=function(e){e.forEach(e=>{const t=(0,u.getToolGroup)(e);if(!t)return void console.warn(`ToolGroup not available for ${e}`);t.getViewportsInfo().forEach(e=>{const{renderingEngineId:t,viewportId:n}=e,o=(0,c.getRenderingEngine)(t);if(!o)return void console.warn(`RenderingEngine not available for ${t}`);const i=o.getViewport(n);(0,b.ZP)(i.element)})})};var S=n(68009),T=n(31955),M=n(28921),R=n(63478),P=n(5205),_=n(34539);class A{static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static imageIdToFrames(e){const t=e.match(this.frameRangeExtractor);if(!t||!t[2])return null;const n=t[2].split("-").map(e=>Number(e));return 1===n.length?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,t){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const o=this.framesToString(t);return e.replace(this.frameRangeExtractor,`${n[1]}${o}`)}static setFrameRange(e,t,n){const{referencedImageId:o}=e.metadata;e.metadata.referencedImageId=this.framesToImageId(o,t);const i={...n,annotation:e};(0,c.triggerEvent)(c.eventTarget,_.default.ANNOTATION_MODIFIED,i)}static getFrameRange(e){return this.imageIdToFrames(e.metadata.referencedImageId)}}var D=n(72076),O=n(34603),V=n(87758);const{transformWorldToIndex:L}=c.utilities;function N(e,t,n,o){const{boundsIJK:i,centerWorld:a,radiusWorld:r}=function(e,t,n){const[o,i]=e,a=D.R3.fromValues((o[0]+i[0])/2,(o[1]+i[1])/2,(o[2]+i[2])/2),r=D.R3.distance(o,i)/2;let s;if(!n){const e=L(t,a),n=t.getSpacing(),o=Math.min(...n),i=Math.ceil(r/o);return s=[[e[0]-i,e[0]+i],[e[1]-i,e[1]+i],[e[2]-i,e[2]+i]],{boundsIJK:s,centerWorld:a,radiusWorld:r}}return s=function(e,t,n,o,i){const[a,r]=n,s=e.getDimensions(),l=t.getCamera(),c=D.R3.fromValues(l.viewUp[0],l.viewUp[1],l.viewUp[2]),d=D.R3.fromValues(l.viewPlaneNormal[0],l.viewPlaneNormal[1],l.viewPlaneNormal[2]),u=D.R3.create();D.R3.cross(u,c,d);const g=D.R3.create(),h=D.R3.create();D.R3.scaleAndAdd(g,r,d,i),D.R3.scaleAndAdd(h,a,d,-i),D.R3.scaleAndAdd(g,g,u,-i),D.R3.scaleAndAdd(h,h,u,i);const m=[L(e,g),L(e,h)],f=(0,V.getBoundingBoxAroundShape)(m,s);return f}(t,n,e,0,r),{boundsIJK:s,centerWorld:a,radiusWorld:r}}(t,e,o),s={center:a,radius:r};(0,T.Z)(e,e=>(0,O.E)(s,e),n,i)}var k,B=n(82220),U=n(13278),Z=n(11203),F=n(68203),q=n(20724),W=n(60489),j=n(44037),z=n(46966);function G(e){let t="";const n=e[0]<0?"R":"L",o=e[1]<0?"A":"P",i=e[2]<0?"F":"H",a=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],r=1e-4;for(let e=0;e<3;e++)if(a[0]>r&&a[0]>a[1]&&a[0]>a[2])t+=n,a[0]=0;else if(a[1]>r&&a[1]>a[0]&&a[1]>a[2])t+=o,a[1]=0;else if(a[2]>r&&a[2]>a[0]&&a[2]>a[1])t+=i,a[2]=0;else if(a[0]>r&&a[1]>r&&a[0]===a[1])t+=n+o,a[0]=0,a[1]=0;else if(a[0]>r&&a[2]>r&&a[0]===a[2])t+=n+i,a[0]=0,a[2]=0;else{if(!(a[1]>r&&a[2]>r&&a[1]===a[2]))break;t+=o+i,a[1]=0,a[2]=0}return t}function H(e){let t=e.replace("H","f");return t=t.replace("F","h"),t=t.replace("R","l"),t=t.replace("L","r"),t=t.replace("A","p"),t=t.replace("P","a"),t=t.toUpperCase(),t}!function(e){e.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",e.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"}(k||(k={}));const $=k,K={};function X(e,t){const n=(0,c.getEnabledElement)(e),{viewportId:o}=n;K[o]=t}function J(e){const t=(0,c.getEnabledElement)(e),{viewportId:n}=t;return K[n]}const{ViewportStatus:Y}=c.Enums,{triggerEvent:Q}=c.utilities,ee=!0,te=new Map;function ne(e,t){let n,o;if(void 0===e)throw new Error("playClip: element must not be undefined");const i=(0,c.getEnabledElement)(e);if(!i)throw new Error("playClip: element must be a valid Cornerstone enabled element");t||(t={}),t.dynamicCineEnabled=t.dynamicCineEnabled??!0;const{viewport:a}=i,r=re(a),s=function(e,t){if(e instanceof c.StackViewport)return function(e,t){const n=e.getImageIds();return{get numScrollSteps(){return n.length},get currentStepIndex(){return e.getTargetImageIdIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(n){this.waitForRenderedCount<=t&&e.viewportStatus!==Y.RENDERED?this.waitForRenderedCount++:(this.waitForRenderedCount=0,(0,R.Z)(e,{delta:n,debounceLoading:ee}))}}}(e,t.waitForRendered??30);if(e instanceof c.VolumeViewport){const n=re(e);return t.dynamicCineEnabled&&n?.isDynamicVolume()?function(e){return{get numScrollSteps(){return e.numTimePoints},get currentStepIndex(){return e.timePointIndex},get frameTimeVectorEnabled(){return!1},scroll(t){e.timePointIndex+=t}}}(n):function(e,t){const{volumeId:n}=t,o={viewPlaneNormal:D.R3.create(),scrollInfo:null},i=()=>{const t=e.getCamera();if(!o.scrollInfo||!D.R3.equals(t.viewPlaneNormal,o.viewPlaneNormal)){const i=c.utilities.getVolumeViewportScrollInfo(e,n);o.viewPlaneNormal=t.viewPlaneNormal,o.scrollInfo=i}return o.scrollInfo};return{get numScrollSteps(){return i().numScrollSteps},get currentStepIndex(){return i().currentStepIndex},get frameTimeVectorEnabled(){const n=e.getCamera(),o=t.direction.slice(6,9).map(e=>-e),i=D.R3.dot(o,n.viewPlaneNormal);return D.DV.equals(i,1)},scroll(t){i().currentStepIndex+=t,(0,R.Z)(e,{delta:t})}}}(e,n)}throw new Error("Unknown viewport type")}(a,t);let l=J(e);const d=t.dynamicCineEnabled&&r?.isDynamicVolume();if(d&&ae(e),l?ie(e,{stopDynamicCine:!d,viewportId:a.id}):(l={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,frameTimeVector:t.frameTimeVector??void 0,speed:t.frameTimeVectorSpeedMultiplier??1,reverse:t.reverse??!1,loop:t.loop??!0},X(e,l)),l.dynamicCineEnabled=t.dynamicCineEnabled,(t.framesPerSecond<0||t.framesPerSecond>0)&&(l.framesPerSecond=Number(t.framesPerSecond),l.reverse=l.framesPerSecond<0,l.ignoreFrameTimeVector=!0),!0!==l.ignoreFrameTimeVector&&l.frameTimeVector&&l.frameTimeVector.length===s.numScrollSteps&&s.frameTimeVectorEnabled){const{timeouts:e,isTimeVarying:t}=function(e,t){let n,o,i,a=0;const r=e.length,s=[];let l=!1;("number"!=typeof t||t<=0)&&(t=1);for(n=1;n<r;n++)i=Number(e[n])/t|0,s.push(i),1===n?o=i:i!==o&&(l=!0),a+=i;s.length>0&&(i=l?a/s.length|0:s[0],s.push(i));return{timeouts:s,isTimeVarying:l}}(l.frameTimeVector,l.speed);n=e,o=t}const u=()=>{const{numScrollSteps:t,currentStepIndex:n}=s;let o=n+(l.reverse?-1:1);const i=o<0||o>=t;if(!l.loop&&i){ie(e,{stopDynamicCine:!d,viewportId:a.id});const t={element:e};return void Q(e,$.CLIP_STOPPED,t)}o>=t?o=0:o<0&&(o=t-1);const r=o-n;r&&s.scroll(r)};d&&te.set(r.volumeId,e),n&&n.length>0&&o?(l.usingFrameTimeVector=!0,l.intervalId=window.setTimeout(function e(){l.intervalId=window.setTimeout(e,n[s.currentStepIndex]),u()},0)):(l.usingFrameTimeVector=!1,l.intervalId=window.setInterval(u,1e3/Math.abs(l.framesPerSecond)));const g={element:e};Q(e,$.CLIP_STARTED,g)}function oe(e,t={}){ie(e,{stopDynamicCine:!0,...t})}function ie(e,t={stopDynamicCine:!0,viewportId:void 0}){const{stopDynamicCine:n,viewportId:o}=t,i=(0,c.getEnabledElement)(e);let a;if(i){const{viewport:e}=i;a=J(e.element)}else{if(!o)return;a=function(e){return K[e]}(o)}a&&function(e){const t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}(a),n&&i?.viewport instanceof c.BaseVolumeViewport&&ae(e)}function ae(e){const{viewport:t}=(0,c.getEnabledElement)(e),n=re(t);if(n?.isDynamicVolume()){const t=te.get(n.volumeId);te.delete(n.volumeId),t&&t!==e&&oe(t)}}function re(e){const t=function(e){return e.getActors().map(e=>c.cache.getVolume(e.uid)).filter(e=>!!e)}(e);return t.find(e=>e.isDynamicVolume())??t[0]}var se=n(2036);const le={smoothAnnotation:se.Z};var ce=n(35765),de=n(59941),ue=n(22446),ge=n(93471);let he,me={maxImagesToPrefetch:1/0,preserveExistingPool:!0};function fe(e){const t=(0,ue.T)(e);if(!t)return;const n=t||{},o=(0,ge.gf)(e);if(!o?.imageIds?.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const{currentImageIdIndex:i}=o;if(n.enabled&&=n.indicesToRequest?.length,!1===n.enabled)return;function a(e){const t=n.indicesToRequest.indexOf(e);t>-1&&n.indicesToRequest.splice(t,1)}t.indicesToRequest.sort((e,t)=>e-t);if(n.indicesToRequest.slice().forEach(function(e){const t=o.imageIds[e];if(!t)return;(Math.abs(i-e)<6?c.cache.getImageLoadObject(t):c.cache.isLoaded(t))&&a(e)}),!n.indicesToRequest.length)return;me.preserveExistingPool||c.imageLoadPoolManager.clearRequestStack(ge.rI);const r=(0,ge.cD)(n.indicesToRequest,o.currentImageIdIndex);let s,l;let d=r.low,u=r.high;const g=[];for(;d>=0||u<n.indicesToRequest.length;){const e=o.currentImageIdIndex,t=!(e-n.indicesToRequest[d]>me.maxImagesToPrefetch)&&d>=0,i=!(n.indicesToRequest[u]-e>me.maxImagesToPrefetch)&&u<n.indicesToRequest.length;if(!i&&!t)break;t&&(l=n.indicesToRequest[d--],s=o.imageIds[l],g.push(s)),i&&(l=n.indicesToRequest[u++],s=o.imageIds[l],g.push(s))}const h=(e,t)=>c.imageLoader.loadAndCacheImage(e,t),{useNorm16Texture:m,preferSizeOverAccuracy:f}=(0,c.getConfiguration)().rendering,p=m||f;g.forEach(e=>{const t={targetBuffer:{type:p?void 0:"Float32Array"},preScale:{enabled:!0},useNativeDataType:p,requestType:ge.rI};c.imageLoadPoolManager.addRequest(h.bind(null,e,t),ge.rI,{imageId:e},ge.O3)})}function pe(e){clearTimeout(he),he=setTimeout(function(){const t=e.target;try{fe(t)}catch(e){return}},10)}const ve={enable:function(e){const t=(0,ge.gf)(e);if(!t||!t.imageIds||0===t.imageIds.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const n={indicesToRequest:(0,ge.w6)(0,t.imageIds.length-1),enabled:!0,direction:1},o=n.indicesToRequest.indexOf(t.currentImageIdIndex);n.indicesToRequest.splice(o,1),(0,ue.w)(e,n),fe(e),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,pe),e.addEventListener(c.Enums.Events.STACK_NEW_IMAGE,pe);const i=(0,ge.mN)(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,i),c.eventTarget.addEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,i)},disable:function(e){clearTimeout(he),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,pe);const t=(0,ge.mN)(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,t);const n=(0,ue.T)(e);n&&n.indicesToRequest.length&&(n.enabled=!1,c.imageLoadPoolManager.clearRequestStack(ge.rI))},getConfiguration:function(){return me},setConfiguration:function(e){me=e}};let we,Ie={maxImagesToPrefetch:1/0,minBefore:2,maxAfter:2,directionExtraImages:10,preserveExistingPool:!1};function ye(e){const t=(0,ge.gf)(e);if(!t?.imageIds?.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const n=(0,ue.T)(e);if(!n)return;const o=n||{};if(o.enabled&&=o.indicesToRequest?.length,!1===o.enabled)return;function i(e){const t=o.indicesToRequest.indexOf(e);t>-1&&o.indicesToRequest.splice(t,1)}const a=o.indicesToRequest.slice(),{currentImageIdIndex:r}=t;if(a.forEach(e=>{const n=t.imageIds[e];if(!n)return;(Math.abs(r-e)<6?c.cache.getImageLoadObject(n):c.cache.isLoaded(n))&&i(e)}),!o.indicesToRequest.length)return;Ie.preserveExistingPool||c.imageLoadPoolManager.filterRequests((0,ge.EI)(t));const s=(n,a)=>c.imageLoader.loadAndCacheImage(n,a).then(()=>function(n){i(t.imageIds.indexOf(n));const a=c.cache.getCachedImageBasedOnImageURI(n),{stats:r}=o,s=a?.image?.decodeTimeInMS||0;if(s){r.imageIds.set(n,s),r.decodeTimeInMS+=s;const e=a?.image?.loadTimeInMS||0;r.loadTimeInMS+=e}if(!o.indicesToRequest.length&&a?.sizeInBytes){const{sizeInBytes:t}=a,n=c.cache.getMaxCacheSize()/4/t;if(o.cacheFill){if(r.imageIds.size){r.fillTime=Date.now()-r.start;const{size:e}=r.imageIds;r.fillSize=e,console.log("Done cache fill",r.fillTime,"ms",e,"items","average total time",Ve(r.fillTime/e),"ms","average load",Ve(r.loadTimeInMS/e),"ms","average decode",Ve(r.decodeTimeInMS/e),"ms")}}else r.initialTime=Date.now()-r.start,r.initialSize=r.imageIds.size,xe(e,n),ye(e)}}(n)),{useNorm16Texture:l,preferSizeOverAccuracy:d}=(0,c.getConfiguration)().rendering,u=l||d;o.indicesToRequest.forEach(e=>{const n=t.imageIds[e],o={targetBuffer:{type:u?void 0:"Float32Array"},preScale:{enabled:!0},useNativeDataType:u,requestType:ge.rI};c.imageLoadPoolManager.addRequest(s.bind(null,n,o),ge.rI,{imageId:n},ge.O3)})}function Ee(e){clearTimeout(we),we=setTimeout(function(){const t=e.target;try{xe(t),ye(t)}catch(e){return}},5)}const xe=(e,t)=>{const n=(0,ge.gf)(e);if(!n||!n.imageIds||0===n.imageIds.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");const{currentImageIdIndex:o}=n;let{maxAfter:i=2,minBefore:a=2}=Ie;const{directionExtraImages:r=10}=Ie,s=(0,ue.T)(e)||{indicesToRequest:[],currentImageIdIndex:o,stackCount:0,enabled:!0,direction:1,stats:{start:Date.now(),imageIds:new Map,decodeTimeInMS:0,loadTimeInMS:0,totalBytes:0}},l=o-s.currentImageIdIndex;if(s.direction=l<0?-1:1,s.currentImageIdIndex=o,s.enabled=!0,s.stackCount<100&&(s.stackCount+=r),Math.abs(l)>i||!l)if(s.stackCount=0,t){const e=o/n.imageIds.length;a=Math.ceil(t*e),i=Math.ceil(t*(1-e)),s.cacheFill=!0}else s.cacheFill=!1;else l<0?(a+=s.stackCount,i=0):(i+=s.stackCount,a=0);const c=Math.max(0,o-a),d=Math.min(n.imageIds.length-1,o+i),u=[];for(let e=o+1;e<=d;e++)u.push(e);for(let e=o-1;e>=c;e--)u.push(e);s.indicesToRequest=u,(0,ue.w)(e,s)};const be={enable:e=>{const t=(0,ge.gf)(e);if(!t||!t.imageIds||0===t.imageIds.length)return void console.warn("CornerstoneTools.stackPrefetch: No images in stack.");xe(e),ye(e),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,Ee),e.addEventListener(c.Enums.Events.STACK_NEW_IMAGE,Ee);const n=(0,ge.mN)(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,n),c.eventTarget.addEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,n)},disable:function(e){clearTimeout(we),e.removeEventListener(c.Enums.Events.STACK_NEW_IMAGE,Ee);const t=(0,ge.mN)(e);c.eventTarget.removeEventListener(c.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,t);const n=(0,ue.T)(e);n&&(n.enabled=!1)},getConfiguration:function(){return Ie},setConfiguration:function(e){Ie=e}};var Ce=n(85217),Se=n(25068),Te=n(89776);const Me=function(e,t){const n=t.frameNumbers||[...Array(e.numTimePoints).keys()];if(!t.maskVolumeId&&!t.imageCoordinate)throw new Error("You should provide either maskVolumeId or imageCoordinate");if(t.maskVolumeId&&t.imageCoordinate)throw new Error("You can only use one of maskVolumeId or imageCoordinate");if(t.maskVolumeId){const o=c.cache.getVolume(t.maskVolumeId),[i,a]=function(e,t,n){const{imageData:o}=n,i=n.getScalarData(),a=i.length,r=[];r.length=a;const s=[],l=n.dimensions;let c=0;for(let e=0,t=i.length;e<t;e++)0!==i[e]&&(s.push([e%l[0],Math.floor(e/l[0]%l[1]),Math.floor(e/(l[0]*l[1]))]),r[c++]=e);r.length=c;const d=t.getScalarDataArrays(),u=[],g=d[0].length===a&&JSON.stringify(t.spacing)===JSON.stringify(n.spacing);if(g){for(let t=0;t<r.length;t++){const n=[];e.forEach(e=>{const o=d[e];n.push(o[r[t]])}),u.push(n)}return[u,s]}const h=({pointLPS:n,value:o,pointIJK:i})=>{if(0===o)return;const a=(0,Te.yW)(t.imageData,t.dimensions,t.spacing,n);let r=0;const l=new Map;e.forEach(e=>l.set(e,0));const c=({index:t})=>{for(let n=0;n<e.length;n++){const o=d[n][t],i=e[n];l.set(i,l.get(i)+o)}r++};(0,T.Z)(t.imageData,()=>!0,c,a);const g=[];l.forEach(e=>{g.push(e/r)}),s.push(i),u.push(g)};return(0,T.Z)(o,()=>!0,h),[u,s]}(n,e,o);return[i,a]}if(t.imageCoordinate){const o=function(e,t,n){const{dimensions:o,imageData:i}=n,a=i.worldToIndex(t);if(a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.floor(a[2]),!c.utilities.indexWithinDimensions(a,o))throw new Error("outside bounds");const r=o[0],s=o[0]*o[1],l=n.getScalarDataArrays(),d=[];return e.forEach(e=>{const t=l[e],n=a[2]*s+a[1]*r+a[0];d.push(t[n])}),d}(n,t.imageCoordinate,e);return o}};const Re=function(e,t,n){const o=n||[...Array(e.numTimePoints).keys()],i=o.length;if(o.length<=1)throw new Error("Please provide two or more time points");const a=e.getScalarDataArrays(),r=a[0].length,s=new Float32Array(r);if(t===c.Enums.DynamicOperatorType.SUM){for(let e=0;e<i;e++){const t=a[o[e]];for(let e=0;e<r;e++)s[e]+=t[e]}return s}if(t===c.Enums.DynamicOperatorType.SUBTRACT){if(o.length>2)throw new Error("Please provide only 2 time points for subtraction.");for(let e=0;e<r;e++)s[e]+=a[o[0]][e]-a[o[1]][e];return s}if(t===c.Enums.DynamicOperatorType.AVERAGE){for(let e=0;e<i;e++){const t=a[o[e]];for(let e=0;e<r;e++)s[e]+=t[e]}for(let e=0;e<r;e++)s[e]=s[e]/i;return s}};function Pe(e,t){const n=3*t;if(n<e.length)return D.R3.fromValues(e[n],e[n+1],e[n+2])}function _e(e){const t=e.getLines().getData();let n=0;const o=new Map;for(;n<t.length;){const e=t[n++],i=[];for(let o=0;o<e;o++)i.push(t[n+o]);o.set(i[0],i),n+=e}const i=[],a=e=>{for(const[t,n]of e.entries())if(void 0!==n)return t;return-1};let r=a(o);for(;-1!==r;){const e=[r];for(;o.has(r);){const t=o.get(r)[1];o.has(t)&&e.push(t),o.delete(r),r=t}i.push(e),r=a(o)}return i.length?i:void 0}function Ae(e){const t=_e(e);if(!t)return;const n=e.getPoints().getData();return t.map(e=>e.map(e=>Pe(n,e)))}var De=n(35066),Oe=n(59865);const Ve=c.utilities.roundNumber},73609:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const o=function(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}},51053:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BasicStatsCalculator:()=>r,Calculator:()=>i});var o=n(62709);const i=class{},{PointsManager:a}=o.utilities;class r extends i{static{this.max=[-1/0]}static{this.min=[1/0]}static{this.sum=[0]}static{this.count=0}static{this.runMean=[0]}static{this.m2=[0]}static{this.pointsInShape=a.create3(1024)}static statsInit(e){e.noPointsCollection&&(r.pointsInShape=null)}static{this.statsCallback=({value:e,pointLPS:t=null})=>{Array.isArray(e)&&e.length>1&&1===this.max.length&&(this.max.push(this.max[0],this.max[0]),this.min.push(this.min[0],this.min[0]),this.sum.push(this.sum[0],this.sum[0]),this.runMean.push(0,0),this.m2.push(this.m2[0],this.m2[0])),this.pointsInShape?.push(t);const n=Array.isArray(e)?e:[e];this.count+=1,this.max.map((e,t)=>{const o=n[t],i=o-this.runMean[t];this.sum[t]+=o,this.runMean[t]+=i/this.count;const a=o-this.runMean[t];this.m2[t]+=i*a,this.min[t]=Math.min(this.min[t],o),this.max[t]=Math.max(e,o)})}}static{this.getStatistics=e=>{const t=this.sum.map(e=>e/this.count),n=this.m2.map(e=>Math.sqrt(e/this.count)),o=e?.unit||null,i={max:{name:"max",label:"Max Pixel",value:s(this.max),unit:o},min:{name:"min",label:"Min Pixel",value:s(this.min),unit:o},mean:{name:"mean",label:"Mean Pixel",value:s(t),unit:o},stdDev:{name:"stdDev",label:"Standard Deviation",value:s(n),unit:o},count:{name:"count",label:"Pixel Count",value:this.count,unit:null},pointsInShape:this.pointsInShape,array:[]};return i.array.push(i.max,i.mean,i.stdDev,i.stdDev,i.count),this.max=[-1/0],this.min=[1/0],this.sum=[0],this.m2=[0],this.runMean=[0],this.count=0,this.pointsInShape=a.create3(1024),i}}}function s(e){return 1===e.length?e[0]:e}},92600:(e,t,n)=>{"use strict";function o(e,t,n={}){return n.precalculated||i(e,n),n.precalculated(t)}n.r(t),n.d(t,{getCanvasEllipseCorners:()=>a,pointInEllipse:()=>o,precalculatePointInEllipse:()=>i});const i=(e,t={})=>{const{xRadius:n,yRadius:o,zRadius:i}=e;void 0!==t.invXRadiusSq&&void 0!==t.invYRadiusSq&&void 0!==t.invZRadiusSq||(t.invXRadiusSq=0!==n?1/n**2:0,t.invYRadiusSq=0!==o?1/o**2:0,t.invZRadiusSq=0!==i?1/i**2:0);const{invXRadiusSq:a,invYRadiusSq:r,invZRadiusSq:s}=t,{center:l}=e,[c,d,u]=l;return t.precalculated=e=>{const t=e[0]-c;let n=t*t*a;if(n>1)return!1;const o=e[1]-d;if(n+=o*o*r,n>1)return!1;const i=e[2]-u;return n+=i*i*s,n<=1},t};function a(e){const[t,n,o,i]=e;return[[o[0],n[1]],[i[0],t[1]]]}},60489:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BasicStatsCalculator:()=>l,aabb:()=>o,ellipse:()=>c,lineSegment:()=>d,point:()=>u,polyline:()=>g,rectangle:()=>h,vec2:()=>i});var o={};n.r(o),n.d(o,{distanceToPoint:()=>s,distanceToPointSquared:()=>r,intersectAABB:()=>a});var i={};function a(e,t){return e.minX<=t.maxX&&e.maxX>=t.minX&&e.minY<=t.maxY&&e.maxY>=t.minY}function r(e,t){const n=e.maxX-e.minX,o=e.maxY-e.minY,i=[n,o],a=[e.minX+n/2,e.minY+o/2],r=[Math.abs(t[0]-a[0]),Math.abs(t[1]-a[1])],s=r[0]-.5*i[0],l=r[1]-.5*i[1];if(s>0&&l>0)return s*s+l*l;const c=Math.max(s,0)+Math.max(l,0);return c*c}function s(e,t){return Math.sqrt(r(e,t))}n.r(i),n.d(i,{findClosestPoint:()=>m.Z,liangBarksyClip:()=>f.Z});var l=n(51053),c=n(92600),d=n(79922),u=n(74474),g=n(42744),h=n(81671),m=n(78924),f=n(3467)},79922:(e,t,n)=>{"use strict";n.r(t),n.d(t,{distanceToPoint:()=>r,distanceToPointSquared:()=>a,distanceToPointSquaredInfo:()=>i,intersectLine:()=>l,isPointOnLineSegment:()=>d});var o=n(60489);function i(e,t,n){let i;const a=o.point.distanceToPointSquared(e,t);if(e[0]===t[0]&&e[1]===t[1]&&(i=e),!i){const o=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/a;i=o<0?e:o>1?t:[e[0]+o*(t[0]-e[0]),e[1]+o*(t[1]-e[1])]}return{point:[...i],distanceSquared:o.point.distanceToPointSquared(n,i)}}function a(e,t,n){return i(e,t,n).distanceSquared}function r(e,t,n){if(2!==e.length||2!==t.length||2!==n.length)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(a(e,t,n))}function s(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}function l(e,t,n,o){const[i,a]=e,[r,l]=t,[c,d]=n,[u,g]=o,h=l-a,m=i-r,f=r*a-i*l,p=h*c+m*d+f,v=h*u+m*g+f;if(0!==p&&0!==v&&s(p)===s(v))return;const w=g-d,I=c-u,y=u*d-c*g,E=w*i+I*a+y,x=w*r+I*l+y;if(0!==E&&0!==x&&s(E)===s(x))return;const b=h*I-w*m;let C;C=m*y-I*f;const S=C/b;C=w*f-h*y;return[S,C/b]}const c=.01;function d(e,t,n){const o=e[0]<=t[0]?e[0]:t[0],i=e[0]>=t[0]?e[0]:t[0],a=e[1]<=t[1]?e[1]:t[1],r=e[1]>=t[1]?e[1]:t[1];if(!(n[0]>=o-c&&n[0]<=i+c&&n[1]>=a-c&&n[1]<=r+c))return!1;const s=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return(s>=0?s:-s)<=c}},25523:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(94363);function i(e,t){return Math.sqrt((0,o.Z)(e,t))}},94363:(e,t,n)=>{"use strict";function o(e,t){if(e.length!==t.length)throw Error("Both points should have the same dimensionality");const[n,o,i=0]=e,[a,r,s=0]=t,l=a-n,c=r-o,d=s-i;return l*l+c*c+d*d}n.d(t,{Z:()=>o})},18668:(e,t,n)=>{"use strict";function o(e,t){const[n,o]=e,[i,a]=t;return[2*i-n,2*a-o]}n.d(t,{Z:()=>o})},42744:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addCanvasPointsToArray:()=>Z,containsPoint:()=>r,containsPoints:()=>s,decimate:()=>O,getAABB:()=>l.Z,getArea:()=>c,getClosestLineSegmentIntersection:()=>L,getFirstLineSegmentIntersectionIndexes:()=>_,getLineSegmentIntersectionsCoordinates:()=>V,getLineSegmentIntersectionsIndexes:()=>w,getNormal2:()=>h,getNormal3:()=>g,getSignedArea:()=>d,getSubPixelSpacingAndXYDirections:()=>B,getWindingDirection:()=>u,intersectPolyline:()=>A,isClosed:()=>a,isPointInsidePolyline3D:()=>j,mergePolylines:()=>R,pointCanProjectOnLine:()=>F,pointsAreWithinCloseContourProximity:()=>U,projectTo2D:()=>W,subtractPolylines:()=>P});var o=n(72076),i=n(60489);function a(e){if(e.length<3)return!1;const t=e.length,n=e[0],a=e[t-1],r=i.point.distanceToPointSquared(n,a);return o.DV.equals(0,r)}function r(e,t,n={closed:void 0}){if(e.length<3)return!1;const o=e.length;let i=0;const{closed:s,holes:l}=n;if(l?.length)for(const e of l)if(r(e,t))return!1;const c=!(void 0===s?a(e):s),d=e.length-(c?1:2);for(let n=0;n<=d;n++){const a=e[n],r=e[n===o-1?0:n+1],s=a[0]>=r[0]?a[0]:r[0],l=a[1]>=r[1]?a[1]:r[1],c=a[1]<=r[1]?a[1]:r[1];if(t[0]<=s&&t[1]>=c&&t[1]<l){let e=a[0]===r[0];if(!e){const n=(t[1]-a[1])*(r[0]-a[0])/(r[1]-a[1])+a[0];e=t[0]<=n}i+=e?1:0}}return!!(i%2)}function s(e,t){for(let n=0,o=t.length;n<o;n++)if(!r(e,t[n]))return!1;return!0}var l=n(13837);function c(e){const t=e.length;let n=0,o=t-1;for(let i=0;i<t;i++)n+=(e[o][0]+e[i][0])*(e[o][1]-e[i][1]),o=i;return Math.abs(n/2)}function d(e){if(e.length<3)return 0;const t=e[0];let n=0;for(let o=0,i=e.length;o<i;o++){const a=e[o],r=e[o===i-1?0:o+1],s=a[0]-t[0],l=a[1]-t[1],c=r[0]-t[0];n+=s*(r[1]-t[1])-l*c}return n*=.5,n}function u(e){return d(e)>=0?1:-1}function g(e){const t=function(e){const t=o.R3.create(),n=e[0];for(let o=0,i=e.length;o<i;o++){const a=e[o],r=e[o===i-1?0:o+1],s=a[0]-n[0],l=a[1]-n[1],c=a[2]-n[2],d=r[0]-n[0],u=r[1]-n[1],g=r[2]-n[2];t[0]+=l*g-c*u,t[1]+=c*d-s*g,t[2]+=s*u-l*d}return o.R3.scale(t,t,.5),t}(e);return o.R3.normalize(t,t)}function h(e){const t=d(e);return[0,0,t/Math.abs(t)]}var m=n(74474);function f(e,t,n,o){let i=!1;const a=e[0]<t[0]?e[0]:t[0],r=e[1]<t[1]?e[1]:t[1],s=e[0]>t[0]?e[0]:t[0],l=e[1]>t[1]?e[1]:t[1],c=n[0]<o[0]?n[0]:o[0],d=n[1]<o[1]?n[1]:o[1],u=n[0]>o[0]?n[0]:o[0],g=n[1]>o[1]?n[1]:o[1];if(a>u||s<c||r>g||l<d)return!1;const h=[p(e,t,n),p(e,t,o),p(n,o,e),p(n,o,t)];return h[0]!==h[1]&&h[2]!==h[3]||((0===h[0]&&v(e,n,t)||0===h[1]&&v(e,o,t)||0===h[2]&&v(n,e,o)||0===h[3]&&v(n,t,o))&&(i=!0),i)}function p(e,t,n){const o=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===o?0:o>0?1:2}function v(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])}function w(e,t,n,o=!0){const i=[],a=e.length,r=a-(o?1:2);for(let o=0;o<=r;o++){const r=o===a-1?0:o+1;f(t,n,e[o],e[r])&&i.push([o,r])}return i}var I=n(79922);const y=.01;function E(e,t,n,o){const i=[t[0]-e[0],t[1]-e[1]],a=[o[0]-n[0],o[1]-n[1]],r=a[1]*i[0]-a[0]*i[1];if((r>=0?r:-r)<y){const i=[e[0]<t[0]?e[0]:t[0],e[0]>t[0]?e[0]:t[0],e[1]<t[1]?e[1]:t[1],e[1]>t[1]?e[1]:t[1]],a=[n[0]<o[0]?n[0]:o[0],n[0]>o[0]?n[0]:o[0],n[1]<o[1]?n[1]:o[1],n[1]>o[1]?n[1]:o[1]];if(!(i[0]<=a[1]&&i[1]>=a[0]&&i[2]<=a[3]&&i[3]>=a[2]))return;if(!(I.isPointOnLineSegment(e,t,n)||I.isPointOnLineSegment(e,t,o)||I.isPointOnLineSegment(n,o,e)))return;return[.5*((i[0]>a[0]?i[0]:a[0])+(i[1]<a[1]?i[1]:a[1])),.5*((i[2]>a[2]?i[2]:a[2])+(i[3]<a[3]?i[3]:a[3]))]}let s=e[1]-n[1],l=e[0]-n[0];const c=i[0]*s-i[1]*l;s=(a[0]*s-a[1]*l)/r,l=c/r;return[e[0]+s*i[0],e[1]+s*i[1]]}var x,b,C;function S(e){for(let t=0,n=e.length;t<n;t++){const o=e[t];o.next||(o.next=e[t===n-1?0:t+1])}}function T(e,t){const n=[],o=[],i=new Map;let a=r(t,e[0])?C.Exiting:C.Entering;for(let o=0,s=e.length;o<s;o++){const l=e[o],c=r(t,l),d={type:x.Vertex,coordinates:l,position:c?b.Inside:b.Outside,visited:!1,next:null};n.push(d);const u=e[o===s-1?0:o+1],g=w(t,l,u).map(e=>{const n=e[0],o=t[e[0]],i=t[e[1]],a=E(l,u,o,i);return{sourceLineSegmentId:n,coordinate:a,targetStartPointDistSquared:m.distanceToPointSquared(l,a)}});g.sort((e,t)=>e.targetStartPointDistSquared-t.targetStartPointDistSquared),g.forEach(e=>{const{sourceLineSegmentId:t,coordinate:o}=e,r={type:x.Intersection,coordinates:o,position:b.Edge,direction:a,visited:!1,next:null},s={...r,direction:C.Unknown,cloned:!0};a===C.Entering?r.next=s:s.next=r;let l=i.get(t);l||(l=[],i.set(t,l)),n.push(r),l.push(s),a*=-1})}for(let e=0,n=t.length;e<n;e++){const n=e,a=t[e],r={type:x.Vertex,coordinates:a,visited:!1,next:null};o.push(r);const s=i.get(n);s?.length&&s.map(e=>({intersectionPoint:e,lineSegStartDistSquared:m.distanceToPointSquared(a,e.coordinates)})).sort((e,t)=>e.lineSegStartDistSquared-t.lineSegStartDistSquared).map(({intersectionPoint:e})=>e).forEach(e=>o.push(e))}return S(n),S(o),{targetPolylinePoints:n,sourcePolylinePoints:o}}function M(e){for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.visited&&n.position===b.Outside)return n}}function R(e,t){const n=h(e),i=h(t),a=o.R3.dot(i,n);o.DV.equals(1,a)||(t=t.slice().reverse());const{targetPolylinePoints:r}=T(e,t),s=M(r);if(!s)return e.slice();const l=[s.coordinates];let c=s.next;for(;c!==s;)c.type===x.Intersection&&c.cloned||l.push(c.coordinates),c=c.next;return l}function P(e,t){const n=h(e),i=h(t),a=o.R3.dot(i,n);o.DV.equals(-1,a)||(t=t.slice().reverse());const{targetPolylinePoints:r}=T(e,t);let s=null;const l=[];for(;s=M(r);){const e=[s.coordinates];let t=s.next;for(s.visited=!0;t!==s;)t.visited=!0,t.type===x.Intersection&&t.cloned||e.push(t.coordinates),t=t.next;l.push(e)}return l}function _(e,t,n,o=!0){let i,a;o?(a=e.length-1,i=0):(a=0,i=1);for(let o=i;o<e.length;o++){if(f(t,n,e[a],e[o]))return[a,o];a=o}}function A(e,t){for(let n=0,o=e.length;n<o;n++){const i=_(t,e[n],e[n===o-1?0:n+1]);if(2===i?.length)return!0}return!1}!function(e){e[e.Vertex=0]="Vertex",e[e.Intersection=1]="Intersection"}(x||(x={})),function(e){e[e.Outside=-1]="Outside",e[e.Edge=0]="Edge",e[e.Inside=1]="Inside"}(b||(b={})),function(e){e[e.Exiting=-1]="Exiting",e[e.Unknown=0]="Unknown",e[e.Entering=1]="Entering"}(C||(C={}));const D=.1;function O(e,t=D){const n=e.length;if(n<3)return e;const o=t*t,i=[[0,n-1]],a=new Array(n).fill(!1);let r=2;for(a[0]=!0,a[n-1]=!0;i.length;){const[t,n]=i.pop();if(n-t===1)continue;const s=e[t],l=e[n];let c=-1/0,d=-1;for(let o=t+1;o<n;o++){const t=e[o],n=I.distanceToPointSquared(s,l,t);n>c&&(c=n,d=o)}c<o||(a[d]=!0,r++,i.push([d,n]),i.push([t,d]))}const s=new Array(r);for(let t=0,o=0;t<n;t++)a[t]&&(s[o++]=e[t]);return s}function V(e,t,n,o=!0){const i=[],a=w(e,t,n,o);for(let o=0;o<a.length;o++){const r=E(t,n,e[a[o][0]],e[a[o][1]]);i.push(r)}return i}function L(e,t,n,i=!0){let a,r;i?(r=e.length-1,a=0):(r=0,a=1);const s=[];for(let o=a;o<e.length;o++){const i=e[r],a=e[o];f(t,n,i,a)&&s.push([r,o]),r=o}if(0===s.length)return;const l=[];s.forEach(n=>{const i=[e[n[0]],e[n[1]]],a=[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];l.push(o.K4.distance(a,t))});const c=Math.min(...l);return{segment:s[l.indexOf(c)],distance:c}}var N=n(62709);const k=.001,B=(e,t)=>{let n,i,a;if(e instanceof N.StackViewport){const t=e.getImageData();i=t.direction.slice(0,3),a=t.direction.slice(3,6),n=t.spacing}else{const t=e.getImageData(),{direction:r,spacing:s}=t,{viewPlaneNormal:l,viewUp:c}=e.getCamera(),d=r.slice(0,3),u=r.slice(3,6),g=r.slice(6,9),h=o.R3.create();o.R3.cross(h,c,l);const m=Math.abs(o.R3.dot(h,d)),f=Math.abs(o.R3.dot(h,u)),p=Math.abs(o.R3.dot(h,g));let v;if(Math.abs(1-m)<k)v=s[0],i=d;else if(Math.abs(1-f)<k)v=s[1],i=u;else{if(!(Math.abs(1-p)<k))throw new Error("No support yet for oblique plane planar contours");v=s[2],i=g}const w=Math.abs(o.R3.dot(c,d)),I=Math.abs(o.R3.dot(c,u)),y=Math.abs(o.R3.dot(c,g));let E;if(Math.abs(1-w)<k)E=s[0],a=d;else if(Math.abs(1-I)<k)E=s[1],a=u;else{if(!(Math.abs(1-y)<k))throw new Error("No support yet for oblique plane planar contours");E=s[2],a=g}n=[v,E]}return{spacing:[n[0]/t,n[1]/t],xDir:i,yDir:a}},U=(e,t,n)=>o.K4.dist(e,t)<n,Z=(e,t,n,i)=>{const{xDir:a,yDir:r,spacing:s}=i,l=(0,N.getEnabledElement)(e),{viewport:c}=l;if(!t.length)return t.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const d=c.canvasToWorld(t[t.length-1]),u=c.canvasToWorld(n),g=o.R3.create();o.R3.subtract(g,u,d);const h=Math.abs(o.R3.dot(g,a)),m=Math.abs(o.R3.dot(g,r)),f=Math.max(Math.floor(h/s[0]),Math.floor(m/s[0]));if(f>1){const e=t[t.length-1],i=o.K4.dist(e,n),a=o.K4.create();o.K4.subtract(a,n,e),o.K4.set(a,a[0]/i,a[1]/i);const r=i/f;for(let n=1;n<=f;n++)t.push([e[0]+r*a[0]*n,e[1]+r*a[1]*n])}else t.push(n);return f},F=(e,t,n,i)=>{const a=[e[0]-t[0],e[1]-t[1]],r=[n[0]-t[0],n[1]-t[1]],s=a[0]*r[0]+a[1]*r[1];if(s<0)return!1;const l=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===l)return!1;const c=s/l,d=[r[0]/l,r[1]/l],u=[d[0]*c,d[1]*c],g=[t[0]+u[0],t[1]+u[1]];return!(o.K4.distance(e,g)>i)&&!(o.K4.distance(t,g)>o.K4.distance(t,n))},q=1e-6;function W(e){let t;const n=N.utilities.getRandomSampleFromArray(e,50);for(let e=0;e<3;e++)if(n.every((t,n,o)=>Math.abs(t[e]-o[0][e])<q)){t=e;break}if(void 0===t)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const o=[],i=(t+1)%3,a=(t+2)%3;for(let t=0;t<e.length;t++)o.push([e[t][i],e[t][a]]);return{sharedDimensionIndex:t,projectedPolyline:o}}function j(e,t,n={}){const{sharedDimensionIndex:o,projectedPolyline:i}=W(t),{holes:a}=n,s=[];if(a)for(let e=0;e<a.length;e++){const t=a[e],n=[];for(let e=0;e<t.length;e++)n.push([t[e][(o+1)%3],t[e][(o+2)%3]]);s.push(n)}return r(i,[e[(o+1)%3],e[(o+2)%3]],{holes:s})}},81671:(e,t,n)=>{"use strict";n.r(t),n.d(t,{distanceToPoint:()=>i});var o=n(79922);function i(e,t){if(4!==e.length||2!==t.length)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[n,i,a,r]=e;let s=655535;const l=function(e,t,n,o){return{top:[[e,t],[e+n,t]],right:[[e+n,t],[e+n,t+o]],bottom:[[e+n,t+o],[e,t+o]],left:[[e,t+o],[e,t]]}}(n,i,a,r);return Object.keys(l).forEach(e=>{const[n,i]=l[e],a=o.distanceToPoint(n,i,t);a<s&&(s=a)}),s}},34603:(e,t,n)=>{"use strict";function o(e,t){const{center:n,radius:o}=e,i=e.radius2||o*o;return(t[0]-n[0])*(t[0]-n[0])+(t[1]-n[1])*(t[1]-n[1])+(t[2]-n[2])*(t[2]-n[2])<=i}n.d(t,{E:()=>o})},3467:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});const o=1e-6,i=1,a=0;function r(e,t,n){const[i,a]=n;if(Math.abs(t)<o)return e<0;const r=e/t;if(t>0){if(r>a)return 0;r>i&&(n[0]=r)}else{if(r<i)return 0;r<a&&(n[1]=r)}return 1}function s(e,t,n,s,l){const[c,d]=e,[u,g]=t,h=u-c,m=g-d;if(void 0===s||void 0===l?(s=e,l=t):(s[0]=e[0],s[1]=e[1],l[0]=t[0],l[1]=t[1]),Math.abs(h)<o&&Math.abs(m)<o&&c>=n[0]&&c<=n[2]&&d>=n[1]&&d<=n[3])return i;const f=[0,1];if(r(n[0]-c,h,f)&&r(c-n[2],-h,f)&&r(n[1]-d,m,f)&&r(d-n[3],-m,f)){const[e,t]=f;return t<1&&(l[0]=c+t*h,l[1]=d+t*m),e>0&&(s[0]+=e*h,s[1]+=e*m),i}return a}},44037:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l,filterAnnotationsForDisplay:()=>a.Z,filterAnnotationsWithinSlice:()=>o.Z,getPointInLineOfSightWithCriteria:()=>r.Z,getWorldWidthAndHeightFromCorners:()=>i.Z,isPlaneIntersectingAABB:()=>s.U});var o=n(88642),i=n(88582),a=n(69943),r=n(1023),s=n(61890);const l={filterAnnotationsWithinSlice:o.Z,getWorldWidthAndHeightFromCorners:i.Z,filterAnnotationsForDisplay:a.Z,getPointInLineOfSightWithCriteria:r.Z,isPlaneIntersectingAABB:s.U}},31955:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(72076);function i(e,t,n,i){let a,r,s,l,c,d,u;const{numComps:g}=e;if(u=e.getScalarData?e.getScalarData():e.getPointData().getScalars().getData(),!u)return void console.warn("No scalar data found for imageData",e);const h=e.getDimensions();i?[[a,r],[s,l],[c,d]]=i:(a=0,r=h[0],s=0,l=h[1],c=0,d=h[2]);const m=o.R3.fromValues(a,s,c),f=e.getDirection(),p=f.slice(0,3),v=f.slice(3,6),w=f.slice(6,9),I=e.getSpacing(),[y,E,x]=I,b=e.indexToWorld(m),C=o.R3.fromValues(p[0]*y,p[1]*y,p[2]*y),S=o.R3.fromValues(v[0]*E,v[1]*E,v[2]*E),T=o.R3.fromValues(w[0]*x,w[1]*x,w[2]*x),M=g||u.length/h[2]/h[1]/h[0],R=h[0]*M,P=h[1]*R,_=[],A=o.R3.clone(b);for(let e=c;e<=d;e++){const i=o.R3.clone(A);for(let i=s;i<=l;i++){const s=o.R3.clone(A);for(let s=a;s<=r;s++){const a=[s,i,e];if(t(A,a)){const t=e*P+i*R+s*M;let o;o=M>2?[u[t],u[t+1],u[t+2]]:u[t],_.push({value:o,index:t,pointIJK:a,pointLPS:A.slice()}),n&&n({value:o,index:t,pointIJK:a,pointLPS:A})}o.R3.add(A,A,C)}o.R3.copy(A,s),o.R3.add(A,A,S)}o.R3.copy(A,i),o.R3.add(A,A,T)}return _}},5205:(e,t,n)=>{"use strict";function o(e,t=5){return parseFloat(e[0]).toFixed(t)+","+parseFloat(e[1]).toFixed(t)+","+parseFloat(e[2]).toFixed(t)+","}n.d(t,{s:()=>o})},35765:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(62709),i=n(64652),a=n(93341);const r=function(e,t,n={}){const r=[];return e.forEach(e=>{const{data:s}=e,{points:l}=s.handles,{imageData:c,dimensions:d}=t;let u=l;if(s.cachedStats?.projectionPoints){const{projectionPoints:e}=s.cachedStats;u=[].concat(...e)}const g=u.map(e=>o.utilities.transformWorldToIndex(c,e));let h=(0,i.g)(g,d);n.numSlicesToProject&&!s.cachedStats?.projectionPoints&&(h=(0,a.Z)(h,n.numSlicesToProject)),r.push(h)}),1===r.length?r[0]:r.reduce((e,t)=>({iMin:Math.min(e.iMin,t.iMin),jMin:Math.min(e.jMin,t.jMin),kMin:Math.min(e.kMin,t.kMin),iMax:Math.max(e.iMax,t.iMax),jMax:Math.max(e.jMax,t.jMax),kMax:Math.max(e.kMax,t.kMax)}),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0})}},59941:(e,t,n)=>{"use strict";n.d(t,{r:()=>s});var o=n(72076),i=n(62709);const{isEqual:a}=i.utilities,r=[o.R3.fromValues(1,0,0),o.R3.fromValues(0,1,0),o.R3.fromValues(0,0,1)];function s(e){const t=o.R3.subtract(o.R3.create(),e[0],e[1]),n=o.R3.subtract(o.R3.create(),e[0],e[2]);return[...l(t,r),...l(n,r)].every(e=>a(e,0)||a(e,90)||a(e,180)||a(e,270))}function l(e,t){return t.map(t=>180*o.R3.angle(e,t)/Math.PI)}},63478:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(62709);function i(e,t){if(!(0,o.getEnabledElement)(e.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(e instanceof o.StackViewport&&0===e.getImageIds().length)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:i,scrollSlabs:a}=t;e instanceof o.VolumeViewport?function(e,t,n,i=!1){const a=i,{numScrollSteps:r,currentStepIndex:s,sliceRangeInfo:l}=o.utilities.getVolumeViewportScrollInfo(e,t,a);if(!l)return;const{sliceRange:c,spacingInNormalDirection:d,camera:u}=l,{focalPoint:g,viewPlaneNormal:h,position:m}=u,{newFocalPoint:f,newPosition:p}=o.utilities.snapFocalPointToSlice(g,m,c,h,d,n);e.setCamera({focalPoint:f,position:p}),e.render();const v=s+n,w={volumeId:t,viewport:e,delta:n,desiredStepIndex:v,currentStepIndex:s,numScrollSteps:r,currentImageId:e.getCurrentImageId()};(v>r||v<0)&&e.getCurrentImageId()?o.utilities.triggerEvent(o.eventTarget,o.EVENTS.VOLUME_SCROLL_OUT_OF_BOUNDS,w):o.utilities.triggerEvent(o.eventTarget,o.EVENTS.VOLUME_VIEWPORT_SCROLL,w)}(e,n,i,a):e.scroll(i,t.debounceLoading,t.loop)}},7966:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var o=n(62709),i=n(88706),a=n(92472),r=n(28898),s=n(16524),l=n(98806),c=n(82220),d=n(52577);const{uuidv4:u}=o.utilities,g=[l.Z.HandlesUpdated,l.Z.InterpolationUpdated];class h{static{this.toolNames=[]}static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,t={}){const{toolNames:n,segmentationId:o,segmentIndex:a,sliceIndex:r}=t;for(const t of n||h.toolNames){const n=i.state.getAnnotations(t,e);if(n?.length)for(const e of n){const{interpolationUID:t,data:n,autoGenerated:i,metadata:s}=e;t&&(e.interpolationCompleted=!0),i&&(a&&a!==n.segmentation.segmentIndex||void 0!==r&&s&&r!==s.sliceIndex||o&&o!==n.segmentation.segmentationId||((0,d.D)(e),e.autoGenerated=!1))}}}static{this.handleAnnotationCompleted=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n,originalToolName:o}=t.metadata;if(!this.toolNames.includes(n)&&!this.toolNames.includes(o))return;const i=(0,c.Z)(t);if(!i)return void console.warn("Unable to find viewport for",t);const l={viewport:i,sliceData:m(i),annotation:t,interpolationUID:t.interpolationUID},d=!!t.interpolationUID;if(t.autoGenerated=!1,d)return(0,s.Z)(l),void(0,r.Z)(l);const g=[{key:"segmentIndex",value:t.data.segmentation.segmentIndex,parentKey:e=>e.data.segmentation},{key:"viewPlaneNormal",value:t.metadata.viewPlaneNormal,parentKey:e=>e.metadata},{key:"viewUp",value:t.metadata.viewUp,parentKey:e=>e.metadata}];let h=(0,a.Z)(l,g);const{sliceIndex:f}=t.metadata,p=new Set;h.forEach(e=>{if(e.interpolationCompleted||e.metadata.sliceIndex===f){const{interpolationUID:t}=e;p.add(t)}}),h=h.filter(e=>!p.has(e.interpolationUID)),t.interpolationUID=h[0]?.interpolationUID||u(),l.interpolationUID=t.interpolationUID,(0,r.Z)(l)}}static{this.handleAnnotationUpdate=e=>{const t=e.detail.annotation,{changeType:n=l.Z.HandlesUpdated}=e.detail;if(!t?.metadata)return;const{toolName:o,originalToolName:i}=t.metadata;if(!this.toolNames.includes(o)&&!this.toolNames.includes(i)||!g.includes(n))return;const a=(0,c.Z)(t);if(!a)return void console.warn("Unable to find matching viewport for annotation interpolation",t);t.autoGenerated&&((0,d.D)(t),t.autoGenerated=!1);const s={viewport:a,sliceData:m(a),annotation:t,interpolationUID:t.interpolationUID,isInterpolationUpdate:n===l.Z.InterpolationUpdated};(0,r.Z)(s)}}static{this.handleAnnotationDelete=e=>{const t=e.detail.annotation;if(!t?.metadata)return;const{toolName:n}=t.metadata;if(!this.toolNames.includes(n)||t.autoGenerated)return;const o=(0,c.Z)(t);if(!o)return void console.warn("No viewport, can't delete interpolated results",t);const i={viewport:o,sliceData:m(o),annotation:t,interpolationUID:t.interpolationUID};t.autoGenerated=!1,(0,s.Z)(i)}}}function m(e){return{numberOfSlices:e.getNumberOfSlices(),imageIndex:e.getCurrentImageIdIndex()}}},2680:(e,t,n)=>{"use strict";function o(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}n.d(t,{Z:()=>i});const i=function(e,t,n={}){const i=n.onFlood,a=n.onBoundary,r=n.equals,s=n.diagonals||!1,l=f(t),c=function(){const e=function(e){const t=[],n=function(e){return e.split("").map(function(e){return parseInt(e,10)-1})};for(let i=0;i<Math.pow(3,e);i+=1){const a=o(i.toString(3),"0",e);t.push(n(a))}return t}(t.length);return e.filter(function(e){const t=function(e){let t=0;for(let n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}(e);return 0!==t&&(1===t||s)})}(),d=[],u=[],g=new Set,h=new Map;for(d.push({currentArgs:t});d.length>0;)m(d.pop());return{flooded:u,boundaries:function(){const e=Array.from(h.values());return e.reverse(),e}()};function m(e){const t=e.currentArgs,n=e.previousArgs;(function(e){const[t,n,o=0]=e,i=t+32768+65536*(n+32768+65536*(o+32768));return g.has(i)})(t)||(function(e){const[t,n,o=0]=e,i=t+32768+65536*(n+32768+65536*(o+32768));g.add(i)}(t),function(e){const t=f(e);return r?r(t,l):t===l}(t)?(function(e){u.push(e),i&&i(...e)}(t),function(e){for(let t=0;t<c.length;t+=1){const n=c[t],o=e.slice(0);for(let t=0;t<e.length;t+=1)o[t]+=n[t];d.push({currentArgs:o,previousArgs:e})}}(t)):function(e){const[t,n,o=0]=e,i=t+32768+65536*(n+32768+65536*(o+32768));h.set(i,e),a&&a(...e)}(n))}function f(t){return e(...t)}}},68203:(e,t,n)=>{"use strict";n.r(t),n.d(t,{contourAndFindLargestBidirectional:()=>U,createBidirectionalToolData:()=>Z,createImageIdReferenceMap:()=>A,createLabelmapVolumeForViewport:()=>I,createMergedLabelmapForIndex:()=>g,floodFill:()=>E.Z,getBrushReplaceForToolGroup:()=>P,getBrushSizeForToolGroup:()=>S,getBrushThresholdForToolGroup:()=>M,getBrushToolInstances:()=>a.Xb,getDefaultRepresentationConfig:()=>p,getHoveredContourSegmentationAnnotation:()=>ne,getSegmentAtLabelmapBorder:()=>ee,getSegmentAtWorldPoint:()=>Q,getUniqueSegmentIndices:()=>H.t7,invalidateBrushCursor:()=>G,isValidRepresentationConfig:()=>f,rectangleROIThresholdVolumeByRange:()=>d,segmentContourAction:()=>j,setBrushReplaceForToolGroup:()=>R,setBrushSizeForToolGroup:()=>C,setBrushThresholdForToolGroup:()=>T,thresholdSegmentationByRange:()=>_,thresholdVolumeByRange:()=>r,triggerSegmentationRender:()=>y.ih});var o=n(79454),i=n(32140),a=n(89776);const r=function(e,t,n){const{imageData:r}=e,s=e.getScalarData(),{overwrite:l,boundsIJK:c}=n,d=n?.overlapType||0;if(l)for(let e=0;e<s.length;e++)s[e]=0;const{baseVolumeIdx:u,volumeInfoList:g}=(0,a.Ep)(e,t);let h,m,f;const p=(e,t,n)=>{const{imageData:i,dimensions:r,lower:s,upper:l}=e,c=(0,a.yW)(i,r,t,n);m=0,h=0,f={lower:s,upper:l};let u=!1;return(0,o.pointInShapeCallback)(i,()=>!0,({value:e})=>{m+=1,e>=f.lower&&e<=f.upper&&(h+=1)},c),0===d?u=h>0:1==d&&(u=h===m),u},v=(e,t)=>{const{imageData:n,referenceValues:o,lower:i,upper:a}=e,r=o[n.computeOffsetIndex(t)];return!(r<=i||r>=a)};return(0,o.pointInShapeCallback)(r,()=>!0,({index:e,pointIJK:t,pointLPS:o})=>{let i=g.length>0;for(let e=0;e<g.length&&(i=g[e].volumeSize===s.length?v(g[e],t):p(g[e],g[u].spacing,o),i);e++);i&&(s[e]=n.segmentIndex||1)},c),(0,i.triggerSegmentationDataModified)(e.volumeId),e};var s=n(88706),l=n(27446),c=n(35765);const d=function(e,t,n,o){const i=e.map(e=>s.state.getAnnotation(e));let a;!function(e){const t=[l.Cd.toolName,l.Qt.toolName];for(const n of e){const e=n.metadata.toolName;if(!t.includes(e))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}}(i);for(let e=0;e<n.length;e++){n[e].volume.getScalarData().length!==t.getScalarData().length&&0!==e||(a=(0,c.Z)(i,n[e].volume,o))}const d=r(t,n,{...o,boundsIJK:a});return d.modified(),d};var u=n(62709);const g=function(e,t=1,n="mergedLabelmap"){e.forEach(({direction:t,dimensions:n,origin:o,spacing:i})=>{if(!(u.utilities.isEqual(n,e[0].dimensions)&&u.utilities.isEqual(t,e[0].direction)&&u.utilities.isEqual(i,e[0].spacing)&&u.utilities.isEqual(o,e[0].origin)))throw new Error("labelmaps must have the same size and shape")});const o=e[0],i=new(0,o.getScalarData().constructor)(o.getScalarData().length);e.forEach(e=>{const n=e.getScalarData();for(let e=0;e<n.length;e++)n[e]===t&&(i[e]=t)});const a={scalarData:i,metadata:o.metadata,spacing:o.spacing,origin:o.origin,direction:o.direction,dimensions:o.dimensions};return u.volumeLoader.createLocalVolume(a,n,!0)};var h=n(35904),m=n(74297);function f(e,t){if(e===m.default.Labelmap)return(0,h.R)(t);throw new Error(`Unknown representation type: ${e}`)}function p(e){const{type:t}=e;if(t===m.default.Labelmap)return(0,h.Z)();throw new Error(`Unknown representation type: ${t}`)}var v=n(11677),w=n.n(v);async function I(e){const{viewportId:t,renderingEngineId:n,options:o}=e;let{segmentationId:i}=e;const a=(0,u.getEnabledElementByIds)(t,n);if(!a)throw new Error("element disabled");const{viewport:r}=a;if(!(r instanceof u.VolumeViewport))throw new Error("Segmentation only supports VolumeViewport");const{uid:s}=r.getDefaultActor();if(void 0===i&&(i=`${s}-based-segmentation-${o?.volumeId??u.utilities.uuidv4().slice(0,8)}`),o){const e=w()(o);await u.volumeLoader.createLocalVolume(e,i)}else{const{uid:e}=r.getDefaultActor();await u.volumeLoader.createAndCacheDerivedSegmentationVolume(e,{volumeId:i})}return i}var y=n(31131),E=n(2680),x=n(27078),b=n(66878);function C(e,t,n){const o=(0,x.getToolGroup)(e);if(void 0===o)return;(0,a.Xb)(e,n).forEach(e=>{e.configuration.brushSize=t,e.invalidateBrushCursor()});const i=o.getViewportsInfo(),r=Object.keys(i).map(e=>i[e]);if(!r.length)return;const{renderingEngineId:s}=r[0],l=o.getViewportIds(),c=(0,u.getRenderingEngine)(s);(0,b.Z)(c,l)}function S(e,t){const n=(0,x.getToolGroup)(e);if(void 0===n)return;const o=n._toolInstances;if(!Object.keys(o).length)return;const i=(0,a.Xb)(e,t)[0];return i?i.configuration.brushSize:void 0}function T(e,t,n={isDynamic:!1}){if(void 0===(0,x.getToolGroup)(e))return;const o=(0,a.Xb)(e),i={...n,...void 0!==t&&{threshold:t}};o.forEach(e=>{e.configuration.strategySpecificConfiguration.THRESHOLD={...e.configuration.strategySpecificConfiguration.THRESHOLD,...i}})}function M(e){const t=(0,x.getToolGroup)(e);if(void 0===t)return;const n=t._toolInstances;if(!Object.keys(n).length)return;const o=(0,a.Xb)(e)[0];return o?o.configuration.strategySpecificConfiguration.THRESHOLD.threshold:void 0}function R(e,t){if(void 0===(0,x.getToolGroup)(e))return;(0,a.Xb)(e).forEach(e=>{e.configuration.strategySpecificConfiguration.REPLACE.targetSegmentIndex=t})}function P(e){const t=(0,x.getToolGroup)(e);if(void 0===t)return;const n=t._toolInstances;if(!Object.keys(n).length)return;const o=(0,a.Xb)(e)[0];return o?o.configuration.strategySpecificConfiguration.REPLACE.targetSegmentIndex:void 0}const _=function(e,t,n,r){const s=e.getScalarData(),{baseVolumeIdx:l,volumeInfoList:c}=(0,a.Ep)(e,n);return c.forEach(e=>{const{volumeSize:n}=e;n===s.length?function(e,t,n){const{referenceValues:o,lower:i,upper:a}=n;for(let n=0;n<e.length;n++)if(e[n]===t){const r=o[n];e[n]=r>=i&&r<=a?t:0}}(s,t,e):function(e,t,n,i,r,s){const{imageData:l,lower:c,upper:d,dimensions:u}=n;let g,h,m;for(let n=0;n<e.length;n++)if(e[n]===t){const f=(0,a.yW)(l,u,i[r].spacing,i[r].imageData.getPoint(n)),p=({value:e})=>{g+=1,e>=m.lower&&e<=m.upper&&(h+=1)};g=0,h=0,m={lower:c,upper:d};let v=!1;(0,o.pointInShapeCallback)(l,()=>!0,p,f),v=0===s?h>0:h===g,e[n]=v?t:0}}(s,t,e,c,l,r)}),(0,i.triggerSegmentationDataModified)(e.volumeId),e};function A(e,t){return new Map(e.map((e,n)=>[e,t[n]]))}var D=n(11203),O=n(72076);function V(e,t,n){const o=n.toIJK(e),i=n.toIJK(t),a=O.R3.create(),{testIJK:r}=n,s=O.R3.sub(O.R3.create(),o,i),l=Math.round(Math.max(...s.map(Math.abs)));if(l<2)return!0;const c=O.R3.scale(O.R3.create(),s,1/l);for(let e=1;e<l;e++)if(O.R3.scaleAndAdd(a,i,c,e),!r(a))return!1;return!0}const L=.01;function N(e,t,n){const{sliceContours:o}=e,{segmentIndex:i,containedSegmentIndices:a}=n;let r;const s=function(e,t,n){const o=u.cache.getVolume(e);if(!o)return void console.warn(`No volume found for ${e}`);const i=o.imageData.getPointData().getScalars().getData(),a=o.dimensions[0],r=a*o.dimensions[1];return{testCenter:(e,s)=>{const l=O.R3.add(O.R3.create(),e,s).map(e=>e/2),c=o.imageData.worldToIndex(l).map(Math.round),[d,u,g]=c,h=i[d+u*a+g*r];return h===t||n?.has(h)},toIJK:e=>o.imageData.worldToIndex(e),testIJK:e=>{const[o,s,l]=e,c=Math.round(o)+Math.round(s)*a+Math.round(l)*r,d=i[c];return d===t||n?.has(d)}}}(t,i,a);for(const e of o){const t=k(e,s,r);t&&(r=t)}return r&&Object.assign(r,n),r}function k(e,t,n={maxMajor:0,maxMinor:0}){const{points:o}=e.polyData,{maxMinor:i,maxMajor:a}=n;let r,s=a*a,l=i*i;for(let e=0;e<o.length;e++)for(let n=e+1;n<o.length;n++){const i=o[e],a=o[n],c=O.R3.sqrDist(i,a);c<s||(c-L<s+L&&r||t.testCenter(i,a)&&V(i,a,t)&&(s=c-L,r=[e,n],l=0))}if(!r)return;s=Math.sqrt(s+L);const c=o[r[0]],d=o[r[1]],u=O.R3.sub(O.R3.create(),c,d);let g;O.R3.scale(u,u,1/s);for(let e=0;e<o.length;e++)for(let n=e+1;n<o.length;n++){const i=o[e],a=o[n],r=O.R3.sqrDist(i,a);if(r<=l)continue;const s=O.R3.sub(O.R3.create(),i,a);Math.abs(O.R3.dot(s,u))/Math.sqrt(r)>L||t.testCenter(i,a)&&V(i,a,t)&&(l=r,g=[e,n])}if(!g)return;l=Math.sqrt(l);return{majorAxis:[c,d],minorAxis:[o[g[0]],o[g[1]]],maxMajor:s,maxMinor:l,...e}}const{Labelmap:B}=m.default;function U(e){const t=(0,D.generateContourSetsFromLabelmap)({segmentations:e});if(!t?.length||!t[0].sliceContours.length)return;const{representationData:n,segments:o=[null,{label:"Unspecified",color:null,containedSegmentIndices:null}]}=e,{volumeId:i}=n[B],a=o.findIndex(e=>!!e);return-1!==a?(o[a].segmentIndex=a,N(t[0],i,o[a])):void 0}function Z(e,t){const{majorAxis:n,minorAxis:o,label:i="",sliceIndex:a}=e,[r,s]=n,[l,c]=o,d=[r,s,l,c];return{highlighted:!0,invalidated:!0,metadata:{toolName:"Bidirectional",...t.getViewReference({sliceIndex:a})},data:{handles:{points:d,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:i,cachedStats:{}},isLocked:!1,isVisible:!0}}var F=n(95482),q=n(85217),W=n(56611);function j(e,t){const{data:n}=t,o=(0,u.getEnabledElement)(e),i=(n.getSegment||z)(o,n);if(!i)return;const a=o.viewport.getFrameOfReferenceUID(),r=F.state.getSegmentations(),{segmentIndex:l,segmentationId:c}=i,d=s.state.getAnnotations(this.toolName||W.Z.toolName,a);let g=!1;const h=d.filter(e=>{const{segment:t}=e.data;if(t)return t.segmentationId===c&&t.segmentIndex===l&&(g=!0,e.data.segment=t),!!t});let m;if(g||h.push({data:{segment:i}}),h.forEach(e=>{const t=[],{segment:n}=e.data,{segmentIndex:l,segmentationId:c}=n;t[l]=n,s.state.removeAnnotation(e.annotationUID);const d=U({...r.find(e=>e.segmentationId===c),segments:t});if(!d)return;const u=Z(d,o.viewport);u.annotationUID=e.annotationUID,u.data.segment=n;const g=s.state.addAnnotation(u,a);if(n.segmentIndex===i.segmentIndex&&n.segmentationId===i.segmentationId){m=d;const{style:e}=i;e&&s.config.style.setAnnotationStyles(g,e)}}),m){const{sliceIndex:t}=m,n=o.viewport.getImageIds();(0,q.jumpToSlice)(e,{imageIndex:n.length-1-t}),o.viewport.render()}else console.warn("No bidirectional found");return m}function z(e,t){const n=F.state.getSegmentations();if(!n.length)return;const o=t.segmentationId||n[0].segmentationId,i=t.segmentIndex??F.segmentIndex.getActiveSegmentIndex(o);if(!i)return;const a=t.segmentData?.get(i);return{label:`Segment ${i}`,segmentIndex:i,segmentationId:o,...a}}function G(e){const t=(0,x.getToolGroup)(e);if(void 0===t)return;(0,a.Xb)(e).forEach(e=>{e.invalidateBrushCursor()});const n=t.getViewportsInfo(),o=Object.keys(n).map(e=>n[e]);if(!o.length)return;const{renderingEngineId:i}=o[0],r=t.getViewportIds(),s=(0,u.getRenderingEngine)(i);(0,b.Z)(s,r)}var H=n(23267),$=n(68096),K=n(60721),X=n(88439),J=n(50097),Y=n(42744);function Q(e,t,n={}){const o=(0,K.getSegmentation)(e),i=o.representationData,a=n?.representationType??Object.keys(i)[0];if(!a)throw new Error(`Segmentation ${e} does not have any representations`);switch(a){case $.SegmentationRepresentations.Labelmap:return function(e,t,{viewport:n}){const o=e.representationData.LABELMAP;if((0,X.y)(o)){const{volumeId:e}=o,n=u.cache.getVolume(e);if(!n)return;return n.imageData.getScalarValueFromWorld(t)}const{imageIdReferenceMap:i}=o,a=n.getCurrentImageId(),r=i.get(a);if(!u.cache.getImage(r))return;const s=(0,K.getSegmentationIdRepresentations)(e.segmentationId),{segmentationRepresentationUID:l}=s[0],c=n.getActor(l),d=c?.actor.getMapper().getInputData(),g=u.utilities.transformWorldToIndex(d,t),h=d.getDimensions(),m=d.voxelManager||u.utilities.VoxelManager.createVolumeVoxelManager(h,d.getPointData().getScalars().getData());return m.getAtIJKPoint(g)}(o,t,n);case $.SegmentationRepresentations.Contour:return function(e,t,{viewport:n}){const o=e.representationData.CONTOUR,i=Array.from(o.annotationUIDsMap.keys()),{viewPlaneNormal:a}=n.getCamera();for(const e of i){const n=o.annotationUIDsMap.get(e);if(n)for(const o of n){const n=(0,J.AR)(o);if(!n)continue;const{polyline:i}=n.data.contour;if(u.utilities.isEqual(a,n.metadata.viewPlaneNormal)&&(0,Y.isPointInsidePolyline3D)(t,i))return Number(e)}}}(o,t,n);default:return}}function ee(e,t,{viewport:n,searchRadius:o}){const i=(0,K.getSegmentation)(e),a=i.representationData.LABELMAP;if((0,X.y)(a)){const{volumeId:e}=a,i=u.cache.getVolume(e);if(!i)return;const r=i.imageData,s=r.getScalarValueFromWorld(t),l=function(e,t,n,o,i){const a=(t,i)=>{const a=[e[0]+t,e[1]+i],r=n.canvasToWorld(a);return o.getScalarValueFromWorld(r)};return te(a,t,i)}(n.worldToCanvas(t),s,n,r,o);return l?s:void 0}const{imageIdReferenceMap:r}=a,s=n.getCurrentImageId(),l=r.get(s);if(!u.cache.getImage(l))return;const c=(0,K.getSegmentationIdRepresentations)(i.segmentationId),{segmentationRepresentationUID:d}=c[0],g=n.getActor(d),h=g?.actor.getMapper().getInputData(),m=u.utilities.transformWorldToIndex(h,t),f=h.getDimensions(),p=h.voxelManager||u.utilities.VoxelManager.createVolumeVoxelManager(f,h.getPointData().getScalars().getData()),v=p.getAtIJKPoint(m),w=function(e,t,n,o,i){const a=(t,o,i)=>{const a=[e[0]+t,e[1]+o,e[2]+i];return n.getAtIJK(...a)};return te(a,o,i)}(m,0,p,v);return w?v:void 0}function te(e,t,n=1){const o=Array.from({length:2*n+1},(e,t)=>t-n);for(const n of o)for(const i of o)for(const a of o){if(0===n&&0===i&&0===a)continue;const o=e(n,i,a);if(void 0!==o&&t!==o)return!0}return!1}function ne(e){const t=(0,K.getSegmentation)(e),{annotationUIDsMap:n}=t.representationData.CONTOUR;for(const[e,t]of n.entries()){if(Array.from(t).find(e=>(0,J.AR)(e).highlighted))return e}}},89776:(e,t,n)=>{"use strict";n.d(t,{Ep:()=>d,Xb:()=>s,yW:()=>c});var o=n(62709),i=n(27078),a=n(95459),r=n(64652);function s(e,t){const n=(0,i.getToolGroup)(e);if(void 0===n)return;const o=n._toolInstances;if(!Object.keys(o).length)return;if(t&&o[t])return[o[t]];return Object.values(o).filter(e=>e instanceof a.Z)}const l=(e,t)=>JSON.stringify(e)===JSON.stringify(t);function c(e,t,n,i){const a=[];for(let e=0;e<2;e++)for(let t=0;t<2;t++)for(let o=0;o<2;o++){const r=[...i];r[0]=r[0]+(2*e-1)*n[0]/2,r[1]=r[1]+(2*t-1)*n[1]/2,r[2]=r[2]+(2*o-1)*n[2]/2,a.push(r)}const s=a.map(t=>o.utilities.transformWorldToIndex(e,t));return(0,r.g)(s,t)}function d(e,t){const{spacing:n}=e,o=e.getScalarData(),i=[];let a=0;for(let e=0;e<t.length;e++){const{imageData:r,spacing:s,dimensions:c}=t[e].volume,d=t[e].volume.getScalarData().length;d===o.length&&l(s,n)&&(a=e);const u=r.getPointData().getScalars().getData(),g=t[e].lower,h=t[e].upper;i.push({imageData:r,referenceValues:u,lower:g,upper:h,spacing:s,dimensions:c,volumeSize:d})}return{volumeInfoList:i,baseVolumeIdx:a}}},90685:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(82298),i=n(73609);const a=function(e,t,n){let a=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return(0,i.Z)(n)&&(a="leading"in n?Boolean(n.leading):a,r="trailing"in n?Boolean(n.trailing):r),(0,o.Z)(e,t,{leading:a,trailing:r,maxWait:t})}},25068:(e,t,n)=>{"use strict";function o(e,t){const n=c(e),o=c(t);return{page:u(n.page,o.page),client:u(n.client,o.client),canvas:u(n.canvas,o.canvas),world:(i=n.world,a=o.world,[i[0]-a[0],i[1]-a[1],i[2]-a[2]])};var i,a}function i(e,t){const n=c(e),o=c(t);return{page:h(n.page,o.page),client:h(n.client,o.client),canvas:h(n.canvas,o.canvas),world:m(n.world,o.world)}}function a(e,t){}function r(e,t){const n=g(e),o=g(t);return{page:n.page-o.page,client:n.client-o.client,canvas:n.canvas-o.canvas,world:n.world-o.world}}function s(e){return JSON.parse(JSON.stringify(e))}function l(e){return JSON.parse(JSON.stringify(e))}function c(e){return e.reduce((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function d(e){return e.reduce((t,n)=>({page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length],touch:{identifier:null,radiusX:t.touch.radiusX+n.touch.radiusX/e.length,radiusY:t.touch.radiusY+n.touch.radiusY/e.length,force:t.touch.force+n.touch.force/e.length,rotationAngle:t.touch.rotationAngle+n.touch.rotationAngle/e.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function u(e,t){return[e[0]-t[0],e[1]-t[1]]}function g(e){const t=[];for(let n=0;n<e.length;n++)for(let o=0;o<e.length;o++)n<o&&t.push({page:h(e[n].page,e[o].page),client:h(e[n].client,e[o].client),canvas:h(e[n].canvas,e[o].canvas),world:m(e[n].world,e[o].world)});return t.reduce((e,n)=>({page:e.page+n.page/t.length,client:e.client+n.client/t.length,canvas:e.canvas+n.canvas/t.length,world:e.world+n.world/t.length}),{page:0,client:0,canvas:0,world:0})}function h(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function m(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}n.r(t),n.d(t,{copyPoints:()=>l,copyPointsList:()=>s,getDeltaDistance:()=>i,getDeltaDistanceBetweenIPoints:()=>r,getDeltaPoints:()=>o,getDeltaRotation:()=>a,getMeanPoints:()=>c,getMeanTouchPoints:()=>d})},46966:(e,t,n)=>{"use strict";function o(e,t){const n=e.length,o=[];for(let i=0;i<n;i++){const n=e[i];console.log(`VIEWPORT ${i} WITH FORUID ${n.getFrameOfReferenceUID()}`),n.getFrameOfReferenceUID()===t&&o.push(n)}return o}n.r(t),n.d(t,{filterViewportsWithFrameOfReferenceUID:()=>o,filterViewportsWithParallelNormals:()=>h,filterViewportsWithToolEnabled:()=>c,getViewportIdsWithToolToRender:()=>m});var i=n(33232),a=n(68096);const{Active:r,Passive:s,Enabled:l}=a.ToolModes;function c(e,t){const n=e.length,o=[];for(let a=0;a<n;a++){const n=e[a],r=i.fT.getToolGroupForViewport(n.id,n.renderingEngineId);if(!r)continue;d(r,t)&&o.push(n)}return o}function d(e,t){const{toolOptions:n}=e,o=n[t];if(!o)return!1;const i=o.mode;return i===r||i===s||i===l}var u=n(62709),g=n(72076);const h=function(e,t,n=.999){return e.filter(e=>{const o=e.getCamera();return Math.abs(g.R3.dot(o.viewPlaneNormal,t.viewPlaneNormal))>n})};function m(e,t,n=!0){const i=(0,u.getEnabledElement)(e),{renderingEngine:a,FrameOfReferenceUID:r}=i;let s=a.getViewports();s=o(s,r),s=c(s,t);const l=a.getViewport(i.viewportId);n&&(s=h(s,l.getCamera()));return s.map(e=>e.id)}},85217:(e,t,n)=>{"use strict";n.r(t),n.d(t,{isViewportPreScaled:()=>o.P,jumpToSlice:()=>i.Z,jumpToWorld:()=>a.Z});var o=n(20752),i=n(68009),a=n(94451)},20752:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var o=n(62709);function i(e,t){if(e instanceof o.BaseVolumeViewport){const e=t.split("volumeId:"),n=e.length>1?e[1].split("?")[0]:e[0],i=o.cache.getVolume(n);return!!i?.scaling&&Object.keys(i.scaling).length>0}if(e instanceof o.StackViewport){const{preScale:t}=e.getImageData()||{};return!!t?.scaled}return!1}},68009:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(62709),i=n(70232),a=n(63478);const r=async function(e,t={}){const{imageIndex:n,debounceLoading:r,volumeId:s}=t,l=(0,o.getEnabledElement)(e);if(!l)throw new Error("Element has been disabled");const{viewport:c}=l,{imageIndex:d,numberOfSlices:u}=function(e,t){if(e instanceof o.StackViewport)return{numberOfSlices:e.getImageIds().length,imageIndex:t?e.getTargetImageIdIndex():e.getCurrentImageIdIndex()};if(e instanceof o.VolumeViewport)return o.utilities.getImageSliceDataForVolumeViewport(e);throw new Error("Unsupported viewport type")}(c,r),g=function(e,t){const n=e-1;return(0,i.ZP)(t,0,n)}(u,n)-d;(0,a.Z)(c,{delta:g,debounceLoading:r,volumeId:s})}},94451:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(62709),i=n(72076);function a(e,t){if(!(e instanceof o.VolumeViewport))return;const{focalPoint:n}=e.getCamera(),a=[0,0,0];return i.R3.sub(a,t,n),function(e,t){const n=e.getCamera(),o=n.viewPlaneNormal,a=i.R3.dot(t,o),r=i.R3.fromValues(o[0],o[1],o[2]);if(i.R3.scale(r,r,a),Math.abs(r[0])>.001||Math.abs(r[1])>.001||Math.abs(r[2])>.001){const t=[0,0,0],o=[0,0,0];i.R3.add(t,n.focalPoint,r),i.R3.add(o,n.position,r),e.setCamera({focalPoint:t,position:o}),e.render()}}(e,a),!0}},35066:(e,t,n)=>{"use strict";n.r(t),n.d(t,{colorbar:()=>i,windowLevel:()=>r});var o={};n.r(o),n.d(o,{ColorbarRangeTextPosition:()=>a});var i={};n.r(i),n.d(i,{Colorbar:()=>y,Enums:()=>o,ViewportColorbar:()=>C});var a,r={};n.r(r),n.d(r,{calculateMinMaxMean:()=>T,extractWindowLevelRegionToolData:()=>M,getLuminanceFromRegion:()=>S}),function(e){e.Top="top",e.Left="left",e.Bottom="bottom",e.Right="right"}(a||(a={}));var s=n(72076),l=n(62709);const c=e=>e&&e.upper>e.lower,d=e=>!!e&&e.width>0&&e.height>0,u=(e,t)=>!!e&&!!t&&e.lower===t.lower&&e.upper===t.upper,g=(e,t)=>!!e&&!!t&&e.width===t.width&&e.height===t.height,h=(e,t,n)=>[e[0]*(1-n)+t[0]*n,e[1]*(1-n)+t[1]*n,e[2]*(1-n)+t[2]*n],{clamp:m}=l.utilities;class f{constructor(e){f.validateProps(e);const{colormap:t,size:n={width:20,height:100},imageRange:o={lower:0,upper:1},voiRange:i={lower:0,upper:1},container:a,showFullPixelValueRange:r=!1}=e;this._colormap=t,this._imageRange=o,this._voiRange=i,this._showFullImageRange=r,this._canvas=this._createRootElement(n),a&&this.appendTo(a)}get colormap(){return this._colormap}set colormap(e){this._colormap=e,this.render()}get size(){const{width:e,height:t}=this._canvas;return{width:e,height:t}}set size(e){const{_canvas:t}=this;d(e)&&!g(t,e)&&(this._setCanvasSize(t,e),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){c(e)&&!u(e,this._imageRange)&&(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){c(e)&&!u(e,this._voiRange)&&(this._voiRange=e,this.render())}get showFullImageRange(){return this._showFullImageRange}set showFullImageRange(e){e!==this._showFullImageRange&&(this._showFullImageRange=e,this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}dispose(){const{_canvas:e}=this,{parentElement:t}=e;t?.removeChild(e)}static validateProps(e){const{size:t,imageRange:n,voiRange:o}=e;if(t&&!d(t))throw new Error('Invalid "size"');if(n&&!c(n))throw new Error('Invalid "imageRange"');if(o&&!c(o))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,t){const{width:n,height:o}=t;e.width=n,e.height=o,Object.assign(e.style,{width:`${n}px`,height:`${o}px`})}_createRootElement(e){const t=document.createElement("canvas");return Object.assign(t.style,{position:"absolute",top:"0",left:"0",pointerEvents:"none",boxSizing:"border-box"}),this._setCanvasSize(t,e),t}render(){if(!this._canvas.isConnected)return;const{_colormap:e}=this,{RGBPoints:t}=e,n=t.length/4,o=e=>{const o=4*e;if(!(e<0||e>=n))return{index:e,position:t[o],color:[t[o+1],t[o+2],t[o+3]]}},{width:i,height:a}=this._canvas,r=this._canvas.getContext("2d"),s=i>a,c=s?i:a,{_voiRange:d}=this,u=this._showFullImageRange?this._imageRange:{...d},{windowWidth:g}=l.utilities.windowLevel.toWindowLevel(d.lower,d.upper);let f,p=o(0);const v=(u.upper-u.lower)/(c-1);let w=u.lower;for(let e=0;e<c;e++){const t=(w-d.lower)/g;if(p)for(let e=p.index;e<n&&!(t<=p.position);e++)f=p,p=o(e+1);let l;if(f)if(p){const e=(t-f.position)/(p.position-f.position);l=h(f.color,p.color,e)}else l=[...f.color];else l=[...p.color];const c=l.map(e=>m(Math.round(255*e),0,255));r.fillStyle=`rgb(${c[0]}, ${c[1]}, ${c[2]})`,s?r.fillRect(e,0,1,a):r.fillRect(0,a-e-1,i,1),w+=v}}}const p={FONT:"10px Arial",COLOR:"white",TICK_SIZE:5,TICK_WIDTH:1,TICK_LABEL_MARGIN:3,MAX_NUM_TICKS:8,TICKS_STEPS:[1,2.5,5,10]};class v{constructor(e){v.validateProps(e);const{top:t=0,left:n=0,size:o={width:20,height:100},imageRange:i={lower:0,upper:1},voiRange:r={lower:0,upper:1},ticks:s,container:l,showFullPixelValueRange:c=!1}=e,{style:d,position:u}=s??{};this._imageRange=i,this._voiRange=r,this._font=d?.font??p.FONT,this._color=d?.color??p.COLOR,this._tickSize=d?.tickSize??p.TICK_SIZE,this._tickWidth=d?.tickWidth??p.TICK_WIDTH,this._labelMargin=d?.labelMargin??p.TICK_LABEL_MARGIN,this._maxNumTicks=d?.maxNumTicks??p.MAX_NUM_TICKS,this._rangeTextPosition=u??a.Right,this._showFullPixelValueRange=c,this._canvas=this._createCanvasElement(o,t,n),l&&this.appendTo(l)}get size(){const{width:e,height:t}=this._canvas;return{width:e,height:t}}set size(e){const{_canvas:t}=this;d(e)&&!g(t,e)&&(this._setCanvasSize(t,e),this.render())}get top(){return Number.parseInt(this._canvas.style.top)}set top(e){const{_canvas:t}=this;e!==this.top&&(t.style.top=`${e}px`,this.render())}get left(){return Number.parseInt(this._canvas.style.left)}set left(e){const{_canvas:t}=this;e!==this.left&&(t.style.left=`${e}px`,this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){c(e)&&!u(e,this._imageRange)&&(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){c(e)&&!u(e,this._voiRange)&&(this._voiRange=e,this.render())}get tickSize(){return this._tickSize}set tickSize(e){e!==this._tickSize&&(this._tickSize=e,this.render())}get tickWidth(){return this._tickWidth}set tickWidth(e){e!==this._tickWidth&&(this._tickWidth=e,this.render())}get color(){return this._color}set color(e){e!==this._color&&(this._color=e,this.render())}get showFullPixelValueRange(){return this._showFullPixelValueRange}set showFullPixelValueRange(e){e!==this._showFullPixelValueRange&&(this._showFullPixelValueRange=e,this.render())}get visible(){return"block"===this._canvas.style.display}set visible(e){e!==this.visible&&(this._canvas.style.display=e?"block":"none",e&&this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}static validateProps(e){const{size:t,imageRange:n,voiRange:o}=e;if(t&&!d(t))throw new Error('Invalid "size"');if(n&&!c(n))throw new Error('Invalid "imageRange"');if(o&&!c(o))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,t){const{width:n,height:o}=t;e.width=n,e.height=o,Object.assign(e.style,{width:`${n}px`,height:`${o}px`})}_createCanvasElement(e,t,n){const o=document.createElement("canvas");return Object.assign(o.style,{display:"none",position:"absolute",boxSizing:"border-box",top:`${t}px`,left:`${n}px`}),this._setCanvasSize(o,e),o}_getTicks(e){const{lower:t,upper:n}=e,o=(n-t)/(this._maxNumTicks-1),i=Math.pow(10,-Math.floor(Math.log10(Math.abs(o)))),a=o*i,r=p.TICKS_STEPS.find(e=>e>=a)/i,s=Math.ceil(n/r)*r,l=Math.floor(t/r)*r,c=Math.round((s-l)/r)+1,d=[];for(let e=0;e<c;e++)d.push(l+e*r);return{scaleMin:l,scaleMax:s,step:r,ticks:d}}_getLeftTickInfo({position:e,labelMeasure:t}){const{width:n}=this._canvas;return{labelPoint:[n-this.tickSize-t.width-this._labelMargin,e],tickPoints:{start:[n-this._tickSize,e],end:[n,e]}}}_getRightTickInfo({position:e}){return{labelPoint:[this._tickSize+this._labelMargin,e],tickPoints:{start:[0,e],end:[this._tickSize,e]}}}_getTopTickInfo({position:e,labelMeasure:t}){throw new Error("Not implemented")}_getBottomTickInfo({position:e,labelMeasure:t}){throw new Error("Not implemented")}render(){const{_canvas:e}=this;if(!e.isConnected||!this.visible)return;const{width:t,height:n}=e,o=t>=n,i=o?t:n,r=e.getContext("2d"),{_voiRange:s}=this,l=this._showFullPixelValueRange?this._imageRange:{...s},c=l.upper-l.lower,{ticks:d}=this._getTicks(l);r.clearRect(0,0,t,n),r.font=this._font,r.textBaseline="middle",r.fillStyle=this._color,r.strokeStyle=this._color,r.lineWidth=this.tickWidth,d.forEach(e=>{let t=Math.round(i*((e-l.lower)/c));if(o||(t=n-t),t<0||t>i)return;const s=e.toString(),d=r.measureText(s);let u;u=o?this._rangeTextPosition===a.Top?this._getTopTickInfo({position:t,labelMeasure:d}):this._getBottomTickInfo({position:t,labelMeasure:d}):this._rangeTextPosition===a.Left?this._getLeftTickInfo({position:t,labelMeasure:d}):this._getRightTickInfo({position:t});const{labelPoint:g,tickPoints:h}=u,{start:m,end:f}=h;return r.beginPath(),r.moveTo(m[0],m[1]),r.lineTo(f[0],f[1]),r.fillText(s,g[0],g[1]),r.stroke(),t})}}class w{constructor({id:e,container:t}){this._containerResizeCallback=e=>{let t,n;const{contentRect:o,contentBoxSize:i}=e[0];o?(t=o.width,n=o.height):i?.length&&(t=i[0].inlineSize,n=i[0].blockSize),this._containerSize={width:t,height:n},this.onContainerResize()},this._id=e,this._containerSize={width:0,height:0},this._rootElement=this.createRootElement(e),this._containerResizeObserver=new ResizeObserver(this._containerResizeCallback),t&&this.appendTo(t)}get id(){return this._id}get rootElement(){return this._rootElement}appendTo(e){const{_rootElement:t,_containerResizeObserver:n}=this,{parentElement:o}=t;e&&e!==o&&(o&&n.unobserve(o),e.appendChild(t),n.observe(e))}destroy(){const{_rootElement:e,_containerResizeObserver:t}=this,{parentElement:n}=e;n?.removeChild(e),t.disconnect()}get containerSize(){return{...this._containerSize}}createRootElement(e){const t=document.createElement("div");return t.id=e,t.classList.add("widget"),Object.assign(t.style,{width:"100%",height:"100%"}),t}onContainerResize(){}}const I={MULTIPLIER:1,RANGE_TEXT_POSITION:a.Right,TICKS_BAR_SIZE:50};class y extends w{constructor(e){super(e),this._isMouseOver=!1,this._isInteracting=!1,this._mouseOverCallback=e=>{this._isMouseOver=!0,this.showTicks(),e.stopPropagation()},this._mouseOutCallback=e=>{this._isMouseOver=!1,this.hideTicks(),e.stopPropagation()},this._mouseDownCallback=e=>{this._isInteracting=!0,this.showTicks(),this._addVOIEventListeners(e),e.stopPropagation()},this._mouseDragCallback=(e,t)=>{const n=this.getVOIMultipliers(),o=this._getPointsFromMouseEvent(e),{points:i,voiRange:a}=t,r=s.K4.sub(s.K4.create(),o.local,i.local),c=r[0]*n[0],d=r[1]*n[1];if(!c&&!d)return;const{lower:u,upper:g}=a;let{windowWidth:h,windowCenter:m}=l.utilities.windowLevel.toWindowLevel(u,g);h=Math.max(h+c,1),m+=d;const f=l.utilities.windowLevel.toLowHighRange(h,m);this.voiRange=f,e.stopPropagation(),e.preventDefault()},this._mouseUpCallback=e=>{this._isInteracting=!1,this.hideTicks(),this._removeVOIEventListeners(),e.stopPropagation()},this._eventListenersManager=new l.utilities.eventListener.MultiTargetEventListenerManager,this._colormaps=y.getColormapsMap(e),this._activeColormapName=y.getInitialColormapName(e),this._canvas=this._createCanvas(e),this._ticksBar=this._createTicksBar(e),this._rangeTextPosition=e.ticks?.position??I.RANGE_TEXT_POSITION,this._canvas.appendTo(this.rootElement),this._ticksBar.appendTo(this.rootElement),this._addRootElementEventListeners()}get activeColormapName(){return this._activeColormapName}set activeColormapName(e){if(e===this._activeColormapName)return;const t=this._colormaps.get(e);t?(this._activeColormapName=e,this._canvas.colormap=t):console.warn(`Invalid colormap name (${e})`)}get imageRange(){return this._canvas.imageRange}set imageRange(e){this._canvas.imageRange=e,this._ticksBar.imageRange=e}get voiRange(){return this._canvas.voiRange}set voiRange(e){const{voiRange:t}=this._canvas;c(e)&&!u(e,t)&&(this._canvas.voiRange=e,this._ticksBar.voiRange=e,this.onVoiChange(e))}get showFullImageRange(){return this._canvas.showFullImageRange}set showFullImageRange(e){this._canvas.showFullImageRange=e,this._ticksBar.showFullPixelValueRange=e}destroy(){super.destroy(),this._eventListenersManager.reset()}createRootElement(){const e=document.createElement("div");return Object.assign(e.style,{position:"relative",fontSize:"0",width:"100%",height:"100%"}),e}onContainerResize(){super.onContainerResize(),this.updateTicksBar(),this._canvas.size=this.containerSize}getVOIMultipliers(){return[I.MULTIPLIER,I.MULTIPLIER]}onVoiChange(e){}showTicks(){this.updateTicksBar(),this._ticksBar.visible=!0}hideTicks(){this._isInteracting||this._isMouseOver||(this._ticksBar.visible=!1)}static getColormapsMap(e){const{colormaps:t}=e;return t.reduce((e,t)=>e.set(t.Name,t),new Map)}static getInitialColormapName(e){const{activeColormapName:t,colormaps:n}=e;return!!t&&n.some(e=>e.Name===t)?t:n[0].Name}_createCanvas(e){const{imageRange:t,voiRange:n,showFullPixelValueRange:o}=e,i=this._colormaps.get(this._activeColormapName);return new f({colormap:i,imageRange:t,voiRange:n,showFullPixelValueRange:o})}_createTicksBar(e){const t=e.ticks;return new v({imageRange:e.imageRange,voiRange:e.voiRange,ticks:t,showFullPixelValueRange:e.showFullPixelValueRange})}_getPointsFromMouseEvent(e){const{rootElement:t}=this,n=[e.clientX,e.clientY],o=[e.pageX,e.pageY],i=t.getBoundingClientRect();return{client:n,page:o,local:[o[0]-i.left-window.pageXOffset,o[1]-i.top-window.pageYOffset]}}updateTicksBar(){const{width:e,height:t}=this.containerSize;if(0===e&&0===t)return;const{_ticksBar:n,_rangeTextPosition:o}=this,i=e>=t,r=i?e:I.TICKS_BAR_SIZE,s=i?I.TICKS_BAR_SIZE:t;if(!function(e,t,n){return(e>=t?[a.Top,a.Bottom]:[a.Left,a.Right]).includes(n)}(e,t,o))throw new Error("Invalid rangeTextPosition value for the current colobar orientation");let l,c;n.size={width:r,height:s},i?(c=0,l=o===a.Top?-s:t):(l=0,c=o===a.Left?-r:e),n.top=l,n.left=c}_addRootElementEventListeners(){const{_eventListenersManager:e}=this,{rootElement:t}=this;e.addEventListener(t,"mouseover",this._mouseOverCallback),e.addEventListener(t,"mouseout",this._mouseOutCallback),e.addEventListener(t,"mousedown",this._mouseDownCallback)}_addVOIEventListeners(e){const{_eventListenersManager:t}=this,n={points:this._getPointsFromMouseEvent(e),voiRange:{...this._canvas.voiRange}};this._removeVOIEventListeners(),t.addEventListener(document,"voi.mouseup",this._mouseUpCallback),t.addEventListener(document,"voi.mousemove",e=>this._mouseDragCallback(e,n))}_removeVOIEventListeners(){const{_eventListenersManager:e}=this;e.removeEventListener(document,"voi.mouseup"),e.removeEventListener(document,"voi.mousemove")}}var E=n(85217);const{Events:x}=l.Enums,b={lower:-1e3,upper:1e3};class C extends y{constructor(e){const{element:t,volumeId:n}=e,o=C._getImageRange(t,n),i=C._getVOIRange(t,n);super({...e,imageRange:o,voiRange:i}),this.autoHideTicks=()=>{if(this._hideTicksTimeoutId)return;const e=this._hideTicksTime-Date.now();e<=0?this.hideTicks():this._hideTicksTimeoutId=window.setTimeout(()=>{this._hideTicksTimeoutId=0,this.autoHideTicks()},e)},this._stackNewImageCallback=()=>{this.imageRange=C._getImageRange(this._element)},this._imageVolumeModifiedCallback=e=>{const{volumeId:t}=e.detail.imageVolume;if(t!==this._volumeId)return;const{_element:n}=this;this.imageRange=C._getImageRange(n,t)},this._viewportVOIModifiedCallback=e=>{const{viewportId:t,volumeId:n,range:o,colormap:i}=e.detail,{viewport:a}=this.enabledElement;t===a.id&&n===this._volumeId&&(this.voiRange=o,i&&(this.activeColormapName=i.name),this.showAndAutoHideTicks())},this._viewportColormapModifiedCallback=e=>{const{viewportId:t,colormap:n,volumeId:o}=e.detail,{viewport:i}=this.enabledElement;t===i.id&&o===this._volumeId&&(this.activeColormapName=n.name)},this._element=t,this._volumeId=n,this._addCornerstoneEventListener()}get element(){return this._element}get enabledElement(){return(0,l.getEnabledElement)(this._element)}getVOIMultipliers(){const{viewport:e}=this.enabledElement;return function(e,t,n){if("PT"===l.utilities.getViewportModality(e,t)){const{clientWidth:o,clientHeight:i}=e.element,a=5/Math.max(o,i),r=(0,E.isViewportPreScaled)(e,t),{fixedPTWindowWidth:s=!0}=n??{},l=s?0:a;return r?[l,a]:[l,4]}return[4,4]}(e,this._volumeId)}onVoiChange(e){super.onVoiChange(e);const{viewport:t}=this.enabledElement;if(t instanceof l.StackViewport)t.setProperties({voiRange:e}),t.render();else if(t instanceof l.VolumeViewport){const{_volumeId:n}=this,o=l.utilities.getViewportsWithVolumeId(n,t.renderingEngineId);t.setProperties({voiRange:e},n),o.forEach(e=>e.render())}}static _getImageRange(e,t){const n=(0,l.getEnabledElement)(e),{viewport:o}=n,i=t?o.getActor(t):o.getDefaultActor();if(!i)return b;const a=i.actor.getMapper().getInputData().getPointData().getScalars().getRange();return 0===a[0]&&0===a[1]?b:{lower:a[0],upper:a[1]}}static _getVOIRange(e,t){const n=(0,l.getEnabledElement)(e),{viewport:o}=n,i=t?o.getActor(t):o.getDefaultActor();if(!i||!l.utilities.isImageActor(i))return b;const a=i.actor.getProperty().getRGBTransferFunction(0).getRange();return 0===a[0]&&0===a[1]?b:{lower:a[0],upper:a[1]}}showAndAutoHideTicks(e=1e3){this._hideTicksTime=Date.now()+e,this.showTicks(),this.autoHideTicks()}_addCornerstoneEventListener(){const{_element:e}=this;l.eventTarget.addEventListener(x.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.addEventListener(x.STACK_NEW_IMAGE,this._stackNewImageCallback),e.addEventListener(x.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.addEventListener(x.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}}function S(e,t,n,o,i){const a=[];let r=0;const s=e.scalarData;let l,c,d;if(e.color)for(c=0;c<i;c++)for(d=0;d<o;d++){l=4*((c+n)*e.columns+(d+t));const o=s[l],i=s[l+1],u=s[l+2];a[r++]=.2126*o+.7152*i+.0722*u}else for(c=0;c<i;c++)for(d=0;d<o;d++)l=(c+n)*e.columns+(d+t),a[r++]=s[l];return a}function T(e,t,n){const o=e.length;let i=n,a=t,r=0;if(o<2)return{min:i,max:a,mean:(t+n)/2};for(let t=0;t<o;t++){const n=e[t];i=Math.min(i,n),a=Math.max(a,n),r+=n}return{min:i,max:a,mean:r/o}}function M(e){if(e instanceof l.VolumeViewport)return function(e){const{scalarData:t,width:n,height:o}=l.utilities.getCurrentVolumeViewportSlice(e),{min:i,max:a}=l.utilities.getMinMax(t),r=e.getVolumeId(),s=l.cache.getVolume(r),{metadata:c,cornerstoneImageMetaData:d}=s,{Rows:u,Columns:g}=c,{color:h}=d;return{scalarData:t,width:n,height:o,minPixelValue:i,maxPixelValue:a,rows:u,columns:g,color:h}}(e);if(e instanceof l.StackViewport)return function(e){const t=e.getImageData(),{scalarData:n}=t,{min:o,max:i}=l.utilities.getMinMax(n),a=t.dimensions[0],r=t.dimensions[1],{rows:s,columns:c,color:d}=e.getCornerstoneImage();return{scalarData:n,width:a,height:r,minPixelValue:o,maxPixelValue:i,rows:s,columns:c,color:d}}(e);throw new Error("Viewport not supported")}},44031:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>s});var o=n(68470);const{vtkErrorMacro:i}=o.m;const a={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,a,n),o.m.obj(e,t),t.nodes=[],o.m.setGet(e,t,["allowDuplicateScalars","clamping"]),o.m.setArray(e,t,["range"],2),o.m.getArray(e,t,["range"]),function(e,t){t.classHierarchy.push("vtkPiecewiseFunction"),e.getSize=()=>t.nodes.length,e.getType=()=>{let e,n=0,o=0;t.nodes.length>0&&(n=t.nodes[0].y);for(let i=1;i<t.nodes.length;i++){if(e=t.nodes[i].y,e!==n)if(e>n)switch(o){case 0:case 1:o=1;break;default:o=3}else switch(o){case 0:case 2:o=2;break;default:o=3}if(n=e,3===o)break}switch(o){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";default:return"Varied"}},e.getDataPointer=()=>{const e=t.nodes.length;if(t.function=null,e>0){t.function=[];for(let n=0;n<e;n++)t.function[2*n]=t.nodes[n].x,t.function[2*n+1]=t.nodes[n].y}return t.function},e.getFirstNonZeroValue=()=>{if(0===t.nodes.length)return 0;let e=1,n=0,o=0;for(;o<t.nodes.length;o++)if(0!==t.nodes[o].y){e=0;break}return n=e?Number.MAX_VALUE:o>0?t.nodes[o-1].x:t.clamping?-Number.MAX_VALUE:t.nodes[0].x,n},e.getNodeValue=(e,n)=>{const o=t.nodes.length;return e<0||e>=o?(i("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].y,n[2]=t.nodes[e].midpoint,n[3]=t.nodes[e].sharpness,1)},e.setNodeValue=(n,o)=>{const a=t.nodes.length;if(n<0||n>=a)return i("Index out of range!"),-1;const r=t.nodes[n].x;return t.nodes[n].x=o[0],t.nodes[n].y=o[1],t.nodes[n].midpoint=o[2],t.nodes[n].sharpness=o[3],r!==o[0]?e.sortAndUpdateRange():e.modified(),1},e.addPoint=(t,n)=>e.addPointLong(t,n,.5,0),e.addPointLong=(n,o,a,r)=>{if(a<0||a>1)return i("Midpoint outside range [0.0, 1.0]"),-1;if(r<0||r>1)return i("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const s={x:n,y:o,midpoint:a,sharpness:r};let l;for(t.nodes.push(s),e.sortAndUpdateRange(),l=0;l<t.nodes.length&&t.nodes[l].x!==n;l++);return l<t.nodes.length?l:-1},e.setNodes=n=>{t.nodes!==n&&(t.nodes=n,e.sortAndUpdateRange())},e.sortAndUpdateRange=()=>{t.nodes.sort((e,t)=>e.x-t.x),e.updateRange()||e.modified()},e.updateRange=()=>{const n=t.range.slice(),o=t.nodes.length;return o?(t.range[0]=t.nodes[0].x,t.range[1]=t.nodes[o-1].x):(t.range[0]=0,t.range[1]=0),(n[0]!==t.range[0]||n[1]!==t.range[1])&&(e.modified(),!0)},e.removePoint=n=>{let o;for(o=0;o<t.nodes.length&&t.nodes[o].x!==n;o++);if(o>=t.nodes.length)return-1;const i=o;let a=!1;return t.nodes.splice(o,1),0!==o&&o!==t.nodes.length||(a=e.updateRange()),a||e.modified(),i},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addSegment=(n,o,i,a)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=i?t.nodes.splice(e,1):e++;e.addPoint(n,o,.5,0),e.addPoint(i,a,.5,0)},e.getValue=t=>{const n=[];return e.getTable(t,t,1,n),n[0]},e.adjustRange=n=>{if(n.length<2)return 0;const o=e.getRange();o[0]<n[0]?e.addPoint(n[0],e.getValue(n[0])):e.addPoint(n[0],e.getValue(o[0])),o[1]>n[1]?e.addPoint(n[1],e.getValue(n[1])):e.addPoint(n[1],e.getValue(o[1])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return e.sortAndUpdateRange(),1},e.estimateMinNumberOfSamples=(t,n)=>{const o=e.findMinimumXDistance();return Math.ceil((n-t)/o)},e.findMinimumXDistance=()=>{const e=t.nodes.length;if(e<2)return-1;let n=t.nodes[1].x-t.nodes[0].x;for(let o=0;o<e-1;o++){const e=t.nodes[o+1].x-t.nodes[o].x;e<n&&(n=e)}return n},e.getTable=function(e,n,o,i){let a,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=0;const l=t.nodes.length;let c=0;0!==l&&(c=t.nodes[l-1].y);let d=0,u=0,g=0,h=0,m=0,f=0,p=0;for(a=0;a<o;a++){const v=r*a;for(d=o>1?e+a/(o-1)*(n-e):.5*(e+n);s<l&&d>t.nodes[s].x;)s++,s<l&&(u=t.nodes[s-1].x,g=t.nodes[s].x,h=t.nodes[s-1].y,m=t.nodes[s].y,f=t.nodes[s-1].midpoint,p=t.nodes[s-1].sharpness,f<1e-5&&(f=1e-5),f>.99999&&(f=.99999));if(s>=l)i[v]=t.clamping?c:0;else if(0===s)i[v]=t.clamping?t.nodes[0].y:0;else{let e=(d-u)/(g-u);if(e=e<f?.5*e/f:.5+.5*(e-f)/(1-f),p>.99){if(e<.5){i[v]=h;continue}i[v]=m;continue}if(p<.01){i[v]=(1-e)*h+e*m;continue}e<.5?e=.5*(2*e)**(1+10*p):e>.5&&(e=1-.5*(2*(1-e))**(1+10*p));const t=e*e,n=t*e,o=2*n-3*t+1,a=-2*n+3*t,r=n-2*t+e,s=n-t,l=(1-p)*(m-h);i[v]=o*h+a*m+r*l+s*l;const c=h<m?h:m,w=h>m?h:m;i[v]=i[v]<c?c:i[v],i[v]=i[v]>w?w:i[v]}}}}(e,t)}var s={newInstance:o.m.newInstance(r,"vtkPiecewiseFunction"),extend:r}},60318:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>g});var o=n(68470),i=n(46576),a=n(29699),r=n(87570);const{vtkErrorMacro:s,vtkDebugMacro:l}=o.m;function c(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=n=>{t.contourValues=n,e.modified()};const n=[],o=[],c=[],d=a.Z.newInstance();e.getPixelScalars=(e,t,i,a,r,s)=>{const[l,c,d]=e;n[0]=d*t[1]*t[0]+c*t[0]+l,n[1]=n[0]+a[r],n[2]=n[0]+a[s],n[3]=n[2]+a[r];for(let e=0;e<4;++e)o[e]=i[n[e]]},e.getPixelPoints=(e,t,n,o,i)=>{const a=e[o],r=e[i];c[0]=t[o]+a*n[o],c[1]=t[i]+r*n[i],c[2]=c[0]+n[o],c[3]=c[1],c[4]=c[0],c[5]=c[1]+n[i],c[6]=c[2],c[7]=c[5]},e.produceLines=(i,a,s,l,u,g,h,m,f,p,v)=>{const w=a[t.slicingMode],I=[1,2,8,4],y=[];let E;e.getPixelScalars(a,s,g,f,p,v);let x=0;for(let e=0;e<4;e++)o[e]>=i&&(x|=I[e]);const b=r.Z.getCase(x);if(b[0]<0)return;e.getPixelPoints(a,l,u,p,v);const C=l[t.slicingMode]+w*u[t.slicingMode];for(let e=0;b[e]>=0;e+=2){m.push(2);for(let a=0;a<2;a++){const s=r.Z.getEdge(b[e+a]);if(E=void 0,t.mergePoints&&(E=d.isInsertedEdge(n[s[0]],n[s[1]])?.value),void 0===E){const e=(i-o[s[0]])/(o[s[1]]-o[s[0]]),a=c.slice(2*s[0],2*(s[0]+1)),r=c.slice(2*s[1],2*(s[1]+1));y[p]=a[0]+e*(r[0]-a[0]),y[v]=a[1]+e*(r[1]-a[1]),y[t.slicingMode]=C,E=h.length/3,h.push(y[0],y[1],y[2]),t.mergePoints&&d.insertEdge(n[s[0]],n[s[1]],E)}m.push(E)}}},e.requestData=(n,o)=>{const a=n[0];if(!a)return void s("Invalid or missing input");if(null==t.slicingMode||t.slicingMode<0||t.slicingMode>2)return void s("Invalid or missing slicing mode");console.time("msquares");const r=a.getOrigin(),c=a.getSpacing(),u=a.getDimensions(),g=a.getExtent(),h=a.computeIncrements(g),m=a.getPointData().getScalars().getData(),[f,p]=function(){let e=0,n=1;return 1===t.slicingMode?(e=0,n=2):0===t.slicingMode&&(e=1,n=2),[e,n]}(),v=[],w=[];let I=Math.round(t.slice);I>=u[t.slicingMode]&&(I=0);const y=[0,0,0];y[t.slicingMode]=I;for(let n=0;n<t.contourValues.length;++n){for(let o=0;o<u[p]-1;++o){y[p]=o;for(let o=0;o<u[f]-1;++o)y[f]=o,e.produceLines(t.contourValues[n],y,u,r,c,m,v,w,h,f,p)}d.initialize()}const E=i.ZP.newInstance();E.getPoints().setData(new Float32Array(v),3),E.getLines().setData(new Uint32Array(w)),o[0]=E,l("Produced output"),console.timeEnd("msquares")}}const d={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,d,n),o.m.obj(e,t),o.m.algo(e,t,1,1),o.m.setGet(e,t,["slicingMode","slice","mergePoints"]),o.m.algo(e,t,1,1),c(e,t)}var g={newInstance:o.m.newInstance(u,"vtkImageMarchingSquares"),extend:u}},34535:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>c});var o=n(72076),i=n(68470),a=n(59474);const{vtkDebugMacro:r}=i.m;const s={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:o._E.create(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,s,n),i.m.obj(e,t),i.m.get(e,t,["distance"]),i.m.setGet(e,t,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),i.m.getArray(e,t,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),i.m.setGetArray(e,t,["clippingRange","windowCenter"],2),i.m.setGetArray(e,t,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),function(e,t){t.classHierarchy.push("vtkCamera");const n=new Float64Array(3),i=new Float64Array([0,0,-1]),s=new Float64Array([0,1,0]),l=o._E.identity(new Float64Array(16)),c=o._E.identity(new Float64Array(16)),d=new Float64Array(3),u=new Float64Array(3),g=new Float64Array(3),h=o._E.identity(new Float64Array(16)),m=o._E.identity(new Float64Array(16)),f=new Float64Array(3),p=new Float64Array(3);function v(){t.viewPlaneNormal[0]=-t.directionOfProjection[0],t.viewPlaneNormal[1]=-t.directionOfProjection[1],t.viewPlaneNormal[2]=-t.directionOfProjection[2]}e.orthogonalizeViewUp=()=>{const n=e.getViewMatrix();t.viewUp[0]=n[4],t.viewUp[1]=n[5],t.viewUp[2]=n[6],e.modified()},e.setPosition=(n,o,i)=>{n===t.position[0]&&o===t.position[1]&&i===t.position[2]||(t.position[0]=n,t.position[1]=o,t.position[2]=i,e.computeDistance(),e.modified())},e.setFocalPoint=(n,o,i)=>{n===t.focalPoint[0]&&o===t.focalPoint[1]&&i===t.focalPoint[2]||(t.focalPoint[0]=n,t.focalPoint[1]=o,t.focalPoint[2]=i,e.computeDistance(),e.modified())},e.setDistance=n=>{if(t.distance===n)return;t.distance=n,t.distance<1e-20&&(t.distance=1e-20,r("Distance is set to minimum."));const o=t.directionOfProjection;t.focalPoint[0]=t.position[0]+o[0]*t.distance,t.focalPoint[1]=t.position[1]+o[1]*t.distance,t.focalPoint[2]=t.position[2]+o[2]*t.distance,e.modified()},e.computeDistance=()=>{const e=t.focalPoint[0]-t.position[0],n=t.focalPoint[1]-t.position[1],o=t.focalPoint[2]-t.position[2];if(t.distance=Math.sqrt(e*e+n*n+o*o),t.distance<1e-20){t.distance=1e-20,r("Distance is set to minimum.");const e=t.directionOfProjection;t.focalPoint[0]=t.position[0]+e[0]*t.distance,t.focalPoint[1]=t.position[1]+e[1]*t.distance,t.focalPoint[2]=t.position[2]+e[2]*t.distance}t.directionOfProjection[0]=e/t.distance,t.directionOfProjection[1]=n/t.distance,t.directionOfProjection[2]=o/t.distance,v()},e.dolly=n=>{if(n<=0)return;const o=t.distance/n;e.setPosition(t.focalPoint[0]-o*t.directionOfProjection[0],t.focalPoint[1]-o*t.directionOfProjection[1],t.focalPoint[2]-o*t.directionOfProjection[2])},e.roll=n=>{const i=t.position,r=t.focalPoint,s=t.viewUp,l=new Float64Array([s[0],s[1],s[2],0]);o._E.identity(h);const c=new Float64Array([r[0]-i[0],r[1]-i[1],r[2]-i[2]]);o._E.rotate(h,h,(0,a.r)(n),c),o.vh.transformMat4(l,l,h),t.viewUp[0]=l[0],t.viewUp[1]=l[1],t.viewUp[2]=l[2],e.modified()},e.azimuth=n=>{const i=t.focalPoint;o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),t.viewUp),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(f,t.position,m),e.setPosition(f[0],f[1],f[2])},e.yaw=n=>{const i=t.position;o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),t.viewUp),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(p,t.focalPoint,m),e.setFocalPoint(p[0],p[1],p[2])},e.elevation=n=>{const i=t.focalPoint,r=e.getViewMatrix(),s=[-r[0],-r[1],-r[2]];o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),s),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(f,t.position,m),e.setPosition(f[0],f[1],f[2])},e.pitch=n=>{const i=t.position,r=e.getViewMatrix(),s=[r[0],r[1],r[2]];o._E.identity(m),o._E.translate(m,m,i),o._E.rotate(m,m,(0,a.r)(n),s),o._E.translate(m,m,[-i[0],-i[1],-i[2]]),o.R3.transformMat4(p,t.focalPoint,m),e.setFocalPoint(...p)},e.zoom=n=>{n<=0||(t.parallelProjection?t.parallelScale/=n:t.viewAngle/=n,e.modified())},e.translate=(n,o,i)=>{const r=[n,o,i];(0,a.k)(t.position,r,t.position),(0,a.k)(t.focalPoint,r,t.focalPoint),e.computeDistance(),e.modified()},e.applyTransform=n=>{const i=[...t.viewUp,1],a=[],r=[],s=[];i[0]+=t.position[0],i[1]+=t.position[1],i[2]+=t.position[2],o.vh.transformMat4(a,[...t.position,1],n),o.vh.transformMat4(r,[...t.focalPoint,1],n),o.vh.transformMat4(s,i,n),s[0]-=a[0],s[1]-=a[1],s[2]-=a[2],e.setPosition(...a.slice(0,3)),e.setFocalPoint(...r.slice(0,3)),e.setViewUp(...s.slice(0,3))},e.getThickness=()=>t.clippingRange[1]-t.clippingRange[0],e.setThickness=n=>{let o=n;o<1e-20&&(o=1e-20,r("Thickness is set to minimum.")),e.setClippingRange(t.clippingRange[0],t.clippingRange[0]+o)},e.setThicknessFromFocalPoint=n=>{let o=n;o<1e-20&&(o=1e-20,r("Thickness is set to minimum.")),e.setClippingRange(t.distance-o/2,t.distance+o/2)},e.setRoll=e=>{},e.getRoll=()=>{},e.setObliqueAngles=(e,t)=>{},e.getOrientation=()=>{},e.getOrientationWXYZ=()=>{},e.getFrustumPlanes=e=>{},e.getCameraLightTransformMatrix=e=>(o._E.copy(e,t.cameraLightTransform),e),e.computeCameraLightTransform=()=>{o._E.copy(l,e.getViewMatrix()),o._E.invert(l,l),o._E.fromScaling(c,[t.distance,t.distance,t.distance]),o._E.multiply(l,l,c),o._E.identity(t.cameraLightTransform),o._E.translate(t.cameraLightTransform,l,[0,0,-1])},e.deepCopy=e=>{},e.physicalOrientationToWorldDirection=e=>{const t=o.gf.fromValues(e[0],e[1],e[2],e[3]),n=o.gf.create(),i=o.gf.fromValues(0,0,1,0);return o.gf.conjugate(n,t),o.gf.multiply(i,t,i),o.gf.multiply(i,i,n),[i[0],i[1],i[2]]},e.getPhysicalToWorldMatrix=t=>{e.getWorldToPhysicalMatrix(t),o._E.invert(t,t)},e.getWorldToPhysicalMatrix=e=>{o._E.identity(e);const n=[3];(0,a.j)(t.physicalViewNorth,t.physicalViewUp,n),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[4]=t.physicalViewUp[0],e[5]=t.physicalViewUp[1],e[6]=t.physicalViewUp[2],e[8]=-t.physicalViewNorth[0],e[9]=-t.physicalViewNorth[1],e[10]=-t.physicalViewNorth[2],o._E.transpose(e,e),o.R3.set(d,1/t.physicalScale,1/t.physicalScale,1/t.physicalScale),o._E.scale(e,e,d),o._E.translate(e,e,t.physicalTranslation)},e.computeViewParametersFromViewMatrix=a=>{o._E.invert(l,a),o.R3.transformMat4(d,n,l),e.computeDistance();const r=t.distance;e.setPosition(d[0],d[1],d[2]),o.R3.transformMat4(u,i,l),o.R3.subtract(u,u,d),o.R3.normalize(u,u),e.setDirectionOfProjection(u[0],u[1],u[2]),o.R3.transformMat4(g,s,l),o.R3.subtract(g,g,d),o.R3.normalize(g,g),e.setViewUp(g[0],g[1],g[2]),e.setDistance(r)},e.computeViewParametersFromPhysicalMatrix=t=>{e.getWorldToPhysicalMatrix(l),o._E.multiply(l,t,l),e.computeViewParametersFromViewMatrix(l)},e.setViewMatrix=n=>{t.viewMatrix=n,t.viewMatrix&&(o._E.copy(l,t.viewMatrix),e.computeViewParametersFromViewMatrix(l),o._E.transpose(t.viewMatrix,t.viewMatrix))},e.getViewMatrix=()=>{if(t.viewMatrix)return t.viewMatrix;o._E.lookAt(l,t.position,t.focalPoint,t.viewUp),o._E.transpose(l,l);const e=new Float64Array(16);return o._E.copy(e,l),e},e.setProjectionMatrix=e=>{t.projectionMatrix=e},e.getProjectionMatrix=(e,n,i)=>{const r=new Float64Array(16);if(o._E.identity(r),t.projectionMatrix){const e=1/t.physicalScale;return o.R3.set(d,e,e,e),o._E.copy(r,t.projectionMatrix),o._E.scale(r,r,d),o._E.transpose(r,r),r}o._E.identity(l);const s=t.clippingRange[1]-t.clippingRange[0],c=[t.clippingRange[0]+(n+1)*s/2,t.clippingRange[0]+(i+1)*s/2];if(t.parallelProjection){const n=t.parallelScale*e,i=t.parallelScale,a=(t.windowCenter[0]-1)*n,r=(t.windowCenter[0]+1)*n,s=(t.windowCenter[1]-1)*i,d=(t.windowCenter[1]+1)*i;o._E.ortho(l,a,r,s,d,c[0],c[1]),o._E.transpose(l,l)}else{if(t.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const n=Math.tan((0,a.r)(t.viewAngle)/2);let o,i;!0===t.useHorizontalViewAngle?(o=t.clippingRange[0]*n,i=t.clippingRange[0]*n/e):(o=t.clippingRange[0]*n*e,i=t.clippingRange[0]*n);const r=(t.windowCenter[0]-1)*o,s=(t.windowCenter[0]+1)*o,d=(t.windowCenter[1]-1)*i,u=(t.windowCenter[1]+1)*i,g=c[0],h=c[1];l[0]=2*g/(s-r),l[5]=2*g/(u-d),l[2]=(r+s)/(s-r),l[6]=(d+u)/(u-d),l[10]=-(g+h)/(h-g),l[14]=-1,l[11]=-2*g*h/(h-g),l[15]=0}}return o._E.copy(r,l),r},e.getCompositeProjectionMatrix=(t,n,i)=>{const a=e.getViewMatrix(),r=e.getProjectionMatrix(t,n,i);return o._E.multiply(r,a,r),r},e.setDirectionOfProjection=(e,n,o)=>{if(t.directionOfProjection[0]===e&&t.directionOfProjection[1]===n&&t.directionOfProjection[2]===o)return;t.directionOfProjection[0]=e,t.directionOfProjection[1]=n,t.directionOfProjection[2]=o;const i=t.directionOfProjection;t.focalPoint[0]=t.position[0]+i[0]*t.distance,t.focalPoint[1]=t.position[1]+i[1]*t.distance,t.focalPoint[2]=t.position[2]+i[2]*t.distance,v()},e.setDeviceAngles=(n,i,r,s)=>{const l=[3];(0,a.j)(t.physicalViewNorth,t.physicalViewUp,l);const c=o._E.identity(new Float64Array(16));o._E.rotate(c,c,(0,a.r)(n),t.physicalViewUp),o._E.rotate(c,c,(0,a.r)(i),l),o._E.rotate(c,c,(0,a.r)(r),t.physicalViewNorth),o._E.rotate(c,c,(0,a.r)(-s),t.physicalViewUp);const d=new Float64Array([-t.physicalViewUp[0],-t.physicalViewUp[1],-t.physicalViewUp[2]]),u=new Float64Array(t.physicalViewNorth);o.R3.transformMat4(d,d,c),o.R3.transformMat4(u,u,c),e.setDirectionOfProjection(d[0],d[1],d[2]),e.setViewUp(u[0],u[1],u[2]),e.modified()},e.setOrientationWXYZ=(t,n,i,r)=>{const s=o._E.identity(new Float64Array(16));if(0!==t&&(0!==n||0!==i||0!==r)){const e=(0,a.r)(t),l=o.gf.create();o.gf.setAxisAngle(l,[n,i,r],e),o._E.fromQuat(s,l)}const l=new Float64Array(3);o.R3.transformMat4(l,[0,0,-1],s);const c=new Float64Array(3);o.R3.transformMat4(c,[0,1,0],s),e.setDirectionOfProjection(...l),e.setViewUp(...c),e.modified()},e.computeClippingRange=e=>{let n=null,o=null;n=t.viewPlaneNormal,o=t.position;const i=-n[0],a=-n[1],r=-n[2],s=-(i*o[0]+a*o[1]+r*o[2]),l=[i*e[0]+a*e[2]+r*e[4]+s,1e-18];for(let t=0;t<2;t++)for(let n=0;n<2;n++)for(let o=0;o<2;o++){const c=i*e[o]+a*e[2+n]+r*e[4+t]+s;l[0]=c<l[0]?c:l[0],l[1]=c>l[1]?c:l[1]}return l}}(e,t)}var c={newInstance:i.m.newInstance(l,"vtkCamera"),extend:l}},5193:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>w});var o=n(68470),i=n(59474),a=n(4666),r=n(48858);const{ColorSpace:s,Scale:l}=r.default,{ScalarMappingTarget:c}=a.default,{vtkDebugMacro:d,vtkErrorMacro:u,vtkWarningMacro:g}=o.m;function h(e,t){const n=e[0],o=e[1],i=e[2],a=Math.sqrt(n*n+o*o+i*i),r=a>.001?Math.acos(n/a):0,s=r>.001?Math.atan2(i,o):0;t[0]=a,t[1]=r,t[2]=s}function m(e,t){if(e[0]>=t-.1)return e[2];const n=e[1]*Math.sqrt(t*t-e[0]*e[0])/(e[0]*Math.sin(e[1]));return e[2]>-.3*Math.PI?e[2]+n:e[2]-n}function f(e,t,n,o){const a=[],r=[];(0,i.M)(t,a),(0,i.M)(n,r);const s=[],l=[];h(a,s),h(r,l);let c=e;if(s[1]>.05&&l[1]>.05&&function(e,t){let n=e-t;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}(s[2],l[2])>.33*Math.PI){let t=Math.max(s[0],l[0]);t=Math.max(88,t),e<.5?(l[0]=t,l[1]=0,l[2]=0,c*=2):(s[0]=t,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&l[1]>.05?s[2]=m(l,s[0]):l[1]<.05&&s[1]>.05&&(l[2]=m(s,l[0]));const d=[];d[0]=(1-c)*s[0]+c*l[0],d[1]=(1-c)*s[1]+c*l[1],d[2]=(1-c)*s[2]+c*l[2];const u=[];!function(e,t){const n=e[0],o=e[1],i=e[2];t[0]=n*Math.cos(o),t[1]=n*Math.sin(o)*Math.cos(i),t[2]=n*Math.sin(o)*Math.sin(i)}(d,u),(0,i.N)(u,o)}const p={clamping:!0,colorSpace:s.RGB,hSVWrap:!0,scale:l.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,p,n),a.default.extend(e,t,n),t.table=[],t.nodes=[],t.nanColor=[.5,0,0,1],t.belowRangeColor=[0,0,0,1],t.aboveRangeColor=[1,1,1,1],t.buildTime={},o.m.obj(t.buildTime),o.m.get(e,t,["buildTime","mappingRange"]),o.m.setGet(e,t,["useAboveRangeColor","useBelowRangeColor","colorSpace","discretize","numberOfValues"]),o.m.setArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"],4),o.m.getArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"]),function(e,t){t.classHierarchy.push("vtkColorTransferFunction"),e.getSize=()=>t.nodes.length,e.addRGBPoint=(t,n,o,i)=>e.addRGBPointLong(t,n,o,i,.5,0),e.addRGBPointLong=function(n,o,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(r<0||r>1)return u("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return u("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const l={x:n,r:o,g:i,b:a,midpoint:r,sharpness:s};t.nodes.push(l),e.sortAndUpdateRange();let c=0;for(;c<t.nodes.length&&t.nodes[c].x!==n;c++);return c<t.nodes.length?c:-1},e.addHSVPoint=(t,n,o,i)=>e.addHSVPointLong(t,n,o,i,.5,0),e.addHSVPointLong=function(t,n,o,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=[],c=[n,o,a];return(0,i.h)(c,l),e.addRGBPoint(t,l[0],l[1],l[2],r,s)},e.setNodes=n=>{if(t.nodes!==n){const o=JSON.stringify(t.nodes);t.nodes=n;const i=JSON.stringify(t.nodes);if(e.sortAndUpdateRange()||o!==i)return e.modified(),!0}return!1},e.sortAndUpdateRange=()=>{const n=JSON.stringify(t.nodes);t.nodes.sort((e,t)=>e.x-t.x);const o=JSON.stringify(t.nodes),i=e.updateRange();return i||n===o?i:(e.modified(),!0)},e.updateRange=()=>{const n=[2];n[0]=t.mappingRange[0],n[1]=t.mappingRange[1];const o=t.nodes.length;return o?(t.mappingRange[0]=t.nodes[0].x,t.mappingRange[1]=t.nodes[o-1].x):(t.mappingRange[0]=0,t.mappingRange[1]=0),(n[0]!==t.mappingRange[0]||n[1]!==t.mappingRange[1])&&(e.modified(),!0)},e.removePoint=n=>{let o=0;for(;o<t.nodes.length&&t.nodes[o].x!==n;o++);const i=o;if(o>=t.nodes.length)return-1;let a=!1;return t.nodes.splice(o,1),0!==o&&o!==t.nodes.length||(a=e.updateRange()),a||e.modified(),i},e.movePoint=(n,o)=>{if(n!==o){e.removePoint(o);for(let i=0;i<t.nodes.length;i++)if(t.nodes[i].x===n){t.nodes[i].x=o,e.sortAndUpdateRange();break}}},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addRGBSegment=(n,o,i,a,r,s,l,c)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=r?t.nodes.splice(e,1):e++;e.addRGBPointLong(n,o,i,a,.5,0),e.addRGBPointLong(r,s,l,c,.5,0),e.modified()},e.addHSVSegment=(t,n,o,a,r,s,l,c)=>{const d=[n,o,a],u=[s,l,c],g=[],h=[];(0,i.h)(d,g),(0,i.h)(u,h),e.addRGBSegment(t,g[0],g[1],g[2],r,h[0],h[1],h[2])},e.mapValue=t=>{const n=[];return e.getColor(t,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},e.getColor=(n,o)=>{if(t.indexedLookup){const t=e.getSize(),i=e.getAnnotatedValueIndexInternal(n);if(i<0||0===t){const t=e.getNanColorByReference();o[0]=t[0],o[1]=t[1],o[2]=t[2]}else{const n=[];e.getNodeValue(i%t,n),o[0]=n[1],o[1]=n[2],o[2]=n[3]}return}e.getTable(n,n,1,o)},e.getRedValue=t=>{const n=[];return e.getColor(t,n),n[0]},e.getGreenValue=t=>{const n=[];return e.getColor(t,n),n[1]},e.getBlueValue=t=>{const n=[];return e.getColor(t,n),n[2]},e.getTable=(n,o,a,r)=>{const c=Number(n),d=Number(o);if((0,i.i)(c)||(0,i.i)(d)){for(let e=0;e<a;e++)r[3*e+0]=t.nanColor[0],r[3*e+1]=t.nanColor[1],r[3*e+2]=t.nanColor[2];return}let g=0;const h=t.nodes.length;let m=0,p=0,v=0;0!==h&&(m=t.nodes[h-1].r,p=t.nodes[h-1].g,v=t.nodes[h-1].b);let w=0,I=0,y=0;const E=[0,0,0],x=[0,0,0];let b=0,C=0;const S=[];let T=t.scale===l.LOG10;T&&(T=t.mappingRange[0]>0);let M=0,R=0,P=0;T&&(M=Math.log10(c),R=Math.log10(d));for(let n=0;n<a;n++){const o=3*n;if(a>1?T?(P=M+n/(a-1)*(R-M),w=10**P):w=c+n/(a-1)*(d-c):T?(P=.5*(M+R),w=10**P):w=.5*(c+d),t.discretize){const e=t.mappingRange;if(w>=e[0]&&w<=e[1]){const n=t.numberOfValues,o=e[1]-e[0];if(n<=1)w=e[0]+o/2;else{const t=(w-e[0])/o,a=(0,i.J)(n*t);w=e[0]+a/(n-1)*o}}}for(;g<h&&w>t.nodes[g].x;)g++,g<h&&(I=t.nodes[g-1].x,y=t.nodes[g].x,T&&(I=Math.log10(I),y=Math.log10(y)),E[0]=t.nodes[g-1].r,x[0]=t.nodes[g].r,E[1]=t.nodes[g-1].g,x[1]=t.nodes[g].g,E[2]=t.nodes[g-1].b,x[2]=t.nodes[g].b,b=t.nodes[g-1].midpoint,C=t.nodes[g-1].sharpness,b<1e-5&&(b=1e-5),b>.99999&&(b=.99999));if(w>t.mappingRange[1])r[o]=0,r[o+1]=0,r[o+2]=0,t.clamping&&(e.getUseAboveRangeColor()?(r[o]=t.aboveRangeColor[0],r[o+1]=t.aboveRangeColor[1],r[o+2]=t.aboveRangeColor[2]):(r[o]=m,r[o+1]=p,r[o+2]=v));else if(w<t.mappingRange[0]||(0,i.K)(w)&&w<0)r[o]=0,r[o+1]=0,r[o+2]=0,t.clamping&&(e.getUseBelowRangeColor()?(r[o]=t.belowRangeColor[0],r[o+1]=t.belowRangeColor[1],r[o+2]=t.belowRangeColor[2]):h>0&&(r[o]=t.nodes[0].r,r[o+1]=t.nodes[0].g,r[o+2]=t.nodes[0].b));else if(0===g&&(Math.abs(w-c)<1e-6||t.discretize))h>0?(r[o]=t.nodes[0].r,r[o+1]=t.nodes[0].g,r[o+2]=t.nodes[0].b):(r[o]=0,r[o+1]=0,r[o+2]=0);else{let e=0;if(e=T?(P-I)/(y-I):(w-I)/(y-I),e=e<b?.5*e/b:.5+.5*(e-b)/(1-b),C>.99){if(e<.5){r[o]=E[0],r[o+1]=E[1],r[o+2]=E[2];continue}r[o]=x[0],r[o+1]=x[1],r[o+2]=x[2];continue}if(C<.01){if(t.colorSpace===s.RGB)r[o]=(1-e)*E[0]+e*x[0],r[o+1]=(1-e)*E[1]+e*x[1],r[o+2]=(1-e)*E[2]+e*x[2];else if(t.colorSpace===s.HSV){const n=[],a=[];(0,i.L)(E,n),(0,i.L)(x,a),t.hSVWrap&&(n[0]-a[0]>.5||a[0]-n[0]>.5)&&(n[0]>a[0]?n[0]-=1:a[0]-=1);const s=[];s[0]=(1-e)*n[0]+e*a[0],s[0]<0&&(s[0]+=1),s[1]=(1-e)*n[1]+e*a[1],s[2]=(1-e)*n[2]+e*a[2],(0,i.h)(s,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else if(t.colorSpace===s.LAB){const t=[],n=[];(0,i.M)(E,t),(0,i.M)(x,n);const a=[];a[0]=(1-e)*t[0]+e*n[0],a[1]=(1-e)*t[1]+e*n[1],a[2]=(1-e)*t[2]+e*n[2],(0,i.N)(a,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else t.colorSpace===s.DIVERGING?(f(e,E,x,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]):u("ColorSpace set to invalid value.",t.colorSpace);continue}e<.5?e=.5*(2*e)**(1+10*C):e>.5&&(e=1-.5*(2*(1-e))**(1+10*C));const n=e*e,a=n*e,l=2*a-3*n+1,c=-2*a+3*n,d=a-2*n+e,g=a-n;let h,m;if(t.colorSpace===s.RGB)for(let e=0;e<3;e++)h=x[e]-E[e],m=(1-C)*h,r[o+e]=l*E[e]+c*x[e]+d*m+g*m;else if(t.colorSpace===s.HSV){const e=[],n=[];(0,i.L)(E,e),(0,i.L)(x,n),t.hSVWrap&&(e[0]-n[0]>.5||n[0]-e[0]>.5)&&(e[0]>n[0]?e[0]-=1:n[0]-=1);const a=[];for(let t=0;t<3;t++)h=n[t]-e[t],m=(1-C)*h,a[t]=l*e[t]+c*n[t]+d*m+g*m,0===t&&a[t]<0&&(a[t]+=1);(0,i.h)(a,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else if(t.colorSpace===s.LAB){const e=[],t=[];(0,i.M)(E,e),(0,i.M)(x,t);const n=[];for(let o=0;o<3;o++)h=t[o]-e[o],m=(1-C)*h,n[o]=l*e[o]+c*t[o]+d*m+g*m;(0,i.N)(n,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]}else t.colorSpace===s.DIVERGING?(f(e,E,x,S),r[o]=S[0],r[o+1]=S[1],r[o+2]=S[2]):u("ColorSpace set to invalid value.");for(let e=0;e<3;e++)r[o+e]=r[o+e]<0?0:r[o+e],r[o+e]=r[o+e]>1?1:r[o+e]}}},e.getUint8Table=function(n,o,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.getMTime()<=t.buildTime&&t.tableSize===i&&t.tableWithAlpha!==a)return t.table;if(0===t.nodes.length)return u("Attempting to lookup a value with no points in the function"),t.table;const r=a?4:3;t.tableSize===i&&t.tableWithAlpha===a||(t.table=new Uint8Array(i*r),t.tableSize=i,t.tableWithAlpha=a);const s=[];e.getTable(n,o,i,s);for(let e=0;e<i;e++)t.table[e*r+0]=Math.floor(255*s[3*e+0]+.5),t.table[e*r+1]=Math.floor(255*s[3*e+1]+.5),t.table[e*r+2]=Math.floor(255*s[3*e+2]+.5),a&&(t.table[e*r+3]=255);return t.buildTime.modified(),t.table},e.buildFunctionFromArray=n=>{e.removeAllPoints();const o=n.getNumberOfComponents();for(let e=0;e<n.getNumberOfTuples();e++)switch(o){case 3:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:.5,sharpness:0});break;case 4:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:.5,sharpness:0});break;case 5:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)});break;case 6:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)})}e.sortAndUpdateRange()},e.buildFunctionFromTable=(n,o,i,a)=>{let r=0;e.removeAllPoints(),i>1&&(r=(o-n)/(i-1));for(let e=0;e<i;e++){const o={x:n+r*e,r:a[3*e],g:a[3*e+1],b:a[3*e+2],sharpness:0,midpoint:.5};t.nodes.push(o)}e.sortAndUpdateRange()},e.getNodeValue=(e,n)=>e<0||e>=t.nodes.length?(u("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].r,n[2]=t.nodes[e].g,n[3]=t.nodes[e].b,n[4]=t.nodes[e].midpoint,n[5]=t.nodes[e].sharpness,1),e.setNodeValue=(n,o)=>{if(n<0||n>=t.nodes.length)return u("Index out of range!"),-1;const i=t.nodes[n].x;return t.nodes[n].x=o[0],t.nodes[n].r=o[1],t.nodes[n].g=o[2],t.nodes[n].b=o[3],t.nodes[n].midpoint=o[4],t.nodes[n].sharpness=o[5],i!==o[0]?e.sortAndUpdateRange():e.modified(),1},e.getNumberOfAvailableColors=()=>t.indexedLookup&&e.getSize()?e.getSize():t.tableSize?t.tableSize:16777216,e.getIndexedColor=(t,n)=>{const o=e.getSize();if(o>0&&t>=0){const i=[];e.getNodeValue(t%o,i);for(let e=0;e<3;++e)n[e]=i[e+1];return void(n[3]=1)}const i=e.getNanColorByReference();n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1},e.fillFromDataPointer=(t,n)=>{if(!(t<=0)&&n){e.removeAllPoints();for(let o=0;o<t;o++)e.addRGBPoint(n[4*o],n[4*o+1],n[4*o+2],n[4*o+3])}},e.setMappingRange=(n,o)=>{const i=[n,o],a=e.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0])return void u("attempt to set zero width color range");const r=(i[1]-i[0])/(a[1]-a[0]),s=i[0]-a[0]*r;for(let e=0;e<t.nodes.length;++e)t.nodes[e].x=t.nodes[e].x*r+s;t.mappingRange[0]=i[0],t.mappingRange[1]=i[1],e.modified()},e.adjustRange=n=>{const o=e.getRange(),i=[];o[0]<n[0]?(e.getColor(n[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])):(e.getColor(o[0],i),e.addRGBPoint(n[0],i[0],i[1],i[2])),o[1]>n[1]?(e.getColor(n[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])):(e.getColor(o[1],i),e.addRGBPoint(n[1],i[0],i[1],i[2])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return 1},e.estimateMinNumberOfSamples=(t,n)=>{const o=e.findMinimumXDistance();return Math.ceil((n-t)/o)},e.findMinimumXDistance=()=>{if(t.nodes.length<2)return-1;let e=Number.MAX_VALUE;for(let n=0;n<t.nodes.length-1;n++){const o=t.nodes[n+1].x-t.nodes[n].x;o<e&&(e=o)}return e},e.mapScalarsThroughTable=(n,o,i,a)=>{0!==e.getSize()?t.indexedLookup?e.mapDataIndexed(n,o,i,a):e.mapData(n,o,i,a):d("Transfer Function Has No Points!")},e.mapData=(t,n,o,i)=>{if(0===e.getSize())return void g("Transfer Function Has No Points!");const a=Math.floor(255*e.getAlpha()+.5),r=t.getNumberOfTuples(),s=t.getNumberOfComponents(),l=n.getData(),d=t.getData(),u=[];if(o===c.RGBA)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[4*t]=Math.floor(255*u[0]+.5),l[4*t+1]=Math.floor(255*u[1]+.5),l[4*t+2]=Math.floor(255*u[2]+.5),l[4*t+3]=a}if(o===c.RGB)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[3*t]=Math.floor(255*u[0]+.5),l[3*t+1]=Math.floor(255*u[1]+.5),l[3*t+2]=Math.floor(255*u[2]+.5)}if(o===c.LUMINANCE)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[t]=Math.floor(76.5*u[0]+150.45*u[1]+28.05*u[2]+.5)}if(o===c.LUMINANCE_ALPHA)for(let t=0;t<r;t++){const n=d[t*s+i];e.getColor(n,u),l[2*t]=Math.floor(76.5*u[0]+150.45*u[1]+28.05*u[2]+.5),l[2*t+1]=a}},e.applyColorMap=n=>{const o=JSON.stringify(t.colorSpace);n.ColorSpace&&(t.colorSpace=s[n.ColorSpace.toUpperCase()],void 0===t.colorSpace&&(u(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),t.colorSpace=s.RGB));let i=o!==JSON.stringify(t.colorSpace);const a=i||JSON.stringify(t.nanColor);if(n.NanColor)for(t.nanColor=[].concat(n.NanColor);t.nanColor.length<4;)t.nanColor.push(1);i=i||a!==JSON.stringify(t.nanColor);const r=i||JSON.stringify(t.nodes);if(n.RGBPoints){const e=n.RGBPoints.length;t.nodes=[];const o=.5,i=0;for(let a=0;a<e;a+=4)t.nodes.push({x:n.RGBPoints[a],r:n.RGBPoints[a+1],g:n.RGBPoints[a+2],b:n.RGBPoints[a+3],midpoint:o,sharpness:i})}const l=e.sortAndUpdateRange(),c=!l&&(i||r!==JSON.stringify(t.nodes));return c&&e.modified(),l||c}}(e,t)}var w={newInstance:o.m.newInstance(v,"vtkColorTransferFunction"),extend:v,...r.default}},31239:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(40188);const i=Object.create(null);o.v.filter(e=>e.RGBPoints).filter(e=>"CIELAB"!==e.ColorSpace).forEach(e=>{i[e.Name]=e});const a=Object.keys(i);a.sort();var r={addPreset:function(e){e.RGBPoints&&"CIELAB"!==e.ColorSpace&&(i[e.Name]||(a.push(e.Name),a.sort()),i[e.Name]=e)},removePresetByName:function(e){const t=a.indexOf(e);t>-1&&a.splice(t,1),delete i[e]},getPresetByName:function(e){return i[e]},rgbPresetNames:a}},78639:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>m});var o=n(72795),i=n(68470),a=n(93751),r=n(68649),s=n(59474),l=n(84418);const{staticOffsetAPI:c,otherStaticMethods:d}=l.default,{SlicingMode:u}=o.default;const g={slicingMode:u.NONE,closestIJKAxis:{ijkMode:u.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,g,n),a.Z.extend(e,t,n),i.m.get(e,t,["slicingMode"]),i.m.setGet(e,t,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),l.default.implementCoincidentTopologyMethods(e,t),function(e,t){function n(){let n;switch(t.slicingMode){case u.X:n=0;break;case u.Y:n=1;break;case u.Z:n=2;break;default:return void(t.closestIJKAxis={ijkMode:t.slicingMode,flip:!1})}const o=e.getCurrentImage().getDirection(),i=(0,s.S)(o);let a=0;for(;a<3&&0===i[n+3*a];++a);const r=i[n+3*a]<0;t.closestIJKAxis={ijkMode:a,flip:r}}t.classHierarchy.push("vtkImageMapper"),e.getSliceAtPosition=n=>{const o=e.getCurrentImage();let i;if(3===n.length)i=n;else if(Number.isFinite(n)){const e=o.getBounds();switch(t.slicingMode){case u.X:i=[n,(e[3]+e[2])/2,(e[5]+e[4])/2];break;case u.Y:i=[(e[1]+e[0])/2,n,(e[5]+e[4])/2];break;case u.Z:i=[(e[1]+e[0])/2,(e[3]+e[2])/2,n]}}const a=[0,0,0];o.worldToIndex(i,a);const r=o.getExtent(),{ijkMode:l}=e.getClosestIJKAxis();let c=0;switch(l){case u.I:c=(0,s.C)(a[0],r[0],r[1]);break;case u.J:c=(0,s.C)(a[1],r[2],r[3]);break;case u.K:c=(0,s.C)(a[2],r[4],r[5]);break;default:return 0}return c},e.setSliceFromCamera=n=>{const o=n.getFocalPoint();switch(t.slicingMode){case u.I:case u.J:case u.K:{const t=e.getSliceAtPosition(o);e.setSlice(t)}break;case u.X:e.setSlice(o[0]);break;case u.Y:e.setSlice(o[1]);break;case u.Z:e.setSlice(o[2])}},e.setXSlice=t=>{e.setSlicingMode(u.X),e.setSlice(t)},e.setYSlice=t=>{e.setSlicingMode(u.Y),e.setSlice(t)},e.setZSlice=t=>{e.setSlicingMode(u.Z),e.setSlice(t)},e.setISlice=t=>{e.setSlicingMode(u.I),e.setSlice(t)},e.setJSlice=t=>{e.setSlicingMode(u.J),e.setSlice(t)},e.setKSlice=t=>{e.setSlicingMode(u.K),e.setSlice(t)},e.getSlicingModeNormal=()=>{const n=[0,0,0],o=e.getCurrentImage().getDirection();switch(t.slicingMode){case u.X:n[0]=1;break;case u.Y:n[1]=1;break;case u.Z:n[2]=1;break;case u.I:(0,s.R)(o,[1,0,0],n);break;case u.J:(0,s.R)(o,[0,1,0],n);break;case u.K:(0,s.R)(o,[0,0,1],n)}return n},e.setSlicingMode=o=>{t.slicingMode!==o&&(t.slicingMode=o,e.getCurrentImage()&&n(),e.modified())},e.getClosestIJKAxis=()=>(void 0!==t.closestIJKAxis&&t.closestIJKAxis.ijkMode!==u.NONE||!e.getCurrentImage()||n(),t.closestIJKAxis),e.getBounds=()=>{const n=e.getCurrentImage();if(!n)return(0,s.F)();if(!t.useCustomExtents)return n.getBounds();const o=t.customDisplayExtent.slice(),{ijkMode:i}=e.getClosestIJKAxis();let a=t.slice;switch(i!==t.slicingMode&&(a=e.getSliceAtPosition(t.slice)),i){case u.I:o[0]=a,o[1]=a;break;case u.J:o[2]=a,o[3]=a;break;case u.K:o[4]=a,o[5]=a}return n.extentToBounds(o)},e.getBoundsForSlice=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.slice,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getCurrentImage();if(!i)return(0,s.F)();const a=i.getSpatialExtent(),{ijkMode:r}=e.getClosestIJKAxis();let l=n;switch(r!==t.slicingMode&&(l=e.getSliceAtPosition(n)),r){case u.I:a[0]=l-o,a[1]=l+o;break;case u.J:a[2]=l-o,a[3]=l+o;break;case u.K:a[4]=l-o,a[5]=l+o}return i.extentToBounds(a)},e.intersectWithLineForPointPicking=(t,n)=>(0,r.U)(t,n,e),e.intersectWithLineForCellPicking=(t,n)=>(0,r.L)(t,n,e),e.getCurrentImage=()=>e.getInputData()}(e,t)}var m={newInstance:i.m.newInstance(h,"vtkImageMapper"),extend:h,...c,...d,...o.default}},7965:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var o=n(72076),i=n(68470),a=n(91382),r=n(49445),s=n(1408);const{vtkDebugMacro:l}=i.m;const c={mapper:null,property:null,bounds:[...a.ZP.INIT_BOUNDS]};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),r.ZP.extend(e,t,n),t.boundsMTime={},i.m.obj(t.boundsMTime),i.m.set(e,t,["property"]),i.m.setGet(e,t,["mapper"]),i.m.getArray(e,t,["bounds"],6),function(e,t){t.classHierarchy.push("vtkImageSlice"),e.getActors=()=>e,e.getImages=()=>e,e.getIsOpaque=()=>{if(t.forceOpaque)return!0;if(t.forceTranslucent)return!1;t.property||e.getProperty();let n=t.property.getOpacity()>=1;return n=n&&(!t.mapper||t.mapper.getIsOpaque()),n},e.hasTranslucentPolygonalGeometry=()=>!1,e.makeProperty=s.ZP.newInstance,e.getProperty=()=>(null===t.property&&(t.property=e.makeProperty()),t.property),e.getBounds=()=>{if(null===t.mapper)return t.bounds;const n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;if(!t.mapperBounds||!(i=[n,t.mapperBounds],i[0].map((e,t)=>i.map(e=>e[t]))).reduce((e,t)=>e&&t[0]===t[1],!0)||e.getMTime()>t.boundsMTime.getMTime()){l("Recomputing bounds..."),t.mapperBounds=n.map(e=>e),e.computeMatrix();const i=new Float64Array(16);o._E.transpose(i,t.matrix),a.ZP.transformBounds(n,i,t.bounds),t.boundsMTime.modified()}var i;return t.bounds},e.getBoundsForSlice=(n,i)=>{const r=t.mapper.getBoundsForSlice(n,i);if(!a.ZP.isValid(r))return r;e.computeMatrix();const s=new Float64Array(16);return o._E.transpose(s,t.matrix),a.ZP.transformBounds(r,s)},e.getMinXBound=()=>e.getBounds()[0],e.getMaxXBound=()=>e.getBounds()[1],e.getMinYBound=()=>e.getBounds()[2],e.getMaxYBound=()=>e.getBounds()[3],e.getMinZBound=()=>e.getBounds()[4],e.getMaxZBound=()=>e.getBounds()[5],e.getMTime=()=>{let e=t.mtime;if(null!==t.property){const n=t.property.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=()=>{let e=t.mtime;if(null!==t.mapper){let n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}if(null!==t.property){let n=t.property.getMTime();e=n>e?n:e,null!==t.property.getRGBTransferFunction()&&(n=t.property.getRGBTransferFunction().getMTime(),e=n>e?n:e)}return e},e.getSupportsSelection=()=>!!t.mapper&&t.mapper.getSupportsSelection()}(e,t)}var u={newInstance:i.m.newInstance(d,"vtkImageSlice"),extend:d}},52601:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u});var o=n(72076),i=n(68470),a=n(91382),r=n(49445),s=n(6123);const{vtkDebugMacro:l}=i.m;const c={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,c,n),r.ZP.extend(e,t,n),t.boundsMTime={},i.m.obj(t.boundsMTime),i.m.set(e,t,["property"]),i.m.setGet(e,t,["mapper"]),i.m.getArray(e,t,["bounds"],6),function(e,t){t.classHierarchy.push("vtkVolume"),e.getVolumes=()=>e,e.makeProperty=s.ZP.newInstance,e.getProperty=()=>(null===t.property&&(t.property=e.makeProperty()),t.property),e.getBounds=()=>{if(null===t.mapper)return t.bounds;const n=t.mapper.getBounds();if(!n||6!==n.length)return n;if(n[0]>n[1])return t.mapperBounds=n.concat(),t.bounds=[1,-1,1,-1,1,-1],t.boundsMTime.modified(),n;if(!t.mapperBounds||!(i=[n,t.mapperBounds],i[0].map((e,t)=>i.map(e=>e[t]))).reduce((e,t)=>e&&t[0]===t[1],!0)||e.getMTime()>t.boundsMTime.getMTime()){l("Recomputing bounds..."),t.mapperBounds=n.map(e=>e);const i=[];a.ZP.getCorners(n,i),e.computeMatrix();const r=new Float64Array(16);o._E.transpose(r,t.matrix),i.forEach(e=>o.R3.transformMat4(e,e,r)),t.bounds[0]=t.bounds[2]=t.bounds[4]=Number.MAX_VALUE,t.bounds[1]=t.bounds[3]=t.bounds[5]=-Number.MAX_VALUE,t.bounds=t.bounds.map((e,t)=>t%2==0?i.reduce((e,n)=>e>n[t/2]?n[t/2]:e,e):i.reduce((e,n)=>e<n[(t-1)/2]?n[(t-1)/2]:e,e)),t.boundsMTime.modified()}var i;return t.bounds},e.getMTime=()=>{let e=t.mtime;if(null!==t.property){const n=t.property.getMTime();e=n>e?n:e}return e},e.getRedrawMTime=()=>{let e=t.mtime;if(null!==t.mapper){let n=t.mapper.getMTime();e=n>e?n:e,null!==t.mapper.getInput()&&(t.mapper.getInputAlgorithm().update(),n=t.mapper.getInput().getMTime(),e=n>e?n:e)}return e}}(e,t)}var u={newInstance:i.m.newInstance(d,"vtkVolume"),extend:d}},20346:(e,t,n)=>{var o="__lodash_hash_undefined__",i="[object Function]",a="[object GeneratorFunction]",r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/,l=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,d=/\\(\\)?/g,u=/^\[object .+?Constructor\]$/,g="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,h="object"==typeof self&&self&&self.Object===Object&&self,m=g||h||Function("return this")();var f,p=Array.prototype,v=Function.prototype,w=Object.prototype,I=m["__core-js_shared__"],y=(f=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||""))?"Symbol(src)_1."+f:"",E=v.toString,x=w.hasOwnProperty,b=w.toString,C=RegExp("^"+E.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=m.Symbol,T=p.splice,M=B(m,"Map"),R=B(Object,"create"),P=S?S.prototype:void 0,_=P?P.toString:void 0;function A(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function D(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function O(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function V(e,t){for(var n=e.length;n--;)if(q(e[n][0],t))return n;return-1}function L(e,t){var n;t=function(e,t){if(W(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||z(e))return!0;return s.test(e)||!r.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:W(n=t)?n:U(n);for(var o=0,i=t.length;null!=e&&o<i;)e=e[Z(t[o++])];return o&&o==i?e:void 0}function N(e){if(!j(e)||(t=e,y&&y in t))return!1;var t,n=function(e){var t=j(e)?b.call(e):"";return t==i||t==a}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?C:u;return n.test(function(e){if(null!=e){try{return E.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function k(e,t){var n,o,i=e.__data__;return("string"==(o=typeof(n=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function B(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return N(n)?n:void 0}A.prototype.clear=function(){this.__data__=R?R(null):{}},A.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},A.prototype.get=function(e){var t=this.__data__;if(R){var n=t[e];return n===o?void 0:n}return x.call(t,e)?t[e]:void 0},A.prototype.has=function(e){var t=this.__data__;return R?void 0!==t[e]:x.call(t,e)},A.prototype.set=function(e,t){return this.__data__[e]=R&&void 0===t?o:t,this},D.prototype.clear=function(){this.__data__=[]},D.prototype.delete=function(e){var t=this.__data__,n=V(t,e);return!(n<0)&&(n==t.length-1?t.pop():T.call(t,n,1),!0)},D.prototype.get=function(e){var t=this.__data__,n=V(t,e);return n<0?void 0:t[n][1]},D.prototype.has=function(e){return V(this.__data__,e)>-1},D.prototype.set=function(e,t){var n=this.__data__,o=V(n,e);return o<0?n.push([e,t]):n[o][1]=t,this},O.prototype.clear=function(){this.__data__={hash:new A,map:new(M||D),string:new A}},O.prototype.delete=function(e){return k(this,e).delete(e)},O.prototype.get=function(e){return k(this,e).get(e)},O.prototype.has=function(e){return k(this,e).has(e)},O.prototype.set=function(e,t){return k(this,e).set(e,t),this};var U=F(function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(z(e))return _?_.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var n=[];return l.test(e)&&n.push(""),e.replace(c,function(e,t,o,i){n.push(o?i.replace(d,"$1"):t||e)}),n});function Z(e){if("string"==typeof e||z(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function F(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var o=arguments,i=t?t.apply(this,o):o[0],a=n.cache;if(a.has(i))return a.get(i);var r=e.apply(this,o);return n.cache=a.set(i,r),r};return n.cache=new(F.Cache||O),n}function q(e,t){return e===t||e!=e&&t!=t}F.Cache=O;var W=Array.isArray;function j(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function z(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==b.call(e)}e.exports=function(e,t,n){var o=null==e?void 0:L(e,t);return void 0===o?n:o}},28635:(e,t,n)=>{"use strict";n.d(t,{Jj:()=>d,Ud:()=>g,Yy:()=>a,sj:()=>y});const o=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=new Map([["proxy",{canHandle:e=>l(e)&&e[o],serialize(e){const{port1:t,port2:n}=new MessageChannel;return d(e,t),[n,[n]]},deserialize:e=>(e.start(),g(e))}],["throw",{canHandle:e=>l(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function d(e,t=globalThis,n=["*"]){t.addEventListener("message",function o(i){if(!i||!i.data)return;if(!function(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,i.origin))return void console.warn(`Invalid origin '${i.origin}' for comlink proxy`);const{id:a,type:l,path:c}=Object.assign({path:[]},i.data),g=(i.data.argumentList||[]).map(x);let h;try{const t=c.slice(0,-1).reduce((e,t)=>e[t],e),n=c.reduce((e,t)=>e[t],e);switch(l){case"GET":h=n;break;case"SET":t[c.slice(-1)[0]]=x(i.data.value),h=!0;break;case"APPLY":h=n.apply(t,g);break;case"CONSTRUCT":h=y(new n(...g));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;d(e,n),h=function(e,t){return I.set(e,t),e}(t,[t])}break;case"RELEASE":h=void 0;break;default:return}}catch(e){h={value:e,[s]:0}}Promise.resolve(h).catch(e=>({value:e,[s]:0})).then(n=>{const[i,s]=E(n);t.postMessage(Object.assign(Object.assign({},i),{id:a}),s),"RELEASE"===l&&(t.removeEventListener("message",o),u(t),r in e&&"function"==typeof e[r]&&e[r]())}).catch(e=>{const[n,o]=E({value:new TypeError("Unserializable return value"),[s]:0});t.postMessage(Object.assign(Object.assign({},n),{id:a}),o)})}),t.start&&t.start()}function u(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function g(e,t){const n=new Map;return e.addEventListener("message",function(e){const{data:t}=e;if(!t||!t.id)return;const o=n.get(t.id);if(o)try{o(t)}finally{n.delete(t.id)}}),v(e,n,[],t)}function h(e){if(e)throw new Error("Proxy has been released and is not useable")}function m(e){return b(e,new Map,{type:"RELEASE"}).then(()=>{u(e)})}const f=new WeakMap,p="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(f.get(e)||0)-1;f.set(e,t),0===t&&m(e)});function v(e,t,n=[],o=function(){}){let r=!1;const s=new Proxy(o,{get(o,i){if(h(r),i===a)return()=>{!function(e){p&&p.unregister(e)}(s),m(e),t.clear(),r=!0};if("then"===i){if(0===n.length)return{then:()=>s};const o=b(e,t,{type:"GET",path:n.map(e=>e.toString())}).then(x);return o.then.bind(o)}return v(e,t,[...n,i])},set(o,i,a){h(r);const[s,l]=E(a);return b(e,t,{type:"SET",path:[...n,i].map(e=>e.toString()),value:s},l).then(x)},apply(o,a,s){h(r);const l=n[n.length-1];if(l===i)return b(e,t,{type:"ENDPOINT"}).then(x);if("bind"===l)return v(e,t,n.slice(0,-1));const[c,d]=w(s);return b(e,t,{type:"APPLY",path:n.map(e=>e.toString()),argumentList:c},d).then(x)},construct(o,i){h(r);const[a,s]=w(i);return b(e,t,{type:"CONSTRUCT",path:n.map(e=>e.toString()),argumentList:a},s).then(x)}});return function(e,t){const n=(f.get(t)||0)+1;f.set(t,n),p&&p.register(e,t,e)}(s,e),s}function w(e){const t=e.map(E);return[t.map(e=>e[0]),(n=t.map(e=>e[1]),Array.prototype.concat.apply([],n))];var n}const I=new WeakMap;function y(e){return Object.assign(e,{[o]:!0})}function E(e){for(const[t,n]of c)if(n.canHandle(e)){const[o,i]=n.serialize(e);return[{type:"HANDLER",name:t,value:o},i]}return[{type:"RAW",value:e},I.get(e)||[]]}function x(e){switch(e.type){case"HANDLER":return c.get(e.name).deserialize(e.value);case"RAW":return e.value}}function b(e,t,n,o){return new Promise(i=>{const a=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(a,i),e.start&&e.start(),e.postMessage(Object.assign({id:a},n),o)})}},63021:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(3848),i=n(85125);function a(e){let t,n,a;function s(e,o,i=0,a=e.length){if(i<a){if(0!==t(o,o))return a;do{const t=i+a>>>1;n(e[t],o)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=o.Z,n=(t,n)=>(0,o.Z)(e(t),n),a=(t,n)=>e(t)-n):(t=e===o.Z||e===i.Z?e:r,n=e,a=e),{left:s,center:function(e,t,n=0,o=e.length){const i=s(e,t,n,o-1);return i>n&&a(e[i-1],t)>-a(e[i],t)?i-1:i},right:function(e,o,i=0,a=e.length){if(i<a){if(0!==t(o,o))return a;do{const t=i+a>>>1;n(e[t],o)<=0?i=t+1:a=t}while(i<a)}return i}}}function r(){return 0}}}]);
//# sourceMappingURL=9154.bundle.887fef403b706ff76c05.js.map